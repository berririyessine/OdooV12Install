
/* /base/static/src/js/res_config_settings.js defined in bundle 'web.assets_backend' */
odoo.define('base.settings',function(require){"use strict";var BasicModel=require('web.BasicModel');var core=require('web.core');var config=require('web.config');var FormView=require('web.FormView');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var view_registry=require('web.view_registry');var QWeb=core.qweb;var BaseSettingRenderer=FormRenderer.extend({events:_.extend({},FormRenderer.prototype.events,{'click .tab':'_onSettingTabClick','keyup .searchInput':'_onKeyUpSearch',}),init:function(){this._super.apply(this,arguments);this.activeView=false;this.activeTab=false;},start:function(){this._super.apply(this,arguments);if(config.device.isMobile){core.bus.on("DOM_updated",this,function(){this._moveToTab(this.currentIndex||this._currentAppIndex());});}},on_attach_callback:function(){this._super.apply(this,arguments);this.searchInput.focus();},_initModules:function(){var self=this;this.modules=[];_.each(this.$('.app_settings_block'),function(settingView,index){var group=!$(settingView).hasClass('o_invisible_modifier');var isNotApp=$(settingView).hasClass('o_not_app');if(group&&!isNotApp){var data=$(settingView).data();data.string=$(settingView).attr('string')||data.string;self.modules.push({key:data.key,string:data.string,imgurl:self._getAppIconUrl(data.key),});}else{$(settingView).remove();}});},_initSearch:function(){this.searchInput=this.$('.searchInput');if(this.searchText){this.searchInput.val(this.searchText);this._onKeyUpSearch();}else{this.searchText="";}},_activateSettingMobileTab:function(currentTab){var self=this;var moveTo=currentTab;var next=moveTo+1;var previous=moveTo-1;this.$(".settings .app_settings_block").removeClass("previous next current before after");this.$(".settings_tab .tab").removeClass("previous next current before after");_.each(this.modules,function(module,index){var tab=self.$(".tab[data-key='"+module.key+"']");var view=module.settingView;if(index===previous){tab.addClass("previous");tab.css("margin-left","0px");view.addClass("previous");}else if(index===next){tab.addClass("next");tab.css("margin-left","-"+tab.outerWidth()+"px");view.addClass("next");}else if(index<moveTo){tab.addClass("before");tab.css("margin-left","-"+tab.outerWidth()+"px");view.addClass("before");}else if(index===moveTo){var marginLeft=tab.outerWidth()/2;tab.css("margin-left","-"+marginLeft+"px");tab.addClass("current");view.addClass("current");}else if(index>moveTo){tab.addClass("after");tab.css("margin-left","0");view.addClass("after");}});},_currentAppIndex:function(){var self=this;var index=_.findIndex(this.modules,function(module){return module.key===self.activeSettingTab;});return index;},_enableSwipe:function(){var self=this;this.$('.settings').swipe({swipeLeft:function(){self._moveToTab(self.currentIndex+1);},swipeRight:function(){self._moveToTab(self.currentIndex-1);}});},_getAppIconUrl:function(module){return module==="general_settings"?"/base/static/description/settings.png":"/"+module+"/static/description/icon.png";},_getSearchHeader:function(imgurl,string){return $(QWeb.render('BaseSetting.SearchHeader',{imgurl:imgurl,string:string}));},_handleAttributes:function($el,node){this._super.apply(this,arguments);if(node.attrs.placeholder){$el.attr('placeholder',node.attrs.placeholder);}},_moveToTab:function(index){this.currentIndex=!index||index===-1?0:(index===this.modules.length?index-1:index);if(this.currentIndex!==-1){if(this.activeView){this.activeView.addClass("o_hidden");}
if(this.activeTab){this.activeTab.removeClass("selected");}
var view=this.modules[this.currentIndex].settingView;var tab=this.$(".tab[data-key='"+this.modules[this.currentIndex].key+"']");view.removeClass("o_hidden");this.activeView=view;this.activeTab=tab;if(config.device.isMobile){this._activateSettingMobileTab(this.currentIndex);}else{tab.addClass("selected");}}},_onSettingTabClick:function(event){this.searchInput.focus();if(this.searchText.length>0){this.searchInput.val('');this.searchText="";this._searchSetting();}
var settingKey=this.$(event.currentTarget).data('key');this._moveToTab(_.findIndex(this.modules,function(m){return m.key===settingKey;}));},_onKeyUpSearch:function(event){this.searchText=this.searchInput.val();this.activeTab.removeClass('selected');if(config.device.isMobile){this.$('.settings_tab').addClass('o_hidden');this.$('.settings').addClass('d-block');}
this._searchSetting();},_resetSearch:function(){this.searchInput.val("");_.each(this.modules,function(module){module.settingView.addClass('o_hidden');module.settingView.find('.o_setting_box').removeClass('o_hidden');module.settingView.find('h2').removeClass('o_hidden');module.settingView.find('.settingSearchHeader').addClass('o_hidden');module.settingView.find('.o_settings_container').addClass('mt16');});this.activeTab.removeClass('o_hidden').addClass('selected');this.activeView.removeClass('o_hidden');if(config.device.isMobile){this.$('.settings_tab').removeClass('o_hidden');this.$('.settings').removeClass('d-block');}},_render:function(){var res=this._super.apply(this,arguments);this._initModules();this._renderLeftPanel();this._initSearch();if(config.device.isMobile){this._enableSwipe();}
return res;},_renderLeftPanel:function(){var self=this;_.each(this.modules,function(module){module.settingView=self.$('.app_settings_block[data-key="'+module.key+'"]');module.settingView.addClass("o_hidden");module.settingView.prepend(self._getSearchHeader(module.imgurl,module.string));});this._renderTabs();this._moveToTab(this.currentIndex||this._currentAppIndex());},_renderTabs:function(){var tabs=$(QWeb.render('BaseSetting.Tabs',{tabItems:this.modules}));tabs.appendTo(this.$(".settings_tab"));},_searchSetting:function(){var self=this;this.count=0;_.each(this.modules,function(module){self.inVisibleCount=0;module.settingView.find('.o_setting_box').addClass('o_hidden');module.settingView.find('h2').addClass('o_hidden');module.settingView.find('.settingSearchHeader').addClass('o_hidden');module.settingView.find('.o_settings_container').removeClass('mt16');var resultSetting=module.settingView.find(".o_form_label:containsTextLike('"+self.searchText+"')");if(resultSetting.length>0){resultSetting.each(function(){var settingBox=$(this).closest('.o_setting_box');if(!settingBox.hasClass('o_invisible_modifier')){settingBox.removeClass('o_hidden');$(this).html(self._wordHighlighter($(this).html(),self.searchText));}else{self.inVisibleCount++;}});if(self.inVisibleCount!==resultSetting.length){module.settingView.find('.settingSearchHeader').removeClass('o_hidden');module.settingView.removeClass('o_hidden');}}else{++self.count;}});this.count===_.size(this.modules)?this.$('.notFound').removeClass('o_hidden'):this.$('.notFound').addClass('o_hidden');if(this.searchText.length===0){this._resetSearch();}},_wordHighlighter:function(text,word){if(text.indexOf('highlighter')!==-1){text=text.replace('<span class="highlighter">',"");text=text.replace("</span>","");}
var match=text.search(new RegExp(word,"i"));word=text.substring(match,match+word.length);var highlightedWord="<span class='highlighter'>"+word+'</span>';return text.replace(word,highlightedWord);},});var BaseSettingController=FormController.extend({init:function(){this._super.apply(this,arguments);this.disableAutofocus=true;this.renderer.activeSettingTab=this.initialState.context.module;},willRestore:function(){this.mode='edit';},});var BaseSettingsModel=BasicModel.extend({save:function(recordID){var self=this;return this._super.apply(this,arguments).then(function(result){delete self.localData[recordID].res_id;return result;});},});var BaseSettingView=FormView.extend({jsLibs:[],config:_.extend({},FormView.prototype.config,{Model:BaseSettingsModel,Renderer:BaseSettingRenderer,Controller:BaseSettingController,}),init:function(){if(config.device.isMobile){this.jsLibs.push('/web/static/lib/jquery.touchSwipe/jquery.touchSwipe.js');}
this._super.apply(this,arguments);},});view_registry.add('base_settings',BaseSettingView);return{Model:BaseSettingsModel,Renderer:BaseSettingRenderer,Controller:BaseSettingController,};});;

/* /web/static/lib/jquery.scrollTo/jquery.scrollTo.js defined in bundle 'web.assets_backend' */
;(function(define){'use strict';define(['jquery'],function($){var $scrollTo=$.scrollTo=function(target,duration,settings){return $(window).scrollTo(target,duration,settings);};$scrollTo.defaults={axis:'xy',duration:0,limit:true};$scrollTo.window=function(scope){return $(window)._scrollable();};$.fn._scrollable=function(){return this.map(function(){var elem=this,isWin=!elem.nodeName||$.inArray(elem.nodeName.toLowerCase(),['iframe','#document','html','body'])!=-1;if(!isWin)
return elem;var doc=(elem.contentWindow||elem).document||elem.ownerDocument||elem;return/webkit/i.test(navigator.userAgent)||doc.compatMode=='BackCompat'?doc.body:doc.documentElement;});};$.fn.scrollTo=function(target,duration,settings){if(typeof duration=='object'){settings=duration;duration=0;}
if(typeof settings=='function')
settings={onAfter:settings};if(target=='max')
target=9e9;settings=$.extend({},$scrollTo.defaults,settings);duration=duration||settings.duration;settings.queue=settings.queue&&settings.axis.length>1;if(settings.queue)
duration/=2;settings.offset=both(settings.offset);settings.over=both(settings.over);return this._scrollable().each(function(){if(target==null)return;var elem=this,$elem=$(elem),targ=target,toff,attr={},win=$elem.is('html,body');switch(typeof targ){case'number':case'string':if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(targ)){targ=both(targ);break;}
targ=win?$(targ):$(targ,this);if(!targ.length)return;case'object':if(targ.is||targ.style)
toff=(targ=$(targ)).offset();}
var offset=$.isFunction(settings.offset)&&settings.offset(elem,targ)||settings.offset;$.each(settings.axis.split(''),function(i,axis){var Pos=axis=='x'?'Left':'Top',pos=Pos.toLowerCase(),key='scroll'+Pos,old=elem[key],max=$scrollTo.max(elem,axis);if(toff){attr[key]=toff[pos]+(win?0:old-$elem.offset()[pos]);if(settings.margin){attr[key]-=parseInt(targ.css('margin'+Pos))||0;attr[key]-=parseInt(targ.css('border'+Pos+'Width'))||0;}
attr[key]+=offset[pos]||0;if(settings.over[pos])
attr[key]+=targ[axis=='x'?'width':'height']()*settings.over[pos];}else{var val=targ[pos];attr[key]=val.slice&&val.slice(-1)=='%'?parseFloat(val)/100*max:val;}
if(settings.limit&&/^\d+$/.test(attr[key]))
attr[key]=attr[key]<=0?0:Math.min(attr[key],max);if(!i&&settings.queue){if(old!=attr[key])
animate(settings.onAfterFirst);delete attr[key];}});animate(settings.onAfter);function animate(callback){$elem.animate(attr,duration,settings.easing,callback&&function(){callback.call(this,targ,settings);});}}).end();};$scrollTo.max=function(elem,axis){var Dim=axis=='x'?'Width':'Height',scroll='scroll'+Dim;if(!$(elem).is('html,body'))
return elem[scroll]-$(elem)[Dim.toLowerCase()]();var size='client'+Dim,html=elem.ownerDocument.documentElement,body=elem.ownerDocument.body;return Math.max(html[scroll],body[scroll])-Math.min(html[size],body[size]);};function both(val){return $.isFunction(val)||$.isPlainObject(val)?val:{top:val,left:val};}
return $scrollTo;})}(typeof define==='function'&&define.amd?define:function(deps,factory){if(typeof module!=='undefined'&&module.exports){module.exports=factory(require('jquery'));}else{factory(jQuery);}}));;

/* /web/static/lib/backbone/backbone.js defined in bundle 'web.assets_backend' */
(function(){var root=this;var previousBackbone=root.Backbone;var array=[];var push=array.push;var slice=array.slice;var splice=array.splice;var Backbone;if(typeof exports!=='undefined'){Backbone=exports;}else{Backbone=root.Backbone={};}
Backbone.VERSION='1.1.0';var _=root._;if(!_&&(typeof require!=='undefined'))_=require('underscore');Backbone.$=root.jQuery||root.Zepto||root.ender||root.$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this;};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,'on',name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this;},once:function(name,callback,context){if(!eventsApi(this,'once',name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments);});once._callback=callback;return this.on(name,once,context);},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,'off',name,[callback,context]))return this;if(!name&&!callback&&!context){this._events={};return this;}
names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];if(events=this._events[name]){this._events[name]=retain=[];if(callback||context){for(j=0,k=events.length;j<k;j++){ev=events[j];if((callback&&callback!==ev.callback&&callback!==ev.callback._callback)||(context&&context!==ev.context)){retain.push(ev);}}}
if(!retain.length)delete this._events[name];}}
return this;},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,'trigger',name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this;},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;if(!callback&&typeof name==='object')callback=this;if(obj)(listeningTo={})[obj._listenId]=obj;for(var id in listeningTo){obj=listeningTo[id];obj.off(name,callback,this);if(remove||_.isEmpty(obj._events))delete this._listeningTo[id];}
return this;}};var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==='object'){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest));}
return false;}
if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest));}
return false;}
return true;};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args);}};var listenMethods={listenTo:'on',listenToOnce:'once'};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={});var id=obj._listenId||(obj._listenId=_.uniqueId('l'));listeningTo[id]=obj;if(!callback&&typeof name==='object')callback=this;obj[implementation](name,callback,this);return this;};});Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={});this.cid=_.uniqueId('c');this.attributes={};if(options.collection)this.collection=options.collection;if(options.parse)attrs=this.parse(attrs,options)||{};attrs=_.defaults({},attrs,_.result(this,'defaults'));this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments);};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:'id',initialize:function(){},toJSON:function(options){return _.clone(this.attributes);},sync:function(){return Backbone.sync.apply(this,arguments);},get:function(attr){return this.attributes[attr];},escape:function(attr){return _.escape(this.get(attr));},has:function(attr){return this.get(attr)!=null;},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={};}
current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){this.changed[attr]=val;}else{delete this.changed[attr];}
unset?delete current[attr]:current[attr]=val;}
if(!silent){if(changes.length)this._pending=true;for(var i=0,l=changes.length;i<l;i++){this.trigger('change:'+changes[i],this,current[changes[i]],options);}}
if(changing)return this;if(!silent){while(this._pending){this._pending=false;this.trigger('change',this,options);}}
this._pending=false;this._changing=false;return this;},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}));},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}));},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr);},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false;var old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff){if(_.isEqual(old[attr],(val=diff[attr])))continue;(changed||(changed={}))[attr]=val;}
return changed;},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr];},previousAttributes:function(){return _.clone(this._previousAttributes);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){if(!model.set(model.parse(resp,options),options))return false;if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);return this.sync('read',this,options);},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(key==null||typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options=_.extend({validate:true},options);if(attrs&&!options.wait){if(!this.set(attrs,options))return false;}else{if(!this._validate(attrs,options))return false;}
if(attrs&&options.wait){this.attributes=_.extend({},attributes,attrs);}
if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);if(options.wait)serverAttrs=_.extend(attrs||{},serverAttrs);if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options)){return false;}
if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);method=this.isNew()?'create':(options.patch?'patch':'update');if(method==='patch')options.attrs=attrs;xhr=this.sync(method,this,options);if(attrs&&options.wait)this.attributes=attributes;return xhr;},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var destroy=function(){model.trigger('destroy',model,model.collection,options);};options.success=function(resp){if(options.wait||model.isNew())destroy();if(success)success(model,resp,options);if(!model.isNew())model.trigger('sync',model,resp,options);};if(this.isNew()){options.success();return false;}
wrapError(this,options);var xhr=this.sync('delete',this,options);if(!options.wait)destroy();return xhr;},url:function(){var base=_.result(this,'urlRoot')||_.result(this.collection,'url')||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)==='/'?'':'/')+encodeURIComponent(this.id);},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.attributes);},isNew:function(){return this.id==null;},isValid:function(options){return this._validate({},_.extend(options||{},{validate:true}));},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger('invalid',this,error,_.extend(options,{validationError:error}));return false;}});var modelMethods=['keys','values','pairs','invert','pick','omit'];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.attributes);return _[method].apply(_,args);};});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options));};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,remove:false};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options);});},sync:function(){return Backbone.sync.apply(this,arguments);},add:function(models,options){return this.set(models,_.extend({merge:false},options,addOptions));},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models);options||(options={});var i,l,index,model;for(i=0,l=models.length;i<l;i++){model=models[i]=this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byId[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger('remove',model,this,options);}
this._removeReference(model);}
return singular?models[0]:models;},set:function(models,options){options=_.defaults({},options,setOptions);if(options.parse)models=this.parse(models,options);var singular=!_.isArray(models);models=singular?(models?[models]:[]):_.clone(models);var i,l,id,model,attrs,existing,sort;var at=options.at;var targetModel=this.model;var sortable=this.comparator&&(at==null)&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var toAdd=[],toRemove=[],modelMap={};var add=options.add,merge=options.merge,remove=options.remove;var order=!sortable&&add&&remove?[]:false;for(i=0,l=models.length;i<l;i++){attrs=models[i];if(attrs instanceof Model){id=model=attrs;}else{id=attrs[targetModel.prototype.idAttribute];}
if(existing=this.get(id)){if(remove)modelMap[existing.cid]=true;if(merge){attrs=attrs===model?model.attributes:attrs;if(options.parse)attrs=existing.parse(attrs,options);existing.set(attrs,options);if(sortable&&!sort&&existing.hasChanged(sortAttr))sort=true;}
models[i]=existing;}else if(add){model=models[i]=this._prepareModel(attrs,options);if(!model)continue;toAdd.push(model);model.on('all',this._onModelEvent,this);this._byId[model.cid]=model;if(model.id!=null)this._byId[model.id]=model;}
if(order)order.push(existing||model);}
if(remove){for(i=0,l=this.length;i<l;++i){if(!modelMap[(model=this.models[i]).cid])toRemove.push(model);}
if(toRemove.length)this.remove(toRemove,options);}
if(toAdd.length||(order&&order.length)){if(sortable)sort=true;this.length+=toAdd.length;if(at!=null){for(i=0,l=toAdd.length;i<l;i++){this.models.splice(at+i,0,toAdd[i]);}}else{if(order)this.models.length=0;var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;i<l;i++){this.models.push(orderedModels[i]);}}}
if(sort)this.sort({silent:true});if(!options.silent){for(i=0,l=toAdd.length;i<l;i++){(model=toAdd[i]).trigger('add',model,this,options);}
if(sort||(order&&order.length))this.trigger('sort',this,options);}
return singular?models[0]:models;},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i]);}
options.previousModels=this.models;this._reset();models=this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger('reset',this,options);return models;},push:function(model,options){return this.add(model,_.extend({at:this.length},options));},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model;},unshift:function(model,options){return this.add(model,_.extend({at:0},options));},shift:function(options){var model=this.at(0);this.remove(model,options);return model;},slice:function(){return slice.apply(this.models,arguments);},get:function(obj){if(obj==null)return void 0;return this._byId[obj.id]||this._byId[obj.cid]||this._byId[obj];},at:function(index){return this.models[index];},where:function(attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return this[first?'find':'filter'](function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false;}
return true;});},findWhere:function(attrs){return this.where(attrs,true);},sort:function(options){if(!this.comparator)throw new Error('Cannot sort a set without a comparator');options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this);}else{this.models.sort(_.bind(this.comparator,this));}
if(!options.silent)this.trigger('sort',this,options);return this;},pluck:function(attr){return _.invoke(this.models,'get',attr);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?'reset':'set';collection[method](resp,options);if(success)success(collection,resp,options);collection.trigger('sync',collection,resp,options);};wrapError(this,options);return this.sync('read',this,options);},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return false;if(!options.wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(model,resp,options){if(options.wait)collection.add(model,options);if(success)success(model,resp,options);};model.save(null,options);return model;},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.models);},_reset:function(){this.length=0;this.models=[];this._byId={};},_prepareModel:function(attrs,options){if(attrs instanceof Model){if(!attrs.collection)attrs.collection=this;return attrs;}
options=options?_.clone(options):{};options.collection=this;var model=new this.model(attrs,options);if(!model.validationError)return model;this.trigger('invalid',this,model.validationError,options);return false;},_removeReference:function(model){if(this===model.collection)delete model.collection;model.off('all',this._onModelEvent,this);},_onModelEvent:function(event,model,collection,options){if((event==='add'||event==='remove')&&collection!==this)return;if(event==='destroy')this.remove(model,options);if(model&&event==='change:'+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];if(model.id!=null)this._byId[model.id]=model;}
this.trigger.apply(this,arguments);}});var methods=['forEach','each','map','collect','reduce','foldl','inject','reduceRight','foldr','find','detect','filter','select','reject','every','all','some','any','include','contains','invoke','max','min','toArray','size','first','head','take','initial','rest','tail','drop','last','without','difference','indexOf','shuffle','lastIndexOf','isEmpty','chain'];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args);};});var attributeMethods=['groupBy','countBy','sortBy'];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value);};return _[method](this.models,iterator,context);};});var View=Backbone.View=function(options){this.cid=_.uniqueId('view');options||(options={});_.extend(this,_.pick(options,viewOptions));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents();};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=['model','collection','el','id','attributes','className','tagName','events'];_.extend(View.prototype,Events,{tagName:'div',$:function(selector){return this.$el.find(selector);},initialize:function(){},render:function(){return this;},remove:function(){this.$el.remove();this.stopListening();return this;},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof Backbone.$?element:Backbone.$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this;},delegateEvents:function(events){if(!(events||(events=_.result(this,'events'))))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)continue;var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+='.delegateEvents'+this.cid;if(selector===''){this.$el.on(eventName,method);}else{this.$el.on(eventName,selector,method);}}
return this;},undelegateEvents:function(){this.$el.off('.delegateEvents'+this.cid);return this;},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,'attributes'));if(this.id)attrs.id=_.result(this,'id');if(this.className)attrs['class']=_.result(this,'className');var $el=Backbone.$('<'+_.result(this,'tagName')+'>').attr(attrs);this.setElement($el,false);}else{this.setElement(_.result(this,'el'),false);}}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:'json'};if(!options.url){params.url=_.result(model,'url')||urlError();}
if(options.data==null&&model&&(method==='create'||method==='update'||method==='patch')){params.contentType='application/json';params.data=JSON.stringify(options.attrs||model.toJSON(options));}
if(options.emulateJSON){params.contentType='application/x-www-form-urlencoded';params.data=params.data?{model:params.data}:{};}
if(options.emulateHTTP&&(type==='PUT'||type==='DELETE'||type==='PATCH')){params.type='POST';if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader('X-HTTP-Method-Override',type);if(beforeSend)return beforeSend.apply(this,arguments);};}
if(params.type!=='GET'&&!options.emulateJSON){params.processData=false;}
if(params.type==='PATCH'&&noXhrPatch){params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP");};}
var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger('request',model,xhr,options);return xhr;};var noXhrPatch=typeof window!=='undefined'&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var methodMap={'create':'POST','update':'PUT','patch':'PATCH','delete':'DELETE','read':'GET'};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments);};var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments);};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name='';}
if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);callback&&callback.apply(router,args);router.trigger.apply(router,['route:'+name].concat(args));router.trigger('route',name,args);Backbone.history.trigger('route',router,name,args);});return this;},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this;},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,'routes');var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route]);}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,'\\$&').replace(optionalParam,'(?:$1)?').replace(namedParam,function(match,optional){return optional?match:'([^\/]+)';}).replace(splatParam,'(.*?)');return new RegExp('^'+route+'$');},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param){return param?decodeURIComponent(param):null;});}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,'checkUrl');if(typeof window!=='undefined'){this.location=window.location;this.history=window.history;}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var isExplorer=/msie [\w.]+/;var trailingSlash=/\/$/;var pathStripper=/[?#].*$/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:'';},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=this.location.pathname;var root=this.root.replace(trailingSlash,'');if(!fragment.indexOf(root))fragment=fragment.slice(root.length);}else{fragment=this.getHash();}}
return fragment.replace(routeStripper,'');},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({root:'/'},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=(isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7));this.root=('/'+this.root+'/').replace(rootStripper,'/');if(oldIE&&this._wantsHashChange){this.iframe=Backbone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo('body')[0].contentWindow;this.navigate(fragment);}
if(this._hasPushState){Backbone.$(window).on('popstate',this.checkUrl);}else if(this._wantsHashChange&&('onhashchange'in window)&&!oldIE){Backbone.$(window).on('hashchange',this.checkUrl);}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval);}
this.fragment=fragment;var loc=this.location;var atRoot=loc.pathname.replace(/[^\/]$/,'$&/')===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+'#'+this.fragment);return true;}else if(this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,'');this.history.replaceState({},document.title,this.root+this.fragment+loc.search);}}
if(!this.options.silent)return this.loadUrl();},stop:function(){Backbone.$(window).off('popstate',this.checkUrl).off('hashchange',this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false;},route:function(route,callback){this.handlers.unshift({route:route,callback:callback});},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getFragment(this.getHash(this.iframe));}
if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl();},loadUrl:function(fragment){fragment=this.fragment=this.getFragment(fragment);return _.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true;}});},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:!!options};var url=this.root+(fragment=this.getFragment(fragment||''));fragment=fragment.replace(pathStripper,'');if(this.fragment===fragment)return;this.fragment=fragment;if(fragment===''&&url!=='/')url=url.slice(0,-1);if(this._hasPushState){this.history[options.replace?'replaceState':'pushState']({},document.title,url);}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&(fragment!==this.getFragment(this.getHash(this.iframe)))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace);}}else{return this.location.assign(url);}
if(options.trigger)return this.loadUrl(fragment);},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,'');location.replace(href+'#'+fragment);}else{location.hash='#'+fragment;}}});Backbone.history=new History;var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,'constructor')){child=protoProps.constructor;}else{child=function(){return parent.apply(this,arguments);};}
_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child;};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child;};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified');};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error(model,resp,options);model.trigger('error',model,resp,options);};};}).call(this);;

/* /web/static/lib/fuzzy-master/fuzzy.js defined in bundle 'web.assets_backend' */
(function(){var root=this;var fuzzy={};if(typeof exports!=='undefined'){module.exports=fuzzy;}else{root.fuzzy=fuzzy;}
fuzzy.simpleFilter=function(pattern,array){return array.filter(function(string){return fuzzy.test(pattern,string);});};fuzzy.test=function(pattern,string){return fuzzy.match(pattern,string)!==null;};fuzzy.match=function(pattern,string,opts){opts=opts||{};var patternIdx=0,result=[],len=string.length,totalScore=0,currScore=0,pre=opts.pre||'',post=opts.post||'',compareString=opts.caseSensitive&&string||string.toLowerCase(),ch,compareChar;pattern=opts.caseSensitive&&pattern||pattern.toLowerCase();for(var idx=0;idx<len;idx++){ch=string[idx];if(compareString[idx]===pattern[patternIdx]){if(pattern[patternIdx]===' '){currScore=1-idx/200;}else{currScore+=1+currScore-idx/200;}
ch=pre+ch+post;patternIdx+=1;}else{currScore=0;}
totalScore+=currScore;if(compareString[idx]===' '){currScore=0;}
result[result.length]=ch;}
if(patternIdx===pattern.length){return{rendered:result.join(''),score:totalScore};}
return null;};fuzzy.filter=function(pattern,arr,opts){if(!arr||arr.length===0){return[]}
if(typeof pattern!=='string'){return arr}
opts=opts||{};return arr.reduce(function(prev,element,idx,arr){var str=element;if(opts.extract){str=opts.extract(element);}
var rendered=fuzzy.match(pattern,str,opts);if(rendered!=null){prev[prev.length]={string:rendered.rendered,score:rendered.score,index:idx,original:element};}
return prev;},[]).sort(function(a,b){var compare=b.score-a.score;if(compare)return compare;return a.index-b.index;});};}());;

/* <inline asset> defined in bundle 'web.assets_backend' */
odoo._modules=["base","web","bus","web_tour","mail","web_settings_dashboard","iap","app_odoo_customize","product","barcodes","stock","portal","digest","account","sales_team","payment","sale","sale_management","periodical_sales_report","account_accountant","purchase","Electro_DP","account_bank_statement_import","contacts","account_due_list","date_range","account_fiscal_year","account_payment_cancel","account_payment_purchase","account_payment_sale","account_reports","account_tax_balance","auth_signup","auto_backup","web_responsive","backend_theme_v12","base_import","board","customer_sale_history","database_autobackup","l10n_generic_coa","l12n_tn","l12_tn_timbre","list_export_excel_app","mail_bot","mass_cancel_purchase_order","mass_cancel_sales_order","odoo_web_login","om_mass_invoice_cancel","partner_autocomplete","payment_transfer","report_interne","sale_stock","sms","snailmail","stock_3dbase","stock_3dview","update__invoice","web_diagram","web_editor","web_kanban_gauge","web_unsplash","calendar"];;

/* /web/static/lib/py.js/lib/py.js defined in bundle 'web.assets_backend' */
var py={};(function(py){var create=function(o,props){function F(){}
F.prototype=o;var inst=new F;if(props){for(var name in props){if(!props.hasOwnProperty(name)){continue;}
inst[name]=props[name];}}
return inst;};var symbols={};var comparators={};var Base={nud:function(){throw new Error(this.id+" undefined as prefix");},led:function(led){throw new Error(this.id+" undefined as infix");},toString:function(){if(this.id==='(constant)'||this.id==='(number)'||this.id==='(name)'||this.id==='(string)'){return[this.id.slice(0,this.id.length-1),' ',this.value,')'].join('');}else if(this.id==='(end)'){return'(end)';}else if(this.id==='(comparator)'){var repr=['(comparator',this.expressions[0]];for(var i=0;i<this.operators.length;++i){repr.push(this.operators[i],this.expressions[i+1]);}
return repr.join(' ')+')';}
var out=[this.id,this.first,this.second,this.third].filter(function(r){return r}).join(' ');return'('+out+')';}};function symbol(id,bp){bp=bp||0;var s=symbols[id];if(s){if(bp>s.lbp){s.lbp=bp;}
return s;}
return symbols[id]=create(Base,{id:id,lbp:bp});}
function constant(id){var s=symbol(id);s.id='(constant)';s.value=id;s.nud=function(){return this;};}
function prefix(id,bp,nud){symbol(id).nud=nud||function(){this.first=expression(bp);return this}}
function infix(id,bp,led){symbol(id,bp).led=led||function(left){this.first=left;this.second=expression(bp);return this;}}
function infixr(id,bp){symbol(id,bp).led=function(left){this.first=left;this.second=expression(bp-1);return this;}}
function comparator(id){comparators[id]=true;var bp=60;infix(id,bp,function(left){this.id='(comparator)';this.operators=[id];this.expressions=[left,expression(bp)];while(token.id in comparators){this.operators.push(token.id);advance();this.expressions.push(expression(bp));}
return this;});}
constant('None');constant('False');constant('True');symbol('(number)').nud=function(){return this;};symbol('(name)').nud=function(){return this;};symbol('(string)').nud=function(){return this;};symbol('(end)');symbol(':');symbol(')');symbol(']');symbol('}');symbol(',');symbol('else');infix('=',10,function(left){if(left.id!=='(name)'){throw new Error("Expected keyword argument name, got "+token.id);}
this.first=left;this.second=expression();return this;});symbol('lambda',20).nud=function(){this.first=[];if(token.id!==':'){for(;;){if(token.id!=='(name)'){throw new Error('Excepted an argument name');}
this.first.push(token);advance();if(token.id!==','){break;}
advance(',');}}
advance(':');this.second=expression();return this;};infix('if',20,function(left){this.first=left;this.second=expression();advance('else');this.third=expression();return this;});infixr('or',30);infixr('and',40);prefix('not',50);comparator('in');comparator('not in');comparator('is');comparator('is not');comparator('<');comparator('<=');comparator('>');comparator('>=');comparator('<>');comparator('!=');comparator('==');infix('|',70);infix('^',80);infix('&',90);infix('<<',100);infix('>>',100);infix('+',110);infix('-',110);infix('*',120);infix('/',120);infix('//',120);infix('%',120);prefix('-',130);prefix('+',130);prefix('~',130);infixr('**',140);infix('.',150,function(left){if(token.id!=='(name)'){throw new Error('Expected attribute name, got '+token.id);}
this.first=left;this.second=token;advance();return this;});symbol('(',150).nud=function(){this.first=[];var comma=false;if(token.id!==')'){while(true){if(token.id===')'){break;}
this.first.push(expression());if(token.id!==','){break;}
comma=true;advance(',');}}
advance(')');if(!this.first.length||comma){return this;}else{return this.first[0];}};symbol('(').led=function(left){this.first=left;this.second=[];if(token.id!==")"){for(;;){this.second.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(")");return this;};infix('[',150,function(left){this.first=left;this.second=expression();advance("]");return this;});symbol('[').nud=function(){this.first=[];if(token.id!==']'){for(;;){if(token.id===']'){break;}
this.first.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(']');return this;};symbol('{').nud=function(){this.first=[];if(token.id!=='}'){for(;;){if(token.id==='}'){break;}
var key=expression();advance(':');var value=expression();this.first.push([key,value]);if(token.id!==','){break;}
advance(',');}}
advance('}');return this;};py.tokenize=(function(){function group(){return'('+Array.prototype.join.call(arguments,'|')+')';}
var Whitespace='[ \\f\\t]*';var Name='[a-zA-Z_]\\w*';var DecNumber='\\d+(L|l)?';var IntNumber=DecNumber;var PointFloat=group('\\d+\\.\\d*','\\.\\d+');var FloatNumber=PointFloat;var Number=group(FloatNumber,IntNumber);var Operator=group("\\*\\*=?",">>=?","<<=?","<>","!=","//=?","[+\\-*/%&|^=<>]=?","~");var Bracket='[\\[\\]\\(\\)\\{\\}]';var Special='[:;.,`@]';var Funny=group(Operator,Bracket,Special);var ContStr=group("([uU])?'([^\n'\\\\]*(?:\\\\.[^\n'\\\\]*)*)'",'([uU])?"([^\n"\\\\]*(?:\\\\.[^\n"\\\\]*)*)"');var PseudoToken=Whitespace+group(Number,Funny,ContStr,Name);var number_pattern=new RegExp('^'+Number+'$');var string_pattern=new RegExp('^'+ContStr+'$');var name_pattern=new RegExp('^'+Name+'$');var strip=new RegExp('^'+Whitespace);return function tokenize(s){var max=s.length,tokens=[],start,end;var pseudoprog=new RegExp(PseudoToken,'g');while(pseudoprog.lastIndex<max){var pseudomatch=pseudoprog.exec(s);if(!pseudomatch){if(/^\s+$/.test(s.slice(end))){break;}
throw new Error('Failed to tokenize <<'+s
+'>> at index '+(end||0)
+'; parsed so far: '+tokens);}
start=pseudomatch.index;end=pseudoprog.lastIndex;var token=s.slice(start,end).replace(strip,'');if(number_pattern.test(token)){tokens.push(create(symbols['(number)'],{value:parseFloat(token)}));}else if(string_pattern.test(token)){var m=string_pattern.exec(token);var value=(m[3]!==undefined?m[3]:m[5]);tokens.push(create(symbols['(string)'],{unicode:!!(m[2]||m[4]),value:value}));}else if(token in symbols){var symbol;if(token==='in'&&tokens.length>1&&tokens[tokens.length-1].id==='not'){symbol=symbols['not in'];tokens.pop();}else if(token==='not'&&tokens.length>1&&tokens[tokens.length-1].id==='is'){symbol=symbols['is not'];tokens.pop();}else{symbol=symbols[token];}
tokens.push(create(symbol));}else if(name_pattern.test(token)){tokens.push(create(symbols['(name)'],{value:token}));}else{throw new Error("Tokenizing failure of <<"+s+">> at index "+start
+" for token [["+token+"]]"
+"; parsed so far: "+tokens);}}
tokens.push(create(symbols['(end)']));return tokens;}})();var token,next;function expression(rbp){rbp=rbp||0;var t=token;token=next();var left=t.nud();while(rbp<token.lbp){t=token;token=next();left=t.led(left);}
return left;}
function advance(id){if(id&&token.id!==id){throw new Error('Expected "'+id+'", got "'+token.id+'"');}
token=next();}
function PY_ensurepy(val,name){switch(val){case undefined:throw new Error("NameError: name '"+name+"' is not defined");case null:return py.None;case true:return py.True;case false:return py.False;}
var fn=function(){};fn.prototype=py.object;if(py.PY_isInstance(val,py.object)||py.PY_isSubclass(val,py.object)){return val;}
switch(typeof val){case'number':return py.float.fromJSON(val);case'string':return py.str.fromJSON(val);case'function':return py.PY_def.fromJSON(val);}
switch(val.constructor){case Object:var o=py.PY_call(py.object);for(var prop in val){if(val.hasOwnProperty(prop)){o[prop]=val[prop];}}
return o;case Array:return py.list.fromJSON(val);}
throw new Error("Could not convert "+val+" to a pyval");}
var typename=function(obj){if(obj.__class__){return obj.__class__.__name__;}else if(typeof obj!=='object'){return typeof obj;}else{return obj.constructor.name;}};py.py={};py.PY_parseArgs=function PY_parseArgs(argument,format){var out={};var args=argument[0];var kwargs={};for(var k in argument[1]){if(!argument[1].hasOwnProperty(k)){continue;}
kwargs[k]=argument[1][k];}
if(typeof format==='string'){format=format.split(/\s+/);}
var name=function(spec){if(typeof spec==='string'){return spec;}else if(spec instanceof Array&&spec.length===2){return spec[0];}
throw new Error("TypeError: unknown format specification "+
JSON.stringify(spec));};var spec;for(var i=0;i<args.length;++i){spec=format[i];if(!spec||spec==='*'){throw new Error("TypeError: function takes exactly "+(i-1)+" positional arguments ("+args.length+" given")}else if(/^\*\w/.test(spec)){out[name(spec.slice(1))]=args.slice(i);break;}
out[name(spec)]=args[i];}
for(var j=i;j<format.length;++j){spec=format[j];var n=name(spec);if(n in out){throw new Error("TypeError: function got multiple values "+"for keyword argument '"+kwarg+"'");}
if(/^\*\*\w/.test(n)){out[n.slice(2)]=kwargs;kwargs={};break;}
if(n in kwargs){out[n]=kwargs[n];delete kwargs[n];}}
for(var key in kwargs){throw new Error("TypeError: function got an unexpected keyword argument '"
+key+"'");}
var kwonly=0;for(var k=0;k<format.length;++k){if(/^\*/.test(format[k])){kwonly=1;break;}}
for(var k=0;k<format.length;++k){spec=format[k];var n=name(spec);if(/^\*/.test(n)||n in out){continue;}
if(!(spec instanceof Array)){throw new Error("TypeError: function takes exactly "+(format.length-kwonly)
+" arguments");}
out[n]=spec[1];}
return out;};py.PY_hasAttr=function(o,attr_name){try{py.PY_getAttr(o,attr_name);return true;}catch(e){return false;}};py.PY_getAttr=function(o,attr_name){return PY_ensurepy(o.__getattribute__(attr_name));};py.PY_str=function(o){var v=o.__str__();if(py.PY_isInstance(v,py.str)){return v;}
throw new Error('TypeError: __str__ returned non-string (type '
+typename(v)
+')');};py.PY_isInstance=function(inst,cls){var fn=function(){};fn.prototype=cls;return inst instanceof fn;};py.PY_isSubclass=function(derived,cls){var fn=function(){};fn.prototype=cls;return derived===cls||derived instanceof fn;};py.PY_call=function(callable,args,kwargs){if(!args){args=[];}
if(typeof args==='object'&&!(args instanceof Array)){kwargs=args;args=[];}
if(!kwargs){kwargs={};}
if(callable.__is_type){var instance=callable.__new__.call(callable,args,kwargs);var typ=function(){};typ.prototype=callable;if(instance instanceof typ){instance.__init__.call(instance,args,kwargs);}
return instance}
return callable.__call__(args,kwargs);};py.PY_isTrue=function(o){var res=o.__nonzero__();if(res===py.True){return true;}
if(res===py.False){return false;}
throw new Error("TypeError: __nonzero__ should return bool, returned "
+typename(res));};py.PY_not=function(o){return!py.PY_isTrue(o);};py.PY_size=function(o){if(!o.__len__){throw new Error("TypeError: object of type '"+
typename(o)+"' has no len()");}
var v=o.__len__();if(typeof v!=='number'){throw new Error("TypeError: a number is required");}
return v;};py.PY_getItem=function(o,key){if(!('__getitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object is unsubscriptable")}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
var res=o.__getitem__(key);if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: __getitem__ must return a py.js object, got "
+typename(res));}
return res;};py.PY_setItem=function(o,key,v){if(!('__setitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object does not support item assignment");}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
if(!py.PY_isInstance(v,py.object)){throw new Error("TypeError: '"+typename(v)+"' is not a py.js object");}
o.__setitem__(key,v);};py.PY_add=function(o1,o2){return PY_op(o1,o2,'+');};py.PY_subtract=function(o1,o2){return PY_op(o1,o2,'-');};py.PY_multiply=function(o1,o2){return PY_op(o1,o2,'*');};py.PY_divide=function(o1,o2){return PY_op(o1,o2,'/');};py.PY_negative=function(o){if(!o.__neg__){throw new Error("TypeError: bad operand for unary -: '"
+typename(o)
+"'");}
return o.__neg__();};py.PY_positive=function(o){if(!o.__pos__){throw new Error("TypeError: bad operand for unary +: '"
+typename(o)
+"'");}
return o.__pos__();};py.type=function type(name,bases,dict){if(typeof name!=='string'){throw new Error("ValueError: a class name should be a string");}
if(!bases||bases.length===0){bases=[py.object];}else if(bases.length>1){throw new Error("ValueError: can't provide multiple bases for a "
+"new type");}
var base=bases[0];var ClassObj=create(base);if(dict){for(var k in dict){if(!dict.hasOwnProperty(k)){continue;}
ClassObj[k]=dict[k];}}
ClassObj.__class__=ClassObj;ClassObj.__name__=name;ClassObj.__bases__=bases;ClassObj.__is_type=true;return ClassObj;};py.type.__call__=function(){var args=py.PY_parseArgs(arguments,['object']);return args.object.__class__;};var hash_counter=0;py.object=py.type('object',[{}],{__new__:function(){var inst=create(this);inst.__is_type=false;return inst;},__init__:function(){},__hash__:function(){if(this._hash){return this._hash;}
return this._hash='\0\0\0'+String(hash_counter++);},__eq__:function(other){return(this===other)?py.True:py.False;},__ne__:function(other){if(py.PY_isTrue(this.__eq__(other))){return py.False;}else{return py.True;}},__lt__:function(){return py.NotImplemented;},__le__:function(){return py.NotImplemented;},__ge__:function(){return py.NotImplemented;},__gt__:function(){return py.NotImplemented;},__str__:function(){return this.__unicode__();},__unicode__:function(){return py.str.fromJSON('<'+typename(this)+' object>');},__nonzero__:function(){return py.True;},__getattribute__:function(name){if(name in this){var val=this[name];if(typeof val==='object'&&'__get__'in val){return val.__get__(this,py.PY_call(py.type,[this]));}
if(typeof val==='function'&&!this.hasOwnProperty(name)){return PY_instancemethod.fromJSON(val,this);}
return val;}
if('__getattr__'in this){return this.__getattr__(name);}
throw new Error("AttributeError: object has no attribute '"+name+"'");},__setattr__:function(name,value){if(name in this&&'__set__'in this[name]){this[name].__set__(this,value);}
this[name]=value;},toJSON:function(){throw new Error(this.constructor.name+' can not be converted to JSON');}});var NoneType=py.type('NoneType',null,{__nonzero__:function(){return py.False;},toJSON:function(){return null;}});py.None=py.PY_call(NoneType);var NotImplementedType=py.type('NotImplementedType',null,{});py.NotImplemented=py.PY_call(NotImplementedType);var booleans_initialized=false;py.bool=py.type('bool',null,{__new__:function(){if(!booleans_initialized){return py.object.__new__.apply(this);}
var ph={};var args=py.PY_parseArgs(arguments,[['value',ph]]);if(args.value===ph){return py.False;}
return py.PY_isTrue(args.value)?py.True:py.False;},__str__:function(){return py.str.fromJSON((this===py.True)?"True":"False");},__nonzero__:function(){return this;},fromJSON:function(val){return val?py.True:py.False},toJSON:function(){return this===py.True;}});py.True=py.PY_call(py.bool);py.False=py.PY_call(py.bool);booleans_initialized=true;py.float=py.type('float',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var value=args.value;if(value===placeholder){this._value=0;return;}
if(py.PY_isInstance(value,py.float)){this._value=value._value;}
if(py.PY_isInstance(value,py.object)&&'__float__'in value){var res=value.__float__();if(py.PY_isInstance(res,py.float)){this._value=res._value;return;}
throw new Error('TypeError: __float__ returned non-float (type '+
typename(res)+')');}
throw new Error('TypeError: float() argument must be a string or a number');},__str__:function(){return py.str.fromJSON(String(this._value));},__eq__:function(other){return this._value===other._value?py.True:py.False;},__lt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__abs__:function(){return py.float.fromJSON(Math.abs(this._value));},__add__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value+other._value);},__mod__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value%other._value);},__neg__:function(){return py.float.fromJSON(-this._value);},__sub__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value-other._value);},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value*other._value);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value/other._value);},__nonzero__:function(){return this._value?py.True:py.False;},fromJSON:function(v){if(!(typeof v==='number')){throw new Error('py.float.fromJSON can only take numbers');}
var instance=py.PY_call(py.float);instance._value=v;return instance;},toJSON:function(){return this._value;}});py.str=py.type('str',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var s=args.value;if(s===placeholder){this._value='';return;}
this._value=py.PY_str(s)._value;},__hash__:function(){return'\1\0\1'+this._value;},__str__:function(){return this;},__eq__:function(other){if(py.PY_isInstance(other,py.str)&&this._value===other._value){return py.True;}
return py.False;},__lt__:function(other){if(py.PY_not(py.PY_call(py.isinstance,[other,py.str]))){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return py.str.fromJSON(this._value+other._value);},__nonzero__:function(){return this._value.length?py.True:py.False;},__contains__:function(s){return(this._value.indexOf(s._value)!==-1)?py.True:py.False;},fromJSON:function(s){if(typeof s==='string'){var instance=py.PY_call(py.str);instance._value=s;return instance;}
throw new Error("str.fromJSON can only take strings");},toJSON:function(){return this._value;}});py.tuple=py.type('tuple',null,{__init__:function(){this._values=[];},__len__:function(){return this._values.length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},__contains__:function(value){for(var i=0,len=this._values.length;i<len;++i){if(py.PY_isTrue(this._values[i].__eq__(value))){return py.True;}}
return py.False;},__getitem__:function(index){return this._values[index.toJSON()];},toJSON:function(){var out=[];for(var i=0;i<this._values.length;++i){out.push(this._values[i].toJSON());}
return out;},fromJSON:function(ar){if(!(ar instanceof Array)){throw new Error("Can only create a py.tuple from an Array");}
var t=py.PY_call(py.tuple);for(var i=0;i<ar.length;++i){t._values.push(PY_ensurepy(ar[i]));}
return t;}});py.list=py.type('list',null,{__nonzero__:function(){return this.__len__>0?py.True:py.False;},});_.defaults(py.list,py.tuple)
py.dict=py.type('dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var h=key.__hash__();if(!(h in this._store)){throw new Error("KeyError: '"+key.toJSON()+"'");}
return this._store[h][1];},__setitem__:function(key,value){this._store[key.__hash__()]=[key,value];},__len__:function(){return Object.keys(this._store).length},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);var h=args.k.__hash__();if(!(h in this._store)){return args.d;}
return this._store[h][1];},fromJSON:function(d){var instance=py.PY_call(py.dict);for(var k in(d||{})){if(!d.hasOwnProperty(k)){continue;}
instance.__setitem__(py.str.fromJSON(k),PY_ensurepy(d[k]));}
return instance;},toJSON:function(){var out={};for(var k in this._store){var item=this._store[k];out[item[0].toJSON()]=item[1].toJSON();}
return out;}});py.PY_def=py.type('function',null,{__call__:function(){return this._func.apply(this._inst,arguments);},fromJSON:function(nativefunc){var instance=py.PY_call(py.PY_def);instance._inst=null;instance._func=nativefunc;return instance;},toJSON:function(){return this._func;}});py.classmethod=py.type('classmethod',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'function');this._func=args['function'];},__get__:function(obj,type){return PY_instancemethod.fromJSON(this._func,type);},fromJSON:function(func){return py.PY_call(py.classmethod,[func]);}});var PY_instancemethod=py.type('instancemethod',[py.PY_def],{fromJSON:function(nativefunc,instance){var inst=py.PY_call(PY_instancemethod);inst._inst=instance;inst._func=nativefunc;return inst;}});py.abs=new py.PY_def.fromJSON(function abs(){var args=py.PY_parseArgs(arguments,['number']);if(!args.number.__abs__){throw new Error("TypeError: bad operand type for abs(): '"
+typename(args.number)
+"'");}
return args.number.__abs__();});py.len=new py.PY_def.fromJSON(function len(){var args=py.PY_parseArgs(arguments,['object']);return py.float.fromJSON(py.PY_size(args.object));});py.isinstance=new py.PY_def.fromJSON(function isinstance(){var args=py.PY_parseArgs(arguments,['object','class']);return py.PY_isInstance(args.object,args['class'])?py.True:py.False;});py.issubclass=new py.PY_def.fromJSON(function issubclass(){var args=py.PY_parseArgs(arguments,['C','B']);return py.PY_isSubclass(args.C,args.B)?py.True:py.False;});var PY_decode_string_literal=function(str,unicode){var out=[],code;var direct_map={'\\':'\\','"':'"',"'":"'",'a':'\x07','b':'\x08','f':'\x0c','n':'\n','r':'\r','t':'\t','v':'\v'};for(var i=0;i<str.length;++i){if(str[i]!=='\\'){out.push(str[i]);continue;}
var escape=str[i+1];if(escape in direct_map){out.push(direct_map[escape]);++i;continue;}
switch(escape){case'\n':++i;continue;case'N':if(!unicode){break;}
throw Error("SyntaxError: \\N{} escape not implemented");case'u':if(!unicode){break;}
var uni=str.slice(i+2,i+6);if(!/[0-9a-f]{4}/i.test(uni)){throw new Error(["SyntaxError: (unicode error) 'unicodeescape' codec"," can't decode bytes in position ",i,"-",i+4,": truncated \\uXXXX escape"].join(''));}
code=parseInt(uni,16);out.push(String.fromCharCode(code));i+=5;continue;case'U':if(!unicode){break;}
throw Error("SyntaxError: \\U escape not implemented");case'x':var hex=str.slice(i+2,i+4);if(!/[0-9a-f]{2}/i.test(hex)){if(!unicode){throw new Error('ValueError: invalid \\x escape');}
throw new Error(["SyntaxError: (unicode error) 'unicodeescape'"," codec can't decode bytes in position ",i,'-',i+2,": truncated \\xXX escape"].join(''))}
code=parseInt(hex,16);out.push(String.fromCharCode(code));i+=3;continue;default:if(!/[0-8]/.test(escape)){break;}
var r=/[0-8]{1,3}/g;r.lastIndex=i+1;var m=r.exec(str);var oct=m[0];code=parseInt(oct,8);out.push(String.fromCharCode(code));i+=oct.length;continue;}
out.push('\\');}
return out.join('');};var PY_operators={'==':['eq','eq',function(a,b){return a===b;}],'!=':['ne','ne',function(a,b){return a!==b;}],'<>':['ne','ne',function(a,b){return a!==b;}],'<':['lt','gt',function(a,b){return a.__class__.__name__<b.__class__.__name__;}],'<=':['le','ge',function(a,b){return a.__class__.__name__<=b.__class__.__name__;}],'>':['gt','lt',function(a,b){return a.__class__.__name__>b.__class__.__name__;}],'>=':['ge','le',function(a,b){return a.__class__.__name__>=b.__class__.__name__;}],'+':['add','radd'],'-':['sub','rsub'],'*':['mul','rmul'],'/':['div','rdiv'],'//':['floordiv','rfloordiv'],'%':['mod','rmod'],'**':['pow','rpow'],'<<':['lshift','rlshift'],'>>':['rshift','rrshift'],'&':['and','rand'],'^':['xor','rxor'],'|':['or','ror']};var PY_op=function(o1,o2,op){var r;var methods=PY_operators[op];var forward='__'+methods[0]+'__',reverse='__'+methods[1]+'__';var otherwise=methods[2];if(forward in o1&&(r=o1[forward](o2))!==py.NotImplemented){return r;}
if(reverse in o2&&(r=o2[reverse](o1))!==py.NotImplemented){return r;}
if(otherwise){return PY_ensurepy(otherwise(o1,o2));}
throw new Error("TypeError: unsupported operand type(s) for "+op+": '"
+typename(o1)+"' and '"+typename(o2)+"'");};var PY_builtins={type:py.type,None:py.None,True:py.True,False:py.False,NotImplemented:py.NotImplemented,object:py.object,bool:py.bool,float:py.float,str:py.str,unicode:py.unicode,tuple:py.tuple,list:py.list,dict:py.dict,abs:py.abs,len:py.len,isinstance:py.isinstance,issubclass:py.issubclass,classmethod:py.classmethod,};py.parse=function(toks){var index=0;token=toks[0];next=function(){return toks[++index];};return expression();};var evaluate_operator=function(operator,a,b){switch(operator){case'is':return a===b?py.True:py.False;case'is not':return a!==b?py.True:py.False;case'in':return b.__contains__(a);case'not in':return py.PY_isTrue(b.__contains__(a))?py.False:py.True;case'==':case'!=':case'<>':case'<':case'<=':case'>':case'>=':return PY_op(a,b,operator);}
throw new Error('SyntaxError: unknown comparator [['+operator+']]');};py.evaluate=function(expr,context){context=context||{};switch(expr.id){case'(name)':var val=context[expr.value];if(val===undefined&&expr.value in PY_builtins){return PY_builtins[expr.value];}
return PY_ensurepy(val,expr.value);case'(string)':return py.str.fromJSON(PY_decode_string_literal(expr.value,expr.unicode));case'(number)':return py.float.fromJSON(expr.value);case'(constant)':switch(expr.value){case'None':return py.None;case'False':return py.False;case'True':return py.True;}
throw new Error("SyntaxError: unknown constant '"+expr.value+"'");case'(comparator)':var result,left=py.evaluate(expr.expressions[0],context);for(var i=0;i<expr.operators.length;++i){result=evaluate_operator(expr.operators[i],left,left=py.evaluate(expr.expressions[i+1],context));if(py.PY_not(result)){return py.False;}}
return py.True;case'not':return py.PY_isTrue(py.evaluate(expr.first,context))?py.False:py.True;case'and':var and_first=py.evaluate(expr.first,context);if(py.PY_isTrue(and_first.__nonzero__())){return py.evaluate(expr.second,context);}
return and_first;case'or':var or_first=py.evaluate(expr.first,context);if(py.PY_isTrue(or_first.__nonzero__())){return or_first}
return py.evaluate(expr.second,context);case'(':if(expr.second){var callable=py.evaluate(expr.first,context);var args=[],kwargs={};for(var jj=0;jj<expr.second.length;++jj){var arg=expr.second[jj];if(arg.id!=='='){args.push(py.evaluate(arg,context));}else{kwargs[arg.first.value]=py.evaluate(arg.second,context);}}
return py.PY_call(callable,args,kwargs);}
var tuple_exprs=expr.first,tuple_values=[];for(var j=0,len=tuple_exprs.length;j<len;++j){tuple_values.push(py.evaluate(tuple_exprs[j],context));}
return py.tuple.fromJSON(tuple_values);case'[':if(expr.second){return py.PY_getItem(py.evaluate(expr.first,context),py.evaluate(expr.second,context));}
var list_exprs=expr.first,list_values=[];for(var k=0;k<list_exprs.length;++k){list_values.push(py.evaluate(list_exprs[k],context));}
return py.list.fromJSON(list_values);case'{':var dict_exprs=expr.first,dict=py.PY_call(py.dict);for(var l=0;l<dict_exprs.length;++l){py.PY_setItem(dict,py.evaluate(dict_exprs[l][0],context),py.evaluate(dict_exprs[l][1],context));}
return dict;case'.':if(expr.second.id!=='(name)'){throw new Error('SyntaxError: '+expr);}
return py.PY_getAttr(py.evaluate(expr.first,context),expr.second.value);case'~':return(py.evaluate(expr.first,context)).__invert__();case'+':if(!expr.second){return py.PY_positive(py.evaluate(expr.first,context));}
case'-':if(!expr.second){return py.PY_negative(py.evaluate(expr.first,context));}
case'*':case'/':case'//':case'%':case'**':case'<<':case'>>':case'&':case'^':case'|':return PY_op(py.evaluate(expr.first,context),py.evaluate(expr.second,context),expr.id);default:throw new Error('SyntaxError: Unknown node [['+expr.id+']]');}};py.eval=function(str,context){return py.evaluate(py.parse(py.tokenize(str)),context).toJSON();}})(typeof exports==='undefined'?py:exports);;

/* /web/static/lib/py.js/lib/py_extras.js defined in bundle 'web.assets_backend' */
(function(py){"use strict";function divmod(a,b,fn){var mod=a%b;if(mod>0&&b<0||mod<0&&b>0){mod+=b;}
return fn(Math.floor(a/b),mod);}
function modf(x,fn){var mod=x%1;if(mod<0){mod+=1;}
return fn(mod,Math.floor(x));}
function assert(bool){if(!bool){throw new Error("AssertionError");}}
var obj=function(){};obj.prototype=py.object;var asJS=function(arg){if(arg instanceof obj){return arg.toJSON();}
return arg;};var datetime=py.PY_call(py.object);var zero=py.float.fromJSON(0);var DAYS_IN_MONTH=[null,31,28,31,30,31,30,31,31,30,31,30,31];var DAYS_BEFORE_MONTH=[null];var dbm=0;for(var i=1;i<DAYS_IN_MONTH.length;++i){DAYS_BEFORE_MONTH.push(dbm);dbm+=DAYS_IN_MONTH[i];}
function is_leap(year){return year%4===0&&(year%100!==0||year%400===0);}
function days_before_year(year){var y=year-1;return y*365+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400);}
function days_in_month(year,month){if(month===2&&is_leap(year)){return 29;}
return DAYS_IN_MONTH[month];}
function days_before_month(year,month){var post_leap_feb=month>2&&is_leap(year);return DAYS_BEFORE_MONTH[month]+(post_leap_feb?1:0);}
function ymd2ord(year,month,day){var dim=days_in_month(year,month);if(!(1<=day&&day<=dim)){throw new Error("ValueError: day must be in 1.."+dim);}
return days_before_year(year)+
days_before_month(year,month)+
day;}
function get_quarter_number(month){return Math.ceil(month/3);}
function get_quarter(year,month){var quarter_number=get_quarter_number(month);var month_from=((quarter_number-1)*3)+1
var date_from={year:year,month:month_from,day:1}
var date_to={year:year,month:month_from+2,day:days_in_month(year,month)}
return[date_from,date_to];}
function get_day_of_week(year,month,day){var d=new Date(year,month-1,day);return(d.getDay()+6)%7;}
var DI400Y=days_before_year(401);var DI100Y=days_before_year(101);var DI4Y=days_before_year(5);function ord2ymd(n){--n;var n400,n100,n4,n1,n0;divmod(n,DI400Y,function(_n400,n){n400=_n400;divmod(n,DI100Y,function(_n100,n){n100=_n100;divmod(n,DI4Y,function(_n4,n){n4=_n4;divmod(n,365,function(_n1,n){n1=_n1;n0=n;});});});});n=n0;var year=n400*400+1+n100*100+n4*4+n1;if(n1==4||n100==100){assert(n0===0);return{year:year-1,month:12,day:31};}
var leapyear=n1===3&&(n4!==24||n100==3);assert(leapyear==is_leap(year));var month=(n+50)>>5;var preceding=DAYS_BEFORE_MONTH[month]+((month>2&&leapyear)?1:0);if(preceding>n){--month;preceding-=DAYS_IN_MONTH[month]+((month===2&&leapyear)?1:0);}
n-=preceding;return{year:year,month:month,day:n+1};}
function tmxxx(year,month,day,hour,minute,second,microsecond){hour=hour||0;minute=minute||0;second=second||0;microsecond=microsecond||0;if(microsecond<0||microsecond>999999){divmod(microsecond,1000000,function(carry,ms){microsecond=ms;second+=carry;});}
if(second<0||second>59){divmod(second,60,function(carry,s){second=s;minute+=carry;});}
if(minute<0||minute>59){divmod(minute,60,function(carry,m){minute=m;hour+=carry;});}
if(hour<0||hour>23){divmod(hour,24,function(carry,h){hour=h;day+=carry;});}
if(month<1||month>12){divmod(month-1,12,function(carry,m){month=m+1;year+=carry;});}
var dim=days_in_month(year,month);if(day<1||day>dim){if(day===0){--month;if(month>0){day=days_in_month(year,month);}else{--year;month=12;day=31;}}else if(day==dim+1){++month;day=1;if(month>12){month=1;++year;}}else{var r=ord2ymd(ymd2ord(year,month,1)+(day-1));year=r.year;month=r.month;day=r.day;}}
return{year:year,month:month,day:day,hour:hour,minute:minute,second:second,microsecond:microsecond};}
datetime.timedelta=py.type('timedelta',null,{__init__:function(){var args=py.PY_parseArgs(arguments,[['days',zero],['seconds',zero],['microseconds',zero],['milliseconds',zero],['minutes',zero],['hours',zero],['weeks',zero]]);var d=0,s=0,m=0;var days=args.days.toJSON()+args.weeks.toJSON()*7;var seconds=args.seconds.toJSON()
+args.minutes.toJSON()*60
+args.hours.toJSON()*3600;var microseconds=args.microseconds.toJSON()
+args.milliseconds.toJSON()*1000;var daysecondsfrac=modf(days,function(dayfrac,days){d=days;if(dayfrac){return modf(dayfrac*24*3600,function(dsf,dsw){s=dsw;return dsf;});}
return 0;});var secondsfrac=modf(seconds,function(sf,s){seconds=s;return sf+daysecondsfrac;});divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;});microseconds+=secondsfrac*1e6;divmod(microseconds,1000000,function(seconds,microseconds){divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;m+=Math.round(microseconds);});});this.days=d;this.seconds=s;this.microseconds=m;},__str__:function(){var hh,mm,ss;divmod(this.seconds,60,function(m,s){divmod(m,60,function(h,m){hh=h;mm=m;ss=s;});});var s=_.str.sprintf("%d:%02d:%02d",hh,mm,ss);if(this.days){s=_.str.sprintf("%d day%s, %s",this.days,(this.days!=1&&this.days!=-1)?'s':'',s);}
if(this.microseconds){s=_.str.sprintf("%s.%06d",s,this.microseconds);}
return py.str.fromJSON(s);},__eq__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.False;}
return(this.days===other.days&&this.seconds===other.seconds&&this.microseconds===other.microseconds)?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days+other.days),py.float.fromJSON(this.seconds+other.seconds),py.float.fromJSON(this.microseconds+other.microseconds)]);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days-other.days),py.float.fromJSON(this.seconds-other.seconds),py.float.fromJSON(this.microseconds-other.microseconds)]);},__rsub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return this.__neg__().__add__(other);},__neg__:function(){return py.PY_call(datetime.timedelta,[py.float.fromJSON(-this.days),py.float.fromJSON(-this.seconds),py.float.fromJSON(-this.microseconds)]);},__pos__:function(){return this;},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var n=other.toJSON();return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days*n),py.float.fromJSON(this.seconds*n),py.float.fromJSON(this.microseconds*n)]);},__rmul__:function(other){return this.__mul__(other);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var usec=((this.days*24*3600)+this.seconds)*1000000
+this.microseconds;return py.PY_call(datetime.timedelta,[zero,zero,py.float.fromJSON(usec/other.toJSON())]);},__floordiv__:function(other){return this.__div__(other);},total_seconds:function(){return py.float.fromJSON(this.days*86400
+this.seconds
+this.microseconds/1000000);},__nonzero__:function(){return(!!this.days||!!this.seconds||!!this.microseconds)?py.True:py.False;}});datetime.datetime=py.type('datetime',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,['year','month','day',['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var key in args){if(!args.hasOwnProperty(key)){continue;}
this[key]=asJS(args[key]);}},__eq__:function(other){return(this.year===other.year&&this.month===other.month&&this.day===other.day&&this.hour===other.hour&&this.minute===other.minute&&this.second===other.second&&this.microsecond===other.microsecond&&this.tzinfo===other.tzinfo)?py.True:py.False;},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None],['hour',py.None],['minute',py.None],['second',py.None],['microsecond',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.datetime,params);},start_of:function(){var args=py.PY_parseArgs(arguments,'granularity');var granularity=args.granularity.toJSON();if(granularity==='year'){return py.PY_call(datetime.datetime,[this.year,1,1]);}else if(granularity==='quarter'){var quarter=get_quarter(this.year,this.month)[0];return py.PY_call(datetime.datetime,[quarter.year,quarter.month,quarter.day]);}else if(granularity==='month'){return py.PY_call(datetime.datetime,[this.year,this.month,1]);}else if(granularity==='week'){var dow=get_day_of_week(this.year,this.month,this.day);return py.PY_call(datetime.datetime,[this.year,this.month,this.day-dow]);}else if(granularity==='day'){return py.PY_call(datetime.datetime,[this.year,this.month,this.day]);}else if(granularity==='hour'){return py.PY_call(datetime.datetime,[this.year,this.month,this.day,this.hour]);}else{throw new Error('ValueError: '+granularity+' is not a supported granularity, supported '+' granularities are: year, quarter, month, week, day and hour.')}},end_of:function(){var args=py.PY_parseArgs(arguments,'granularity');var granularity=args.granularity.toJSON();var min=[23,59,59];if(granularity==='year'){return py.PY_call(datetime.datetime,[this.year,12,31].concat(min));}else if(granularity==='quarter'){var quarter=get_quarter(this.year,this.month)[1];return py.PY_call(datetime.datetime,[quarter.year,quarter.month,quarter.day].concat(min));}else if(granularity==='month'){var dom=days_in_month(this.year,this.month);return py.PY_call(datetime.datetime,[this.year,this.month,dom].concat(min));}else if(granularity==='week'){var dow=get_day_of_week(this.year,this.month,this.day);return py.PY_call(datetime.datetime,[this.year,this.month,this.day+(6-dow)].concat(min));}else if(granularity==='day'){return py.PY_call(datetime.datetime,[this.year,this.month,this.day].concat(min));}else if(granularity==='hour'){return py.PY_call(datetime.datetime,[this.year,this.month,this.day,this.hour,59,59]);}else{throw new Error('ValueError: '+granularity+' is not a supported granularity, supported '+' granularities are: year, quarter, month, week, day and hour.')}},add:function(){var args=py.PY_parseArgs(arguments,[['years',py.None],['months',py.None],['days',py.None],['hours',py.None],['minutes',py.None],['seconds',py.None],]);return py.PY_add(this,py.PY_call(relativedelta,{'years':args.years,'months':args.months,'days':args.days,'hours':args.hours,'minutes':args.minutes,'seconds':args.seconds,}));},subtract:function(){var args=py.PY_parseArgs(arguments,[['years',py.None],['months',py.None],['days',py.None],['hours',py.None],['minutes',py.None],['seconds',py.None],]);var params={};for(var key in args){params[key]=(args[key]===py.None?args[key]:py.float.fromJSON(-asJS(args[key])));}
return py.PY_add(this,py.PY_call(relativedelta,params));},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return _.str.sprintf('%04d',self.year);case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);case'H':return _.str.sprintf('%02d',self.hour);case'M':return _.str.sprintf('%02d',self.minute);case'S':return _.str.sprintf('%02d',self.second);}
throw new Error('ValueError: No known conversion for '+m);}));},to_utc:function(){var d=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);var offset=d.getTimezoneOffset();var kwargs={minutes:py.float.fromJSON(offset)};var timedelta=py.PY_call(py.extras.datetime.timedelta,[],kwargs);var s=tmxxx(this.year,this.month,this.day+timedelta.days,this.hour,this.minute,this.second+timedelta.seconds);return datetime.datetime.fromJSON(s.year,s.month,s.day,s.hour,s.minute,s.second);},now:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getFullYear(),d.getMonth()+1,d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds()*1000]);}),today:py.classmethod.fromJSON(function(){var dt_class=py.PY_getAttr(datetime,'datetime');return py.PY_call(py.PY_getAttr(dt_class,'now'));}),utcnow:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getUTCFullYear(),d.getUTCMonth()+1,d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()*1000]);}),combine:py.classmethod.fromJSON(function(){var args=py.PY_parseArgs(arguments,'date time');return py.PY_call(datetime.datetime,[py.PY_getAttr(args.date,'year'),py.PY_getAttr(args.date,'month'),py.PY_getAttr(args.date,'day'),py.PY_getAttr(args.time,'hour'),py.PY_getAttr(args.time,'minute'),py.PY_getAttr(args.time,'second')]);}),toJSON:function(){return new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.microsecond/1000);},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
var s=tmxxx(this.year,this.month,this.day+other.days,this.hour,this.minute,this.second+other.seconds);return datetime.datetime.fromJSON(s.year,s.month,s.day,s.hour,s.minute,s.second);},__sub__:function(other){if(py.PY_isInstance(other,datetime.timedelta)){return py.PY_add(this,py.PY_negative(other));}
return py.NotImplemented;},fromJSON:function(year,month,day,hour,minute,second){return py.PY_call(datetime.datetime,[year,month,day,hour,minute,second]);},});datetime.date=py.type('date',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'year month day');this.year=asJS(args.year);this.month=asJS(args.month);this.day=asJS(args.day);},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return self.year;case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);}
throw new Error('ValueError: No known conversion for '+m);}));},__eq__:function(other){return(this.year===other.year&&this.month===other.month&&this.day===other.day)?py.True:py.False;},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.date,params);},start_of:function(){var args=py.PY_parseArgs(arguments,'granularity');var granularity=args.granularity.toJSON();if(granularity==='year'){return py.PY_call(datetime.date,[this.year,1,1]);}else if(granularity==='quarter'){var quarter=get_quarter(this.year,this.month)[0];return py.PY_call(datetime.date,[quarter.year,quarter.month,quarter.day]);}else if(granularity==='month'){return py.PY_call(datetime.date,[this.year,this.month,1]);}else if(granularity==='week'){var dow=get_day_of_week(this.year,this.month,this.day);return py.PY_call(datetime.date,[this.year,this.month,this.day-dow]);}else if(granularity==='day'){return py.PY_call(datetime.date,[this.year,this.month,this.day]);}else{throw new Error('ValueError: '+granularity+' is not a supported granularity, supported '+' granularities are: year, quarter, month, week and day.')}},end_of:function(){var args=py.PY_parseArgs(arguments,'granularity');var granularity=args.granularity.toJSON();if(granularity==='year'){return py.PY_call(datetime.date,[this.year,12,31]);}else if(granularity==='quarter'){var quarter=get_quarter(this.year,this.month)[1];return py.PY_call(datetime.date,[quarter.year,quarter.month,quarter.day]);}else if(granularity==='month'){var dom=days_in_month(this.year,this.month);return py.PY_call(datetime.date,[this.year,this.month,dom]);}else if(granularity==='week'){var dow=get_day_of_week(this.year,this.month,this.day);return py.PY_call(datetime.date,[this.year,this.month,this.day+(6-dow)]);}else if(granularity==='day'){return py.PY_call(datetime.date,[this.year,this.month,this.day]);}else{throw new Error('ValueError: '+granularity+' is not a supported granularity, supported '+' granularities are: year, quarter, month, week and day.')}},add:function(){var args=py.PY_parseArgs(arguments,[['years',py.None],['months',py.None],['days',py.None],]);return py.PY_add(this,py.PY_call(relativedelta,{'years':args.years,'months':args.months,'days':args.days,}));},subtract:function(){var args=py.PY_parseArgs(arguments,[['years',py.None],['months',py.None],['days',py.None],]);var params={};for(var key in args){params[key]=(args[key]===py.None?args[key]:py.float.fromJSON(-asJS(args[key])));}
return py.PY_add(this,py.PY_call(relativedelta,params));},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
var s=tmxxx(this.year,this.month,this.day+other.days);return datetime.date.fromJSON(s.year,s.month,s.day);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(py.PY_isInstance(other,datetime.timedelta)){return py.PY_add(this,py.PY_negative(other));}
if(py.PY_isInstance(other,datetime.date)){return py.PY_call(datetime.timedelta,[py.PY_subtract(py.PY_call(py.PY_getAttr(this,'toordinal')),py.PY_call(py.PY_getAttr(other,'toordinal')))]);}
return py.NotImplemented;},toordinal:function(){return py.float.fromJSON(ymd2ord(this.year,this.month,this.day));},weekday:function(){return py.float.fromJSON((this.toordinal().toJSON()+6)%7);},fromJSON:function(year,month,day){return py.PY_call(datetime.date,[year,month,day]);},today:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);}),});datetime.time=py.type('time',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,[['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var k in args){if(!args.hasOwnProperty(k)){continue;}
this[k]=asJS(args[k]);}}});var time=py.PY_call(py.object);time.strftime=py.PY_def.fromJSON(function(){var args=py.PY_parseArgs(arguments,'format');var dt_class=py.PY_getAttr(datetime,'datetime');var d=py.PY_call(py.PY_getAttr(dt_class,'utcnow'));return py.PY_call(py.PY_getAttr(d,'strftime'),[args.format]);});var args=_.map(('year month day hour minute second '
+'years months weeks days hours minutes seconds '
+'weekday leapdays yearday nlyearday').split(' '),function(arg){switch(arg){case'years':case'months':case'days':case'leapdays':case'weeks':case'hours':case'minutes':case'seconds':return[arg,zero];case'year':case'month':case'day':case'weekday':case'hour':case'minute':case'second':case'yearday':case'nlyearday':return[arg,null];default:throw new Error("Unknown relativedelta argument "+arg);}});args.unshift('*');var _utils={monthrange:function(year,month){if(month<1||month>12){throw new Error("Illegal month "+month);}
var day1=this.weekday(year,month,1);var ndays=this.mdays[month]+(month==this.February&&this.isleap(year));return[day1,ndays];},weekday:function(year,month,day){var date=py.PY_call(datetime.date,[year,month,day]);return py.PY_call(py.PY_getAttr(date,'weekday'));},isleap:function(year){return year%4===0&&(year%100!==0||year%400===0);},mdays:[0,31,28,31,30,31,30,31,31,30,31,30,31],January:1,February:2};var relativedelta=py.type('relativedelta',null,{__init__:function(){this.ops=py.PY_parseArgs(arguments,args);this.ops.days=py.float.fromJSON(asJS(this.ops.days)+asJS(this.ops.weeks)*7);var yday=zero;if(this.ops.nlyearday){yday=this.ops.nlyearday;}else if(this.ops.yearday){yday=this.ops.yearday;if(asJS(this.ops.yearday)>59){this.ops.leapdays=py.float.fromJS(-1);}}
if(py.PY_isTrue(yday)){var ydayidx=[31,59,90,120,151,181,212,243,273,304,334,366];for(var idx=0;idx<ydayidx.length;++idx){var ydays=ydayidx[idx];if(asJS(yday)<=ydays){this.ops.month=py.float.fromJSON(idx+1);if(!idx){this.ops.day=yday;}else{this.ops.day=py.PY_subtract(yday,py.float.fromJSON(ydayidx[idx-1]));}
break;}}
if(idx===ydayidx.length){throw new Error("Invalid year day ("+asJS(yday)+")");}}
this._fix();},_fix:function(){var self=this;var months=asJS(this.ops.months);if(Math.abs(months)>11){var s=months>0?1:-1;divmod(months*s,12,function(years,months){self.ops.months=py.float.fromJSON(months*s);self.ops.years=py.float.fromJSON(asJS(self.ops.years)+years*s);});}
this._has_time=0;},__add__:function(other){if(!(py.PY_isInstance(other,datetime.date)||py.PY_isInstance(other,datetime.datetime))){return py.NotImplemented;}
var year=(asJS(this.ops.year)||asJS(other.year))+asJS(this.ops.years);var month=asJS(this.ops.month)||asJS(other.month);var months;if(months=asJS(this.ops.months)){if(Math.abs(months)<1||Math.abs(months)>12){throw new Error("Can only use relative months between -12 and +12");}
month+=months;if(month>12){year+=1;month-=12;}
if(month<1){year-=1;month+=12;}}
var day=Math.min(_utils.monthrange(year,month)[1],asJS(this.ops.day)||asJS(other.day));var repl={year:py.float.fromJSON(year),month:py.float.fromJSON(month),day:py.float.fromJSON(day)};if(py.PY_isInstance(other,datetime.datetime)){repl.hour=py.float.fromJSON(asJS(this.ops.hour)||asJS(other.hour));repl.minute=py.float.fromJSON(asJS(this.ops.minute)||asJS(other.minute));repl.second=py.float.fromJSON(asJS(this.ops.second)||asJS(other.second));}
var days=asJS(this.ops.days);if(py.PY_isTrue(this.ops.leapdays)&&month>2&&_utils.isleap(year)){days+=asJS(this.ops.leapdays);}
var ret=py.PY_add(py.PY_call(py.PY_getAttr(other,'replace'),repl),py.PY_call(datetime.timedelta,{days:py.float.fromJSON(days),hours:py.float.fromJSON(asJS(this.ops.hours)),minutes:py.float.fromJSON(asJS(this.ops.minutes)),seconds:py.float.fromJSON(asJS(this.ops.seconds))}));if(this.ops.weekday){var weekday=asJS(this.ops.weekday),nth=1;var jumpdays=(Math.abs(nth)-1)*7;var ret_weekday=asJS(py.PY_call(py.PY_getAttr(ret,'weekday')));if(nth>0){jumpdays+=(7-ret_weekday+weekday)%7;}else{jumpdays+=(ret_weekday-weekday)%7;jumpdays*=-1;}
ret=py.PY_add(ret,py.PY_call(datetime.timedelta,{days:py.float.fromJSON(jumpdays)}));}
return ret;},__radd__:function(other){return this.__add__(other);},__rsub__:function(other){return this.__neg__().__radd__(other);},__neg__:function(){return py.PY_call(relativedelta,{years:py.PY_negative(this.ops.years),months:py.PY_negative(this.ops.months),days:py.PY_negative(this.ops.days),leapdays:this.ops.leapdays,hours:py.PY_negative(this.ops.hours),minutes:py.PY_negative(this.ops.minutes),seconds:py.PY_negative(this.ops.seconds),year:this.ops.year,month:this.ops.month,day:this.ops.day,weekday:this.ops.weekday,hour:this.ops.hour,minute:this.ops.minute,second:this.ops.second});}});py.extras={datetime:datetime,time:time,relativedelta:relativedelta,};})(typeof exports==='undefined'?py:exports);;

/* /web/static/lib/jquery.ba-bbq/jquery.ba-bbq.js defined in bundle 'web.assets_backend' */
(function($,window){'$:nomunge';var undefined,aps=Array.prototype.slice,decode=decodeURIComponent,jq_param=$.param,jq_param_sorted,jq_param_fragment,jq_deparam,jq_deparam_fragment,jq_bbq=$.bbq=$.bbq||{},jq_bbq_pushState,jq_bbq_getState,jq_elemUrlAttr,special=$.event.special,str_hashchange='hashchange',str_querystring='querystring',str_fragment='fragment',str_elemUrlAttr='elemUrlAttr',str_href='href',str_src='src',re_params_querystring=/^.*\?|#.*$/g,re_params_fragment,re_fragment,re_no_escape,ajax_crawlable,fragment_prefix,elemUrlAttr_cache={};function is_string(arg){return typeof arg==='string';};function curry(func){var args=aps.call(arguments,1);return function(){return func.apply(this,args.concat(aps.call(arguments)));};};function get_fragment(url){return url.replace(re_fragment,'$2');};function get_querystring(url){return url.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,'$1');};function jq_param_sub(is_fragment,get_func,url,params,merge_mode){var result,qs,matches,url_params,hash;if(params!==undefined){matches=url.match(is_fragment?re_fragment:/^([^#?]*)\??([^#]*)(#?.*)/);hash=matches[3]||'';if(merge_mode===2&&is_string(params)){qs=params.replace(is_fragment?re_params_fragment:re_params_querystring,'');}else{url_params=jq_deparam(matches[2]);params=is_string(params)?jq_deparam[is_fragment?str_fragment:str_querystring](params):params;qs=merge_mode===2?params:merge_mode===1?$.extend({},params,url_params):$.extend({},url_params,params);qs=jq_param_sorted(qs);if(is_fragment){qs=qs.replace(re_no_escape,decode);}}
result=matches[1]+(is_fragment?fragment_prefix:qs||!matches[1]?'?':'')+qs+hash;}else{result=get_func(url!==undefined?url:location.href);}
return result;};jq_param[str_querystring]=curry(jq_param_sub,0,get_querystring);jq_param[str_fragment]=jq_param_fragment=curry(jq_param_sub,1,get_fragment);jq_param.sorted=jq_param_sorted=function(a,traditional){var arr=[],obj={};$.each(jq_param(a,traditional).split('&'),function(i,v){var key=v.replace(/(?:%5B|=).*$/,''),key_obj=obj[key];if(!key_obj){key_obj=obj[key]=[];arr.push(key);}
key_obj.push(v);});return $.map(arr.sort(),function(v){return obj[v];}).join('&');};jq_param_fragment.noEscape=function(chars){chars=chars||'';var arr=$.map(chars.split(''),encodeURIComponent);re_no_escape=new RegExp(arr.join('|'),'g');};jq_param_fragment.noEscape(',/');jq_param_fragment.ajaxCrawlable=function(state){if(state!==undefined){if(state){re_params_fragment=/^.*(?:#!|#)/;re_fragment=/^([^#]*)(?:#!|#)?(.*)$/;fragment_prefix='#!';}else{re_params_fragment=/^.*#/;re_fragment=/^([^#]*)#?(.*)$/;fragment_prefix='#';}
ajax_crawlable=!!state;}
return ajax_crawlable;};jq_param_fragment.ajaxCrawlable(0);$.deparam=jq_deparam=function(params,coerce){var obj={},coerce_types={'true':!0,'false':!1,'null':null};$.each(params.replace(/\+/g,' ').split('&'),function(j,v){var param=v.split('='),key=decode(param[0]),val,cur=obj,i=0,keys=key.split(']['),keys_last=keys.length-1;if(/\[/.test(keys[0])&&/\]$/.test(keys[keys_last])){keys[keys_last]=keys[keys_last].replace(/\]$/,'');keys=keys.shift().split('[').concat(keys);keys_last=keys.length-1;}else{keys_last=0;}
if(param.length===2){val=decode(param[1]);if(coerce){val=val&&!isNaN(val)?+val:val==='undefined'?undefined:coerce_types[val]!==undefined?coerce_types[val]:val;}
if(keys_last){for(;i<=keys_last;i++){key=keys[i]===''?cur.length:keys[i];cur=cur[key]=i<keys_last?cur[key]||(keys[i+1]&&isNaN(keys[i+1])?{}:[]):val;}}else{if($.isArray(obj[key])){obj[key].push(val);}else if(obj[key]!==undefined){obj[key]=[obj[key],val];}else{obj[key]=val;}}}else if(key){obj[key]=coerce?undefined:'';}});return obj;};function jq_deparam_sub(is_fragment,url_or_params,coerce){if(url_or_params===undefined||typeof url_or_params==='boolean'){coerce=url_or_params;url_or_params=jq_param[is_fragment?str_fragment:str_querystring]();}else{url_or_params=is_string(url_or_params)?url_or_params.replace(is_fragment?re_params_fragment:re_params_querystring,''):url_or_params;}
return jq_deparam(url_or_params,coerce);};jq_deparam[str_querystring]=curry(jq_deparam_sub,0);jq_deparam[str_fragment]=jq_deparam_fragment=curry(jq_deparam_sub,1);$[str_elemUrlAttr]||($[str_elemUrlAttr]=function(obj){return $.extend(elemUrlAttr_cache,obj);})({a:str_href,base:str_href,iframe:str_src,img:str_src,input:str_src,form:'action',link:str_href,script:str_src});jq_elemUrlAttr=$[str_elemUrlAttr];function jq_fn_sub(mode,force_attr,params,merge_mode){if(!is_string(params)&&typeof params!=='object'){merge_mode=params;params=force_attr;force_attr=undefined;}
return this.each(function(){var that=$(this),attr=force_attr||jq_elemUrlAttr()[(this.nodeName||'').toLowerCase()]||'',url=attr&&that.attr(attr)||'';that.attr(attr,jq_param[mode](url,params,merge_mode));});};$.fn[str_querystring]=curry(jq_fn_sub,str_querystring);$.fn[str_fragment]=curry(jq_fn_sub,str_fragment);jq_bbq.pushState=jq_bbq_pushState=function(params,merge_mode){if(is_string(params)&&/^#/.test(params)&&merge_mode===undefined){merge_mode=2;}
var has_args=params!==undefined,url=jq_param_fragment(location.href,has_args?params:{},has_args?merge_mode:2);location.href=url;};jq_bbq.getState=jq_bbq_getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam_fragment(key):jq_deparam_fragment(coerce)[key];};jq_bbq.removeState=function(arr){var state={};if(arr!==undefined){state=jq_bbq_getState();$.each($.isArray(arr)?arr:arguments,function(i,v){delete state[v];});}
jq_bbq_pushState(state,2);};special[str_hashchange]=$.extend(special[str_hashchange],{add:function(handleObj){var old_handler;function new_handler(e){var hash=e[str_fragment]=jq_param_fragment();e.getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam(hash,key):jq_deparam(hash,coerce)[key];};old_handler.apply(this,arguments);};if($.isFunction(handleObj)){old_handler=handleObj;return new_handler;}else{old_handler=handleObj.handler;handleObj.handler=new_handler;}}});})(jQuery,this);(function($,window,undefined){'$:nomunge';var str_hashchange='hashchange',doc=document,fake_onhashchange,special=$.event.special,doc_mode=doc.documentMode,supports_onhashchange='on'+str_hashchange in window&&(doc_mode===undefined||doc_mode>7);function get_fragment(url){url=url||location.href;return'#'+url.replace(/^[^#]*#?(.*)$/,'$1');};$.fn[str_hashchange]=function(fn){return fn?this.bind(str_hashchange,fn):this.trigger(str_hashchange);};$.fn[str_hashchange].delay=50;special[str_hashchange]=$.extend(special[str_hashchange],{setup:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.start);},teardown:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.stop);}});fake_onhashchange=(function(){var self={},timeout_id,last_hash=get_fragment(),fn_retval=function(val){return val;},history_set=fn_retval,history_get=fn_retval;self.start=function(){timeout_id||poll();};self.stop=function(){timeout_id&&clearTimeout(timeout_id);timeout_id=undefined;};function poll(){var hash=get_fragment(),history_hash=history_get(last_hash);if(hash!==last_hash){history_set(last_hash=hash,history_hash);$(window).trigger(str_hashchange);}else if(history_hash!==last_hash){location.href=location.href.replace(/#.*/,'')+history_hash;}
timeout_id=setTimeout(poll,$.fn[str_hashchange].delay);};$.browser.msie&&!supports_onhashchange&&(function(){var iframe,iframe_src;self.start=function(){if(!iframe){iframe_src=$.fn[str_hashchange].src;iframe_src=iframe_src&&iframe_src+get_fragment();iframe=$('<iframe tabindex="-1" title="empty"/>').hide().one('load',function(){iframe_src||history_set(get_fragment());poll();}).attr('src',iframe_src||'javascript:0').insertAfter('body')[0].contentWindow;doc.onpropertychange=function(){try{if(event.propertyName==='title'){iframe.document.title=doc.title;}}catch(e){}};}};self.stop=fn_retval;history_get=function(){return get_fragment(iframe.location.href);};history_set=function(hash,history_hash){var iframe_doc=iframe.document,domain=$.fn[str_hashchange].domain;if(hash!==history_hash){iframe_doc.title=doc.title;iframe_doc.open();domain&&iframe_doc.write('<script>document.domain="'+domain+'"</script>');iframe_doc.close();iframe.location.hash=hash;}};})();return self;})();})(jQuery,this);;

/* /web/static/src/js/core/domain.js defined in bundle 'web.assets_backend' */
odoo.define("web.Domain",function(require){"use strict";var collections=require("web.collections");var pyUtils=require("web.py_utils");var py=window.py;var Domain=collections.Tree.extend({init:function(domain,evalContext){this._super.apply(this,arguments);if(_.isArray(domain)||_.isString(domain)){this._parse(this.normalizeArray(_.clone(this.stringToArray(domain,evalContext))));}else{this._data=!!domain;}},compute:function(values){if(this._data===true||this._data===false){return this._data;}else if(_.isArray(this._data)){var isParentField=false;var fieldName=this._data[0];var parentField=this._data[0].split('.');if('parent'in values&&parentField.length===2){fieldName=parentField[1];isParentField=parentField[0]==='parent'&&fieldName in values.parent;}
if(!(this._data[0]in values)&&!(isParentField)){throw new Error(_.str.sprintf("Unknown field %s in domain",this._data[0]));}
var fieldValue;if(!isParentField){fieldValue=values[fieldName];}else{fieldValue=values.parent[fieldName];}
switch(this._data[1]){case"=":case"==":return _.isEqual(fieldValue,this._data[2]);case"!=":case"<>":return!_.isEqual(fieldValue,this._data[2]);case"<":return(fieldValue<this._data[2]);case">":return(fieldValue>this._data[2]);case"<=":return(fieldValue<=this._data[2]);case">=":return(fieldValue>=this._data[2]);case"in":return _.contains(_.isArray(this._data[2])?this._data[2]:[this._data[2]],fieldValue);case"not in":return!_.contains(_.isArray(this._data[2])?this._data[2]:[this._data[2]],fieldValue);case"like":return(fieldValue.toLowerCase().indexOf(this._data[2].toLowerCase())>=0);case"ilike":return(fieldValue.indexOf(this._data[2])>=0);default:throw new Error(_.str.sprintf("Domain %s uses an unsupported operator",this._data));}}else{switch(this._data){case"&":return _.every(this._children,function(child){return child.compute(values);});case"|":return _.some(this._children,function(child){return child.compute(values);});case"!":return!this._children[0].compute(values);}}},toArray:function(){if(this._data===false){throw new Error("'false' domain cannot be converted to array");}else if(this._data===true){return[];}else{var arr=[this._data];return arr.concat.apply(arr,_.map(this._children,function(child){return child.toArray();}));}},toString:function(){return Domain.prototype.arrayToString(this.toArray());},_parse:function(domain){this._data=(domain.length===0?true:domain[0]);if(domain.length<=1)return;var expected=1;for(var i=1;i<domain.length;i++){if(domain[i]==="&"||domain[i]==="|"){expected++;}else if(domain[i]!=="!"){expected--;}
if(!expected){i++;this._addSubdomain(domain.slice(1,i));this._addSubdomain(domain.slice(i));break;}}},_addSubdomain:function(domain){if(!domain.length)return;var subdomain=new Domain(domain);if(!subdomain._children.length||subdomain._data!==this._data){this._children.push(subdomain);}else{var self=this;_.each(subdomain._children,function(childDomain){self._children.push(childDomain);});}},arrayToString:function(domain){if(_.isString(domain))return domain;return JSON.stringify(domain||[]).replace(/null/g,"None").replace(/false/g,"False").replace(/true/g,"True");},constructDomain:function(fieldName,period,type,forTooltip,comparisonPeriod){var leftBoundaryParams,rightBoundaryParams;var offsetPeriodParams;var t=forTooltip||false;function makeInterval(){switch(comparisonPeriod){case'previous_period':_.each(offsetPeriodParams,function(value,key){if(!leftBoundaryParams[key]||_.isNumber(leftBoundaryParams[key])){leftBoundaryParams[key]=value+(leftBoundaryParams[key]||0);}else{leftBoundaryParams[key]=value+' + '+leftBoundaryParams[key];}
if(!rightBoundaryParams[key]||_.isNumber(rightBoundaryParams[key])){rightBoundaryParams[key]=value+(rightBoundaryParams[key]||0);}else{rightBoundaryParams[key]=value+' + '+rightBoundaryParams[key];}});break;case'previous_year':leftBoundaryParams.years=leftBoundaryParams.years?leftBoundaryParams.years-1:-1;rightBoundaryParams.years=rightBoundaryParams.years?rightBoundaryParams.years-1:-1;break;}
var stringifyParams=function(value,key){return key+'='+value;};var leftBoundaryStringifyParams=_.map(leftBoundaryParams,stringifyParams).join(', ');var rightBoundaryStringifyParams=_.map(rightBoundaryParams,stringifyParams).join(', ');if(type==='date'){return"['&',"+"('"+fieldName+"', '>=', (context_today() + relativedelta("+leftBoundaryStringifyParams+")).strftime('%Y-%m-%d')),"+"('"+fieldName+"', '<', (context_today() + relativedelta("+rightBoundaryStringifyParams+")).strftime('%Y-%m-%d'))"+"]";}
else{return"['&',"+"('"+fieldName+"', '>=', "+"(datetime.datetime.combine(context_today() + relativedelta("+leftBoundaryStringifyParams+"), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d %H:%M:%S')),"+"('"+fieldName+"', '<', "+"(datetime.datetime.combine(context_today() + relativedelta("+rightBoundaryStringifyParams+"), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d %H:%M:%S'))"+"]";}}
switch(period){case'today':leftBoundaryParams={};rightBoundaryParams=t?{}:{days:1};offsetPeriodParams={days:-1};return makeInterval();case'this_week':leftBoundaryParams={weeks:-1,days:1,weekday:0};rightBoundaryParams=t?{weekday:6}:{days:1,weekday:0};offsetPeriodParams={weeks:-1};return makeInterval();case'this_month':leftBoundaryParams={day:1};rightBoundaryParams=_.extend(t?{days:-1}:{},{day:1,months:1});offsetPeriodParams={months:-1};return makeInterval();case'this_quarter':leftBoundaryParams={months:'- (context_today().month - 1) % 3',day:1};rightBoundaryParams=_.extend(t?{days:-1}:{},{months:'3 - (context_today().month - 1) % 3',day:1});offsetPeriodParams={months:-3};return makeInterval();case'this_year':leftBoundaryParams={month:1,day:1};rightBoundaryParams=_.extend(t?{days:-1}:{},{month:1,day:1,years:1});offsetPeriodParams={years:-1};return makeInterval();case'yesterday':leftBoundaryParams={days:-1};rightBoundaryParams=(t?{days:-1}:{});offsetPeriodParams={days:-1};return makeInterval();case'last_week':leftBoundaryParams={weeks:-2,days:1,weekday:0};rightBoundaryParams=t?{weeks:-1,weekday:6}:{weeks:-1,days:1,weekday:0};offsetPeriodParams={weeks:-1};return makeInterval();case'last_month':leftBoundaryParams={months:-1,day:1};rightBoundaryParams=_.extend(t?{days:-1}:{},{day:1});offsetPeriodParams={months:-1};return makeInterval();case'last_quarter':leftBoundaryParams={months:'- 3 - (context_today().month - 1) % 3',day:1};rightBoundaryParams=_.extend(t?{days:-1}:{},{months:'- (context_today().month - 1) % 3',day:1});offsetPeriodParams={months:-3};return makeInterval();case'last_year':leftBoundaryParams={month:1,day:1,years:-1};rightBoundaryParams=_.extend(t?{days:-1}:{},{month:1,day:1});offsetPeriodParams={years:-1};return makeInterval();case'last_7_days':leftBoundaryParams={days:-7};rightBoundaryParams=t?{days:-1}:{};offsetPeriodParams={days:-7};return makeInterval();case'last_30_days':leftBoundaryParams={days:-30};rightBoundaryParams=t?{days:-1}:{};offsetPeriodParams={days:-30};return makeInterval();case'last_365_days':leftBoundaryParams={days:-365};rightBoundaryParams=t?{days:-1}:{};offsetPeriodParams={days:-365};return makeInterval();}},stringToArray:function(domain,evalContext){if(!_.isString(domain))return _.clone(domain);return pyUtils.eval("domain",domain?domain.replace(/%%/g,'%'):"[]",evalContext);},normalizeArray:function(domain){var expected=1;_.each(domain,function(item){if(item==="&"||item==="|"){expected++;}else if(item!=="!"){expected--;}});if(expected<0){domain.unshift.apply(domain,_.times(Math.abs(expected),_.constant("&")));}
return domain;},domainToCondition:function(domain){if(!domain.length){return'True';}
var self=this;function consume(stack){var len=stack.length;if(len<=1){return stack;}else if(stack[len-1]==='|'||stack[len-1]==='&'||stack[len-2]==='|'||stack[len-2]==='&'){return stack;}else if(len==2){stack.splice(-2,2,stack[len-2]+' and '+stack[len-1]);}else if(stack[len-3]=='|'){if(len===3){stack.splice(-3,3,stack[len-2]+' or '+stack[len-1]);}else{stack.splice(-3,3,'('+stack[len-2]+' or '+stack[len-1]+')');}}else{stack.splice(-3,3,stack[len-2]+' and '+stack[len-1]);}
consume(stack);}
var stack=[];_.each(domain,function(dom){if(dom==='|'||dom==='&'){stack.push(dom);}else{var operator=dom[1]==='='?'==':dom[1];if(!operator){throw new Error('Wrong operator for this domain');}
if(operator==='!='&&dom[2]===false){stack.push(dom[0]);}else if(dom[2]===null||dom[2]===true||dom[2]===false){stack.push(dom[0]+' '+(operator==='!='?'is not ':'is ')+(dom[2]===null?'None':(dom[2]?'True':'False')));}else{stack.push(dom[0]+' '+operator+' '+JSON.stringify(dom[2]));}
consume(stack);}});if(stack.length!==1){throw new Error('Wrong domain');}
return stack[0];},conditionToDomain:function(condition){if(!condition||condition.match(/^\s*(True)?\s*$/)){return[];}
var ast=py.parse(py.tokenize(condition));function astToStackValue(node){switch(node.id){case'(name)':return node.value;case'.':return astToStackValue(node.first)+'.'+astToStackValue(node.second);case'(string)':return node.value;case'(number)':return node.value;case'(constant)':return node.value==='None'?null:node.value==='True'?true:false;case'[':return _.map(node.first,function(node){return astToStackValue(node);});}}
function astToStack(node){switch(node.id){case'(name)':return[[astToStackValue(node),'!=',false]];case'.':return[[astToStackValue(node.first)+'.'+astToStackValue(node.second),'!=',false]];case'not':return[[astToStackValue(node.first),'=',false]];case'or':return['|'].concat(astToStack(node.first)).concat(astToStack(node.second));case'and':return['&'].concat(astToStack(node.first)).concat(astToStack(node.second));case'(comparator)':if(node.operators.length!==1){throw new Error('Wrong condition to convert in domain');}
var right=astToStackValue(node.expressions[0]);var left=astToStackValue(node.expressions[1]);var operator=node.operators[0];switch(operator){case'is':operator='=';break;case'is not':operator='!=';break;case'==':operator='=';break;}
return[[right,operator,left]];default:throw"Condition cannot be transformed into domain";}}
return astToStack(ast);},});return Domain;});;

/* /web/static/src/js/core/py_utils.js defined in bundle 'web.assets_backend' */
odoo.define('web.py_utils',function(require){"use strict";var core=require('web.core');var _t=core._t;var py=window.py;function wrap(value){if(value===null){return py.None;}
switch(typeof value){case'undefined':throw new Error("No conversion for undefined");case'boolean':return py.bool.fromJSON(value);case'number':return py.float.fromJSON(value);case'string':return py.str.fromJSON(value);}
switch(value.constructor){case Object:return wrapping_dict.fromJSON(value);case Array:return wrapping_list.fromJSON(value);}
throw new Error("ValueError: unable to wrap "+value);}
var wrapping_dict=py.type('wrapping_dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var k=key.toJSON();if(!(k in this._store)){throw new Error("KeyError: '"+k+"'");}
return wrap(this._store[k]);},__getattr__:function(key){return this.__getitem__(py.str.fromJSON(key));},__len__:function(){return Object.keys(this._store).length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);if(!(args.k.toJSON()in this._store)){return args.d;}
return this.__getitem__(args.k);},fromJSON:function(d){var instance=py.PY_call(wrapping_dict);instance._store=d;return instance;},toJSON:function(){return this._store;},});var wrapping_list=py.type('wrapping_list',null,{__init__:function(){this._store=[];},__getitem__:function(index){return wrap(this._store[index.toJSON()]);},__len__:function(){return this._store.length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},fromJSON:function(ar){var instance=py.PY_call(wrapping_list);instance._store=ar;return instance;},toJSON:function(){return this._store;},});function wrap_context(context){for(var k in context){if(!context.hasOwnProperty(k)){continue;}
var val=context[k];if(val===null){continue;}
if(val.constructor===Array){context[k]=wrapping_list.fromJSON(val);}else if(val.constructor===Object&&!py.PY_isInstance(val,py.object)){context[k]=wrapping_dict.fromJSON(val);}}
return context;}
function eval_contexts(contexts,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});return _(contexts).reduce(function(result_context,ctx){if(_.isEmpty(ctx)){return result_context;}
if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
_.extend(evaluation_context,evaluated);return _.extend(result_context,evaluated);},{});}
function eval_domains(domains,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});var result_domain=[];var need_normalization=(domains&&domains.length>0&&domains[0].length===1&&(domains[0][0]==="|"||domains[0][0]==="!"));_(domains).each(function(domain){if(_.isString(domain)){domain={__ref:'domain',__debug:domain};}
var domain_array_to_combine;switch(domain.__ref){case'domain':evaluation_context.context=evaluation_context;domain_array_to_combine=py.eval(domain.__debug,wrap_context(evaluation_context));break;default:domain_array_to_combine=domain;}
if(need_normalization){domain_array_to_combine=get_normalized_domain(domain_array_to_combine);}
result_domain.push.apply(result_domain,domain_array_to_combine);});return result_domain;}
function get_normalized_domain(domain_array){var expected=1;_.each(domain_array,function(item){if(item==="&"||item==="|"){expected++;}else if(item!=="!"){expected--;}});var new_explicit_ands=_.times(-expected,_.constant("&"));return new_explicit_ands.concat(domain_array);}
function eval_groupbys(contexts,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});var result_group=[];_(contexts).each(function(ctx){if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var group;var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
group=evaluated.group_by;if(!group){return;}
if(typeof group==='string'){result_group.push(group);}else if(group instanceof Array){result_group.push.apply(result_group,group);}else{throw new Error('Got invalid groupby {{'
+JSON.stringify(group)+'}}');}
_.extend(evaluation_context,evaluated);});return result_group;}
function context_today(){var d=new Date();return py.PY_call(py.extras.datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);}
function tz_offset(){var offset=new Date().getTimezoneOffset();var kwargs={minutes:py.float.fromJSON(offset)};return py.PY_call(py.extras.datetime.timedelta,[],kwargs);}
function pycontext(){return{datetime:py.extras.datetime,context_today:context_today,time:py.extras.time,relativedelta:py.extras.relativedelta,current_date:py.PY_call(py.extras.time.strftime,[py.str.fromJSON('%Y-%m-%d')]),tz_offset:tz_offset,};}
function pyeval(type,object,context){context=_.extend(pycontext(),context||{});switch(type){case'context':case'contexts':if(type==='context'){object=[object];}
return eval_contexts(object,context);case'domain':case'domains':if(type==='domain')
object=[object];return eval_domains(object,context);case'groupbys':return eval_groupbys(object,context);}
throw new Error("Unknow evaluation type "+type);}
function eval_arg(arg){if(typeof arg!=='object'||!arg.__ref){return arg;}
switch(arg.__ref){case'domain':return pyeval('domains',[arg]);case'context':case'compound_context':return pyeval('contexts',[arg]);default:throw new Error(_t("Unknown nonliteral type ")+' '+arg.__ref);}}
function ensure_evaluated(args,kwargs){for(var i=0;i<args.length;++i){args[i]=eval_arg(args[i]);}
for(var k in kwargs){if(!kwargs.hasOwnProperty(k)){continue;}
kwargs[k]=eval_arg(kwargs[k]);}}
function eval_domains_and_contexts(source){return{context:pyeval('contexts',source.contexts||[],source.eval_context),domain:pyeval('domains',source.domains,source.eval_context),group_by:pyeval('groupbys',source.group_by_seq||[],source.eval_context),};}
function py_eval(expr,context){return py.eval(expr,_.extend({},context||{},{"true":true,"false":false,"null":null}));}
function assembleDomains(domains,operator){var ASTs=domains.map(_getPyJSAST);if(operator==="OR"){operator=py.tokenize("'|'")[0];}else{operator=py.tokenize("'&'")[0];}
var result=_getPyJSAST("[]");var normalizedDomains=ASTs.filter(function(AST){return AST.first.length>0;}).map(_normalizeDomainAST);if(normalizedDomains.length>0){result.first=normalizedDomains.reduce(function(acc,ast){return acc.concat(ast.first);},_.times(normalizedDomains.length-1,_.constant(operator)));}
return _formatAST(result);}
function normalizeDomain(domain){return _formatAST(_normalizeDomainAST(_getPyJSAST(domain)));}
var BINDING_POWERS={or:30,and:40,not:50,};function _formatAST(ast,lbp){lbp=lbp||0;switch(ast.id){case"(number)":return String(ast.value);case"(string)":return JSON.stringify(ast.value.replace(/(\\(['"\\]))/g,"\$2"));case"(constant)":return ast.value;case"(name)":return ast.value;case"[":if(ast.second){return _formatAST(ast.first)+'['+_formatAST(ast.second)+']';}else{var values=ast.first.map(_formatAST);return'['+values.join(', ')+']';}
case"{":var keyValues=ast.first.map(function(kv){return _formatAST(kv[0])+': '+_formatAST(kv[1]);});return'{'+keyValues.join(', ')+'}';case"=":return _formatAST(ast.first)+' '+ast.id+' '+_formatAST(ast.second);case"-":case"+":case"~":case"*":case"**":case"%":case"//":case"and":case"or":if(ast.second){var r=_formatAST(ast.first,ast.lbp)+' '+ast.id+' '+_formatAST(ast.second,ast.lbp);if(ast.lbp<lbp){r='('+r+')';}
return r;}
var actualBP=BINDING_POWERS[ast.id]||130;return ast.id+_formatAST(ast.first,actualBP);case".":return _formatAST(ast.first,ast.lbp)+'.'+_formatAST(ast.second);case"not":return"not "+_formatAST(ast.first);case"(comparator)":var operator=ast.operators[0];return _formatAST(ast.expressions[0])+' '+operator+' '+_formatAST(ast.expressions[1]);case"(":if(ast.second){return _formatAST(ast.first)+'('+ast.second.map(_formatAST).join(', ')+')';}else{return'('+ast.first.map(_formatAST).join(', ')+')';}}
throw new Error("Unimplemented python construct");}
function _getPyJSAST(domain){return py.parse(py.tokenize(domain));}
function _normalizeDomainAST(domain){var expected=1;for(var i=0;i<domain.first.length;i++){var value=domain.first[i].value;if(value==='&'||value==='|'){expected++;}else if(value!=='!'){expected--;}}
var andOperator=py.tokenize("'&'")[0];if(expected<0){domain.first.unshift.apply(domain.first,_.times(Math.abs(expected),_.constant(andOperator)));}
return domain;}
return{context:pycontext,ensure_evaluated:ensure_evaluated,eval:pyeval,eval_domains_and_contexts:eval_domains_and_contexts,py_eval:py_eval,normalizeDomain:normalizeDomain,assembleDomains:assembleDomains,_getPyJSAST:_getPyJSAST,_formatAST:_formatAST,_normalizeDomainAST:_normalizeDomainAST,};});;

/* /web/static/src/js/chrome/abstract_action.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractAction',function(require){"use strict";var Widget=require('web.Widget');var AbstractAction=Widget.extend({on_attach_callback:function(){},on_detach_callback:function(){},willRestore:function(){},canBeRemoved:function(){return $.when();},getContext:function(){},giveFocus:function(){},renderButtons:function($node){},});return AbstractAction;});;

/* /web/static/src/js/chrome/action_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.ActionManager',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var Bus=require('web.Bus');var concurrency=require('web.concurrency');var Context=require('web.Context');var ControlPanel=require('web.ControlPanel');var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var dom=require('web.dom');var framework=require('web.framework');var pyUtils=require('web.py_utils');var Widget=require('web.Widget');var _t=core._t;var ActionManager=Widget.extend({className:'o_content',custom_events:{breadcrumb_clicked:'_onBreadcrumbClicked',history_back:'_onHistoryBack',push_state:'_onPushState',redirect:'_onRedirect',},init:function(parent,userContext){this._super.apply(this,arguments);this.userContext=userContext||{};this.dp=new concurrency.DropPrevious();this.actions={};this.controllers={};this.controllerStack=[];this.currentDialogController=null;},start:function(){this.controlPanel=new ControlPanel(this);var def=this.controlPanel.insertBefore(this.$el);return $.when(def,this._super.apply(this,arguments));},on_attach_callback:function(){this.isInDOM=true;var currentController=this.getCurrentController();if(currentController){currentController.widget.on_attach_callback();}},on_detach_callback:function(){this.isInDOM=false;var currentController=this.getCurrentController();if(currentController){currentController.widget.on_detach_callback();}},clearUncommittedChanges:function(){var currentController=this.getCurrentController();if(currentController){return currentController.widget.canBeRemoved();}
return $.when();},doAction:function(action,options){var self=this;options=_.defaults({},options,{additional_context:{},clear_breadcrumbs:false,on_close:function(){},on_reverse_breadcrumb:function(){},pushState:true,replace_last_action:false,});var def;if(_.isString(action)&&core.action_registry.contains(action)){action={type:'ir.actions.client',tag:action};}else if(_.isNumber(action)||_.isString(action)){def=this._loadAction(action,{active_id:options.additional_context.active_id,active_ids:options.additional_context.active_ids,active_model:options.additional_context.active_model,}).then(function(result){action=result;});}
return this.dp.add($.when(def)).then(function(){options.clear_breadcrumbs=action.target==='main'||options.clear_breadcrumbs;self._preprocessAction(action,options);return self._handleAction(action,options).then(function(){action.pushState=true;return action;});});},do_push_state:function(state){this.trigger_up('push_state',{state:state});},getCurrentAction:function(){var controller=this.getCurrentController();return controller?this.actions[controller.actionID]:null;},getCurrentController:function(){var currentControllerID=_.last(this.controllerStack);return currentControllerID?this.controllers[currentControllerID]:null;},loadState:function(state){var action;if(!state.action){return $.when();}
if(_.isString(state.action)&&core.action_registry.contains(state.action)){action={params:state,tag:state.action,type:'ir.actions.client',};}else{action=state.action;}
return this.doAction(action,{clear_breadcrumbs:true,pushState:false,});},_appendController:function(controller){dom.append(this.$el,controller.widget.$el,{in_DOM:this.isInDOM,callbacks:[{widget:controller.widget}],});if(controller.scrollPosition){this.trigger_up('scrollTo',controller.scrollPosition);}
if(!controller.widget.need_control_panel){this.controlPanel.do_hide();}else{this.controlPanel.update({breadcrumbs:this._getBreadcrumbs(),},{clear:false});}},_closeDialog:function(options){if(this.currentDialogController){this.currentDialogController.dialog.destroy(options);}},_detachCurrentController:function(){var currentController=this.getCurrentController();if(currentController){currentController.scrollPosition=this._getScrollPosition();dom.detach([{widget:currentController.widget}]);}},_executeAction:function(action,options){var self=this;this.actions[action.jsID]=action;if(action.target==='new'){return this._executeActionInDialog(action,options);}
return this.clearUncommittedChanges().then(function(){var controller=self.controllers[action.controllerID];var widget=controller.widget;if(widget.need_control_panel){widget.set_cp_bus(self.controlPanel.get_bus());}
return self.dp.add(self._startController(controller));}).then(function(controller){if(self.currentDialogController){self._closeDialog({silent:true});}
if(options.on_reverse_breadcrumb){var currentAction=self.getCurrentAction();if(currentAction){currentAction.on_reverse_breadcrumb=options.on_reverse_breadcrumb;}}
self._pushController(controller,options);self.call('session_storage','setItem','current_action',action._originalAction);return action;}).fail(function(){self._removeAction(action.jsID);});},_executeActionInDialog:function(action,options){var self=this;var controller=this.controllers[action.controllerID];var widget=controller.widget;if(widget.need_control_panel){widget.set_cp_bus(new Bus());}
return this._startController(controller).then(function(controller){var prevDialogOnClose;if(self.currentDialogController){prevDialogOnClose=self.currentDialogController.onClose;self._closeDialog({silent:true});}
controller.onClose=prevDialogOnClose||options.on_close;var dialog=new Dialog(self,_.defaults({},options,{buttons:[],dialogClass:controller.className,title:action.name,size:action.context.dialog_size,}));dialog.on('closed',self,function(options){options=options||{};self._removeAction(action.jsID);self.currentDialogController=null;if(options.silent!==true){controller.onClose(options.infos);}});controller.dialog=dialog;return dialog.open().opened(function(){self.currentDialogController=controller;dom.append(dialog.$el,widget.$el,{in_DOM:true,callbacks:[{widget:dialog},{widget:controller.widget}],});widget.renderButtons(dialog.$footer);dialog.rebindButtonBehavior();return action;});}).fail(function(){self._removeAction(action.jsID);});},_executeClientAction:function(action,options){var self=this;var ClientAction=core.action_registry.get(action.tag);if(!ClientAction){console.error("Could not find client action "+action.tag,action);return $.Deferred().reject();}
if(!(ClientAction.prototype instanceof AbstractAction)){console.warn('The client action '+action.tag+' should be an instance of AbstractAction!');}
if(!(ClientAction.prototype instanceof Widget)){var next=ClientAction(this,action);if(next){return this.doAction(next,options);}
return $.when();}
var controllerID=_.uniqueId('controller_');options.controllerID=controllerID;var controller={actionID:action.jsID,jsID:controllerID,widget:new ClientAction(this,action,options),};Object.defineProperty(controller,'title',{get:function(){return controller.widget.get('title')||action.display_name||action.name;},});this.controllers[controllerID]=controller;action.controllerID=controllerID;return this._executeAction(action,options).done(function(){self._pushState(controllerID,{});});},_executeCloseAction:function(action,options){var result;if(!this.currentDialogController){result=options.on_close(action.infos);}
this._closeDialog({infos:action.infos});if(action.effect){this.trigger_up('show_effect',action.effect);}
return $.when(result);},_executeServerAction:function(action,options){var self=this;var runDef=this._rpc({route:'/web/action/run',params:{action_id:action.id,context:action.context||{},},});return this.dp.add(runDef).then(function(action){action=action||{type:'ir.actions.act_window_close'};return self.doAction(action,options);});},_executeURLAction:function(action,options){var url=action.url;if(config.debug&&url&&url.length&&url[0]==='/'){url=$.param.querystring(url,{debug:config.debug});}
if(action.target==='self'){framework.redirect(url);return $.Deferred();}else{var w=window.open(url,'_blank');        if(!w||w.closed||typeof w.closed==='undefined'){            var message=_t('A popup window has been blocked. You '+'may need to change your browser settings to allow '+'popup windows for this page.');this.do_warn(_t('Warning'),message,true);        }}
options.on_close();return $.when();},_getBreadcrumbs:function(){var self=this;var currentController=this.getCurrentController();var noBreadcrumbs=!currentController||this.actions[currentController.actionID].context.no_breadcrumbs;if(noBreadcrumbs){return[];}
return _.map(this.controllerStack,function(controllerID){return{title:self.controllers[controllerID].title,controllerID:controllerID,};});},_getControllerState:function(controllerID){var controller=this.controllers[controllerID];var action=this.actions[controller.actionID];var state={title:controller.title,};if(action.id){state.action=action.id;}else if(action.type==='ir.actions.client'){state.action=action.tag;var params=_.pick(action.params,function(v){return _.isString(v)||_.isNumber(v);});state=_.extend(params||{},state);}
if(action.context){var active_id=action.context.active_id;if(active_id){state.active_id=active_id;}
var active_ids=action.context.active_ids;if(active_ids&&!(active_ids.length===1&&active_ids[0]===active_id)){state.active_ids=action.context.active_ids.join(',');}}
return state;},_getScrollPosition:function(){var scrollPosition;this.trigger_up('getScrollPosition',{callback:function(_scrollPosition){scrollPosition=_scrollPosition;}});return scrollPosition;},_handleAction:function(action,options){if(!action.type){console.error("No type for action",action);return $.Deferred().reject();}
switch(action.type){case'ir.actions.act_url':return this._executeURLAction(action,options);case'ir.actions.act_window_close':return this._executeCloseAction(action,options);case'ir.actions.client':return this._executeClientAction(action,options);case'ir.actions.server':return this._executeServerAction(action,options);default:console.error("The ActionManager can't handle actions of type "+
action.type,action);return $.Deferred().reject();}},_pushController:function(controller,options){options=options||{};var self=this;this._detachCurrentController();var toDestroy;if(options.clear_breadcrumbs){toDestroy=this.controllerStack;this.controllerStack=[];}else if(options.replace_last_action&&this.controllerStack.length>0){toDestroy=[this.controllerStack.pop()];}else if(options.index!==undefined){toDestroy=this.controllerStack.splice(options.index);toDestroy=_.reject(toDestroy,function(controllerID){return controllerID===controller.jsID||self.controllers[controllerID].actionID===controller.actionID;});}
this._removeControllers(toDestroy);this.controllerStack.push(controller.jsID);this._appendController(controller);this.trigger_up('current_action_updated',{action:this.getCurrentAction(),controller:controller,});this._toggleFullscreen();},_pushState:function(controllerID,state){var controller=this.controllers[controllerID];if(controller){var action=this.actions[controller.actionID];if(action.target==='new'||action.pushState===false){return;}
state=_.extend({},state,this._getControllerState(controller.jsID));this.trigger_up('push_state',{state:state});}},_loadAction:function(actionID,context){var def=$.Deferred();this.trigger_up('load_action',{actionID:actionID,context:context,on_success:def.resolve.bind(def),});return def;},_preprocessAction:function(action,options){var context=new Context(this.userContext,options.additional_context,action.context);action.context=pyUtils.eval('context',context);if(action.domain){action.domain=pyUtils.eval('domain',action.domain,action.context);}
action._originalAction=JSON.stringify(action);action.jsID=_.uniqueId('action_');action.pushState=options.pushState;},_redirectDefault:function(resModel,resID){var self=this;this._rpc({model:resModel,method:'get_formview_id',args:[[resID],self.user_context],}).then(function(viewID){self.do_action({type:'ir.actions.act_window',view_type:'form',view_mode:'form',res_model:resModel,views:[[viewID||false,'form']],res_id:resID,});});},_removeAction:function(actionID){var action=this.actions[actionID];var controller=this.controllers[action.controllerID];delete this.actions[action.jsID];delete this.controllers[action.controllerID];controller.widget.destroy();},_removeControllers:function(controllerIDs){var self=this;var actionsToRemove=_.map(controllerIDs,function(controllerID){return self.controllers[controllerID].actionID;});_.each(_.uniq(actionsToRemove),this._removeAction.bind(this));},_restoreController:function(controllerID){var self=this;var controller=this.controllers[controllerID];var action=this.actions[controller.actionID];var def;if(action.on_reverse_breadcrumb){def=action.on_reverse_breadcrumb();}
return $.when(def).then(function(){return $.when(controller.widget.do_show()).then(function(){var index=_.indexOf(self.controllerStack,controllerID);self._pushController(controller,{index:index});});});},_startController:function(controller){var self=this;var fragment=document.createDocumentFragment();controller.widget.on("change:title",this,function(){if(self.getCurrentController()!==controller){return;}
var action=self.actions[controller.actionID];if(!action.flags||!action.flags.headless){var breadcrumbs=self._getBreadcrumbs();self.controlPanel.update({breadcrumbs:breadcrumbs},{clear:false});}});return controller.widget.appendTo(fragment).then(function(){return controller;});},_toggleFullscreen:function(){var self=this;var fullscreen=_.some(this.controllerStack,function(controllerID){var controller=self.controllers[controllerID];return self.actions[controller.actionID].target==='fullscreen';});this.trigger_up('toggle_fullscreen',{fullscreen:fullscreen});},_onBreadcrumbClicked:function(ev){ev.stopPropagation();this._restoreController(ev.data.controllerID);},_onHistoryBack:function(){if(this.currentDialogController){this._closeDialog();}else{var length=this.controllerStack.length;if(length>1){this._restoreController(this.controllerStack[length-2]);}}},_onPushState:function(ev){if(ev.target!==this){ev.stopPropagation();this._pushState(ev.data.controllerID,ev.data.state);}},_onRedirect:function(ev){this._redirectDefault(ev.data.res_model,ev.data.res_id);},});return ActionManager;});;

/* /web/static/src/js/chrome/action_manager_act_window.js defined in bundle 'web.assets_backend' */
odoo.define('web.ActWindowActionManager',function(require){"use strict";var ActionManager=require('web.ActionManager');var config=require('web.config');var Context=require('web.Context');var core=require('web.core');var data=require('web.data');var pyUtils=require('web.py_utils');var SearchView=require('web.SearchView');var view_registry=require('web.view_registry');var _t=core._t;ActionManager.include({custom_events:_.extend({},ActionManager.prototype.custom_events,{env_updated:'_onEnvUpdated',execute_action:'_onExecuteAction',get_controller_context:'_onGetControllerContext',update_filters:'_onUpdateFilters',search:'_onSearch',switch_view:'_onSwitchView',navigation_move:'_onNavigationMove',}),loadState:function(state){var callersArguments=arguments;var self=this;var action;var def;var options={clear_breadcrumbs:true,pushState:false,};if(state.action){var currentController=this.getCurrentController();var currentAction=currentController&&this.actions[currentController.actionID];if(currentAction&&currentAction.id===state.action&&currentAction.type==='ir.actions.act_window'){this._closeDialog(true);currentAction.env.currentId=state.id;var viewType=state.view_type||currentController.viewType;return this._switchController(currentAction,viewType);}else if(!core.action_registry.contains(state.action)){var context={};if(state.active_id){context.active_id=state.active_id;}
if(state.active_ids){context.active_ids=state.active_ids.toString().split(',').map(function(id){return parseInt(id,10)||id;});}else if(state.active_id){context.active_ids=[state.active_id];}
context.params=state;action=state.action;options=_.extend(options,{additional_context:context,resID:state.id,viewType:state.view_type,});}}else if(state.model&&state.id){action={res_model:state.model,res_id:state.id,type:'ir.actions.act_window',views:[[state.view_id||false,'form']],};}else if(state.model&&state.view_type){var storedAction=this.call('session_storage','getItem','current_action');var lastAction=JSON.parse(storedAction||'{}');if(lastAction.res_model===state.model){action=lastAction;options.viewType=state.view_type;}}else if(state.sa){def=this._rpc({route:'/web/session/get_session_action',params:{key:state.sa},}).then(function(sessionAction){action=sessionAction;});}
return $.when(def).then(function(){if(action){return self.doAction(action,options);}
return self._super.apply(self,callersArguments);});},_createSearchView:function(action){if(action._keepSearchView){var currentAction=this.getCurrentAction();if(currentAction){action.searchView=currentAction.searchView;action.env=currentAction.env;return $.when(currentAction.searchView);}else{action._keepSearchView=false;}}
var dataset=new data.DataSetSearch(this,action.res_model,action.context,action.domain);if(action.res_id){dataset.ids.push(action.res_id);dataset.index=0;}
var searchDefaults={};_.each(action.context,function(value,key){var match=/^search_default_(.*)$/.exec(key);if(match){searchDefaults[match[1]]=value;}});var searchView=new SearchView(this,dataset,action.searchFieldsView,{$buttons:$('<div>'),action:action,disable_custom_filters:action.flags.disableCustomFilters,search_defaults:searchDefaults,});return searchView.appendTo(document.createDocumentFragment()).then(function(){action.searchView=searchView;return searchView;});},_createViewController:function(action,viewType,viewOptions,options){var self=this;var viewDescr=_.findWhere(action.views,{type:viewType});if(!viewDescr){return $.Deferred().reject();}
var controllerID=_.uniqueId('controller_');var controller={actionID:action.jsID,className:'o_act_window',jsID:controllerID,viewType:viewType,};Object.defineProperty(controller,'title',{get:function(){return controller.widget?controller.widget.getTitle():(action.display_name||action.name);},});this.controllers[controllerID]=controller;if(!options||!options.lazy){viewOptions=_.extend({action:action,limit:action.limit,},action.flags,action.flags[viewType],viewOptions,action.env);viewOptions=_.extend(viewOptions,{controllerID:controllerID});var view=new viewDescr.Widget(viewDescr.fieldsView,viewOptions);var def=$.Deferred();action.controllers[viewType]=def;view.getController(this).then(function(widget){if(def.state()==='rejected'){widget.destroy();}else{controller.widget=widget;def.resolve(controller);}}).fail(def.reject.bind(def));def.fail(function(){delete self.controllers[controllerID];});}else{action.controllers[viewType]=$.Deferred().resolve(controller);}
return action.controllers[viewType];},_destroyWindowAction:function(action){var self=this;_.each(action.controllers,function(controllerDef){controllerDef.then(function(controller){delete self.controllers[controller.jsID];if(controller.widget){controller.widget.destroy();}});controllerDef.reject();});if(action.searchView&&!action._keepSearchView){action.searchView.destroy();}},_executeWindowAction:function(action,options){var self=this;if(action.context.active_id||action.context.active_ids){action.context.search_disable_custom_filters=true;}
action.flags=this._generateActionFlags(action);return this.dp.add(this._loadViews(action)).then(function(fieldsViews){var views=self._generateActionViews(action,fieldsViews);action._views=action.views;action.views=views;if(fieldsViews.search){action.searchFieldsView=fieldsViews.search;}
action.env=self._generateActionEnv(action,options);action.controllers={};var firstView=options.viewType&&_.findWhere(views,{type:options.viewType});var mainView;if(firstView){if(!firstView.multiRecord&&views[0].multiRecord){mainView=views[0];}}else{firstView=views[0];}
if(config.device.isMobile){if(!firstView.isMobileFriendly){firstView=self._findMobileView(views,firstView.multiRecord)||firstView;}
if(mainView&&!mainView.isMobileFriendly){mainView=self._findMobileView(views,mainView.multiRecord)||mainView;}}
var def;if(action.flags.hasSearchView){def=self._createSearchView(action).then(function(searchView){var searchData=searchView.build_search_data();_.extend(action.env,self._processSearchData(action,searchData));});}
return $.when(def).then(function(){var defs=[];defs.push(self._createViewController(action,firstView.type));if(mainView){defs.push(self._createViewController(action,mainView.type,{},{lazy:true}));}
return self.dp.add($.when.apply($,defs));}).then(function(controller,lazyLoadedController){action.controllerID=controller.jsID;return self._executeAction(action,options).done(function(){if(lazyLoadedController){var index=self.controllerStack.length-1;self.controllerStack.splice(index,0,lazyLoadedController.jsID);self.controlPanel.update({breadcrumbs:self._getBreadcrumbs(),},{clear:false});}});}).fail(self._destroyWindowAction.bind(self,action));});},_findMobileView:function(views,multiRecord){return _.findWhere(views,{isMobileFriendly:true,multiRecord:multiRecord,});},_generateActionEnv:function(action,options){var resID=options.resID||action.res_id;return{modelName:action.res_model,ids:resID?[resID]:undefined,currentId:resID||undefined,domain:[],context:action.context||{},groupBy:[],};},_generateActionFlags:function(action){var popup=action.target==='new';var inline=action.target==='inline';var form=action.views[0][1]==='form';return _.defaults({},action.flags,{disableCustomFilters:action.context&&action.context.search_disable_custom_filters,footerToButtons:popup,hasSearchView:!(popup&&form)&&!inline,hasSidebar:!popup&&!inline,headless:(popup||inline)&&form,mode:(popup||inline||action.target==='fullscreen')&&'edit',});},_generateActionViews:function(action,fieldsViews){var views=[];_.each(action.views,function(view){var viewType=view[1];var fieldsView=fieldsViews[viewType];var parsedXML=new DOMParser().parseFromString(fieldsView.arch,"text/xml");var key=parsedXML.documentElement.getAttribute('js_class');var View=view_registry.get(key||viewType);if(View){views.push({accessKey:View.prototype.accessKey||View.prototype.accesskey,displayName:View.prototype.display_name,fieldsView:fieldsView,icon:View.prototype.icon,isMobileFriendly:View.prototype.mobile_friendly,multiRecord:View.prototype.multi_record,type:viewType,viewID:view[0],Widget:View,});}else{console.error("View type '"+viewType+"' is not present in the view registry.");}});return views;},_getControllerState:function(controllerID){var state=this._super.apply(this,arguments);var controller=this.controllers[controllerID];var action=this.actions[controller.actionID];if(action.type==='ir.actions.act_window'){state.model=action.res_model;state.view_type=controller.viewType;}
return state;},_handleAction:function(action,options){if(action.type==='ir.actions.act_window'){return this._executeWindowAction(action,options);}
return this._super.apply(this,arguments);},_loadViews:function(action){var options={action_id:action.id,toolbar:action.flags.hasSidebar,};var views=action.views.slice();if(action.flags.hasSearchView){options.load_filters=true;var searchviewID=action.search_view_id&&action.search_view_id[0];views.push([searchviewID||false,'search']);}
return this.loadViews(action.res_model,action.context,views,options);},_preprocessAction:function(action,options){this._super.apply(this,arguments);if(action.type==='ir.actions.act_window'&&options.keepSearchView){action._keepSearchView=true;}},_processSearchData:function(action,searchData){var contexts=searchData.contexts;var domains=searchData.domains;var groupbys=searchData.groupbys;var action_context=action.context||{};var results=pyUtils.eval_domains_and_contexts({domains:[action.domain||[]].concat(domains||[]),contexts:[action_context].concat(contexts||[]),group_by_seq:groupbys||[],eval_context:this.userContext,});var groupBy=results.group_by.length?results.group_by:(action.context.group_by||[]);groupBy=(typeof groupBy==='string')?[groupBy]:groupBy;if(results.error){throw new Error(_.str.sprintf(_t("Failed to evaluate search criterions")+": \n%s",JSON.stringify(results.error)));}
var context=_.omit(results.context,'time_ranges');return{context:context,domain:results.domain,groupBy:groupBy,};},_removeAction:function(actionID){var action=this.actions[actionID];if(action.type==='ir.actions.act_window'){delete this.actions[action.jsID];this._destroyWindowAction(action);}else{this._super.apply(this,arguments);}},_restoreController:function(controllerID){var self=this;var controller=this.controllers[controllerID];var action=this.actions[controller.actionID];if(action.type==='ir.actions.act_window'){return this.clearUncommittedChanges().then(function(){var def;if(action.on_reverse_breadcrumb){def=action.on_reverse_breadcrumb();}
return $.when(def).then(function(){return self._switchController(action,controller.viewType);});});}
return this._super.apply(this,arguments);},_switchController:function(action,viewType,viewOptions){var self=this;var newController=function(){return self._createViewController(action,viewType,viewOptions).then(function(controller){var widget=controller.widget;if(widget.need_control_panel){widget.set_cp_bus(self.controlPanel.get_bus());}
return self._startController(controller);});};var controllerDef=action.controllers[viewType];if(!controllerDef||controllerDef.state()==='rejected'){controllerDef=newController();}else{controllerDef=controllerDef.then(function(controller){if(!controller.widget){return newController().done(function(newController){var index=self.controllerStack.indexOf(controller.jsID);self.controllerStack[index]=newController.jsID;delete self.controllers[controller.jsID];});}else{viewOptions=_.extend(viewOptions||{},action.env);return $.when(controller.widget.willRestore()).then(function(){return controller.widget.reload(viewOptions).then(function(){return controller;});});}});}
return this.dp.add(controllerDef).then(function(controller){var view=_.findWhere(action.views,{type:viewType});var currentController=self.getCurrentController();var index;if(currentController.actionID!==action.jsID){index=_.indexOf(self.controllerStack,controller.jsID);}else if(view.multiRecord){index=_.findIndex(self.controllerStack,function(controllerID){return self.controllers[controllerID].actionID===action.jsID;});}else if(!_.findWhere(action.views,{type:currentController.viewType}).multiRecord){index=self.controllerStack.length-1;}
return self._pushController(controller,{index:index});});},_onEnvUpdated:function(ev){ev.stopPropagation();var controller=this.controllers[ev.data.controllerID];var action=this.actions[controller.actionID];_.extend(action.env,ev.data.env);},_onExecuteAction:function(ev){ev.stopPropagation();var self=this;var actionData=ev.data.action_data;var env=ev.data.env;var context=new Context(env.context,actionData.context||{});var recordID=env.currentID||null;var def=$.Deferred();if(actionData.special){def=$.when({type:'ir.actions.act_window_close',infos:'special'});}else if(actionData.type==='object'){var args=recordID?[[recordID]]:[env.resIDs];if(actionData.args){try{var additionalArgs=JSON.parse(actionData.args.replace(/'/g,'"'));args=args.concat(additionalArgs);}catch(e){console.error("Could not JSON.parse arguments",actionData.args);}}
args.push(context.eval());def=this._rpc({route:'/web/dataset/call_button',params:{args:args,method:actionData.name,model:env.model,},});}else if(actionData.type==='action'){def=this._loadAction(actionData.name,_.extend(pyUtils.eval('context',context),{active_model:env.model,active_ids:env.resIDs,active_id:recordID,}));}
def.fail(ev.data.on_fail);this.dp.add(def).then(function(action){var effect=false;if(actionData.effect){effect=pyUtils.py_eval(actionData.effect);}
if(action&&action.constructor===Object){var ctx=new Context(_.object(_.reject(_.pairs(env.context),function(pair){return pair[0].match('^(?:(?:default_|search_default_|show_).+|'+'.+_view_ref|group_by|group_by_no_leaf|active_id|'+'active_ids|orderedBy)$')!==null;})));ctx.add(actionData.context||{});ctx.add({active_model:env.model});if(recordID){ctx.add({active_id:recordID,active_ids:[recordID],});}
ctx.add(action.context||{});action.context=ctx;action.effect=effect||action.effect;}else{action={effect:effect,type:'ir.actions.act_window_close',};}
var options={on_close:ev.data.on_closed};return self.doAction(action,options).then(ev.data.on_success,ev.data.on_fail);});},_onGetControllerContext:function(ev){ev.stopPropagation();var currentController=this.getCurrentController();var context=currentController&&currentController.widget.getContext();ev.data.callback(context||{});},_onUpdateFilters:function(ev){var controller=this.controllers[ev.data.controllerID];var action=this.actions[controller.actionID];var data=ev.data;var addedFilters=action.searchView.updateFilters(data.newFilters,data.filtersToRemove);data.callback(addedFilters);},_onNavigationMove:function(event){switch(event.data.direction){case'down':var currentController=this.getCurrentController().widget;currentController.giveFocus();event.stopPropagation();break;}},_onSearch:function(ev){ev.stopPropagation();var currentController=this.getCurrentController();var action=this.actions[currentController.actionID];_.extend(action.env,this._processSearchData(action,ev.data));currentController.widget.reload(_.extend({offset:0},action.env));},_onSwitchView:function(ev){ev.stopPropagation();var viewType=ev.data.view_type;var currentController=this.getCurrentController();if(currentController.jsID===ev.data.controllerID){var action=this.actions[currentController.actionID];if('res_id'in ev.data){action.env.currentId=ev.data.res_id;}
var options={};if(viewType==='form'&&!action.env.currentId){options.mode='edit';}else if(ev.data.mode){options.mode=ev.data.mode;}
this._switchController(action,viewType,options);}},});});;

/* /web/static/src/js/chrome/action_manager_report.js defined in bundle 'web.assets_backend' */
odoo.define('web.ReportActionManager',function(require){"use strict";var ActionManager=require('web.ActionManager');var core=require('web.core');var crash_manager=require('web.crash_manager');var framework=require('web.framework');var session=require('web.session');var _t=core._t;var _lt=core._lt;var link='<br><br><a href="http://wkhtmltopdf.org/" target="_blank">wkhtmltopdf.org</a>';var WKHTMLTOPDF_MESSAGES={broken:_lt('Your installation of Wkhtmltopdf seems to be broken. The report will be shown '+'in html.')+link,install:_lt('Unable to find Wkhtmltopdf on this system. The report will be shown in '+'html.')+link,upgrade:_lt('You should upgrade your version of Wkhtmltopdf to at least 0.12.0 in order to '+'get a correct display of headers and footers as well as support for '+'table-breaking between pages.')+link,workers:_lt('You need to start Odoo with at least two workers to print a pdf version of '+'the reports.'),};ActionManager.include({_downloadReport:function(url){framework.blockUI();var def=$.Deferred();var type='qweb-'+url.split('/')[2];var blocked=!session.get_file({url:'/report/download',data:{data:JSON.stringify([url,type]),},success:def.resolve.bind(def),error:function(){crash_manager.rpc_error.apply(crash_manager,arguments);def.reject();},complete:framework.unblockUI,});if(blocked){var message=_t('A popup window with your report was blocked. You '+'may need to change your browser settings to allow '+'popup windows for this page.');this.do_warn(_t('Warning'),message,true);}
return def;},_triggerDownload:function(action,options,type){var self=this;var reportUrls=this._makeReportUrls(action);return this._downloadReport(reportUrls[type]).then(function(){if(action.close_on_report_download){var closeAction={type:'ir.actions.act_window_close'};return self.doAction(closeAction,_.pick(options,'on_close'));}else{return options.on_close();}});},_executeReportAction:function(action,options){var self=this;if(action.report_type==='qweb-html'){return this._executeReportClientAction(action,options);}else if(action.report_type==='qweb-pdf'){return this.call('report','checkWkhtmltopdf').then(function(state){if(state in WKHTMLTOPDF_MESSAGES){self.do_notify(_t('Report'),WKHTMLTOPDF_MESSAGES[state],true);}
if(state==='upgrade'||state==='ok'){return self._triggerDownload(action,options,'pdf');}else{return self._executeReportClientAction(action,options);}});}else if(action.report_type==='qweb-text'){return self._triggerDownload(action,options,'text');}else{console.error("The ActionManager can't handle reports of type "+
action.report_type,action);return $.Deferred().reject();}},_executeReportClientAction:function(action,options){var urls=this._makeReportUrls(action);var clientActionOptions=_.extend({},options,{context:action.context,data:action.data,display_name:action.display_name,name:action.name,report_file:action.report_file,report_name:action.report_name,report_url:urls.html,});return this.doAction('report.client_action',clientActionOptions);},_handleAction:function(action,options){if(action.type==='ir.actions.report'){return this._executeReportAction(action,options);}
return this._super.apply(this,arguments);},_makeReportUrls:function(action){var reportUrls={html:'/report/html/'+action.report_name,pdf:'/report/pdf/'+action.report_name,text:'/report/text/'+action.report_name,};if(_.isUndefined(action.data)||_.isNull(action.data)||(_.isObject(action.data)&&_.isEmpty(action.data))){if(action.context.active_ids){var activeIDsPath='/'+action.context.active_ids.join(',');reportUrls=_.mapObject(reportUrls,function(value){return value+=activeIDsPath;});}}else{var serializedOptionsPath='?options='+encodeURIComponent(JSON.stringify(action.data));serializedOptionsPath+='&context='+encodeURIComponent(JSON.stringify(action.context));reportUrls=_.mapObject(reportUrls,function(value){return value+=serializedOptionsPath;});}
return reportUrls;},});});;

/* /web/static/src/js/chrome/control_panel.js defined in bundle 'web.assets_backend' */
odoo.define('web.ControlPanelMixin',function(require){"use strict";var ControlPanelMixin={need_control_panel:true,set_cp_bus:function(cp_bus){this.cp_bus=cp_bus;},update_control_panel:function(cp_status,options){if(this.cp_bus){this.cp_bus.trigger("update",cp_status||{},options||{});}},};return ControlPanelMixin;});odoo.define('web.ControlPanel',function(require){"use strict";var Bus=require('web.Bus');var data=require('web.data');var Widget=require('web.Widget');var ControlPanel=Widget.extend({template:'ControlPanel',init:function(parent,template){this._super(parent);if(template){this.template=template;}
this.bus=new Bus(this);this.bus.updateIndex=0;this.bus.on("update",this,this.update);},start:function(){this.nodes={$buttons:this.$('.o_cp_buttons'),$pager:this.$('.o_cp_pager'),$searchview:this.$('.o_cp_searchview'),$searchview_buttons:this.$('.o_search_options'),$sidebar:this.$('.o_cp_sidebar'),$switch_buttons:this.$('.o_cp_switch_buttons'),};this._toggle_visibility(false);return this._super();},get_bus:function(){return this.bus;},update:function(status,options){this.bus.updateIndex++;this._toggle_visibility(!status.hidden);if(!status.hidden){options=_.defaults({},options,{clear:true,});var new_cp_content=status.cp_content||{};if(status.breadcrumbs){this.$('.breadcrumb').html(this._render_breadcrumbs(status.breadcrumbs));}
var toDetach=this.nodes;if(status.searchview&&this.searchview===status.searchview){toDetach=_.omit(toDetach,'$searchview');new_cp_content=_.omit(new_cp_content,'$searchview');}
if(options.clear){this._detach_content(toDetach);this.nodes.$searchview_buttons.show();}else{this._detach_content(_.pick(toDetach,_.keys(new_cp_content)));}
this._attach_content(new_cp_content);if(options.clear||status.searchview){this.searchview=status.searchview;}
if(status.searchview||options.clear){this._update_search_view(status.searchview,status.search_view_hidden,status.groupable,status.enableTimeRangeMenu);}
if(status.active_view_selector){this._update_switch_buttons(status.active_view_selector);}}},_toggle_visibility:function(visible){this.do_toggle(visible);if(!visible&&!this.$content){this.$content=this.$el.contents().detach();}else if(this.$content){this.$content.appendTo(this.$el);this.$content=null;}},_detach_content:function(elements_to_detach){_.each(elements_to_detach,function($nodeset){$nodeset.contents().detach();});},_attach_content:function(content){var self=this;_.each(content,function($nodeset,$element){if($nodeset&&self.nodes[$element]){self.nodes[$element].append($nodeset);}});},_update_switch_buttons:function(active_view_selector){_.each(this.nodes.$switch_buttons.find('button'),function(button){$(button).removeClass('active');});this.$(active_view_selector).addClass('active');},_render_breadcrumbs:function(breadcrumbs){var self=this;return breadcrumbs.map(function(bc,index){return self._render_breadcrumbs_li(bc,index,breadcrumbs.length);});},_render_breadcrumbs_li:function(bc,index,length){var self=this;var is_last=(index===length-1);var li_content=bc.title&&_.escape(bc.title.trim())||data.noDisplayContent;var $bc=$('<li>',{class:'breadcrumb-item'}).append(is_last?li_content:$('<a>',{href:'#'}).html(li_content)).toggleClass('active',is_last);if(!is_last){$bc.click(function(ev){ev.preventDefault();self.trigger_up('breadcrumb_clicked',{controllerID:bc.controllerID});});}
return $bc;},_update_search_view:function(searchview,isHidden,groupable,enableTimeRangeMenu){if(searchview){searchview.toggle_visibility(!isHidden);if(groupable!==undefined){searchview.groupby_menu.do_toggle(groupable);}
if(enableTimeRangeMenu!==undefined){searchview.displayTimeRangeMenu(enableTimeRangeMenu);}}
this.nodes.$searchview.toggle(!isHidden);this.$el.toggleClass('o_breadcrumb_full',!!isHidden);},});return ControlPanel;});;

/* /web/static/src/js/core/browser_detection.js defined in bundle 'web.assets_backend' */
odoo.define('web.BrowserDetection',function(require){"use strict";var Class=require('web.Class');var BrowserDetection=Class.extend({init:function(){},isOsMac:function(){return navigator.platform.toLowerCase().indexOf('mac')!==-1;},isBrowserChrome:function(){return $.browser.chrome&&navigator.userAgent.toLocaleLowerCase().indexOf('edge')===-1;}});return BrowserDetection;});;

/* /web/static/src/js/chrome/keyboard_navigation_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('web.KeyboardNavigationMixin',function(require){"use strict";var BrowserDetection=require('web.BrowserDetection');var knownUnusableAccessKeys=[' ','A','C','H','J','K','L','N','P','S','Q','E','F','D','0','1','2','3','4','5','6','7','8','9'];var KeyboardNavigationMixin={events:{'keydown':'_onKeyDown','keyup':'_onKeyUp',},init:function(){this._areAccessKeyVisible=false;this.BrowserDetection=new BrowserDetection();},_addAccessKeyOverlays:function(){var accesskeyElements=$(document).find('[accesskey]').filter(':visible');_.each(accesskeyElements,function(elem){var overlay=$(_.str.sprintf("<div class='o_web_accesskey_overlay'>%s</div>",$(elem).attr('accesskey').toUpperCase()));var $overlayParent;if(elem.tagName.toUpperCase()==="INPUT"){$overlayParent=$(elem).parent();}else{$overlayParent=$(elem);}
if($overlayParent.css('position')!=='absolute'){$overlayParent.css('position','relative');}
overlay.appendTo($overlayParent);});},_getAllUsedAccessKeys:function(){var usedAccessKeys=knownUnusableAccessKeys.slice();this.$el.find('[accesskey]').each(function(_,elem){usedAccessKeys.push(elem.accessKey.toUpperCase());});return usedAccessKeys;},_hideAccessKeyOverlay:function(){this._areAccessKeyVisible=false;var overlays=this.$el.find('.o_web_accesskey_overlay');if(overlays.length){return overlays.remove();}},_setAccessKeyOnTopNavigation:function(){this.$el.find('.o_menu_sections>li>a').each(function(number,item){item.accessKey=number+1;});},_onKeyDown:function(keyDownEvent){if($('body.o_ui_blocked').length&&(keyDownEvent.altKey||keyDownEvent.key==='Alt')&&!keyDownEvent.ctrlKey){if(keyDownEvent.preventDefault)keyDownEvent.preventDefault();else keyDownEvent.returnValue=false;if(keyDownEvent.stopPropagation)keyDownEvent.stopPropagation();if(keyDownEvent.cancelBubble)keyDownEvent.cancelBubble=true;return false;}
if(!this._areAccessKeyVisible&&(keyDownEvent.altKey||keyDownEvent.key==='Alt')&&!keyDownEvent.ctrlKey){this._areAccessKeyVisible=true;this._setAccessKeyOnTopNavigation();var usedAccessKey=this._getAllUsedAccessKeys();var buttonsWithoutAccessKey=this.$el.find('button.btn:visible').not('[accesskey]').not('[disabled]').not('[tabindex="-1"]');_.each(buttonsWithoutAccessKey,function(elem){var buttonString=[elem.innerText,elem.title,"ABCDEFGHIJKLMNOPQRSTUVWXYZ"].join('');for(var letterIndex=0;letterIndex<buttonString.length;letterIndex++){var candidateAccessKey=buttonString[letterIndex].toUpperCase();if(candidateAccessKey>='A'&&candidateAccessKey<='Z'&&!_.includes(usedAccessKey,candidateAccessKey)){elem.accessKey=candidateAccessKey;usedAccessKey.push(candidateAccessKey);break;}}});var elementsWithoutAriaKeyshortcut=this.$el.find('[accesskey]').not('[aria-keyshortcuts]');_.each(elementsWithoutAriaKeyshortcut,function(elem){elem.setAttribute('aria-keyshortcuts','Alt+Shift+'+elem.accessKey);});this._addAccessKeyOverlays();}
if(this.BrowserDetection.isOsMac())
return;if(keyDownEvent.altKey&&!keyDownEvent.ctrlKey&&keyDownEvent.key.length===1){var elementWithAccessKey=[];if(keyDownEvent.keyCode>=65&&keyDownEvent.keyCode<=90||keyDownEvent.keyCode>=97&&keyDownEvent.keyCode<=122){elementWithAccessKey=document.querySelectorAll('[accesskey="'+String.fromCharCode(keyDownEvent.keyCode).toLowerCase()+'"], [accesskey="'+String.fromCharCode(keyDownEvent.keyCode).toUpperCase()+'"]');if(elementWithAccessKey.length){if(this.BrowserDetection.isOsMac()||!this.BrowserDetection.isBrowserChrome()){elementWithAccessKey[0].focus();elementWithAccessKey[0].click();if(keyDownEvent.preventDefault)keyDownEvent.preventDefault();else keyDownEvent.returnValue=false;if(keyDownEvent.stopPropagation)keyDownEvent.stopPropagation();if(keyDownEvent.cancelBubble)keyDownEvent.cancelBubble=true;return false;}}}
else{var numberKey;if(keyDownEvent.originalEvent.code&&keyDownEvent.originalEvent.code.indexOf('Digit')===0){numberKey=keyDownEvent.originalEvent.code[keyDownEvent.originalEvent.code.length-1];}else if(keyDownEvent.originalEvent.key&&keyDownEvent.originalEvent.key.length===1&&keyDownEvent.originalEvent.key>='0'&&keyDownEvent.originalEvent.key<='9'){numberKey=keyDownEvent.originalEvent.key;}else if(keyDownEvent.keyCode>=48&&keyDownEvent.keyCode<=57){numberKey=keyDownEvent.keyCode-48;}
if(numberKey>='0'&&numberKey<='9'){elementWithAccessKey=document.querySelectorAll('[accesskey="'+numberKey+'"]');if(elementWithAccessKey.length){elementWithAccessKey[0].click();if(keyDownEvent.preventDefault)keyDownEvent.preventDefault();else keyDownEvent.returnValue=false;if(keyDownEvent.stopPropagation)keyDownEvent.stopPropagation();if(keyDownEvent.cancelBubble)keyDownEvent.cancelBubble=true;return false;}}}}},_onKeyUp:function(keyUpEvent){if((keyUpEvent.altKey||keyUpEvent.key==='Alt')&&!keyUpEvent.ctrlKey){this._hideAccessKeyOverlay();if(keyUpEvent.preventDefault)keyUpEvent.preventDefault();else keyUpEvent.returnValue=false;if(keyUpEvent.stopPropagation)keyUpEvent.stopPropagation();if(keyUpEvent.cancelBubble)keyUpEvent.cancelBubble=true;return false;}},};return KeyboardNavigationMixin;});;

/* /web/static/src/js/chrome/abstract_web_client.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractWebClient',function(require){"use strict";var ActionManager=require('web.ActionManager');var concurrency=require('web.concurrency');var core=require('web.core');var config=require('web.config');var crash_manager=require('web.crash_manager');var data_manager=require('web.data_manager');var Dialog=require('web.Dialog');var dom=require('web.dom');var KeyboardNavigationMixin=require('web.KeyboardNavigationMixin');var Loading=require('web.Loading');var RainbowMan=require('web.RainbowMan');var ServiceProviderMixin=require('web.ServiceProviderMixin');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;var qweb=core.qweb;var AbstractWebClient=Widget.extend(ServiceProviderMixin,KeyboardNavigationMixin,{dependencies:['notification'],events:_.extend({},KeyboardNavigationMixin.events,{'click .o_search_options .dropdown-menu':'_onClickDropDownMenu',}),custom_events:{clear_uncommitted_changes:function(e){this.clear_uncommitted_changes().then(e.data.callback);},toggle_fullscreen:function(event){this.toggle_fullscreen(event.data.fullscreen);},current_action_updated:function(ev){this.current_action_updated(ev.data.action,ev.data.controller);},warning:'_onDisplayWarning',load_action:'_onLoadAction',load_views:function(event){var params={model:event.data.modelName,context:event.data.context,views_descr:event.data.views,};return data_manager.load_views(params,event.data.options||{}).then(event.data.on_success);},load_filters:function(event){return data_manager.load_filters(event.data.dataset,event.data.action_id).then(event.data.on_success);},create_filter:'_onCreateFilter',push_state:'_onPushState',show_effect:'_onShowEffect',get_session:function(event){if(event.data.callback){event.data.callback(session);}},do_action:function(event){this.do_action(event.data.action,event.data.options||{}).then(function(result){if(event.data.on_success){event.data.on_success(result);}}).fail(function(result){if(event.data.on_fail){event.data.on_fail(result);}});},getScrollPosition:'_onGetScrollPosition',scrollTo:'_onScrollTo',set_title_part:'_onSetTitlePart',},init:function(parent){odoo.isReady=false;this.client_options={};this._super(parent);ServiceProviderMixin.init.call(this);KeyboardNavigationMixin.init.call(this);this.origin=undefined;this._current_state=null;this.menu_dm=new concurrency.DropMisordered();this.action_mutex=new concurrency.Mutex();this.set('title_part',{"zopenerp":"Odoo"});},start:function(){var self=this;this.$el.toggleClass('o_touch_device',config.device.touch);this.on("change:title_part",this,this._title_changed);this._title_changed();return session.is_bound.then(function(){self.$el.toggleClass('o_rtl',_t.database.parameters.direction==="rtl");self.bind_events();return $.when(self.set_action_manager(),self.set_loading());}).then(function(){if(session.session_is_valid()){return self.show_application();}else{return $.when();}}).then(function(){self.action_manager.$el.on('scroll',core.bus.trigger.bind(core.bus,'scroll'));core.bus.trigger('web_client_ready');odoo.isReady=true;if(session.uid===1){self.$el.addClass('o_is_superuser');}});},bind_events:function(){var self=this;$('.oe_systray').show();this.$el.on('mouseenter','.oe_systray > div:not([data-toggle=tooltip])',function(){$(this).attr('data-toggle','tooltip').tooltip().trigger('mouseenter');});this.$el.on('click','.oe_dropdown_toggle',function(ev){ev.preventDefault();var $toggle=$(this);var doc_width=$(document).width();var $menu=$toggle.siblings('.oe_dropdown_menu');$menu=$menu.size()>=1?$menu:$toggle.find('.oe_dropdown_menu');var state=$menu.is('.oe_opened');setTimeout(function(){$toggle.add($menu).toggleClass('oe_opened',!state);if(!state){var offset=$menu.offset();var menu_width=$menu.width();var x=doc_width-offset.left-menu_width-2;if(x<0){$menu.offset({left:offset.left+x}).width(menu_width);}}},0);});window.addEventListener('blur',function(e){self._hideAccessKeyOverlay();});core.bus.on('click',this,function(ev){$('.tooltip').remove();if(!$(ev.target).is('input[type=file]')){$(this.el.getElementsByClassName('oe_dropdown_menu oe_opened')).removeClass('oe_opened');$(this.el.getElementsByClassName('oe_dropdown_toggle oe_opened')).removeClass('oe_opened');}
this._hideAccessKeyOverlay();});core.bus.on('connection_lost',this,this._onConnectionLost);core.bus.on('connection_restored',this,this._onConnectionRestored);core.bus.on('rpc_error',crash_manager,crash_manager.rpc_error);window.onerror=function(message,file,line,col,error){if(!file&&!line&&!col){if(window.onOriginError){window.onOriginError();delete window.onOriginError;}else{crash_manager.show_error({type:_t("Odoo Client Error"),message:_t("Unknown CORS error"),data:{debug:_t("An unknown CORS error occured. The error probably originates from a JavaScript file served from a different origin. (Opening your browser console might give you a hint on the error.)")},});}}else{if(!error&&message==='ResizeObserver loop limit exceeded'){return;}
var traceback=error?error.stack:'';crash_manager.show_error({type:_t("Odoo Client Error"),message:message,data:{debug:file+':'+line+"\n"+_t('Traceback:')+"\n"+traceback},});}};},set_action_manager:function(){var self=this;this.action_manager=new ActionManager(this,session.user_context);var fragment=document.createDocumentFragment();return this.action_manager.appendTo(fragment).then(function(){dom.append(self.$('.o_main_content'),fragment,{in_DOM:true,callbacks:[{widget:self.action_manager}],});});},set_loading:function(){this.loading=new Loading(this);return this.loading.appendTo(this.$el);},show_application:function(){},clear_uncommitted_changes:function(){return this.action_manager.clearUncommittedChanges();},destroy_content:function(){_.each(_.clone(this.getChildren()),function(el){el.destroy();});this.$el.children().remove();},set_title:function(title){this.set_title_part("action",title);},set_title_part:function(part,title){var tmp=_.clone(this.get("title_part"));tmp[part]=title;this.set("title_part",tmp);},_title_changed:function(){var parts=_.sortBy(_.keys(this.get("title_part")),function(x){return x;});var tmp="";_.each(parts,function(part){var str=this.get("title_part")[part];if(str){tmp=tmp?tmp+" - "+str:str;}},this);document.title=tmp;},do_action:function(){return this.action_manager.doAction.apply(this.action_manager,arguments);},do_reload:function(){var self=this;return session.session_reload().then(function(){session.load_modules(true).then(self.menu.proxy('do_reload'));});},do_push_state:function(state){if(!state.menu_id&&this.menu){state.menu_id=this.menu.getCurrentPrimaryMenu();}
if('title'in state){this.set_title(state.title);delete state.title;}
var url='#'+$.param(state);this._current_state=$.deparam($.param(state),false);$.bbq.pushState(url);this.trigger('state_pushed',state);},current_action_updated:function(action,controller){},toggle_fullscreen:function(fullscreen){this.$el.toggleClass('o_fullscreen',fullscreen);},_onClickDropDownMenu:function(ev){ev.stopPropagation();},_onConnectionLost:function(){this.connectionNotificationID=this.call('notification','notify',{title:_t('Connection lost'),message:_t('Trying to reconnect...'),sticky:true});},_onConnectionRestored:function(){if(this.connectionNotificationID){this.call('notification','close',this.connectionNotificationID);this.call('notification','notify',{title:_t('Connection restored'),message:_t('You are back online'),sticky:false});this.connectionNotificationID=false;}},_onCreateFilter:function(e){data_manager.create_filter(e.data.filter).then(e.data.on_success);},_onDisplayWarning:function(e){var data=e.data;if(data.type==='dialog'){new Dialog(this,{size:'medium',title:data.title,$content:qweb.render("CrashManager.warning",data),}).open({shouldFocusButtons:true});}else{this.call('notification','notify',e.data);}},_onGetScrollPosition:function(ev){},_onLoadAction:function(event){data_manager.load_action(event.data.actionID,event.data.context).then(event.data.on_success);},_onPushState:function(e){this.do_push_state(e.data.state);},_onScrollTo:function(ev){},_onSetTitlePart:function(ev){var part=ev.data.part;var title=ev.data.title;this.set_title_part(part,title);},_onShowEffect:function(e){var data=e.data||{};var type=data.type||'rainbow_man';if(type==='rainbow_man'){if(session.show_effect){new RainbowMan(data).appendTo(this.$el);}else{this.call('notification','notify',{title:"",message:data.message,sticky:false});}}else{throw new Error('Unknown effect type: '+type);}},});return AbstractWebClient;});;

/* /web/static/src/js/chrome/web_client.js defined in bundle 'web.assets_backend' */
odoo.define('web.WebClient',function(require){"use strict";var AbstractWebClient=require('web.AbstractWebClient');var config=require('web.config');var core=require('web.core');var data_manager=require('web.data_manager');var dom=require('web.dom');var Menu=require('web.Menu');var session=require('web.session');return AbstractWebClient.extend({custom_events:_.extend({},AbstractWebClient.prototype.custom_events,{app_clicked:'on_app_clicked',menu_clicked:'on_menu_clicked',}),start:function(){core.bus.on('change_menu_section',this,function(menuID){this.do_push_state(_.extend($.bbq.getState(),{menu_id:menuID,}));});return this._super.apply(this,arguments);},bind_events:function(){var self=this;this._super.apply(this,arguments);this.$el.on('click','a',function(ev){var disable_anchor=ev.target.attributes.disable_anchor;if(disable_anchor&&disable_anchor.value==="true"){return;}
var href=ev.target.attributes.href;if(href){if(href.value[0]==='#'&&href.value.length>1){if(self.$("[id='"+href.value.substr(1)+"']").length){ev.preventDefault();self.trigger_up('scrollTo',{'selector':href.value});}}}});},load_menus:function(){return this._rpc({model:'ir.ui.menu',method:'load_menus',args:[config.debug],context:session.user_context,}).then(function(menuData){for(var i=0;i<menuData.children.length;i++){var child=menuData.children[i];if(child.action===false){while(child.children&&child.children.length){child=child.children[0];if(child.action){menuData.children[i].action=child.action;break;}}}}
return menuData;});},show_application:function(){var self=this;this.set_title();return this.instanciate_menu_widgets().then(function(){$(window).bind('hashchange',self.on_hashchange);if(_.isEmpty($.bbq.getState(true))){return self._rpc({model:'res.users',method:'read',args:[session.uid,["action_id"]],}).then(function(result){var data=result[0];if(data.action_id){return self.do_action(data.action_id[0]).then(function(){self.menu.change_menu_section(self.menu.action_id_to_primary_menu_id(data.action_id[0]));});}else{self.menu.openFirstApp();}});}else{return self.on_hashchange();}});},instanciate_menu_widgets:function(){var self=this;var defs=[];return this.load_menus().then(function(menuData){self.menu_data=menuData;if(self.menu){self.menu.destroy();}
self.menu=new Menu(self,menuData);defs.push(self.menu.prependTo(self.$el));return $.when.apply($,defs);});},on_hashchange:function(event){if(this._ignore_hashchange){this._ignore_hashchange=false;return $.when();}
var self=this;return this.clear_uncommitted_changes().then(function(){var stringstate=$.bbq.getState(false);if(!_.isEqual(self._current_state,stringstate)){var state=$.bbq.getState(true);if(state.sa||state.action||(state.model&&(state.view_type||state.id))){return self.action_manager.loadState(state,!!self._current_state).then(function(){if(state.menu_id){if(state.menu_id!==self.menu.current_primary_menu){core.bus.trigger('change_menu_section',state.menu_id);}}else{var action=self.action_manager.getCurrentAction();if(action){var menu_id=self.menu.action_id_to_primary_menu_id(action.id);core.bus.trigger('change_menu_section',menu_id);}}});}else if(state.menu_id){var action_id=self.menu.menu_id_to_action_id(state.menu_id);return self.do_action(action_id,{clear_breadcrumbs:true}).then(function(){core.bus.trigger('change_menu_section',state.menu_id);});}else{self.menu.openFirstApp();}}
self._current_state=stringstate;},function(){if(event){self._ignore_hashchange=true;window.location=event.originalEvent.oldURL;}});},on_app_clicked:function(ev){var self=this;return this.menu_dm.add(data_manager.load_action(ev.data.action_id)).then(function(result){return self.action_mutex.exec(function(){var completed=$.Deferred();var options=_.extend({},ev.data.options,{clear_breadcrumbs:true,action_menu_id:ev.data.menu_id,});$.when(self._openMenu(result,options)).fail(function(){completed.resolve();}).done(function(){self._on_app_clicked_done(ev).then(completed.resolve.bind(completed)).fail(completed.reject.bind(completed));});setTimeout(function(){completed.resolve();},2000);return completed;});});},_on_app_clicked_done:function(ev){core.bus.trigger('change_menu_section',ev.data.menu_id);return $.Deferred().resolve();},on_menu_clicked:function(ev){var self=this;return this.menu_dm.add(data_manager.load_action(ev.data.action_id)).then(function(result){return self.action_mutex.exec(function(){var completed=$.Deferred();$.when(self._openMenu(result,{clear_breadcrumbs:true,})).always(function(){completed.resolve();});setTimeout(function(){completed.resolve();},2000);return completed;});}).always(function(){self.$el.removeClass('o_mobile_menu_opened');});},_openMenu:function(action,options){return this.do_action(action,options);},getScrollPosition:function(){return{left:this.action_manager.el.scrollLeft,top:this.action_manager.el.scrollTop,};},_onGetScrollPosition:function(ev){ev.data.callback(this.getScrollPosition());},_onScrollTo:function(ev){var offset={top:ev.data.top,left:ev.data.left||0};if(ev.data.selector){offset=dom.getPosition(document.querySelector(ev.data.selector));offset.top-=dom.getPosition(this.action_manager.el).top;}
this.action_manager.el.scrollTop=offset.top;this.action_manager.el.scrollLeft=offset.left;},});});;

/* /web/static/src/js/chrome/root_widget.js defined in bundle 'web.assets_backend' */
odoo.define('root.widget',function(require){"use strict";var webClient=require('web.web_client');return webClient;});;

/* /web/static/src/js/_deprecated/data.js defined in bundle 'web.assets_backend' */
odoo.define('web.data',function(require){"use strict";var Class=require('web.Class');var Context=require('web.Context');var concurrency=require('web.concurrency');var mixins=require('web.mixins');var session=require('web.session');var translation=require('web.translation');var pyUtils=require('web.py_utils');var _t=translation._t;function serialize_sort(criterion){return _.map(criterion,function(criteria){if(criteria[0]==='-'){return criteria.slice(1)+' DESC';}
return criteria+' ASC';}).join(', ');}
function deserialize_sort(criterion){return _.map(criterion,function(criteria){var split=_.without(criteria.split(' '),'');return(split[1]&&split[1].toLowerCase()==='desc'?'-':'')+split[0];});}
var Query=Class.extend({init:function(model,fields){this._model=model;this._fields=fields;this._filter=[];this._context={};this._lazy=true;this._limit=false;this._offset=0;this._order_by=[];},clone:function(to_set){to_set=to_set||{};var q=new Query(this._model,this._fields);q._context=this._context;q._filter=this._filter;q._lazy=this._lazy;q._limit=this._limit;q._offset=this._offset;q._order_by=this._order_by;for(var key in to_set){if(!to_set.hasOwnProperty(key)){continue;}
switch(key){case'filter':q._filter=(q._filter||[]).concat(to_set.filter||[]);break;case'context':q._context=new Context(q._context,to_set.context);break;case'lazy':case'limit':case'offset':case'order_by':q['_'+key]=to_set[key];}}
return q;},_execute:function(options){var self=this;options=options||{};return session.rpc('/web/dataset/search_read',{model:this._model.name,fields:this._fields||false,domain:pyUtils.eval('domains',[this._model.domain(this._filter)]),context:pyUtils.eval('contexts',[this._model.context(this._context)]),offset:this._offset,limit:this._limit,sort:serialize_sort(this._order_by)},options).then(function(results){self._count=results.length;return results.records;},null);},first:function(options){var self=this;return this.clone({limit:1})._execute(options).then(function(records){delete self._count;if(records.length){return records[0];}
return null;});},all:function(options){return this._execute(options);},count:function(){if(this._count!==undefined){return $.when(this._count);}
return this._model.call('search_count',[this._filter],{context:this._model.context(this._context)});},group_by:function(grouping){var ctx=pyUtils.eval('context',this._model.context(this._context));if(_.isUndefined(grouping)){grouping=[];}
if(!(grouping instanceof Array)){grouping=_.toArray(arguments);}
if(_.isEmpty(grouping)&&!ctx.group_by_no_leaf){return null;}
var raw_fields=_.map(grouping.concat(this._fields||[]),function(field){return field.split(':')[0];});var self=this;return this._model.call('read_group',{groupby:grouping,fields:_.uniq(raw_fields),domain:this._model.domain(this._filter),context:ctx,offset:this._offset,lazy:this._lazy,limit:this._limit,orderby:serialize_sort(this._order_by)||false}).then(function(results){return _(results).map(function(result){result.__context=result.__context||{};result.__context.group_by=result.__context.group_by||[];_.defaults(result.__context,ctx);var grouping_fields=self._lazy?[grouping[0]]:grouping;return new QueryGroup(self._model.name,grouping_fields,result);});});},context:function(context){if(!context){return this;}
return this.clone({context:context});},filter:function(domain){if(!domain){return this;}
return this.clone({filter:domain});},lazy:function(lazy){return this.clone({lazy:lazy});},limit:function(limit){return this.clone({limit:limit});},offset:function(offset){return this.clone({offset:offset});},order_by:function(fields){if(fields===undefined){return this;}
if(!(fields instanceof Array)){fields=_.toArray(arguments);}
if(_.isEmpty(fields)){return this;}
return this.clone({order_by:fields});}});var QueryGroup=Class.extend({init:function(model,grouping_fields,read_group_group){var fixed_group=_.extend({__context:{group_by:[]},__domain:[]},read_group_group);var count_key=(grouping_fields[0]&&grouping_fields[0].split(':')[0])+'_count';var aggregates={};for(var key in fixed_group){if(fixed_group.hasOwnProperty(key)){if(!(key.indexOf('__')===0||_.contains(grouping_fields,key)||(key===count_key))){aggregates[key]=fixed_group[key]||0;}}}
this.model=new Model(model,fixed_group.__context,fixed_group.__domain);var group_size=fixed_group[count_key]||fixed_group.__count||0;var leaf_group=fixed_group.__context.group_by.length===0;var value=(grouping_fields.length===1)?fixed_group[grouping_fields[0]]:_.map(grouping_fields,function(field){return fixed_group[field];});var grouped_on=(grouping_fields.length===1)?grouping_fields[0]:grouping_fields;this.attributes={folded:!!(fixed_group.__fold),grouped_on:grouped_on,length:group_size,value:value,has_children:!(leaf_group&&fixed_group.__context.group_by_no_leaf),aggregates:aggregates};},get:function(key){return this.attributes[key];},subgroups:function(){return this.model.query().group_by(this.model.context().group_by);},query:function(){return this.model.query.apply(this.model,arguments);}});var DataSet=Class.extend(mixins.PropertiesMixin,{init:function(parent,model,context){mixins.PropertiesMixin.init.call(this);this.setParent(parent);this.model=model;this.context=context||{};this.index=null;this._sort=[];this._model=new Model(model,context);this.orderer=new concurrency.DropMisordered();},previous:function(){this.index-=1;if(!this.ids.length){this.index=null;}else if(this.index<0){this.index=this.ids.length-1;}
return this;},next:function(){this.index+=1;if(!this.ids.length){this.index=null;}else if(this.index>=this.ids.length){this.index=0;}
return this;},select_id:function(id){var idx=this.get_id_index(id);if(idx===null){return false;}else{this.index=idx;return true;}},get_id_index:function(id){for(var i=0,ii=this.ids.length;i<ii;i++){if(id==this.ids[i]){return i;}}
return null;},read_ids:function(ids,fields,options){if(_.isEmpty(ids))
return $.Deferred().resolve([]);options=options||{};var method='read';var ids_arg=ids;var context=this.get_context(options.context);if(options.check_access_rule===true){method='search_read';ids_arg=[['id','in',ids]];context=new Context(context,{active_test:false});}
return this._model.call(method,[ids_arg,fields||false],{context:context}).then(function(records){if(records.length<=1){return records;}
var indexes={};for(var i=0;i<ids.length;i++){indexes[ids[i]]=i;}
records.sort(function(a,b){return indexes[a.id]-indexes[b.id];});return records;});},read_slice:function(fields,options){var self=this;options=options||{};var query=this._model.query(fields).limit(options.limit||false).offset(options.offset||0).all();return this.orderer.add(query).done(function(records){self.ids=_(records).pluck('id');});},read_index:function(fields,options){options=options||{};return this.read_ids([this.ids[this.index]],fields,options).then(function(records){if(_.isEmpty(records)){return $.Deferred().reject().promise();}
return records[0];});},default_get:function(fields,options){options=options||{};return this._model.call('default_get',[fields],{context:this.get_context(options.context)});},create:function(data,options){var self=this;return this._model.call('create',[data],{context:this.get_context()}).done(function(){self.trigger('dataset_changed',data,options);});},write:function(id,data,options){options=options||{};var self=this;return this._model.call('write',[[id],data],{context:this.get_context(options.context)}).done(function(){self.trigger('dataset_changed',id,data,options);});},unlink:function(ids){var self=this;return this._model.call('unlink',[ids],{context:this.get_context()}).done(function(){self.trigger('dataset_changed',ids);});},call:function(method,args){return this._model.call(method,args);},call_button:function(method,args){return this._model.call_button(method,args);},name_get:function(ids){return this._model.call('name_get',[ids],{context:this.get_context()});},name_search:function(name,domain,operator,limit){return this._model.call('name_search',{name:name||'',args:domain||false,operator:operator||'ilike',context:this._model.context(),limit:limit||0});},name_create:function(name,context){return this._model.call('name_create',[name],{context:this.get_context(context)});},get_context:function(request_context){return this._model.context(request_context);},sort:function(field,force_reverse){if(!field){return serialize_sort(this._sort);}
var reverse=force_reverse||(this._sort[0]===field);this._sort.splice.apply(this._sort,[0,this._sort.length].concat(_.without(this._sort,field,'-'+field)));this._sort.unshift((reverse?'-':'')+field);return undefined;},set_sort:function(fields_list){this._sort=deserialize_sort(fields_list);},size:function(){return this.ids.length;},alter_ids:function(n_ids){this.ids=n_ids;},remove_ids:function(ids){this.alter_ids(_(this.ids).difference(ids));},add_ids:function(ids,at){var args=[at,0].concat(_.difference(ids,this.ids));this.ids.splice.apply(this.ids,args);},resequence:function(ids,options){options=options||{};return session.rpc('/web/dataset/resequence',{model:this.model,ids:ids,context:pyUtils.eval('context',this.get_context(options.context)),}).then(function(results){return results;});},});var DataSetStatic=DataSet.extend({init:function(parent,model,context,ids){this._super(parent,model,context);this.ids=ids||[];},read_slice:function(fields,options){options=options||{};fields=fields||{};var offset=options.offset||0,limit=options.limit||false;var end_pos=limit&&limit!==-1?offset+limit:this.ids.length;return this.read_ids(this.ids.slice(offset,end_pos),fields,options);},set_ids:function(ids){this.ids=ids;if(ids.length===0){this.index=null;}else if(this.index>=ids.length-1){this.index=ids.length-1;}},unlink:function(ids){this.set_ids(_.without.apply(null,[this.ids].concat(ids)));this.trigger('unlink',ids);return $.Deferred().resolve({result:true});},});var DataSetSearch=DataSet.extend({init:function(parent,model,context,domain){this._super(parent,model,context);this.domain=domain||[];this._length=null;this.ids=[];this._model=new Model(model,context,domain);},read_slice:function(fields,options){options=options||{};var self=this;var q=this._model.query(fields||false).filter(options.domain).context(options.context).offset(options.offset||0).limit(options.limit||false);q=q.order_by.apply(q,this._sort);return this.orderer.add(q.all()).done(function(records){q.count().done(function(count){self._length=count;});self.ids=_(records).pluck('id');});},get_domain:function(other_domain){return this._model.domain(other_domain);},alter_ids:function(ids){this._super(ids);if(this.index!==null&&this.index>=this.ids.length){this.index=this.ids.length>0?this.ids.length-1:0;}},remove_ids:function(ids){var before=this.ids.length;this._super(ids);if(this._length){this._length-=(before-this.ids.length);}},add_ids:function(ids,at){var before=this.ids.length;this._super(ids,at);if(this._length){this._length+=(this.ids.length-before);}},unlink:function(ids,callback,error_callback){var self=this;return this._super(ids).done(function(){self.remove_ids(ids);self.trigger("dataset_changed",ids,callback,error_callback);});},size:function(){if(this._length!==null){return this._length;}
return this._super();}});var data={Query:Query,DataSet:DataSet,DataSetStatic:DataSetStatic,DataSetSearch:DataSetSearch,noDisplayContent:"<em class=\"text-warning\">"+_t("Unnamed")+"</em>",};var Model=Class.extend({init:function(name,context,domain){this.name=name;this._context=context||{};this._domain=domain||[];},get_func:function(method_name){var self=this;return function(){return self.call(method_name,_.toArray(arguments));};},query:function(fields){return new data.Query(this,fields);},domain:function(domain){if(!domain){return this._domain;}
return this._domain.concat(domain);},context:function(context){return new Context(session.user_context,this._context,context||{});},call:function(method,args,kwargs,options){args=args||[];kwargs=kwargs||{};if(!_.isArray(args)){kwargs=args;args=[];}
pyUtils.ensure_evaluated(args,kwargs);var call_kw='/web/dataset/call_kw/'+this.name+'/'+method;return session.rpc(call_kw,{model:this.name,method:method,args:args,kwargs:kwargs},options);},call_button:function(method,args){pyUtils.ensure_evaluated(args,{});return session.rpc('/web/dataset/call_button',{model:this.name,method:method,domain_id:null,context_id:args.length-1,args:args||[]});},});return data;});;

/* /web/static/src/js/core/context.js defined in bundle 'web.assets_backend' */
odoo.define('web.Context',function(require){"use strict";var Class=require('web.Class');var pyUtils=require('web.py_utils');var Context=Class.extend({init:function(){this.__ref="compound_context";this.__contexts=[];this.__eval_context=null;var self=this;_.each(arguments,function(x){self.add(x);});},add:function(context){this.__contexts.push(context);return this;},eval:function(){return pyUtils.eval('context',this);},set_eval_context:function(evalContext){for(var key in evalContext){if(evalContext[key]instanceof moment){evalContext[key]=evalContext[key].toJSON();}}
this.__eval_context=evalContext;return this;},});return Context;});;

/* /web/static/src/js/core/data_comparison_utils.js defined in bundle 'web.assets_backend' */
odoo.define('web.dataComparisonUtils',function(require){"use strict";var fieldUtils=require('web.field_utils');function computeVariation(value,comparisonValue){var magnitude;var signClass;if(!isNaN(value)&&!isNaN(comparisonValue)){if(comparisonValue===0){if(value===0){magnitude=0;}else if(value>0){magnitude=1;}else{magnitude=-1;}}else{magnitude=(value-comparisonValue)/Math.abs(comparisonValue);}
if(magnitude>0){signClass=' o_positive';}else if(magnitude<0){signClass=' o_negative';}else if(magnitude===0){signClass=' o_null';}
return{magnitude:magnitude,signClass:signClass};}else{return{magnitude:NaN};}}
function renderVariation(variation,field,options){var $variation;if(!isNaN(variation.magnitude)){$variation=$('<div>',{class:'o_variation'+variation.signClass}).html(fieldUtils.format.percentage(variation.magnitude,field,options));}else{$variation=$('<div>',{class:'o_variation'}).html('-');}
return $variation;}
function renderComparison($node,value,comparisonValue,variation,formatter,field,options){var $variation=renderVariation(variation,field,options);$node.append($variation);if(!isNaN(variation.magnitude)){$node.append($('<div>',{class:'o_comparison'}).html(formatter(value,field,options)+' <span>vs</span> '+formatter(comparisonValue,field,options)));}}
return{computeVariation:computeVariation,renderComparison:renderComparison};});;

/* /web/static/src/js/core/misc.js defined in bundle 'web.assets_backend' */
odoo.define('web.framework',function(require){"use strict";var core=require('web.core');var crash_manager=require('web.crash_manager');var ajax=require('web.ajax');var Widget=require('web.Widget');var _t=core._t;var messages_by_seconds=function(){return[[0,_t("Loading...")],[20,_t("Still loading...")],[60,_t("Still loading...<br />Please be patient.")],[120,_t("Don't leave yet,<br />it's still loading...")],[300,_t("You may not believe it,<br />but the application is actually loading...")],[420,_t("Take a minute to get a coffee,<br />because it's loading...")],[3600,_t("Maybe you should consider reloading the application by pressing F5...")]];};var Throbber=Widget.extend({template:"Throbber",start:function(){this.start_time=new Date().getTime();this.act_message();},act_message:function(){var self=this;setTimeout(function(){if(self.isDestroyed())
return;var seconds=(new Date().getTime()-self.start_time)/1000;var mes;_.each(messages_by_seconds(),function(el){if(seconds>=el[0])
mes=el[1];});self.$(".oe_throbber_message").html(mes);self.act_message();},1000);},});if($.blockUI){$.blockUI.defaults.baseZ=1100;$.blockUI.defaults.message='<div class="openerp oe_blockui_spin_container" style="background-color: transparent;">';$.blockUI.defaults.css.border='0';$.blockUI.defaults.css["background-color"]='';}
function blockAccessKeys(){var elementWithAccessKey=[];elementWithAccessKey=document.querySelectorAll('[accesskey]');_.each(elementWithAccessKey,function(elem){elem.setAttribute("data-accesskey",elem.getAttribute('accesskey'));elem.removeAttribute('accesskey');});}
function unblockAccessKeys(){var elementWithDataAccessKey=[];elementWithDataAccessKey=document.querySelectorAll('[data-accesskey]');_.each(elementWithDataAccessKey,function(elem){elem.setAttribute('accesskey',elem.getAttribute('data-accesskey'));elem.removeAttribute('data-accesskey');});}
var throbbers=[];function blockUI(){var tmp=$.blockUI.apply($,arguments);var throbber=new Throbber();throbbers.push(throbber);throbber.appendTo($(".oe_blockui_spin_container"));$(document.body).addClass('o_ui_blocked');blockAccessKeys();return tmp;}
function unblockUI(){_.invoke(throbbers,'destroy');throbbers=[];$(document.body).removeClass('o_ui_blocked');unblockAccessKeys();return $.unblockUI.apply($,arguments);}
function redirect(url,wait){crash_manager.disable();var load=function(){var old=""+window.location;var old_no_hash=old.split("#")[0];var url_no_hash=url.split("#")[0];location.assign(url);if(old_no_hash===url_no_hash){location.reload(true);}};var wait_server=function(){ajax.rpc("/web/webclient/version_info",{}).done(load).fail(function(){setTimeout(wait_server,250);});};if(wait){setTimeout(wait_server,1000);}else{load();}}
function Reload(parent,action){var params=action.params||{};var menu_id=params.menu_id||false;var l=window.location;var sobj=$.deparam(l.search.substr(1));if(params.url_search){sobj=_.extend(sobj,params.url_search);}
var search='?'+$.param(sobj);var hash=l.hash;if(menu_id){hash="#menu_id="+menu_id;}
var url=l.protocol+"//"+l.host+l.pathname+search+hash;core.bus.trigger('clear_cache');redirect(url,params.wait);}
core.action_registry.add("reload",Reload);function Home(parent,action){var url='/'+(window.location.search||'');redirect(url,action&&action.params&&action.params.wait);}
core.action_registry.add("home",Home);function login(){redirect('/web/login');}
core.action_registry.add("login",login);function logout(){redirect('/web/session/logout');return $.Deferred();}
core.action_registry.add("logout",logout);function ReloadContext(parent,action){ajax.rpc("/web/session/get_session_info",{}).then(function(){Reload(parent,action);});}
core.action_registry.add("reload_context",ReloadContext);if(!document.contains){document.contains=function contains(node){if(!(0 in arguments)){throw new TypeError('1 argument is required');}
do{if(this===node){return true;}}while(node=node&&node.parentNode);return false;};}
return{blockUI:blockUI,unblockUI:unblockUI,redirect:redirect,};});;

/* /web/static/src/js/services/crash_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.CrashManager',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var Dialog=require('web.Dialog');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var map_title={user_error:_lt('Warning'),warning:_lt('Warning'),access_error:_lt('Access Error'),missing_error:_lt('Missing Record'),validation_error:_lt('Validation Error'),except_orm:_lt('Global Business Error'),access_denied:_lt('Access Denied'),};var CrashManager=core.Class.extend({init:function(){this.active=true;this.isConnected=true;},enable:function(){this.active=true;},disable:function(){this.active=false;},handleLostConnection:function(){var self=this;if(!this.isConnected){return;}
this.isConnected=false;var delay=2000;core.bus.trigger('connection_lost');setTimeout(function checkConnection(){ajax.jsonRpc('/web/webclient/version_info','call',{},{shadow:true}).then(function(){core.bus.trigger('connection_restored');self.isConnected=true;}).fail(function(){delay=(delay*1.5)+500*Math.random();setTimeout(checkConnection,delay);});},delay);},rpc_error:function(error){if(!this.active){return;}
if(this.connection_lost){return;}
if(error.code===-32098){this.handleLostConnection();return;}
var handler=core.crash_registry.get(error.data.name,true);if(handler){new(handler)(this,error).display();return;}
if(_.has(map_title,error.data.exception_type)){if(error.data.exception_type==='except_orm'){if(error.data.arguments[1]){error=_.extend({},error,{data:_.extend({},error.data,{message:error.data.arguments[1],title:error.data.arguments[0]!=='Warning'?(" - "+error.data.arguments[0]):'',})});}
else{error=_.extend({},error,{data:_.extend({},error.data,{message:error.data.arguments[0],title:'',})});}}
else{error=_.extend({},error,{data:_.extend({},error.data,{message:error.data.arguments[0],title:map_title[error.data.exception_type]!=='Warning'?(" - "+map_title[error.data.exception_type]):'',})});}
this.show_warning(error);}else{this.show_error(error);}},show_warning:function(error){if(!this.active){return;}
return new Dialog(this,{size:'medium',title:_.str.capitalize(error.type||error.message)||_t("Odoo Warning"),subtitle:error.data.title,$content:$(QWeb.render('CrashManager.warning',{error:error}))}).open({shouldFocusButtons:true});},show_error:function(error){if(!this.active){return;}
var dialog=new Dialog(this,{title:_.str.capitalize(error.type||error.message)||_t("Odoo Error"),$content:$(QWeb.render('CrashManager.error',{error:error}))});var $clipboardBtn;var clipboard;dialog.opened(function(){dialog.$(".o_error_detail").on("shown.bs.collapse",function(e){e.target.scrollTop=e.target.scrollHeight;});$clipboardBtn=dialog.$(".o_clipboard_button");$clipboardBtn.tooltip({title:_t("Copied !"),trigger:"manual",placement:"left"});clipboard=new window.ClipboardJS($clipboardBtn[0],{text:function(){return(_t("Error")+":\n"+error.message+"\n\n"+error.data.debug).trim();},container:dialog.el,});clipboard.on("success",function(e){_.defer(function(){$clipboardBtn.tooltip("show");_.delay(function(){$clipboardBtn.tooltip("hide");},800);});});});dialog.on("closed",this,function(){$clipboardBtn.tooltip('dispose');clipboard.destroy();});return dialog.open();},show_message:function(exception){return this.show_error({type:_t("Odoo Client Error"),message:exception,data:{debug:""}});},});var ExceptionHandler={init:function(parent,error){},display:function(){},};var RedirectWarningHandler=Dialog.extend(ExceptionHandler,{init:function(parent,error){this._super(parent);this.error=error;},display:function(){var self=this;var error=this.error;error.data.message=error.data.arguments[0];new Dialog(this,{size:'medium',title:_.str.capitalize(error.type)||_t("Odoo Warning"),buttons:[{text:error.data.arguments[2],classes:"btn-primary",click:function(){window.location.href='#action='+error.data.arguments[1];self.destroy();}},{text:_t("Cancel"),click:function(){self.destroy();},close:true}],$content:QWeb.render('CrashManager.warning',{error:error}),}).open();}});core.crash_registry.add('odoo.exceptions.RedirectWarning',RedirectWarningHandler);function session_expired(cm){return{display:function(){cm.show_warning({type:_t("Odoo Session Expired"),data:{message:_t("Your Odoo session expired. Please refresh the current web page.")}});}}}
core.crash_registry.add('odoo.http.SessionExpiredException',session_expired);core.crash_registry.add('werkzeug.exceptions.Forbidden',session_expired);core.crash_registry.add('504',function(cm){return{display:function(){cm.show_warning({type:_t("Request timeout"),data:{message:_t("The operation was interrupted. This usually means that the current operation is taking too much time.")}});}}});return CrashManager;});odoo.define('web.crash_manager',function(require){"use strict";var CrashManager=require('web.CrashManager');return new CrashManager();});;

/* /web/static/src/js/services/data_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.DataManager',function(require){"use strict";var core=require('web.core');var rpc=require('web.rpc');var utils=require('web.utils');return core.Class.extend({init:function(){this._init_cache();core.bus.on('clear_cache',this,this.invalidate.bind(this));},_init_cache:function(){this._cache={actions:{},fields_views:{},filters:{},views:{},};},invalidate:function(){this._init_cache();},load_action:function(action_id,additional_context){var self=this;var key=this._gen_key(action_id,additional_context||{});if(!this._cache.actions[key]){this._cache.actions[key]=rpc.query({route:"/web/action/load",params:{action_id:action_id,additional_context:additional_context,},}).then(function(action){self._cache.actions[key]=action.no_cache?null:self._cache.actions[key];return action;},this._invalidate.bind(this,this._cache.actions,key));}
return this._cache.actions[key].then(function(action){return $.extend(true,{},action);});},load_views:function(params,options){var self=this;var model=params.model;var context=params.context;var views_descr=params.views_descr;var key=this._gen_key(model,views_descr,options||{},context);if(!this._cache.views[key]){var filters_key;if(options.load_filters){filters_key=this._gen_key(model,options.action_id);options.load_filters=!this._cache.filters[filters_key];}
this._cache.views[key]=rpc.query({args:[],kwargs:{views:views_descr,options:options,context:context,},model:model,method:'load_views',}).then(function(result){utils.deepFreeze(result.fields);_.each(views_descr,function(view_descr){var toolbar=options.toolbar&&view_descr[1]!=='search';var fv_key=self._gen_key(model,view_descr[0],view_descr[1],toolbar,context);var fvg=result.fields_views[view_descr[1]];fvg.viewFields=fvg.fields;fvg.fields=result.fields;self._cache.fields_views[fv_key]=$.when(fvg);});if(result.filters){self._cache.filters[filters_key]=$.when(result.filters);}
return result.fields_views;},this._invalidate.bind(this,this._cache.views,key));}
return this._cache.views[key];},load_filters:function(dataset,action_id){var key=this._gen_key(dataset.model,action_id);if(!this._cache.filters[key]){this._cache.filters[key]=rpc.query({args:[dataset.model,action_id],kwargs:{context:dataset.get_context(),},model:'ir.filters',method:'get_filters',}).fail(this._invalidate.bind(this,this._cache.filters,key));}
return this._cache.filters[key];},create_filter:function(filter){var self=this;return rpc.query({args:[filter],model:'ir.filters',method:'create_or_replace',}).then(function(filter_id){var key=[filter.model_id,filter.action_id||false,].join(',');self._invalidate(self._cache.filters,key);return filter_id;});},delete_filter:function(filter){var self=this;return rpc.query({args:[filter.id],model:'ir.filters',method:'unlink',}).then(function(){self._cache.filters={};});},_gen_key:function(){return _.map(Array.prototype.slice.call(arguments),function(arg){if(!arg){return false;}
return _.isObject(arg)?JSON.stringify(arg):arg;}).join(',');},_invalidate:function(cache,key){delete cache[key];},});});odoo.define('web.data_manager',function(require){"use strict";var DataManager=require('web.DataManager');var data_manager=new DataManager();return data_manager;});;

/* /web/static/src/js/services/report_service.js defined in bundle 'web.assets_backend' */
odoo.define('web.ReportService',function(require){"use strict";var AbstractService=require('web.AbstractService');var core=require('web.core');var ReportService=AbstractService.extend({dependencies:['ajax'],checkWkhtmltopdf:function(){if(!this.wkhtmltopdfState){this.wkhtmltopdfState=this._rpc({route:'/report/check_wkhtmltopdf'});}
return this.wkhtmltopdfState;},});core.serviceRegistry.add('report',ReportService);return ReportService;});;

/* /web/static/src/js/services/session.js defined in bundle 'web.assets_backend' */
odoo.define('web.session',function(require){"use strict";var Session=require('web.Session');var modules=odoo._modules;var session=new Session(undefined,undefined,{modules:modules,use_cors:false});session.is_bound=session.session_bind();return session;});;

/* /web/static/src/js/services/notification_service.js defined in bundle 'web.assets_backend' */
odoo.define('web.NotificationService',function(require){"use strict";var AbstractService=require('web.AbstractService');var Notification=require('web.Notification');var core=require('web.core');var id=0;var NotificationService=AbstractService.extend({custom_events:{close:'_onCloseNotification',},start:function(){this._super.apply(this,arguments);this.notifications={};},close:function(notificationId,silent){var notification=this.notifications[notificationId];if(!notification){return;}
notification.close(silent);},notify:function(params){if(!this.$el){this.$el=$('<div class="o_notification_manager"/>');this.$el.prependTo('body');}
var NotificationWidget=params.Notification||Notification;var notification=this.notifications[++id]=new NotificationWidget(this,params);notification.appendTo(this.$el);return id;},_onCloseNotification:function(ev){ev.stopPropagation();for(var notificationId in this.notifications){if(this.notifications[notificationId]===ev.target){delete this.notifications[notificationId];break;}}},});core.serviceRegistry.add('notification',NotificationService);return NotificationService;});;

/* /web/static/src/js/widgets/auto_complete.js defined in bundle 'web.assets_backend' */
odoo.define('web.AutoComplete',function(require){"use strict";var Widget=require('web.Widget');return Widget.extend({template:"SearchView.autocomplete",init:function(parent,options){this._super(parent);this.$input=parent.$el;this.source=options.source;this.select=options.select;this.get_search_string=options.get_search_string;this.current_result=null;this.searching=true;this.search_string='';this.current_search=null;this._isInputComposing=false;},start:function(){var self=this;this.$input.on('compositionend',function(ev){self._isInputComposing=false;});this.$input.on('compositionstart',function(ev){self._isInputComposing=true;});this.$input.on('keyup',function(ev){if(ev.which===$.ui.keyCode.RIGHT&&!self._isInputComposing){self.searching=true;ev.preventDefault();return;}
if(ev.which===$.ui.keyCode.ENTER&&!self._isInputComposing){if(self.search_string.length){self.select_item(ev);}
return;}
self._updateSearch();});this.$input.on('input',function(ev){if(ev.originalEvent&&ev.originalEvent.inputType==='insertCompositionText'){self._updateSearch();}});this.$input.on('keypress',function(ev){self.search_string=self.search_string+String.fromCharCode(ev.which);if(self.search_string.length){self.searching=true;var search_string=self.search_string;self.initiate_search(search_string);}else{self.close();}});this.$input.on('keydown',function(ev){if(self._isInputComposing){return;}
switch(ev.which){case $.ui.keyCode.ENTER:case $.ui.keyCode.TAB:if(self.search_string.length){self.select_item(ev);}
break;case $.ui.keyCode.DOWN:self.move('down');self.searching=false;ev.preventDefault();break;case $.ui.keyCode.UP:self.move('up');self.searching=false;ev.preventDefault();break;case $.ui.keyCode.RIGHT:self.searching=false;var current=self.current_result;if(current&&current.expand&&!current.expanded){self.expand();self.searching=true;}
ev.preventDefault();break;case $.ui.keyCode.ESCAPE:self.close();self.searching=false;break;}});},initiate_search:function(query){if(query===this.search_string&&query!==this.current_search){this.search(query);}},search:function(query){var self=this;this.current_search=query;this.source({term:query},function(results){if(results.length){self.render_search_results(results);self.focus_element(self.$('li:first-child'));}else{self.close();}});},render_search_results:function(results){var self=this;var $list=this.$el;$list.empty();results.forEach(function(result){var $item=self.make_list_item(result).appendTo($list);result.$el=$item;});this.el.onmousemove=function(ev){self.$('li').each(function(index,li){li.onmouseenter=self.focus_element.bind(self,$(li));});var targetFocus=ev.target.tagName==='LI'?ev.target:ev.target.closest('li');self.focus_element($(targetFocus));self.el.onmousemove=null;};this.show();},make_list_item:function(result){var self=this;var $li=$('<li>').mousedown(function(ev){if(ev.button===0){self.select(ev,{item:{facet:result.facet}});self.close();}}).data('result',result);if(result.expand){var $expand=$('<a class="o-expand" href="#">').appendTo($li);$expand.mousedown(function(ev){ev.stopPropagation();ev.preventDefault();if(result.expanded){self.fold();}else{self.expand();}});$expand.click(function(ev){ev.preventDefault();});result.expanded=false;}
if(result.indent)$li.addClass('o-indent');$li.append($('<a href="#">').html(result.label));return $li;},expand:function(){var self=this;var current_result=this.current_result;current_result.expand(this.get_search_string()).then(function(results){(results||[{label:'(no result)'}]).reverse().forEach(function(result){result.indent=true;var $li=self.make_list_item(result);current_result.$el.after($li);});self.current_result.expanded=true;self.current_result.$el.find('a.o-expand').removeClass('o-expand').addClass('o-expanded');});},fold:function(){var $next=this.current_result.$el.next();while($next.hasClass('o-indent')){$next.remove();$next=this.current_result.$el.next();}
this.current_result.expanded=false;this.current_result.$el.find('a.o-expanded').removeClass('o-expanded').addClass('o-expand');},focus_element:function($li){this.$('li').removeClass('o-selection-focus');$li.addClass('o-selection-focus');this.current_result=$li.data('result');},select_item:function(ev){if(this.current_result.facet){this.select(ev,{item:{facet:this.current_result.facet}});this.close();}},show:function(){this.$el.show();},close:function(){this.current_search=null;this.search_string='';this.searching=true;this.$el.hide();},move:function(direction){var $next;if(direction==='down'){$next=this.$('li.o-selection-focus').next();if(!$next.length)$next=this.$('li').first();}else{$next=this.$('li.o-selection-focus').prev();if(!$next.length)$next=this.$('li').last();}
this.focus_element($next);},is_expandable:function(){return!!this.$('.o-selection-focus .o-expand').length;},is_expanded:function(){return this.$el[0].style.display==="block";},_updateSearch:function(){var search_string=this.get_search_string();if(this.search_string!==search_string){if(search_string.length){this.search_string=search_string;this.initiate_search(search_string);}else{this.close();}}},});});;

/* /web/static/src/js/widgets/change_password.js defined in bundle 'web.assets_backend' */
odoo.define('web.ChangePassword',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var core=require('web.core');var Dialog=require('web.Dialog');var web_client=require('web.web_client');var _t=core._t;var ChangePassword=AbstractAction.extend({template:"ChangePassword",start:function(){var self=this;web_client.set_title(_t("Change Password"));var $button=self.$('.oe_form_button');$button.appendTo(this.getParent().$footer);$button.eq(1).click(function(){self.$el.parents('.modal').modal('hide');});$button.eq(0).click(function(){self._rpc({route:'/web/session/change_password',params:{fields:$('form[name=change_password_form]').serializeArray()}}).done(function(result){if(result.error){self._display_error(result);}else{self.do_action('logout');}});});},_display_error:function(error){return new Dialog(this,{size:'medium',title:error.title,$content:$('<div>').html(error.error)}).open();},});core.action_registry.add("change_password",ChangePassword);return ChangePassword;});;

/* /web/static/src/js/tools/debug_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web.DebugManager',function(require){"use strict";var ActionManager=require('web.ActionManager');var dialogs=require('web.view_dialogs');var startClickEverywhere=require('web.clickEverywhere');var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var field_utils=require('web.field_utils');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var utils=require('web.utils');var WebClient=require('web.WebClient');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var DebugManager=Widget.extend({template:"WebClient.DebugManager",events:{"click a[data-action]":"perform_callback","mouseover .o_debug_dropdowns > li:not(.show)":function(e){var $opened=this.$('.o_debug_dropdowns > li.show');if($opened.length){$opened.removeClass('show');$(e.currentTarget).addClass('show').find('> a').focus();}},},init:function(){this._super.apply(this,arguments);this._update_stats=_.throttle(this._update_stats.bind(this),1000/15,{leading:false});this._events=null;if(document.querySelector('meta[name=debug]')){this._events=[];}},start:function(){core.bus.on('rpc:result',this,function(req,resp){this._debug_events(resp.debug);});this.on('update-stats',this,this._update_stats);var init;if((init=document.querySelector('meta[name=debug]'))){this._debug_events(JSON.parse(init.getAttribute('value')));}
this.$dropdown=this.$(".o_debug_dropdown");this._features_group=null;this._has_features=false;this._is_admin=session.is_system;return $.when(this._rpc({model:'res.users',method:'check_access_rights',kwargs:{operation:'write',raise_exception:false},}),session.user_has_group('base.group_no_one'),this._rpc({model:'ir.model.data',method:'xmlid_to_res_id',kwargs:{xmlid:'base.group_no_one'},}),this._super()).then(function(can_write_user,has_group_no_one,group_no_one_id){this._features_group=can_write_user&&group_no_one_id;this._has_features=has_group_no_one;return this.update();}.bind(this));},leave_debug_mode:function(){var qs=$.deparam.querystring();delete qs.debug;window.location.search='?'+$.param(qs);},perform_callback:function(evt){evt.preventDefault();var params=$(evt.target).data();var callback=params.action;if(callback&&this[callback]){this[callback](params,evt);}else{console.warn("No handler for ",callback);}},_debug_events:function(events){if(!this._events){return;}
if(events&&events.length){this._events.push(events);}
this.trigger('update-stats',this._events);},requests_clear:function(){if(!this._events){return;}
this._events=[];this.trigger('update-stats',this._events);},_update_stats:function(rqs){var requests=0,rtime=0,queries=0,qtime=0;for(var r=0;r<rqs.length;++r){for(var i=0;i<rqs[r].length;i++){var event=rqs[r][i];var query_start,request_start;switch(event[0]){case'request-start':request_start=event[3]*1e3;break;case'request-end':++requests;rtime+=(event[3]*1e3-request_start)|0;break;case'sql-start':query_start=event[3]*1e3;break;case'sql-end':++queries;qtime+=(event[3]*1e3-query_start)|0;break;}}}
this.$('#debugmanager_requests_stats').text(_.str.sprintf(_t("%d requests (%d ms) %d queries (%d ms)"),requests,rtime,queries,qtime));},show_timelines:function(){if(this._overlay){this._overlay.destroy();this._overlay=null;return;}
this._overlay=new RequestsOverlay(this);this._overlay.appendTo(document.body);},update:function(){this.$dropdown.empty().append(QWeb.render('WebClient.DebugManager.Global',{manager:this,}));return $.when();},select_view:function(){var self=this;new dialogs.SelectCreateDialog(this,{res_model:'ir.ui.view',title:_t('Select a view'),disable_multiple_selection:true,domain:[['type','!=','qweb'],['type','!=','search']],on_selected:function(records){self._rpc({model:'ir.ui.view',method:'search_read',domain:[['id','=',records[0].id]],fields:['name','model','type'],limit:1,}).then(function(views){var view=views[0];view.type=view.type==='tree'?'list':view.type;self.do_action({type:'ir.actions.act_window',name:view.name,res_model:view.model,views:[[view.id,view.type]]});});}}).open();},perform_js_tests:function(){this.do_action({name:_t("JS Tests"),target:'new',type:'ir.actions.act_url',url:'/web/tests?mod=*'});},perform_js_mobile_tests:function(){this.do_action({name:_t("JS Mobile Tests"),target:'new',type:'ir.actions.act_url',url:'/web/tests/mobile?mod=*'});},perform_click_everywhere_test:function(){startClickEverywhere();},split_assets:function(){window.location=$.param.querystring(window.location.href,'debug=assets');},regenerateAssets:function(){var self=this;var domain=[['res_model','=','ir.ui.view'],['name','like','assets_']];this._rpc({model:'ir.attachment',method:'search',args:[domain],}).then(function(ids){self._rpc({model:'ir.attachment',method:'unlink',args:[ids],}).then(self.do_action('reload'));});}});DebugManager.include({update:function(tag,descriptor){if(tag==='action'){this._action=descriptor;}
return this._super().then(function(){this.$dropdown.find(".o_debug_leave_section").before(QWeb.render('WebClient.DebugManager.Action',{manager:this,action:this._action}));}.bind(this));},edit:function(params,evt){this.do_action({res_model:params.model,res_id:params.id,name:evt.target.text,type:'ir.actions.act_window',views:[[false,'form']],view_mode:'form',target:'new',flags:{action_buttons:true,headless:true}});},get_view_fields:function(){var model=this._action.res_model,self=this;this._rpc({model:'ir.model',method:'search',args:[[['model','=',model]]]}).done(function(ids){self.do_action({res_model:'ir.model.fields',name:_t('View Fields'),views:[[false,'list'],[false,'form']],domain:[['model_id','=',model]],type:'ir.actions.act_window',context:{'default_model_id':ids[0]}});});},manage_filters:function(){this.do_action({res_model:'ir.filters',name:_t('Manage Filters'),views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',context:{search_default_my_filters:true,search_default_model_id:this._action.res_model}});},translate:function(){this._rpc({model:'ir.translation',method:'get_technical_translations',args:[this._action.res_model],}).then(this.do_action);}});DebugManager.include({start:function(){this._can_edit_views=false;return $.when(this._super(),this._rpc({model:'ir.ui.view',method:'check_access_rights',kwargs:{operation:'write',raise_exception:false},}).then(function(ar){this._can_edit_views=ar;}.bind(this)));},update:function(tag,descriptor,widget){if(tag==='action'||tag==='view'){this._controller=widget;}
return this._super(tag,descriptor).then(function(){this.$dropdown.find(".o_debug_leave_section").before(QWeb.render('WebClient.DebugManager.View',{action:this._action,can_edit:this._can_edit_views,controller:this._controller,manager:this,searchview:this._controller&&this._controller.searchView,view:this._controller&&_.findWhere(this._action.views,{type:this._controller.viewType,}),}));}.bind(this));},get_attachments:function(){var selectedIDs=this._controller.getSelectedIds();if(!selectedIDs.length){console.warn(_t("No attachment available"));return;}
this.do_action({res_model:'ir.attachment',name:_t('Manage Attachments'),views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',domain:[['res_model','=',this._action.res_model],['res_id','=',selectedIDs[0]]],context:{default_res_model:this._action.res_model,default_res_id:selectedIDs[0],},});},get_metadata:function(){var self=this;var selectedIDs=this._controller.getSelectedIds();if(!selectedIDs.length){console.warn(_t("No metadata available"));return;}
this._rpc({model:this._action.res_model,method:'get_metadata',args:[selectedIDs],}).done(function(result){var metadata=result[0];metadata.creator=field_utils.format.many2one(metadata.create_uid);metadata.lastModifiedBy=field_utils.format.many2one(metadata.write_uid);var createDate=field_utils.parse.datetime(metadata.create_date);metadata.create_date=field_utils.format.datetime(createDate);var modificationDate=field_utils.parse.datetime(metadata.write_date);metadata.write_date=field_utils.format.datetime(modificationDate);var dialog=new Dialog(this,{title:_.str.sprintf(_t("Metadata (%s)"),self._action.res_model),size:'medium',$content:QWeb.render('WebClient.DebugViewLog',{perm:metadata,})});dialog.open().opened(function(){dialog.$el.on('click','a[data-action="toggle_noupdate"]',function(ev){ev.preventDefault();self._rpc({model:'ir.model.data',method:'toggle_noupdate',args:[self._action.res_model,metadata.id]}).then(function(res){dialog.close();self.get_metadata();})});})});},set_defaults:function(){var self=this;var display=function(fieldInfo,value){var displayed=value;if(value&&fieldInfo.type==='many2one'){displayed=value.data.display_name;value=value.data.id;}else if(value&&fieldInfo.type==='selection'){displayed=_.find(fieldInfo.selection,function(option){return option[0]===value;})[1];}
return[value,displayed];};var renderer=this._controller.renderer;var state=renderer.state;var fields=state.fields;var fieldsInfo=state.fieldsInfo.form;var fieldNamesInView=state.getFieldNames();var fieldNamesOnlyOnView=['message_attachment_count'];var fieldsValues=state.data;var modifierDatas={};_.each(fieldNamesInView,function(fieldName){modifierDatas[fieldName]=_.find(renderer.allModifiersData,function(modifierdata){return modifierdata.node.attrs.name===fieldName;});});this.fields=_.chain(fieldNamesInView).difference(fieldNamesOnlyOnView).map(function(fieldName){var modifierData=modifierDatas[fieldName];var invisibleOrReadOnly;if(modifierData){var evaluatedModifiers=modifierData.evaluatedModifiers[state.id];invisibleOrReadOnly=evaluatedModifiers.invisible||evaluatedModifiers.readonly;}
var fieldInfo=fields[fieldName];var valueDisplayed=display(fieldInfo,fieldsValues[fieldName]);var value=valueDisplayed[0];var displayed=valueDisplayed[1];if(!value||invisibleOrReadOnly||fieldInfo.type==='one2many'||fieldInfo.type==='many2many'||fieldInfo.type==='binary'||fieldsInfo[fieldName].options.isPassword||!_.isEmpty(fieldInfo.depends)){return false;}
return{name:fieldName,string:fieldInfo.string,value:value,displayed:displayed,};}).compact().sortBy(function(field){return field.string;}).value();var conditions=_.chain(fieldNamesInView).filter(function(fieldName){var fieldInfo=fields[fieldName];return fieldInfo.change_default;}).map(function(fieldName){var fieldInfo=fields[fieldName];var valueDisplayed=display(fieldInfo,fieldsValues[fieldName]);var value=valueDisplayed[0];var displayed=valueDisplayed[1];return{name:fieldName,string:fieldInfo.string,value:value,displayed:displayed,};}).value();var d=new Dialog(this,{title:_t("Set Default"),buttons:[{text:_t("Close"),close:true},{text:_t("Save default"),click:function(){var $defaults=d.$el.find('#formview_default_fields');var fieldToSet=$defaults.val();if(!fieldToSet){$defaults.parent().addClass('o_form_invalid');return;}
var selfUser=d.$el.find('#formview_default_self').is(':checked');var condition=d.$el.find('#formview_default_conditions').val();var value=_.find(self.fields,function(field){return field.name===fieldToSet;}).value;self._rpc({model:'ir.default',method:'set',args:[self._action.res_model,fieldToSet,value,selfUser,true,condition||false,],}).done(function(){d.close();});}}]});d.args={fields:this.fields,conditions:conditions,};d.template='FormView.set_default';d.open();},fvg:function(){var self=this;var dialog=new Dialog(this,{title:_t("Fields View Get")});dialog.opened().then(function(){$('<pre>').text(utils.json_node_to_xml(self._controller.renderer.arch,true)).appendTo(dialog.$el);});dialog.open();},});function make_context(width,height,fn){var canvas=document.createElement('canvas');canvas.width=width;canvas.height=height;canvas.style.position='relative';var ctx=canvas.getContext('2d');ctx.imageSmoothingEnabled=false;ctx.mozImageSmoothingEnabled=false;ctx.oImageSmoothingEnabled=false;ctx.webkitImageSmoothingEnabled=false;fn&&fn(ctx);return ctx;}
var RequestsOverlay=Widget.extend({template:'WebClient.DebugManager.RequestsOverlay',TRACKS:8,TRACK_WIDTH:9,events:{mousemove:function(e){this.$tooltip.hide();}},init:function(){this._super.apply(this,arguments);this._render=_.throttle(this._render.bind(this),1000/15,{leading:false});},start:function(){var _super=this._super();this.$tooltip=this.$('div.o_debug_tooltip');this.getParent().on('update-stats',this,this._render);this._render();return _super;},tooltip:function(text,start,end,x,y){var top=y-this.el.offsetTop+this.el.scrollTop+1;var left=x-this.el.offsetLeft+this.el.scrollLeft+1;this.$tooltip.css({top:top,left:left}).show()[0].innerHTML=['<p>',text,' (',(end-start),'ms)','</p>'].join('');},_render:function(){var $summary=this.$('header'),w=$summary[0].clientWidth,$requests=this.$('.o_debug_requests');$summary.find('canvas').attr('width',w);var tracks=document.getElementById('o_debug_requests_summary');_.invoke(this.getChildren(),'destroy');var requests=this.getParent()._events;var bounds=this._get_bounds(requests);var scale=w/(bounds.high-bounds.low);var track_ends=_(this.TRACKS).times(_.constant(-Infinity));var ctx=tracks.getContext('2d');ctx.lineWidth=this.TRACK_WIDTH;for(var i=0;i<requests.length;i++){var request=requests[i];var rstart=Math.floor(request[0][3]*1e3);var rend=Math.ceil(request[request.length-1][3]*1e3);for(var track=0;track<track_ends.length;++track){if(track_ends[track]<rstart){break;}}
if(track>=track_ends.length){console.warn("could not find an empty summary track");continue;}
track_ends[track]=rend;ctx.save();ctx.translate(Math.floor((rstart-bounds.low)*scale),track*(this.TRACK_WIDTH+1));this._draw_request(request,ctx,0,scale);ctx.restore();new RequestDetails(this,request,scale).appendTo($requests);}},_draw_request:function(request,to_context,step,hscale,handle_event){var surfaces={request:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='blue';ctx.fillStyle='#88f';ctx.lineJoin='round';ctx.lineWidth=1;}),sql:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='red';ctx.fillStyle='#f88';ctx.lineJoin='round';ctx.lineWidth=1;}),template:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='green';ctx.fillStyle='#8f8';ctx.lineJoin='round';ctx.lineWidth=1;})};var stacks={},start=Math.floor(request[0][3]*1e3*hscale);var event_idx=0;var rect_width=to_context.lineWidth;for(var i=0;i<request.length;i++){var type,m,event=request[i];var tag=event[0],timestamp=Math.floor(event[3]*1e3*hscale)-start;if(m=/(\w+)-start/.exec(tag)){type=m[1];if(!(type in stacks)){stacks[type]=[];}
handle_event&&handle_event(event_idx,timestamp,event);stacks[type].push({timestamp:timestamp,idx:event_idx++});}else if(m=/(\w+)-end/.exec(tag)){type=m[1];var stack=stacks[type];var estart=stack.pop(),duration=Math.ceil(timestamp-estart.timestamp);handle_event&&handle_event(estart.idx,timestamp,event);var surface=surfaces[type];if(!surface){continue;}
var y=step*estart.idx;surface.rect(estart.timestamp+0.5,y+0.5,duration||1,rect_width);}}
var keys=['request','template','sql'];for(var j=0;j<keys.length;++j){var ctx=surfaces[keys[j]];ctx.fill();ctx.stroke();to_context.drawImage(ctx.canvas,0,0);}},_get_bounds:function(requests){var low=+Infinity;var high=-+Infinity;for(var i=0;i<requests.length;i++){var request=requests[i];for(var j=0;j<request.length;j++){var event=request[j];var timestamp=event[3];low=Math.min(low,timestamp);high=Math.max(high,timestamp);}}
return{low:Math.floor(low*1e3),high:Math.ceil(high*1e3)};}});var RequestDetails=Widget.extend({events:{click:function(){this._open=!this._open;this.render();},'mousemove canvas':function(e){e.stopPropagation();var y=e.y||e.offsetY||e.layerY;if(!y){return;}
var event=this._payloads[Math.floor(y/this._REQ_HEIGHT)];if(!event){return;}
this.getParent().tooltip(event.payload,event.start,event.stop,e.clientX,e.clientY);}},init:function(parent,request,scale){this._super.apply(this,arguments);this._request=request;this._open=false;this._scale=scale;this._REQ_HEIGHT=20;},start:function(){this.el.style.borderBottom='1px solid black';this.render();return this._super();},render:function(){var request_cell_height=this._REQ_HEIGHT,TITLE_WIDTH=200;var request=this._request;var req_start=request[0][3]*1e3;var req_duration=request[request.length-1][3]*1e3-req_start;var height=request_cell_height*(this._open?request.length/2:1);var cell_center=request_cell_height/2;var ctx=make_context(210+Math.ceil(req_duration*this._scale),height,function(ctx){ctx.lineWidth=cell_center;});this.$el.empty().append(ctx.canvas);var payloads=this._payloads=[];var text_ctx=make_context(TITLE_WIDTH,height,function(ctx){ctx.font='12px sans-serif';ctx.textAlign='right';ctx.textBaseline='middle';ctx.translate(0,cell_center);});ctx.save();ctx.translate(TITLE_WIDTH+10,((request_cell_height/4)|0));this.getParent()._draw_request(request,ctx,this._open?request_cell_height:0,this._scale,function(idx,timestamp,event){if(/-start$/g.test(event[0])){payloads.push({payload:event[2],start:timestamp,stop:null});var title=event[2];title=title.replace(/\s+$/,'');title=title.length<=50?title:('…'+title.slice(-49));while(text_ctx.measureText(title).width>200){title='…'+title.slice(2);}
text_ctx.fillText(title,TITLE_WIDTH,request_cell_height*idx);}else if(/-end$/g.test(event[0])){payloads[idx].stop=timestamp;}});ctx.restore();ctx.drawImage(text_ctx.canvas,0,0);}});if(config.debug){SystrayMenu.Items.push(DebugManager);WebClient.include({current_action_updated:function(action,controller){this._super.apply(this,arguments);var debugManager=_.find(this.menu.systray_menu.widgets,function(item){return item instanceof DebugManager;});debugManager.update('action',action,controller&&controller.widget);},});ActionManager.include({getCurrentActionInDialog:function(){if(this.currentDialogController){return this.actions[this.currentDialogController.actionID];}
return null;},getCurrentControllerInDialog:function(){return this.currentDialogController;},});Dialog.include({open:function(){var self=this;this.opened(function(){setTimeout(function(){var parent=self.getParent();if(parent instanceof ActionManager){var action=parent.getCurrentActionInDialog();if(action){var controller=parent.getCurrentControllerInDialog();self.debugManager=new DebugManager(self);var $header=self.$modal.find('.modal-header:first');return self.debugManager.prependTo($header).then(function(){self.debugManager.update('action',action,controller.widget);});}}},0);});return this._super.apply(this,arguments);},});}
return DebugManager;});;

/* /web/static/src/js/tools/test_menus_loader.js defined in bundle 'web.assets_backend' */
odoo.define('web.clickEverywhere',function(require){"use strict";var ajax=require('web.ajax');function startClickEverywhere(){ajax.loadJS('web/static/src/js/tools/test_menus.js').then(function(){clickEverywhere();});}
return startClickEverywhere;});;

/* /web/static/src/js/widgets/data_export.js defined in bundle 'web.assets_backend' */
odoo.define('web.DataExport',function(require){"use strict";var core=require('web.core');var crash_manager=require('web.crash_manager');var data=require('web.data');var Dialog=require('web.Dialog');var framework=require('web.framework');var pyUtils=require('web.py_utils');var QWeb=core.qweb;var _t=core._t;var DataExport=Dialog.extend({template:'ExportDialog',events:{'click .o_expand':function(e){this.on_expand_action(this.records[$(e.target).closest('.o_export_tree_item').data('id')]);},'click .o_export_tree_item':function(e){e.stopPropagation();var $elem=$(e.currentTarget);var row_index=$elem.prevAll('.o_export_tree_item').length;var row_index_level=$elem.parents('.o_export_tree_item').length;if(e.shiftKey&&row_index_level===this.row_index_level){var minIndex=Math.min(row_index,this.row_index);var maxIndex=Math.max(row_index,this.row_index);this.$records.filter(function(){return($elem.parent()[0]===$(this).parent()[0]);}).slice(minIndex,maxIndex+1).addClass('o_selected').filter(':not(:last)').each(process_children);}
this.row_index=row_index;this.row_index_level=row_index_level;if(e.ctrlKey){$elem.toggleClass('o_selected').focus();}else if(e.shiftKey){$elem.addClass('o_selected').focus();}else{this.$(".o_selected").removeClass("o_selected")
$elem.addClass("o_selected").focus();}
function process_children(){var $this=$(this);if($this.hasClass('show')){$this.children('.o_export_tree_item').addClass('o_selected').each(process_children);}}},'dblclick .o_export_tree_item:not(.haschild)':function(e){var self=this;function addElement(el){self.add_field(el.getAttribute('data-id'),el.querySelector('.o_tree_column').textContent);}
var target=e.currentTarget;target.classList.remove('o_selected');[].reverse.call($(target).parents('.o_export_tree_item')).each(function(){addElement(this);});addElement(target);},'keydown .o_export_tree_item':function(e){e.stopPropagation();var $elem=$(e.currentTarget);var record=this.records[$elem.data('id')];switch(e.keyCode||e.which){case $.ui.keyCode.LEFT:if($elem.hasClass('show')){this.on_expand_action(record);}
break;case $.ui.keyCode.RIGHT:if(!$elem.hasClass('show')){this.on_expand_action(record);}
break;case $.ui.keyCode.UP:var $prev=$elem.prev('.o_export_tree_item');if($prev.length===1){while($prev.hasClass('show')){$prev=$prev.children('.o_export_tree_item').last();}}else{$prev=$elem.parent('.o_export_tree_item');if($prev.length===0){break;}}
$elem.removeClass("o_selected").blur();$prev.addClass("o_selected").focus();break;case $.ui.keyCode.DOWN:var $next;if($elem.hasClass('show')){$next=$elem.children('.o_export_tree_item').first();}else{$next=$elem.next('.o_export_tree_item');if($next.length===0){$next=$elem.parent('.o_export_tree_item').next('.o_export_tree_item');if($next.length===0){break;}}}
$elem.removeClass("o_selected").blur();$next.addClass("o_selected").focus();break;}},'click .o_add_field':function(){var self=this;this.$('.o_field_tree_structure .o_selected').removeClass('o_selected').each(function(){var $this=$(this);self.add_field($this.data('id'),$this.children('.o_tree_column').text());});},'click .o_remove_field':function(){this.$fields_list.find('option:selected').remove();},'click .o_remove_all_field':function(){this.$fields_list.empty();},'click .o_move_up':function(){var $selected_rows=this.$fields_list.find('option:selected');var $prev_row=$selected_rows.first().prev();if($prev_row.length){$prev_row.before($selected_rows.detach());}},'click .o_move_down':function(){var $selected_rows=this.$fields_list.find('option:selected');var $next_row=$selected_rows.last().next();if($next_row.length){$next_row.after($selected_rows.detach());}},'click .o_toggle_save_list':function(e){e.preventDefault();var $saveList=this.$(".o_save_list");if($saveList.is(':empty')){$saveList.append(QWeb.render('Export.SaveList'));}else{if($saveList.is(':hidden')){$saveList.show();$saveList.find(".o_export_list_input").val("");}else{$saveList.hide();}}},'click .o_save_list > button':function(e){var $saveList=this.$(".o_save_list");var value=$saveList.find("input").val();if(!value){Dialog.alert(this,_t("Please enter save field list name"));return;}
var fields=this.get_fields();if(fields.length===0){return;}
$saveList.hide();var self=this;this.exports.create({name:value,resource:this.record.model,export_fields:_.map(fields,function(field){return[0,0,{name:field}];}),}).then(function(export_list_id){if(!export_list_id){return;}
var $select=self.$(".o_exported_lists_select");if($select.length===0||$select.is(":hidden")){self.show_exports_list();}
$select.append(new Option(value,export_list_id));});},},init:function(parent,record,defaultExportFields){var options={title:_t("Export Data"),buttons:[{text:_t("Export To File"),click:this.export_data,classes:"btn-primary"},{text:_t("Close"),close:true},],};this._super(parent,options);this.records={};this.record=record;this.defaultExportFields=defaultExportFields;this.exports=new data.DataSetSearch(this,'ir.exports',this.record.getContext());this.row_index=0;this.row_index_level=0;},start:function(){var self=this;var waitFor=[this._super.apply(this,arguments)];this.$modal.find(".modal-content").css("height","100%");this.$fields_list=this.$('.o_fields_list');this.$import_compat_radios=this.$('.o_import_compat input');waitFor.push(this._rpc({route:'/web/export/formats'}).then(do_setup_export_formats));var got_fields=new $.Deferred();this.$import_compat_radios.change(function(e){self.isCompatibleMode=!!$(e.target).val();self.$('.o_field_tree_structure').remove();self._rpc({route:'/web/export/get_fields',params:{model:self.record.model,import_compat:self.isCompatibleMode,},}).done(function(records){var compatible_fields=_.map(records,function(record){return record.id;});self.$fields_list.find('option').filter(function(){var option_field=$(this).attr('value');if(compatible_fields.indexOf(option_field)===-1){return true;}}).remove();got_fields.resolve();self.on_show_data(records);if(self.isCompatibleMode){self.$('.o_fields_list').prepend(new Option(_('External ID'),'id'));}
_.each(records,function(record){if(_.contains(self.defaultExportFields,record.id)){self.add_field(record.id,record.string);}});});}).eq(0).change();waitFor.push(got_fields);waitFor.push(this.getParent().getActiveDomain().then(function(domain){if(domain===undefined){self.ids_to_export=self.getParent().getSelectedIds();self.domain=self.record.domain;}else{self.ids_to_export=false;self.domain=domain;}}));waitFor.push(this.show_exports_list().then(function(){_.each(self.records,function(record,key){if(_.contains(self.defaultExportFields,key)){self.add_field(key,record.string);}});}));return $.when.apply($,waitFor);function do_setup_export_formats(formats){var $fmts=self.$('.o_export_format');_.each(formats,function(format,i){var $radio=$('<input/>',{type:'radio',value:format.tag,name:'o_export_format_name'});var $label=$('<span/>',{html:format.label});if(format.error){$radio.prop('disabled',true);$label.html(_.str.sprintf("%s — %s",format.label,format.error));}
var $radioButton=$('<label/>').append($radio,$label);$fmts.append($("<div class='radio'></div>").append($radioButton));});self.$export_format_inputs=$fmts.find('input');self.$export_format_inputs.filter(':enabled').first().prop('checked',true);}},show_exports_list:function(){if(this.$('.o_exported_lists_select').is(':hidden')){this.$('.o_exported_lists').show();return $.when();}
var self=this;return this._rpc({model:'ir.exports',method:'search_read',fields:['name'],domain:[['resource','=',this.record.model]]}).then(function(export_list){if(!export_list.length){return;}
self.$('.o_exported_lists').append(QWeb.render('Export.SavedList',{'existing_exports':export_list}));self.$('.o_exported_lists_select').on('change',function(){self.$fields_list.empty();var export_id=self.$('.o_exported_lists_select option:selected').val();if(export_id){self._rpc({route:'/web/export/namelist',params:{model:self.record.model,export_id:parseInt(export_id,10),},}).then(do_load_export_field);}});self.$('.o_delete_exported_list').click(function(){var select_exp=self.$('.o_exported_lists_select option:selected');var options={confirm_callback:function(){if(select_exp.val()){self.exports.unlink([parseInt(select_exp.val(),10)]);select_exp.remove();self.$fields_list.empty();if(self.$('.o_exported_lists_select option').length<=1){self.$('.o_exported_lists').hide();}}}};Dialog.confirm(this,_t("Do you really want to delete this export template?"),options);});});function do_load_export_field(field_list){_.each(field_list,function(field){self.$fields_list.append(new Option(field.label,field.name));});}},on_expand_action:function(record){if(!record['children']){return;}
var model=record['params']['model'];var prefix=record['params']['prefix'];var name=record['params']['name'];var exclude_fields=[];if(record['relation_field']){exclude_fields.push(record['relation_field']);}
if(!record.loaded){var self=this;this._rpc({route:'/web/export/get_fields',params:{model:model,prefix:prefix,parent_name:name,import_compat:!!this.$import_compat_radios.filter(':checked').val(),parent_field_type:record['field_type'],parent_field:record['params']['parent_field'],exclude:exclude_fields,},}).done(function(results){record.loaded=true;self.on_show_data(results,record.id);});}else{this.show_content(record.id);}},on_show_data:function(records,expansion){var self=this;if(expansion){this.$('.o_export_tree_item[data-id="'+expansion+'"]').addClass('show').find('.o_expand_parent').toggleClass('fa-chevron-right fa-chevron-down').next().after(QWeb.render('Export.TreeItems',{'fields':records,'debug':this.getSession().debug}));}else{this.$('.o_left_field_panel').empty().append($("<div/>").addClass('o_field_tree_structure').append(QWeb.render('Export.TreeItems',{'fields':records,'debug':this.getSession().debug})));this.records={};}
_.extend(this.records,_.object(_.pluck(records,'id'),records));this.$records=this.$(".o_export_tree_item");this.$records.each(function(i,el){var $elem=$(el);$elem.find('.o_tree_column').first().toggleClass('o_required',!!self.records[$elem.data('id')].required);});},show_content:function(id){var $this=this.$('.o_export_tree_item[data-id="'+id+'"]');$this.toggleClass('show');var is_open=$this.hasClass('show');$this.children('.o_expand_parent').toggleClass('fa-chevron-down',!!is_open).toggleClass('fa-chevron-right',!is_open);var $child_field=$this.find('.o_export_tree_item');var child_len=(id.split("/")).length+1;for(var i=0;i<$child_field.length;i++){var $child=$child_field.eq(i);if(!is_open){$child.hide();}else if(child_len===$child_field.eq(i).data('id').split("/").length){if($child.hasClass('show')){$child.removeClass('show');$child.children('.o_expand_parent').removeClass('fa-chevron-down').addClass('fa-chevron-right');}
$child.show();}}},add_field:function(field_id,string){var $field_list=this.$('.o_fields_list');field_id=this.records[field_id].value||field_id;if($field_list.find("option[value='"+field_id+"']").length===0){$field_list.append(new Option(string,field_id));}},get_fields:function(){var $export_fields=this.$(".o_fields_list option").map(function(){return $(this).val();}).get();if($export_fields.length===0){Dialog.alert(this,_t("Please select fields to save export list..."));}
return $export_fields;},export_data:function(){var self=this;var exported_fields=this.$('.o_fields_list option').map(function(){return{name:(self.records[this.value]||this).value,label:this.textContent||this.innerText};}).get();if(_.isEmpty(exported_fields)){Dialog.alert(this,_t("Please select fields to export..."));return;}
if(!this.isCompatibleMode){exported_fields.unshift({name:'id',label:_t('External ID')});}
var export_format=this.$export_format_inputs.filter(':checked').val();framework.blockUI();this.getSession().get_file({url:'/web/export/'+export_format,data:{data:JSON.stringify({model:this.record.model,fields:exported_fields,ids:this.ids_to_export,domain:this.domain,context:pyUtils.eval('contexts',[this.record.getContext()]),import_compat:!!this.$import_compat_radios.filter(':checked').val(),})},complete:framework.unblockUI,error:crash_manager.rpc_error.bind(crash_manager),});},});return DataExport;});;

/* /web/static/src/js/widgets/date_picker.js defined in bundle 'web.assets_backend' */
odoo.define('web.datepicker',function(require){"use strict";var core=require('web.core');var field_utils=require('web.field_utils');var time=require('web.time');var Widget=require('web.Widget');var _t=core._t;var DateWidget=Widget.extend({template:"web.datepicker",type_of_date:"date",events:{'change.datetimepicker':'changeDatetime','error.datetimepicker':'errorDatetime','change .o_datepicker_input':'changeDatetime','input input':'_onInput','keydown':'_onKeydown','show.datetimepicker':'_onDateTimePickerShow',},init:function(parent,options){this._super.apply(this,arguments);this.name=parent.name;this.options=_.extend({locale:moment.locale(),format:this.type_of_date==='datetime'?time.getLangDatetimeFormat():time.getLangDateFormat(),minDate:moment({y:1900}),maxDate:moment({y:9999,M:11,d:31}),useCurrent:false,icons:{time:'fa fa-clock-o',date:'fa fa-calendar',up:'fa fa-chevron-up',down:'fa fa-chevron-down',previous:'fa fa-chevron-left',next:'fa fa-chevron-right',today:'fa fa-calendar-check-o',clear:'fa fa-trash',close:'fa fa-times'},calendarWeeks:true,buttons:{showToday:false,showClear:false,showClose:false,},widgetParent:'body',keyBinds:null,allowInputToggle:true,},options||{});this.__libInput=0;},start:function(){this.$input=this.$('input.o_datepicker_input');this.__libInput++;this.$el.datetimepicker(this.options);this.__libInput--;this._setReadonly(false);},destroy:function(){this.__libInput++;this.$el.datetimepicker('destroy');this.__libInput--;this._super.apply(this,arguments);},changeDatetime:function(){if(this.__libInput>0){if(this.options.warn_future){this._warnFuture(this.getValue());}
this.trigger("datetime_changed");return;}
var oldValue=this.getValue();if(this.isValid()){this._setValueFromUi();var newValue=this.getValue();var hasChanged=!oldValue!==!newValue;if(oldValue&&newValue){var formattedOldValue=oldValue.format(time.getLangDatetimeFormat());var formattedNewValue=newValue.format(time.getLangDatetimeFormat());if(formattedNewValue!==formattedOldValue){hasChanged=true;}}
if(hasChanged){if(this.options.warn_future){this._warnFuture(newValue);}
this.trigger("datetime_changed");}}else{var formattedValue=oldValue?this._formatClient(oldValue):null;this.$input.val(formattedValue);}},errorDatetime:function(e){return false;},focus:function(){this.__libInput++;this.$input.focus();this.__libInput--;},getValue:function(){var value=this.get('value');return value&&value.clone();},isValid:function(){var value=this.$input.val();if(value===""){return true;}else{try{this._parseClient(value);return true;}catch(e){return false;}}},maxDate:function(date){this.__libInput++;this.$el.datetimepicker('maxDate',date||null);this.__libInput--;},minDate:function(date){this.__libInput++;this.$el.datetimepicker('minDate',date||null);this.__libInput--;},setValue:function(value){this.set({'value':value});var formatted_value=value?this._formatClient(value):null;this.$input.val(formatted_value);this._setLibInputValue(value);},_warnFuture:function(currentDate){if(!this.$warning){this.$warning=$('<span>',{class:'fa fa-exclamation-triangle o_tz_warning o_datepicker_warning',});var title=_t("This date is on the future. Make sure it is what you expected.");this.$warning.attr('title',title);this.$input.after(this.$warning);}
if(currentDate&&currentDate.format('YYYY-MM-DD')>moment().format('YYYY-MM-DD')){this.$warning.show();}else{this.$warning.hide();}},_formatClient:function(v){return field_utils.format[this.type_of_date](v,null,{timezone:false});},_parseClient:function(v){return field_utils.parse[this.type_of_date](v,null,{timezone:false});},_setLibInputValue:function(value){this.__libInput++;this.$el.datetimepicker('date',value||null);this.__libInput--;},_setReadonly:function(readonly){this.readonly=readonly;this.$input.prop('readonly',this.readonly);},_setValueFromUi:function(){var value=this.$input.val()||false;this.setValue(this._parseClient(value));},_onDateTimePickerShow:function(){if(this.$input.val().length!==0&&this.isValid()){this.$input.select();}},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ESCAPE){this.__libInput++;this.$el.datetimepicker('hide');this.__libInput--;}},_onInput:function(ev){if(this.__libInput>0){ev.stopImmediatePropagation();}},});var DateTimeWidget=DateWidget.extend({type_of_date:"datetime",init:function(parent,options){this._super(parent,_.extend({buttons:{showToday:false,showClear:false,showClose:true,},},options||{}));},});return{DateWidget:DateWidget,DateTimeWidget:DateTimeWidget,};});;

/* /web/static/src/js/widgets/domain_selector_dialog.js defined in bundle 'web.assets_backend' */
odoo.define("web.DomainSelectorDialog",function(require){"use strict";var core=require("web.core");var Dialog=require("web.Dialog");var DomainSelector=require("web.DomainSelector");var _t=core._t;return Dialog.extend({init:function(parent,model,domain,options){this.model=model;this.options=_.extend({readonly:true,debugMode:false,},options||{});var buttons;if(this.options.readonly){buttons=[{text:_t("Close"),close:true},];}else{buttons=[{text:_t("Save"),classes:"btn-primary",close:true,click:function(){this.trigger_up("domain_selected",{domain:this.domainSelector.getDomain()});}},{text:_t("Discard"),close:true},];}
this._super(parent,_.extend({},{title:_t("Domain"),buttons:buttons,},options||{}));this.domainSelector=new DomainSelector(this,model,domain,options);},start:function(){var self=this;this.opened().then(function(){self.$el.css('overflow','visible').closest('.modal-dialog').css('height','auto');});return $.when(this._super.apply(this,arguments),this.domainSelector.appendTo(this.$el));},});});;

/* /web/static/src/js/widgets/domain_selector.js defined in bundle 'web.assets_backend' */
odoo.define("web.DomainSelector",function(require){"use strict";var core=require("web.core");var datepicker=require("web.datepicker");var Domain=require("web.Domain");var field_utils=require("web.field_utils");var ModelFieldSelector=require("web.ModelFieldSelector");var Widget=require("web.Widget");var _t=core._t;var _lt=core._lt;var operator_mapping={"=":"=","!=":_lt("is not ="),">":">","<":"<",">=":">=","<=":"<=","ilike":_lt("contains"),"not ilike":_lt("does not contain"),"in":_lt("in"),"not in":_lt("not in"),"child_of":_lt("child of"),"parent_of":_lt("parent of"),"like":"like","not like":"not like","=like":"=like","=ilike":"=ilike","set":_lt("is set"),"not set":_lt("is not set"),};var DomainNode=Widget.extend({events:{"click .o_domain_add_node_button":"_onAddButtonClick","click .o_domain_delete_node_button":"_onDeleteButtonClick","mouseenter button":"_onButtonEntered","mouseleave button":"_onButtonLeft",},init:function(parent,model,domain,options){this._super.apply(this,arguments);this.model=model;this.options=_.extend({readonly:true,operators:null,debugMode:false,},options||{});this.readonly=this.options.readonly;this.debug=this.options.debugMode;},isValid:function(){},getDomain:function(){},_onAddButtonClick:function(e){e.preventDefault();e.stopPropagation();this.trigger_up("add_node_clicked",{newBranch:!!$(e.currentTarget).data("branch"),child:this});},_onDeleteButtonClick:function(e){e.preventDefault();e.stopPropagation();this.trigger_up("delete_node_clicked",{child:this});},_onButtonEntered:function(e){e.preventDefault();e.stopPropagation();var $target=$(e.currentTarget);this.$el.toggleClass("o_hover_btns",$target.hasClass("o_domain_delete_node_button"));this.$el.toggleClass("o_hover_add_node",$target.hasClass("o_domain_add_node_button"));this.$el.toggleClass("o_hover_add_inset_node",!!$target.data("branch"));},_onButtonLeft:function(e){e.preventDefault();e.stopPropagation();this.$el.removeClass("o_hover_btns o_hover_add_node o_hover_add_inset_node");},});var DomainTree=DomainNode.extend({template:"DomainTree",events:_.extend({},DomainNode.prototype.events,{"click .o_domain_tree_operator_selector .dropdown-item":"_onOperatorChange",}),custom_events:{"add_node_clicked":"_onNodeAdditionAsk","delete_node_clicked":"_onNodeDeletionAsk",},init:function(parent,model,domain){this._super.apply(this,arguments);var parsedDomain=this._parseDomain(domain);if(parsedDomain){this._initialize(parsedDomain);}},start:function(){this._postRender();return $.when(this._super.apply(this,arguments),this._renderChildrenTo(this.$childrenContainer));},isValid:function(){for(var i=0;i<this.children.length;i++){var cValid=this.children[i].isValid();if(!cValid){return cValid;}}
return this._isValid;},getDomain:function(){var childDomains=[];var nbChildren=0;_.each(this.children,function(child){var childDomain=child.getDomain();if(childDomain.length){nbChildren++;childDomains=childDomains.concat(child.getDomain());}});var nbChildRequired=this.operator==="!"?1:2;var operators=_.times(nbChildren-nbChildRequired+1,_.constant(this.operator));return operators.concat(childDomains);},_addChild:function(domain,afterNode){var i=afterNode?_.indexOf(this.children,afterNode):this.children.length;if(i<0)return false;this.children.splice(i+1,0,instantiateNode(this,this.model,domain,this.options));this.trigger_up("domain_changed",{child:this});return true;},_addFlattenedChildren:function(domain){var node=instantiateNode(this,this.model,domain,this.options);if(node===null){return;}
if(!node.children||node.operator!==this.operator){this.children.push(node);return;}
_.each(node.children,(function(child){child.setParent(this);this.children.push(child);}).bind(this));node.destroy();},_changeOperator:function(operator,silent){this.operator=operator;if(!silent)this.trigger_up("domain_changed",{child:this});},_initialize:function(domain){this._isValid=true;this.operator=domain[0];this.children=[];if(domain.length<=1){return;}
var nbLeafsToFind=1;for(var i=1;i<domain.length;i++){if(domain[i]==="&"||domain[i]==="|"){nbLeafsToFind++;}else if(domain[i]!=="!"){nbLeafsToFind--;}
if(!nbLeafsToFind){var partLeft=domain.slice(1,i+1);var partRight=domain.slice(i+1);if(partLeft.length){this._addFlattenedChildren(partLeft);}
if(partRight.length){this._addFlattenedChildren(partRight);}
break;}}
this._isValid=(nbLeafsToFind===0);if(this.operator==="!"){this.children[0].noControlPanel=true;}},_postRender:function(){this.$childrenContainer=this.$("> .o_domain_node_children_container");},_removeChild:function(oldChild){var i=_.indexOf(this.children,oldChild);if(i<0)return false;this.children[i].destroy();this.children.splice(i,1);this.trigger_up("domain_changed",{child:this});return true;},_renderChildrenTo:function($to){var $div=$("<div/>");return $.when.apply($,_.map(this.children,(function(child){return child.appendTo($div);}).bind(this))).then((function(){_.each(this.children,function(child){child.$el.appendTo($to);});}).bind(this));},_parseDomain:function(domain){var parsedDomain=false;try{parsedDomain=Domain.prototype.stringToArray(domain);this.invalidDomain=false;}catch(err){this.invalidDomain=true;this.children=[];}
return parsedDomain;},_onOperatorChange:function(e){e.preventDefault();e.stopPropagation();this._changeOperator($(e.target).data("operator"));},_onNodeAdditionAsk:function(e){var domain=this.options.default||[["id","=",1]];if(e.data.newBranch){domain=[this.operator==="&"?"|":"&"].concat(domain).concat(domain);}
if(this._addChild(domain,e.data.child)){e.stopPropagation();}},_onNodeDeletionAsk:function(e){if(this._removeChild(e.data.child)){e.stopPropagation();}},});var DomainSelector=DomainTree.extend({template:"DomainSelector",events:_.extend({},DomainTree.prototype.events,{"click .o_domain_add_first_node_button":"_onAddFirstButtonClick","change .o_domain_debug_input":"_onDebugInputChange",}),custom_events:_.extend({},DomainTree.prototype.custom_events,{domain_changed:"_onDomainChange",}),start:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.invalidDomain){var msg=_t("This domain is not supported.");self.$el.html(msg);}});},setDomain:function(domain){if(domain===Domain.prototype.arrayToString(this.getDomain())){return $.when();}
var parsedDomain=this._parseDomain(domain);if(parsedDomain){return this._redraw(parsedDomain);}},_initialize:function(domain){if(domain.length>1){Domain.prototype.normalizeArray(domain);}else{domain=["&"].concat(domain);}
return this._super(domain);},_postRender:function(){this._super.apply(this,arguments);this.$debugInput=this.$(".o_domain_debug_input");if(this.$debugInput.length){this.$debugInput.val(Domain.prototype.arrayToString(this.getDomain()));}
if(!this._isValid){this.do_warn(_t("Domain error"),_t("The domain you entered is not properly formed"));}},_redraw:function(domain){var oldChildren=this.children.slice();this._initialize(domain||this.getDomain());return this._renderChildrenTo($("<div/>")).then((function(){_.each(oldChildren,function(child){child.destroy();});this.renderElement();this._postRender();_.each(this.children,(function(child){child.$el.appendTo(this.$childrenContainer);}).bind(this));}).bind(this));},_onAddFirstButtonClick:function(){this._addChild(this.options.default||[["id","=",1]]);},_onDebugInputChange:function(e){var domain;try{domain=Domain.prototype.stringToArray($(e.currentTarget).val());}catch(err){this.do_warn(_t("Syntax error"),_t("The domain you entered is not properly formed"));return;}
this._redraw(domain).then((function(){this.trigger_up("domain_changed",{child:this,alreadyRedrawn:true});}).bind(this));},_onDomainChange:function(e){if(!e.data.alreadyRedrawn){this._redraw();}},});var DomainLeaf=DomainNode.extend({template:"DomainLeaf",events:_.extend({},DomainNode.prototype.events,{"change .o_domain_leaf_operator_select":"_onOperatorSelectChange","change .o_domain_leaf_value_input":"_onValueInputChange","click .o_domain_leaf_value_add_tag_button":"on_add_tag","keyup .o_domain_leaf_value_tags input":"on_add_tag","click .o_domain_leaf_value_remove_tag_button":"on_remove_tag",}),custom_events:{"field_chain_changed":"_onFieldChainChange",},init:function(parent,model,domain,options){this._super.apply(this,arguments);var currentDomain=Domain.prototype.stringToArray(domain);this.chain=currentDomain[0][0];this.operator=currentDomain[0][1];this.value=currentDomain[0][2];this.operator_mapping=operator_mapping;},willStart:function(){var defs=[this._super.apply(this,arguments)];this.fieldSelector=new ModelFieldSelector(this,this.model,this.chain?this.chain.split("."):[],this.options);defs.push(this.fieldSelector.appendTo($("<div/>")).then((function(){var wDefs=[];if(!this.readonly){var selectedField=this.fieldSelector.getSelectedField()||{};this.operators=this._getOperatorsFromType(selectedField.type);if(_.contains(["child_of","parent_of","like","not like","=like","=ilike"],this.operator)){this.operators[this.operator]=operator_mapping[this.operator];}else if(!this.operators[this.operator]){this.operators[this.operator]="?";}
this.selectionChoices=null;if(selectedField.type==="boolean"){this.selectionChoices=[["1",_t("set (true)")],["0",_t("not set (false)")]];}else if(selectedField.type==="selection"){this.selectionChoices=selectedField.selection;}
this.displayValue=this.value;try{if(selectedField&&!selectedField.relation&&!_.isArray(this.value)){this.displayValue=field_utils.format[selectedField.type](this.value,selectedField);}}catch(err){}
this.displayOperator=this.operator;if(selectedField.type==="boolean"){this.displayValue=this.value?"1":"0";}else if((this.operator==="!="||this.operator==="=")&&this.value===false){this.displayOperator=this.operator==="!="?"set":"not set";}
if(_.contains(["date","datetime"],selectedField.type)){this.valueWidget=new(selectedField.type==="datetime"?datepicker.DateTimeWidget:datepicker.DateWidget)(this);wDefs.push(this.valueWidget.appendTo("<div/>").then((function(){this.valueWidget.$el.addClass("o_domain_leaf_value_input");this.valueWidget.setValue(moment(this.value));this.valueWidget.on("datetime_changed",this,function(){this._changeValue(this.valueWidget.getValue());});}).bind(this)));}
return $.when.apply($,wDefs);}}).bind(this)));return $.when.apply($,defs);},start:function(){this.fieldSelector.$el.prependTo(this.$("> .o_domain_leaf_info, > .o_domain_leaf_edition"));if(!this.readonly&&this.valueWidget){this.$(".o_domain_leaf_value_input").replaceWith(this.valueWidget.$el);}
return this._super.apply(this,arguments);},isValid:function(){return this.fieldSelector&&this.fieldSelector.isValid();},getDomain:function(){return[[this.chain,this.operator,this.value]];},_changeFieldChain:function(chain,silent){this.chain=chain.join(".");this.fieldSelector.setChain(chain).then((function(){if(!this.fieldSelector.isValid())return;var selectedField=this.fieldSelector.getSelectedField()||{};var operators=this._getOperatorsFromType(selectedField.type);if(operators[this.operator]===undefined){this._changeOperator("=",true);}
this._changeValue(this.value,true);if(!silent)this.trigger_up("domain_changed",{child:this});}).bind(this));},_changeOperator:function(operator,silent){this.operator=operator;if(_.contains(["set","not set"],this.operator)){this.operator=this.operator==="not set"?"=":"!=";this.value=false;}else if(_.contains(["in","not in"],this.operator)){this.value=_.isArray(this.value)?this.value:this.value?(""+this.value).split(","):[];}else{if(_.isArray(this.value)){this.value=this.value.join(",");}
this._changeValue(this.value,true);}
if(!silent)this.trigger_up("domain_changed",{child:this});},_changeValue:function(value,silent){var couldNotParse=false;var selectedField=this.fieldSelector.getSelectedField()||{};try{this.value=field_utils.parse[selectedField.type](value,selectedField);}catch(err){this.value=value;couldNotParse=true;}
if(selectedField.type==="boolean"){if(!_.isBoolean(this.value)){this.value=!!parseFloat(this.value);}}else if(selectedField.type==="selection"){if(!_.some(selectedField.selection,(function(option){return option[0]===this.value;}).bind(this))){this.value=selectedField.selection[0][0];}}else if(_.contains(["date","datetime"],selectedField.type)){if(couldNotParse||_.isBoolean(this.value)){this.value=field_utils.parse[selectedField.type](field_utils.format[selectedField.type](moment())).toJSON();}else{this.value=this.value.toJSON();}}else{if(_.isBoolean(this.value)){this.value="";}else if(_.isObject(this.value)&&!_.isArray(this.value)){this.value=this.value.id||value||"";}}
if(!silent)this.trigger_up("domain_changed",{child:this});},_getOperatorsFromType:function(type){var operators={};switch(type){case"boolean":operators={"=":_t("is"),"!=":_t("is not"),};break;case"char":case"text":case"html":operators=_.pick(operator_mapping,"=","!=","ilike","not ilike","set","not set","in","not in");break;case"many2many":case"one2many":case"many2one":operators=_.pick(operator_mapping,"=","!=","ilike","not ilike","set","not set");break;case"integer":case"float":case"monetary":operators=_.pick(operator_mapping,"=","!=",">","<",">=","<=","ilike","not ilike","set","not set");break;case"selection":operators=_.pick(operator_mapping,"=","!=","set","not set");break;case"date":case"datetime":operators=_.pick(operator_mapping,"=","!=",">","<",">=","<=","set","not set");break;default:operators=_.extend({},operator_mapping);break;}
if(this.options.operators){operators=_.pick.apply(_,[operators].concat(this.options.operators));}
return operators;},_onOperatorSelectChange:function(e){this._changeOperator($(e.currentTarget).val());},_onValueInputChange:function(e){if(e.currentTarget!==e.target)return;this._changeValue($(e.currentTarget).val());},_onFieldChainChange:function(e){this._changeFieldChain(e.data.chain);},on_add_tag:function(e){if(e.type==="keyup"&&e.which!==$.ui.keyCode.ENTER)return;if(!_.contains(["not in","in"],this.operator))return;var values=_.isArray(this.value)?this.value.slice():[];var $input=this.$(".o_domain_leaf_value_tags input");var val=$input.val().trim();if(val&&values.indexOf(val)<0){values.push(val);_.defer(this._changeValue.bind(this,values));$input.focus();}},on_remove_tag:function(e){var values=_.isArray(this.value)?this.value.slice():[];var val=this.$(e.currentTarget).data("value");var index=values.indexOf(val);if(index>=0){values.splice(index,1);_.defer(this._changeValue.bind(this,values));}},});function instantiateNode(parent,model,domain,options){if(domain.length>1){return new DomainTree(parent,model,domain,options);}else if(domain.length===1){return new DomainLeaf(parent,model,domain,options);}
return null;}
return DomainSelector;});;

/* /web/static/src/js/widgets/iframe_widget.js defined in bundle 'web.assets_backend' */
odoo.define('web.IFrameWidget',function(require){"use strict";var Widget=require('web.Widget');var IFrameWidget=Widget.extend({tagName:'iframe',init:function(parent,url){this._super(parent);this.url=url;},start:function(){this.$el.css({height:'100%',width:'100%',border:0});this.$el.attr({src:this.url});this.$el.on("load",this._bindEvents.bind(this));return this._super();},_bindEvents:function(){this.$el.contents().click(this._onIFrameClicked.bind(this));},_onIFrameClicked:function(event){}});return IFrameWidget;});;

/* /web/static/src/js/chrome/loading.js defined in bundle 'web.assets_backend' */
odoo.define('web.Loading',function(require){"use strict";var core=require('web.core');var framework=require('web.framework');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;var Loading=Widget.extend({template:"Loading",init:function(parent){this._super(parent);this.count=0;this.blocked_ui=false;core.bus.on('rpc_request',this,this.request_call);core.bus.on("rpc_response",this,this.response_call);core.bus.on("rpc_response_failed",this,this.response_call);},destroy:function(){this.on_rpc_event(-this.count);this._super();},request_call:function(){this.on_rpc_event(1);},response_call:function(){this.on_rpc_event(-1);},on_rpc_event:function(increment){var self=this;if(!this.count&&increment===1){this.long_running_timer=setTimeout(function(){self.blocked_ui=true;framework.blockUI();},3000);}
this.count+=increment;if(this.count>0){if(session.debug){this.$el.text(_.str.sprintf(_t("Loading (%d)"),this.count));}else{this.$el.text(_t("Loading"));}
this.$el.show();this.getParent().$el.addClass('oe_wait');}else{this.count=0;clearTimeout(this.long_running_timer);if(self.blocked_ui){this.blocked_ui=false;framework.unblockUI();}
this.$el.fadeOut();this.getParent().$el.removeClass('oe_wait');}}});return Loading;});;

/* /web/static/src/js/widgets/model_field_selector.js defined in bundle 'web.assets_backend' */
odoo.define("web.ModelFieldSelector",function(require){"use strict";var core=require("web.core");var Widget=require("web.Widget");var _t=core._t;var modelFieldsCache={cache:{},cacheDefs:{},};core.bus.on('clear_cache',null,function(){modelFieldsCache.cache={};modelFieldsCache.cacheDefs={};});var ModelFieldSelector=Widget.extend({template:"ModelFieldSelector",events:{},editionEvents:{"focusin":"_onFocusIn","focusout":"_onFocusOut","click .o_field_selector_close":"_onCloseClick","click .o_field_selector_prev_page":"_onPrevPageClick","click .o_field_selector_next_page":"_onNextPageClick","click li.o_field_selector_select_button":"_onLastFieldClick","change input":"_onInputChange","mouseover li.o_field_selector_item":"_onItemHover","keydown":"_onKeydown",},init:function(parent,model,chain,options){this._super.apply(this,arguments);this.model=model;this.chain=chain;this.options=_.extend({order:'string',readonly:true,filters:{},fields:null,filter:function(){return true;},followRelations:true,debugMode:false,},options||{});this.options.filters=_.extend({searchable:true,},this.options.filters);if(typeof this.options.followRelations!=='function'){this.options.followRelations=this.options.followRelations?function(){return true;}:function(){return false;};}
this.pages=[];this.dirty=false;if(!this.options.readonly){_.extend(this.events,this.editionEvents);}},willStart:function(){return $.when(this._super.apply(this,arguments),this._prefill());},start:function(){this.$value=this.$(".o_field_selector_value");this.$popover=this.$(".o_field_selector_popover");this.$input=this.$popover.find("input");this.$valid=this.$(".o_field_selector_warning");this._render();return this._super.apply(this,arguments);},getSelectedField:function(){return _.findWhere(this.pages[this.chain.length-1],{name:_.last(this.chain)});},isValid:function(){return this.valid;},setChain:function(chain){if(_.isEqual(chain,this.chain)){return $.when();}
this.chain=chain;return this._prefill().then(this._render.bind(this));},_addChainNode:function(fieldName){this.dirty=true;this.chain=this.chain.slice(0,this.pages.length-1);this.chain.push(fieldName);},_getLastPageField:function(name){return _.findWhere(_.last(this.pages),{name:name,});},_getModelFieldsFromCache:function(model,filters){var self=this;var def=modelFieldsCache.cacheDefs[model];if(!def){def=modelFieldsCache.cacheDefs[model]=this._rpc({model:model,method:'fields_get',args:[false,["store","searchable","type","string","relation","selection","related"]],context:this.getSession().user_context,}).then((function(fields){modelFieldsCache.cache[model]=sortFields(fields,model,self.options.order);}).bind(this));}
return def.then((function(){return _.filter(modelFieldsCache.cache[model],function(f){return(!filters.searchable||f.searchable)&&self.options.filter(f);});}).bind(this));},_goToNextPage:function(field){if(!_.isEqual(this._getLastPageField(field.name),field))return;this._validate(true);this._addChainNode(field.name);this._pushPageData(field.relation).then(this._render.bind(this));},_goToPrevPage:function(){if(this.pages.length<=0)return;this._validate(true);this._removeChainNode();if(this.pages.length>1){this.pages.pop();}
this._render();},_hidePopover:function(){if(!this._isOpen)return;this._isOpen=false;this.$popover.addClass('d-none');if(this.dirty){this.dirty=false;this.trigger_up("field_chain_changed",{chain:this.chain});}},_prefill:function(){this.pages=[];return this._pushPageData(this.model).then((function(){this._validate(true);return(this.chain.length?processChain.call(this,this.chain.slice().reverse()):$.when());}).bind(this));function processChain(chain){var field=this._getLastPageField(chain.pop());if(field&&field.relation){if(chain.length){return this._pushPageData(field.relation).then(processChain.bind(this,chain));}else{return this._pushPageData(field.relation);}}else if(field&&chain.length===0){return $.when();}else{this._validate(false);}
return $.when();}},_pushPageData:function(model){var def;if(this.model===model&&this.options.fields){def=$.when(sortFields(this.options.fields,model,this.options.order));}else{def=this._getModelFieldsFromCache(model,this.options.filters);}
return def.then((function(fields){this.pages.push(fields);}).bind(this));},_removeChainNode:function(){this.dirty=true;this.chain=this.chain.slice(0,this.pages.length-1);this.chain.pop();},_render:function(){this.$value.html(core.qweb.render(this.template+".value",{chain:this.chain,pages:this.pages,}));this.$valid.toggleClass('d-none',!!this.isValid());var page=_.last(this.pages);var title="";if(this.pages.length>1){var prevField=_.findWhere(this.pages[this.pages.length-2],{name:(this.chain.length===this.pages.length)?this.chain[this.chain.length-2]:_.last(this.chain),});if(prevField)title=prevField.string;}
this.$(".o_field_selector_popover_header .o_field_selector_title").text(title);this.$(".o_field_selector_page").replaceWith(core.qweb.render(this.template+".page",{lines:_.filter(page,this.options.filter),followRelations:this.options.followRelations,debug:this.options.debugMode,}));this.$input.val(this.chain.join("."));},_selectField:function(field){if(!_.isEqual(this._getLastPageField(field.name),field))return;this._validate(true);this._addChainNode(field.name);this._render();this._hidePopover();},_showPopover:function(){if(this._isOpen)return;this._isOpen=true;this.$popover.removeClass('d-none');},_validate:function(valid){this.valid=!!valid;if(!this.valid){this.do_warn(_t("Invalid field chain"),_t("The field chain is not valid. Did you maybe use a non-existing field name or followed a non-relational field?"));}},_onFocusIn:function(){clearTimeout(this._hidePopoverTimeout);this._showPopover();},_onFocusOut:function(){this._hidePopoverTimeout=_.defer(this._hidePopover.bind(this));},_onCloseClick:function(){this._hidePopover();},_onPrevPageClick:function(){this._goToPrevPage();},_onNextPageClick:function(e){e.stopPropagation();this._goToNextPage(this._getLastPageField($(e.currentTarget).data("name")));},_onLastFieldClick:function(e){this._selectField(this._getLastPageField($(e.currentTarget).data("name")));},_onInputChange:function(){var userChainStr=this.$input.val();var userChain=userChainStr.split(".");if(!this.options.followRelations&&userChain.length>1){this.do_warn(_t("Relation not allowed"),_t("You cannot follow relations for this field chain construction"));userChain=[userChain[0]];}
this.setChain(userChain).then((function(){this.trigger_up("field_chain_changed",{chain:this.chain});}).bind(this));},_onItemHover:function(e){this.$("li.o_field_selector_item").removeClass("active");$(e.currentTarget).addClass("active");},_onKeydown:function(e){if(!this.$popover.is(":visible"))return;var inputHasFocus=this.$input.is(":focus");switch(e.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:e.preventDefault();var $active=this.$("li.o_field_selector_item.active");var $to=$active[e.which===$.ui.keyCode.DOWN?"next":"prev"](".o_field_selector_item");if($to.length){$active.removeClass("active");$to.addClass("active");this.$popover.focus();var $page=$to.closest(".o_field_selector_page");var full_height=$page.height();var el_position=$to.position().top;var el_height=$to.outerHeight();var current_scroll=$page.scrollTop();if(el_position<0){$page.scrollTop(current_scroll-el_height);}else if(full_height<el_position+el_height){$page.scrollTop(current_scroll+el_height);}}
break;case $.ui.keyCode.RIGHT:if(inputHasFocus)break;e.preventDefault();var name=this.$("li.o_field_selector_item.active").data("name");if(name){var field=this._getLastPageField(name);if(field.relation){this._goToNextPage(field);}}
break;case $.ui.keyCode.LEFT:if(inputHasFocus)break;e.preventDefault();this._goToPrevPage();break;case $.ui.keyCode.ESCAPE:e.stopPropagation();this._hidePopover();break;case $.ui.keyCode.ENTER:if(inputHasFocus)break;e.preventDefault();this._selectField(this._getLastPageField(this.$("li.o_field_selector_item.active").data("name")));break;}}});return ModelFieldSelector;function sortFields(fields,model,order){var array=_.chain(fields).pairs().sortBy(function(p){return p[1].string;});if(order!=='string'){array=array.sortBy(function(p){return p[1][order];});}
return array.map(function(p){return _.extend({name:p[0],model:model,},p[1]);}).value();}});;

/* /web/static/src/js/widgets/notification.js defined in bundle 'web.assets_backend' */
odoo.define('web.Notification',function(require){"use strict";var Widget=require('web.Widget');var Notification=Widget.extend({template:'Notification',events:{'click > .o_close':'_onClose','click .o_buttons button':'_onClickButton'},_autoCloseDelay:2500,_animationDelay:400,init:function(parent,params){this._super.apply(this,arguments);this.title=params.title;this.message=params.message;this.buttons=params.buttons||[];this.sticky=!!this.buttons.length||!!params.sticky;this.type=params.type||'notification';this.className=params.className||'';this._closeCallback=params.onClose;this.icon='fa-lightbulb-o';if(this.buttons&&this.buttons.length){this.icon='fa-question-circle-o';}
if(this.type==='warning'){this.icon='fa-exclamation';this.className+=' o_error';}},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$el.animate({opacity:1.0},self._animationDelay,"swing",function(){if(!self.sticky){setTimeout(function(){self.close();},self._autoCloseDelay);}});});},close:function(silent){var self=this;this.trigger_up('close');if(!silent&&!this._buttonClicked){if(this._closeCallback){this._closeCallback();}}
this.$el.animate({opacity:0.0,height:0},this._animationDelay,"swing",self.destroy.bind(self));},_onClickButton:function(ev){ev.preventDefault();if(this._buttonClicked){return;}
this._buttonClicked=true;var index=$(ev.currentTarget).index();var button=this.buttons[index];if(button.click){button.click();}
this.close(true);},_onClose:function(ev){ev.preventDefault();this.close();},});return Notification;});;

/* /web/static/src/js/chrome/sidebar.js defined in bundle 'web.assets_backend' */
odoo.define('web.Sidebar',function(require){"use strict";var Context=require('web.Context');var core=require('web.core');var pyUtils=require('web.py_utils');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var Sidebar=Widget.extend({events:{"click a.dropdown-item":"_onDropdownClicked"},init:function(parent,options){this._super.apply(this,arguments);this.options=_.defaults(options||{},{'editable':true});this.env=options.env;this.sections=options.sections||[{name:'print',label:_t('Print')},{name:'other',label:_t('Action')},];this.items=options.items||{print:[],other:[],};if(options.actions){this._addToolbarActions(options.actions);}},start:function(){this._super.apply(this,arguments);this.$el.addClass('btn-group');this._redraw();},updateEnv:function(env){this.env=env;this._redraw();},_addItems:function(sectionCode,items){if(items){this.items[sectionCode].unshift.apply(this.items[sectionCode],items);}},_addToolbarActions:function(toolbarActions){var self=this;_.each(['print','action','relate'],function(type){if(type in toolbarActions){var actions=toolbarActions[type];if(actions&&actions.length){var items=_.map(actions,function(action){return{label:action.name,action:action,};});self._addItems(type==='print'?'print':'other',items);}}});if('other'in toolbarActions){this._addItems('other',toolbarActions.other);}},_onItemActionClicked:function(item){var self=this;this.trigger_up('sidebar_data_asked',{callback:function(env){self.env=env;var activeIdsContext={active_id:env.activeIds[0],active_ids:env.activeIds,active_model:env.model,};if(env.domain){activeIdsContext.active_domain=env.domain;}
var context=pyUtils.eval('context',new Context(env.context,activeIdsContext));self._rpc({route:'/web/action/load',params:{action_id:item.action.id,context:context,},}).done(function(result){result.context=new Context(result.context||{},activeIdsContext).set_eval_context(context);result.flags=result.flags||{};result.flags.new_window=true;self.do_action(result,{on_close:function(){self.trigger_up('reload');},});});}});},_redraw:function(){this.$el.html(QWeb.render('Sidebar',{widget:this}));_.each(this.$('.o_dropdown'),function(el){var $dropdown=$(el);if(!$dropdown.find('.dropdown-item').length){$dropdown.hide();}});this.$("[title]").tooltip({delay:{show:500,hide:0}});},_onDropdownClicked:function(event){var section=$(event.currentTarget).data('section');var index=$(event.currentTarget).data('index');var item=this.items[section][index];if(item.callback){item.callback.apply(this,[item]);}else if(item.action){this._onItemActionClicked(item);}else if(item.url){return true;}
event.preventDefault();},});return Sidebar;});;

/* /web/static/src/js/chrome/pager.js defined in bundle 'web.assets_backend' */
odoo.define('web.Pager',function(require){"use strict";var utils=require('web.utils');var Widget=require('web.Widget');var direction={previous:-1,next:1,};var Pager=Widget.extend({template:"Pager",events:{'click .o_pager_next':'_onNext','click .o_pager_previous':'_onPrevious','click .o_pager_value':'_onEdit',},init:function(parent,size,current_min,limit,options){this.state={size:size,current_min:current_min,limit:limit,};Object.defineProperty(this.state,'current_max',{get:function(){return Math.min(this.current_min+this.limit-1,this.size);}});this.options=_.defaults({},options,{can_edit:true,single_page_hidden:false,validate:function(){return $.Deferred().resolve();},withAccessKey:true,});this._super(parent);},start:function(){this.$value=this.$('.o_pager_value');this.$limit=this.$('.o_pager_limit');this._render();return this._super();},disable:function(){this.disabled=true;this._updateArrows();},enable:function(){this.disabled=false;this._updateArrows();},next:function(){this._changeSelection(direction.next);},previous:function(){this._changeSelection(direction.previous);},updateState:function(state,options){_.extend(this.state,state);this._render();if(options&&options.notifyChange){this.trigger('pager_changed',_.clone(this.state));}},_changeSelection:function(direction){var self=this;this.options.validate().then(function(){var size=self.state.size;var current_min=self.state.current_min;var limit=self.state.limit;current_min=(current_min+limit*direction);if(current_min>size){current_min=1;}else if((current_min<1)&&(limit===1)){current_min=size;}else if((current_min<1)&&(limit>1)){current_min=size-((size%limit)||limit)+1;}
self.state.current_min=current_min;self._render();self.trigger('pager_changed',_.clone(self.state));});},_edit:function(){if(this.options.can_edit){var self=this;var $input=$('<input>',{class:'o_input',type:'text',value:this.$value.html()});this.$value.html($input);$input.focus();$input.click(function(ev){ev.stopPropagation();});$input.blur(function(ev){self._save($(ev.target));});$input.on('keydown',function(ev){ev.stopPropagation();if(ev.which===$.ui.keyCode.ENTER){self._save($(ev.target));}else if(ev.which===$.ui.keyCode.ESCAPE){self._render();}});}},_render:function(){var size=this.state.size;var current_min=this.state.current_min;var current_max=this.state.current_max;if(size===0||(this.options.single_page_hidden&&this._singlePage())){this.do_hide();}else{this.do_show();this._updateArrows();var value=""+current_min;if(this.state.limit>1){value+="-"+current_max;}
this.$value.html(value);this.$limit.html(size);}},_save:function($input){var self=this;this.options.validate().then(function(){var value=$input.val().split("-");var min=utils.confine(parseInt(value[0],10),1,self.state.size);var max=utils.confine(parseInt(value[1],10),1,self.state.size);if(!isNaN(min)){self.state.current_min=min;if(!isNaN(max)){self.state.limit=utils.confine(max-min+1,1,self.state.size);}else{self.state.limit=1;}
self.trigger('pager_changed',_.clone(self.state));}}).always(function(){self._render();});},_singlePage:function(){var state=this.state;return(1===state.current_min)&&(state.current_max===state.size);},_updateArrows:function(){var disabled=this.disabled||this._singlePage();this.$('button').prop('disabled',disabled);},_onEdit:function(event){event.stopPropagation();if(!this.disabled){this._edit();}},_onNext:function(event){event.stopPropagation();this.next();},_onPrevious:function(event){event.stopPropagation();this.previous();},});return Pager;});;

/* /web/static/src/js/chrome/systray_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.SystrayMenu',function(require){"use strict";var Widget=require('web.Widget');var SystrayMenu=Widget.extend({init:function(parent){this._super(parent);this.items=[];this.widgets=[];this.load=$.Deferred();},start:function(){var self=this;self._super.apply(this,arguments);self._loadItems();$.when.apply($,self.items).always(function(){self.load.resolve();});return self.load;},_loadItems:function(){var self=this;SystrayMenu.Items=_.sortBy(SystrayMenu.Items,function(item){return!_.isUndefined(item.prototype.sequence)?item.prototype.sequence:50;});_.each(SystrayMenu.Items,function(WidgetClass){var cur_systray_item=new WidgetClass(self);self.widgets.push(cur_systray_item);self.items.push(cur_systray_item.prependTo(self.$el));});},});SystrayMenu.Items=[];return SystrayMenu;});;

/* /web/static/src/js/widgets/switch_company_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.SwitchCompanyMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var _t=core._t;var SwitchCompanyMenu=Widget.extend({template:'SwitchCompanyMenu',events:{'click .dropdown-item[data-menu]':'_onClick',},init:function(){this._super.apply(this,arguments);this.isMobile=config.device.isMobile;this._onClick=_.debounce(this._onClick,1500,true);},willStart:function(){return session.user_companies?this._super():$.Deferred().reject();},start:function(){var companiesList='';if(this.isMobile){companiesList='<li class="bg-info">'+
_t('Tap on the list to change company')+'</li>';}
else{this.$('.oe_topbar_name').text(session.user_companies.current_company[1]);}
_.each(session.user_companies.allowed_companies,function(company){var a='';var isCurrentCompany=company[0]===session.user_companies.current_company[0];if(isCurrentCompany){a='<i class="fa fa-check mr8"></i>';}else{a='<span style="margin-right: 24px;"/>';}
companiesList+='<a role="menuitemradio" aria-checked="'+isCurrentCompany+'" href="#" class="dropdown-item" data-menu="company" data-company-id="'+
company[0]+'">'+a+company[1]+'</a>';});this.$('.dropdown-menu').html(companiesList);return this._super();},_onClick:function(ev){ev.preventDefault();var companyID=$(ev.currentTarget).data('company-id');this._rpc({model:'res.users',method:'write',args:[[session.uid],{'company_id':companyID}],}).then(function(){location.reload();});},});SystrayMenu.Items.push(SwitchCompanyMenu);return SwitchCompanyMenu;});;

/* /web/static/src/js/chrome/user_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.UserMenu',function(require){"use strict";var core=require('web.core');var framework=require('web.framework');var Dialog=require('web.Dialog');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var UserMenu=Widget.extend({template:'UserMenu',start:function(){var self=this;var session=this.getSession();this.$el.on('click','[data-menu]',function(ev){ev.preventDefault();var menu=$(this).data('menu');self['_onMenu'+menu.charAt(0).toUpperCase()+menu.slice(1)]();});return this._super.apply(this,arguments).then(function(){var $avatar=self.$('.oe_topbar_avatar');if(!session.uid){$avatar.attr('src',$avatar.data('default-src'));return $.when();}
var topbar_name=session.name;if(session.debug){topbar_name=_.str.sprintf("%s (%s)",topbar_name,session.db);}
self.$('.oe_topbar_name').text(topbar_name);var avatar_src=session.url('/web/image',{model:'res.users',field:'image_small',id:session.uid,});$avatar.attr('src',avatar_src);});},_onMenuAccount:function(){var self=this;this.trigger_up('clear_uncommitted_changes',{callback:function(){self._rpc({route:'/web/session/account'}).then(function(url){framework.redirect(url);}).fail(function(result,ev){ev.preventDefault();framework.redirect('https://accounts.odoo.com/account');});},});},_onMenuDocumentation:function(){window.open('https://www.odoo.com/documentation/12.0','_blank');},_onMenuLogout:function(){this.trigger_up('clear_uncommitted_changes',{callback:this.do_action.bind(this,'logout'),});},_onMenuSettings:function(){var self=this;var session=this.getSession();this.trigger_up('clear_uncommitted_changes',{callback:function(){self._rpc({route:"/web/action/load",params:{action_id:"base.action_res_users_my",},}).done(function(result){result.res_id=session.uid;self.do_action(result);});},});},_onMenuSupport:function(){window.open('https://www.odoo.com/buy','_blank');},_onMenuShortcuts:function(){new Dialog(this,{size:'large',dialogClass:'o_act_window',title:_t("Keyboard Shortcuts"),$content:$(QWeb.render("UserMenu.shortcuts"))}).open();},});return UserMenu;});;

/* /web/static/src/js/chrome/menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.Menu',function(require){"use strict";var AppsMenu=require('web.AppsMenu');var config=require('web.config');var core=require('web.core');var dom=require('web.dom');var SystrayMenu=require('web.SystrayMenu');var UserMenu=require('web.UserMenu');var Widget=require('web.Widget');UserMenu.prototype.sequence=0;SystrayMenu.Items.push(UserMenu);var QWeb=core.qweb;var Menu=Widget.extend({template:'Menu',menusTemplate:'Menu.sections',events:{'mouseover .o_menu_sections > li:not(.show)':'_onMouseOverMenu','click .o_menu_brand':'_onAppNameClicked',},init:function(parent,menu_data){var self=this;this._super.apply(this,arguments);this.$menu_sections={};this.menu_data=menu_data;var $menu_sections=$(QWeb.render(this.menusTemplate,{menu_data:this.menu_data,}));$menu_sections.filter('section').each(function(){self.$menu_sections[parseInt(this.className,10)]=$(this).children('li');});core.bus.on('change_menu_section',this,this.change_menu_section);},start:function(){var self=this;this.$menu_apps=this.$('.o_menu_apps');this.$menu_brand_placeholder=this.$('.o_menu_brand');this.$section_placeholder=this.$('.o_menu_sections');var on_secondary_menu_click=function(ev){ev.preventDefault();var menu_id=$(ev.currentTarget).data('menu');var action_id=$(ev.currentTarget).data('action-id');self._on_secondary_menu_click(menu_id,action_id);};var menu_ids=_.keys(this.$menu_sections);var primary_menu_id,$section;for(var i=0;i<menu_ids.length;i++){primary_menu_id=menu_ids[i];$section=this.$menu_sections[primary_menu_id];$section.on('click','a[data-menu]',self,on_secondary_menu_click.bind(this));}
this._appsMenu=new AppsMenu(self,this.menu_data);this._appsMenu.appendTo(this.$menu_apps);this.systray_menu=new SystrayMenu(this);this.systray_menu.attachTo(this.$('.o_menu_systray'));dom.initAutoMoreMenu(this.$section_placeholder,{maxWidth:function(){return self.$el.width()-(self.$menu_apps.outerWidth(true)+self.$menu_brand_placeholder.outerWidth(true)+self.systray_menu.$el.outerWidth(true));},sizeClass:'SM',});return this._super.apply(this,arguments);},change_menu_section:function(primary_menu_id){if(!this.$menu_sections[primary_menu_id]){this._updateMenuBrand();return;}
if(this.current_primary_menu===primary_menu_id){return;}
if(this.current_primary_menu){this.$menu_sections[this.current_primary_menu].detach();}
for(var i=0;i<this.menu_data.children.length;i++){if(this.menu_data.children[i].id===primary_menu_id){this._updateMenuBrand(this.menu_data.children[i].name);break;}}
this.$menu_sections[primary_menu_id].appendTo(this.$section_placeholder);this.current_primary_menu=primary_menu_id;core.bus.trigger('resize');},_trigger_menu_clicked:function(menu_id,action_id){this.trigger_up('menu_clicked',{id:menu_id,action_id:action_id,previous_menu_id:this.current_secondary_menu||this.current_primary_menu,});},_updateMenuBrand:function(brandName){if(brandName){this.$menu_brand_placeholder.text(brandName).show();this.$section_placeholder.show();}else{this.$menu_brand_placeholder.hide()
this.$section_placeholder.hide();}},_on_secondary_menu_click:function(menu_id,action_id){var self=this;if(action_id){self._trigger_menu_clicked(menu_id,action_id);this.current_secondary_menu=menu_id;}},action_id_to_primary_menu_id:function(action_id){var primary_menu_id,found;for(var i=0;i<this.menu_data.children.length&&!primary_menu_id;i++){found=this._action_id_in_subtree(this.menu_data.children[i],action_id);if(found){primary_menu_id=this.menu_data.children[i].id;}}
return primary_menu_id;},_action_id_in_subtree:function(root,action_id){if(root.action&&root.action.split(',')[1]===String(action_id)){return true;}
var found;for(var i=0;i<root.children.length&&!found;i++){found=this._action_id_in_subtree(root.children[i],action_id);}
return found;},menu_id_to_action_id:function(menu_id,root){if(!root){root=$.extend(true,{},this.menu_data);}
if(root.id===menu_id){return root.action.split(',')[1];}
for(var i=0;i<root.children.length;i++){var action_id=this.menu_id_to_action_id(menu_id,root.children[i]);if(action_id!==undefined){return action_id;}}
return undefined;},getCurrentPrimaryMenu:function(){return this.current_primary_menu;},openFirstApp:function(){this._appsMenu.openFirstApp();},_onAppNameClicked:function(ev){var actionID=parseInt(this.menu_id_to_action_id(this.current_primary_menu));this._trigger_menu_clicked(this.current_primary_menu,actionID);},_onMouseOverMenu:function(ev){if(config.device.isMobile){return;}
var $target=$(ev.currentTarget);var $opened=$target.siblings('.show');if($opened.length){$target.find('[data-toggle="dropdown"]:first').dropdown('toggle');}},});return Menu;});;

/* /web/static/src/js/chrome/apps_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.AppsMenu',function(require){"use strict";var Widget=require('web.Widget');var AppsMenu=Widget.extend({template:'AppsMenu',events:{'click .o_app':'_onAppsMenuItemClicked',},init:function(parent,menuData){this._super.apply(this,arguments);this._activeApp=undefined;this._apps=_.map(menuData.children,function(appMenuData){return{actionID:parseInt(appMenuData.action.split(',')[1]),menuID:appMenuData.id,name:appMenuData.name,xmlID:appMenuData.xmlid,};});},getApps:function(){return this._apps;},openFirstApp:function(){if(!this._apps.length){return}
var firstApp=this._apps[0];this._openApp(firstApp);},_openApp:function(app){this._setActiveApp(app);this.trigger_up('app_clicked',{action_id:app.actionID,menu_id:app.menuID,});},_setActiveApp:function(app){var $oldActiveApp=this.$('.o_app.active');$oldActiveApp.removeClass('active');var $newActiveApp=this.$('.o_app[data-action-id="'+app.actionID+'"]');$newActiveApp.addClass('active');},_onAppsMenuItemClicked:function(ev){var $target=$(ev.currentTarget);var actionID=$target.data('action-id');var menuID=$target.data('menu-id');var app=_.findWhere(this._apps,{actionID:actionID,menuID:menuID});this._openApp(app);},});return AppsMenu;});;

/* /web/static/src/js/views/search/search_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.SearchView',function(require){"use strict";var AutoComplete=require('web.AutoComplete');var config=require('web.config');var core=require('web.core');var Domain=require('web.Domain');var FavoriteMenu=require('web.FavoriteMenu');var FiltersMenu=require('web.FiltersMenu');var GroupByMenu=require('web.GroupByMenu');var pyUtils=require('web.py_utils');var search_inputs=require('web.search_inputs');var TimeRangeMenu=require('web.TimeRangeMenu');var TimeRangeMenuOptions=require('web.TimeRangeMenuOptions');var utils=require('web.utils');var Widget=require('web.Widget');var _t=core._t;var ComparisonOptions=TimeRangeMenuOptions.ComparisonOptions;var PeriodOptions=TimeRangeMenuOptions.PeriodOptions;var Backbone=window.Backbone;var FacetValue=Backbone.Model.extend({});var FacetValues=Backbone.Collection.extend({model:FacetValue});var DEFAULT_INTERVAL='month';var DEFAULT_PERIOD='this_month';var Facet=Backbone.Model.extend({initialize:function(attrs){var values=attrs.values;delete attrs.values;Backbone.Model.prototype.initialize.apply(this,arguments);this.values=new FacetValues(values||[]);this.values.on('add remove change reset',function(_,options){this.trigger('change',this,options);},this);},get:function(key){if(key!=='values'){return Backbone.Model.prototype.get.call(this,key);}
return this.values.toJSON();},set:function(key,value){if(key!=='values'){return Backbone.Model.prototype.set.call(this,key,value);}
this.values.reset(value);},toJSON:function(){var out={};var attrs=this.attributes;for(var att in attrs){if(!attrs.hasOwnProperty(att)||att==='field'){continue;}
out[att]=attrs[att];}
out.values=this.values.toJSON();return out;}});var SearchQuery=Backbone.Collection.extend({model:Facet,initialize:function(){Backbone.Collection.prototype.initialize.apply(this,arguments);this.on('change',function(facet){if(!facet.values.isEmpty()){return;}
this.remove(facet,{silent:true});},this);},add:function(values,options){options=options||{};if(!values){values=[];}else if(!(values instanceof Array)){values=[values];}
_(values).each(function(value){var model=this._prepareModel(value,options);var previous=this.detect(function(facet){return facet.get('category')===model.get('category')&&facet.get('field')===model.get('field');});if(previous){previous.values.add(model.get('values'),_.omit(options,'at','merge'));return;}
Backbone.Collection.prototype.add.call(this,model,options);},this);return this;},toggle:function(value,options){options=options||{};var facet=this.detect(function(facet){return facet.get('category')===value.category&&facet.get('field')===value.field;});if(!facet){return this.add(value,options);}
var changed=false;_(value.values).each(function(val){var already_value=facet.values.detect(function(v){return v.get('value')===val.value&&v.get('label')===val.label;});if(already_value){facet.values.remove(already_value,{silent:true});}else{facet.values.add(val,{silent:true});}
changed=true;});facet.trigger('change',facet);return this;}});var InputView=Widget.extend({template:'SearchView.InputView',events:{focus:function(){this.trigger('focused',this);},blur:function(){this.$el.val('');this.trigger('blurred',this);},keydown:'onKeydown','compositionend':'_onCompositionend','compositionstart':'_onCompositionstart',},onKeydown:function(e){if(this._isComposing){return;}
switch(e.which){case $.ui.keyCode.BACKSPACE:if(this.$el.val()===''){var preceding=this.getParent().siblingSubview(this,-1);if(preceding&&(preceding instanceof FacetView)){preceding.model.destroy();}}
break;case $.ui.keyCode.LEFT:if(this.el.selectionStart>0){e.stopPropagation();}
break;case $.ui.keyCode.RIGHT:if(this.el.selectionStart<this.$el.val().length){e.stopPropagation();}
break;}},_onCompositionend:function(ev){this._isComposing=false;},_onCompositionstart:function(ev){this._isComposing=true;},});var FacetView=Widget.extend({template:'SearchView.FacetView',events:{'focus':function(){this.trigger('focused',this);},'blur':function(){this.trigger('blurred',this);},'click':function(e){if($(e.target).hasClass('o_facet_remove')){this.model.destroy();return false;}
this.$el.focus();e.stopPropagation();},'keydown':function(e){var keys=$.ui.keyCode;switch(e.which){case keys.BACKSPACE:case keys.DELETE:this.model.destroy();return false;}}},init:function(parent,model,intervalMapping,periodMapping){this._super(parent);this.model=model;this.intervalMapping=intervalMapping;this.periodMapping=periodMapping;this.model.on('change',this.model_changed,this);},destroy:function(){this.model.off('change',this.model_changed,this);this._super();},start:function(){var self=this;var $e=this.$('.o_facet_values').last();return $.when(this._super()).then(function(){return $.when.apply(null,self.model.values.map(function(value,index){if(index>0){$('<span/>',{html:self.model.get('separator')||_t(" or ")}).addClass('o_facet_values_sep').appendTo($e);}
var couple;var option;if(value.attributes.value&&value.attributes.value.attrs){if(value.attributes.value.attrs.isPeriod){couple=_.findWhere(self.periodMapping,{filter:value.attributes.value});option=couple?couple.period:value.attributes.value.attrs.default_period;}
if(value.attributes.value.attrs.isDate){couple=_.findWhere(self.intervalMapping,{groupby:value.attributes.value});option=couple?couple.interval:(value.attributes.value.attrs.defaultInterval||DEFAULT_INTERVAL);}}
return new FacetValueView(self,value,option).appendTo($e);}));});},model_changed:function(){this.$el.text(this.$el.text()+'*');}});var FacetValueView=Widget.extend({template:'SearchView.FacetView.Value',init:function(parent,model,option){this._super(parent);this.model=model;var optionDescription=_.extend({},{day:'Day',week:'Week',month:'Month',quarter:'Quarter',year:'Year',},{today:'Today',this_week:'This Week',this_month:'This Month',this_quarter:'This Quarter',this_year:'This Year',yesterday:'Yesterday',last_week:'Last Week',last_month:'Last Month',last_quarter:'Last Quarter',last_year:'Last Year',last_7_days:'Last 7 Days',last_30_days:'Last 30 Days',last_365_days:'Last 365 Days',});if(option){var optionLabel=optionDescription[option];this.optionLabel=_t(optionLabel);}
this.model.on('change',this.model_changed,this);},destroy:function(){this.model.off('change',this.model_changed,this);this._super();},model_changed:function(){this.$el.text(this.$el.text()+'*');}});var SearchView=Widget.extend({events:{'click .o_searchview_more':function(e){$(e.target).toggleClass('fa-search-plus fa-search-minus');var visibleSearchMenu=this.call('local_storage','getItem','visible_search_menu');this.call('local_storage','setItem','visible_search_menu',visibleSearchMenu===false);this.toggle_buttons();},'keydown .o_searchview_input, .o_searchview_facet':function(e){if(this._isInputComposing){return;}
switch(e.which){case $.ui.keyCode.LEFT:this.focusPreceding(e.target);e.preventDefault();break;case $.ui.keyCode.RIGHT:if(!this.autocomplete.is_expandable()){this.focusFollowing(e.target);}
e.preventDefault();break;case $.ui.keyCode.DOWN:if(!this.autocomplete.is_expanded()){e.preventDefault();this.trigger_up('navigation_move',{direction:'down'});break;}}},'compositionend .o_searchview_input':'_onCompositionendInput','compositionstart .o_searchview_input':'_onCompositionstartInput',},custom_events:{menu_item_toggled:'_onItemToggled',item_option_changed:'_onItemOptionChanged',new_groupby:'_onNewGroupby',new_filters:'_onNewFilters',time_range_modified:'_onTimeRangeModified',time_range_removed:'_onTimeRangeRemoved',},defaults:_.extend({},Widget.prototype.defaults,{hidden:false,disable_custom_filters:false,disable_groupby:false,disable_favorites:false,disable_filters:false,disableTimeRangeMenu:true,}),template:"SearchView",init:function(parent,dataset,fvg,options){this._super.apply(this,arguments);this.options=options;this.dataset=dataset;this.fields_view=this._processFieldsView(_.clone(fvg));this.fields=this.fields_view.fields;this.query=undefined;this.title=this.options.action&&this.options.action.name;this.action=this.options.action||{};this.search_fields=[];this.hasFavorites=false;this.noDateFields=true;var field;for(var key in this.fields){field=this.fields[key];if(_.contains(['date','datetime'],field.type)&&field.sortable){this.noDateFields=false;break;}}
this.activeItemIds={groupByCategory:[],filterCategory:[]};this.groupsMapping=[];this.groupbysMapping=[];this.filtersMapping=[];this.intervalMapping=[];this.periodMapping=[];this.filters=[];this.groupbys=[];this.timeRanges=options.action&&options.action.context?options.action.context.time_ranges:undefined;var visibleSearchMenu=this.call('local_storage','getItem','visible_search_menu');this.visible_filters=(visibleSearchMenu!==false);this.input_subviews=[];this.search_defaults=this.options.search_defaults||{};this.headless=this.options.hidden&&_.isEmpty(this.search_defaults);this.$buttons=this.options.$buttons;this.filters_menu=undefined;this.groupby_menu=undefined;this.favorite_menu=undefined;},willStart:function(){var self=this;var def;if(!this.options.disable_favorites){def=this.loadFilters(this.dataset,this.action.id).then(function(filters){self.favorite_filters=filters;});}
return $.when(this._super(),def);},start:function(){var self=this;if(this.headless){this.do_hide();}
this.toggle_visibility(false);this.setup_global_completion();this.query=new SearchQuery().on('add change reset remove',this.proxy('do_search')).on('change',this.proxy('renderChangedFacets')).on('add reset remove',this.proxy('renderFacets'));this.$('.o_searchview_more').toggleClass('fa-search-minus',this.visible_filters).toggleClass('fa-search-plus',!this.visible_filters);var def;this.prepare_search_inputs();var $buttons=this._getButtonsElement();if($buttons){if(!this.options.disable_favorites){this.favorite_menu=new FavoriteMenu(this,this.query,this.dataset.model,this.action,this.favorite_filters);def=this.favorite_menu.appendTo($buttons);}}
return $.when(def).then(this.set_default_filters.bind(this)).then(function(){var menu_defs=[];self.timeRangeMenu=self._createTimeRangeMenu();menu_defs.push(self.timeRangeMenu.prependTo($buttons));self.timeRangeMenu.do_hide();self.displayedTimeRangeMenu=self.options.disableTimeRangeMenu!==undefined&&!self.options.disableTimeRangeMenu;self.displayTimeRangeMenu(self.displayedTimeRangeMenu);if(!self.options.disable_groupby){self.groupby_menu=self._createGroupByMenu();menu_defs.push(self.groupby_menu.prependTo($buttons));}
if(!self.options.disable_filters){self.filters_menu=self._createFiltersMenu();menu_defs.push(self.filters_menu.prependTo($buttons));}
return $.when.apply($,menu_defs);});},displayTimeRangeMenu:function(b){if(!b||this.noDateFields){this.timeRangeMenu.do_hide();}else{this.timeRangeMenu.do_show();}},on_attach_callback:function(){this._focusInput();},get_title:function(){return this.title;},set_default_filters:function(){var self=this,default_custom_filter=this.$buttons&&this.favorite_menu&&this.favorite_menu.get_default_filter();if(!self.options.disable_custom_filters&&default_custom_filter){this.hasFavorites=true;return this.favorite_menu.toggle_filter(default_custom_filter,true);}
if(!_.isEmpty(this.search_defaults)||this.timeRanges){var inputs=this.search_fields.concat(this.filters,this.groupbys);var search_defaults=_.invoke(inputs,'facet_for_defaults',this.search_defaults);var defaultTimeRange=this._searchDefaultTimeRange();search_defaults.push(defaultTimeRange);return $.when.apply(null,search_defaults).then(function(){var facets=_.compact(arguments);self.query.reset(facets,{preventSearch:true});});}
this.query.reset([],{preventSearch:true});return $.when();},do_search:function(_query,options){if(options&&options.preventSearch){return;}
var search=this.build_search_data();this.trigger_up('search',search);},build_search_data:function(noDomainEvaluation){var domains=[],contexts=[],groupbys=[];noDomainEvaluation=noDomainEvaluation||false;this.query.each(function(facet){var field=facet.get('field');var domain=field.get_domain(facet,noDomainEvaluation);if(domain){domains.push(domain);}
var context=field.get_context(facet,noDomainEvaluation);if(context){contexts.push(context);}
var group_by=field.get_groupby(facet);if(group_by){groupbys.push.apply(groupbys,group_by);}});var intervalMappingNormalized={};_.each(this.intervalMapping,function(couple){var fieldName=couple.groupby.fieldName;var interval=couple.interval;intervalMappingNormalized[fieldName]=interval;});return{domains:domains,contexts:contexts,groupbys:groupbys,intervalMapping:intervalMappingNormalized,};},toggle_visibility:function(is_visible){this.do_toggle(!this.headless&&is_visible);if(this.$buttons){this.$buttons.toggle(!this.headless&&is_visible&&this.visible_filters);}
this._focusInput();},_focusInput:function(){if(!config.device.touch&&config.device.size_class>=config.device.SIZES.MD){this.$('input').focus();}},toggle_buttons:function(is_visible){this.visible_filters=is_visible||!this.visible_filters;if(this.$buttons){this.$buttons.toggle(this.visible_filters);}},setup_global_completion:function(){var self=this;this.autocomplete=new AutoComplete(this,{source:this.proxy('complete_global_search'),select:this.proxy('select_completion'),get_search_string:function(){return self.$('.o_searchview_input').val().trim();},});this.autocomplete.appendTo(this.$('.o_searchview_input_container'));},complete_global_search:function(req,resp){var inputs=this.search_fields.concat(this.filters,this.groupbys);$.when.apply(null,_(inputs).chain().filter(function(input){return input.visible();}).invoke('complete',req.term).value()).then(function(){resp(_(arguments).chain().compact().flatten(true).value());});},select_completion:function(e,ui){var facet=ui.item.facet;e.preventDefault();if(facet&&facet.values&&facet.values.length&&String(facet.values[0].value).trim()!==""){this.query.add(facet);}else{this.query.trigger('add');}},subviewForRoot:function(subview_root){return _(this.input_subviews).detect(function(subview){return subview.$el[0]===subview_root;});},siblingSubview:function(subview,direction,wrap_around){var index=_(this.input_subviews).indexOf(subview)+direction;if(wrap_around&&index<0){index=this.input_subviews.length-1;}else if(wrap_around&&index>=this.input_subviews.length){index=0;}
return this.input_subviews[index];},focusPreceding:function(subview_root){return this.siblingSubview(this.subviewForRoot(subview_root),-1,true).$el.focus();},focusFollowing:function(subview_root){return this.siblingSubview(this.subviewForRoot(subview_root),+1,true).$el.focus();},renderFacets:function(){var self=this;var started=[];_.invoke(this.input_subviews,'destroy');this.input_subviews=[];var activeItemIds={groupByCategory:[],filterCategory:[],};var timeRangeMenuIsActive;this.query.each(function(facet){var values=facet.get('values');if(facet.attributes.cat==="groupByCategory"){activeItemIds.groupByCategory=activeItemIds.groupByCategory.concat(_.uniq(values.reduce(function(acc,value){var groupby=value.value;var description=_.findWhere(self.groupbysMapping,{groupby:groupby});if(description){acc.push(description.groupbyId);}
return acc;},[])));}
if(facet.attributes.cat==="filterCategory"){activeItemIds.filterCategory=activeItemIds.filterCategory.concat(_.uniq(values.reduce(function(acc,value){var filter=value.value;var description=_.findWhere(self.filtersMapping,{filter:filter});if(description){acc.push(description.filterId);}
return acc;},[])));}
if(facet.attributes.cat==="timeRangeCategory"){timeRangeMenuIsActive=true;}
var f=new FacetView(this,facet,this.intervalMapping,this.periodMapping);started.push(f.appendTo(self.$('.o_searchview_input_container')));self.input_subviews.push(f);},this);var i=new InputView(this);started.push(i.appendTo(self.$('.o_searchview_input_container')));self.input_subviews.push(i);_.each(this.input_subviews,function(childView){childView.on('focused',self,self.proxy('childFocused'));childView.on('blurred',self,self.proxy('childBlurred'));});$.when.apply(null,started).then(function(){if(!config.device.isMobile){_.last(self.input_subviews).$el.focus();}
if(self.groupby_menu){self.groupby_menu.updateItemsStatus(activeItemIds.groupByCategory);}
if(self.filters_menu){self.filters_menu.updateItemsStatus(activeItemIds.filterCategory);}
if(self.displayedTimeRangeMenu&&!timeRangeMenuIsActive){self.timeRangeMenu.deactivate();}});},childFocused:function(){this.$el.addClass('active');},childBlurred:function(){this.$el.val('').removeClass('active').trigger('blur');this.autocomplete.close();},renderChangedFacets:function(model,options){this.renderFacets(undefined,model,options);},prepare_search_inputs:function(){var self=this,arch=this.fields_view.arch;var filters=[].concat.apply([],_.map(arch.children,function(item){return item.tag!=='group'?eval_item(item):item.children.map(eval_item);}));function eval_item(item){var category='filters';if(item.attrs.context){try{var context=pyUtils.eval('context',item.attrs.context);if(context.group_by){category='group_by';item.attrs.fieldName=context.group_by.split(':')[0];item.attrs.isDate=_.contains(['date','datetime'],self.fields[item.attrs.fieldName].type);item.attrs.defaultInterval=context.group_by.split(':')[1];}}catch(e){}}
if(item.attrs.date){item.attrs.default_period=item.attrs.default_period||DEFAULT_PERIOD;item.attrs.type=self.fields[item.attrs.date].type;}
item.attrs.isPeriod=!!item.attrs.date;return{item:item,category:category,};}
var current_group=[],current_category='filters',categories={filters:this.filters,group_by:this.groupbys,timeRanges:this.timeRanges};_.each(filters.concat({category:'filters',item:'separator'}),function(filter){if(filter.item.tag==='filter'&&filter.category===current_category){return current_group.push(new search_inputs.Filter(filter.item,self));}
if(current_group.length){var group=new search_inputs.FilterGroup(current_group,self,self.intervalMapping,self.periodMapping);categories[current_category].push(group);current_group=[];}
if(filter.item.tag==='field'){var attrs=filter.item.attrs;var field=self.fields_view.fields[attrs.name];if(field.type==="many2one"&&attrs.widget==="selection"){attrs.widget=undefined;}
var Obj=core.search_widgets_registry.getAny([attrs.widget,field.type]);if(Obj){self.search_fields.push(new(Obj)(filter.item,field,self));}}
if(filter.item.tag==='filter'){current_group.push(new search_inputs.Filter(filter.item,self));}
current_category=filter.category;});},updateFilters:function(newFilters,filtersToRemove){var self=this;var addedFilters=_.map(newFilters,function(filter){var domain=filter.domain;if(domain instanceof Array){domain=Domain.prototype.arrayToString(domain);}
filter={attrs:{domain:domain,help:filter.help},};var filterWidget=new search_inputs.Filter(filter);var filterGroup=new search_inputs.FilterGroup([filterWidget],self,self.intervalMapping,self.periodMapping);var facet=filterGroup.make_facet([filterGroup.make_value(filter)]);self.query.add([facet],{silent:true});return _.last(self.query.models);});_.each(filtersToRemove,function(filter){self.query.remove(filter,{silent:true});});this.query.trigger('reset');return addedFilters;},_getButtonsElement:function(){return this.$buttons;},_createFiltersMenu:function(){var self=this;var filters=[];this.filters.forEach(function(group){var groupId=_.uniqueId('__group__');group.filters.forEach(function(filter){if(!filter.attrs.modifiers.invisible){var filterId=_.uniqueId('__filter__');var isPeriod=filter.attrs.isPeriod;var defaultPeriod=filter.attrs.default_period;var isActive=!self.hasFavorites&&!!self.search_defaults[filter.attrs.name];filters.push({itemId:filterId,description:filter.attrs.string||filter.attrs.help||filter.attrs.name||filter.attrs.domain||'Ω',domain:filter.attrs.domain,fieldName:filter.attrs.date,isPeriod:isPeriod,defaultOptionId:defaultPeriod,isActive:isActive,groupId:groupId,});self.filtersMapping.push({filterId:filterId,filter:filter,groupId:groupId});if(isPeriod){self.periodMapping.push({filter:filter,period:defaultPeriod,type:filter.attrs.type});}}});self.groupsMapping.push({groupId:groupId,group:group,category:'Filters'});});return new FiltersMenu(self,filters,self.fields);},_createGroupByMenu:function(){var self=this;var groupbys=[];this.groupbys.forEach(function(group){var groupId=_.uniqueId('__group__');group.filters.forEach(function(groupby){if(!groupby.attrs.modifiers.invisible){var groupbyId=_.uniqueId('__groupby__');var fieldName=groupby.attrs.fieldName;var isDate=groupby.attrs.isDate;var defaultInterval=groupby.attrs.defaultInterval||DEFAULT_INTERVAL;var isActive=!self.hasFavorites&&!!self.search_defaults[groupby.attrs.name];groupbys.push({itemId:groupbyId,description:groupby.attrs.string||groupby.attrs.help||groupby.attrs.name||groupby.attrs.fieldName||'Ω',isDate:isDate,fieldName:fieldName,defaultOptionId:defaultInterval,isActive:isActive,groupId:groupId,});if(isDate){self.intervalMapping.push({groupby:groupby,interval:defaultInterval});}
self.groupbysMapping.push({groupbyId:groupbyId,groupby:groupby,groupId:groupId});}});self.groupsMapping.push({groupId:groupId,group:group,category:'Group By'});group.updateIntervalMapping(self.intervalMapping);});return new GroupByMenu(this,groupbys,this.fields);},_createTimeRangeMenu:function(){return new TimeRangeMenu(this,this.fields,this.timeRanges);},_processFieldsView:function(fv){var doc=$.parseXML(fv.arch).documentElement;fv.arch=utils.xml_to_json(doc,true);return fv;},_searchDefaultTimeRange:function(){if(this.timeRanges){var timeRange="[]";var timeRangeDescription;var comparisonTimeRange="[]";var comparisonTimeRangeDescription;var dateField={name:this.timeRanges.field,type:this.fields[this.timeRanges.field].type,description:this.fields[this.timeRanges.field].string,};timeRange=Domain.prototype.constructDomain(dateField.name,this.timeRanges.range,dateField.type);timeRangeDescription=_.findWhere(PeriodOptions,{optionId:this.timeRanges.range}).description;if(this.timeRanges.comparison_range){comparisonTimeRange=Domain.prototype.constructDomain(dateField.name,this.timeRanges.range,dateField.type,null,this.timeRanges.comparison_range);comparisonTimeRangeDescription=_.findWhere(ComparisonOptions,{optionId:this.timeRanges.comparison_range}).description;}
return $.when({cat:'timeRangeCategory',category:_t("Time Range"),icon:'fa fa-calendar',field:{get_context:function(facet,noDomainEvaluation){if(!noDomainEvaluation){timeRange=Domain.prototype.stringToArray(timeRange);comparisonTimeRange=Domain.prototype.stringToArray(comparisonTimeRange);}
return{timeRangeMenuData:{timeRange:timeRange,timeRangeDescription:timeRangeDescription,comparisonTimeRange:comparisonTimeRange,comparisonTimeRangeDescription:comparisonTimeRangeDescription,}};},get_groupby:function(){},get_domain:function(){}},isRange:true,values:[{label:dateField.description+': '+timeRangeDescription+
(comparisonTimeRangeDescription?(' / '+comparisonTimeRangeDescription):''),value:null,}],});}else{return $.when();}},_onCompositionendInput:function(){this._isInputComposing=false;},_onCompositionstartInput:function(){this._isInputComposing=true;},_onItemToggled:function(event){var group;if(event.data.category==='groupByCategory'){var groupby=_.findWhere(this.groupbysMapping,{groupbyId:event.data.itemId}).groupby;group=_.findWhere(this.groupsMapping,{groupId:event.data.groupId}).group;if(event.data.optionId){var interval=event.data.optionId;_.findWhere(this.intervalMapping,{groupby:groupby}).interval=interval;group.updateIntervalMapping(this.intervalMapping);}
group.toggle(groupby);}
if(event.data.category==='filterCategory'){var filter=_.findWhere(this.filtersMapping,{filterId:event.data.itemId}).filter;group=_.findWhere(this.groupsMapping,{groupId:event.data.groupId}).group;if(event.data.optionId){var period=event.data.optionId;_.findWhere(this.periodMapping,{filter:filter}).period=period;group.updatePeriodMapping(this.periodMapping);}
group.toggle(filter);}},_onNewGroupby:function(event){var isDate=event.data.isDate;var attrs={context:"{'group_by':'"+event.data.fieldName+"''}",name:event.data.description,fieldName:event.data.fieldName,isDate:isDate,};var groupby=new search_inputs.Filter({attrs:attrs},this);if(event.data.optionId){var interval=event.data.optionId;this.intervalMapping.push({groupby:groupby,interval:interval});}
var group=new search_inputs.FilterGroup([groupby],this,this.intervalMapping,this.periodMapping);this.groupbysMapping.push({groupbyId:event.data.itemId,groupby:groupby,groupId:event.data.groupId,});this.groupsMapping.push({groupId:event.data.groupId,group:group,category:'Group By',});group.toggle(groupby);},_onNewFilters:function(event){var self=this;var filter;var filters=[];var groupId;_.each(event.data,function(filterDescription){filter=new search_inputs.Filter(filterDescription.filter,this);filters.push(filter);self.filtersMapping.push({filterId:filterDescription.itemId,filter:filter,groupId:filterDescription.groupId,});if(!groupId){groupId=filterDescription.groupId;}});var group=new search_inputs.FilterGroup(filters,this,this.intervalMapping,this.periodMapping);filters.forEach(function(filter){group.toggle(filter,{silent:true});});this.groupsMapping.push({groupId:groupId,group:group,category:'Filters',});this.query.trigger('reset');},_onItemOptionChanged:function(event){var group;if(event.data.category==='groupByCategory'){var groupby=_.findWhere(this.groupbysMapping,{groupbyId:event.data.itemId}).groupby;var interval=event.data.optionId;_.findWhere(this.intervalMapping,{groupby:groupby}).interval=interval;group=_.findWhere(this.groupsMapping,{groupId:event.data.groupId}).group;group.updateIntervalMapping(this.intervalMapping);this.query.trigger('reset');}
if(event.data.category==='filterCategory'){var filter=_.findWhere(this.filtersMapping,{filterId:event.data.itemId}).filter;var period=event.data.optionId;_.findWhere(this.periodMapping,{filter:filter}).period=period;group=_.findWhere(this.groupsMapping,{groupId:event.data.groupId}).group;group.updatePeriodMapping(this.periodMapping);this.query.trigger('reset');}},_onTimeRangeModified:function(){var facet=this.timeRangeMenu.facetFor();var current=this.query.find(function(facet){return facet.get('cat')==='timeRangeCategory';});if(current){this.query.remove(current,{silent:true});}
this.query.add(facet);},_onTimeRangeRemoved:function(){var current=this.query.find(function(facet){return facet.get('cat')==='timeRangeCategory';});if(current){this.query.remove(current);}},});_.extend(SearchView,{SearchQuery:SearchQuery,Facet:Facet,});return SearchView;});;

/* /web/static/src/js/views/search/search_view_mobile.js defined in bundle 'web.assets_backend' */
odoo.define('web.SearchViewMobile',function(require){"use strict";var config=require('web.config');var SearchView=require('web.SearchView');if(!config.device.isMobile){return;}
SearchView.include({template:'SearchViewMobile',events:_.extend({},SearchView.prototype.events,{'click .o_mobile_search_close, .o_mobile_search_show_result, .o_enable_searchview':'_toggleMobileSearchView','click':'_onOpenMobileSearchView','click .o_mobile_search_clear_facets':'_onEmptyAll','show.bs.dropdown .o_mobile_search_filter .o_dropdown':'_onDropdownToggle','hide.bs.dropdown .o_mobile_search_filter .o_dropdown':'_onDropdownToggle',}),renderFacets:function(){this._super.apply(this,arguments);this.$('.o_mobile_search_clear_facets').toggleClass('o_hidden',!this.query.length);},toggle_visibility:function(is_visible){},_getButtonsElement:function(){return this.$('.o_mobile_search_filter');},_toggleMobileSearchView:function(){this.$('.o_enable_searchview').toggleClass('btn-secondary',!!this.query.length);this.$('.o_mobile_search').toggleClass('o_hidden');},_onDropdownToggle:function(ev){$(ev.currentTarget).find('.fa-chevron-right').toggleClass('fa-chevron-down');},_onEmptyAll:function(){this.query.reset();},_onOpenMobileSearchView:function(ev){if(ev.target===this.el){this._toggleMobileSearchView();}},});});;

/* /web/static/src/js/views/search/search_filters.js defined in bundle 'web.assets_backend' */
odoo.define('web.search_filters',function(require){"use strict";var core=require('web.core');var datepicker=require('web.datepicker');var field_utils=require('web.field_utils');var Widget=require('web.Widget');var _t=core._t;var _lt=core._lt;var ExtendedSearchProposition=Widget.extend({template:'SearchView.extended_search.proposition',events:{'change .o_searchview_extended_prop_field':'changed','change .o_searchview_extended_prop_op':'operator_changed','click .o_searchview_extended_delete_prop':function(e){e.stopPropagation();this.trigger_up('remove_proposition');},'keyup .o_searchview_extended_prop_value':function(ev){if(ev.which===$.ui.keyCode.ENTER){this.trigger_up('confirm_proposition');}},},init:function(parent,fields){this._super(parent);this.fields=_(fields).chain().map(function(val,key){return _.extend({},val,{'name':key});}).filter(function(field){return!field.deprecated&&field.searchable;}).sortBy(function(field){return field.string;}).value();this.attrs={_:_,fields:this.fields,selected:null};this.value=null;},start:function(){return this._super().done(this.proxy('changed'));},changed:function(){var nval=this.$(".o_searchview_extended_prop_field").val();if(this.attrs.selected===null||this.attrs.selected===undefined||nval!=this.attrs.selected.name){this.select_field(_.detect(this.fields,function(x){return x.name==nval;}));}},operator_changed:function(e){this.value.show_inputs($(e.target));},select_field:function(field){var self=this;if(this.attrs.selected!==null&&this.attrs.selected!==undefined){this.value.destroy();this.value=null;this.$('.o_searchview_extended_prop_op').html('');}
this.attrs.selected=field;if(field===null||field===undefined){return;}
var type=field.type;var Field=core.search_filters_registry.getAny([type,"char"]);this.value=new Field(this,field);_.each(this.value.operators,function(operator){$('<option>',{value:operator.value}).text(String(operator.text)).appendTo(self.$('.o_searchview_extended_prop_op'));});var $value_loc=this.$('.o_searchview_extended_prop_value').show().empty();this.value.appendTo($value_loc);},get_filter:function(){if(this.attrs.selected===null||this.attrs.selected===undefined)
return null;var field=this.attrs.selected,op_select=this.$('.o_searchview_extended_prop_op')[0],operator=op_select.options[op_select.selectedIndex];return{attrs:{domain:this.value.get_domain(field,operator),string:this.value.get_label(field,operator),},children:[],tag:'filter',};},});var Field=Widget.extend({init:function(parent,field){this._super(parent);this.field=field;},get_label:function(field,operator){var format;switch(operator.value){case'∃':case'∄':format=_t('%(field)s %(operator)s');break;default:format=_t('%(field)s %(operator)s "%(value)s"');break;}
return this.format_label(format,field,operator);},format_label:function(format,field,operator){return _.str.sprintf(format,{field:field.string,operator:operator.label||operator.text,value:this});},get_domain:function(field,operator){switch(operator.value){case'∃':return[[field.name,'!=',false]];case'∄':return[[field.name,'=',false]];default:return[[field.name,operator.value,this.get_value()]];}},show_inputs:function($operator){var $value=this.$el.parent();switch($operator.val()){case'∃':case'∄':$value.hide();break;default:$value.show();}},toString:function(){return this.get_value();}});var Char=Field.extend({tagName:'input',className:'o_input',attributes:{type:'text'},operators:[{value:"ilike",text:_lt("contains")},{value:"not ilike",text:_lt("doesn't contain")},{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],get_value:function(){return this.$el.val();}});var DateTime=Field.extend({tagName:'span',serverFormat:'YYYY-MM-DD HH:mm:ss',attributes:{type:'datetime'},operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("is after")},{value:"<",text:_lt("is before")},{value:">=",text:_lt("is after or equal to")},{value:"<=",text:_lt("is before or equal to")},{value:"between",text:_lt("is between")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],get_value:function(index){var value=this["datewidget_"+(index||0)].getValue().clone();return value.add(-this.getSession().getTZOffset(value),'minutes');},get_domain:function(field,operator){switch(operator.value){case'∃':return[[field.name,'!=',false]];case'∄':return[[field.name,'=',false]];case'between':return[[field.name,'>=',this._formatMomentToServer(this.get_value(0))],[field.name,'<=',this._formatMomentToServer(this.get_value(1))]];default:return[[field.name,operator.value,this._formatMomentToServer(this.get_value())]];}},show_inputs:function($operator){this._super.apply(this,arguments);if($operator.val()==="between"){if(!this.datewidget_1){this._create_new_widget("datewidget_1");}else{this.datewidget_1.do_show();}}else{if(this.datewidget_1){this.datewidget_1.do_hide();}}},toString:function(){var str=field_utils.format[this.attributes.type](this.get_value(),{type:this.attributes.type});var date_1_value=this.datewidget_1&&!this.datewidget_1.$el.hasClass('o_hidden')&&this.get_value(1);if(date_1_value){str+=_lt(" and ")+field_utils.format[this.attributes.type](date_1_value,{type:this.attributes.type});}
return str;},start:function(){return $.when(this._super.apply(this,arguments),this._create_new_widget("datewidget_0"));},_create_new_widget:function(name){this[name]=new(this._get_widget_class())(this);return this[name].appendTo(this.$el).then((function(){this[name].setValue(moment());}).bind(this));},_get_widget_class:function(){return datepicker.DateTimeWidget;},_formatMomentToServer:function(momentValue){return momentValue.locale('en').format(this.serverFormat);},});var Date=DateTime.extend({serverFormat:'YYYY-MM-DD',attributes:{type:'date'},get_value:function(index){var value=this["datewidget_"+(index||0)].getValue();return value&&value.clone();},_get_widget_class:function(){return datepicker.DateWidget;},});var Integer=Field.extend({tagName:'input',className:'o_input',attributes:{type:'number',value:'0',},operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater than or equal to")},{value:"<=",text:_lt("less than or equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){return this.$el.val();},get_value:function(){try{var val=this.$el.val();return field_utils.parse.integer(val===""?0:val);}catch(e){return"";}}});var Id=Integer.extend({operators:[{value:"=",text:_lt("is")}]});var Float=Field.extend({template:'SearchView.extended_search.proposition.float',operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater than or equal to")},{value:"<=",text:_lt("less than or equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],init:function(parent){this._super(parent);this.decimal_point=_t.database.parameters.decimal_point;},toString:function(){return this.$el.val();},get_value:function(){try{var val=this.$el.val();return field_utils.parse.float(val===""?0.0:val);}catch(e){return"";}}});var Selection=Field.extend({template:'SearchView.extended_search.proposition.selection',operators:[{value:"=",text:_lt("is")},{value:"!=",text:_lt("is not")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){var select=this.$el[0];var option=select.options[select.selectedIndex];return option.label||option.text;},get_value:function(){return this.$el.val();}});var Boolean=Field.extend({tagName:'span',operators:[{value:"=",text:_lt("is true")},{value:"!=",text:_lt("is false")}],get_label:function(field,operator){return this.format_label(_t('%(field)s %(operator)s'),field,operator);},get_value:function(){return true;}});core.search_filters_registry.add('char',Char).add('text',Char).add('one2many',Char).add('many2one',Char).add('many2many',Char).add('datetime',DateTime).add('date',Date).add('integer',Integer).add('float',Float).add('monetary',Float).add('boolean',Boolean).add('selection',Selection).add('id',Id);return{ExtendedSearchProposition:ExtendedSearchProposition};});;

/* /web/static/src/js/views/search/search_inputs.js defined in bundle 'web.assets_backend' */
odoo.define('web.search_inputs',function(require){"use strict";var Context=require('web.Context');var core=require('web.core');var Domain=require('web.Domain');var field_utils=require('web.field_utils');var pyUtils=require('web.py_utils');var time=require('web.time');var utils=require('web.utils');var Widget=require('web.Widget');var _t=core._t;var _lt=core._lt;var Input=Widget.extend({init:function(parent){this._super(parent);this.searchview=parent;this.load_attrs({});},complete:function(value){return $.when(null);},facet_for_defaults:function(defaults){if(!this.attrs||!(this.attrs.name in defaults&&defaults[this.attrs.name])){return $.when(null);}
return this.facet_for(defaults[this.attrs.name]);},get_context:function(){throw new Error("get_context not implemented for widget "+this.attrs.type);},get_groupby:function(){throw new Error("get_groupby not implemented for widget "+this.attrs.type);},get_domain:function(){throw new Error("get_domain not implemented for widget "+this.attrs.type);},load_attrs:function(attrs){if(!_.isObject(attrs.modifiers)){attrs.modifiers=attrs.modifiers?JSON.parse(attrs.modifiers):{};}
this.attrs=attrs;},visible:function(){return!this.attrs.modifiers.invisible;},});var Field=Input.extend({template:'SearchView.field',default_operator:'=',init:function(view_section,field,parent){this._super(parent);this.load_attrs(_.extend({},field,view_section.attrs));},facet_for:function(value){return $.when({field:this,category:this.attrs.string||this.attrs.name,values:[{label:String(value),value:value}]});},value_from:function(facetValue){return facetValue.get('value');},get_context:function(facet){var self=this;var context=this.attrs.context;if(_.isEmpty(context)||!facet.values.length){return;}
var contexts=facet.values.map(function(facetValue){return new Context(context).set_eval_context({self:self.value_from(facetValue)});});if(contexts.length===1){return contexts[0];}
return _.extend(new Context(),{__contexts:contexts});},get_groupby:function(){},make_domain:function(name,operator,facet){return[[name,operator,this.value_from(facet)]];},get_domain:function(facet,noDomainEvaluation){if(!facet.values.length){return;}
var value_to_domain;var self=this;var domain=this.attrs.filter_domain;if(domain){value_to_domain=function(facetValue){return Domain.prototype.stringToArray(domain,{self:self.value_from(facetValue),raw_value:facetValue.attributes.value});};}else{value_to_domain=function(facetValue){return self.make_domain(self.attrs.name,self.attrs.operator||self.default_operator,facetValue);};}
var domains=facet.values.map(value_to_domain);if(noDomainEvaluation){domains=domains.map(Domain.prototype.arrayToString);return pyUtils.assembleDomains(domains,'OR');}
if(domains.length===1){return domains[0];}
_.each(domains,Domain.prototype.normalizeArray);var ors=_.times(domains.length-1,_.constant("|"));return ors.concat.apply(ors,domains);}});var CharField=Field.extend({default_operator:'ilike',complete:function(value){if(_.isEmpty(value)){return $.when(null);}
var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s for: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:value}]}}]);}});var NumberField=Field.extend({complete:function(value){var val=this.parse(value);if(isNaN(val)){return $.when();}
var label=_.str.sprintf(_t("Search %(field)s for: %(value)s"),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:val}]}}]);},});var IntegerField=NumberField.extend({error_message:_t("not a valid integer"),parse:function(value){try{return field_utils.parse.integer(value);}catch(e){return NaN;}}});var FloatField=NumberField.extend({error_message:_t("not a valid number"),parse:function(value){try{return field_utils.parse.float(value);}catch(e){return NaN;}}});function facet_from(field,pair){return{field:field,category:field.attrs.string,values:[{label:pair[1],value:pair[0]}]};}
var SelectionField=Field.extend({template:'SearchView.field.selection',init:function(){this._super.apply(this,arguments);this.prepend_empty=!_(this.attrs.selection).detect(function(item){return!item[1];});},complete:function(needle){var self=this;var results=_(this.attrs.selection).chain().filter(function(sel){var value=sel[0],label=sel[1];if(value===undefined||!label){return false;}
return label.toLowerCase().indexOf(needle.toLowerCase())!==-1;}).map(function(sel){return{label:_.escape(sel[1]),indent:true,facet:facet_from(self,sel)};}).value();if(_.isEmpty(results)){return $.when(null);}
return $.when.call(null,[{label:_.escape(this.attrs.string)}].concat(results));},facet_for:function(value){var match=_(this.attrs.selection).detect(function(sel){return sel[0]===value;});if(!match){return $.when(null);}
return $.when(facet_from(this,match));}});var BooleanField=SelectionField.extend({init:function(){this._super.apply(this,arguments);this.attrs.selection=[[true,_t("Yes")],[false,_t("No")]];}});var DateField=Field.extend({value_from:function(facetValue){var serverFormat=(this.attrs&&this.attrs.type==='datetime')?'YYYY-MM-DD HH:mm:ss':'YYYY-MM-DD';if(facetValue.get('valueAsMoment')){return facetValue.get('valueAsMoment').clone().format(serverFormat);}else{return moment(facetValue.get('value')).format(serverFormat);}},complete:function(needle){var t,v;try{t=(this.attrs&&this.attrs.type==='datetime')?'datetime':'date';v=field_utils.parse[t](needle,{type:t},{timezone:true});}catch(e){return $.when(null);}
var m=moment(v,t==='datetime'?'YYYY-MM-DD HH:mm:ss':'YYYY-MM-DD');if(!m.isValid()){return $.when(null);}
var date_string=field_utils.format[t](m,{type:t});var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s at: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+date_string+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:date_string,value:m.toDate(),valueAsMoment:m.clone()}]}}]);}});var DateTimeField=DateField;var ManyToOneField=CharField.extend({default_operator:{},init:function(view_section,field,parent){this._super(view_section,field,parent);this.searchview=parent;},complete:function(value){if(_.isEmpty(value)){return $.when(null);}
var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s for: %(value)s")),{field:'<em>'+_.escape(this.attrs.string)+'</em>',value:'<strong>'+_.escape(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:value,operator:'ilike'}]},expand:this.expand.bind(this),}]);},expand:function(needle){var self=this;var context=pyUtils.eval('contexts',[this.searchview.dataset.get_context()]);var args=this.attrs.domain;if(typeof args==='string'){try{args=Domain.prototype.stringToArray(args);}catch(e){args=[];}}
return this._rpc({model:this.attrs.relation,method:'name_search',kwargs:{name:needle,args:args,limit:8,context:context},}).then(function(results){if(_.isEmpty(results)){return null;}
return _(results).map(function(result){return{label:_.escape(result[1]),facet:facet_from(self,result)};});});},facet_for:function(value){var self=this;if(value instanceof Array){if(value.length===2&&_.isString(value[1])){return $.when(facet_from(this,value));}
utils.assert(value.length<=1,_t("M2O search fields do not currently handle multiple default values"));value=value[0];}
var context=pyUtils.eval('contexts',[this.searchview.dataset.get_context()]);return this._rpc({model:this.attrs.relation,method:'name_get',args:[value],context:context,}).then(function(names){if(_(names).isEmpty()){return null;}
return facet_from(self,names[0]);});},value_from:function(facetValue){return facetValue.get('label');},make_domain:function(name,operator,facetValue){operator=facetValue.get('operator')||operator;switch(operator){case this.default_operator:return[[name,'=',facetValue.get('value')]];case'ilike':return[[name,'ilike',facetValue.get('value')]];case'child_of':return[[name,'child_of',facetValue.get('value')]];}
return this._super(name,operator,facetValue);},get_context:function(facet){var values=facet.values;if(_.isEmpty(this.attrs.context)&&values.length===1){var c={};var v=values.at(0);if(v.get('operator')!=='ilike'){c['default_'+this.attrs.name]=v.get('value');}
return c;}
return this._super(facet);}});var FilterGroup=Input.extend({template:'SearchView.filters',events:{click:'toggle_filter',},icon:"fa-filter",completion_label:_lt("Filter on: %s"),init:function(filters,parent,intervalMapping,periodMapping){if(!(this instanceof GroupbyGroup)&&_(filters).all(function(f){if(!f.attrs.context){return false;}
var c=pyUtils.eval('context',f.attrs.context);return!_.isEmpty(c.group_by);})){return new GroupbyGroup(filters,parent,intervalMapping);}
this._super(parent);this.filters=filters;this.searchview=parent;this.intervalMapping=intervalMapping;this.periodMapping=periodMapping||[];this.searchview.query.on('add remove change reset',this.proxy('search_change'));},start:function(){return $.when(null);},search_change:function(){var self=this;var $filters=this.$el?this.$el.removeClass('selected'):$();var facet=this.searchview.query.find(_.bind(this.match_facet,this));if(!facet){return;}
facet.values.each(function(v){var i=_(self.filters).indexOf(v.get('value'));if(i===-1){return;}
$filters.filter(function(){return Number($(this).data('index'))===i;}).addClass('selected');});},match_facet:function(facet){return facet.get('field')===this;},make_facet:function(values){return{cat:'filterCategory',category:_t("Filter"),icon:this.icon,separator:_t(" or "),values:values,field:this};},make_value:function(filter){return{label:filter.attrs.string||filter.attrs.help||filter.attrs.name,value:filter};},facet_for_defaults:function(defaults){var self=this;var fs=_(this.filters).chain().filter(function(f){return f.attrs&&f.attrs.name&&!!defaults[f.attrs.name];}).map(function(f){return self.make_value(f);}).value();if(_.isEmpty(fs)){return $.when(null);}
return $.when(this.make_facet(fs));},get_context:function(facet){var contexts=facet.values.chain().map(function(f){return f.get('value').attrs.context;}).without('{}').reject(_.isEmpty).value();if(!contexts.length){return;}
if(contexts.length===1){return contexts[0];}
return _.extend(new Context(),{__contexts:contexts});},get_groupby:function(facet){var self=this;return facet.values.chain().map(function(f){var fieldName=f.get('value').attrs.fieldName;var defaultInterval=f.get('value').attrs.defaultInterval;var couple=_.findWhere(self.intervalMapping,{groupby:f.get('value')});var interval=couple?couple.interval:undefined;var context=_.clone(f.get('value').attrs.context);if(context&&interval){if(defaultInterval){context=context.replace(defaultInterval,interval);}else if(fieldName){context=context.replace(fieldName,fieldName+':'+interval);}}
return context;}).without('{}').reject(_.isEmpty).value();},get_domain:function(facet,noEvaluation){noEvaluation=noEvaluation||false;var self=this;var userContext=this.getSession().user_context;var domains=facet.values.chain().map(function(f){var filter=f.get('value');var attributes=filter.attrs;var domain=attributes.domain;var fieldName=attributes.date;if(!domain&&fieldName){var couple=_.findWhere(self.periodMapping,{filter:filter});var period=couple?couple.period:'this_month';var type=couple?couple.type:'date';domain=Domain.prototype.constructDomain(fieldName,period,type);}
return domain;}).without('[]').reject(_.isEmpty).map(function(domain){if(typeof domain!=='string'){domain=JSON.stringify(domain);}
domain=domain.replace(/%%/g,'%');return domain;}).value();if(!domains.length){return;}
var domain=pyUtils.assembleDomains(domains,'OR');if(!noEvaluation){return Domain.prototype.stringToArray(domain,userContext);}
return domain;},toggle_filter:function(e){e.preventDefault();e.stopPropagation();this.toggle(this.filters[Number($(e.currentTarget).data('index'))]);},toggle:function(filter,options){this.searchview.query.toggle(this.make_facet([this.make_value(filter)]),options);},is_visible:function(){return _.some(this.filters,function(filter){return!filter.attrs.invisible;});},complete:function(item){var self=this;item=item.toLowerCase();var facet_values=_(this.filters).chain().filter(function(filter){return filter.visible();}).filter(function(filter){var at={string:filter.attrs.string||'',help:filter.attrs.help||'',name:filter.attrs.name||''};var include=_.str.include;return include(at.string.toLowerCase(),item)||include(at.help.toLowerCase(),item)||include(at.name.toLowerCase(),item);}).map(this.make_value).value();if(_(facet_values).isEmpty()){return $.when(null);}
return $.when(_.map(facet_values,function(facet_value){return{label:_.str.sprintf(self.completion_label.toString(),_.escape(facet_value.label)),facet:self.make_facet([facet_value])};}));},updateIntervalMapping:function(intervalMapping){this.intervalMapping=intervalMapping;},updatePeriodMapping:function(periodMapping){this.intervalMapping=periodMapping;},});var GroupbyGroup=FilterGroup.extend({icon:'fa-bars',completion_label:_lt("Group by: %s"),init:function(filters,parent){this._super.apply(this,arguments);this.searchview=parent;if(!this.searchview._s_groupby){this.searchview._s_groupby={help:"See GroupbyGroup#init",get_context:this.proxy('get_context'),get_domain:this.proxy('get_domain'),get_groupby:this.proxy('get_groupby')};}},match_facet:function(facet){return facet.get('field')===this.searchview._s_groupby;},make_facet:function(values){return{cat:'groupByCategory',category:_t("Group By"),icon:this.icon,separator:" > ",values:values,field:this.searchview._s_groupby};}});var Filter=Input.extend({template:'SearchView.filter',init:function(node,parent){this._super(parent);this.load_attrs(node.attrs);},facet_for:function(){return $.when(null);},get_context:function(){},get_domain:function(){},});core.search_widgets_registry.add('char',CharField).add('text',CharField).add('html',CharField).add('boolean',BooleanField).add('integer',IntegerField).add('id',IntegerField).add('float',FloatField).add('monetary',FloatField).add('selection',SelectionField).add('datetime',DateTimeField).add('date',DateField).add('many2one',ManyToOneField).add('many2many',CharField).add('one2many',CharField);return{FilterGroup:FilterGroup,Filter:Filter,Field:Field,GroupbyGroup:GroupbyGroup,};});;

/* /web/static/src/js/views/search/favorites_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.FavoriteMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var data_manager=require('web.data_manager');var Domain=require('web.Domain');var pyUtils=require('web.py_utils');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;return Widget.extend({template:'SearchView.FavoriteMenu',events:{'click .dropdown-item':function(ev){ev.preventDefault();},'click .o_save_search':function(ev){ev.preventDefault();ev.stopPropagation();this.toggle_save_menu();},'click .o_save_name button':'save_favorite','hidden.bs.dropdown':'_closeMenus','keyup .o_save_name input':function(ev){if(ev.which===$.ui.keyCode.ENTER){this.save_favorite();}},},init:function(parent,query,target_model,action,filters){this._super.apply(this,arguments);this.searchview=parent;this.query=query;this.target_model=target_model;this.action=action;this.action_id=action.id;this.filters={};this.isMobile=config.device.isMobile;_.each(filters,this.add_filter.bind(this));},start:function(){var self=this;this.$filters={};this.$save_search=this.$('.o_save_search');this.$save_name=this.$('.o_save_name');this.$inputs=this.$save_name.find('input');this.$user_divider=this.$('.dropdown-divider.user_filter');this.$shared_divider=this.$('.dropdown-divider.shared_filter');this.$inputs.eq(0).val(this.searchview.get_title());var $shared_filter=this.$inputs.eq(1),$default_filter=this.$inputs.eq(2);$shared_filter.click(function(){$default_filter.prop('checked',false);});$default_filter.click(function(){$shared_filter.prop('checked',false);});this.query.on('remove',function(facet){if(facet.get('is_custom_filter')){self.clear_selection();}}).on('reset',this.proxy('clear_selection'));_.each(this.filters,this.append_filter.bind(this));this.$dropdownReference=this.$('.o_dropdown_toggler_btn');this.$menu=this.$('.o_favorites_menu');if(_t.database.parameters.direction==='rtl'){this.$menu.addClass('dropdown-menu-right');}
return this._super();},toggle_save_menu:function(is_open){this.$save_search.attr('aria-expanded',!(_.isUndefined(is_open))?is_open:(this.$save_search.attr('aria-expanded')==='false')).toggleClass('o_closed_menu',!(_.isUndefined(is_open))?!is_open:undefined).toggleClass('o_open_menu',is_open);this.$save_name.toggle(is_open);if(this.$save_search.hasClass('o_open_menu')){this.$save_name.find('input').first().focus();}
this.$dropdownReference.dropdown('update');},_closeMenus:function(){this.toggle_save_menu(false);},save_favorite:function(){var self=this,filter_name=this.$inputs[0].value,default_filter=this.$inputs[1].checked,shared_filter=this.$inputs[2].checked;if(!filter_name.length){this.do_warn(_t("Error"),_t("Filter name is required."));this.$inputs.first().focus();return;}
if(_.chain(this.filters).pluck('name').contains(filter_name).value()){this.do_warn(_t("Error"),_t("Filter with same name already exists."));this.$inputs.first().focus();return;}
var user_context=this.getSession().user_context;var search=this.searchview.build_search_data(true);var domain=pyUtils.assembleDomains(search.domains,'AND');var controllerContext;this.trigger_up('get_controller_context',{callback:function(ctx){if(ctx&&ctx.orderedBy){var sort=_.map(ctx.orderedBy,function(obj){var order=obj.asc?'ASC':'DESC';return obj.name+' '+order;});self.searchview.dataset.set_sort(sort);}
controllerContext=_.omit(ctx,['orderedBy']);},});var results=pyUtils.eval_domains_and_contexts({domains:[],contexts:[user_context].concat(search.contexts.concat(controllerContext||[])),group_by_seq:search.groupbys||[],});if(!_.isEmpty(results.group_by)){results.context.group_by=results.group_by;}
var ctx=results.context;_(_.keys(session.user_context)).each(function(key){delete ctx[key];});var filter={name:filter_name,user_id:shared_filter?false:session.uid,model_id:this.target_model,context:results.context,domain:domain,sort:JSON.stringify(this.searchview.dataset._sort),is_default:default_filter,action_id:this.action_id,};return this._createFilter(filter).then(function(id){filter.id=id;self.toggle_save_menu(false);self.$save_name.find('input').val('').prop('checked',false);self.add_filter(filter);self.append_filter(filter);self.toggle_filter(filter,true);});},get_default_filter:function(){var personal_filter=_.find(this.filters,function(filter){return filter.user_id&&filter.is_default;});if(personal_filter){return personal_filter;}
return _.find(this.filters,function(filter){return!filter.user_id&&filter.is_default;});},key_for:function(filter){var user_id=filter.user_id,action_id=filter.action_id,uid=(user_id instanceof Array)?user_id[0]:user_id,act_id=(action_id instanceof Array)?action_id[0]:action_id;return _.str.sprintf('(%s)(%s)%s',uid,act_id,filter.name);},facet_for:function(filter){var self=this;return{category:_t("Custom Filter"),icon:'fa-star',field:{get_context:function(){var filterContext=filter.context;if(typeof filter.context==='string'){filterContext=pyUtils.eval('context',filter.context);}
var sortParsed=JSON.parse(filter.sort||"[]");var orderedBy=[];_.each(sortParsed,function(sort){orderedBy.push({name:sort[0]==='-'?sort.slice(1):sort,asc:sort[0]==='-'?false:true,});});return _.defaults({},filterContext,{orderedBy:orderedBy});},get_groupby:function(){return[filter.context];},get_domain:function(facet,noEvaluation){noEvaluation=noEvaluation||false;var userContext=self.getSession().user_context;var domain=pyUtils.assembleDomains([filter.domain]);if(!noEvaluation){return Domain.prototype.stringToArray(domain,userContext);}
return domain;}},_id:filter.id,is_custom_filter:true,values:[{label:filter.name,value:null}]};},clear_selection:function(){this.$('.selected').removeClass('selected').attr('aria-checked','false');},add_filter:function(filter){this.filters[this.key_for(filter)]=filter;},append_filter:function(filter){var self=this;var key=this.key_for(filter);if(filter.user_id){this.$user_divider.show();}else{this.$shared_divider.show();}
if(!(key in this.$filters)){var $filter=$('<div>',{class:'position-relative'}).addClass(filter.user_id?'o-searchview-custom-private':'o-searchview-custom-public').append($('<a>',{role:'menuitemradio',href:'#',class:'dropdown-item'}).text(filter.name)).append($('<span>',{class:'fa fa-trash-o o-remove-filter',on:{click:function(event){event.stopImmediatePropagation();self.remove_filter(filter,$filter,key);},},})).insertBefore(filter.user_id?this.$user_divider:this.$shared_divider);this.$filters[key]=$filter;}
this.$filters[key].unbind('click').click(function(){self.toggle_filter(filter);});},toggle_filter:function(filter,preventSearch){var current=this.query.find(function(facet){return facet.get('_id')===filter.id;});if(current){this.query.remove(current);this.$filters[this.key_for(filter)].find('.dropdown-item').removeClass('selected').attr('aria-checked','false');return;}
this.query.reset([this.facet_for(filter)],{preventSearch:preventSearch||false});if(!_.isUndefined(filter.sort)){var sort_items=JSON.parse(filter.sort);this.searchview.dataset.set_sort(sort_items);}
this.$filters[this.key_for(filter)].find('.dropdown-item').addClass('selected').attr('aria-checked','true');},remove_filter:function(filter,$filter,key){var self=this;var global_warning=_t("This filter is global and will be removed for everybody if you continue."),warning=_t("Are you sure that you want to remove this filter?");if(!confirm(filter.user_id?warning:global_warning)){return;}
return data_manager.delete_filter(filter).done(function(){$filter.remove();delete self.$filters[key];delete self.filters[key];var has_user_filter=_.find(self.filters,function(filter){return filter.user_id;});var has_shared_filer=_.find(self.filters,function(filter){return!filter.user_id;});if(!has_user_filter){self.$user_divider.hide();}
if(!has_shared_filer){self.$shared_divider.hide();}});},_createFilter:function(filter){var def=$.Deferred();this.trigger_up('create_filter',{filter:filter,on_success:def.resolve.bind(def),});return def;},});});;

/* /web/static/src/js/views/search/groupby_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.GroupByMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var DropdownMenu=require('web.DropdownMenu');var QWeb=core.qweb;var _t=core._t;var GROUPABLE_TYPES=['many2one','char','boolean','selection','date','datetime'];var DEFAULT_INTERVAL='month';var GroupByMenu=DropdownMenu.extend({events:_.extend({},DropdownMenu.prototype.events,{'click .o_add_custom_group':'_onAddCustomGroupClick','click button.o_apply_group':'_onButtonApplyClick','click .o_group_selector':'_onGroupSelectorClick',}),init:function(parent,groupbys,fields,options){var self=this;this.fields=fields;this.generatorMenuIsOpen=false;this.intervalOptions=[{description:_t('Day'),optionId:'day',groupId:1},{description:_t('Week'),optionId:'week',groupId:1},{description:_t('Month'),optionId:'month',groupId:1},{description:_t('Quarter'),optionId:'quarter',groupId:1},{description:_t('Year'),optionId:'year',groupId:1},];this.defaultOptionId=DEFAULT_INTERVAL;this.groupableFields=[];_.each(fields,function(field,name){if(field.sortable&&_.contains(GROUPABLE_TYPES,field.type)){self.groupableFields.push(_.extend({},field,{name:name,isDate:_.contains(['date','datetime'],field.type),}));}});this.groupableFields=_.sortBy(this.groupableFields,'string');_.each(groupbys,this._prepareItem.bind(this));this.presentedFields=_.filter(this.groupableFields,function(field){var groupByFields=_.pluck(groupbys,'fieldName');return!_.contains(groupByFields,field.name);});this.isMobile=config.device.isMobile;var style;if(options&&options.headerStyle==='primary'){style={el:{class:'btn-group o_graph_groupbys_menu o_dropdown',attrs:{'role':'group'}},mainButton:{class:'btn btn-primary dropdown-toggle'},};}
var dropdownHeader={category:'groupByCategory',title:_t('Group By'),icon:'fa fa-bars',symbol:this.isMobile?'fa fa-chevron-right float-right mt4':false,style:style,};this._super(parent,dropdownHeader,groupbys,options);},start:function(){this._super.apply(this,arguments);this.$menu.addClass('o_group_by_menu');var $generatorMenu=QWeb.render('GroupbyMenuGenerator',{widget:this});this.$menu.append($generatorMenu);this.$addCustomGroup=this.$menu.find('.o_add_custom_group');},_addGroupby:function(fieldName){var field=_.findWhere(this.groupableFields,{name:fieldName});var groupbyName=_.uniqueId('__groupby__');var groupby={itemId:groupbyName,description:field.string,fieldName:fieldName,groupId:_.uniqueId('__group__'),isActive:true,};var eventData=_.clone(groupby);this._prepareItem(groupby);if(groupby.hasOptions){groupby.defaultOptionId=DEFAULT_INTERVAL;groupby.currentOptionId=DEFAULT_INTERVAL;groupby.isDate=true;eventData.optionId=groupby.currentOptionId;eventData.isDate=true;}
this.items.push(groupby);var fieldIndex=this.presentedFields.indexOf(field);this.presentedFields.splice(fieldIndex,1);this._renderGeneratorMenu();this._renderMenuItems();this.trigger_up('new_groupby',eventData);},_prepareItem:function(item){if(_.contains(['date','datetime'],this.fields[item.fieldName].type)){item.options=this.intervalOptions;}
this._super.apply(this,arguments);},_renderGeneratorMenu:function(){this.$el.find('.o_generator_menu').remove();var $generatorMenu=QWeb.render('GroupbyMenuGenerator',{widget:this});this.$menu.append($generatorMenu);this.$addCustomGroup=this.$menu.find('.o_add_custom_group');this.$groupSelector=this.$menu.find('.o_group_selector');},_toggleCustomGroupMenu:function(){this.generatorMenuIsOpen=!this.generatorMenuIsOpen;this._renderGeneratorMenu();this.$addCustomGroup.attr('aria-expanded',this.generatorMenuIsOpen);if(this.generatorMenuIsOpen){this.$groupSelector.focus();}},_onAddCustomGroupClick:function(event){event.preventDefault();event.stopPropagation();this._toggleCustomGroupMenu();},_onBootstrapClose:function(){this._super.apply(this,arguments);this.generatorMenuIsOpen=false;this._renderGeneratorMenu();},_onButtonApplyClick:function(event){event.stopPropagation();var fieldName=this.$groupSelector.val();this._addGroupby(fieldName);this._toggleCustomGroupMenu();},_onGroupSelectorClick:function(event){event.stopPropagation();},});return GroupByMenu;});;

/* /web/static/src/js/views/search/time_range_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.TimeRangeMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Domain=require('web.Domain');var TimeRangeMenuOptions=require('web.TimeRangeMenuOptions');var Widget=require('web.Widget');var _t=core._t;var ComparisonOptions=TimeRangeMenuOptions.ComparisonOptions;var PeriodOptions=TimeRangeMenuOptions.PeriodOptions;var TimeRangeMenu=Widget.extend({template:'web.TimeRangeMenu',events:{'click .o_apply_range':'_onApplyButtonClick','click .o_comparison_checkbox':'_onCheckBoxClick',},init:function(parent,fields,configuration){var self=this;this.isMobile=config.device.isMobile;this.symbol=this.isMobile?'fa fa-chevron-right float-right mt4':'caret';this._super(parent);this.dateFields=[];_.each(fields,function(field,name){if(field.sortable&&_.contains(['date','datetime'],field.type)){self.dateFields.push(_.extend({},field,{name:name,}));}});this.periodOptions=PeriodOptions;this.periodGroups=PeriodOptions.reduce(function(acc,option){if(!_.contains(acc,option.groupId)){acc.push(option.groupId);}
return acc;},[]);this.comparisonOptions=ComparisonOptions;this.isActive=false;this.timeRangeId=undefined;this.comparisonIsSelected=false;this.comparisonTimeRangeId=undefined;this.dateField={};if(configuration&&configuration.field&&configuration.range){this.isActive=true;var dateField=_.findWhere(this.dateFields,{name:configuration.field});this.dateField={name:dateField.name,description:dateField.string,type:dateField.type,};this.timeRangeId=configuration.range;if(configuration.comparison_range){this.comparisonIsSelected=true;this.comparisonTimeRangeId=configuration.comparison_range;}}},deactivate:function(){this.isActive=false;this.comparisonIsSelected=false;this.renderElement();},facetFor:function(){var fieldDescription;var timeRange="[]";var timeRangeDescription;var comparisonTimeRange="[]";var comparisonTimeRangeDescription;if(this.isActive){fieldDescription=this.dateField.description;if(this.timeRangeId!=='custom'){timeRange=Domain.prototype.constructDomain(this.dateField.name,this.timeRangeId,this.dateField.type);var rawDescriptionRange=_.findWhere(this.periodOptions,{optionId:this.timeRangeId}).description;timeRangeDescription=rawDescriptionRange.toString?rawDescriptionRange.toString():rawDescriptionRange;}
if(this.comparisonIsSelected){comparisonTimeRange=Domain.prototype.constructDomain(this.dateField.name,this.timeRangeId,this.dateField.type,null,this.comparisonTimeRangeId);var rawDescriptionCompare=_.findWhere(this.comparisonOptions,{optionId:this.comparisonTimeRangeId}).description;comparisonTimeRangeDescription=rawDescriptionCompare.toString?rawDescriptionCompare.toString():rawDescriptionCompare;}}
return{cat:'timeRangeCategory',category:_t("Time Range"),icon:'fa fa-calendar',field:{get_context:function(facet,noDomainEvaluation){if(!noDomainEvaluation){timeRange=Domain.prototype.stringToArray(timeRange);comparisonTimeRange=Domain.prototype.stringToArray(comparisonTimeRange);}
return{timeRangeMenuData:{timeRange:timeRange,timeRangeDescription:timeRangeDescription,comparisonTimeRange:comparisonTimeRange,comparisonTimeRangeDescription:comparisonTimeRangeDescription,}};},get_groupby:function(){},get_domain:function(){}},isRange:true,values:[{label:fieldDescription+': '+timeRangeDescription+
(comparisonTimeRangeDescription?(' / '+comparisonTimeRangeDescription):''),value:null,}],};},_onApplyButtonClick:function(){this.isActive=true;var dateFieldName=this.$('.o_date_field_selector').val();this.timeRangeId=this.$('.o_time_range_selector').val();if(this.comparisonIsSelected){this.comparisonTimeRangeId=this.$('.o_comparison_time_range_selector').val();}
this.dateField={name:dateFieldName,type:_.findWhere(this.dateFields,{name:dateFieldName}).type,description:_.findWhere(this.dateFields,{name:dateFieldName}).string,};this.renderElement();this.trigger_up('time_range_modified');},_onCheckBoxClick:function(ev){ev.stopPropagation();this.comparisonIsSelected=this.$('.o_comparison_checkbox').prop('checked');this.$('.o_comparison_time_range_selector').toggleClass('o_hidden');this.$el.addClass('open');}});return TimeRangeMenu;});;

/* /web/static/src/js/views/search/time_range_menu_options.js defined in bundle 'web.assets_backend' */
odoo.define('web.TimeRangeMenuOptions',function(require){"use strict";var core=require('web.core');var _lt=core._lt;var PeriodOptions=[{description:_lt('Last 7 Days'),optionId:'last_7_days',groupId:1},{description:_lt('Last 30 Days'),optionId:'last_30_days',groupId:1},{description:_lt('Last 365 Days'),optionId:'last_365_days',groupId:1},{description:_lt('Today'),optionId:'today',groupId:2},{description:_lt('This Week'),optionId:'this_week',groupId:2},{description:_lt('This Month'),optionId:'this_month',groupId:2},{description:_lt('This Quarter'),optionId:'this_quarter',groupId:2},{description:_lt('This Year'),optionId:'this_year',groupId:2},{description:_lt('Yesterday'),optionId:'yesterday',groupId:3},{description:_lt('Last Week'),optionId:'last_week',groupId:3},{description:_lt('Last Month'),optionId:'last_month',groupId:3},{description:_lt('Last Quarter'),optionId:'last_quarter',groupId:3},{description:_lt('Last Year'),optionId:'last_year',groupId:3},];var ComparisonOptions=[{description:_lt('Previous Period'),optionId:'previous_period'},{description:_lt('Previous Year'),optionId:'previous_year'}];return{PeriodOptions:PeriodOptions,ComparisonOptions:ComparisonOptions,};});;

/* /web/static/src/js/views/search/groupby_menu_interface_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('web.GroupByMenuInterfaceMixin',function(require){"use strict";var GroupByMenu=require('web.GroupByMenu');var GroupByMenuInterfaceMixin={init:function(){this.custom_events=_.extend({},this.custom_events,{menu_item_toggled:'_onMenuItemToggled',item_option_changed:'_onItemOptionChanged',});},_addGroupByMenu:function($node,groupableFields){var groupbys=[];var activeGroupbys=[];_.each(this.model.get().groupedBy,function(groupby){activeGroupbys.push({fieldName:groupby.split(':')[0],interval:groupby.split(':')[1]||false});});var groupId='__group__1';_.each(groupableFields,function(field,fieldName){var groupby=_.findWhere(activeGroupbys,{fieldName:fieldName});groupbys.push({isActive:groupby?true:false,description:field.string,itemId:fieldName,fieldName:fieldName,groupId:groupId,defaultOptionId:groupby?groupby.interval:false,});});groupbys=_.sortBy(groupbys,'description');var groupByMenu=new GroupByMenu(this,groupbys,groupableFields,{headerStyle:'primary'});groupByMenu.insertAfter($node.find('div:first'));},_setGroupby:function(groupbys){},_onItemOptionChanged:function(ev){var fieldName=ev.data.itemId;var interval=ev.data.optionId;var groupbys=this.model.get().groupedBy;var groupbysNormalized=_.map(groupbys,function(groupby){return groupby.split(':')[0];});var indexOfGroupby=groupbysNormalized.indexOf(fieldName);groupbys.splice(indexOfGroupby,1,fieldName+':'+interval);this._setGroupby(groupbys);},_onMenuItemToggled:function(ev){var fieldName=ev.data.itemId;var interval=ev.data.optionId;var groupbys=this.model.get().groupedBy;var groupbysNormalized=_.map(groupbys,function(groupby){return groupby.split(':')[0];});var indexOfGroupby=groupbysNormalized.indexOf(fieldName);if(indexOfGroupby===-1){groupbys.push(fieldName+(interval?(':'+interval):''));}else{groupbys.splice(indexOfGroupby,1);}
this._setGroupby(groupbys);},};return GroupByMenuInterfaceMixin;});;

/* /web/static/src/js/widgets/dropdown_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.DropdownMenu',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var DropdownMenu=Widget.extend({template:'web.DropdownMenu',events:{'click .o_menu_item':'_onItemClick','click .o_item_option':'_onOptionClick','click span.o_trash_button':'_onTrashClick','hidden.bs.dropdown':'_onBootstrapClose','click .dropdown-item-text':'_onDropDownItemTextClick',},init:function(parent,dropdownHeader,items){this._super(parent);this.dropdownCategory=dropdownHeader.category;this.dropdownTitle=dropdownHeader.title;this.dropdownIcon=dropdownHeader.icon;this.dropdownSymbol=dropdownHeader.symbol||false;this.dropdownStyle=dropdownHeader.style||{el:{class:'btn-group o_dropdown',attrs:{}},mainButton:{class:'o_dropdown_toggler_btn btn btn-secondary dropdown-toggle'+(this.dropdownSymbol?' o-no-caret':'')},};this.items=items;_.each(this.items,this._prepareItem.bind(this));},start:function(){var self=this;this.$menu=this.$('.o_dropdown_menu');this.$dropdownReference=this.$('.o_dropdown_toggler_btn');if(_t.database.parameters.direction==='rtl'){this.$menu.addClass('dropdown-menu-right');}},updateItemsStatus:function(activeItemIds){_.each(this.items,function(item){if(!_.contains(activeItemIds,item.itemId)){item.isActive=false;item.currentOptionId=false;}else{item.isActive=true;item.currentOptionId=item.hasOptions?(item.currentOptionId||item.defaultOptionId):false;}});this._renderMenuItems();},_removeItem:function(itemId){var item,itemIndex;item=_.findWhere(this.items,{itemId:itemId});itemIndex=this.items.indexOf(item);this.items.splice(itemIndex,1);this._renderMenuItems();var eventData={category:this.dropdownCategory,itemId:itemId,groupId:item.groupId,};this.trigger_up('menu_item_deleted',eventData);},_renderMenuItems:function(){var newMenuItems=QWeb.render('DropdownMenu.MenuItems',{widget:this});this.$el.find('.o_menu_item, .dropdown-divider[data-removable="1"]').remove();this.$('.o_dropdown_menu').prepend($(newMenuItems));},_prepareItem:function(item){item.itemId=item.itemId||_.uniqueId('__item__');item.isOpen=item.isOpen||false;item.isRemovable=item.isRemovable||false;if(item.options&&item.options.length!==0){item.options=_.sortBy(item.options,'groupId');item.hasOptions=true;item.defaultOptionId=item.defaultOptionId||this.defaultOptionId;item.currentOptionId=item.isActive&&item.defaultOptionId?item.defaultOptionId:false;}},_toggleMenuItem:function(itemId){var item=_.findWhere(this.items,{itemId:itemId});if(!item.hasOptions){item.isActive=!item.isActive;var eventData={category:this.dropdownCategory,itemId:itemId,isActive:item.isActive,groupId:item.groupId,};this._renderMenuItems();this.trigger_up('menu_item_toggled',eventData);}
if(item.hasOptions){item.isOpen=!item.isOpen;this._renderMenuItems();}},_toggleItemOption:function(itemId,optionId){var item=_.findWhere(this.items,{itemId:itemId});var initialState=item.isActive;if(item.currentOptionId===optionId){item.isActive=false;item.currentOptionId=false;}else{item.isActive=true;item.currentOptionId=optionId;}
var eventData={category:this.dropdownCategory,itemId:itemId,groupId:item.groupId,isActive:item.isActive,optionId:item.currentOptionId,};this._renderMenuItems();if(item.isActive!==initialState){this.trigger_up('menu_item_toggled',eventData);}else{this.trigger_up('item_option_changed',eventData);}},_onBootstrapClose:function(){_.each(this.items,function(item){item.isOpen=false;});this._renderMenuItems();},_onDropDownItemTextClick:function(ev){ev.stopPropagation();},_onItemClick:function(event){event.preventDefault();event.stopPropagation();var itemId=$(event.currentTarget).data('id');this._toggleMenuItem(itemId);},_onOptionClick:function(event){event.preventDefault();event.stopPropagation();var optionId=$(event.currentTarget).data('option_id');var itemId=$(event.currentTarget).data('item_id');this._toggleItemOption(itemId,optionId);},_onTrashClick:function(event){event.stopPropagation();var itemId=$(event.currentTarget).data('id');this._removeItem(itemId);},});return DropdownMenu;});;

/* /web/static/src/js/widgets/pie_chart.js defined in bundle 'web.assets_backend' */
odoo.define('web.PieChart',function(require){"use strict";var core=require('web.core');var Domain=require('web.Domain');var viewRegistry=require('web.view_registry');var Widget=require('web.Widget');var widgetRegistry=require('web.widget_registry');var qweb=core.qweb;var PieChart=Widget.extend({className:'o_pie_chart',xmlDependencies:['/web/static/src/xml/pie_chart.xml'],init:function(parent,record,node){this._super.apply(this,arguments);var modifiers=node.attrs.modifiers;var domain=record.domain.concat(Domain.prototype.stringToArray(modifiers.domain||'[]'));var arch=qweb.render('web.PieChart',{modifiers:modifiers,title:node.attrs.title||modifiers.title||modifiers.measure,});var pieChartContext=JSON.parse(JSON.stringify(record.context));delete pieChartContext.graph_mode;delete pieChartContext.graph_measure;delete pieChartContext.graph_groupbys;this.subViewParams={context:pieChartContext,domain:domain,groupBy:[],modelName:record.model,withControlPanel:false,isEmbedded:true,mode:'pie',};this.viewInfo={arch:arch,fields:record.fields,viewFields:record.fieldsInfo.dashboard,};},willStart:function(){var self=this;var def1=this._super.apply(this,arguments);var SubView=viewRegistry.get('graph');var subView=new SubView(this.viewInfo,this.subViewParams);var def2=subView.getController(this).then(function(controller){self.controller=controller;return self.controller.appendTo(document.createDocumentFragment());});return $.when(def1,def2);},start:function(){this.$el.append(this.controller.$el);return this._super.apply(this,arguments);},on_attach_callback:function(){this.controller.on_attach_callback();},});widgetRegistry.add('pie_chart',PieChart);return PieChart;});;

/* /web/static/src/js/views/search/filters_menu.js defined in bundle 'web.assets_backend' */
odoo.define('web.FiltersMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Domain=require('web.Domain');var DropdownMenu=require('web.DropdownMenu');var search_filters=require('web.search_filters');var time=require('web.time');var TimeRangeMenuOptions=require('web.TimeRangeMenuOptions');var QWeb=core.qweb;var _t=core._t;var PERIOD_OPTIONS=TimeRangeMenuOptions.PeriodOptions;var DEFAULT_PERIOD='this_month';var FiltersMenu=DropdownMenu.extend({custom_events:{remove_proposition:'_onRemoveProposition',confirm_proposition:'_onConfirmProposition',},events:_.extend({},DropdownMenu.prototype.events,{'click .o_add_custom_filter':'_onAddCustomFilterClick','click .o_add_condition':'_appendProposition','click .o_apply_filter':'_onApplyClick',':hover .o_item_option':'_onOptionHover',}),init:function(parent,filters,fields){this.isMobile=config.device.isMobile;this.periodOptions=PERIOD_OPTIONS;this.defaultOptionId=DEFAULT_PERIOD;this.generatorMenuIsOpen=false;this.propositions=[];this.fields=_.pick(fields,function(field,name){return field.selectable!==false&&name!=='id';});this.fields.id={string:'ID',type:'id',searchable:true};var dropdownHeader={category:'filterCategory',title:_t('Filters'),icon:'fa fa-filter',symbol:this.isMobile?'fa fa-chevron-right float-right mt4':false,};this._super(parent,dropdownHeader,filters,this.fields);},start:function(){this._super.apply(this,arguments);this.$menu.addClass('o_filters_menu');var generatorMenu=QWeb.render('FiltersMenuGenerator',{widget:this});this.$menu.append(generatorMenu);this.$addCustomFilter=this.$menu.find('.o_add_custom_filter');this.$addFilterMenu=this.$menu.find('.o_add_filter_menu');},_appendProposition:function(){var prop=new search_filters.ExtendedSearchProposition(this,this.fields);this.propositions.push(prop);this.$('.o_apply_filter').prop('disabled',false);return prop.insertBefore(this.$addFilterMenu);},_commitSearch:function(){var self=this;var filters=_.invoke(this.propositions,'get_filter');_.each(filters,function(filter){filter.attrs.domain=Domain.prototype.arrayToString(filter.attrs.domain);});var groupId=_.uniqueId('__group__');var data=[];filters.forEach(function(filter){var filterName=_.uniqueId('__filter__');var filterItem={itemId:filterName,description:filter.attrs.string,groupId:groupId,isActive:true,};self._prepareItem(filterItem);data.push({itemId:filterName,groupId:groupId,filter:filter,});self.items.push(filterItem);});this._renderMenuItems();this.trigger_up('new_filters',data);_.invoke(this.propositions,'destroy');this.propositions=[];this._toggleCustomFilterMenu();},_prepareItem:function(item){if(item.isPeriod){item.options=this.periodOptions;}
this._super.apply(this,arguments);},_renderMenuItems:function(){var self=this;this._super.apply(this,arguments);var $options=this.$('.o_filters_menu .o_item_option');$options.each(function(){var $option=$(this);$option.tooltip({delay:{show:500,hide:0},title:function(){var itemId=$option.attr('data-item_id');var optionId=$option.attr('data-option_id');var fieldName=_.findWhere(self.items,{itemId:itemId}).fieldName;var domain=Domain.prototype.constructDomain(fieldName,optionId,'date',true);var evaluatedDomain=Domain.prototype.stringToArray(domain);var dateFormat=time.getLangDateFormat();var dateStart=moment(evaluatedDomain[1][2],"YYYY-MM-DD",'en').format(dateFormat);var dateEnd=moment(evaluatedDomain[2][2],"YYYY-MM-DD",'en').format(dateFormat);if(optionId==='today'||optionId==='yesterday'){return dateStart;}
return _.str.sprintf(_t('From %s To %s'),dateStart,dateEnd);}});});},_toggleCustomFilterMenu:function(){var self=this;this.generatorMenuIsOpen=!this.generatorMenuIsOpen;var def;if(this.generatorMenuIsOpen&&!this.propositions.length){def=this._appendProposition();}
if(!this.generatorMenuIsOpen){_.invoke(this.propositions,'destroy');this.propositions=[];}
$.when(def).then(function(){self.$addCustomFilter.attr('aria-expanded',self.generatorMenuIsOpen).toggleClass('o_closed_menu',!self.generatorMenuIsOpen).toggleClass('o_open_menu',self.generatorMenuIsOpen);self.$('.o_add_filter_menu').toggle();self.$dropdownReference.dropdown('update');});},_onAddCustomFilterClick:function(event){event.preventDefault();event.stopPropagation();this._toggleCustomFilterMenu();},_onApplyClick:function(event){event.stopPropagation();this._commitSearch();},_onConfirmProposition:function(event){event.stopPropagation();this._commitSearch();},_onRemoveProposition:function(event){event.stopPropagation();this.propositions=_.without(this.propositions,event.target);if(!this.propositions.length){this.$('.o_apply_filter').prop('disabled',true);}
event.target.destroy();},});return FiltersMenu;});;

/* /web/static/src/js/apps.js defined in bundle 'web.assets_backend' */
odoo.define('web.Apps',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var core=require('web.core');var framework=require('web.framework');var session=require('web.session');var _t=core._t;var apps_client=null;var Apps=AbstractAction.extend({template:'EmptyComponent',remote_action_tag:'loempia.embed',failback_action_id:'base.open_module_tree',init:function(parent,action){this._super(parent,action);var options=action.params||{};this.params=options;},get_client:function(){var check_client_available=function(client){var d=$.Deferred();var i=new Image();i.onerror=function(){d.reject(client);};i.onload=function(){d.resolve(client);};var ts=new Date().getTime();i.src=_.str.sprintf('%s/web/static/src/img/sep-a.gif?%s',client.origin,ts);return d.promise();};if(apps_client){return check_client_available(apps_client);}else{return this._rpc({model:'ir.module.module',method:'get_apps_server'}).then(function(u){var link=$(_.str.sprintf('<a href="%s"></a>',u))[0];var host=_.str.sprintf('%s//%s',link.protocol,link.host);var dbname=link.pathname;if(dbname[0]==='/'){dbname=dbname.substr(1);}
var client={origin:host,dbname:dbname};apps_client=client;return check_client_available(client);});}},destroy:function(){$(window).off("message."+this.uniq);if(this.$ifr){this.$ifr.remove();this.$ifr=null;}
return this._super();},_on_message:function($e){var self=this,client=this.client,e=$e.originalEvent;if(e.origin!==client.origin){return;}
var dispatcher={'event':function(m){self.trigger('message:'+m.event,m);},'action':function(m){self.do_action(m.action).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'rpc':function(m){return self._rpc({route:m.args[0],params:m.args[1]}).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'Model':function(m){return self._rpc({model:m.model,method:m.args[0],args:m.args[1]}).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},};if(!_.isObject(e.data)){return;}
if(dispatcher[e.data.type]){dispatcher[e.data.type](e.data);}},start:function(){var self=this;var def=$.Deferred();self.get_client().then(function(client){self.client=client;var qs={db:client.dbname};if(session.debug){qs.debug=session.debug;}
var u=$.param.querystring(client.origin+"/apps/embed/client",qs);var css={width:'100%',height:'750px'};self.$ifr=$('<iframe>').attr('src',u);self.uniq=_.uniqueId('apps');$(window).on("message."+self.uniq,self.proxy('_on_message'));self.on('message:ready',self,function(m){var w=this.$ifr[0].contentWindow;var act={type:'ir.actions.client',tag:this.remote_action_tag,params:_.extend({},this.params,{db:session.db,origin:session.origin,})};w.postMessage({type:'action',action:act},client.origin);});self.on('message:set_height',self,function(m){this.$ifr.height(m.height);});self.on('message:blockUI',self,function(){framework.blockUI();});self.on('message:unblockUI',self,function(){framework.unblockUI();});self.on('message:warn',self,function(m){self.do_warn(m.title,m.message,m.sticky);});self.$ifr.appendTo(self.$el).css(css).addClass('apps-client');def.resolve();},function(){self.do_warn(_t('Odoo Apps will be available soon'),_t('Showing locally available modules'),true);return self._rpc({route:'/web/action/load',params:{action_id:self.failback_action_id},}).then(function(action){return self.do_action(action);}).always(function(){def.reject();});});return def;},});var AppsUpdates=Apps.extend({remote_action_tag:'loempia.embed.updates',});core.action_registry.add("apps",Apps);core.action_registry.add("apps.updates",AppsUpdates);return Apps;});;

/* /web/static/src/js/fields/abstract_field.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractField',function(require){"use strict";var ajax=require('web.ajax');var field_utils=require('web.field_utils');var Widget=require('web.Widget');var AbstractField=Widget.extend({cssLibs:[],jsLibs:[],events:{'keydown':'_onKeydown',},custom_events:{navigation_move:'_onNavigationMove',},fieldDependencies:{},resetOnAnyFieldChange:false,specialData:false,supportedFieldTypes:[],init:function(parent,name,record,options){this._super(parent);options=options||{};this.name=name;this.record=record;this.field=record.fields[name];this.viewType=options.viewType||'default';var fieldsInfo=record.fieldsInfo[this.viewType];this.attrs=options.attrs||(fieldsInfo&&fieldsInfo[name])||{};this.additionalContext=options.additionalContext||{};this.value=record.data[name];this.recordData=record.data;this.string=this.attrs.string||this.field.string||this.name;this.nodeOptions=this.attrs.options||{};this.dataPointID=record.id;this.res_id=record.res_id;this.model=record.model;this.mode=options.mode||"readonly";this._isValid=true;this.lastSetValue=undefined;this.formatType=this.attrs.widget in field_utils.format?this.attrs.widget:this.field.type;this.formatOptions={};this.parseOptions={};if(this.attrs.decorations){this.resetOnAnyFieldChange=true;}},willStart:function(){return $.when(ajax.loadLibs(this),this._super.apply(this,arguments));},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$el.attr('name',self.name);self.$el.addClass('o_field_widget');return self._render();});},activate:function(options){if(this.isFocusable()){var $focusable=this.getFocusableElement();$focusable.focus();if($focusable.is('input[type="text"], textarea')){$focusable[0].selectionStart=$focusable[0].selectionEnd=$focusable[0].value.length;if(options&&!options.noselect){$focusable.select();}}
return true;}
return false;},commitChanges:function(){},getFocusableElement:function(){return $();},isFocusable:function(){var $focusable=this.getFocusableElement();return $focusable.length&&$focusable.is(':visible');},isSet:function(){return!!this.value;},isValid:function(){return this._isValid;},reset:function(record,event){this._reset(record,event);return this._render()||$.when();},removeInvalidClass:function(){this.$el.removeClass('o_field_invalid');this.$el.removeAttr('aria-invalid');},setIDForLabel:function(id){this.getFocusableElement().attr('id',id);},setInvalidClass:function(){this.$el.addClass('o_field_invalid');this.$el.attr('aria-invalid','true');},updateModifiersValue:function(modifiers){this.attrs.modifiersValue=modifiers||{};},_applyDecorations:function(){var self=this;this.attrs.decorations.forEach(function(dec){var isToggled=py.PY_isTrue(py.evaluate(dec.expression,self.record.evalContext));self.$el.toggleClass(dec.className,isToggled);});},_formatValue:function(value){var options=_.extend({},this.nodeOptions,{data:this.recordData},this.formatOptions);return field_utils.format[this.formatType](value,this.field,options);},_isSameValue:function(value){return this.value===value;},_parseValue:function(value){return field_utils.parse[this.formatType](value,this.field,this.parseOptions);},_render:function(){if(this.attrs.decorations){this._applyDecorations();}
if(this.mode==='edit'){return this._renderEdit();}else if(this.mode==='readonly'){return this._renderReadonly();}},_renderEdit:function(){},_renderReadonly:function(){},_reset:function(record,event){this.lastSetValue=undefined;this.record=record;this.value=record.data[this.name];this.recordData=record.data;},_setValue:function(value,options){if(this.lastSetValue===value||(this.value===false&&value==='')){return $.when();}
this.lastSetValue=value;try{value=this._parseValue(value);this._isValid=true;}catch(e){this._isValid=false;this.trigger_up('set_dirty',{dataPointID:this.dataPointID});return $.Deferred().reject();}
if(!(options&&options.forceChange)&&this._isSameValue(value)){return $.when();}
var def=$.Deferred();var changes={};changes[this.name]=value;this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:changes,viewType:this.viewType,doNotSetDirty:options&&options.doNotSetDirty,notifyChange:!options||options.notifyChange!==false,allowWarning:options&&options.allowWarning,onSuccess:def.resolve.bind(def),onFailure:def.reject.bind(def),});return def;},_onKeydown:function(ev){switch(ev.which){case $.ui.keyCode.TAB:var event=this.trigger_up('navigation_move',{direction:ev.shiftKey?'previous':'next',});if(event.is_stopped()){ev.preventDefault();ev.stopPropagation();}
break;case $.ui.keyCode.ENTER:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'next_line'});break;case $.ui.keyCode.ESCAPE:this.trigger_up('navigation_move',{direction:'cancel',originalEvent:ev});break;case $.ui.keyCode.UP:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'up'});break;case $.ui.keyCode.RIGHT:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'right'});break;case $.ui.keyCode.DOWN:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'down'});break;case $.ui.keyCode.LEFT:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'left'});break;}},_onNavigationMove:function(ev){ev.data.target=this;},});return AbstractField;});;

/* /web/static/src/js/fields/basic_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web.basic_fields',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var crash_manager=require('web.crash_manager');var datepicker=require('web.datepicker');var dom=require('web.dom');var Domain=require('web.Domain');var DomainSelector=require('web.DomainSelector');var DomainSelectorDialog=require('web.DomainSelectorDialog');var framework=require('web.framework');var session=require('web.session');var utils=require('web.utils');var view_dialogs=require('web.view_dialogs');var field_utils=require('web.field_utils');var qweb=core.qweb;var _t=core._t;var TranslatableFieldMixin={_renderTranslateButton:function(){if(_t.database.multi_lang&&this.field.translate&&this.res_id){return $('<button>',{type:'button','class':'o_field_translate fa fa-globe btn btn-link',}).on('click',this._onTranslate.bind(this));}
return $();},_onTranslate:function(){this.trigger_up('translate',{fieldName:this.name,id:this.dataPointID});},};var DebouncedField=AbstractField.extend({DEBOUNCE:1000000000,init:function(){this._super.apply(this,arguments);this._isDirty=false;if(this.mode==='edit'){if(this.DEBOUNCE){this._doDebouncedAction=_.debounce(this._doAction,this.DEBOUNCE);}else{this._doDebouncedAction=this._doAction;}
var self=this;var debouncedFunction=this._doDebouncedAction;this._doDebouncedAction=function(){self._isDirty=true;debouncedFunction.apply(self,arguments);};}},commitChanges:function(){if(this._isDirty&&this.mode==='edit'){return this._doAction();}},_doAction:function(){if(!this.isDestroyed()){return this._setValue(this._getValue());}},_getValue:function(){},});var InputField=DebouncedField.extend({custom_events:_.extend({},DebouncedField.prototype.custom_events,{field_changed:'_onFieldChanged',}),events:_.extend({},DebouncedField.prototype.events,{'input':'_onInput','change':'_onChange',}),init:function(){this._super.apply(this,arguments);this.nodeOptions.isPassword='password'in this.attrs;if(this.mode==='edit'){this.tagName='input';}
this.isDirty=false;this.lastChangeEvent=undefined;},getFocusableElement:function(){return this.$input||$();},reset:function(record,event){this._reset(record,event);if(!event||event===this.lastChangeEvent){this.isDirty=false;}
if(this.isDirty||(event&&event.target===this&&event.data.changes[this.name]===this.value)){if(this.attrs.decorations){this._applyDecorations();}
return $.when();}else{return this._render();}},_getValue:function(){return this.$input.val();},_prepareInput:function($input){this.$input=$input||$("<input/>");this.$input.addClass('o_input');var inputAttrs={placeholder:this.attrs.placeholder||""};var inputVal;if(this.nodeOptions.isPassword){inputAttrs=_.extend(inputAttrs,{type:'password',autocomplete:'new-password'});inputVal=this.value||'';}else{inputAttrs=_.extend(inputAttrs,{type:'text',autocomplete:this.attrs.autocomplete});inputVal=this._formatValue(this.value);}
this.$input.attr(inputAttrs);this.$input.val(inputVal);return this.$input;},_renderEdit:function(){this._prepareInput(this.$el);},_renderReadonly:function(){this.$el.text(this._formatValue(this.value));},_onChange:function(){this._doAction();},_onFieldChanged:function(event){this.lastChangeEvent=event;},_onInput:function(){this.isDirty=true;this._doDebouncedAction();},_onNavigationMove:function(ev){this._super.apply(this,arguments);if(this.mode==='edit'&&ev.data.direction!=='cancel'){var input=this.$input[0];var selecting=(input.selectionEnd!==input.selectionStart);if((ev.data.direction==="left"&&(selecting||input.selectionStart!==0))||(ev.data.direction==="right"&&(selecting||input.selectionStart!==input.value.length))){ev.stopPropagation();}
if(ev.data.direction==='next'&&this.attrs.modifiersValue&&this.attrs.modifiersValue.required&&this.viewType!=='list'){if(!this.$input.val()){this.setInvalidClass();ev.stopPropagation();}else{this.removeInvalidClass();}}}},});var NumericField=InputField.extend({tagName:'span',isSet:function(){return this.value===0||this._super.apply(this,arguments);},_formatValue:function(value){if(this.mode==='edit'&&this.nodeOptions.type==='number'){return value;}
return this._super.apply(this,arguments);},_parseValue:function(value){if(this.mode==='edit'&&this.nodeOptions.type==='number'){return Number(value);}
return this._super.apply(this,arguments);},_prepareInput:function($input){var result=this._super.apply(this,arguments);if(this.nodeOptions.type==='number'){this.$input.attr({type:'number'});}
if(this.nodeOptions.step){this.$input.attr({step:this.nodeOptions.step});}
return result;}});var FieldChar=InputField.extend(TranslatableFieldMixin,{className:'o_field_char',tagName:'span',supportedFieldTypes:['char'],_renderEdit:function(){var def=this._super.apply(this,arguments);if(this.field.size&&this.field.size>0){this.$el.attr('maxlength',this.field.size);}
this.$el=this.$el.add(this._renderTranslateButton());return def;},_setValue:function(value,options){if(this.field.trim){value=value.trim();}
return this._super(value,options);},});var LinkButton=AbstractField.extend({events:_.extend({},AbstractField.prototype.events,{'click':'_onClick'}),_render:function(){if(this.value){var className=this.attrs.icon||'fa-globe';this.$el.html("<span role='img'/>");this.$el.addClass("fa "+className);this.$el.attr('title',this.value);this.$el.attr('aria-label',this.value);}},_onClick:function(event){event.stopPropagation();window.open(this.value,'_blank');},});var FieldDate=InputField.extend({className:"o_field_date",tagName:"span",supportedFieldTypes:['date','datetime'],init:function(){this._super.apply(this,arguments);this.formatOptions.timezone=true;this.datepickerOptions=_.defaults({},this.nodeOptions.datepicker||{},{defaultDate:this.value});},start:function(){var self=this;var def;if(this.mode==='edit'){this.datewidget=this._makeDatePicker();this.datewidget.on('datetime_changed',this,function(){var value=this._getValue();if((!value&&this.value)||(value&&!this._isSameValue(value))){this._setValue(value);}});def=this.datewidget.appendTo('<div>').done(function(){self.datewidget.$el.addClass(self.$el.attr('class'));self._prepareInput(self.datewidget.$input);self._replaceElement(self.datewidget.$el);});}
return $.when(def,this._super.apply(this,arguments));},activate:function(){if(this.isFocusable()&&this.datewidget){this.datewidget.focus();return true;}
return false;},_doDebouncedAction:function(){this.datewidget.changeDatetime();},_getValue:function(){return this.datewidget.getValue();},_isSameValue:function(value){if(value===false){return this.value===false;}
return value.isSame(this.value,'day');},_makeDatePicker:function(){return new datepicker.DateWidget(this,this.datepickerOptions);},_renderEdit:function(){this.datewidget.setValue(this.value);this.$input=this.datewidget.$input;},});var FieldDateTime=FieldDate.extend({supportedFieldTypes:['datetime'],init:function(){this._super.apply(this,arguments);if(this.value){var offset=this.getSession().getTZOffset(this.value);var displayedValue=this.value.clone().add(offset,'minutes');this.datepickerOptions.defaultDate=displayedValue;}},_getValue:function(){var value=this.datewidget.getValue();return value&&value.add(-this.getSession().getTZOffset(value),'minutes');},_isSameValue:function(value){if(value===false){return this.value===false;}
return value.isSame(this.value);},_makeDatePicker:function(){return new datepicker.DateTimeWidget(this,this.datepickerOptions);},_renderEdit:function(){var value=this.value&&this.value.clone().add(this.getSession().getTZOffset(this.value),'minutes');this.datewidget.setValue(value);this.$input=this.datewidget.$input;},});var FieldMonetary=InputField.extend({className:'o_field_monetary o_field_number',tagName:'span',supportedFieldTypes:['float','monetary'],resetOnAnyFieldChange:true,init:function(){this._super.apply(this,arguments);this._setCurrency();if(this.mode==='edit'){this.tagName='div';this.className+=' o_input';this.formatOptions.noSymbol=true;}
this.formatOptions.currency=this.currency;this.formatOptions.digits=[16,2];this.formatOptions.field_digits=this.nodeOptions.field_digits;},isSet:function(){return this.value===0||this._super.apply(this,arguments);},_renderEdit:function(){this.$el.empty();this._prepareInput(this.$input).appendTo(this.$el);if(this.currency){var $currencySymbol=$('<span>',{text:this.currency.symbol});if(this.currency.position==="after"){this.$el.append($currencySymbol);}else{this.$el.prepend($currencySymbol);}}},_renderReadonly:function(){this.$el.html(this._formatValue(this.value));},_reset:function(){this._super.apply(this,arguments);this._setCurrency();},_setCurrency:function(){var currencyField=this.nodeOptions.currency_field||this.field.currency_field||'currency_id';var currencyID=this.record.data[currencyField]&&this.record.data[currencyField].res_id;this.currency=session.get_currency(currencyID);this.formatOptions.currency=this.currency;},});var FieldBoolean=AbstractField.extend({className:'o_field_boolean',events:_.extend({},AbstractField.prototype.events,{change:'_onChange',}),supportedFieldTypes:['boolean'],activate:function(options){var activated=this._super.apply(this,arguments);if(activated&&options&&options.event&&$(options.event.target).closest('.custom-control.custom-checkbox').length){this._setValue(!this.value);}
return activated;},getFocusableElement:function(){return this.mode==='readonly'?$():this.$input;},isSet:function(){return true;},reset:function(record,event){var rendered=this._super.apply(this,arguments);if(event&&event.target.name===this.name){this.activate();}
return rendered;},setIDForLabel:function(id){this._super.apply(this,arguments);this.$('.custom-control-label').attr('for',id);},_render:function(){var $checkbox=this._formatValue(this.value);this.$input=$checkbox.find('input');this.$input.prop('disabled',this.mode==='readonly');this.$el.addClass($checkbox.attr('class'));this.$el.empty().append($checkbox.contents());},_onChange:function(){this._setValue(this.$input[0].checked);},_onKeydown:function(ev){switch(ev.which){case $.ui.keyCode.ENTER:this.$input.prop('checked',!this.value);this._setValue(!this.value);return;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:ev.preventDefault();}
this._super.apply(this,arguments);},});var FieldInteger=NumericField.extend({className:'o_field_integer o_field_number',supportedFieldTypes:['integer'],_formatValue:function(value){if(typeof value==='string'){if(!/^[0-9]+-/.test(value)){throw new Error('"'+value+'" is not an integer or a virtual id');}
return value;}
return this._super.apply(this,arguments);},});var FieldFloat=NumericField.extend({className:'o_field_float o_field_number',supportedFieldTypes:['float'],init:function(){this._super.apply(this,arguments);if(this.attrs.digits){this.nodeOptions.digits=JSON.parse(this.attrs.digits);}},});var FieldFloatTime=FieldFloat.extend({formatType:'float_time',init:function(){this._super.apply(this,arguments);this.formatType='float_time';}});var FieldFloatFactor=FieldFloat.extend({supportedFieldTypes:['float'],className:'o_field_float_factor',formatType:'float_factor',init:function(){this._super.apply(this,arguments);if(!this.nodeOptions.factor){this.nodeOptions.factor=1;}
this.parseOptions=this.nodeOptions;}});var FieldFloatToggle=AbstractField.extend({supportedFieldTypes:['float'],formatType:'float_factor',className:'o_field_float_toggle',tagName:'span',events:{click:'_onClick'},init:function(){this._super.apply(this,arguments);this.formatType='float_factor';if(this.mode==='edit'){this.tagName='button';}
if(this.attrs.digits){this.nodeOptions.digits=JSON.parse(this.attrs.digits);}
if(!this.nodeOptions.factor){this.nodeOptions.factor=1;}
if(!this.nodeOptions.range){this.nodeOptions.range=[0.0,0.5,1.0];}
this.parseOptions=this.nodeOptions;},_getDisplayedValue:function(){var usrFormatValue=this._formatValue(this.value);return field_utils.parse['float'](usrFormatValue);},_renderEdit:function(){this.$el.text(this._formatValue(this.value));},_renderReadonly:function(){this.$el.text(this._formatValue(this.value));},_nextValue:function(){var range=this.nodeOptions.range;var val=utils.closestNumber(this._getDisplayedValue(),range);var index=_.indexOf(range,val);if(index!==-1){if(index+1<range.length){return range[index+1];}}
return range[0];},_onClick:function(ev){if(this.mode==='edit'){ev.stopPropagation();var next_val=this._nextValue();next_val=field_utils.format['float'](next_val);this._setValue(next_val);}},});var FieldPercentage=FieldFloat.extend({formatType:'percentage',});var FieldText=InputField.extend(TranslatableFieldMixin,{className:'o_field_text',supportedFieldTypes:['text'],tagName:'span',init:function(){this._super.apply(this,arguments);if(this.mode==='edit'){this.tagName='textarea';}},start:function(){if(this.mode==='edit'){dom.autoresize(this.$el,{parent:this});this.$el=this.$el.add(this._renderTranslateButton());}
return this._super();},reset:function(){var self=this;return $.when(this._super.apply(this,arguments)).then(function(){if(self.mode==='edit'){self.$input.trigger('change');}});},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ENTER){return;}
this._super.apply(this,arguments);},});var HandleWidget=AbstractField.extend({className:'o_row_handle fa fa-arrows ui-sortable-handle',tagName:'span',description:"",supportedFieldTypes:['integer'],isSet:function(){return true;},});var FieldEmail=InputField.extend({className:'o_field_email',events:_.extend({},InputField.prototype.events,{'click':'_onClick',}),prefix:'mailto',supportedFieldTypes:['char'],init:function(){this._super.apply(this,arguments);this.tagName=this.mode==='readonly'?'a':'input';},getFocusableElement:function(){return this.mode==='readonly'?this.$el:this._super.apply(this,arguments);},_renderReadonly:function(){this.$el.text(this.value).addClass('o_form_uri o_text_overflow').attr('href',this.prefix+':'+this.value);},_onClick:function(ev){ev.stopPropagation();},});var FieldPhone=FieldEmail.extend({className:'o_field_phone',prefix:'tel',_renderReadonly:function(){this._super();this.$el.removeClass('o_text_overflow');},});var UrlWidget=InputField.extend({className:'o_field_url',events:_.extend({},InputField.prototype.events,{'click':'_onClick',}),supportedFieldTypes:['char'],init:function(){this._super.apply(this,arguments);this.tagName=this.mode==='readonly'?'a':'input';},getFocusableElement:function(){return this.mode==='readonly'?this.$el:this._super.apply(this,arguments);},_renderReadonly:function(){this.$el.text(this.attrs.text||this.value).addClass('o_form_uri o_text_overflow').attr('target','_blank').attr('href',this.value);},_onClick:function(ev){ev.stopPropagation();},});var CopyClipboard={destroy:function(){this._super.apply(this,arguments);if(this.clipboard){this.clipboard.destroy();}},_initClipboard:function(){var self=this;var $clipboardBtn=this.$('.o_clipboard_button');$clipboardBtn.tooltip({title:_t('Copied !'),trigger:'manual',placement:'right'});this.clipboard=new ClipboardJS($clipboardBtn[0],{text:function(){return self.value.trim();},container:self.$el[0]});this.clipboard.on('success',function(){_.defer(function(){$clipboardBtn.tooltip('show');_.delay(function(){$clipboardBtn.tooltip('hide');},800);});});},_render:function(){this._super.apply(this,arguments);this.$el.addClass('o_field_copy');},_renderReadonly:function(){this._super.apply(this,arguments);if(this.value){this.$el.append($(qweb.render(this.clipboardTemplate)));this._initClipboard();}}};var TextCopyClipboard=FieldText.extend(CopyClipboard,{clipboardTemplate:'CopyClipboardText',});var CharCopyClipboard=FieldChar.extend(CopyClipboard,{clipboardTemplate:'CopyClipboardChar',});var AbstractFieldBinary=AbstractField.extend({events:_.extend({},AbstractField.prototype.events,{'change .o_input_file':'on_file_change','click .o_select_file_button':function(){this.$('.o_input_file').click();},'click .o_clear_file_button':'_onClearClick',}),init:function(parent,name,record){this._super.apply(this,arguments);this.fields=record.fields;this.useFileAPI=!!window.FileReader;this.max_upload_size=25*1024*1024;if(!this.useFileAPI){var self=this;this.fileupload_id=_.uniqueId('o_fileupload');$(window).on(this.fileupload_id,function(){var args=[].slice.call(arguments).slice(1);self.on_file_uploaded.apply(self,args);});}},destroy:function(){if(this.fileupload_id){$(window).off(this.fileupload_id);}
this._super.apply(this,arguments);},on_file_change:function(e){var self=this;var file_node=e.target;if((this.useFileAPI&&file_node.files.length)||(!this.useFileAPI&&$(file_node).val()!=='')){if(this.useFileAPI){var file=file_node.files[0];if(file.size>this.max_upload_size){var msg=_t("The selected file exceed the maximum file size of %s.");this.do_warn(_t("File upload"),_.str.sprintf(msg,utils.human_size(this.max_upload_size)));return false;}
var filereader=new FileReader();filereader.readAsDataURL(file);filereader.onloadend=function(upload){var data=upload.target.result;data=data.split(',')[1];self.on_file_uploaded(file.size,file.name,file.type,data);};}else{this.$('form.o_form_binary_form input[name=session_id]').val(this.getSession().session_id);this.$('form.o_form_binary_form').submit();}
this.$('.o_form_binary_progress').show();this.$('button').hide();}},on_file_uploaded:function(size,name){if(size===false){this.do_warn(_t("File Upload"),_t("There was a problem while uploading your file"));console.warn("Error while uploading file : ",name);}else{this.on_file_uploaded_and_valid.apply(this,arguments);}
this.$('.o_form_binary_progress').hide();this.$('button').show();},on_file_uploaded_and_valid:function(size,name,content_type,file_base64){this.set_filename(name);this._setValue(file_base64);this._render();},set_filename:function(value){var filename=this.attrs.filename;if(filename&&filename in this.fields){var changes={};changes[filename]=value;this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:changes,viewType:this.viewType,});}},_clearFile:function(){this.$('.o_input_file').val('');this.set_filename('');this._setValue(false);this._render();},_onClearClick:function(ev){this._clearFile();},});var FieldBinaryImage=AbstractFieldBinary.extend({fieldDependencies:_.extend({},AbstractFieldBinary.prototype.fieldDependencies,{__last_update:{type:'datetime'},}),template:'FieldBinaryImage',placeholder:"/web/static/src/img/placeholder.png",events:_.extend({},AbstractFieldBinary.prototype.events,{'click img':function(){if(this.mode==="readonly"){this.trigger_up('bounce_edit');}},}),supportedFieldTypes:['binary'],file_type_magic_word:{'/':'jpg','R':'gif','i':'png','P':'svg+xml',},_render:function(){var self=this;var url=this.placeholder;if(this.value){if(!utils.is_bin_size(this.value)){url='data:image/'+(this.file_type_magic_word[this.value[0]]||'png')+';base64,'+this.value;}else{url=session.url('/web/image',{model:this.model,id:JSON.stringify(this.res_id),field:this.nodeOptions.preview_image||this.name,unique:field_utils.format.datetime(this.recordData.__last_update).replace(/[^0-9]/g,''),});}}
var $img=$(qweb.render("FieldBinaryImage-img",{widget:this,url:url}));var width=this.nodeOptions.size?this.nodeOptions.size[0]:this.attrs.width;var height=this.nodeOptions.size?this.nodeOptions.size[1]:this.attrs.height;if(width){$img.attr('width',width);$img.css('max-width',width+'px');}
if(height){$img.attr('height',height);$img.css('max-height',height+'px');}
this.$('> img').remove();this.$el.prepend($img);$img.on('error',function(){self._clearFile();$img.attr('src',self.placeholder);self.do_warn(_t("Image"),_t("Could not display the selected image."));});},});var FieldBinaryFile=AbstractFieldBinary.extend({template:'FieldBinaryFile',events:_.extend({},AbstractFieldBinary.prototype.events,{'click':function(event){if(this.mode==='readonly'&&this.value&&this.recordData.id){this.on_save_as(event);}},'click .o_input':function(){this.$('.o_input_file').click();},}),supportedFieldTypes:['binary'],init:function(){this._super.apply(this,arguments);this.filename_value=this.recordData[this.attrs.filename];},_renderReadonly:function(){var visible=!!(this.value&&this.res_id);this.$el.empty().css('cursor','not-allowed');this.do_toggle(visible);if(visible){this.$el.css('cursor','pointer').text(this.filename_value||'').prepend($('<span class="fa fa-download"/>'),' ');}},_renderEdit:function(){if(this.value){this.$el.children().removeClass('o_hidden');this.$('.o_select_file_button').first().addClass('o_hidden');this.$('.o_input').eq(0).val(this.filename_value||this.value);}else{this.$el.children().addClass('o_hidden');this.$('.o_select_file_button').first().removeClass('o_hidden');}},set_filename:function(value){this._super.apply(this,arguments);this.filename_value=value;this.$('.o_save_file_button').prop('disabled',true);},on_save_as:function(ev){if(!this.value){this.do_warn(_t("Save As..."),_t("The field is empty, there's nothing to save !"));ev.stopPropagation();}else if(this.res_id){framework.blockUI();var c=crash_manager;var filename_fieldname=this.attrs.filename;this.getSession().get_file({'url':'/web/content','data':{'model':this.model,'id':this.res_id,'field':this.name,'filename_field':filename_fieldname,'filename':this.recordData[filename_fieldname]||"",'download':true,'data':utils.is_bin_size(this.value)?null:this.value,},'complete':framework.unblockUI,'error':c.rpc_error.bind(c),});ev.stopPropagation();}},});var FieldPdfViewer=FieldBinaryFile.extend({supportedFieldTypes:['binary'],template:'FieldPdfViewer',init:function(){this._super.apply(this,arguments);this.PDFViewerApplication=false;},_disableButtons:function(iframe){$(iframe).contents().find('button#openFile').hide();},_getURI:function(fileURI){var page=this.recordData[this.name+'_page']||1;if(!fileURI){var queryObj={model:this.model,field:this.name,id:this.res_id,};var queryString=$.param(queryObj);fileURI='/web/image?'+queryString}
fileURI=encodeURIComponent(fileURI);var viewerURL='/web/static/lib/pdfjs/web/viewer.html?file=';return viewerURL+fileURI+'#page='+page;},_render:function(){var self=this;var $pdfViewer=this.$('.o_form_pdf_controls').children().add(this.$('.o_pdfview_iframe'));var $selectUpload=this.$('.o_select_file_button').first();var $iFrame=this.$('.o_pdfview_iframe');$iFrame.on('load',function(){self.PDFViewerApplication=this.contentWindow.window.PDFViewerApplication;self._disableButtons(this);});if(this.mode==="readonly"&&this.value){$iFrame.attr('src',this._getURI());}else{if(this.value){var binSize=utils.is_bin_size(this.value);$pdfViewer.removeClass('o_hidden');$selectUpload.addClass('o_hidden');if(binSize){$iFrame.attr('src',this._getURI());}}else{$pdfViewer.addClass('o_hidden');$selectUpload.removeClass('o_hidden');}}},on_file_change:function(ev){this._super.apply(this,arguments);var files=ev.target.files;if(!files||files.length===0){return;}
var fileURI=URL.createObjectURL(files[0]);if(this.PDFViewerApplication){this.PDFViewerApplication.open(fileURI,0);}else{this.$('.o_pdfview_iframe').attr('src',this._getURI(fileURI));}},on_save_as:function(ev){ev.stopPropagation();},});var PriorityWidget=AbstractField.extend({className:"o_priority",attributes:{'role':'radiogroup',},events:{'mouseover > a':'_onMouseOver','mouseout > a':'_onMouseOut','click > a':'_onClick','keydown > a':'_onKeydown',},supportedFieldTypes:['selection'],isSet:function(){return true;},getFocusableElement:function(){var checked=this.$("[aria-checked='true']");return checked.length?checked:this.$("[data-index='1']");},_render:function(){var self=this;var index_value=this.value?_.findIndex(this.field.selection,function(v){return v[0]===self.value;}):0;this.$el.empty();this.empty_value=this.field.selection[0][0];this.$el.attr('aria-label',this.string);_.each(this.field.selection.slice(1),function(choice,index){self.$el.append(self._renderStar('<a href="#">',index_value>=index+1,index+1,choice[1],index_value));});},_renderStar:function(tag,isFull,index,tip,indexValue){var isChecked=indexValue===index;var defaultFocus=indexValue===0&&index===1;return $(tag).attr('role','radio').attr('aria-checked',isChecked).attr('title',tip).attr('aria-label',tip).attr('tabindex',isChecked||defaultFocus?0:-1).attr('data-index',index).addClass('o_priority_star fa').toggleClass('fa-star',isFull).toggleClass('fa-star-o',!isFull);},_onClick:function(event){event.preventDefault();event.stopPropagation();var index=$(event.currentTarget).data('index');var newValue=this.field.selection[index][0];if(newValue===this.value){newValue=this.empty_value;}
this._setValue(newValue);},_onMouseOut:function(){clearTimeout(this.hoverTimer);var self=this;this.hoverTimer=setTimeout(function(){self._render();},200);},_onMouseOver:function(event){clearTimeout(this.hoverTimer);this.$('.o_priority_star').removeClass('fa-star-o').addClass('fa-star');$(event.currentTarget).nextAll().removeClass('fa-star').addClass('fa-star-o');},_onKeydown:function(event){if(event.which===$.ui.keyCode.ENTER){return;}
this._super.apply(this,arguments);},_onNavigationMove:function(ev){var $curControl=this.$('a:focus');var $nextControl;if(ev.data.direction==='right'||ev.data.direction==='down'){$nextControl=$curControl.next('a');}else if(ev.data.direction==='left'||ev.data.direction==='up'){$nextControl=$curControl.prev('a');}
if($nextControl&&$nextControl.length){ev.stopPropagation();$nextControl.focus();return;}
this._super.apply(this,arguments);},});var AttachmentImage=AbstractField.extend({className:'o_attachment_image',_render:function(){if(this.value){this.$el.empty().append($('<img>/',{src:"/web/image/"+this.value.data.id+"?unique=1",title:this.value.data.display_name,alt:_t("Image")}));}}});var StateSelectionWidget=AbstractField.extend({template:'FormSelection',events:{'click .dropdown-item':'_setSelection',},supportedFieldTypes:['selection'],getFocusableElement:function(){return this.$("a[data-toggle='dropdown']");},_prepareDropdownValues:function(){var self=this;var _data=[];var current_stage_id=self.recordData.stage_id&&self.recordData.stage_id[0];var stage_data={id:current_stage_id,legend_normal:this.recordData.legend_normal||undefined,legend_blocked:this.recordData.legend_blocked||undefined,legend_done:this.recordData.legend_done||undefined,};_.map(this.field.selection||[],function(selection_item){var value={'name':selection_item[0],'tooltip':selection_item[1],};if(selection_item[0]==='normal'){value.state_name=stage_data.legend_normal?stage_data.legend_normal:selection_item[1];}else if(selection_item[0]==='done'){value.state_class='o_status_green';value.state_name=stage_data.legend_done?stage_data.legend_done:selection_item[1];}else{value.state_class='o_status_red';value.state_name=stage_data.legend_blocked?stage_data.legend_blocked:selection_item[1];}
_data.push(value);});return _data;},_render:function(){var self=this;var states=this._prepareDropdownValues();var currentState=_.findWhere(states,{name:self.value})||states[0];this.$('.o_status').removeClass('o_status_red o_status_green').addClass(currentState.state_class).prop('special_click',true).parent().attr('title',currentState.state_name).attr('aria-label',self.string+": "+currentState.state_name);var $items=$(qweb.render('FormSelection.items',{states:_.without(states,currentState)}));var $dropdown=this.$('.dropdown-menu');$dropdown.children().remove();$items.appendTo($dropdown);},_setSelection:function(ev){ev.preventDefault();var $item=$(ev.currentTarget);var value=String($item.data('value'));this._setValue(value);if(this.mode==='edit'){this._render();}},});var FavoriteWidget=AbstractField.extend({className:'o_favorite',events:{'click':'_setFavorite'},supportedFieldTypes:['boolean'],isSet:function(){return true;},_render:function(){var tip=this.value?_t('Remove from Favorites'):_t('Add to Favorites');var template=this.attrs.nolabel?'<a href="#"><i class="fa %s" title="%s" aria-label="%s" role="img"></i></a>':'<a href="#"><i class="fa %s" role="img" aria-label="%s"></i> %s</a>';this.$el.empty().append(_.str.sprintf(template,this.value?'fa-star':'fa-star-o',tip,tip));},_setFavorite:function(event){event.preventDefault();event.stopPropagation();this._setValue(!this.value);},});var LabelSelection=AbstractField.extend({supportedFieldTypes:['selection'],_render:function(){this.classes=this.nodeOptions&&this.nodeOptions.classes||{};var labelClass=this.classes[this.value]||'primary';this.$el.addClass('badge badge-'+labelClass).text(this._formatValue(this.value));},});var FieldBooleanButton=AbstractField.extend({className:'o_stat_info',supportedFieldTypes:['boolean'],isSet:function(){return true;},_render:function(){this.$el.empty();var text,hover;switch(this.nodeOptions.terminology){case"active":text=this.value?_t("Active"):_t("Inactive");hover=this.value?_t("Deactivate"):_t("Activate");break;case"archive":text=this.value?_t("Active"):_t("Archived");hover=this.value?_t("Archive"):_t("Restore");break;case"close":text=this.value?_t("Active"):_t("Closed");hover=this.value?_t("Close"):_t("Open");break;default:var opt_terms=this.nodeOptions.terminology||{};if(typeof opt_terms==='string'){opt_terms={};}
text=this.value?_t(opt_terms.string_true)||_t("On"):_t(opt_terms.string_false)||_t("Off");hover=this.value?_t(opt_terms.hover_true)||_t("Switch Off"):_t(opt_terms.hover_false)||_t("Switch On");}
var val_color=this.value?'text-success':'text-danger';var hover_color=this.value?'text-danger':'text-success';var $val=$('<span>').addClass('o_stat_text o_not_hover '+val_color).text(text);var $hover=$('<span>').addClass('o_stat_text o_hover '+hover_color).text(hover);this.$el.append($val).append($hover);},});var BooleanToggle=FieldBoolean.extend({className:FieldBoolean.prototype.className+' o_boolean_toggle',events:{'click':'_onClick'},_onClick:function(event){event.stopPropagation();this._setValue(!this.value);this.$el.closest(".o_data_row").toggleClass('text-muted',this.value);},});var StatInfo=AbstractField.extend({supportedFieldTypes:['integer','float'],isSet:function(){return true;},_render:function(){var options={value:this._formatValue(this.value||0),};if(!this.attrs.nolabel){if(this.nodeOptions.label_field&&this.recordData[this.nodeOptions.label_field]){options.text=this.recordData[this.nodeOptions.label_field];}else{options.text=this.string;}}
this.$el.html(qweb.render("StatInfo",options));this.$el.addClass('o_stat_info');},});var FieldPercentPie=AbstractField.extend({template:'FieldPercentPie',supportedFieldTypes:['integer','float'],start:function(){this.$leftMask=this.$('.o_mask').first();this.$rightMask=this.$('.o_mask').last();this.$pieValue=this.$('.o_pie_value');return this._super();},isSet:function(){return true;},_render:function(){var value=this.value||0;var degValue=360*value/100;this.$rightMask.toggleClass('o_full',degValue>=180);var leftDeg='rotate('+((degValue<180)?180:degValue)+'deg)';var rightDeg='rotate('+((degValue<180)?degValue:0)+'deg)';this.$leftMask.css({transform:leftDeg,msTransform:leftDeg,mozTransform:leftDeg,webkitTransform:leftDeg});this.$rightMask.css({transform:rightDeg,msTransform:rightDeg,mozTransform:rightDeg,webkitTransform:rightDeg});this.$pieValue.text(Math.round(value)+'%');},});var FieldProgressBar=AbstractField.extend({template:"ProgressBar",events:{'change input':'on_change_input','input input':'on_change_input','keyup input':function(e){if(e.which===$.ui.keyCode.ENTER){this.on_change_input(e);}},},supportedFieldTypes:['integer','float'],init:function(){this._super.apply(this,arguments);if(this.recordData[this.nodeOptions.current_value]){this.value=this.recordData[this.nodeOptions.current_value];}
this.editable_readonly=!!this.nodeOptions.editable_readonly;this.readonly=this.nodeOptions.readonly||!this.nodeOptions.editable;this.canWrite=!this.readonly&&(this.mode==='edit'||(this.editable_readonly&&this.mode==='readonly')||(this.viewType==='kanban'));this.edit_max_value=!!this.nodeOptions.edit_max_value;this.max_value=this.recordData[this.nodeOptions.max_value]||100;this.title=_t(this.attrs.title||this.nodeOptions.title)||'';this.enableBarAsInput=false;this.edit_on_click=this.enableBarAsInput&&this.mode==='readonly'&&!this.edit_max_value;this.write_mode=false;},_render:function(){var self=this;this._render_value();if(this.canWrite){if(this.edit_on_click){this.$el.on('click','.o_progress',function(e){var $target=$(e.currentTarget);var numValue=Math.floor((e.pageX-$target.offset().left)/$target.outerWidth()*self.max_value);self.on_update(numValue);self._render_value();});}else{this.$el.on('click',function(){if(!self.write_mode){var $input=$('<input>',{type:'text',class:'o_progressbar_value o_input'});$input.on('blur',self.on_change_input.bind(self));self.$('.o_progressbar_value').replaceWith($input);self.write_mode=true;self._render_value();}});}}
return this._super();},on_update:function(value){if(this.edit_max_value){this.max_value=value;this._isValid=true;var changes={};changes[this.nodeOptions.max_value]=this.max_value;this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:changes,});}else{var formattedValue=this._formatValue(value);this._setValue(formattedValue);}},on_change_input:function(e){var $input=$(e.target);if(e.type==='change'&&!$input.is(':focus')){return;}
var parsedValue;try{parsedValue=field_utils.parse.float($input.val());}catch(error){this.do_warn(_t("Wrong value entered!"),_t("Only Integer or Float Value should be valid."));}
if(parsedValue!==undefined){if(e.type==='input'){this._render_value(parsedValue);if(parsedValue===0){$input.select();}}else{if(this.edit_max_value){parsedValue=parsedValue||100;}
var $div=$('<div>',{class:'o_progressbar_value'});this.$('.o_progressbar_value').replaceWith($div);this.write_mode=false;this.on_update(parsedValue);this._render_value();}}},_render_value:function(v){var value=this.value;var max_value=this.max_value;if(!isNaN(v)){if(this.edit_max_value){max_value=v;}else{value=v;}}
value=value||0;max_value=max_value||0;var widthComplete;if(value<=max_value){widthComplete=value/max_value*100;}else{widthComplete=100;}
this.$('.o_progress').toggleClass('o_progress_overflow',value>max_value).attr('aria-valuemin','0').attr('aria-valuemax',max_value).attr('aria-valuenow',value);this.$('.o_progressbar_complete').css('width',widthComplete+'%');if(!this.write_mode){if(max_value!==100){this.$('.o_progressbar_value').text(utils.human_number(value)+" / "+utils.human_number(max_value));}else{this.$('.o_progressbar_value').text(utils.human_number(value)+"%");}}else if(isNaN(v)){this.$('.o_progressbar_value').val(this.edit_max_value?max_value:value);this.$('.o_progressbar_value').focus().select();}},_reset:function(){this._super.apply(this,arguments);var new_max_value=this.recordData[this.nodeOptions.max_value];this.max_value=new_max_value!==undefined?new_max_value:this.max_value;},isSet:function(){return true;},});var FieldToggleBoolean=AbstractField.extend({template:"toggle_button",events:{'click':'_onToggleButton'},supportedFieldTypes:['boolean'],isSet:function(){return true;},_render:function(){this.$('i').toggleClass('o_toggle_button_success',!!this.value).toggleClass('text-muted',!this.value);var title=this.value?this.attrs.options.active:this.attrs.options.inactive;this.$el.attr('title',title);this.$el.attr('aria-pressed',this.value);},_onToggleButton:function(event){event.stopPropagation();this._setValue(!this.value);},});var JournalDashboardGraph=AbstractField.extend({className:"o_dashboard_graph",cssLibs:['/web/static/lib/nvd3/nv.d3.css'],jsLibs:['/web/static/lib/nvd3/d3.v3.js','/web/static/lib/nvd3/nv.d3.js','/web/static/src/js/libs/nvd3.js'],init:function(){this._super.apply(this,arguments);this.graph_type=this.attrs.graph_type;this.data=JSON.parse(this.value);},start:function(){this._onResize=this._onResize.bind(this);nv.utils.windowResize(this._onResize);return this._super.apply(this,arguments);},destroy:function(){if('nv'in window&&nv.utils&&nv.utils.offWindowResize){nv.utils.offWindowResize(this._onResize);}
this._super.apply(this,arguments);},on_attach_callback:function(){this._isInDOM=true;this._renderInDOM();},on_detach_callback:function(){if(this.chart!==null){this.chart.tooltip.hidden(true);}
this._isInDOM=false;},_customizeChart:function(){if(this.graph_type==='bar'){var bar_classes=_.map(this.data[0].values,function(v){return v.type;});_.each(this.$('.nv-bar'),function(v,k){$(v).attr('class',$(v).attr('class')+' '+bar_classes[k]);});}},_render:function(){if(this._isInDOM){return this._renderInDOM();}
return $.when();},_renderInDOM:function(){var self=this;this.$el.empty();this.chart=null;nv.addGraph(function(){self.$svg=self.$el.append('<svg>');switch(self.graph_type){case"line":self.$svg.addClass('o_graph_linechart');self.chart=nv.models.lineChart();self.chart.forceY([0]);self.chart.options({x:function(d,u){return u;},margin:{'left':0,'right':0,'top':5,'bottom':0},showYAxis:false,showLegend:false,});self.chart.xAxis.tickFormat(function(d){var label='';_.each(self.data,function(v){if(v.values[d]&&v.values[d].x){label=v.values[d].x;}});return label;});self.chart.yAxis.tickFormat(d3.format(',.2f'));self.chart.tooltip.contentGenerator(function(key){return qweb.render('GraphCustomTooltip',{'color':key.point.color,'key':self.data[0].key,'value':d3.format(',.2f')(key.point.y)});});break;case"bar":self.$svg.addClass('o_graph_barchart');self.chart=nv.models.discreteBarChart().x(function(d){return d.label;}).y(function(d){return d.value;}).showValues(false).showYAxis(false).color(['#875A7B','#526774','#FA8072']).margin({'left':0,'right':0,'top':20,'bottom':20});self.chart.xAxis.axisLabel(self.data[0].title);self.chart.yAxis.tickFormat(d3.format(',.2f'));self.chart.tooltip.contentGenerator(function(key){return qweb.render('GraphCustomTooltip',{'color':key.color,'key':self.data[0].key,'value':d3.format(',.2f')(key.data.value)});});break;}
d3.select(self.$('svg')[0]).datum(self.data).transition().duration(600).call(self.chart);self._customizeChart();});},_onResize:function(){if(this.chart){this.chart.update();this._customizeChart();}},});var FieldDomain=AbstractField.extend({specialData:"_fetchSpecialDomain",events:_.extend({},AbstractField.prototype.events,{"click .o_domain_show_selection_button":"_onShowSelectionButtonClick","click .o_field_domain_dialog_button":"_onDialogEditButtonClick",}),custom_events:_.extend({},AbstractField.prototype.custom_events,{domain_changed:"_onDomainSelectorValueChange",domain_selected:"_onDomainSelectorDialogValueChange",open_record:"_onOpenRecord",}),init:function(){this._super.apply(this,arguments);this.inDialog=!!this.nodeOptions.in_dialog;this.fsFilters=this.nodeOptions.fs_filters||{};this.className="o_field_domain";if(this.mode==="edit"){this.className+=" o_edit_mode";}
if(!this.inDialog){this.className+=" o_inline_mode";}
this._setState();},isSet:function(){return true;},isValid:function(){return(this._super.apply(this,arguments)&&(!this.domainSelector||this.domainSelector.isValid())&&this._isValidForModel);},_render:function(){if(!this._domainModel){this._replaceContent();return $.when();}
var value=this.value||"[]";var def;if(!this.domainSelector){this.domainSelector=new DomainSelector(this,this._domainModel,value,{readonly:this.mode==="readonly"||this.inDialog,filters:this.fsFilters,debugMode:session.debug,});def=this.domainSelector.prependTo(this.$el);}else{def=this.domainSelector.setDomain(value);}
return def.then(this._replaceContent.bind(this));},_replaceContent:function(){if(this._$content){this._$content.remove();}
this._$content=$(qweb.render("FieldDomain.content",{hasModel:!!this._domainModel,isValid:!!this._isValidForModel,nbRecords:this.record.specialData[this.name].nbRecords||0,inDialogEdit:this.inDialog&&this.mode==="edit",}));this._$content.appendTo(this.$el);},_reset:function(){this._super.apply(this,arguments);var oldDomainModel=this._domainModel;this._setState();if(this.domainSelector&&this._domainModel!==oldDomainModel){this.domainSelector.destroy();this.domainSelector=null;}},_setState:function(){var specialData=this.record.specialData[this.name];this._domainModel=specialData.model;this._isValidForModel=(specialData.nbRecords!==false);},_onShowSelectionButtonClick:function(e){e.preventDefault();new view_dialogs.SelectCreateDialog(this,{title:_t("Selected records"),res_model:this._domainModel,domain:this.value||"[]",no_create:true,readonly:true,disable_multiple_selection:true,}).open();},_onDialogEditButtonClick:function(e){e.preventDefault();new DomainSelectorDialog(this,this._domainModel,this.value||"[]",{readonly:this.mode==="readonly",filters:this.fsFilters,debugMode:session.debug,}).open();},_onDomainSelectorValueChange:function(e){if(this.inDialog)return;this._setValue(Domain.prototype.arrayToString(this.domainSelector.getDomain()));},_onDomainSelectorDialogValueChange:function(e){this._setValue(Domain.prototype.arrayToString(e.data.domain));},_onOpenRecord:function(event){event.stopPropagation();},});var AceEditor=DebouncedField.extend({template:"AceEditor",jsLibs:['/web/static/lib/ace/ace.js',['/web/static/lib/ace/mode-python.js','/web/static/lib/ace/mode-xml.js']],events:{},start:function(){this._startAce(this.$('.ace-view-editor')[0]);return this._super.apply(this,arguments);},destroy:function(){if(this.aceEditor){this.aceEditor.destroy();}
this._super.apply(this,arguments);},_formatValue:function(value){return this._super.apply(this,arguments)||'';},_getValue:function(){return this.aceSession.getValue();},_render:function(){var newValue=this._formatValue(this.value);if(this.aceSession.getValue()!==newValue){this.aceSession.setValue(newValue);}},_startAce:function(node){this.aceEditor=ace.edit(node);this.aceEditor.setOptions({maxLines:Infinity,showPrintMargin:false,});if(this.mode==='readonly'){this.aceEditor.renderer.setOptions({displayIndentGuides:false,showGutter:false,});this.aceEditor.setOptions({highlightActiveLine:false,highlightGutterLine:false,readOnly:true,});this.aceEditor.renderer.$cursorLayer.element.style.display="none";}
this.aceEditor.$blockScrolling=true;this.aceSession=this.aceEditor.getSession();this.aceSession.setOptions({useWorker:false,mode:"ace/mode/"+(this.nodeOptions.mode||'xml'),tabSize:2,useSoftTabs:true,});if(this.mode==="edit"){this.aceEditor.on("change",this._doDebouncedAction.bind(this));this.aceEditor.on("blur",this._doAction.bind(this));}},});return{TranslatableFieldMixin:TranslatableFieldMixin,DebouncedField:DebouncedField,FieldEmail:FieldEmail,FieldBinaryFile:FieldBinaryFile,FieldPdfViewer:FieldPdfViewer,FieldBinaryImage:FieldBinaryImage,FieldBoolean:FieldBoolean,FieldBooleanButton:FieldBooleanButton,BooleanToggle:BooleanToggle,FieldChar:FieldChar,LinkButton:LinkButton,FieldDate:FieldDate,FieldDateTime:FieldDateTime,FieldDomain:FieldDomain,FieldFloat:FieldFloat,FieldFloatTime:FieldFloatTime,FieldFloatFactor:FieldFloatFactor,FieldFloatToggle:FieldFloatToggle,FieldPercentage:FieldPercentage,FieldInteger:FieldInteger,FieldMonetary:FieldMonetary,FieldPercentPie:FieldPercentPie,FieldPhone:FieldPhone,FieldProgressBar:FieldProgressBar,FieldText:FieldText,FieldToggleBoolean:FieldToggleBoolean,HandleWidget:HandleWidget,InputField:InputField,NumericField:NumericField,AttachmentImage:AttachmentImage,LabelSelection:LabelSelection,StateSelectionWidget:StateSelectionWidget,FavoriteWidget:FavoriteWidget,PriorityWidget:PriorityWidget,StatInfo:StatInfo,UrlWidget:UrlWidget,TextCopyClipboard:TextCopyClipboard,CharCopyClipboard:CharCopyClipboard,JournalDashboardGraph:JournalDashboardGraph,AceEditor:AceEditor,};});;

/* /web/static/src/js/fields/field_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.field_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});odoo.define('web._field_registry',function(require){"use strict";var AbstractField=require('web.AbstractField');var basic_fields=require('web.basic_fields');var relational_fields=require('web.relational_fields');var registry=require('web.field_registry');var special_fields=require('web.special_fields');registry.add('abstract',AbstractField).add('input',basic_fields.InputField).add('integer',basic_fields.FieldInteger).add('boolean',basic_fields.FieldBoolean).add('date',basic_fields.FieldDate).add('datetime',basic_fields.FieldDateTime).add('domain',basic_fields.FieldDomain).add('text',basic_fields.FieldText).add('html',basic_fields.FieldText).add('float',basic_fields.FieldFloat).add('char',basic_fields.FieldChar).add('link_button',basic_fields.LinkButton).add('handle',basic_fields.HandleWidget).add('email',basic_fields.FieldEmail).add('phone',basic_fields.FieldPhone).add('url',basic_fields.UrlWidget).add('CopyClipboardText',basic_fields.TextCopyClipboard).add('CopyClipboardChar',basic_fields.CharCopyClipboard).add('image',basic_fields.FieldBinaryImage).add('binary',basic_fields.FieldBinaryFile).add('pdf_viewer',basic_fields.FieldPdfViewer).add('monetary',basic_fields.FieldMonetary).add('percentage',basic_fields.FieldPercentage).add('priority',basic_fields.PriorityWidget).add('attachment_image',basic_fields.AttachmentImage).add('label_selection',basic_fields.LabelSelection).add('kanban_label_selection',basic_fields.LabelSelection).add('state_selection',basic_fields.StateSelectionWidget).add('kanban_state_selection',basic_fields.StateSelectionWidget).add('boolean_favorite',basic_fields.FavoriteWidget).add('boolean_button',basic_fields.FieldBooleanButton).add('boolean_toggle',basic_fields.BooleanToggle).add('statinfo',basic_fields.StatInfo).add('percentpie',basic_fields.FieldPercentPie).add('float_time',basic_fields.FieldFloatTime).add('float_factor',basic_fields.FieldFloatFactor).add('float_toggle',basic_fields.FieldFloatToggle).add('progressbar',basic_fields.FieldProgressBar).add('toggle_button',basic_fields.FieldToggleBoolean).add('dashboard_graph',basic_fields.JournalDashboardGraph).add('ace',basic_fields.AceEditor);registry.add('selection',relational_fields.FieldSelection).add('radio',relational_fields.FieldRadio).add('selection_badge',relational_fields.FieldSelectionBadge).add('many2one',relational_fields.FieldMany2One).add('list.many2one',relational_fields.ListFieldMany2One).add('kanban.many2one',relational_fields.KanbanFieldMany2One).add('many2many',relational_fields.FieldMany2Many).add('many2many_binary',relational_fields.FieldMany2ManyBinaryMultiFiles).add('many2many_tags',relational_fields.FieldMany2ManyTags).add('form.many2many_tags',relational_fields.FormFieldMany2ManyTags).add('kanban.many2many_tags',relational_fields.KanbanFieldMany2ManyTags).add('many2many_checkboxes',relational_fields.FieldMany2ManyCheckBoxes).add('one2many',relational_fields.FieldOne2Many).add('statusbar',relational_fields.FieldStatus).add('reference',relational_fields.FieldReference).add('one2many_list',relational_fields.FieldOne2Many);registry.add('timezone_mismatch',special_fields.FieldTimezoneMismatch).add('report_layout',special_fields.FieldReportLayout);});;

/* /web/static/src/js/views/basic/widget_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.widget_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});;

/* /web/static/src/js/fields/field_utils.js defined in bundle 'web.assets_backend' */
odoo.define('web.field_utils',function(require){"use strict";var core=require('web.core');var dom=require('web.dom');var session=require('web.session');var time=require('web.time');var utils=require('web.utils');var _t=core._t;function formatBinary(value,field,options){if(!value){return'';}
return utils.binaryToBinsize(value);}
function formatBoolean(value,field,options){if(options&&options.forceString){return value?_t('True'):_t('False');}
return dom.renderCheckbox({prop:{checked:value,disabled:true,},});}
function formatChar(value,field,options){value=typeof value==='string'?value:'';if(options&&options.isPassword){return _.str.repeat('*',value?value.length:0);}
if(options&&options.escape){value=_.escape(value);}
return value;}
function formatDate(value,field,options){if(value===false){return"";}
if(field&&field.type==='datetime'){if(!options||!('timezone'in options)||options.timezone){value=value.clone().add(session.getTZOffset(value),'minutes');}}
var date_format=time.getLangDateFormat();return value.format(date_format);}
function formatDateTime(value,field,options){if(value===false){return"";}
if(!options||!('timezone'in options)||options.timezone){value=value.clone().add(session.getTZOffset(value),'minutes');}
return value.format(time.getLangDatetimeFormat());}
function formatFloat(value,field,options){options=options||{};if(value===false){return"";}
if(options.humanReadable&&options.humanReadable(value)){return utils.human_number(value,options.decimals,options.minDigits,options.formatterCallback);}
var l10n=core._t.database.parameters;var precision;if(options.digits){precision=options.digits[1];}else if(field&&field.digits){precision=field.digits[1];}else{precision=2;}
var formatted=_.str.sprintf('%.'+precision+'f',value||0).split('.');formatted[0]=utils.insert_thousand_seps(formatted[0]);return formatted.join(l10n.decimal_point);}
function formatFloatFactor(value,field,options){var factor=options.factor||1;return formatFloat(value*factor,field,options);}
function formatFloatTime(value){var pattern='%02d:%02d';if(value<0){value=Math.abs(value);pattern='-'+pattern;}
var hour=Math.floor(value);var min=Math.round((value%1)*60);if(min===60){min=0;hour=hour+1;}
return _.str.sprintf(pattern,hour,min);}
function formatInteger(value,field,options){options=options||{};if(options.isPassword){return _.str.repeat('*',String(value).length);}
if(!value&&value!==0){return"";}
if(options.humanReadable&&options.humanReadable(value)){return utils.human_number(value,options.decimals,options.minDigits,options.formatterCallback);}
return utils.insert_thousand_seps(_.str.sprintf('%d',value));}
function formatMany2one(value,field,options){if(!value){value='';}else if(_.isArray(value)){value=value[1];}else{while(value.data){value=value.data.display_name||'';}}
if(options&&options.escape){value=_.escape(value);}
return value;}
function formatX2Many(value){if(value.data.length===0){return _t('No records');}else if(value.data.length===1){return _t('1 record');}else{return value.data.length+_t(' records');}}
function formatMonetary(value,field,options){if(value===false){return"";}
options=options||{};var currency=options.currency;if(!currency){var currency_id=options.currency_id;if(!currency_id&&options.data){var currency_field=options.currency_field||field.currency_field||'currency_id';currency_id=options.data[currency_field]&&options.data[currency_field].res_id;}
currency=session.get_currency(currency_id);}
var digits=(currency&&currency.digits)||options.digits;if(options.field_digits===true){digits=field.digits||digits;}
var formatted_value=formatFloat(value,field,_.extend({},options,{digits:digits}));if(!currency||options.noSymbol){return formatted_value;}
if(currency.position==="after"){return formatted_value+='&nbsp;'+currency.symbol;}else{return currency.symbol+'&nbsp;'+formatted_value;}}
function formatPercentage(value,field,options){options=options||{};var result=formatFloat(value*100,field,options)||'0';if(options.humanReadable&&options.humanReadable(value*100)){return result+"%";}
return(parseFloat(result)+"%").replace('.',_t.database.parameters.decimal_point);}
function formatSelection(value,field,options){var val=_.find(field.selection,function(option){return option[0]===value;});if(!val){return'';}
value=val[1];if(options&&options.escape){value=_.escape(value);}
return value;}
function parseDate(value,field,options){if(!value){return false;}
var datePattern=time.getLangDateFormat();var datePatternWoZero=datePattern.replace('MM','M').replace('DD','D');var date;if(options&&options.isUTC){date=moment.utc(value);}else{date=moment.utc(value,[datePattern,datePatternWoZero,moment.ISO_8601]);}
if(date.isValid()){if(date.year()===0){date.year(moment.utc().year());}
if(date.year()>=1900){date.toJSON=function(){return this.clone().locale('en').format('YYYY-MM-DD');};return date;}}
throw new Error(_.str.sprintf(core._t("'%s' is not a correct date"),value));}
function parseDateTime(value,field,options){if(!value){return false;}
var datePattern=time.getLangDateFormat(),timePattern=time.getLangTimeFormat();var datePatternWoZero=datePattern.replace('MM','M').replace('DD','D'),timePatternWoZero=timePattern.replace('HH','H').replace('mm','m').replace('ss','s');var pattern1=datePattern+' '+timePattern;var pattern2=datePatternWoZero+' '+timePatternWoZero;var datetime;if(options&&options.isUTC){datetime=moment.utc(value.replace(' ','T')+'Z');}else{datetime=moment.utc(value,[pattern1,pattern2,moment.ISO_8601]);if(options&&options.timezone){datetime.add(-session.getTZOffset(datetime),'minutes');}}
if(datetime.isValid()){if(datetime.year()===0){datetime.year(moment.utc().year());}
if(datetime.year()>=1900){datetime.toJSON=function(){return this.clone().locale('en').format('YYYY-MM-DD HH:mm:ss');};return datetime;}}
throw new Error(_.str.sprintf(core._t("'%s' is not a correct datetime"),value));}
function parseNumber(value){if(core._t.database.parameters.thousands_sep){var escapedSep=_.str.escapeRegExp(core._t.database.parameters.thousands_sep);value=value.replace(new RegExp(escapedSep,'g'),'');}
if(core._t.database.parameters.decimal_point){value=value.replace(core._t.database.parameters.decimal_point,'.');}
return Number(value);}
function parseFloat(value){var parsed=parseNumber(value);if(isNaN(parsed)){throw new Error(_.str.sprintf(core._t("'%s' is not a correct float"),value));}
return parsed;}
function parseMonetary(value,field,options){var values=value.split('&nbsp;');if(values.length===1){return parseFloat(value);}
else if(values.length!==2){throw new Error(_.str.sprintf(core._t("'%s' is not a correct monetary field"),value));}
options=options||{};var currency=options.currency;if(!currency){var currency_id=options.currency_id;if(!currency_id&&options.data){var currency_field=options.currency_field||field.currency_field||'currency_id';currency_id=options.data[currency_field]&&options.data[currency_field].res_id;}
currency=session.get_currency(currency_id);}
return parseFloat(values[0]===currency.symbol?values[1]:values[0]);}
function parseFloatFactor(value,field,options){var parsed=parseFloat(value);var factor=options.factor||1.0;return parsed/factor;}
function parseFloatTime(value){var factor=1;if(value[0]==='-'){value=value.slice(1);factor=-1;}
var float_time_pair=value.split(":");if(float_time_pair.length!==2)
return factor*parseFloat(value);var hours=parseInteger(float_time_pair[0]);var minutes=parseInteger(float_time_pair[1]);return factor*(hours+(minutes/60));}
function parsePercentage(value){if(value.slice(-1)==='%'){return parseFloat(value.slice(0,-1))/100;}
return parseFloat(value);}
function parseInteger(value){var parsed=parseNumber(value);if(isNaN(parsed)||parsed%1||parsed<-2147483648||parsed>2147483647){throw new Error(_.str.sprintf(core._t("'%s' is not a correct integer"),value));}
return parsed;}
function parseMany2one(value){if(_.isArray(value)){return{id:value[0],display_name:value[1],};}
if(_.isNumber(value)||_.isString(value)){return{id:parseInt(value,10),};}
return value;}
return{format:{binary:formatBinary,boolean:formatBoolean,char:formatChar,date:formatDate,datetime:formatDateTime,float:formatFloat,float_factor:formatFloatFactor,float_time:formatFloatTime,html:_.identity,integer:formatInteger,many2many:formatX2Many,many2one:formatMany2one,monetary:formatMonetary,one2many:formatX2Many,percentage:formatPercentage,reference:formatMany2one,selection:formatSelection,text:formatChar,},parse:{binary:_.identity,boolean:_.identity,char:_.identity,date:parseDate,datetime:parseDateTime,float:parseFloat,float_factor:parseFloatFactor,float_time:parseFloatTime,html:_.identity,integer:parseInteger,many2many:_.identity,many2one:parseMany2one,monetary:parseMonetary,one2many:_.identity,percentage:parsePercentage,reference:parseMany2one,selection:_.identity,text:_.identity,},};});;

/* /web/static/src/js/fields/relational_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web.relational_fields',function(require){"use strict";var AbstractField=require('web.AbstractField');var basicFields=require('web.basic_fields');var concurrency=require('web.concurrency');var ControlPanel=require('web.ControlPanel');var dialogs=require('web.view_dialogs');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var KanbanRenderer=require('web.KanbanRenderer');var ListRenderer=require('web.ListRenderer');var Pager=require('web.Pager');var _t=core._t;var qweb=core.qweb;var M2ODialog=Dialog.extend({template:"M2ODialog",init:function(parent,name,value){this.name=name;this.value=value;this._super(parent,{title:_.str.sprintf(_t("Create a %s"),this.name),size:'medium',buttons:[{text:_t('Create'),classes:'btn-primary',click:function(){if(this.$("input").val()!==''){this.trigger_up('quick_create',{value:this.$('input').val()});this.close(true);}else{this.$("input").focus();}},},{text:_t('Create and edit'),classes:'btn-primary',close:true,click:function(){this.trigger_up('search_create_popup',{view_type:'form',value:this.$('input').val(),});},},{text:_t('Cancel'),close:true,}],});},start:function(){this.$("p").text(_.str.sprintf(_t("You are creating a new %s, are you sure it does not exist yet?"),this.name));this.$("input").val(this.value);},close:function(isSet){this.isSet=isSet;this._super.apply(this,arguments);},destroy:function(){if(!this.isSet){this.trigger_up('closed_unset');}
this._super.apply(this,arguments);},});var FieldMany2One=AbstractField.extend({supportedFieldTypes:['many2one'],template:'FieldMany2One',custom_events:_.extend({},AbstractField.prototype.custom_events,{'closed_unset':'_onDialogClosedUnset','field_changed':'_onFieldChanged','quick_create':'_onQuickCreate','search_create_popup':'_onSearchCreatePopup',}),events:_.extend({},AbstractField.prototype.events,{'click input':'_onInputClick','focusout input':'_onInputFocusout','keyup input':'_onInputKeyup','click .o_external_button':'_onExternalButtonClick','click':'_onClick',}),AUTOCOMPLETE_DELAY:200,init:function(parent,name,record,options){this._super.apply(this,arguments);this.limit=7;this.orderer=new concurrency.DropMisordered();this.can_create=('can_create'in this.attrs?JSON.parse(this.attrs.can_create):true)&&!this.nodeOptions.no_create;this.can_write='can_write'in this.attrs?JSON.parse(this.attrs.can_write):true;this.nodeOptions=_.defaults(this.nodeOptions,{quick_create:true,});this.noOpen='noOpen'in(options||{})?options.noOpen:this.nodeOptions.no_open;this.m2o_value=this._formatValue(this.value);this.recordParams={fieldName:this.name,viewType:this.viewType};this.isDirty=false;this.lastChangeEvent=undefined;this._autocompleteSources=[];this._addAutocompleteSource(this._search,{placeholder:_t('Loading...'),order:1});this.dp=new concurrency.DropPrevious();this.createDef=undefined;},start:function(){this.floating=false;this.$input=this.$('input');this.$external_button=this.$('.o_external_button');return this._super.apply(this,arguments);},commitChanges:function(){return $.when(this.createDef);},getFocusableElement:function(){return this.mode==='edit'&&this.$input||this.$el;},reinitialize:function(value){this.isDirty=false;this.floating=false;return this._setValue(value);},reset:function(record,event){this._reset(record,event);if(!event||event===this.lastChangeEvent){this.isDirty=false;}
if(this.isDirty){return $.when();}else{return this._render();}},_addAutocompleteSource:function(method,params){this._autocompleteSources.push({method:method,placeholder:(params.placeholder?_t(params.placeholder):_t('Loading...'))+'<i class="fa fa-spinner fa-spin pull-right"></i>',validation:params.validation,loading:false,order:params.order||999});this._autocompleteSources=_.sortBy(this._autocompleteSources,'order');},_bindAutoComplete:function(){var self=this;if($.browser.chrome&&this.$input.attr('placeholder')){this.$input.attr('placeholder',function(index,val){return val.split('').join('\ufeff');});}
this.$input.autocomplete({source:function(req,resp){_.each(self._autocompleteSources,function(source){source.results=[];if(!source.validation||source.validation.call(self,req.term)){source.loading=true;$.when(source.method.call(self,req.term)).then(function(results){source.results=results;source.loading=false;resp(self._concatenateAutocompleteResults());});}});},select:function(event,ui){event.stopImmediatePropagation();event.preventDefault();var item=ui.item;self.floating=false;if(item.id){self.reinitialize({id:item.id,display_name:item.name});}else if(item.action){item.action();}
return false;},focus:function(event){event.preventDefault();},close:function(event){if(event.which===$.ui.keyCode.ESCAPE){event.stopPropagation();}},autoFocus:true,html:true,minLength:0,delay:this.AUTOCOMPLETE_DELAY,});this.$input.autocomplete("option","position",{my:"left top",at:"left bottom"});this.autocomplete_bound=true;},_concatenateAutocompleteResults:function(){var results=[];_.each(this._autocompleteSources,function(source){if(source.results&&source.results.length){results=results.concat(source.results);}else if(source.loading){results.push({label:source.placeholder});}});return results;},_createContext:function(name){var tmp={};var field=this.nodeOptions.create_name_field;if(field===undefined){field="name";}
if(field!==false&&name&&this.nodeOptions.quick_create!==false){tmp["default_"+field]=name;}
return tmp;},_getSearchBlacklist:function(){return[];},_getDisplayName:function(value){return value.split('\n')[0];},_onFieldChanged:function(event){this.lastChangeEvent=event;},_quickCreate:function(name){var self=this;var def=$.Deferred();this.createDef=this.createDef||$.Deferred();var createDone=function(){def.resolve();self.createDef.resolve();self.createDef=undefined;};var slowCreate=function(){var dialog=self._searchCreatePopup("form",false,self._createContext(name));dialog.on('closed',self,createDone);};if(this.nodeOptions.quick_create){var nameCreateDef=this._rpc({model:this.field.relation,method:'name_create',args:[name],context:this.record.getContext(this.recordParams),}).fail(function(error,ev){ev.preventDefault();slowCreate();});this.dp.add(nameCreateDef).then(function(result){if(self.mode==="edit"){self.reinitialize({id:result[0],display_name:result[1]});}
createDone();}).fail(def.reject.bind(def));}else{slowCreate();}
return def;},_renderEdit:function(){var value=this.m2o_value;if(this.nodeOptions.always_reload){value=this._getDisplayName(value);}
this.$input.val(value);if(!this.autocomplete_bound){this._bindAutoComplete();}
this._updateExternalButton();},_renderReadonly:function(){var value=_.escape((this.m2o_value||"").trim()).split("\n").join("<br/>");this.$el.html(value);if(!this.noOpen&&this.value){this.$el.attr('href',_.str.sprintf('#id=%s&model=%s',this.value.res_id,this.field.relation));this.$el.addClass('o_form_uri');}},_reset:function(){this._super.apply(this,arguments);this.floating=false;this.m2o_value=this._formatValue(this.value);},_search:function(search_val){var self=this;var def=$.Deferred();this.orderer.add(def);var context=this.record.getContext(this.recordParams);var domain=this.record.getDomain(this.recordParams);_.extend(context,this.additionalContext);var blacklisted_ids=this._getSearchBlacklist();if(blacklisted_ids.length>0){domain.push(['id','not in',blacklisted_ids]);}
this._rpc({model:this.field.relation,method:"name_search",kwargs:{name:search_val,args:domain,operator:"ilike",limit:this.limit+1,context:context,}}).then(function(result){var values=_.map(result,function(x){x[1]=self._getDisplayName(x[1]);return{label:_.str.escapeHTML(x[1].trim())||data.noDisplayContent,value:x[1],name:x[1],id:x[0],};});if(values.length>self.limit){values=values.slice(0,self.limit);values.push({label:_t("Search More..."),action:function(){self._rpc({model:self.field.relation,method:'name_search',kwargs:{name:search_val,args:domain,operator:"ilike",limit:160,context:context,},}).then(self._searchCreatePopup.bind(self,"search"));},classname:'o_m2o_dropdown_option',});}
var create_enabled=self.can_create&&!self.nodeOptions.no_create;var raw_result=_.map(result,function(x){return x[1];});if(create_enabled&&!self.nodeOptions.no_quick_create&&search_val.length>0&&!_.contains(raw_result,search_val)){values.push({label:_.str.sprintf(_t('Create "<strong>%s</strong>"'),$('<span />').text(search_val).html()),action:self._quickCreate.bind(self,search_val),classname:'o_m2o_dropdown_option'});}
if(create_enabled&&!self.nodeOptions.no_create_edit){var createAndEditAction=function(){self.$('input').val('');return self._searchCreatePopup("form",false,self._createContext(search_val));};values.push({label:_t("Create and Edit..."),action:createAndEditAction,classname:'o_m2o_dropdown_option',});}else if(values.length===0){values.push({label:_t("No results to show..."),});}
def.resolve(values);});return def;},_searchCreatePopup:function(view,ids,context){var self=this;return new dialogs.SelectCreateDialog(this,_.extend({},this.nodeOptions,{res_model:this.field.relation,domain:this.record.getDomain({fieldName:this.name}),context:_.extend({},this.record.getContext(this.recordParams),context||{}),title:(view==='search'?_t("Search: "):_t("Create: "))+this.string,initial_ids:ids?_.map(ids,function(x){return x[0];}):undefined,initial_view:view,disable_multiple_selection:true,no_create:!self.can_create,on_selected:function(records){self.reinitialize(records[0]);self.activate();}})).open();},_updateExternalButton:function(){var has_external_button=!this.noOpen&&!this.floating&&this.isSet();this.$external_button.toggle(has_external_button);this.$el.toggleClass('o_with_button',has_external_button);},_onClick:function(event){var self=this;if(this.mode==='readonly'&&!this.noOpen){event.preventDefault();event.stopPropagation();this._rpc({model:this.field.relation,method:'get_formview_action',args:[[this.value.res_id]],context:this.record.getContext(this.recordParams),}).then(function(action){self.trigger_up('do_action',{action:action});});}},_onDialogClosedUnset:function(){this.isDirty=false;this.floating=false;this._render();},_onExternalButtonClick:function(){if(!this.value){this.activate();return;}
var self=this;var context=this.record.getContext(this.recordParams);this._rpc({model:this.field.relation,method:'get_formview_id',args:[[this.value.res_id]],context:context,}).then(function(view_id){new dialogs.FormViewDialog(self,{res_model:self.field.relation,res_id:self.value.res_id,context:context,title:_t("Open: ")+self.string,view_id:view_id,readonly:!self.can_write,on_saved:function(record,changed){if(changed){self._setValue(self.value.data,{forceChange:true});self.trigger_up('reload',{db_id:self.value.id});}},}).open();});},_onInputClick:function(){if(this.$input.autocomplete("widget").is(":visible")){this.$input.autocomplete("close");}else if(this.floating){this.$input.autocomplete("search");}else{this.$input.autocomplete("search",'');}},_onInputFocusout:function(){if(this.can_create&&this.floating){new M2ODialog(this,this.string,this.$input.val()).open();}},_onInputKeyup:function(ev){if(ev.which===$.ui.keyCode.ENTER||ev.which===$.ui.keyCode.TAB){return;}
this.isDirty=true;if(this.$input.val()===""){this.reinitialize(false);}else if(this._getDisplayName(this.m2o_value)!==this.$input.val()){this.floating=true;this._updateExternalButton();}},_onKeydown:function(){this.floating=false;this._super.apply(this,arguments);},_onNavigationMove:function(ev){basicFields.InputField.prototype._onNavigationMove.apply(this,arguments);if(this.mode==='edit'&&$(this.$input.autocomplete('widget')).is(':visible')){ev.stopPropagation();}},_onQuickCreate:function(event){this._quickCreate(event.data.value);},_onSearchCreatePopup:function(event){var data=event.data;this._searchCreatePopup(data.view_type,false,this._createContext(data.value));},});var ListFieldMany2One=FieldMany2One.extend({_renderReadonly:function(){this.$el.text(this.m2o_value);},_onInputFocusout:function(){if(this.can_create&&this.floating){var attachedEvents=['click','mousedown'];var stopNextClick=(function(ev){ev.stopPropagation();attachedEvents.forEach(function(eventName){window.removeEventListener(eventName,stopNextClick,true);});}).bind(this);attachedEvents.forEach(function(eventName){window.addEventListener(eventName,stopNextClick,true);});}
return this._super.apply(this,arguments);},});var KanbanFieldMany2One=AbstractField.extend({tagName:'span',init:function(){this._super.apply(this,arguments);this.m2o_value=this._formatValue(this.value);},_render:function(){this.$el.text(this.m2o_value);},});var FieldX2Many=AbstractField.extend({tagName:'div',custom_events:_.extend({},AbstractField.prototype.custom_events,{add_record:'_onAddRecord',discard_changes:'_onDiscardChanges',edit_line:'_onEditLine',field_changed:'_onFieldChanged',open_record:'_onOpenRecord',kanban_record_delete:'_onRemoveRecord',list_record_remove:'_onRemoveRecord',resequence:'_onResequence',save_line:'_onSaveLine',toggle_column_order:'_onToggleColumnOrder',activate_next_widget:'_onActiveNextWidget',navigation_move:'_onNavigationMove',}),resetOnAnyFieldChange:true,useSubview:true,init:function(parent,name,record,options){this._super.apply(this,arguments);this.nodeOptions=_.defaults(this.nodeOptions,{create_text:_t('Add'),});this.operations=[];this.isReadonly=this.mode==='readonly';this.view=this.attrs.views[this.attrs.mode];this.isMany2Many=this.field.type==='many2many'||this.attrs.widget==='many2many';this.activeActions={};this.recordParams={fieldName:this.name,viewType:this.viewType};var arch=this.view&&this.view.arch;if(arch){this.activeActions.create=arch.attrs.create?JSON.parse(arch.attrs.create):true;this.activeActions.delete=arch.attrs.delete?JSON.parse(arch.attrs.delete):true;this.editable=arch.attrs.editable;}
if(this.attrs.columnInvisibleFields){this._processColumnInvisibleFields();}},start:function(){return this._renderControlPanel().then(this._super.bind(this));},commitChanges:function(){var self=this;var inEditionRecordID=this.renderer&&this.renderer.viewType==="list"&&this.renderer.getEditableRecordID();if(inEditionRecordID){return this.renderer.commitChanges(inEditionRecordID).then(function(){return self._saveLine(inEditionRecordID);});}
return this._super.apply(this,arguments);},isSet:function(){return true;},reset:function(record,ev,fieldChanged){if(!fieldChanged){var newEval=this._evalColumnInvisibleFields();if(_.isEqual(this.currentColInvisibleFields,newEval)){return $.when();}}else if(ev&&ev.target===this&&ev.data.changes&&this.view.arch.tag==='tree'){var command=ev.data.changes[this.name];if(command.operation==='UPDATE'&&command.data){var state=record.data[this.name];var fieldNames=state.getFieldNames();this._reset(record,ev);return this.renderer.confirmUpdate(state,command.id,fieldNames,ev.initialEvent);}}
return this._super.apply(this,arguments);},getFocusableElement:function(){return(this.mode==='edit'&&this.$input)||this.$el;},activate:function(options){if(!this.activeActions.create||this.isReadonly||!this.$el.is(":visible")){return false;}
if(this.view.type==='kanban'){this.$buttons.find(".o-kanban-button-new").focus();}
if(this.view.arch.tag==='tree'){if(options&&options.noAutomaticCreate){this.renderer.$('.o_field_x2many_list_row_add a:first').focus();}else{this.renderer.$('.o_field_x2many_list_row_add a:first').click();}}
return true;},_evalColumnInvisibleFields:function(){var self=this;return _.mapObject(this.columnInvisibleFields,function(domains){return self.record.evalModifiers({column_invisible:domains,}).column_invisible;});},_getRenderer:function(){if(this.view.arch.tag==='tree'){return ListRenderer;}
if(this.view.arch.tag==='kanban'){return KanbanRenderer;}},_render:function(){if(!this.view){return this._super();}
if(this.renderer){this.currentColInvisibleFields=this._evalColumnInvisibleFields();this.renderer.updateState(this.value,{'columnInvisibleFields':this.currentColInvisibleFields});this.pager.updateState({size:this.value.count});return $.when();}
var arch=this.view.arch;var viewType;var rendererParams={arch:arch,};if(arch.tag==='tree'){viewType='list';this.currentColInvisibleFields=this._evalColumnInvisibleFields();_.extend(rendererParams,{editable:this.mode==='edit'&&arch.attrs.editable,addCreateLine:!this.isReadonly&&this.activeActions.create,addTrashIcon:!this.isReadonly&&this.activeActions.delete,isMany2Many:this.isMany2Many,columnInvisibleFields:this.currentColInvisibleFields,});}
if(arch.tag==='kanban'){viewType='kanban';var record_options={editable:false,deletable:false,read_only_mode:this.isReadonly,};_.extend(rendererParams,{record_options:record_options,});}
_.extend(rendererParams,{viewType:viewType,});var Renderer=this._getRenderer();this.renderer=new Renderer(this,this.value,rendererParams);this.$el.addClass('o_field_x2many o_field_x2many_'+viewType);return this.renderer?this.renderer.appendTo(this.$el):this._super();},_renderControlPanel:function(){if(!this.view){return $.when();}
var self=this;var defs=[];this.control_panel=new ControlPanel(this,"X2ManyControlPanel");this.pager=new Pager(this,this.value.count,this.value.offset+1,this.value.limit,{single_page_hidden:true,withAccessKey:false,validate:function(){var isList=self.view.arch.tag==='tree';return isList?self.renderer.unselectRow():$.when();},});this.pager.on('pager_changed',this,function(new_state){self.trigger_up('load',{id:self.value.id,limit:new_state.limit,offset:new_state.current_min-1,on_success:function(value){self.value=value;self._render();},});});this._renderButtons();defs.push(this.pager.appendTo($('<div>')));defs.push(this.control_panel.prependTo(this.$el));return $.when.apply($,defs).then(function(){self.control_panel.update({cp_content:{$buttons:self.$buttons,$pager:self.pager.$el,}});});},_renderButtons:function(){if(!this.isReadonly&&this.view.arch.tag==='kanban'){this.$buttons=$(qweb.render('KanbanView.buttons',{btnClass:'btn-secondary',create_text:this.nodeOptions.create_text,}));this.$buttons.on('click','button.o-kanban-button-new',this._onAddRecord.bind(this));}},_saveLine:function(recordID){var self=this;var def=$.Deferred();var fieldNames=this.renderer.canBeSaved(recordID);if(fieldNames.length){this.trigger_up('discard_changes',{recordID:recordID,onSuccess:def.resolve.bind(def),onFailure:def.reject.bind(def),});}else{this.renderer.setRowMode(recordID,'readonly').done(def.resolve.bind(def));}
return def.then(function(){self.pager.updateState({size:self.value.count});var newEval=self._evalColumnInvisibleFields();if(!_.isEqual(self.currentColInvisibleFields,newEval)){self.currentColInvisibleFields=newEval;self.renderer.updateState(self.value,{columnInvisibleFields:self.currentColInvisibleFields,});}});},_processColumnInvisibleFields:function(){var columnInvisibleFields={};_.each(this.attrs.columnInvisibleFields,function(domains,fieldName){if(_.isArray(domains)){columnInvisibleFields[fieldName]=_.map(domains,function(domain){if(_.isArray(domain)){return[domain[0].split('.')[1]].concat(domain.slice(1));}
return domain;});}});this.columnInvisibleFields=columnInvisibleFields;},_onAddRecord:function(){},_onRemoveRecord:function(ev){ev.stopPropagation();var operation=this.isMany2Many?'FORGET':'DELETE';this._setValue({operation:operation,ids:[ev.data.id],});},_onDiscardChanges:function(ev){if(ev.target!==this){ev.stopPropagation();this.trigger_up('discard_changes',_.extend({},ev.data,{fieldName:this.name}));}},_onEditLine:function(ev){ev.stopPropagation();this.trigger_up('edited_list',{id:this.value.id});var editedRecord=this.value.data[ev.data.index];this.renderer.setRowMode(editedRecord.id,'edit').done(ev.data.onSuccess);},_onFieldChanged:function(ev){if(ev.target===this){ev.initialEvent=this.lastInitialEvent;return;}
ev.stopPropagation();var changes=ev.data.changes;this.lastInitialEvent=undefined;if(Object.keys(changes).length){this.lastInitialEvent=ev;this._setValue({operation:'UPDATE',id:ev.data.dataPointID,data:changes,}).done(function(){if(ev.data.onSuccess){ev.data.onSuccess();}}).fail(function(){if(ev.data.onFailure){ev.data.onFailure();}});}},_onNavigationMove:function(ev){if(this.view.arch.tag==='tree'){var $curControl=this.renderer.$('.o_field_x2many_list_row_add a:focus');if($curControl.length){var $nextControl;if(ev.data.direction==='right'){$nextControl=$curControl.next('a');}else if(ev.data.direction==='left'){$nextControl=$curControl.prev('a');}
if($nextControl&&$nextControl.length){ev.stopPropagation();$nextControl.focus();return;}}}
this._super.apply(this,arguments);},_onOpenRecord:function(){},_onSaveLine:function(ev){var self=this;ev.stopPropagation();this.renderer.commitChanges(ev.data.recordID).then(function(){self.trigger_up('mutexify',{action:function(){return self._saveLine(ev.data.recordID).done(ev.data.onSuccess).fail(ev.data.onFailure);},});});},_onResequence:function(event){event.stopPropagation();var self=this;this.trigger_up('edited_list',{id:this.value.id});var rowIDs=event.data.rowIDs.slice();var rowID=rowIDs.pop();var defs=_.map(rowIDs,function(rowID,index){var data={};data[event.data.handleField]=event.data.offset+index;return self._setValue({operation:'UPDATE',id:rowID,data:data,},{notifyChange:false,});});$.when.apply($,defs).then(function(){self._setValue({operation:'UPDATE',id:rowID,data:_.object([event.data.handleField],[event.data.offset+rowIDs.length]),}).always(function(){self.trigger_up('toggle_column_order',{id:self.value.id,name:event.data.handleField,});});});},_onToggleColumnOrder:function(ev){ev.data.field=this.name;},_onActiveNextWidget:function(e){e.stopPropagation();this.renderer.unselectRow();this.trigger_up('navigation_move',{direction:'next'});},});var FieldOne2Many=FieldX2Many.extend({className:'o_field_one2many',supportedFieldTypes:['one2many'],init:function(){this._super.apply(this,arguments);this.creatingRecord=false;},reset:function(record,ev){var self=this;return this._super.apply(this,arguments).then(function(){if(ev&&ev.target===self&&ev.data.changes&&self.view.arch.tag==='tree'){if(ev.data.changes[self.name].operation==='CREATE'){var index=0;if(self.editable!=='top'){index=self.value.data.length-1;self.pager.updateState({size:self.value.count-1});}
var newID=self.value.data[index].id;self.renderer.editRecord(newID);}}});},_renderButtons:function(){if(this.activeActions.create){this._super.apply(this,arguments);}},_openFormDialog:function(params){var context=this.record.getContext(_.extend({},this.recordParams,{additionalContext:params.context}));this.trigger_up('open_one2many_record',_.extend(params,{domain:this.record.getDomain(this.recordParams),context:context,field:this.field,fields_view:this.attrs.views&&this.attrs.views.form,parentID:this.value.id,viewInfo:this.view,deletable:this.activeActions.delete,}));},_onAddRecord:function(ev){var self=this;var data=ev.data||{};ev.stopPropagation();if(this.editable||data.forceEditable){if(!this.activeActions.create){if(data.onFail){data.onFail();}}else if(!this.creatingRecord){this.creatingRecord=true;this.trigger_up('edited_list',{id:this.value.id});this._setValue({operation:'CREATE',position:this.editable||data.forceEditable,context:data.context,},{allowWarning:data.allowWarning}).always(function(){self.creatingRecord=false;}).done(function(){if(data.onSuccess){data.onSuccess();}});}}else{this._openFormDialog({context:data.context&&data.context[0],on_saved:function(record){self._setValue({operation:'ADD',id:record.id});},});}},_onOpenRecord:function(ev){var self=this;ev.stopPropagation();var id=ev.data.id;var onSaved=function(record){if(_.some(self.value.data,{id:record.id})){self._setValue({operation:'UPDATE',id:record.id});}else{self._setValue({operation:'ADD',id:record.id});}};this._openFormDialog({id:id,on_saved:onSaved,on_remove:function(){self._setValue({operation:'DELETE',ids:[id]});},deletable:this.activeActions.delete,readonly:this.mode==='readonly',});},});var FieldMany2Many=FieldX2Many.extend({className:'o_field_many2many',supportedFieldTypes:['many2many'],_onAddRecord:function(ev){var self=this;ev.stopPropagation();var domain=this.record.getDomain({fieldName:this.name});new dialogs.SelectCreateDialog(this,{res_model:this.field.relation,domain:domain.concat(["!",["id","in",this.value.res_ids]]),context:this.record.getContext(this.recordParams),title:_t("Add: ")+this.string,no_create:this.nodeOptions.no_create||!this.activeActions.create,fields_view:this.attrs.views.form,on_selected:function(records){var resIDs=_.pluck(records,'id');var newIDs=_.difference(resIDs,self.value.res_ids);if(newIDs.length){var values=_.map(newIDs,function(id){return{id:id};});self._setValue({operation:'ADD_M2M',ids:values,});}}}).open();},_onOpenRecord:function(ev){var self=this;_.extend(ev.data,{context:this.record.getContext(this.recordParams),domain:this.record.getDomain(this.recordParams),fields_view:this.attrs.views&&this.attrs.views.form,on_saved:function(){self._setValue({operation:'TRIGGER_ONCHANGE'},{forceChange:true});self.trigger_up('reload',{db_id:ev.data.id});},on_remove:function(){self._setValue({operation:'FORGET',ids:[ev.data.id]});},readonly:this.mode==='readonly',deletable:this.activeActions.delete,string:this.string,});},});var FieldMany2ManyBinaryMultiFiles=AbstractField.extend({template:"FieldBinaryFileUploader",template_files:"FieldBinaryFileUploader.files",supportedFieldTypes:['many2many'],fieldsToFetch:{name:{type:'char'},datas_fname:{type:'char'},mimetype:{type:'char'},},events:{'click .o_attach':'_onAttach','click .oe_delete':'_onDelete','change .o_input_file':'_onFileChanged',},init:function(){this._super.apply(this,arguments);if(this.field.type!=='many2many'||this.field.relation!=='ir.attachment'){var msg=_t("The type of the field '%s' must be a many2many field with a relation to 'ir.attachment' model.");throw _.str.sprintf(msg,this.field.string);}
this.uploadedFiles={};this.uploadingFiles=[];this.fileupload_id=_.uniqueId('oe_fileupload_temp');$(window).on(this.fileupload_id,this._onFileLoaded.bind(this));this.metadata={};},destroy:function(){this._super();$(window).off(this.fileupload_id);},_getFileUrl:function(attachment){return'/web/content/'+attachment.id+'?download=true';},_generatedMetadata:function(){var self=this;_.each(this.value.data,function(record){self.metadata[record.id]={allowUnlink:self.uploadedFiles[record.data.id]||false,url:self._getFileUrl(record.data),};});},_render:function(){this._generatedMetadata();this.$('.oe_placeholder_files, .oe_attachments').replaceWith($(qweb.render(this.template_files,{widget:this,})));this.$('.oe_fileupload').show();this.$('.o_image[data-mimetype^="image"]').each(function(){var $img=$(this);if(/gif|jpe|jpg|png/.test($img.data('mimetype'))&&$img.data('src')){$img.css('background-image',"url('"+$img.data('src')+"')");}});},_onAttach:function(){this.$('.o_input_file').click();},_onDelete:function(ev){ev.preventDefault();ev.stopPropagation();var fileID=$(ev.currentTarget).data('id');var record=_.findWhere(this.value.data,{res_id:fileID});if(record){this._setValue({operation:'FORGET',ids:[record.id],});var metadata=this.metadata[record.id];if(!metadata||metadata.allowUnlink){this._rpc({model:'ir.attachment',method:'unlink',args:[record.res_id],});}}},_onFileChanged:function(ev){var self=this;ev.stopPropagation();var files=ev.target.files;var attachment_ids=this.value.res_ids;if(files.length===0)
return;_.each(files,function(file){var record=_.find(self.value.data,function(attachment){return attachment.data.name===file.name;});if(record){var metadata=self.metadata[record.id];if(!metadata||metadata.allowUnlink){attachment_ids=_.without(attachment_ids,record.res_id);self._rpc({model:'ir.attachment',method:'unlink',args:[record.res_id],});}}
self.uploadingFiles.push(file);});this._setValue({operation:'REPLACE_WITH',ids:attachment_ids,});this.$('form.o_form_binary_form').submit();this.$('.oe_fileupload').hide();ev.target.value="";},_onFileLoaded:function(){var self=this;var files=Array.prototype.slice.call(arguments,1);this.uploadingFiles=[];var attachment_ids=this.value.res_ids;_.each(files,function(file){if(file.error){self.do_warn(_t('Uploading Error'),file.error);}else{attachment_ids.push(file.id);self.uploadedFiles[file.id]=true;}});this._setValue({operation:'REPLACE_WITH',ids:attachment_ids,});},});var FieldMany2ManyTags=AbstractField.extend({tag_template:"FieldMany2ManyTag",className:"o_field_many2manytags",supportedFieldTypes:['many2many'],custom_events:_.extend({},AbstractField.prototype.custom_events,{field_changed:'_onFieldChanged',}),events:_.extend({},AbstractField.prototype.events,{'click .o_delete':'_onDeleteTag',}),fieldsToFetch:{display_name:{type:'char'},},limit:1000,init:function(){this._super.apply(this,arguments);if(this.mode==='edit'){this.className+=' o_input';}
this.colorField=this.nodeOptions.color_field;this.hasDropdown=false;},activate:function(){return this.many2one?this.many2one.activate():false;},getFocusableElement:function(){return this.many2one?this.many2one.getFocusableElement():$();},isSet:function(){return!!this.value&&this.value.count;},reset:function(record,event){this._super.apply(this,arguments);if(event&&event.target===this){this.activate();}},_addTag:function(data){if(!_.contains(this.value.res_ids,data.id)){this._setValue({operation:'ADD_M2M',ids:data});}},_getRenderTagsContext:function(){var elements=this.value?_.pluck(this.value.data,'data'):[];return{colorField:this.colorField,elements:elements,hasDropdown:this.hasDropdown,readonly:this.mode==="readonly",};},_removeTag:function(id){var record=_.findWhere(this.value.data,{res_id:id});this._setValue({operation:'FORGET',ids:[record.id],});},_renderEdit:function(){var self=this;this._renderTags();if(this.many2one){this.many2one.destroy();}
this.many2one=new FieldMany2One(this,this.name,this.record,{mode:'edit',noOpen:true,viewType:this.viewType,attrs:this.attrs,});this.many2one.value=false;this.many2one.m2o_value='';this.many2one._getSearchBlacklist=function(){return self.value.res_ids;};return this.many2one.appendTo(this.$el);},_renderReadonly:function(){this._renderTags();},_renderTags:function(){this.$el.html(qweb.render(this.tag_template,this._getRenderTagsContext()));},_onDeleteTag:function(event){event.preventDefault();event.stopPropagation();this._removeTag($(event.target).parent().data('id'));},_onFieldChanged:function(ev){if(ev.target!==this.many2one){return;}
ev.stopPropagation();var newValue=ev.data.changes[this.name];if(newValue){this._addTag(newValue);this.many2one.reinitialize(false);}},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.BACKSPACE&&this.$('input').val()===""){var $badges=this.$('.badge');if($badges.length){this._removeTag($badges.last().data('id'));return;}}
this._super.apply(this,arguments);},_onQuickCreate:function(event){this._quickCreate(event.data.value);},});var FormFieldMany2ManyTags=FieldMany2ManyTags.extend({events:_.extend({},FieldMany2ManyTags.prototype.events,{'click .dropdown-toggle':'_onOpenColorPicker','mousedown .o_colorpicker a':'_onUpdateColor','mousedown .o_colorpicker .o_hide_in_kanban':'_onUpdateColor',}),init:function(){this._super.apply(this,arguments);this.hasDropdown=!!this.colorField;},_onOpenColorPicker:function(ev){ev.preventDefault();var tagID=$(ev.currentTarget).parent().data('id');var tagColor=$(ev.currentTarget).parent().data('color');var tag=_.findWhere(this.value.data,{res_id:tagID});if(tag&&this.colorField in tag.data){this.$color_picker=$(qweb.render('FieldMany2ManyTag.colorpicker',{'widget':this,'tag_id':tagID,}));$(ev.currentTarget).after(this.$color_picker);this.$color_picker.dropdown();this.$color_picker.attr("tabindex",1).focus();if(!tagColor){this.$('.custom-checkbox input').prop('checked',true);}}},_onUpdateColor:function(ev){ev.preventDefault();var $target=$(ev.currentTarget);var color=$target.data('color');var id=$target.data('id');var $tag=this.$(".badge[data-id='"+id+"']");var currentColor=$tag.data('color');var changes={};if($target.is('.o_hide_in_kanban')){var $checkbox=$('.o_hide_in_kanban .custom-checkbox input');$checkbox.prop('checked',!$checkbox.prop('checked'));this.prevColors=this.prevColors?this.prevColors:{};if($checkbox.is(':checked')){this.prevColors[id]=currentColor;}else{color=this.prevColors[id]?this.prevColors[id]:1;}}else if($target.is('[class^="o_tag_color"]')){if(color===currentColor){return;}}
changes[this.colorField]=color;this.trigger_up('field_changed',{dataPointID:_.findWhere(this.value.data,{res_id:id}).id,changes:changes,force_save:true,});},});var KanbanFieldMany2ManyTags=FieldMany2ManyTags.extend({events:AbstractField.prototype.events,_render:function(){var self=this;this.$el.empty().addClass('o_field_many2manytags o_kanban_tags');_.each(this.value.data,function(m2m){if(self.colorField in m2m.data&&!m2m.data[self.colorField]){return;}
$('<span>',{class:'o_tag o_tag_color_'+(m2m.data[self.colorField]||0),text:m2m.data.display_name,}).prepend('<span>').appendTo(self.$el);});},});var FieldMany2ManyCheckBoxes=AbstractField.extend({template:'FieldMany2ManyCheckBoxes',events:_.extend({},AbstractField.prototype.events,{change:'_onChange',}),specialData:"_fetchSpecialRelation",supportedFieldTypes:['many2many'],init:function(){this._super.apply(this,arguments);this.m2mValues=this.record.specialData[this.name];},isSet:function(){return true;},_renderCheckboxes:function(){var self=this;this.m2mValues=this.record.specialData[this.name];this.$el.html(qweb.render(this.template,{widget:this}));_.each(this.value.res_ids,function(id){self.$('input[data-record-id="'+id+'"]').prop('checked',true);});},_renderEdit:function(){this._renderCheckboxes();},_renderReadonly:function(){this._renderCheckboxes();this.$("input").prop("disabled",true);},_onChange:function(){var ids=_.map(this.$('input:checked'),function(input){return $(input).data("record-id");});this._setValue({operation:'REPLACE_WITH',ids:ids,});},});var FieldStatus=AbstractField.extend({className:'o_statusbar_status',events:{'click button:not(.dropdown-toggle)':'_onClickStage',},specialData:"_fetchSpecialStatus",supportedFieldTypes:['selection','many2one'],init:function(){this._super.apply(this,arguments);this._setState();this._onClickStage=_.debounce(this._onClickStage,300,true);this.isClickable=!!this.attrs.clickable||!!this.nodeOptions.clickable;},_reset:function(){this._super.apply(this,arguments);this._setState();},_setState:function(){var self=this;if(this.field.type==='many2one'){this.status_information=_.map(this.record.specialData[this.name],function(info){return _.extend({selected:info.id===self.value.res_id,},info);});}else{var selection=this.field.selection;if(this.attrs.statusbar_visible){var restriction=this.attrs.statusbar_visible.split(",");selection=_.filter(selection,function(val){return _.contains(restriction,val[0])||val[0]===self.value;});}
this.status_information=_.map(selection,function(val){return{id:val[0],display_name:val[1],selected:val[0]===self.value,fold:false};});}},_render:function(){var selections=_.partition(this.status_information,function(info){return(info.selected||!info.fold);});this.$el.html(qweb.render("FieldStatus.content",{selection_unfolded:selections[0],selection_folded:selections[1],clickable:this.isClickable,}));},_onClickStage:function(e){this._setValue($(e.currentTarget).data("value"));},});var FieldSelection=AbstractField.extend({template:'FieldSelection',specialData:"_fetchSpecialRelation",supportedFieldTypes:['selection'],events:_.extend({},AbstractField.prototype.events,{'change':'_onChange',}),init:function(){this._super.apply(this,arguments);this._setValues();},getFocusableElement:function(){return this.$el.is('select')?this.$el:$();},isSet:function(){return this.value!==false;},updateModifiersValue:function(){this._super.apply(this,arguments);if(!this.attrs.modifiersValue.invisible&&this.mode!=='readonly'){this._setValues();this._renderEdit();}},_renderEdit:function(){this.$el.empty();for(var i=0;i<this.values.length;i++){this.$el.append($('<option/>',{value:JSON.stringify(this.values[i][0]),text:this.values[i][1]}));}
var value=this.value;if(this.field.type==='many2one'&&value){value=value.data.id;}
this.$el.val(JSON.stringify(value));},_renderReadonly:function(){this.$el.empty().text(this._formatValue(this.value));},_reset:function(){this._super.apply(this,arguments);this._setValues();},_setValues:function(){if(this.field.type==='many2one'){this.values=this.record.specialData[this.name];this.formatType='many2one';}else{this.values=_.reject(this.field.selection,function(v){return v[0]===false&&v[1]==='';});}
if(!this.attrs.modifiersValue||!this.attrs.modifiersValue.required){this.values=[[false,this.attrs.placeholder||'']].concat(this.values);}},_onChange:function(){var res_id=JSON.parse(this.$el.val());if(this.field.type==='many2one'){var value=_.find(this.values,function(val){return val[0]===res_id;});this._setValue({id:res_id,display_name:value[1]});}else{this._setValue(res_id);}},});var FieldRadio=FieldSelection.extend({template:null,className:'o_field_radio',tagName:'span',specialData:"_fetchSpecialMany2ones",supportedFieldTypes:['selection','many2one'],events:_.extend({},AbstractField.prototype.events,{'click input':'_onInputClick',}),init:function(){this._super.apply(this,arguments);if(this.mode==='edit'){this.tagName='div';this.className+=this.nodeOptions.horizontal?' o_horizontal':' o_vertical';}
this.unique_id=_.uniqueId("radio");this._setValues();},isSet:function(){return true;},getFocusableElement:function(){var checked=this.$("[checked='true']");return checked.length?checked:this.$("[data-index='0']");},setIDForLabel:function(id){this.$el.attr('id',id);},_renderEdit:function(){var self=this;var currentValue;if(this.field.type==='many2one'){currentValue=this.value&&this.value.data.id;}else{currentValue=this.value;}
this.$el.empty();this.$el.attr('role','radiogroup').attr('aria-label',this.string);_.each(this.values,function(value,index){self.$el.append(qweb.render('FieldRadio.button',{checked:value[0]===currentValue,id:self.unique_id+'_'+value[0],index:index,name:self.unique_id,value:value,}));});},_reset:function(){this._super.apply(this,arguments);this._setValues();},_setValues:function(){if(this.field.type==='selection'){this.values=this.field.selection||[];}else if(this.field.type==='many2one'){this.values=_.map(this.record.specialData[this.name],function(val){return[val.id,val.display_name];});}},_onInputClick:function(event){var index=$(event.target).data('index');var value=this.values[index];if(this.field.type==='many2one'){this._setValue({id:value[0],display_name:value[1]});}else{this._setValue(value[0]);}},});var FieldSelectionBadge=FieldSelection.extend({template:null,className:'o_field_selection_badge',tagName:'span',specialData:"_fetchSpecialMany2ones",events:_.extend({},AbstractField.prototype.events,{'click span.o_selection_badge':'_onBadgeClicked',}),_renderEdit:function(){this.currentValue=this.value;if(this.field.type==='many2one'){this.currentValue=this.value&&this.value.data.id;}
this.$el.empty();this.$el.html(qweb.render('FieldSelectionBadge',{'values':this.values,'current_value':this.currentValue}));},_setValues:function(){if(this.field.type==='selection'){this.values=this.field.selection||[];}else if(this.field.type==='many2one'){this.values=_.map(this.record.specialData[this.name],function(val){return[val.id,val.display_name];});}},_onBadgeClicked:function(event){var index=$(event.target).data('index');var value=this.values[index];if(value[0]!==this.currentValue){if(this.field.type==='many2one'){this._setValue({id:value[0],display_name:value[1]});}else{this._setValue(value[0]);}}else{this._setValue(false);}},});var FieldReference=FieldMany2One.extend({specialData:"_fetchSpecialReference",supportedFieldTypes:['reference'],template:'FieldReference',events:_.extend({},FieldMany2One.prototype.events,{'change select':'_onSelectionChange',}),init:function(){this._super.apply(this,arguments);this.field=_.extend({},this.field);this._setState();},start:function(){this.$('select').val(this.field.relation);return this._super.apply(this,arguments);},getFocusableElement:function(){if(this.mode==='edit'&&!this.field.relation){return this.$('select');}
return this._super.apply(this,arguments);},_formatValue:function(){var value;if(this.field.type==='char'){value=this.record.specialData[this.name];}else{value=this.value;}
return value&&value.data&&value.data.display_name||'';},_renderEdit:function(){this._super.apply(this,arguments);if(this.$('select').val()){this.$('.o_input_dropdown').show();this.$el.addClass('o_row');}else{this.$('.o_input_dropdown').hide();}},_reset:function(){this._super.apply(this,arguments);var value=this.$('select').val();this._setState();this.$('select').val(this.value&&this.value.model||value);},_setRelation:function(model){this.field.relation=model;},_setState:function(){if(this.field.type==='char'){this.value=this.record.specialData[this.name];}
if(this.value){this._setRelation(this.value.model);}},_setValue:function(value,options){value=value||{};value.model=this.$('select').val();return this._super(value,options);},_onSelectionChange:function(){var value=this.$('select').val();this.reinitialize(false);this._setRelation(value);},});return{FieldMany2One:FieldMany2One,KanbanFieldMany2One:KanbanFieldMany2One,ListFieldMany2One:ListFieldMany2One,FieldOne2Many:FieldOne2Many,FieldMany2Many:FieldMany2Many,FieldMany2ManyBinaryMultiFiles:FieldMany2ManyBinaryMultiFiles,FieldMany2ManyCheckBoxes:FieldMany2ManyCheckBoxes,FieldMany2ManyTags:FieldMany2ManyTags,FormFieldMany2ManyTags:FormFieldMany2ManyTags,KanbanFieldMany2ManyTags:KanbanFieldMany2ManyTags,FieldRadio:FieldRadio,FieldSelectionBadge:FieldSelectionBadge,FieldSelection:FieldSelection,FieldStatus:FieldStatus,FieldReference:FieldReference,};});;

/* /web/static/src/js/fields/special_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web.special_fields',function(require){"use strict";var core=require('web.core');var field_utils=require('web.field_utils');var relational_fields=require('web.relational_fields');var FieldSelection=relational_fields.FieldSelection;var _t=core._t;var FieldTimezoneMismatch=FieldSelection.extend({start:function(){var interval=navigator.platform.toUpperCase().indexOf('MAC')>=0?60000:1000;this._datetime=setInterval(this._renderDateTimeTimezone.bind(this),interval);return this._super.apply(this,arguments);},destroy:function(){clearInterval(this._datetime);return this._super();},_render:function(){this._super.apply(this,arguments);this._renderTimezoneMismatch();},_renderDateTimeTimezone:function(){if(!this.mismatch){return;}
var offset=this.recordData.tz_offset.match(/([+-])([0-9]{2})([0-9]{2})/);offset=(offset[1]==='-'?-1:1)*(parseInt(offset[2])*60+parseInt(offset[3]));var datetime=field_utils.format.datetime(moment.utc().add(offset,'minutes'),this.field,{timezone:false});var content=this.$option.html().split(' ')[0];content+='    ('+datetime+')';this.$option.html(content);},_renderTimezoneMismatch:function(){this.$el.last().filter('.o_tz_warning').remove();this.$el=this.$el.first();var value=this.$el.val();if(this.$option){this.$option.html(this.$option.html().split(' ')[0]);}
var userOffset=this.recordData.tz_offset;this.mismatch=false;if(userOffset&&value!==""&&value!=="false"){var offset=-(new Date().getTimezoneOffset());var browserOffset=(offset<0)?"-":"+";browserOffset+=_.str.sprintf("%02d",Math.abs(offset/60));browserOffset+=_.str.sprintf("%02d",Math.abs(offset%60));this.mismatch=(browserOffset!==userOffset);}
if(this.mismatch){var $span=$('<span class="fa fa-exclamation-triangle o_tz_warning"/>');$span.insertAfter(this.$el);$span.attr('title',_t("Timezone Mismatch : The timezone of your browser doesn't match the selected one. The time in Odoo is displayed according to the timezone set on your user's preferences."));this.$el=this.$el.add($span);this.$option=this.$('option').filter(function(){return $(this).attr('value')===value;});this._renderDateTimeTimezone();}},_renderEdit:function(){var $otherEl=this.$el.not('select');this.$el=this.$el.first();this._super.apply(this,arguments);$otherEl.insertAfter(this.$el);this.$el=this.$el.add($otherEl);},});var FieldReportLayout=relational_fields.FieldMany2One.extend({events:_.extend({},relational_fields.FieldMany2One.prototype.events,{'click img':'_onImgClicked',}),willStart:function(){var self=this;this.previews={};return this._super().then(function(){return self._rpc({model:'report.layout',method:"search_read"}).then(function(values){self.previews=values;});});},_render:function(){var self=this;this.$el.empty();var value=_.isObject(this.value)?this.value.data.id:this.value;_.each(this.previews,function(val){var $container=$('<div>').addClass('col-3 text-center');var $img=$('<img>').addClass('img img-fluid img-thumbnail ml16').toggleClass('btn-info',val.view_id[0]===value).attr('src',val.image).data('key',val.view_id[0]);$container.append($img);if(val.pdf){var $previewLink=$('<a>').text('Preview').attr('href',val.pdf).attr('target','_blank');$container.append($previewLink);}
self.$el.append($container);});},_onImgClicked:function(event){this._setValue($(event.currentTarget).data('key'));},});return{FieldTimezoneMismatch:FieldTimezoneMismatch,FieldReportLayout:FieldReportLayout,};});;

/* /web/static/src/js/fields/upgrade_fields.js defined in bundle 'web.assets_backend' */
odoo.define('web.upgrade_widgets',function(require){"use strict";var AbstractField=require('web.AbstractField');var basic_fields=require('web.basic_fields');var core=require('web.core');var Dialog=require('web.Dialog');var field_registry=require('web.field_registry');var framework=require('web.framework');var relational_fields=require('web.relational_fields');var _t=core._t;var QWeb=core.qweb;var FieldBoolean=basic_fields.FieldBoolean;var FieldRadio=relational_fields.FieldRadio;var AbstractFieldUpgrade={_confirmUpgrade:function(){return this._rpc({model:'res.users',method:'search_count',args:[[["share","=",false]]],}).then(function(data){framework.redirect("https://www.odoo.com/odoo-enterprise/upgrade?num_users="+data);});},_insertEnterpriseLabel:function($enterpriseLabel){},_openDialog:function(){var message=$(QWeb.render('EnterpriseUpgrade'));var buttons=[{text:_t("Upgrade now"),classes:'btn-primary',close:true,click:this._confirmUpgrade.bind(this),},{text:_t("Cancel"),close:true,},];return new Dialog(this,{size:'medium',buttons:buttons,$content:$('<div>',{html:message,}),title:_t("Odoo Enterprise"),}).open();},_render:function(){this._super.apply(this,arguments);this._insertEnterpriseLabel($("<span>",{text:"Enterprise",'class':"badge badge-primary oe_inline o_enterprise_label"}));},_resetValue:function(){},_onInputClicked:function(event){if($(event.currentTarget).prop("checked")){this._openDialog().on('closed',this,this._resetValue.bind(this));}},};var UpgradeBoolean=FieldBoolean.extend(AbstractFieldUpgrade,{supportedFieldTypes:[],events:_.extend({},AbstractField.prototype.events,{'click input':'_onInputClicked',}),renderWithLabel:function($label){this.$label=$label;this._render();},_insertEnterpriseLabel:function($enterpriseLabel){var $el=this.$label||this.$el;$el.append('&nbsp;').append($enterpriseLabel);},_resetValue:function(){this.$input.prop("checked",false).change();},});var UpgradeRadio=FieldRadio.extend(AbstractFieldUpgrade,{supportedFieldTypes:[],events:_.extend({},FieldRadio.prototype.events,{'click input:last':'_onInputClicked',}),isSet:function(){return true;},_insertEnterpriseLabel:function($enterpriseLabel){this.$('label').last().append('&nbsp;').append($enterpriseLabel);},_resetValue:function(){this.$('input').first().prop("checked",true).click();},});field_registry.add('upgrade_boolean',UpgradeBoolean).add('upgrade_radio',UpgradeRadio);});;

/* /web/static/src/js/views/abstract_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractView',function(require){"use strict";var ajax=require('web.ajax');var Class=require('web.Class');var AbstractModel=require('web.AbstractModel');var AbstractRenderer=require('web.AbstractRenderer');var AbstractController=require('web.AbstractController');var utils=require('web.utils');var AbstractView=Class.extend({display_name:'',mobile_friendly:false,icon:'fa-question',multi_record:true,searchable:true,viewType:undefined,groupable:true,enableTimeRangeMenu:false,config:{Model:AbstractModel,Renderer:AbstractRenderer,Controller:AbstractController,},init:function(viewInfo,params){if(typeof viewInfo.arch==='string'){this.fieldsView=this._processFieldsView(viewInfo);}else{this.fieldsView=viewInfo;}
this.fields=this.fieldsView.viewFields;this.arch=this.fieldsView.arch;var isEmbedded=params.isEmbedded||false;var help=params.action&&params.action.help||"";var htmlHelp=document.createElement("div");htmlHelp.innerHTML=help;this.rendererParams={arch:this.arch,isEmbedded:isEmbedded,noContentHelp:htmlHelp.innerText.trim()?help:"",};var timeRangeMenuData=params.context.timeRangeMenuData;var timeRange=[];var comparisonTimeRange=[];var compare=false;var timeRangeDescription="";var comparisonTimeRangeDescription="";if(this.enableTimeRangeMenu&&timeRangeMenuData){timeRange=timeRangeMenuData.timeRange;comparisonTimeRange=timeRangeMenuData.comparisonTimeRange;compare=comparisonTimeRange.length>0;timeRangeDescription=timeRangeMenuData.timeRangeDescription;comparisonTimeRangeDescription=timeRangeMenuData.comparisonTimeRangeDescription;this.rendererParams.timeRangeDescription=timeRangeDescription;this.rendererParams.comparisonTimeRangeDescription=comparisonTimeRangeDescription;}
this.controllerParams={modelName:params.modelName,activeActions:{edit:this.arch.attrs.edit?JSON.parse(this.arch.attrs.edit):true,create:this.arch.attrs.create?JSON.parse(this.arch.attrs.create):true,delete:this.arch.attrs.delete?JSON.parse(this.arch.attrs.delete):true,duplicate:this.arch.attrs.duplicate?JSON.parse(this.arch.attrs.duplicate):true,},groupable:this.groupable,enableTimeRangeMenu:this.enableTimeRangeMenu,isEmbedded:isEmbedded,controllerID:params.controllerID,bannerRoute:this.arch.attrs.banner_route,};this.controllerParams.displayName=params.action&&(params.action.display_name||params.action.name);this.controllerParams.isMultiRecord=this.multi_record;this.controllerParams.searchable=this.searchable;this.controllerParams.searchView=params.action&&params.action.searchView;this.controllerParams.searchViewHidden=this.searchview_hidden;this.controllerParams.actionViews=params.action?params.action.views:[];this.controllerParams.viewType=this.viewType;this.controllerParams.withControlPanel=true;if(params.action&&params.action.flags){this.controllerParams.withControlPanel=!params.action.flags.headless;}else if('withControlPanel'in params){this.controllerParams.withControlPanel=params.withControlPanel;}
var groupBy=[];if(this.groupable){groupBy=params.groupBy;if(typeof groupBy==='string'){groupBy=[groupBy];}}
this.loadParams={context:params.context,count:params.count||((this.controllerParams.ids!==undefined)&&this.controllerParams.ids.length)||0,domain:params.domain,timeRange:timeRange,timeRangeDescription:timeRangeDescription,comparisonTimeRange:comparisonTimeRange,comparisonTimeRangeDescription:comparisonTimeRangeDescription,compare:compare,groupedBy:groupBy,modelName:params.modelName,res_id:params.currentId,res_ids:params.ids,orderedBy:params.context?params.context.orderedBy:[],};if(params.modelName){this.loadParams.modelName=params.modelName;}
var defaultOrder=this.arch.attrs.default_order;if(defaultOrder){this.loadParams.orderedBy=_.map(defaultOrder.split(','),function(order){order=order.trim().split(' ');return{name:order[0],asc:order[1]!=='desc'};});}
this.userContext=params.userContext;},getController:function(parent){var self=this;var alreadyHasModel=!!this.model;return $.when(this._loadData(parent),ajax.loadLibs(this)).then(function(){var state=self.model.get(arguments[0]);var renderer=self.getRenderer(parent,state);var Controller=self.Controller||self.config.Controller;var controllerParams=_.extend({initialState:state,},self.controllerParams);var controller=new Controller(parent,self.model,renderer,controllerParams);renderer.setParent(controller);if(!alreadyHasModel){self.model.setParent(controller);}
return controller;});},getModel:function(parent){if(!this.model){var Model=this.config.Model;this.model=new Model(parent);}
return this.model;},getRenderer:function(parent,state){var Renderer=this.config.Renderer;return new Renderer(parent,state,this.rendererParams);},setController:function(Controller){this.Controller=Controller;},_loadData:function(parent){var model=this.getModel(parent);return model.load(this.loadParams);},_processFieldsView:function(fieldsView){var fv=_.extend({},fieldsView);var doc=$.parseXML(fv.arch).documentElement;var stripWhitespaces=doc.nodeName.toLowerCase()!=='kanban';fv.arch=utils.xml_to_json(doc,stripWhitespaces);fv.viewFields=_.defaults({},fv.viewFields,fv.fields);return fv;},});return AbstractView;});odoo.define('web.viewUtils',function(){"use strict";var utils={getGroupValue:function(group,groupByField){var groupedByField=group.fields[groupByField];switch(groupedByField.type){case'many2one':return group.res_id||false;case'selection':var descriptor=_.findWhere(groupedByField.selection,group.value);return descriptor&&descriptor[0];default:return group.value;}},isQuickCreateEnabled:function(list){var groupByField=list.groupedBy[0]&&list.groupedBy[0].split(':')[0];if(!groupByField){return false;}
var availableTypes=['char','boolean','many2one','selection'];if(!_.contains(availableTypes,list.fields[groupByField].type)){return false;}
return true;},};return utils;});;

/* /web/static/src/js/views/abstract_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractRenderer',function(require){"use strict";var Widget=require('web.Widget');return Widget.extend({init:function(parent,state,params){this._super(parent);this.state=state;this.arch=params.arch;this.noContentHelp=params.noContentHelp;},start:function(){this.$el.addClass(this.arch.attrs.class);return $.when(this._render(),this._super());},on_attach_callback:function(){},on_detach_callback:function(){},getLocalState:function(){},giveFocus:function(){},setLocalState:function(localState){},updateState:function(state,params){this.state=state;return params.noRender?$.when():this._render();},_render:function(){return $.when();},});});;

/* /web/static/src/js/views/abstract_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractModel',function(require){"use strict";var Class=require('web.Class');var fieldUtils=require('web.field_utils');var mixins=require('web.mixins');var ServicesMixin=require('web.ServicesMixin');var AbstractModel=Class.extend(mixins.EventDispatcherMixin,ServicesMixin,{init:function(parent){mixins.EventDispatcherMixin.init.call(this);this.setParent(parent);},get:function(){},load:function(params){return $.when();},reload:function(params){return $.when();},_parseServerValue:function(field,value){if(field.type==='date'||field.type==='datetime'){value=fieldUtils.parse[field.type](value,field,{isUTC:true});}else if(field.type==='selection'&&value===false){var hasKey0=_.find(field.selection,function(option){return option[0]===0;});value=hasKey0?0:value;}
return value;},});return AbstractModel;});;

/* /web/static/src/js/views/abstract_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.AbstractController',function(require){"use strict";var ajax=require('web.ajax');var concurrency=require('web.concurrency');var config=require('web.config');var ControlPanelMixin=require('web.ControlPanelMixin');var core=require('web.core');var AbstractAction=require('web.AbstractAction');var session=require('web.session');var QWeb=core.qweb;var AbstractController=AbstractAction.extend(ControlPanelMixin,{custom_events:{open_record:'_onOpenRecord',switch_view:'_onSwitchView',},events:{'click a[type="action"]':'_onActionClicked',},init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.model=model;this.renderer=renderer;this.modelName=params.modelName;this.handle=params.handle;this.activeActions=params.activeActions;this.controllerID=params.controllerID;this.initialState=params.initialState;this.bannerRoute=params.bannerRoute;this.dp=new concurrency.DropPrevious();this.displayName=params.displayName;this.isMultiRecord=params.isMultiRecord;this.searchable=params.searchable;this.searchView=params.searchView;this.searchViewHidden=params.searchViewHidden;this.groupable=params.groupable;this.enableTimeRangeMenu=params.enableTimeRangeMenu;this.actionViews=params.actionViews;this.viewType=params.viewType;this.withControlPanel=params.withControlPanel!==false;this.need_control_panel=this.withControlPanel;},start:function(){var self=this;this.$el.addClass('o_view_controller');this.controlPanelElements=this._renderControlPanelElements();return $.when(this._super.apply(this,arguments),this.renderer.appendTo(this.$el)).then(function(){return self._update(self.initialState);});},destroy:function(){if(this.$buttons){this.$buttons.off();}
if(this.controlPanelElements&&this.controlPanelElements.$switch_buttons){this.controlPanelElements.$switch_buttons.off();}
return this._super.apply(this,arguments);},on_attach_callback:function(){if(this.searchView){this.searchView.on_attach_callback();}
this.renderer.on_attach_callback();},on_detach_callback:function(){this.renderer.on_detach_callback();},giveFocus:function(){this.renderer.giveFocus();},canBeRemoved:function(){return this.discardChanges(undefined,{readonlyIfRealDiscard:true});},discardChanges:function(recordID){return $.when();},getContext:function(){return{};},getTitle:function(){return this.displayName;},is_action_enabled:function(action){return this.activeActions[action];},reload:function(params){return this.update(params||{});},renderPager:function($node){},renderSidebar:function($node){},update:function(params,options){var self=this;var shouldReload=(options&&'reload'in options)?options.reload:true;var def=shouldReload?this.model.reload(this.handle,params):$.when();var cpUpdateIndex=this.cp_bus&&this.cp_bus.updateIndex;return this.dp.add(def).then(function(handle){if(self.cp_bus&&cpUpdateIndex!==self.cp_bus.updateIndex){return;}
self.handle=handle||self.handle;var state=self.model.get(self.handle);var localState=self.renderer.getLocalState();return self.dp.add(self.renderer.updateState(state,params)).then(function(){if(self.cp_bus&&cpUpdateIndex!==self.cp_bus.updateIndex){return;}
self.renderer.setLocalState(localState);return self._update(state);});});},_pushState:function(state){this.trigger_up('push_state',{controllerID:this.controllerID,state:state||{},});},_renderBanner:function(){if(this.bannerRoute!==undefined){var self=this;return this.dp.add(this._rpc({route:this.bannerRoute})).then(function(response){if(!response.html){self.$el.removeClass('o_has_banner');return $.when();}
self.$el.addClass('o_has_banner');var $banner=$(response.html);if(self._$banner&&self._$banner.remove){self._$banner.remove();}
var defs=[];$('link[rel="stylesheet"]',$banner).each(function(i,link){defs.push(ajax.loadCSS(link.href));link.remove();});$('script[type="text/javascript"]',$banner).each(function(i,js){defs.push(ajax.loadJS(js.src));js.remove();});return $.when.apply($,defs).then(function(){$banner.prependTo(self.$el);self._$banner=$banner;});});}
return $.when();},_renderControlPanelElements:function(){var elements={};if(this.withControlPanel){elements={$buttons:$('<div>'),$sidebar:$('<div>'),$pager:$('<div>'),};this.renderButtons(elements.$buttons);this.renderSidebar(elements.$sidebar);this.renderPager(elements.$pager);elements=_.mapObject(elements,function($node){return $node&&$node.contents();});elements.$switch_buttons=this._renderSwitchButtons();}
return elements;},_renderSwitchButtons:function(){var self=this;var views=_.filter(this.actionViews,{multiRecord:this.isMultiRecord});if(views.length<=1){return $();}
var template=config.device.isMobile?'ControlPanel.SwitchButtons.Mobile':'ControlPanel.SwitchButtons';var $switchButtons=$(QWeb.render(template,{views:views,}));_.each(views,function(view){$switchButtons.filter('.o_cp_switch_'+view.type).tooltip();});var $switchButtonsFiltered=config.device.isMobile?$switchButtons.find('button'):$switchButtons.filter('button');$switchButtonsFiltered.click(_.debounce(function(event){var viewType=$(event.target).data('view-type');self.trigger_up('switch_view',{view_type:viewType});},200,true));if(config.device.isMobile){var activeView=_.findWhere(views,{type:this.viewType});$switchButtons.find('.o_switch_view_button_icon').addClass('fa fa-lg '+activeView.icon);}
return $switchButtons;},_update:function(state){var cpContent=_.extend({},this.controlPanelElements);if(this.searchView){_.extend(cpContent,{$searchview:this.searchView.$el,$searchview_buttons:this.searchView.$buttons,});}
this.update_control_panel({active_view_selector:'.o_cp_switch_'+this.viewType,cp_content:cpContent,hidden:!this.withControlPanel,searchview:this.searchView,search_view_hidden:!this.searchable||this.searchviewHidden,groupable:this.groupable,enableTimeRangeMenu:this.enableTimeRangeMenu,});this._pushState();return this._renderBanner();},_onOpenRecord:function(event){event.stopPropagation();var record=this.model.get(event.data.id,{raw:true});this.trigger_up('switch_view',{view_type:'form',res_id:record.res_id,mode:event.data.mode||'readonly',model:this.modelName,});},_onActionClicked:function(event){var $target=$(event.currentTarget);var self=this;var model=$target.data('model');var method=$target.data('method');if(method!==undefined&&model!==undefined){var options={};if($target.data('reload-on-close')){options.on_close=function(){self.trigger_up('reload');};}
this.dp.add(this._rpc({model:model,method:method,context:session.user_context,})).then(function(action){if(action!==undefined){self.do_action(action,options);}});}else{this.do_action($target.attr('name'));}},_onSwitchView:function(event){event.data.controllerID=this.controllerID;},});return AbstractController;});;

/* /web/static/src/js/views/basic/basic_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.BasicModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var concurrency=require('web.concurrency');var Context=require('web.Context');var core=require('web.core');var Domain=require('web.Domain');var session=require('web.session');var utils=require('web.utils');var _t=core._t;var x2ManyCommands={CREATE:0,create:function(virtualID,values){delete values.id;return[x2ManyCommands.CREATE,virtualID||false,values];},UPDATE:1,update:function(id,values){delete values.id;return[x2ManyCommands.UPDATE,id,values];},DELETE:2,delete:function(id){return[x2ManyCommands.DELETE,id,false];},FORGET:3,forget:function(id){return[x2ManyCommands.FORGET,id,false];},LINK_TO:4,link_to:function(id){return[x2ManyCommands.LINK_TO,id,false];},DELETE_ALL:5,delete_all:function(){return[5,false,false];},REPLACE_WITH:6,replace_with:function(ids){return[6,false,ids];}};var BasicModel=AbstractModel.extend({OPEN_GROUP_LIMIT:10,noCacheModels:['ir.actions.act_window','ir.filters','ir.ui.view',],disableBatchedRPCs:false,init:function(){this.mutex=new concurrency.Mutex();this.batchedRPCsRequests=[];this.localData=Object.create(null);this._super.apply(this,arguments);},addDefaultRecord:function(listID,options){var self=this;var list=this.localData[listID];var context=this._getContext(list);var position=(options&&options.position)||'top';var params={context:context,fields:list.fields,fieldsInfo:list.fieldsInfo,parentID:list.id,position:position,viewType:list.viewType,};return this._makeDefaultRecord(list.model,params).then(function(id){list.count++;if(position==='top'){list.data.unshift(id);}else{list.data.push(id);}
var record=self.localData[id];list._cache[record.res_id]=id;return id;});},applyDefaultValues:function(recordID,values,options){options=options||{};var record=this.localData[recordID];var viewType=options.viewType||record.viewType;var fieldNames=options.fieldNames||Object.keys(record.fieldsInfo[viewType]);var field;var fieldName;record._changes=record._changes||{};values=_.pick(values,fieldNames);for(var i=0;i<fieldNames.length;i++){fieldName=fieldNames[i];if(!(fieldName in values)&&!(fieldName in record._changes)){field=record.fields[fieldName];if(field.type==='float'||field.type==='integer'||field.type==='monetary'){values[fieldName]=0;}else if(field.type==='one2many'||field.type==='many2many'){values[fieldName]=[];}else{values[fieldName]=null;}}}
var defs=[];for(fieldName in values){field=record.fields[fieldName];record.data[fieldName]=null;var dp;if(field.type==='many2one'&&values[fieldName]){dp=this._makeDataPoint({context:record.context,data:{id:values[fieldName]},modelName:field.relation,parentID:record.id,});record._changes[fieldName]=dp.id;}else if(field.type==='reference'&&values[fieldName]){var ref=values[fieldName].split(',');dp=this._makeDataPoint({context:record.context,data:{id:parseInt(ref[1])},modelName:ref[0],parentID:record.id,});defs.push(this._fetchNameGet(dp));record._changes[fieldName]=dp.id;}else if(field.type==='one2many'||field.type==='many2many'){defs.push(this._processX2ManyCommands(record,fieldName,values[fieldName],options));}else{record._changes[fieldName]=this._parseServerValue(field,values[fieldName]);}}
return $.when.apply($,defs);},applyRawChanges:function(recordID,viewType){var record=this.localData[recordID];return this._applyOnChange(record._rawChanges,record,viewType).then(function(){return record.id;});},_computeOverrideDefaultFields:function(listID,position){var list=this.localData[listID];var handleField;if(!list){return{};}
position=position||'bottom';if(!list.fieldsInfo){return{};}
for(var field in list.fieldsInfo.list){if(list.fieldsInfo.list[field].widget==='handle'){handleField=field;break;}}
if(!handleField){return{};}
var isOrderedByHandle=list.orderedBy&&list.orderedBy.length&&list.orderedBy[0].asc===true&&list.orderedBy[0].name===handleField;if(!isOrderedByHandle){return{};}
var computedList=this.get(list.id,{raw:true});if(!computedList||!computedList.data||!computedList.data.length){return{};}
var index=Math.min(computedList.data.length-1,position!=='top'?list.limit-1:0);var handleFieldValue=computedList.data[index].data[handleField];if(position==='top'){handleFieldValue--;}else if(list.count<=list.offset+list.limit-(list.tempLimitIncrement||0)){handleFieldValue++;}
return{field:handleField,value:handleFieldValue,};},deleteRecords:function(recordIds,modelName){var self=this;var records=_.map(recordIds,function(id){return self.localData[id];});var context=_.extend(records[0].getContext(),session.user_context);return this._rpc({model:modelName,method:'unlink',args:[_.pluck(records,'res_id')],context:context,}).then(function(){_.each(records,function(record){var parent=record.parentID&&self.localData[record.parentID];if(parent&&parent.type==='list'){parent.data=_.without(parent.data,record.id);delete self.localData[record.id];if(!parent.data.length&&parent.offset>0){parent.offset=Math.max(parent.offset-parent.limit,0);}}else{record.res_ids.splice(record.offset,1);record.offset=Math.min(record.offset,record.res_ids.length-1);record.res_id=record.res_ids[record.offset];record.count--;}});self._invalidateCache(records[0]);});},discardChanges:function(id,options){options=options||{};var element=this.localData[id];var isNew=this.isNew(id);var rollback='rollback'in options?options.rollback:isNew;var initialOffset=element.offset;element._domains={};this._visitChildren(element,function(elem){if(rollback&&elem._savePoint){if(elem._savePoint instanceof Array){elem._changes=elem._savePoint.slice(0);}else{elem._changes=_.extend({},elem._savePoint);}
elem._isDirty=!isNew;}else{elem._changes=null;elem._isDirty=false;}
elem.offset=0;if(elem.tempLimitIncrement){elem.limit-=elem.tempLimitIncrement;delete elem.tempLimitIncrement;}});element.offset=initialOffset;},duplicateRecord:function(recordID){var self=this;var record=this.localData[recordID];var context=this._getContext(record);return this._rpc({model:record.model,method:'copy',args:[record.data.id],context:context,}).then(function(res_id){var index=record.res_ids.indexOf(record.res_id);record.res_ids.splice(index+1,0,res_id);return self.load({fieldsInfo:record.fieldsInfo,fields:record.fields,modelName:record.model,res_id:res_id,res_ids:record.res_ids.slice(0),viewType:record.viewType,context:context,});});},get:function(id,options){var self=this;options=options||{};if(!(id in this.localData)){return null;}
var element=this.localData[id];if(options.env){var env={ids:element.res_ids?element.res_ids.slice(0):[],};if(element.type==='record'){env.currentId=this.isNew(element.id)?undefined:element.res_id;}
return env;}
if(element.type==='record'){var data=_.extend({},element.data,element._changes);var relDataPoint;for(var fieldName in data){var field=element.fields[fieldName];if(data[fieldName]===null){data[fieldName]=false;}
if(!field){continue;}
if(field.type==='many2one'){if(options.raw){relDataPoint=this.localData[data[fieldName]];data[fieldName]=relDataPoint?relDataPoint.res_id:false;}else{data[fieldName]=this.get(data[fieldName])||false;}}else if(field.type==='reference'){if(options.raw){relDataPoint=this.localData[data[fieldName]];data[fieldName]=relDataPoint?relDataPoint.model+','+relDataPoint.res_id:false;}else{data[fieldName]=this.get(data[fieldName])||false;}}else if(field.type==='one2many'||field.type==='many2many'){if(options.raw){relDataPoint=this.localData[data[fieldName]];relDataPoint=this._applyX2ManyOperations(relDataPoint);data[fieldName]=relDataPoint.res_ids;}else{data[fieldName]=this.get(data[fieldName])||[];}}}
var record={context:_.extend({},element.context),count:element.count,data:data,domain:element.domain.slice(0),evalModifiers:element.evalModifiers,fields:element.fields,fieldsInfo:element.fieldsInfo,getContext:element.getContext,getDomain:element.getDomain,getFieldNames:element.getFieldNames,id:element.id,isDirty:element.isDirty,limit:element.limit,model:element.model,offset:element.offset,ref:element.ref,res_ids:element.res_ids.slice(0),specialData:_.extend({},element.specialData),type:'record',viewType:element.viewType,};if(!this.isNew(element.id)){record.res_id=element.res_id;}
var evalContext;Object.defineProperty(record,'evalContext',{get:function(){evalContext=evalContext||self._getEvalContext(element);return evalContext;},});return record;}
element=this._applyX2ManyOperations(element);this._sortList(element);if(!element.orderedResIDs&&element._changes){_.each(element._changes,function(change){if(change.operation==='ADD'&&change.isNew){element.data=_.without(element.data,change.id);if(change.position==='top'){element.data.unshift(change.id);}else{element.data.push(change.id);}}});}
var list={aggregateValues:_.extend({},element.aggregateValues),context:_.extend({},element.context),count:element.count,data:_.map(element.data,function(elemID){return self.get(elemID,options);}),domain:element.domain.slice(0),fields:element.fields,getContext:element.getContext,getDomain:element.getDomain,getFieldNames:element.getFieldNames,groupedBy:element.groupedBy,id:element.id,isDirty:element.isDirty,isOpen:element.isOpen,limit:element.limit,model:element.model,offset:element.offset,orderedBy:element.orderedBy,res_id:element.res_id,res_ids:element.res_ids.slice(0),type:'list',value:element.value,viewType:element.viewType,};if(element.fieldsInfo){list.fieldsInfo=element.fieldsInfo;}
return list;},getName:function(id){var record=this.localData[id];if(record._changes&&'display_name'in record._changes){return record._changes.display_name;}
if('display_name'in record.data){return record.data.display_name;}
return _t("New");},canBeAbandoned:function(id){if(this.localData[id]._noAbandon){return false;}
var record=this.localData[id];var parent=this.localData[record.parentID];if(parent){var entry=_.findWhere(parent._savePoint,{operation:'ADD',id:id});if(entry){if(!entry.isNew){return false;}
var lastEntry=_.last(parent._savePoint);if(lastEntry.operation==='UPDATE'&&lastEntry.id===id){return false;}}}
return this.isNew(id);},isDirty:function(id){var isDirty=false;this._visitChildren(this.localData[id],function(r){if(r._isDirty){isDirty=true;}});return isDirty;},isNew:function(id){var data=this.localData[id];if(data.type!=="record"){return false;}
var res_id=data.res_id;if(typeof res_id==='number'){return false;}else if(typeof res_id==='string'&&/^[0-9]+-/.test(res_id)){return false;}
return true;},load:function(params){params.type=params.type||(params.res_id!==undefined?'record':'list');params.viewType=params.viewType||'default';if(!params.fieldsInfo){var fieldsInfo={};for(var fieldName in params.fieldNames){fieldsInfo[params.fieldNames[fieldName]]={};}
params.fieldsInfo={};params.fieldsInfo[params.viewType]=fieldsInfo;}
if(params.type==='record'&&params.res_id===undefined){params.allowWarning=true;return this._makeDefaultRecord(params.modelName,params);}
var dataPoint=this._makeDataPoint(params);return this._load(dataPoint).then(function(){return dataPoint.id;});},makeRecord:function(model,fields,fieldInfo){var self=this;var defs=[];var record_fields={};_.each(fields,function(field){record_fields[field.name]=_.pick(field,'type','relation','domain');});fieldInfo=fieldInfo||{};var fieldsInfo={};fieldsInfo.default={};_.each(fields,function(field){fieldsInfo.default[field.name]=fieldInfo[field.name]||{};});var record=this._makeDataPoint({modelName:model,fields:record_fields,fieldsInfo:fieldsInfo,viewType:'default',});_.each(fields,function(field){var dataPoint;record.data[field.name]=null;if(field.type==='many2one'){if(field.value){var id=_.isArray(field.value)?field.value[0]:field.value;var display_name=_.isArray(field.value)?field.value[1]:undefined;dataPoint=self._makeDataPoint({modelName:field.relation,data:{id:id,display_name:display_name,},parentID:record.id,});record.data[field.name]=dataPoint.id;if(display_name===undefined){defs.push(self._fetchNameGet(dataPoint));}}}else if(field.type==='one2many'||field.type==='many2many'){var relatedFieldsInfo={};relatedFieldsInfo.default={};_.each(field.fields,function(field){relatedFieldsInfo.default[field.name]={};});var dpParams={fieldsInfo:relatedFieldsInfo,modelName:field.relation,parentID:record.id,static:true,type:'list',viewType:'default',};var needLoad=false;if(field.value&&field.value.length){if(_.isObject(field.value[0])){dpParams.res_ids=_.pluck(field.value,'id');dataPoint=self._makeDataPoint(dpParams);_.each(field.value,function(data){var recordDP=self._makeDataPoint({data:data,modelName:field.relation,parentID:dataPoint.id,type:'record',});dataPoint.data.push(recordDP.id);dataPoint._cache[recordDP.res_id]=recordDP.id;});}else{dpParams.res_ids=field.value;dataPoint=self._makeDataPoint(dpParams);needLoad=true;}}else{dpParams.res_ids=[];dataPoint=self._makeDataPoint(dpParams);}
if(needLoad){defs.push(self._load(dataPoint));}
record.data[field.name]=dataPoint.id;}else if(field.value){record.data[field.name]=field.value;}});return $.when.apply($,defs).then(function(){return record.id;});},notifyChanges:function(record_id,changes,options){return this.mutex.exec(this._applyChange.bind(this,record_id,changes,options));},reload:function(id,options){return this.mutex.exec(this._reload.bind(this,id,options));},removeLine:function(elementID){var record=this.localData[elementID];var parent=this.localData[record.parentID];if(parent.static){parent._changes=_.filter(parent._changes,function(change){if(change.id===elementID&&change.operation==='ADD'&&parent.tempLimitIncrement){parent.tempLimitIncrement--;parent.limit--;}
return change.id!==elementID;});}else{parent.data=_.without(parent.data,elementID);parent.count--;}},resequence:function(modelName,resIDs,parentID,options){options=options||{};if((resIDs.length<=1)){return $.when(parentID);}
var self=this;var data=this.localData[parentID];var params={model:modelName,ids:resIDs,};if(options.offset){params.offset=options.offset;}
if(options.field){params.field=options.field;}
return this._rpc({route:'/web/dataset/resequence',params:params,}).then(function(wasResequenced){if(!wasResequenced){return $.when();}
var field=params.field?params.field:'sequence';return self._rpc({model:modelName,method:'read',args:[resIDs,[field]],}).then(function(records){if(data.data.length){var dataType=self.localData[data.data[0]].type;if(dataType==='record'){_.each(data.data,function(dataPoint){var recordData=self.localData[dataPoint].data;var inRecords=_.findWhere(records,{id:recordData.id});if(inRecords){recordData[field]=inRecords[field];}});data.data=_.sortBy(data.data,function(d){return self.localData[d].data[field];});}
if(dataType==='list'){data.data=_.sortBy(data.data,function(d){return _.indexOf(resIDs,self.localData[d].res_id)});}}
data.res_ids=[];_.each(data.data,function(d){var dataPoint=self.localData[d];if(dataPoint.type==='record'){data.res_ids.push(dataPoint.res_id);}else{data.res_ids=data.res_ids.concat(dataPoint.res_ids);}});self._updateParentResIDs(data);return parentID;})});},save:function(recordID,options){var self=this;return this.mutex.exec(function(){options=options||{};var record=self.localData[recordID];if(options.savePoint){self._visitChildren(record,function(rec){var newValue=rec._changes||rec.data;if(newValue instanceof Array){rec._savePoint=newValue.slice(0);}else{rec._savePoint=_.extend({},newValue);}});_.each((record._changes||{}),function(value,fieldName){record._editionViewType[fieldName]=options.viewType;});}
var shouldReload='reload'in options?options.reload:true;var method=self.isNew(recordID)?'create':'write';if(record._changes){delete record._changes.id;}
var changes=self._generateChanges(record,{viewType:options.viewType,changesOnly:method!=='create'});delete changes.id;if(method==='create'){var fieldNames=record.getFieldNames();_.each(fieldNames,function(name){if(changes[name]===null){delete changes[name];}});}
var def=$.Deferred();var changedFields=Object.keys(changes);if(options.savePoint){return def.resolve(changedFields);}
def.then(function(){record._isDirty=false;});if(method==='create'||changedFields.length){var args=method==='write'?[[record.data.id],changes]:[changes];self._rpc({model:record.model,method:method,args:args,context:record.getContext(),}).then(function(id){if(method==='create'){record.res_id=id;record.data.id=id;record.offset=record.res_ids.length;record.res_ids.push(id);record.count++;}
var _changes=record._changes;record._changes={};self._invalidateCache(record);self.unfreezeOrder(record.id);if(shouldReload){self._fetchRecord(record).then(function(){def.resolve(changedFields);});}else{_.extend(record.data,_changes);def.resolve(changedFields);}}).fail(def.reject.bind(def));}else{def.resolve(changedFields);}
return def;});},addFieldsInfo:function(recordID,viewInfo){var record=this.localData[recordID];record.fields=_.extend({},record.fields,viewInfo.fields);var fieldsInfo=_.mapObject(viewInfo.fieldsInfo,function(fieldsInfo){return _.defaults({},fieldsInfo,record.fieldsInfo[record.viewType]);});record.fieldsInfo=_.extend({},record.fieldsInfo,fieldsInfo);},freezeOrder:function(listID){var list=this.localData[listID];if(list.type==='record'){return;}
list=this._applyX2ManyOperations(list);this._sortList(list);this.localData[listID].orderedResIDs=list.res_ids;},setDirty:function(id){this.localData[id]._isDirty=true;},setSort:function(list_id,fieldName){var list=this.localData[list_id];if(list.type==='record'){return;}else if(list._changes){_.each(list._changes,function(change){delete change.isNew;});}
if(list.orderedBy.length===0){list.orderedBy.push({name:fieldName,asc:true});}else if(list.orderedBy[0].name===fieldName){if(!list.orderedResIDs){list.orderedBy[0].asc=!list.orderedBy[0].asc;}}else{var orderedBy=_.reject(list.orderedBy,function(o){return o.name===fieldName;});list.orderedBy=[{name:fieldName,asc:true}].concat(orderedBy);}
list.orderedResIDs=null;if(list.static){return this._fetchUngroupedList(list);}
return $.when();},toggleActive:function(recordIDs,value,parentID){var self=this;var parent=this.localData[parentID];var resIDs=_.map(recordIDs,function(recordID){return self.localData[recordID].res_id;});return this._rpc({model:parent.model,method:'write',args:[resIDs,{active:value}],}).then(function(){self._invalidateCache(parent);return self.reload(parentID);}).then(function(datapoint){if(parent&&parent.type==='list'&&!parent.data.length&&parent.offset>0){parent.offset=Math.max(parent.offset-parent.limit,0);return self.reload(parentID);}
return datapoint;});},toggleGroup:function(groupId){var self=this;var group=this.localData[groupId];if(group.isOpen){group.isOpen=false;group.data=[];group.res_ids=[];group.offset=0;this._updateParentResIDs(group);return $.when(groupId);}
if(!group.isOpen){group.isOpen=true;var def;if(group.count>0){def=this._load(group).then(function(){self._updateParentResIDs(group);});}
return $.when(def).then(function(){return groupId;});}},unfreezeOrder:function(elementID){var list=this.localData[elementID];if(list.type==='record'){var data=_.extend({},list.data,list._changes);for(var fieldName in data){var field=list.fields[fieldName];if(!field||!data[fieldName]){continue;}
if(field.type==='one2many'||field.type==='many2many'){var recordlist=this.localData[data[fieldName]];recordlist.orderedResIDs=null;for(var index in recordlist.data){this.unfreezeOrder(recordlist.data[index]);}}}
return;}
list.orderedResIDs=null;this._sortList(list);},_addX2ManyDefaultRecord:function(list,options){var self=this;var position=options&&options.position||'top';var params={fields:list.fields,fieldsInfo:list.fieldsInfo,parentID:list.id,position:position,viewType:list.viewType,allowWarning:options&&options.allowWarning};var additionalContexts=options&&options.context;var makeDefaultRecords=[];if(additionalContexts){_.each(additionalContexts,function(context){params.context=self._getContext(list,{additionalContext:context});makeDefaultRecords.push(self._makeDefaultRecord(list.model,params));});}else{params.context=self._getContext(list);makeDefaultRecords.push(self._makeDefaultRecord(list.model,params));}
return $.when.apply($,makeDefaultRecords).then(function(){var ids=[];_.each(arguments,function(id){ids.push(id);list._changes.push({operation:'ADD',id:id,position:position,isNew:true});var record=self.localData[id];list._cache[record.res_id]=id;if(list.orderedResIDs){var index=list.offset+(position!=='top'?list.limit:0);list.orderedResIDs.splice(index,0,record.res_id);self.localData[list.id].orderedResIDs=list.orderedResIDs;}});return ids;});},_applyChange:function(recordID,changes,options){var self=this;var record=this.localData[recordID];var field;var defs=[];options=options||{};record._changes=record._changes||{};if(!options.doNotSetDirty){record._isDirty=true;}
var initialData={};this._visitChildren(record,function(elem){initialData[elem.id]=$.extend(true,{},_.pick(elem,'data','_changes'));});for(var fieldName in changes){field=record.fields[fieldName];if(field&&(field.type==='one2many'||field.type==='many2many')){defs.push(this._applyX2ManyChange(record,fieldName,changes[fieldName],options.viewType,options.allowWarning));}else if(field&&(field.type==='many2one'||field.type==='reference')){defs.push(this._applyX2OneChange(record,fieldName,changes[fieldName]));}else{record._changes[fieldName]=changes[fieldName];}}
if(options.notifyChange===false){return $.Deferred().resolve(_.keys(changes));}
return $.when.apply($,defs).then(function(){var onChangeFields=[];for(var fieldName in changes){field=record.fields[fieldName];if(field&&field.onChange){var isX2Many=field.type==='one2many'||field.type==='many2many';if(!isX2Many||(self._isX2ManyValid(record._changes[fieldName]||record.data[fieldName]))){onChangeFields.push(fieldName);}}}
var onchangeDef=$.Deferred();if(onChangeFields.length){self._performOnChange(record,onChangeFields,options.viewType).then(function(result){delete record._warning;onchangeDef.resolve(_.keys(changes).concat(Object.keys(result&&result.value||{})));}).fail(function(){self._visitChildren(record,function(elem){_.extend(elem,initialData[elem.id]);});if(!options.force_fail){onchangeDef.resolve({});}else{onchangeDef.reject({});}});}else{onchangeDef=$.Deferred().resolve(_.keys(changes));}
return onchangeDef.then(function(fieldNames){_.each(fieldNames,function(name){if(record._changes&&record._changes[name]===record.data[name]){delete record._changes[name];record._isDirty=!_.isEmpty(record._changes);}});return self._fetchSpecialData(record).then(function(fieldNames2){return _.union(fieldNames,fieldNames2);});});});},_applyX2OneChange:function(record,fieldName,data){var self=this;if(!data||!data.id){record._changes[fieldName]=false;return $.when();}
var relatedID;if(record._changes&&fieldName in record._changes){relatedID=record._changes[fieldName];}else{relatedID=record.data[fieldName];}
var relatedRecord=this.localData[relatedID];if(relatedRecord&&(data.id===this.localData[relatedID].res_id)){return $.when();}
var rel_data=_.pick(data,'id','display_name');var field=record.fields[fieldName];var coModel=field.type==='reference'?data.model:field.relation;var def;if(rel_data.display_name===undefined){def=this._rpc({model:coModel,method:'name_get',args:[data.id],context:record.context,}).then(function(result){rel_data.display_name=result[0][1];});}
return $.when(def).then(function(){var rec=self._makeDataPoint({context:record.context,data:rel_data,fields:{},fieldsInfo:{},modelName:coModel,parentID:record.id,});record._changes[fieldName]=rec.id;});},_applyOnChange:function(values,record,viewType){var self=this;var defs=[];var rec;viewType=viewType||record.viewType;record._changes=record._changes||{};_.each(values,function(val,name){var field=record.fields[name];if(!field){record._rawChanges[name]=val;return;}
if(record._rawChanges[name]){delete record._rawChanges[name];}
var oldValue=name in record._changes?record._changes[name]:record.data[name];var id;if(field.type==='many2one'){id=false;if(val){var data=_.isArray(val)?{id:val[0],display_name:val[1]}:{id:val};if(!oldValue||(self.localData[oldValue].res_id!==data.id)){rec=self._makeDataPoint({context:record.context,data:data,modelName:field.relation,parentID:record.id,});id=rec.id;record._changes[name]=id;}}else{record._changes[name]=false;}}else if(field.type==='reference'){id=false;if(val){var ref=val.split(',');var modelName=ref[0];var resID=parseInt(ref[1]);if(!oldValue||self.localData[oldValue].res_id!==resID||self.localData[oldValue].model!==modelName){rec=self._makeDataPoint({context:record.context,data:{id:parseInt(ref[1])},modelName:modelName,parentID:record.id,});defs.push(self._fetchNameGet(rec));id=rec.id;record._changes[name]=id;}}else{record._changes[name]=id;}}else if(field.type==='one2many'||field.type==='many2many'){var listId=record._changes[name]||record.data[name];var list;if(listId){list=self.localData[listId];}else{var fieldInfo=record.fieldsInfo[viewType][name];if(!fieldInfo){return;}
var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];list=self._makeDataPoint({fields:view?view.fields:fieldInfo.relatedFields,fieldsInfo:view?view.fieldsInfo:fieldInfo.fieldsInfo,limit:fieldInfo.limit,modelName:field.relation,parentID:record.id,static:true,type:'list',viewType:view?view.type:fieldInfo.viewType,});}
record._changes[name]=list.id;list._changes=list._changes||[];var oldChanges=list._changes;_.each(val,function(command){var rec,recID;if(command[0]===0||command[0]===1){if(command[0]===0&&command[1]){var previousChange=_.find(oldChanges,function(operation){var child=self.localData[operation.id];return child&&(child.res_id===command[1]);});recID=previousChange&&previousChange.id;rec=self.localData[recID];}
if(command[0]===1&&command[1]){rec=self.localData[list._cache[command[1]]];}
if(!rec){var params={context:list.context,fields:list.fields,fieldsInfo:list.fieldsInfo,modelName:list.model,parentID:list.id,viewType:list.viewType,ref:command[1],};if(command[0]===1){params.res_id=command[1];}
rec=self._makeDataPoint(params);list._cache[rec.res_id]=rec.id;}
rec._noAbandon=!list._savePoint;list._changes.push({operation:'ADD',id:rec.id});if(command[0]===1){list._changes.push({operation:'UPDATE',id:rec.id});}
defs.push(self._applyOnChange(command[2],rec));}else if(command[0]===4){linkRecord(list,command[1]);}else if(command[0]===5){list._changes=[{operation:'REMOVE_ALL'}];}else if(command[0]===6){list._changes=[{operation:'REMOVE_ALL'}];_.each(command[2],function(resID){linkRecord(list,resID);});}});var def=self._readUngroupedList(list).then(function(){var x2ManysDef=self._fetchX2ManysBatched(list);var referencesDef=self._fetchReferencesBatched(list);return $.when(x2ManysDef,referencesDef);});defs.push(def);}else{var newValue=self._parseServerValue(field,val);if(newValue!==oldValue){record._changes[name]=newValue;}}});return $.when.apply($,defs);function linkRecord(list,resID){rec=self.localData[list._cache[resID]];if(rec){self.discardChanges(rec.id);}
list._changes.push({operation:'ADD',id:rec?rec.id:null,resID:resID,});}},_applyX2ManyChange:function(record,fieldName,command,viewType,allowWarning){if(command.operation==='TRIGGER_ONCHANGE'){return $.when();}
var self=this;var localID=(record._changes&&record._changes[fieldName])||record.data[fieldName];var list=this.localData[localID];var field=record.fields[fieldName];var fieldInfo=record.fieldsInfo[viewType||record.viewType][fieldName];var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var def,rec;var defs=[];list._changes=list._changes||[];switch(command.operation){case'ADD':var newRecord=this.localData[command.id];_.defaults(list.fields,newRecord.fields);_.defaults(list.fieldsInfo,newRecord.fieldsInfo);newRecord.fields=list.fields;newRecord.fieldsInfo=list.fieldsInfo;newRecord.viewType=list.viewType;list._cache[newRecord.res_id]=newRecord.id;list._changes.push(command);break;case'ADD_M2M':list._forceM2MLink=true;var data=_.isArray(command.ids)?command.ids:[command.ids];if(data.length+list.res_ids.length>list.limit){list.limit=data.length+list.res_ids.length;}
var list_records={};_.each(data,function(d){rec=self._makeDataPoint({context:record.context,modelName:field.relation,fields:view?view.fields:fieldInfo.relatedFields,fieldsInfo:view?view.fieldsInfo:fieldInfo.fieldsInfo,res_id:d.id,data:d,viewType:view?view.type:fieldInfo.viewType,parentID:list.id,});list_records[d.id]=rec;list._cache[rec.res_id]=rec.id;list._changes.push({operation:'ADD',id:rec.id});});var fieldNames=list.getFieldNames();if(fieldNames.length){def=this._rpc({model:list.model,method:'read',args:[_.pluck(data,'id'),fieldNames],context:_.extend({},record.context,field.context),}).then(function(records){_.each(records,function(record){list_records[record.id].data=record;self._parseServerData(fieldNames,list,record);});return $.when(self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list));});defs.push(def);}
break;case'CREATE':var options={context:command.context,position:command.position,allowWarning:allowWarning};def=this._addX2ManyDefaultRecord(list,options).then(function(ids){_.each(ids,function(id){if(command.position==='bottom'&&list.orderedResIDs&&list.orderedResIDs.length>=list.limit){list.tempLimitIncrement=(list.tempLimitIncrement||0)+1;list.limit+=1;}
if(command.data){return self._applyChange(id,command.data);}});});defs.push(def);break;case'UPDATE':list._changes.push({operation:'UPDATE',id:command.id});if(command.data){defs.push(this._applyChange(command.id,command.data));}
break;case'FORGET':list._forceM2MUnlink=true;case'DELETE':var idsToRemove=command.ids;list._changes=_.reject(list._changes,function(change,index){var idInCommands=_.contains(command.ids,change.id);if(idInCommands&&change.operation==='ADD'){idsToRemove=_.without(idsToRemove,change.id);}
return idInCommands;});_.each(idsToRemove,function(id){var operation=list._forceM2MUnlink?'FORGET':'DELETE';list._changes.push({operation:operation,id:id});});break;case'REPLACE_WITH':list._changes=[];var newIds=_.difference(command.ids,list.res_ids);var removedIds=_.difference(list.res_ids,command.ids);var addDef,removedDef,values;if(newIds.length){values=_.map(newIds,function(id){return{id:id};});addDef=this._applyX2ManyChange(record,fieldName,{operation:'ADD_M2M',ids:values},viewType);}
if(removedIds.length){var listData=_.map(list.data,function(localId){return self.localData[localId];});removedDef=this._applyX2ManyChange(record,fieldName,{operation:'DELETE',ids:_.map(removedIds,function(resID){if(resID in list._cache){return list._cache[resID];}
return _.findWhere(listData,{res_id:resID}).id;}),},viewType);}
return $.when(addDef,removedDef);}
return $.when.apply($,defs).then(function(){return self._readUngroupedList(list).then(function(){return self._fetchX2ManysBatched(list);});});},_applyX2ManyOperations:function(list,options){if(!list.static){return list;}
var self=this;list=_.extend({},list);list.res_ids=list.res_ids.slice(0);var changes=list._changes||[];if(options){var to=options.to===0?0:(options.to||changes.length);changes=changes.slice(options.from||0,to);}
_.each(changes,function(change){var relRecord;if(change.id){relRecord=self.localData[change.id];}
switch(change.operation){case'ADD':list.count++;var resID=relRecord?relRecord.res_id:change.resID;if(change.position==='top'&&(options?options.position!=='bottom':true)){list.res_ids.unshift(resID);}else{list.res_ids.push(resID);}
break;case'FORGET':case'DELETE':list.count--;list.res_ids=_.without(list.res_ids,relRecord.res_id);break;case'REMOVE_ALL':list.count=0;list.res_ids=[];break;case'UPDATE':break;}});this._setDataInRange(list);return list;},_buildOnchangeSpecs:function(record,viewType){var hasOnchange=false;var specs={};var fieldsInfo=record.fieldsInfo[viewType||record.viewType];generateSpecs(fieldsInfo,record.fields);function generateSpecs(fieldsInfo,fields,prefix){prefix=prefix||'';_.each(Object.keys(fieldsInfo),function(name){var field=fields[name];var fieldInfo=fieldsInfo[name];var key=prefix+name;specs[key]=(field.onChange)||"";if(field.onChange){hasOnchange=true;}
_.each(fieldInfo.views,function(view){generateSpecs(view.fieldsInfo[view.type],view.fields,key+'.');});});}
return hasOnchange?specs:false;},_evalModifiers:function(element,modifiers){var result={};var self=this;var evalContext;function evalModifier(mod){if(mod===undefined||mod===false||mod===true){return!!mod;}
evalContext=evalContext||self._getEvalContext(element);return new Domain(mod,evalContext).compute(evalContext);}
if('invisible'in modifiers){result.invisible=evalModifier(modifiers.invisible);}
if('column_invisible'in modifiers){result.column_invisible=evalModifier(modifiers.column_invisible);}
if('readonly'in modifiers){result.readonly=evalModifier(modifiers.readonly);}
if('required'in modifiers){result.required=evalModifier(modifiers.required);}
return result;},_fetchMany2OneGroup:function(groups){var ids=_.uniq(_.pluck(_.pluck(groups,'record'),'res_id'));return this._rpc({model:groups[0].record.model,method:'name_get',args:[ids],context:groups[0].context}).then(function(name_gets){_.each(groups,function(obj){var nameGet=_.find(name_gets,function(n){return n[0]===obj.record.res_id;});obj.record.data.display_name=nameGet[1];});});},_fetchNameGet:function(dataPoint){return this._rpc({model:dataPoint.model,method:'name_get',args:[dataPoint.res_id],context:dataPoint.getContext(),}).then(function(result){dataPoint.data.display_name=result[0][1];});},_fetchNameGets:function(list,fieldName){var self=this;var model=list.fields[fieldName].relation;var records=[];var ids=[];list=this._applyX2ManyOperations(list);_.each(list.data,function(localId){var record=self.localData[localId];var data=record._changes||record.data;var many2oneId=data[fieldName];if(!many2oneId){return;}
var many2oneRecord=self.localData[many2oneId];records.push(many2oneRecord);ids.push(many2oneRecord.res_id);model=many2oneRecord.model;});if(!ids.length){return $.when();}
return this._rpc({model:model,method:'name_get',args:[_.uniq(ids)],context:list.context,}).then(function(name_gets){_.each(records,function(record){var nameGet=_.find(name_gets,function(nameGet){return nameGet[0]===record.data.id;});record.data.display_name=nameGet[1];});});},_fetchRecord:function(record,options){var self=this;options=options||{};var fieldNames=options.fieldNames||record.getFieldNames(options);fieldNames=_.uniq(fieldNames.concat(['display_name']));return this._rpc({model:record.model,method:'read',args:[[record.res_id],fieldNames],context:_.extend({},record.getContext(),{bin_size:true}),}).then(function(result){if(result.length===0){return $.Deferred().reject();}
result=result[0];record.data=_.extend({},record.data,result);}).then(function(){self._parseServerData(fieldNames,record,record.data);}).then(function(){return $.when(self._fetchX2Manys(record,options),self._fetchReferences(record,options)).then(function(){return self._postprocess(record,options);});});},_fetchReference:function(record,fieldName){var self=this;var def;var value=record._changes&&record._changes[fieldName]||record.data[fieldName];var model=value&&value.split(',')[0];var resID=value&&parseInt(value.split(',')[1]);if(model&&model!=='False'&&resID){def=self._rpc({model:model,method:'name_get',args:[resID],context:record.getContext({fieldName:fieldName}),}).then(function(result){return self._makeDataPoint({data:{id:result[0][0],display_name:result[0][1],},modelName:model,parentID:record.id,});});}
return $.when(def);},_fetchReferences:function(record,options){var self=this;var defs=[];var fieldNames=options&&options.fieldNames||record.getFieldNames();_.each(fieldNames,function(fieldName){var field=record.fields[fieldName];if(field.type==='reference'){var def=self._fetchReference(record,fieldName).then(function(dataPoint){if(dataPoint){record.data[fieldName]=dataPoint.id;}});defs.push(def);}});return $.when.apply($,defs);},_fetchReferenceBatched:function(list,fieldName){var self=this;list=this._applyX2ManyOperations(list);var toFetch={};_.each(list.data,function(dataPoint){var record=self.localData[dataPoint];var value=record.data[fieldName];if(value&&!self.localData[value]){var model=value.split(',')[0];var resID=value.split(',')[1];if(!(model in toFetch)){toFetch[model]={};}
if(toFetch[model][resID]){toFetch[model][resID].push(dataPoint);}else{toFetch[model][resID]=[dataPoint];}}});var defs=[];var def;_.each(toFetch,function(datapoints,model){var ids=_.map(Object.keys(datapoints),function(id){return parseInt(id);});var parent=datapoints[ids[0]][0];def=self._rpc({model:model,method:'name_get',args:[ids],context:self.localData[parent].getContext({fieldName:fieldName}),}).then(function(result){_.each(result,function(el){var parentIDs=datapoints[el[0]];_.each(parentIDs,function(parentID){var parent=self.localData[parentID];var referenceDp=self._makeDataPoint({data:{id:el[0],display_name:el[1],},modelName:model,parentID:parent,});parent.data[fieldName]=referenceDp.id;});});});defs.push(def);});return $.when.apply($,defs);},_fetchReferencesBatched:function(list){var defs=[];var fieldNames=list.getFieldNames();for(var i=0;i<fieldNames.length;i++){var field=list.fields[fieldNames[i]];if(field.type==='reference'){defs.push(this._fetchReferenceBatched(list,fieldNames[i]));}}
return $.when.apply($,defs);},_fetchRelationalData:function(record){var self=this;var toBeFetched=[];_.each(record.getFieldNames(),function(name){var field=record.fields[name];if(field.type==='many2one'&&!record.fieldsInfo[record.viewType][name].__no_fetch){var localId=(record._changes&&record._changes[name])||record.data[name];var relatedRecord=self.localData[localId];if(!relatedRecord||relatedRecord.data.display_name){return;}
toBeFetched.push({context:record.getContext({fieldName:name,viewType:record.viewType}),record:relatedRecord});}});var groups=_.groupBy(toBeFetched,function(elem){return[elem.record.model,JSON.stringify(elem.context)].join();});return $.when.apply($,_.map(groups,this._fetchMany2OneGroup.bind(this)));},_fetchSpecialData:function(record,options){var self=this;var specialFieldNames=[];var fieldNames=(options&&options.fieldNames)||record.getFieldNames();return $.when.apply($,_.map(fieldNames,function(name){var viewType=(options&&options.viewType)||record.viewType;var fieldInfo=record.fieldsInfo[viewType][name]||{};var Widget=fieldInfo.Widget;if(Widget&&Widget.prototype.specialData){return self[Widget.prototype.specialData](record,name,fieldInfo).then(function(data){if(data===undefined){return;}
record.specialData[name]=data;specialFieldNames.push(name);});}})).then(function(){return specialFieldNames;});},_fetchSpecialMany2ones:function(record,fieldName,fieldInfo,fieldsToRead){var field=record.fields[fieldName];if(field.type!=="many2one"){return $.when();}
var context=record.getContext({fieldName:fieldName});var domain=record.getDomain({fieldName:fieldName});if(domain.length){var localID=(record._changes&&fieldName in record._changes)?record._changes[fieldName]:record.data[fieldName];if(localID){var element=this.localData[localID];domain=["|",["id","=",element.data.id]].concat(domain);}}
var hasChanged=this._saveSpecialDataCache(record,fieldName,{context:context,domain:domain,});if(!hasChanged){return $.when();}
var self=this;return this._rpc({model:field.relation,method:'search_read',fields:["id"].concat(fieldsToRead||[]),context:context,domain:domain,}).then(function(records){var ids=_.pluck(records,'id');return self._rpc({model:field.relation,method:'name_get',args:[ids],context:context,}).then(function(name_gets){_.each(records,function(rec){var name_get=_.find(name_gets,function(n){return n[0]===rec.id;});rec.display_name=name_get[1];});return records;});});},_fetchSpecialRelation:function(record,fieldName){var field=record.fields[fieldName];if(!_.contains(["many2one","many2many","one2many"],field.type)){return $.when();}
var context=record.getContext({fieldName:fieldName});var domain=record.getDomain({fieldName:fieldName});var hasChanged=this._saveSpecialDataCache(record,fieldName,{context:context,domain:domain,});if(!hasChanged){return $.when();}
return this._rpc({model:field.relation,method:'name_search',args:["",domain],context:context});},_fetchSpecialReference:function(record,fieldName){var def;var field=record.fields[fieldName];if(field.type==='char'){def=this._fetchReference(record,fieldName);}
return $.when(def);},_fetchSpecialStatus:function(record,fieldName,fieldInfo){var foldField=fieldInfo.options.fold_field;var fieldsToRead=foldField?[foldField]:[];return this._fetchSpecialMany2ones(record,fieldName,fieldInfo,fieldsToRead).then(function(m2os){_.each(m2os,function(m2o){m2o.fold=foldField?m2o[foldField]:false;});return m2os;});},_fetchSpecialDomain:function(record,fieldName,fieldInfo){var context=record.getContext({fieldName:fieldName});var domainModel=fieldInfo.options.model;if(record.data.hasOwnProperty(domainModel)){domainModel=record._changes&&record._changes[domainModel]||record.data[domainModel];}
var domainValue=record._changes&&record._changes[fieldName]||record.data[fieldName]||[];var hasChanged=this._saveSpecialDataCache(record,fieldName,{context:context,domainModel:domainModel,domainValue:domainValue,});if(!hasChanged){return $.when();}else if(!domainModel){return $.when({model:domainModel,nbRecords:0,});}
var def=$.Deferred();var evalContext=this._getEvalContext(record);this._rpc({model:domainModel,method:'search_count',args:[Domain.prototype.stringToArray(domainValue,evalContext)],context:context}).then(_.identity,function(error,e){e.preventDefault();return false;}).always(function(nbRecords){def.resolve({model:domainModel,nbRecords:nbRecords,});});return def;},_fetchUngroupedList:function(list){var self=this;var def;if(list.static){def=this._readUngroupedList(list).then(function(){if(list.parentID&&self.isNew(list.parentID)){var many2ones=self._getMany2OneFieldNames(list);var defs=_.map(many2ones,function(name){return self._fetchNameGets(list,name);});return $.when.apply($,defs);}});}else{def=this._searchReadUngroupedList(list);}
return def.then(function(){return $.when(self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list));}).then(function(){return list;});},_fetchX2Manys:function(record,options){var self=this;var defs=[];options=options||{};var fieldNames=options.fieldNames||record.getFieldNames(options);var viewType=options.viewType||record.viewType;_.each(fieldNames,function(fieldName){var field=record.fields[fieldName];if(field.type==='one2many'||field.type==='many2many'){var fieldInfo=record.fieldsInfo[viewType][fieldName];var rawContext=fieldInfo&&fieldInfo.context;var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:(fieldInfo.fieldsInfo||{});var ids=record.data[fieldName]||[];var list=self._makeDataPoint({count:ids.length,context:_.extend({},record.context,field.context),fieldsInfo:fieldsInfo,fields:view?view.fields:fieldInfo.relatedFields,limit:fieldInfo.limit,modelName:field.relation,res_ids:ids,static:true,type:'list',orderedBy:fieldInfo.orderedBy,parentID:record.id,rawContext:rawContext,relationField:field.relation_field,viewType:view?view.type:fieldInfo.viewType,});record.data[fieldName]=list.id;if(!fieldInfo.__no_fetch){var def=self._readUngroupedList(list).then(function(){return $.when(self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list));});defs.push(def);}}});return $.when.apply($,defs);},_fetchX2ManyBatched:function(list,fieldName){var self=this;var field=list.fields[fieldName];var fieldInfo=list.fieldsInfo[list.viewType][fieldName];var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:fieldInfo.fieldsInfo;var fields=view?view.fields:fieldInfo.relatedFields;var viewType=view?view.type:fieldInfo.viewType;list=this._applyX2ManyOperations(list);this._sortList(list);var x2mRecords=[];var ids=[];_.each(list.data,function(dataPoint){var record=self.localData[dataPoint];if(typeof record.data[fieldName]==='string'){return;}
x2mRecords.push(record);ids=_.unique(ids.concat(record.data[fieldName]||[]));var m2mList=self._makeDataPoint({fieldsInfo:fieldsInfo,fields:fields,modelName:field.relation,parentID:record.id,res_ids:record.data[fieldName],static:true,type:'list',viewType:viewType,});record.data[fieldName]=m2mList.id;});if(!ids.length||fieldInfo.__no_fetch){return $.when();}
var def;var fieldNames=_.keys(fieldInfo.relatedFields);if(fieldNames.length){def=this._rpc({model:field.relation,method:'read',args:[ids,fieldNames],context:list.getContext()||{},});}else{def=$.when(_.map(ids,function(id){return{id:id};}));}
return def.then(function(results){_.each(x2mRecords,function(record){var m2mList=self.localData[record.data[fieldName]];m2mList.data=[];_.each(m2mList.res_ids,function(res_id){var dataPoint=self._makeDataPoint({modelName:field.relation,data:_.findWhere(results,{id:res_id}),fields:fields,fieldsInfo:fieldsInfo,parentID:m2mList.id,viewType:viewType,});m2mList.data.push(dataPoint.id);m2mList._cache[res_id]=dataPoint.id;});});});},_fetchX2ManysBatched:function(list){var defs=[];var fieldNames=list.getFieldNames();for(var i=0;i<fieldNames.length;i++){var field=list.fields[fieldNames[i]];if(field.type==='many2many'||field.type==='one2many'){defs.push(this._fetchX2ManyBatched(list,fieldNames[i]));}}
return $.when.apply($,defs);},_generateChanges:function(record,options){options=options||{};var viewType=options.viewType||record.viewType;var changes;if('changesOnly'in options&&!options.changesOnly){changes=_.extend({},record.data,record._changes);}else{changes=_.extend({},record._changes);}
var withReadonly=options.withReadonly||false;var commands=this._generateX2ManyCommands(record,{changesOnly:'changesOnly'in options?options.changesOnly:true,withReadonly:withReadonly,});for(var fieldName in record.fields){if(!withReadonly&&fieldName in changes||fieldName in commands){var editionViewType=record._editionViewType[fieldName]||viewType;if(this._isFieldProtected(record,fieldName,editionViewType)){delete changes[fieldName];continue;}}
var type=record.fields[fieldName].type;var value;if(type==='one2many'||type==='many2many'){if(commands[fieldName]&&commands[fieldName].length){changes[fieldName]=commands[fieldName];}else{delete changes[fieldName];}}else if(type==='many2one'&&fieldName in changes){value=changes[fieldName];changes[fieldName]=value?this.localData[value].res_id:false;}else if(type==='reference'&&fieldName in changes){value=changes[fieldName];changes[fieldName]=value?this.localData[value].model+','+this.localData[value].res_id:false;}else if(type==='char'&&changes[fieldName]===''){changes[fieldName]=false;}else if(changes[fieldName]===null){changes[fieldName]=false;}}
return changes;},_generateOnChangeData:function(record,options){options=_.extend({},options||{},{withReadonly:true});var commands=this._generateX2ManyCommands(record,options);var data=_.extend(this.get(record.id,{raw:true}).data,commands);var hasDisplayName=_.some(record.fieldsInfo,function(fieldsInfo){return'display_name'in fieldsInfo;});if(!hasDisplayName){delete data.display_name;}
if(record.parentID){var parent=this.localData[record.parentID];if(parent.parentID&&parent.relationField){var parentRecord=this.localData[parent.parentID];data[parent.relationField]=this._generateOnChangeData(parentRecord);}}
return data;},_generateX2ManyCommands:function(record,options){var self=this;options=options||{};var fields=record.fields;if(options.fieldNames){fields=_.pick(fields,options.fieldNames);}
var commands={};var data=_.extend({},record.data,record._changes);var type;for(var fieldName in fields){type=fields[fieldName].type;if(type==='many2many'||type==='one2many'){if(!data[fieldName]){continue;}
commands[fieldName]=[];var list=this.localData[data[fieldName]];if(options.changesOnly&&(!list._changes||!list._changes.length)){continue;}
var oldResIDs=list.res_ids.slice(0);var relRecordAdded=[];var relRecordUpdated=[];_.each(list._changes,function(change){if(change.operation==='ADD'&&change.id){relRecordAdded.push(self.localData[change.id]);}else if(change.operation==='UPDATE'&&!self.isNew(change.id)){relRecordUpdated.push(self.localData[change.id]);}});list=this._applyX2ManyOperations(list);this._sortList(list);if(type==='many2many'||list._forceM2MLink){var relRecordCreated=_.filter(relRecordAdded,function(rec){return typeof rec.res_id==='string';});var realIDs=_.difference(list.res_ids,_.pluck(relRecordCreated,'res_id'));commands[fieldName].push(x2ManyCommands.replace_with(realIDs));_.each(relRecordCreated,function(relRecord){var changes=self._generateChanges(relRecord,options);commands[fieldName].push(x2ManyCommands.create(relRecord.ref,changes));});_.each(relRecordUpdated,function(relRecord){var changes=self._generateChanges(relRecord,options);if(!_.isEmpty(changes)){var command=x2ManyCommands.update(relRecord.res_id,changes);commands[fieldName].push(command);}});}else if(type==='one2many'){var removedIds=_.difference(oldResIDs,list.res_ids);var addedIds=_.difference(list.res_ids,oldResIDs);var keptIds=_.intersection(oldResIDs,list.res_ids);var didChange=false;var changes,command,relRecord;for(var i=0;i<list.res_ids.length;i++){if(_.contains(keptIds,list.res_ids[i])){relRecord=_.findWhere(relRecordUpdated,{res_id:list.res_ids[i]});changes=relRecord?this._generateChanges(relRecord,options):{};if(!_.isEmpty(changes)){command=x2ManyCommands.update(relRecord.res_id,changes);didChange=true;}else{command=x2ManyCommands.link_to(list.res_ids[i]);}
commands[fieldName].push(command);}else if(_.contains(addedIds,list.res_ids[i])){relRecord=_.findWhere(relRecordAdded,{res_id:list.res_ids[i]});if(!relRecord){commands[fieldName].push(x2ManyCommands.link_to(list.res_ids[i]));continue;}
changes=this._generateChanges(relRecord,options);if(!this.isNew(relRecord.id)){commands[fieldName].push(x2ManyCommands.link_to(relRecord.res_id));delete changes.id;if(!_.isEmpty(changes)){commands[fieldName].push(x2ManyCommands.update(relRecord.res_id,changes));}}else{commands[fieldName].push(x2ManyCommands.create(relRecord.ref,changes));}}}
if(options.changesOnly&&!didChange&&addedIds.length===0&&removedIds.length===0){commands[fieldName]=[];}
for(i=0;i<removedIds.length;i++){if(list._forceM2MUnlink){commands[fieldName].push(x2ManyCommands.forget(removedIds[i]));}else{commands[fieldName].push(x2ManyCommands.delete(removedIds[i]));}}}}}
return commands;},_getContext:function(element,options){options=options||{};var context=new Context(session.user_context);context.set_eval_context(this._getEvalContext(element));if(options.full||!(options.fieldName||options.additionalContext)){context.add(element.context);}
if(options.fieldName){var viewType=options.viewType||element.viewType;var fieldInfo=element.fieldsInfo[viewType][options.fieldName];if(fieldInfo&&fieldInfo.context){context.add(fieldInfo.context);}else{var fieldParams=element.fields[options.fieldName];if(fieldParams.context){context.add(fieldParams.context);}}}
if(options.additionalContext){context.add(options.additionalContext);}
if(element.rawContext){var rawContext=new Context(element.rawContext);var evalContext=this._getEvalContext(this.localData[element.parentID]);evalContext.id=evalContext.id||false;rawContext.set_eval_context(evalContext);context.add(rawContext);}
return context.eval();},_getDomain:function(element,options){if(options&&options.fieldName){if(element._domains[options.fieldName]){return Domain.prototype.stringToArray(element._domains[options.fieldName],this._getEvalContext(element,true));}
var viewType=options.viewType||element.viewType;var fieldInfo=element.fieldsInfo[viewType][options.fieldName];if(fieldInfo&&fieldInfo.domain){return Domain.prototype.stringToArray(fieldInfo.domain,this._getEvalContext(element,true));}
var fieldParams=element.fields[options.fieldName];if(fieldParams.domain){return Domain.prototype.stringToArray(fieldParams.domain,this._getEvalContext(element,true));}
return[];}
return Domain.prototype.stringToArray(element.domain,this._getEvalContext(element,true));},_getEvalContext:function(element,forDomain){var evalContext=element.type==='record'?this._getRecordEvalContext(element,forDomain):{};if(element.parentID){var parent=this.localData[element.parentID];if(parent.type==='list'&&parent.parentID){parent=this.localData[parent.parentID];}
if(parent.type==='record'){evalContext.parent=this._getRecordEvalContext(parent,forDomain);}}
return _.extend({active_id:evalContext.id||false,active_ids:evalContext.id?[evalContext.id]:[],active_model:element.model,current_date:moment().format('YYYY-MM-DD'),id:evalContext.id||false,},session.user_context,element.context,evalContext);},_getFieldNames:function(element,options){var fieldsInfo=element.fieldsInfo;var viewType=options&&options.viewType||element.viewType;return Object.keys(fieldsInfo&&fieldsInfo[viewType]||{});},_getMany2OneFieldNames:function(datapoint){var many2ones=[];_.each(datapoint.fields,function(field,name){if(field.type==='many2one'){many2ones.push(name);}});return many2ones;},_getRecordEvalContext:function(record,forDomain){var self=this;var relDataPoint;var context=_.extend({},record.data,record._changes);function _generateX2ManyCommands(fieldName){var commands=self._generateX2ManyCommands(record,{fieldNames:[fieldName]});return commands[fieldName];}
for(var fieldName in context){var field=record.fields[fieldName];if(context[fieldName]===null){context[fieldName]=false;}
if(!field||field.name==='id'){continue;}
if(field.type==='date'||field.type==='datetime'){if(context[fieldName]){context[fieldName]=JSON.parse(JSON.stringify(context[fieldName]));}
continue;}
if(field.type==='many2one'){relDataPoint=this.localData[context[fieldName]];context[fieldName]=relDataPoint?relDataPoint.res_id:false;continue;}
if(field.type==='one2many'||field.type==='many2many'){var ids;if(!context[fieldName]||_.isArray(context[fieldName])){ids=context[fieldName]?context[fieldName].slice(0):[];}else{relDataPoint=this._applyX2ManyOperations(this.localData[context[fieldName]]);ids=relDataPoint.res_ids.slice(0);}
if(!forDomain){ids.toJSON=_generateX2ManyCommands.bind(null,fieldName);}else if(field.type==='one2many'){ids=_.filter(ids,function(id){return typeof id!=='string';});}
context[fieldName]=ids;}}
return context;},_invalidateCache:function(dataPoint){while(dataPoint.parentID){dataPoint=this.localData[dataPoint.parentID];}
if(_.contains(this.noCacheModels,dataPoint.model)){core.bus.trigger('clear_cache');}},_isFieldProtected:function(record,fieldName,viewType){var fieldInfo=record.fieldsInfo&&(record.fieldsInfo[viewType||record.viewType][fieldName]);if(fieldInfo){var rawModifiers=fieldInfo.modifiers||{};var modifiers=this._evalModifiers(record,rawModifiers);return modifiers.readonly&&!fieldInfo.force_save;}else{return false;}},_isFieldSet:function(value,fieldType){switch(fieldType){case'boolean':return true;case'one2many':case'many2many':return value.length>0;default:return value!==false;}},_isX2ManyValid:function(id){var self=this;var isValid=true;var element=this.localData[id];_.each(element._changes,function(command){if(command.operation==='DELETE'||command.operation==='FORGET'||(command.operation==='ADD'&&!command.isNew)||command.operation==='REMOVE_ALL'){return;}
var recordData=self.get(command.id,{raw:true}).data;var record=self.localData[command.id];_.each(element.getFieldNames(),function(fieldName){var field=element.fields[fieldName];var fieldInfo=element.fieldsInfo[element.viewType][fieldName];var rawModifiers=fieldInfo.modifiers||{};var modifiers=self._evalModifiers(record,rawModifiers);if(modifiers.required&&!self._isFieldSet(recordData[fieldName],field.type)){isValid=false;}});});return isValid;},_load:function(dataPoint,options){if(options&&options.onlyGroups&&!(dataPoint.type==='list'&&dataPoint.groupedBy.length)){return $.when(dataPoint);}
if(dataPoint.type==='record'){return this._fetchRecord(dataPoint,options);}
if(dataPoint.type==='list'&&dataPoint.groupedBy.length){return this._readGroup(dataPoint,options);}
if(dataPoint.type==='list'&&!dataPoint.groupedBy.length){return this._fetchUngroupedList(dataPoint);}},_makeDataPoint:function(params){var type=params.type||('domain'in params&&'list')||'record';var res_id,value;var res_ids=params.res_ids||[];var data=params.data||(type==='record'?{}:[]);var context=params.context;if(type==='record'){res_id=params.res_id||(params.data&&params.data.id);if(res_id){data.id=res_id;}else{res_id=_.uniqueId('virtual_');}
context=_.omit(context,['orderedBy','group_by']);}else{var isValueArray=params.value instanceof Array;res_id=isValueArray?params.value[0]:undefined;value=isValueArray?params.value[1]:params.value;}
var fields=_.extend({display_name:{type:'char'},id:{type:'integer'},},params.fields);var dataPoint={_cache:type==='list'?{}:undefined,_changes:null,_domains:{},_rawChanges:{},aggregateValues:params.aggregateValues||{},context:context,count:params.count||res_ids.length,data:data,domain:params.domain||[],fields:fields,fieldsInfo:params.fieldsInfo,groupedBy:params.groupedBy||[],id:_.uniqueId(params.modelName+'_'),isOpen:params.isOpen,limit:type==='record'?1:params.limit,loadMoreOffset:0,model:params.modelName,offset:params.offset||(type==='record'?_.indexOf(res_ids,res_id):0),openGroupByDefault:params.openGroupByDefault,orderedBy:params.orderedBy||[],orderedResIDs:params.orderedResIDs,parentID:params.parentID,rawContext:params.rawContext,ref:params.ref||res_id,relationField:params.relationField,res_id:res_id,res_ids:res_ids,specialData:{},_specialDataCache:{},static:params.static||false,type:type,value:value,viewType:params.viewType,};dataPoint._editionViewType={};dataPoint.evalModifiers=this._evalModifiers.bind(this,dataPoint);dataPoint.getContext=this._getContext.bind(this,dataPoint);dataPoint.getDomain=this._getDomain.bind(this,dataPoint);dataPoint.getFieldNames=this._getFieldNames.bind(this,dataPoint);dataPoint.isDirty=this.isDirty.bind(this,dataPoint.id);this.localData[dataPoint.id]=dataPoint;return dataPoint;},_makeDefaultRecord:function(modelName,params){var self=this;var targetView=params.viewType;var fields=params.fields;var fieldsInfo=params.fieldsInfo;var fieldNames=Object.keys(fieldsInfo[targetView]);var fields_key=_.without(fieldNames,'__last_update');var parentRecord=self.localData[params.parentID];if(parentRecord){var originView=parentRecord.viewType;fieldNames=_.union(fieldNames,Object.keys(parentRecord.fieldsInfo[originView]));fieldsInfo[targetView]=_.defaults({},fieldsInfo[targetView],parentRecord.fieldsInfo[originView]);fields=_.defaults({},fields,parentRecord.fields);}
return this._rpc({model:modelName,method:'default_get',args:[fields_key],context:params.context,}).then(function(result){var record=self._makeDataPoint({modelName:modelName,fields:fields,fieldsInfo:fieldsInfo,context:params.context,parentID:params.parentID,res_ids:params.res_ids,viewType:targetView,});var overrideDefaultFields=self._computeOverrideDefaultFields(params.parentID,params.position);if(overrideDefaultFields){result[overrideDefaultFields.field]=overrideDefaultFields.value;}
return self.applyDefaultValues(record.id,result,{fieldNames:fieldNames}).then(function(){var def=$.Deferred();self._performOnChange(record,fields_key).always(function(){if(record._warning){if(params.allowWarning){delete record._warning;}else{def.reject();}}
def.resolve();});return def;}).then(function(){return self._fetchRelationalData(record);}).then(function(){return self._postprocess(record);}).then(function(){self.save(record.id,{savePoint:true});return record.id;});});},_parseServerData:function(fieldNames,element,data){var self=this;_.each(fieldNames,function(fieldName){var field=element.fields[fieldName];var val=data[fieldName];if(field.type==='many2one'){if(val!==false){var r=self._makeDataPoint({modelName:field.relation,fields:{display_name:{type:'char'},id:{type:'integer'},},data:{display_name:val[1],id:val[0],},parentID:element.id,});data[fieldName]=r.id;}else{data[fieldName]=false;}}else{data[fieldName]=self._parseServerValue(field,val);}});},_performOnChange:function(record,fields,viewType){var self=this;var onchangeSpec=this._buildOnchangeSpecs(record,viewType);if(!onchangeSpec){return $.when();}
var idList=record.data.id?[record.data.id]:[];var options={full:true,};if(fields.length===1){fields=fields[0];options.fieldName=fields;}
var context=this._getContext(record,options);var currentData=this._generateOnChangeData(record,{changesOnly:false});return self._rpc({model:record.model,method:'onchange',args:[idList,currentData,fields,onchangeSpec,context],}).then(function(result){if(!record._changes){return;}
if(result.warning){self.trigger_up('warning',{message:result.warning.message,title:result.warning.title,type:'dialog',});record._warning=true;}
if(result.domain){record._domains=_.extend(record._domains,result.domain);}
return self._applyOnChange(result.value,record).then(function(){return result;});});},_postprocess:function(record,options){var self=this;var viewType=options&&options.viewType||record.viewType;var defs=[];_.each(record.getFieldNames(options),function(name){var field=record.fields[name];var fieldInfo=record.fieldsInfo[viewType][name]||{};var options=fieldInfo.options||{};if(options.always_reload){if(record.fields[name].type==='many2one'&&record.data[name]){var element=self.localData[record.data[name]];defs.push(self._rpc({model:field.relation,method:'name_get',args:[element.data.id],context:self._getContext(record,{fieldName:name,viewType:viewType}),}).then(function(result){element.data.display_name=result[0][1];}));}}});defs.push(this._fetchSpecialData(record,options));return $.when.apply($,defs).then(function(){return record;});},_processX2ManyCommands:function(record,fieldName,commands,options){var self=this;options=options||{};var defs=[];var field=record.fields[fieldName];var fieldInfo=record.fieldsInfo[options.viewType||record.viewType][fieldName];var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:fieldInfo.fieldsInfo;var fields=view?view.fields:fieldInfo.relatedFields;var viewType=view?view.type:fieldInfo.viewType;var parentContext=_.omit(record.context,function(val,key){return _.str.startsWith(key,'default_');});var x2manyList=self._makeDataPoint({context:parentContext,fieldsInfo:fieldsInfo,fields:fields,limit:fieldInfo.limit,modelName:field.relation,parentID:record.id,rawContext:fieldInfo&&fieldInfo.context,relationField:field.relation_field,res_ids:[],static:true,type:'list',viewType:viewType,});record._changes[fieldName]=x2manyList.id;x2manyList._changes=[];var many2ones={};var r;commands=commands||[];var isCommandList=commands.length&&_.isArray(commands[0]);if(!isCommandList){commands=[[6,false,commands]];}
_.each(commands,function(value){if(value[0]===0){r=self._makeDataPoint({modelName:x2manyList.model,context:x2manyList.context,fieldsInfo:fieldsInfo,fields:fields,parentID:x2manyList.id,viewType:viewType,});r._noAbandon=true;x2manyList._changes.push({operation:'ADD',id:r.id});x2manyList._cache[r.res_id]=r.id;_.each(r.getFieldNames(),function(fieldName){r.data[fieldName]=null;});r._changes=_.defaults(value[2],r.data);for(var fieldName in r._changes){if(!r._changes[fieldName]){continue;}
var isFieldInView=fieldName in r.fields;if(isFieldInView){var field=r.fields[fieldName];var fieldType=field.type;var rec;if(fieldType==='many2one'){rec=self._makeDataPoint({context:r.context,modelName:field.relation,data:{id:r._changes[fieldName]},parentID:r.id,});r._changes[fieldName]=rec.id;many2ones[fieldName]=true;}else if(fieldType==='reference'){var reference=r._changes[fieldName].split(',');rec=self._makeDataPoint({context:r.context,modelName:reference[0],data:{id:parseInt(reference[1])},parentID:r.id,});r._changes[fieldName]=rec.id;many2ones[fieldName]=true;}else if(_.contains(['one2many','many2many'],fieldType)){var x2mCommands=value[2][fieldName];defs.push(self._processX2ManyCommands(r,fieldName,x2mCommands));}else{r._changes[fieldName]=self._parseServerValue(field,r._changes[fieldName]);}}}}
if(value[0]===6){_.each(value[2],function(res_id){x2manyList._changes.push({operation:'ADD',resID:res_id});});var def=self._readUngroupedList(x2manyList).then(function(){return $.when(self._fetchX2ManysBatched(x2manyList),self._fetchReferencesBatched(x2manyList));});defs.push(def);}});_.each(_.keys(many2ones),function(name){defs.push(self._fetchNameGets(x2manyList,name));});return $.when.apply($,defs);},_performBatchedRPCs:function(){if(!this.batchedRPCsRequests.length){return;}
var batchedRPCsRequests=this.batchedRPCsRequests;this.batchedRPCsRequests=[];var batches={};var key;for(var i=0;i<batchedRPCsRequests.length;i++){var request=batchedRPCsRequests[i];key=request.model+','+JSON.stringify(request.context);if(!batches[key]){batches[key]=_.extend({},request,{requests:[request]});}else{batches[key].ids=_.uniq(batches[key].ids.concat(request.ids));batches[key].fieldNames=_.uniq(batches[key].fieldNames.concat(request.fieldNames));batches[key].requests.push(request);}}
function onSuccess(batch,results){for(var i=0;i<batch.requests.length;i++){var request=batch.requests[i];var fieldNames=request.fieldNames.concat(['id']);var filteredResults=results.filter(function(record){return request.ids.indexOf(record.id)>=0;}).map(function(record){return _.pick(record,fieldNames);});request.def.resolve(filteredResults);}}
function onFailure(batch,error){for(var i=0;i<batch.requests.length;i++){var request=batch.requests[i];request.def.reject(error);}}
for(key in batches){var batch=batches[key];this._rpc({model:batch.model,method:'read',args:[batch.ids,batch.fieldNames],context:batch.context,}).then(onSuccess.bind(null,batch)).fail(onFailure.bind(null,batch));}},_performRPC:function(params){var def=$.Deferred();var request=_.extend({},params,{def:def});this.batchedRPCsRequests.push(request);if(this.disableBatchedRPCs){this._performBatchedRPCs();}else{setTimeout(this._performBatchedRPCs.bind(this));}
return def;},_readMissingFields:function(list,resIDs,fieldNames){var self=this;var missingIDs=[];for(var i=0,len=resIDs.length;i<len;i++){var resId=resIDs[i];var dataPointID=list._cache[resId];if(!dataPointID){missingIDs.push(resId);continue;}
var record=self.localData[dataPointID];var data=_.extend({},record.data,record._changes);if(_.difference(fieldNames,_.keys(data)).length){missingIDs.push(resId);}}
var def;if(missingIDs.length&&fieldNames.length){def=self._performRPC({context:list.getContext(),fieldNames:fieldNames,ids:missingIDs,method:'read',model:list.model,});}else{def=$.when(_.map(missingIDs,function(id){return{id:id};}));}
return def.then(function(records){_.each(resIDs,function(id){var dataPoint;var data=_.findWhere(records,{id:id});if(id in list._cache){dataPoint=self.localData[list._cache[id]];if(data){self._parseServerData(fieldNames,dataPoint,data);_.extend(dataPoint.data,data);}}else{dataPoint=self._makeDataPoint({context:list.context,data:data,fieldsInfo:list.fieldsInfo,fields:list.fields,modelName:list.model,parentID:list.id,viewType:list.viewType,});self._parseServerData(fieldNames,dataPoint,dataPoint.data);list._cache[id]=dataPoint.id;}
_.each(list._changes,function(change){if(change.operation==='ADD'&&!change.id&&change.resID===id){change.id=dataPoint.id;}});});return list;});},_readGroup:function(list,options){var self=this;var groupByField=list.groupedBy[0];var rawGroupBy=groupByField.split(':')[0];var fields=_.uniq(list.getFieldNames().concat(rawGroupBy));var orderedBy=_.filter(list.orderedBy,function(order){return order.name===rawGroupBy||list.fields[order.name].group_operator!==undefined;});return this._rpc({model:list.model,method:'read_group',fields:fields,domain:list.domain,context:list.context,groupBy:list.groupedBy,orderBy:orderedBy,lazy:true,}).then(function(groups){var previousGroups=_.map(list.data,function(groupID){return self.localData[groupID];});list.data=[];list.count=0;var defs=[];var openGroupCount=0;_.each(groups,function(group){var aggregateValues={};_.each(group,function(value,key){if(_.contains(fields,key)&&key!==groupByField){aggregateValues[key]=value;}});var value=group[groupByField];if(list.fields[rawGroupBy].type==="selection"){var choice=_.find(list.fields[rawGroupBy].selection,function(c){return c[0]===value;});value=choice?choice[1]:false;}
var newGroup=self._makeDataPoint({modelName:list.model,count:group[rawGroupBy+'_count'],domain:group.__domain,context:list.context,fields:list.fields,fieldsInfo:list.fieldsInfo,value:value,aggregateValues:aggregateValues,groupedBy:list.groupedBy.slice(1),orderedBy:list.orderedBy,orderedResIDs:list.orderedResIDs,limit:list.limit,openGroupByDefault:list.openGroupByDefault,parentID:list.id,type:'list',viewType:list.viewType,});var oldGroup=_.find(previousGroups,function(g){return g.res_id===newGroup.res_id&&g.value===newGroup.value;});if(oldGroup){delete self.localData[newGroup.id];var updatedProps=_.omit(newGroup,'limit','isOpen','offset','id');if(options&&options.onlyGroups||oldGroup.isOpen&&newGroup.groupedBy.length){delete updatedProps.data;}
oldGroup.limit=oldGroup.limit+oldGroup.loadMoreOffset;_.extend(oldGroup,updatedProps);newGroup=oldGroup;}else if(!newGroup.openGroupByDefault||openGroupCount>=self.OPEN_GROUP_LIMIT){newGroup.isOpen=false;}else{newGroup.isOpen='__fold'in group?!group.__fold:true;}
list.data.push(newGroup.id);list.count+=newGroup.count;if(newGroup.isOpen&&newGroup.count>0){openGroupCount++;defs.push(self._load(newGroup,options));}});if(options&&options.keepEmptyGroups){var emptyGroupsIDs=_.difference(_.pluck(previousGroups,'id'),list.data);_.each(emptyGroupsIDs,function(groupID){list.data.push(groupID);var emptyGroup=self.localData[groupID];emptyGroup.aggregateValues={};});}
return $.when.apply($,defs).then(function(){if(!options||!options.onlyGroups){list.res_ids=_.flatten(_.map(arguments,function(group){return group?group.res_ids:[];}));}
return list;});});},_readUngroupedList:function(list){var self=this;var def=$.when();list=this._applyX2ManyOperations(list);if(list.res_ids.length>list.limit&&list.orderedBy.length){if(!list.orderedResIDs){var fieldNames=_.pluck(list.orderedBy,'name');def=this._readMissingFields(list,_.filter(list.res_ids,_.isNumber),fieldNames);}
def.then(function(){self._sortList(list);});}
return def.then(function(){var resIDs=[];var currentResIDs=list.res_ids;if(list.orderedResIDs){currentResIDs=list.orderedResIDs.filter(function(resID){return list.res_ids.indexOf(resID)>=0;});}
var currentCount=currentResIDs.length;var upperBound=list.limit?Math.min(list.offset+list.limit,currentCount):currentCount;var fieldNames=list.getFieldNames();for(var i=list.offset;i<upperBound;i++){var resId=currentResIDs[i];if(_.isNumber(resId)){resIDs.push(resId);}}
return self._readMissingFields(list,resIDs,fieldNames).then(function(){if(list.res_ids.length<=list.limit){self._sortList(list);}else{self._setDataInRange(list);}
return list;});});},_reload:function(id,options){options=options||{};var element=this.localData[id];if(element.type==='record'){if(!options.currentId&&(('currentId'in options)||this.isNew(id))){var params={context:element.context,fieldsInfo:element.fieldsInfo,fields:element.fields,viewType:element.viewType,allowWarning:true,};return this._makeDefaultRecord(element.model,params);}
if(!options.keepChanges){this.discardChanges(id,{rollback:false});}}else if(element._changes){delete element.tempLimitIncrement;_.each(element._changes,function(change){delete change.isNew;});}
if(options.context!==undefined){element.context=options.context;element.orderedBy=options.context.orderedBy||element.orderedBy;}
if(options.domain!==undefined){element.domain=options.domain;}
if(options.groupBy!==undefined){element.groupedBy=options.groupBy;}
if(options.limit!==undefined){element.limit=options.limit;}
if(options.offset!==undefined){this._setOffset(element.id,options.offset);}
if(options.loadMoreOffset!==undefined){element.loadMoreOffset=options.loadMoreOffset;}else{element.loadMoreOffset=0;}
if(options.currentId!==undefined){element.res_id=options.currentId;}
if(options.ids!==undefined){element.res_ids=options.ids;element.count=element.res_ids.length;}
if(element.type==='record'){element.offset=_.indexOf(element.res_ids,element.res_id);}
var loadOptions=_.pick(options,'fieldNames','viewType');return this._load(element,loadOptions).then(function(result){return result.id;});},_saveSpecialDataCache:function(record,fieldName,value){if(_.isEqual(record._specialDataCache[fieldName],value)){return false;}
record._specialDataCache[fieldName]=value;return true;},_searchReadUngroupedList:function(list){var self=this;var fieldNames=list.getFieldNames();return this._rpc({route:'/web/dataset/search_read',model:list.model,fields:fieldNames,context:list.getContext(),domain:list.domain||[],limit:list.limit,offset:list.loadMoreOffset+list.offset,orderBy:list.orderedBy,}).then(function(result){list.count=result.length;var ids=_.pluck(result.records,'id');var data=_.map(result.records,function(record){var dataPoint=self._makeDataPoint({context:list.context,data:record,fields:list.fields,fieldsInfo:list.fieldsInfo,modelName:list.model,parentID:list.id,viewType:list.viewType,});self._parseServerData(fieldNames,dataPoint,dataPoint.data);return dataPoint.id;});if(list.loadMoreOffset){list.data=list.data.concat(data);list.res_ids=list.res_ids.concat(ids);}else{list.data=data;list.res_ids=ids;}
self._updateParentResIDs(list);return list;});},_setDataInRange:function(list){var idsInRange;if(list.limit){idsInRange=list.res_ids.slice(list.offset,list.offset+list.limit);}else{idsInRange=list.res_ids;}
list.data=[];_.each(idsInRange,function(id){if(list._cache[id]){list.data.push(list._cache[id]);}});if(list.limit){for(var i=list.offset+list.limit;i<list.res_ids.length;i++){var id=list.res_ids[i];var dataPointID=list._cache[id];if(_.findWhere(list._changes,{isNew:true,id:dataPointID})){list.data.push(dataPointID);}else{break;}}}},_setOffset:function(elementId,offset){var element=this.localData[elementId];element.offset=offset;if(element.type==='record'&&element.res_ids.length){element.res_id=element.res_ids[offset];}},_sortList:function(list){if(!list.static){return;}
var self=this;if(list.orderedResIDs){var orderedResIDs={};for(var k=0;k<list.orderedResIDs.length;k++){orderedResIDs[list.orderedResIDs[k]]=k;}
utils.stableSort(list.res_ids,function compareResIdIndexes(resId1,resId2){if(!(resId1 in orderedResIDs)&&!(resId2 in orderedResIDs)){return 0;}
if(!(resId1 in orderedResIDs)){return Infinity;}
if(!(resId2 in orderedResIDs)){return-Infinity;}
return orderedResIDs[resId1]-orderedResIDs[resId2];});}else if(list.orderedBy.length){var compareRecords=function(resId1,resId2,level){if(!level){level=0;}
if(list.orderedBy.length<level+1){return 0;}
var order=list.orderedBy[level];var record1ID=list._cache[resId1];var record2ID=list._cache[resId2];if(!record1ID&&!record2ID){return 0;}
if(!record1ID){return Infinity;}
if(!record2ID){return-Infinity;}
var r1=self.localData[record1ID];var r2=self.localData[record2ID];var data1=_.extend({},r1.data,r1._changes);var data2=_.extend({},r2.data,r2._changes);var orderData1=data1[order.name];var orderData2=data2[order.name];if(list.fields[order.name].type==='many2one'){orderData1=orderData1?self.localData[orderData1].data.display_name:"";orderData2=orderData2?self.localData[orderData2].data.display_name:"";}
if(orderData1<orderData2){return order.asc?-1:1;}
if(orderData1>orderData2){return order.asc?1:-1;}
return compareRecords(resId1,resId2,level+1);};utils.stableSort(list.res_ids,compareRecords);}
this._setDataInRange(list);},_updateParentResIDs:function(element){var self=this;if(element.parentID){var parent=this.localData[element.parentID];parent.res_ids=_.flatten(_.map(parent.data,function(dataPointID){return self.localData[dataPointID].res_ids;}));this._updateParentResIDs(parent);}},_visitChildren:function(element,fn){var self=this;fn(element);if(element.type==='record'){for(var fieldName in element.data){var field=element.fields[fieldName];if(!field){continue;}
if(_.contains(['one2many','many2one','many2many'],field.type)){var hasChange=element._changes&&fieldName in element._changes;var value=hasChange?element._changes[fieldName]:element.data[fieldName];var relationalElement=this.localData[value];if(relationalElement){self._visitChildren(relationalElement,fn);}}}}
if(element.type==='list'){element=this._applyX2ManyOperations(element);_.each(element.data,function(elemId){var elem=self.localData[elemId];self._visitChildren(elem,fn);});}},});return BasicModel;});;

/* /web/static/src/js/views/basic/basic_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.BasicView',function(require){"use strict";var AbstractView=require('web.AbstractView');var BasicController=require('web.BasicController');var BasicModel=require('web.BasicModel');var config=require('web.config');var fieldRegistry=require('web.field_registry');var pyUtils=require('web.py_utils');var utils=require('web.utils');var BasicView=AbstractView.extend({config:_.extend({},AbstractView.prototype.config,{Model:BasicModel,Controller:BasicController,}),viewType:undefined,init:function(viewInfo,params){this._super.apply(this,arguments);this.fieldsInfo={};this.fieldsInfo[this.viewType]=this.fieldsView.fieldsInfo[this.viewType];this.rendererParams.viewType=this.viewType;this.controllerParams.confirmOnDelete=true;this.controllerParams.archiveEnabled='active'in this.fields;this.controllerParams.hasButtons='action_buttons'in params?params.action_buttons:true;this.loadParams.fieldsInfo=this.fieldsInfo;this.loadParams.fields=this.fields;this.loadParams.context=params.context||{};this.loadParams.limit=parseInt(this.arch.attrs.limit,10)||params.limit;this.loadParams.viewType=this.viewType;this.loadParams.parentID=params.parentID;this.recordID=params.recordID;this.model=params.model;},_getFieldWidgetClass:function(viewType,field,attrs){var FieldWidget;if(attrs.widget){FieldWidget=fieldRegistry.getAny([viewType+"."+attrs.widget,attrs.widget]);if(!FieldWidget){console.warn("Missing widget: ",attrs.widget," for field",attrs.name,"of type",field.type);}}else if(viewType==='kanban'&&field.type==='many2many'){FieldWidget=fieldRegistry.get('kanban.many2many_tags');}
return FieldWidget||fieldRegistry.getAny([viewType+"."+field.type,field.type,"abstract"]);},_loadData:function(){if(this.recordID){var self=this;this.model.addFieldsInfo(this.recordID,{fields:this.fields,fieldsInfo:this.fieldsInfo,});var record=this.model.get(this.recordID);var viewType=this.viewType;var viewFields=Object.keys(record.fieldsInfo[viewType]);var fieldNames=_.difference(viewFields,Object.keys(record.data));var fieldsInfo=record.fieldsInfo[viewType];_.each(viewFields,function(name){if(!_.contains(fieldNames,name)){var fieldType=record.fields[name].type;var fieldInfo=fieldsInfo[name];if(fieldInfo.Widget){var requiresSpecialData=fieldInfo.Widget.prototype.specialData;if(requiresSpecialData&&!(name in record.specialData)){fieldNames.push(name);return;}}
if((fieldType==='one2many'||fieldType==='many2many')){if(!('fieldsInfo'in record.data[name])){fieldNames.push(name);}else{var fieldViews=fieldInfo.views||fieldInfo.fieldsInfo||{};var fieldViewTypes=Object.keys(fieldViews);var recordViewTypes=Object.keys(record.data[name].fieldsInfo);if(_.difference(fieldViewTypes,recordViewTypes).length){fieldNames.push(name);}
if(record.data[name].viewType==='default'){var defaultFieldInfo=record.data[name].fieldsInfo.default;_.each(fieldViews,function(fieldView){_.each(fieldView.fieldsInfo,function(x2mFieldInfo){_.defaults(x2mFieldInfo,defaultFieldInfo);});});}}}
if(fieldType==='many2one'){if(JSON.stringify(record.data[name].context)!==JSON.stringify(fieldInfo.context)){fieldNames.push(name);}}}});var def;if(fieldNames.length){def=this.model.applyRawChanges(record.id,viewType).then(function(){if(self.model.isNew(record.id)){return self.model.applyDefaultValues(record.id,{},{fieldNames:fieldNames,viewType:viewType,});}else{return self.model.reload(record.id,{fieldNames:fieldNames,keepChanges:true,viewType:viewType,});}});}
return $.when(def).then(function(){return record.id;});}
return this._super.apply(this,arguments);},_processArch:function(arch,fv){var self=this;utils.traverse(arch,function(node){return self._processNode(node,fv);});},_processField:function(viewType,field,attrs){var self=this;attrs.Widget=this._getFieldWidgetClass(viewType,field,attrs);_.each(attrs,function(value,key){var splitKey=key.split('-');if(splitKey[0]==='decoration'){attrs.decorations=attrs.decorations||[];attrs.decorations.push({className:'text-'+splitKey[1],expression:pyUtils._getPyJSAST(value),});}});if(!_.isObject(attrs.options)){attrs.options=attrs.options?pyUtils.py_eval(attrs.options):{};}
if(attrs.on_change&&attrs.on_change!=="0"&&!field.onChange){field.onChange="1";}
if(attrs.modifiers.invisible===true||attrs.modifiers.column_invisible===true){attrs.__no_fetch=true;}
if(!_.isEmpty(field.views)){attrs.views={};_.each(field.views,function(innerFieldsView,viewType){viewType=viewType==='tree'?'list':viewType;attrs.views[viewType]=self._processFieldsView(innerFieldsView,viewType);});}
if(field.type==='one2many'||field.type==='many2many'){if(attrs.Widget.prototype.useSubview){if(!attrs.views){attrs.views={};}
var mode=attrs.mode;if(!mode){if(attrs.views.tree&&attrs.views.kanban){mode='tree';}else if(!attrs.views.tree&&attrs.views.kanban){mode='kanban';}else{mode='tree,kanban';}}
if(mode.indexOf(',')!==-1){mode=config.device.isMobile?'kanban':'tree';}
if(mode==='tree'){mode='list';if(!attrs.views.list&&attrs.views.tree){attrs.views.list=attrs.views.tree;}}
attrs.mode=mode;if(mode in attrs.views){var view=attrs.views[mode];this._processSubViewAttrs(view,attrs);}}
if(attrs.Widget.prototype.fieldsToFetch){attrs.viewType='default';attrs.relatedFields=_.extend({},attrs.Widget.prototype.fieldsToFetch);attrs.fieldsInfo={default:_.mapObject(attrs.Widget.prototype.fieldsToFetch,function(){return{};}),};if(attrs.options.color_field){attrs.relatedFields[attrs.options.color_field]={type:'integer'};attrs.fieldsInfo.default[attrs.options.color_field]={};}}}
if(attrs.Widget.prototype.fieldDependencies){attrs.fieldDependencies=attrs.Widget.prototype.fieldDependencies;}
return attrs;},_processFieldsView:function(fieldsView,viewType){var fv=this._super.apply(this,arguments);viewType=viewType||this.viewType;fv.type=viewType;fv.fieldsInfo=Object.create(null);fv.fieldsInfo[viewType]=Object.create(null);this._processArch(fv.arch,fv);return fv;},_processNode:function(node,fv){if(typeof node==='string'){return false;}
if(!_.isObject(node.attrs.modifiers)){node.attrs.modifiers=node.attrs.modifiers?JSON.parse(node.attrs.modifiers):{};}
if(!_.isObject(node.attrs.options)&&node.tag==='button'){node.attrs.options=node.attrs.options?JSON.parse(node.attrs.options):{};}
if(node.tag==='field'){var viewType=fv.type;var fieldsInfo=fv.fieldsInfo[viewType];var fields=fv.viewFields;fieldsInfo[node.attrs.name]=this._processField(viewType,fields[node.attrs.name],node.attrs?_.clone(node.attrs):{});if(fieldsInfo[node.attrs.name].fieldDependencies){var deps=fieldsInfo[node.attrs.name].fieldDependencies;for(var dependency_name in deps){var dependency_dict={name:dependency_name,type:deps[dependency_name].type};if(!(dependency_name in fieldsInfo)){fieldsInfo[dependency_name]=_.extend({},dependency_dict,{options:deps[dependency_name].options||{}});}
if(!(dependency_name in fields)){fields[dependency_name]=dependency_dict;}
if(fv.fields&&!(dependency_name in fv.fields)){fv.fields[dependency_name]=dependency_dict;}}}
return false;}
return node.tag!=='arch';},_processSubViewAttrs:function(view,attrs){var defaultOrder=view.arch.attrs.default_order;if(defaultOrder){attrs.orderedBy=_.map(defaultOrder.split(','),function(order){order=order.trim().split(' ');return{name:order[0],asc:order[1]!=='desc'};});}else{var handleField=_.find(view.arch.children,function(child){return child.attrs&&child.attrs.widget==='handle';});if(handleField){attrs.orderedBy=[{name:handleField.attrs.name,asc:true}];}}
attrs.columnInvisibleFields={};_.each(view.arch.children,function(child){if(child.attrs&&child.attrs.modifiers){attrs.columnInvisibleFields[child.attrs.name]=child.attrs.modifiers.column_invisible||false;}});},});return BasicView;});;

/* /web/static/src/js/views/basic/basic_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.BasicController',function(require){"use strict";var AbstractController=require('web.AbstractController');var core=require('web.core');var Dialog=require('web.Dialog');var FieldManagerMixin=require('web.FieldManagerMixin');var Pager=require('web.Pager');var _t=core._t;var BasicController=AbstractController.extend(FieldManagerMixin,{custom_events:_.extend({},AbstractController.prototype.custom_events,FieldManagerMixin.custom_events,{discard_changes:'_onDiscardChanges',reload:'_onReload',set_dirty:'_onSetDirty',sidebar_data_asked:'_onSidebarDataAsked',translate:'_onTranslate',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.archiveEnabled=params.archiveEnabled;this.confirmOnDelete=params.confirmOnDelete;this.hasButtons=params.hasButtons;FieldManagerMixin.init.call(this,this.model);this.handle=params.initialState.id;this.mode=params.mode||'readonly';this.savingDef=$.when();},start:function(){this.$el.toggleClass('o_cannot_create',!this.activeActions.create);return this._super.apply(this,arguments).then(this._updateEnv.bind(this));},canBeDiscarded:function(recordID){if(!this.isDirty(recordID)){return $.when(false);}
var message=_t("The record has been modified, your changes will be discarded. Do you want to proceed?");var def=$.Deferred();var dialog=Dialog.confirm(this,message,{title:_t("Warning"),confirm_callback:def.resolve.bind(def,true),cancel_callback:def.reject.bind(def),});dialog.on('closed',def,def.reject);return def;},canBeSaved:function(recordID){var fieldNames=this.renderer.canBeSaved(recordID||this.handle);if(fieldNames.length){this._notifyInvalidFields(fieldNames);return false;}
return true;},discardChanges:function(recordID,options){return $.when(this.mutex.getUnlockedDef(),this.savingDef).then(this._discardChanges.bind(this,recordID||this.handle,options));},getSelectedIds:function(){return[];},giveFocus:function(){this.renderer.giveFocus();},isDirty:function(recordID){return this.model.isDirty(recordID||this.handle);},renderPager:function($node,options){var data=this.model.get(this.handle,{raw:true});this.pager=new Pager(this,data.count,data.offset+1,data.limit,options);this.pager.on('pager_changed',this,function(newState){var self=this;this.pager.disable();data=this.model.get(this.handle,{raw:true});var limitChanged=(data.limit!==newState.limit);this.reload({limit:newState.limit,offset:newState.current_min-1}).then(function(){if(!limitChanged){self.trigger_up('scrollTo',{top:0});}}).then(this.pager.enable.bind(this.pager));});this.pager.appendTo($node);this._updatePager();},saveRecord:function(recordID,options){var self=this;var savingDef=$.Deferred();this.savingDef=savingDef;return this.mutex.getUnlockedDef().then(function(){return self.renderer.commitChanges(recordID||self.handle);}).then(function(){return self.mutex.exec(self._saveRecord.bind(self,recordID,options));}).then(savingDef.resolve.bind(savingDef)).fail(savingDef.resolve.bind(savingDef));},update:function(params,options){var self=this;this.mode=params.mode||this.mode;return this._super(params,options).then(function(){self._updateEnv();self._updatePager();});},_abandonRecord:function(recordID){recordID=recordID||this.handle;if(recordID===this.handle){this.trigger_up('history_back');}else{this.model.removeLine(recordID);}},_applyChanges:function(dataPointID,changes,event){var _super=FieldManagerMixin._applyChanges.bind(this);return this.mutex.exec(function(){return _super(dataPointID,changes,event);});},_callButtonAction:function(attrs,record){var self=this;var def=$.Deferred();var reload=function(){return self.isDestroyed()?$.when():self.reload();};record=record||this.model.get(this.handle);this.trigger_up('execute_action',{action_data:_.extend({},attrs,{context:record.getContext({additionalContext:attrs.context||{}}),}),env:{context:record.getContext(),currentID:record.data.id,model:record.model,resIDs:record.res_ids,},on_success:def.resolve.bind(def),on_fail:function(){self.update({},{reload:false}).always(def.reject.bind(def));},on_closed:reload,});return this.alive(def);},_confirmChange:function(id,fields,e){if(e.name==='discard_changes'&&e.target.reset){return e.target.reset(this.model.get(e.target.dataPointID),e,true);}
var state=this.model.get(this.handle);return this.renderer.confirmChange(state,id,fields,e);},_deleteRecords:function(ids){var self=this;function doIt(){return self.model.deleteRecords(ids,self.modelName).then(self._onDeletedRecords.bind(self,ids));}
if(this.confirmOnDelete){Dialog.confirm(this,_t("Are you sure you want to delete this record ?"),{confirm_callback:doIt,});}else{doIt();}},_disableButtons:function(){if(this.$buttons){this.$buttons.find('button').attr('disabled',true);}},_discardChanges:function(recordID,options){var self=this;recordID=recordID||this.handle;return this.canBeDiscarded(recordID).then(function(needDiscard){if(options&&options.readonlyIfRealDiscard&&!needDiscard){return;}
self.model.discardChanges(recordID);if(self.model.canBeAbandoned(recordID)){self._abandonRecord(recordID);return;}
return self._confirmSave(recordID);});},_enableButtons:function(){if(this.$buttons){this.$buttons.find('button').removeAttr('disabled');}},_getSidebarEnv:function(){return{context:this.model.get(this.handle).getContext(),activeIds:this.getSelectedIds(),model:this.modelName,};},_notifyInvalidFields:function(invalidFields){var record=this.model.get(this.handle,{raw:true});var fields=record.fields;var warnings=invalidFields.map(function(fieldName){var fieldStr=fields[fieldName].string;return _.str.sprintf('<li>%s</li>',_.escape(fieldStr));});warnings.unshift('<ul>');warnings.push('</ul>');this.do_warn(_t("The following fields are invalid:"),warnings.join(''));},_onDeletedRecords:function(ids){this.update({});},_saveRecord:function(recordID,options){recordID=recordID||this.handle;options=_.defaults(options||{},{stayInEdit:false,reload:true,savePoint:false,});if(this.canBeSaved(recordID)){var self=this;var saveDef=this.model.save(recordID,{reload:options.reload,savePoint:options.savePoint,viewType:options.viewType,});if(!options.stayInEdit){saveDef=saveDef.then(function(fieldNames){var def=fieldNames.length?self._confirmSave(recordID):self._setMode('readonly',recordID);return def.then(function(){return fieldNames;});});}
return saveDef;}else{return $.Deferred().reject();}},_setMode:function(mode,recordID){if((recordID||this.handle)===this.handle){return this.update({mode:mode},{reload:false}).then(function(){core.bus.trigger('DOM_updated');});}
return $.when();},_updateEnv:function(){var env=this.model.get(this.handle,{env:true});if(this.sidebar){var sidebarEnv=this._getSidebarEnv();this.sidebar.updateEnv(sidebarEnv);}
this.trigger_up('env_updated',{controllerID:this.controllerID,env:env});},_updatePager:function(){if(this.pager){var data=this.model.get(this.handle,{raw:true});this.pager.updateState({current_min:data.offset+1,size:data.count,});var isRecord=data.type==='record';var hasData=!!data.count;var isGrouped=data.groupedBy?!!data.groupedBy.length:false;var isNew=this.model.isNew(this.handle);var isPagerVisible=isRecord?!isNew:(hasData&&!isGrouped);this.pager.do_toggle(isPagerVisible);}},_onDiscardChanges:function(ev){var self=this;ev.stopPropagation();var recordID=ev.data.recordID;this._discardChanges(recordID).done(function(){self._confirmChange(recordID,[ev.data.fieldName],ev).always(ev.data.onSuccess);}).fail(ev.data.onFailure);},_onFieldChanged:function(ev){if(this.mode==='readonly'){ev.data.force_save=true;}
FieldManagerMixin._onFieldChanged.apply(this,arguments);},_onReload:function(event){event.stopPropagation();var data=event&&event.data||{};var handle=data.db_id;if(handle){this.model.reload(handle).then(this._confirmSave.bind(this,handle));}else{this.reload({fieldNames:data.fieldNames,keepChanges:data.keepChanges||false,});}},_onSetDirty:function(ev){ev.stopPropagation();this.model.setDirty(ev.data.dataPointID);},_onSidebarDataAsked:function(event){var sidebarEnv=this._getSidebarEnv();event.data.callback(sidebarEnv);},_onTranslate:function(event){event.stopPropagation();var self=this;var record=this.model.get(event.data.id,{raw:true});this._rpc({route:'/web/dataset/call_button',params:{model:'ir.translation',method:'translate_fields',args:[record.model,record.res_id,event.data.fieldName,record.getContext()],}}).then(function(result){self.do_action(result,{on_reverse_breadcrumb:function(){if(!_.isEmpty(self.renderer.alertFields)){self.renderer.displayTranslationAlert();}
return false;},});});},});return BasicController;});;

/* /web/static/src/js/views/basic/basic_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.BasicRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var config=require('web.config');var core=require('web.core');var dom=require('web.dom');var widgetRegistry=require('web.widget_registry');var qweb=core.qweb;var BasicRenderer=AbstractRenderer.extend({custom_events:{navigation_move:'_onNavigationMove',},init:function(parent,state,params){this._super.apply(this,arguments);this.activeActions=params.activeActions;this.viewType=params.viewType;this.mode=params.mode||'readonly';this.widgets=[];},canBeSaved:function(recordID){var self=this;var invalidFields=[];_.each(this.allFieldWidgets[recordID],function(widget){var canBeSaved=self._canWidgetBeSaved(widget);if(!canBeSaved){invalidFields.push(widget.name);}
if(widget.el){widget.$el.toggleClass('o_field_invalid',!canBeSaved);widget.$el.attr('aria-invalid',!canBeSaved);}});return invalidFields;},commitChanges:function(recordID){var defs=_.map(this.allFieldWidgets[recordID],function(widget){return widget.commitChanges();});return $.when.apply($,defs);},confirmChange:function(state,id,fields,ev){this.state=state;var record=state.id===id?state:_.findWhere(state.data,{id:id});if(!record){return this._render().then(_.constant([]));}
_.invoke(this.widgets,'updateState',state);var defs=[];var resetWidgets=[];_.each(this.allFieldWidgets[id],function(widget){var fieldChanged=_.contains(fields,widget.name);if(fieldChanged||widget.resetOnAnyFieldChange){defs.push(widget.reset(record,ev,fieldChanged));resetWidgets.push(widget);}});defs.push(this._updateAllModifiers(record));return $.when.apply($,defs).then(function(){return resetWidgets;});},focusField:function(id,fieldName,offset){this.editRecord(id);if(typeof offset==="number"){var field=_.findWhere(this.allFieldWidgets[id],{name:fieldName});dom.setSelectionRange(field.getFocusableElement().get(0),{start:offset,end:offset});}},_addFieldTooltip:function(widget,$node){$node=$node.length?$node:widget.$el;$node.tooltip({title:function(){return qweb.render('WidgetLabel.tooltip',{debug:config.debug,widget:widget,});}});},_activateFieldWidget:function(record,currentIndex,options){options=options||{};_.defaults(options,{inc:1,wrap:false});currentIndex=Math.max(0,currentIndex);var recordWidgets=this.allFieldWidgets[record.id]||[];for(var i=0;i<recordWidgets.length;i++){var activated=recordWidgets[currentIndex].activate({event:options.event,noAutomaticCreate:options.noAutomaticCreate||false});if(activated){return currentIndex;}
currentIndex+=options.inc;if(currentIndex>=recordWidgets.length){if(options.wrap){currentIndex-=recordWidgets.length;}else{return-1;}}else if(currentIndex<0){if(options.wrap){currentIndex+=recordWidgets.length;}else{return-1;}}}
return-1;},_activateNextFieldWidget:function(record,currentIndex,options){currentIndex=(currentIndex+1)%(this.allFieldWidgets[record.id]||[]).length;return this._activateFieldWidget(record,currentIndex,_.extend({inc:1},options));},_activatePreviousFieldWidget:function(record,currentIndex){currentIndex=currentIndex?(currentIndex-1):((this.allFieldWidgets[record.id]||[]).length-1);return this._activateFieldWidget(record,currentIndex,{inc:-1});},_applyModifiers:function(modifiersData,record,element){var self=this;var modifiers=modifiersData.evaluatedModifiers[record.id]||{};if(element){_apply(element);}else{_.each(_.clone(modifiersData.elementsByRecord[record.id]),_apply);}
function _apply(element){if('readonly'in modifiers&&element.widget){var mode=modifiers.readonly?'readonly':modifiersData.baseModeByRecord[record.id];if(mode!==element.widget.mode){self._rerenderFieldWidget(element.widget,record,{keepBaseMode:true,mode:mode,});return;}}
element.$el.toggleClass("o_invisible_modifier",!!modifiers.invisible);element.$el.toggleClass("o_readonly_modifier",!!modifiers.readonly);element.$el.toggleClass("o_required_modifier",!!modifiers.required);if(element.widget&&element.widget.updateModifiersValue){element.widget.updateModifiersValue(modifiers);}
if(element.callback){element.callback(element,modifiers,record);}}},_canWidgetBeSaved:function(widget){var modifiers=this._getEvaluatedModifiers(widget.__node,widget.record);return widget.isValid()&&(widget.isSet()||!modifiers.required);},_destroyFieldWidget:function(recordID,widget){var recordWidgets=this.allFieldWidgets[recordID];var index=recordWidgets.indexOf(widget);if(index>=0){recordWidgets.splice(index,1);}
this._unregisterModifiersElement(widget.__node,recordID,widget);widget.destroy();return index;},_getEvaluatedModifiers:function(node,record){var element=this._getModifiersData(node);if(!element){return{};}
return element.evaluatedModifiers[record.id]||{};},_getModifiersData:function(node){return _.findWhere(this.allModifiersData,{node:node});},_handleAttributes:function($el,node){if($el.is('button')){return;}
if(node.attrs.class){$el.addClass(node.attrs.class);}
if(node.attrs.style){$el.attr('style',node.attrs.style);}},_hasContent:function(){return this.state.count!==0;},_postProcessField:function(widget,node){},_registerModifiers:function(node,record,element,options){options=options||{};var modifiersData=this._getModifiersData(node);if(!modifiersData){var modifiers=node.attrs.modifiers||{};modifiersData={node:node,modifiers:modifiers,evaluatedModifiers:{},elementsByRecord:{},baseModeByRecord:{},};if(!_.isEmpty(modifiers)){this.allModifiersData.push(modifiersData);}}
if(!modifiersData.baseModeByRecord[record.id]||!options.keepBaseMode){modifiersData.baseModeByRecord[record.id]=options.mode||this.mode;}
if(!modifiersData.evaluatedModifiers[record.id]){modifiersData.evaluatedModifiers[record.id]=record.evalModifiers(modifiersData.modifiers);}
if(element){var newElement={};if(element instanceof jQuery){newElement.$el=element;}else{newElement.widget=element;newElement.$el=element.$el;}
if(options&&options.callback){newElement.callback=options.callback;}
if(!modifiersData.elementsByRecord[record.id]){modifiersData.elementsByRecord[record.id]=[];}
modifiersData.elementsByRecord[record.id].push(newElement);this._applyModifiers(modifiersData,record,newElement,options);}
return modifiersData.evaluatedModifiers[record.id];},_render:function(){var oldAllFieldWidgets=this.allFieldWidgets;this.allFieldWidgets={};this.allModifiersData=[];return this._renderView().then(function(){_.each(oldAllFieldWidgets,function(recordWidgets){_.each(recordWidgets,function(widget){widget.destroy();});});});},_renderButtonFromNode:function(node,options){var btnOptions={attrs:_.omit(node.attrs,'icon','string','type','attrs','modifiers','options'),icon:node.attrs.icon,};if(options&&options.extraClass){var classes=btnOptions.attrs.class?btnOptions.attrs.class.split(' '):[];btnOptions.attrs.class=_.uniq(classes.concat(options.extraClass.split(' '))).join(' ');}
var str=(node.attrs.string||'').replace(/_/g,'');if(str){if(options&&options.textAsTitle){btnOptions.attrs.title=str;}else{btnOptions.text=str;}}
return dom.renderButton(btnOptions);},_renderFieldWidget:function(node,record,options){options=options||{};var fieldName=node.attrs.name;var mode=options.mode||this.mode;var modifiers=this._registerModifiers(node,record,null,options);var Widget=record.fieldsInfo[this.viewType][fieldName].Widget;var widget=new Widget(this,fieldName,record,{mode:modifiers.readonly?'readonly':mode,viewType:this.viewType,});if(this.allFieldWidgets[record.id]===undefined){this.allFieldWidgets[record.id]=[];}
this.allFieldWidgets[record.id].push(widget);widget.__node=node;var def=widget._widgetRenderAndInsert(function(){});var async=def.state()==='pending';var $el=async?$('<div>'):widget.$el;if(async){this.defs.push(def);}
var self=this;def.then(function(){if(async){$el.replaceWith(widget.$el);}
self._registerModifiers(node,record,widget,{callback:function(element,modifiers,record){element.$el.toggleClass('o_field_empty',!!(record.data.id&&(modifiers.readonly||mode==='readonly')&&!element.widget.isSet()));},keepBaseMode:!!options.keepBaseMode,mode:mode,});self._postProcessField(widget,node);});return $el;},_renderNoContentHelper:function(){var $noContent=$('<div>').html(this.noContentHelp).addClass('o_nocontent_help');return $('<div>').addClass('o_view_nocontent').append($noContent);},_renderView:function(){return $.when();},_renderWidget:function(record,node){var Widget=widgetRegistry.get(node.attrs.name);var widget=new Widget(this,record,node);this.widgets.push(widget);var def=widget._widgetRenderAndInsert(function(){});var async=def.state()==='pending';if(async){this.defs.push(def);}
var $el=async?$('<div>'):widget.$el;var self=this;def.then(function(){self._handleAttributes(widget.$el,node);self._registerModifiers(node,record,widget);widget.$el.addClass('o_widget');if(async){$el.replaceWith(widget.$el);}});return $el;},_rerenderFieldWidget:function(widget,record,options){var $el=this._renderFieldWidget(widget.__node,record,options);widget.$el.replaceWith($el);var oldIndex=this._destroyFieldWidget(record.id,widget);var recordWidgets=this.allFieldWidgets[record.id];var newWidget=recordWidgets.pop();recordWidgets.splice(oldIndex,0,newWidget);},_unregisterModifiersElement:function(node,recordID,element){var modifiersData=this._getModifiersData(node);if(modifiersData){var elements=modifiersData.elementsByRecord[recordID];var index=_.findIndex(elements,function(oldElement){return oldElement.widget===element||oldElement.$el[0]===element[0];});if(index>=0){elements.splice(index,1);}}},_updateAllModifiers:function(record){var self=this;var defs=[];this.defs=defs;_.each(this.allModifiersData,function(modifiersData){modifiersData.evaluatedModifiers[record.id]=record.evalModifiers(modifiersData.modifiers);self._applyModifiers(modifiersData,record);});delete this.defs;return $.when.apply($,defs);},_onNavigationMove:function(ev){},});return BasicRenderer;});;

/* /web/static/src/js/views/field_manager_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('web.FieldManagerMixin',function(require){"use strict";var BasicModel=require('web.BasicModel');var concurrency=require('web.concurrency');var FieldManagerMixin={custom_events:{field_changed:'_onFieldChanged',load:'_onLoad',mutexify:'_onMutexify',},init:function(model){this.model=model||new BasicModel(this);this.mutex=new concurrency.Mutex();},_applyChanges:function(dataPointID,changes,event){var self=this;var options=_.pick(event.data,'context','doNotSetDirty','notifyChange','viewType','allowWarning');return this.model.notifyChanges(dataPointID,changes,options).then(function(result){if(event.data.force_save){return self.model.save(dataPointID).then(function(){return self._confirmSave(dataPointID);}).fail(function(){return self._rejectSave(dataPointID);});}else if(options.notifyChange!==false){return self._confirmChange(dataPointID,result,event);}});},_confirmChange:function(id,fields,event){return $.when();},_confirmSave:function(id){return $.when();},_rejectSave:function(id){return $.when();},_onFieldChanged:function(event){event.stopPropagation();this._applyChanges(event.data.dataPointID,event.data.changes,event).done(event.data.onSuccess||function(){}).fail(event.data.onFailure||function(){});},_onLoad:function(event){var self=this;event.stopPropagation();var data=event.data;if(!data.on_success){return;}
var params={};if('limit'in data){params.limit=data.limit;}
if('offset'in data){params.offset=data.offset;}
this.mutex.exec(function(){return self.model.reload(data.id,params).then(function(db_id){data.on_success(self.model.get(db_id));});});},_onMutexify:function(ev){ev.stopPropagation();this.mutex.exec(ev.data.action);},};return FieldManagerMixin;});;

/* /web/static/src/js/views/standalone_field_manager_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('web.StandaloneFieldManagerMixin',function(require){"use strict";var FieldManagerMixin=require('web.FieldManagerMixin');var StandaloneFieldManagerMixin=_.extend({},FieldManagerMixin,{init:function(){FieldManagerMixin.init.apply(this,arguments);this.registeredWidgets={};},_confirmChange:function(id,fields,event){var result=FieldManagerMixin._confirmChange.apply(this,arguments);var record=this.model.get(id);_.each(this.registeredWidgets[id],function(widget,fieldName){if(_.contains(fields,fieldName)){widget.reset(record,event);}});return result;},_registerWidget:function(datapointID,fieldName,widget){if(!this.registeredWidgets[datapointID]){this.registeredWidgets[datapointID]={};}
this.registeredWidgets[datapointID][fieldName]=widget;},});return StandaloneFieldManagerMixin;});;

/* /web/static/src/js/views/view_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.view_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});odoo.define('web._view_registry',function(require){"use strict";var FormView=require('web.FormView');var GraphView=require('web.GraphView');var KanbanView=require('web.KanbanView');var ListView=require('web.ListView');var PivotView=require('web.PivotView');var CalendarView=require('web.CalendarView');var view_registry=require('web.view_registry');view_registry.add('form',FormView).add('list',ListView).add('kanban',KanbanView).add('graph',GraphView).add('pivot',PivotView).add('calendar',CalendarView);});;

/* /web/static/src/js/views/view_dialogs.js defined in bundle 'web.assets_backend' */
odoo.define('web.view_dialogs',function(require){"use strict";var config=require('web.config');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var dom=require('web.dom');var ListController=require('web.ListController');var ListView=require('web.ListView');var pyUtils=require('web.py_utils');var SearchView=require('web.SearchView');var view_registry=require('web.view_registry');var _t=core._t;var ViewDialog=Dialog.extend({custom_events:_.extend({},Dialog.prototype.custom_events,{push_state:'_onPushState',env_updated:function(event){event.stopPropagation();},}),init:function(parent,options){options=options||{};options.fullscreen=config.device.isMobile;options.dialogClass=options.dialogClass||''+' o_act_window';this._super(parent,$.extend(true,{},options));this.res_model=options.res_model||null;this.domain=options.domain||[];this.context=options.context||{};this.options=_.extend(this.options||{},options||{});this.dataset=new data.DataSet(this,this.res_model,this.context);},_onPushState:function(event){event.stopPropagation();},});var FormViewDialog=ViewDialog.extend({init:function(parent,options){var self=this;options=options||{};this.res_id=options.res_id||null;this.on_saved=options.on_saved||(function(){});this.on_remove=options.on_remove||(function(){});this.context=options.context;this.model=options.model;this.parentID=options.parentID;this.recordID=options.recordID;this.shouldSaveLocally=options.shouldSaveLocally;this.readonly=options.readonly;this.deletable=options.deletable;this.disable_multiple_selection=options.disable_multiple_selection;var multi_select=!_.isNumber(options.res_id)&&!options.disable_multiple_selection;var readonly=_.isNumber(options.res_id)&&options.readonly;if(!options.buttons){options.buttons=[{text:(readonly?_t("Close"):_t("Discard")),classes:"btn-secondary o_form_button_cancel",close:true,click:function(){if(!readonly){self.form_view.model.discardChanges(self.form_view.handle,{rollback:self.shouldSaveLocally,});}},}];if(!readonly){options.buttons.unshift({text:(multi_select?_t("Save & Close"):_t("Save")),classes:"btn-primary",click:function(){this._save().then(self.close.bind(self));}});if(multi_select){options.buttons.splice(1,0,{text:_t("Save & New"),classes:"btn-primary",click:function(){this._save().then(self.form_view.createRecord.bind(self.form_view,self.parentID));},});}
var multi=options.disable_multiple_selection;if(!multi&&this.deletable){options.buttons.push({text:_t("Remove"),classes:'btn-secondary o_btn_remove',click:this._remove.bind(this),});}}}
this._super(parent,options);},open:function(){var self=this;var _super=this._super.bind(this);var FormView=view_registry.get('form');var fields_view_def;if(this.options.fields_view){fields_view_def=$.when(this.options.fields_view);}else{fields_view_def=this.loadFieldView(this.dataset,this.options.view_id,'form');}
fields_view_def.then(function(viewInfo){var refinedContext=_.pick(self.context,function(value,key){return key.indexOf('_view_ref')===-1;});var formview=new FormView(viewInfo,{modelName:self.res_model,context:refinedContext,ids:self.res_id?[self.res_id]:[],currentId:self.res_id||undefined,index:0,mode:self.res_id&&self.options.readonly?'readonly':'edit',footerToButtons:true,default_buttons:false,withControlPanel:false,model:self.model,parentID:self.parentID,recordID:self.recordID,});return formview.getController(self);}).then(function(formView){self.form_view=formView;var fragment=document.createDocumentFragment();if(self.recordID&&self.shouldSaveLocally){self.model.save(self.recordID,{savePoint:true});}
self.form_view.appendTo(fragment).then(function(){self.opened().always(function(){var $buttons=$('<div>');self.form_view.renderButtons($buttons);if($buttons.children().length){self.$footer.empty().append($buttons.contents());}
dom.append(self.$el,fragment,{callbacks:[{widget:self.form_view}],in_DOM:true,});});_super();});});return this;},_focusOnClose:function(){var isFocusSet=false;this.trigger_up('form_dialog_discarded',{callback:function(isFocused){isFocusSet=isFocused;},});return isFocusSet;},_remove:function(){this.on_remove();this.close();},_save:function(){var self=this;return this.form_view.saveRecord(this.form_view.handle,{stayInEdit:true,reload:false,savePoint:this.shouldSaveLocally,viewType:'form',}).then(function(changedFields){var record=self.form_view.model.get(self.form_view.handle);self.on_saved(record,!!changedFields.length);});},});var SelectCreateListController=ListController.extend({custom_events:_.extend({},ListController.prototype.custom_events,{open_record:function(event){var selectedRecord=this.model.get(event.data.id);this.trigger_up('select_record',{id:selectedRecord.res_id,display_name:selectedRecord.data.display_name,});},}),});var SelectCreateDialog=ViewDialog.extend({custom_events:_.extend({},ViewDialog.prototype.custom_events,{select_record:function(event){if(!this.options.readonly){this.on_selected([event.data]);this.close();}},selection_changed:function(event){event.stopPropagation();this.$footer.find(".o_select_button").prop('disabled',!event.data.selection.length);},search:function(event){event.stopPropagation();var d=event.data;var searchData=this._process_search_data(d.domains,d.contexts,d.groupbys);this.list_controller.reload(_.extend({offset:0},searchData));},get_controller_context:'_onGetControllerContext',}),init:function(){this._super.apply(this,arguments);_.defaults(this.options,{initial_view:'search'});this.on_selected=this.options.on_selected||(function(){});this.initial_ids=this.options.initial_ids;},open:function(){if(this.options.initial_view!=="search"){return this.create_edit_record();}
var self=this;var user_context=this.getSession().user_context;var _super=this._super.bind(this);var context=pyUtils.eval_domains_and_contexts({domains:[],contexts:[user_context,this.context]}).context;var search_defaults={};_.each(context,function(value_,key){var match=/^search_default_(.*)$/.exec(key);if(match){search_defaults[match[1]]=value_;}});this.loadViews(this.dataset.model,this.dataset.get_context().eval(),[[false,'list'],[false,'search']],{}).then(this.setup.bind(this,search_defaults)).then(function(fragment){self.opened().then(function(){dom.append(self.$el,fragment,{callbacks:[{widget:self.list_controller}],in_DOM:true,});self.set_buttons(self.__buttons);});_super();});return this;},setup:function(search_defaults,fields_views){var self=this;var fragment=document.createDocumentFragment();var searchDef=$.Deferred();var $header=$('<div/>').addClass('o_modal_header').appendTo(fragment);var $pager=$('<div/>').addClass('o_pager').appendTo($header);var options={$buttons:$('<div/>').addClass('o_search_options').appendTo($header),search_defaults:search_defaults,};var searchview=new SearchView(this,this.dataset,fields_views.search,options);searchview.prependTo($header).done(function(){var d=searchview.build_search_data();if(self.initial_ids&&!searchview.hasFavorites){d.domains.push([["id","in",self.initial_ids]]);self.initial_ids=undefined;}
var searchData=self._process_search_data(d.domains,d.contexts,d.groupbys);searchDef.resolve(searchData);});return $.when(searchDef).then(function(searchResult){var listView=new ListView(fields_views.list,_.extend({context:searchResult.context,domain:searchResult.domain,groupBy:searchResult.groupBy,modelName:self.dataset.model,hasSelectors:!self.options.disable_multiple_selection,readonly:true,},self.options.list_view_options));listView.setController(SelectCreateListController);return listView.getController(self);}).then(function(controller){self.list_controller=controller;self.__buttons=[{text:_t("Cancel"),classes:"btn-secondary o_form_button_cancel",close:true,}];if(!self.options.no_create){self.__buttons.unshift({text:_t("Create"),classes:"btn-primary",click:self.create_edit_record.bind(self)});}
if(!self.options.disable_multiple_selection){self.__buttons.unshift({text:_t("Select"),classes:"btn-primary o_select_button",disabled:true,close:true,click:function(){var records=self.list_controller.getSelectedRecords();var values=_.map(records,function(record){return{id:record.res_id,display_name:record.data.display_name,};});self.on_selected(values);},});}
return self.list_controller.appendTo(fragment);}).then(function(){searchview.toggle_visibility(true);self.list_controller.do_show();self.list_controller.renderPager($pager);return fragment;});},_process_search_data:function(domains,contexts,groupbys){var results=pyUtils.eval_domains_and_contexts({domains:[this.domain].concat(domains),contexts:[this.context].concat(contexts),group_by_seq:groupbys||[],eval_context:this.getSession().user_context,});var context=_.omit(results.context,function(value,key){return key.indexOf('search_default_')===0;});return{context:context,domain:results.domain,groupBy:results.group_by,};},create_edit_record:function(){var self=this;var dialog=new FormViewDialog(this,_.extend({},this.options,{on_saved:function(record){var values=[{id:record.res_id,display_name:record.data.display_name||record.data.name,}];self.on_selected(values);},})).open();dialog.on('closed',this,this.close);return dialog;},_focusOnClose:function(){var isFocusSet=false;this.trigger_up('form_dialog_discarded',{callback:function(isFocused){isFocusSet=isFocused;},});return isFocusSet;},_onGetControllerContext:function(ev){ev.stopPropagation();var context=this.list_controller&&this.list_controller.getContext();ev.data.callback(context||{});}});return{FormViewDialog:FormViewDialog,SelectCreateDialog:SelectCreateDialog,};});;

/* /web/static/src/js/views/form/form_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.FormRenderer',function(require){"use strict";var BasicRenderer=require('web.BasicRenderer');var config=require('web.config');var core=require('web.core');var dom=require('web.dom');var _t=core._t;var qweb=core.qweb;var FormRenderer=BasicRenderer.extend({className:"o_form_view",events:_.extend({},BasicRenderer.prototype.events,{'click .o_notification_box .oe_field_translate':'_onTranslate','click .o_notification_box .close':'_onTranslateNotificationClose','click .oe_title, .o_inner_group':'_onClick',}),custom_events:_.extend({},BasicRenderer.prototype.custom_events,{'navigation_move':'_onNavigationMove','activate_next_widget':'_onActivateNextWidget',}),INNER_GROUP_COL:2,OUTER_GROUP_COL:2,init:function(){this._super.apply(this,arguments);this.idsForLabels={};this.lastActivatedFieldIndex=-1;this.alertFields={};},start:function(){if(config.device.size_class<=config.device.SIZES.XS){this.$el.addClass('o_xxs_form_view');}
return this._super.apply(this,arguments);},autofocus:function(){if(this.mode==='readonly'){var firstPrimaryFormButton=this.$el.find('button.btn-primary:enabled:visible:first()');if(firstPrimaryFormButton.length>0){return firstPrimaryFormButton.focus();}else{return;}}
var focusWidget=this.defaultFocusField;if(!focusWidget||!focusWidget.isFocusable()){var widgets=this.allFieldWidgets[this.state.id];for(var i=0;i<(widgets?widgets.length:0);i++){var widget=widgets[i];if(widget.isFocusable()){focusWidget=widget;break;}}}
if(focusWidget){return focusWidget.activate({noselect:true,noAutomaticCreate:true});}},canBeSaved:function(){var self=this;var fieldNames=this._super.apply(this,arguments);var $labels=this.$('label');$labels.removeClass('o_field_invalid');_.each(fieldNames,function(fieldName){var idForLabel=self.idsForLabels[fieldName];if(idForLabel){$labels.filter('[for='+idForLabel+']').addClass('o_field_invalid');}});return fieldNames;},updateAlertFields:function(alertFields){this.alertFields[this.state.res_id]=_.extend(this.alertFields[this.state.res_id]||{},alertFields);this.displayTranslationAlert();},displayTranslationAlert:function(){this.$('.o_notification_box').remove();if(this.alertFields[this.state.res_id]){var $notification=$(qweb.render('notification-box',{type:'info'})).append(qweb.render('translation-alert',{fields:this.alertFields[this.state.res_id],lang:_t.database.parameters.name}));if(this.$('.o_form_statusbar').length){this.$('.o_form_statusbar').after($notification);}else if(this.$('.o_form_sheet_bg').length){this.$('.o_form_sheet_bg').prepend($notification);}else{this.$el.prepend($notification);}}},confirmChange:function(){var self=this;return this._super.apply(this,arguments).then(function(resetWidgets){_.each(resetWidgets,function(widget){self._setIDForLabel(widget,self.idsForLabels[widget.name]);});if(self.$('.o_field_invalid').length){self.canBeSaved(self.state.id);}
return resetWidgets;});},disableButtons:function(){this.$('.o_statusbar_buttons button, .oe_button_box button').attr('disabled',true);},enableButtons:function(){this.$('.o_statusbar_buttons button, .oe_button_box button').removeAttr('disabled');},focusLastActivatedWidget:function(){if(this.lastActivatedFieldIndex!==-1){return this._activateNextFieldWidget(this.state,this.lastActivatedFieldIndex-1,{noAutomaticCreate:true});}
return false;},getLocalState:function(){var state={};this.$('div.o_notebook').each(function(){var $notebook=$(this);var name=$notebook.data('name');var index=-1;$notebook.find('.nav-link').each(function(i){if($(this).hasClass('active')){index=i;}});state[name]=index;});return state;},resetLastActivatedField:function(){this.lastActivatedFieldIndex=-1;},setLocalState:function(state){this.$('div.o_notebook').each(function(){var $notebook=$(this);var name=$notebook.data('name');if(name in state){var $page=$notebook.find('> ul > li').eq(state[name]);if(!$page.hasClass('o_invisible_modifier')){$page.find('a[data-toggle="tab"]').click();}}});},updateState:function(state,params){this.mode=(params&&'mode'in params)?params.mode:this.mode;if(params.fieldNames){return this.confirmChange(state,state.id,params.fieldNames);}
return this._super.apply(this,arguments);},_activateNextFieldWidget:function(record,currentIndex){if((currentIndex+1)>=(this.allFieldWidgets[record.id]||[]).length){this.trigger_up('focus_control_button');this.lastActivatedFieldIndex=-1;}else{var activatedIndex=this._super.apply(this,arguments);if(activatedIndex===-1){this.trigger_up('focus_control_button');this.lastActivatedFieldIndex=-1;}
else{this.lastActivatedFieldIndex=activatedIndex;}}
return this.lastActivatedFieldIndex;},_addButtonTooltip:function(node,$button){var self=this;$button.tooltip({title:function(){return qweb.render('WidgetButton.tooltip',{debug:config.debug,state:self.state,node:node,});},});},_addOnClickAction:function($el,node){var self=this;$el.click(function(){self.trigger_up('button_clicked',{attrs:node.attrs,record:self.state,});});},_enableSwipe:function(){var self=this;if(!$.fn.swipe){return;}
this.$('.o_form_sheet').swipe({swipeLeft:function(){this.css({transform:'translateX(-100%)',transition:'350ms'});self.trigger_up('swipe_left');},swipeRight:function(){this.css({transform:'translateX(100%)',transition:'350ms'});self.trigger_up('swipe_right');},excludedElements:".o_notebook .nav.nav-tabs",});},_getIDForLabel:function(name){var idForLabel=this.idsForLabels[name];if(!idForLabel){idForLabel=_.uniqueId('o_field_input_');this.idsForLabels[name]=idForLabel;}
return idForLabel;},_postProcessField:function(widget,node){this._setIDForLabel(widget,this._getIDForLabel(node.attrs.name));this._handleAttributes(widget.$el,node);if(JSON.parse(node.attrs.default_focus||"0")){this.defaultFocusField=widget;}},_renderButtonBox:function(node){var self=this;var $result=$('<'+node.tag+'>',{'class':'o_not_full'});var buttons=_.map(node.children,function(child){if(child.tag==='button'){return self._renderStatButton(child);}else{return self._renderNode(child);}});var buttons_partition=_.partition(buttons,function($button){return $button.is('.o_invisible_modifier');});var invisible_buttons=buttons_partition[0];var visible_buttons=buttons_partition[1];var nb_buttons=this._renderButtonBoxNbButtons();var unfolded_buttons=visible_buttons.slice(0,nb_buttons).concat(invisible_buttons);var folded_buttons=visible_buttons.slice(nb_buttons);if(folded_buttons.length===1){unfolded_buttons=buttons;folded_buttons=[];}
var full=(visible_buttons.length>nb_buttons);$result.toggleClass('o_full',full).toggleClass('o_not_full',!full);_.each(unfolded_buttons,function($button){$button.appendTo($result);});if(folded_buttons.length){$result.append(dom.renderButton({attrs:{class:'oe_stat_button o_button_more dropdown-toggle','data-toggle':'dropdown',},text:_t("More"),}));var $dropdown=$("<div>",{'class':"dropdown-menu o_dropdown_more",role:"menu"});_.each(folded_buttons,function($button){$button.addClass('dropdown-item').appendTo($dropdown);});$dropdown.appendTo($result);}
this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);return $result;},_renderButtonBoxNbButtons:function(){return[2,2,2,4][config.device.size_class]||7;},_renderGenericTag:function(node){var $result=$('<'+node.tag+'>',_.omit(node.attrs,'modifiers'));this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);$result.append(_.map(node.children,this._renderNode.bind(this)));return $result;},_renderHeaderButton:function(node){var $button=this._renderButtonFromNode(node);if($button.not('.btn-primary, .btn-secondary, .btn-link, .btn-success, .btn-info, .btn-warning, .btn-danger').length){$button.addClass('btn-secondary');}
this._addOnClickAction($button,node);this._handleAttributes($button,node);this._registerModifiers(node,this.state,$button);if(config.debug||node.attrs.help){this._addButtonTooltip(node,$button);}
return $button;},_renderHeaderButtons:function(node){var self=this;var $buttons=$('<div>',{class:'o_statusbar_buttons'});_.each(node.children,function(child){if(child.tag==='button'){$buttons.append(self._renderHeaderButton(child));}
if(child.tag==='widget'){$buttons.append(self._renderTagWidget(child));}});return $buttons;},_renderInnerGroup:function(node){var self=this;var $result=$('<table/>',{class:'o_group o_inner_group'});this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);var col=parseInt(node.attrs.col,10)||this.INNER_GROUP_COL;if(node.attrs.string){var $sep=$('<tr><td colspan="'+col+'" style="width: 100%;"><div class="o_horizontal_separator">'+node.attrs.string+'</div></td></tr>');$result.append($sep);}
var rows=[];var $currentRow=$('<tr/>');var currentColspan=0;_.each(node.children,function(child){if(child.tag==='newline'){rows.push($currentRow);$currentRow=$('<tr/>');currentColspan=0;return;}
var colspan=parseInt(child.attrs.colspan,10);var isLabeledField=(child.tag==='field'&&child.attrs.nolabel!=='1');if(!colspan){if(isLabeledField){colspan=2;}else{colspan=1;}}
var finalColspan=colspan-(isLabeledField?1:0);currentColspan+=colspan;if(currentColspan>col){rows.push($currentRow);$currentRow=$('<tr/>');currentColspan=colspan;}
var $tds;if(child.tag==='field'){$tds=self._renderInnerGroupField(child);}else if(child.tag==='label'){$tds=self._renderInnerGroupLabel(child);}else{$tds=$('<td/>').append(self._renderNode(child));}
if(finalColspan>1){$tds.last().attr('colspan',finalColspan);}
$currentRow.append($tds);});rows.push($currentRow);_.each(rows,function($tr){var nonLabelColSize=100/(col-$tr.children('.o_td_label').length);_.each($tr.children(':not(.o_td_label)'),function(el){var $el=$(el);$el.css('width',((parseInt($el.attr('colspan'),10)||1)*nonLabelColSize)+'%');});$result.append($tr);});return $result;},_renderInnerGroupField:function(node){var $el=this._renderFieldWidget(node,this.state);var $tds=$('<td/>').append($el);if(node.attrs.nolabel!=='1'){var $labelTd=this._renderInnerGroupLabel(node);$tds=$labelTd.add($tds);}
return $tds;},_renderInnerGroupLabel:function(label){return $('<td/>',{class:'o_td_label'}).append(this._renderTagLabel(label));},_renderNode:function(node){var renderer=this['_renderTag'+_.str.capitalize(node.tag)];if(renderer){return renderer.call(this,node);}
if(node.tag==='div'&&node.attrs.name==='button_box'){return this._renderButtonBox(node);}
if(_.isString(node)){return node;}
return this._renderGenericTag(node);},_renderOuterGroup:function(node){var self=this;var $result=$('<div/>',{class:'o_group'});var nbCols=parseInt(node.attrs.col,10)||this.OUTER_GROUP_COL;var colSize=Math.max(1,Math.round(12/nbCols));if(node.attrs.string){var $sep=$('<div/>',{class:'o_horizontal_separator'}).text(node.attrs.string);$result.append($sep);}
$result.append(_.map(node.children,function(child){if(child.tag==='newline'){return $('<br/>');}
var $child=self._renderNode(child);$child.addClass('o_group_col_'+(colSize*(parseInt(child.attrs.colspan,10)||1)));return $child;}));this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);return $result;},_renderStatButton:function(node){var $button=this._renderButtonFromNode(node,{extraClass:'oe_stat_button',});$button.append(_.map(node.children,this._renderNode.bind(this)));if(node.attrs.help){this._addButtonTooltip(node,$button);}
this._addOnClickAction($button,node);this._handleAttributes($button,node);this._registerModifiers(node,this.state,$button);return $button;},_renderTabHeader:function(page,page_id){var $a=$('<a>',{'data-toggle':'tab',disable_anchor:'true',href:'#'+page_id,class:'nav-link',role:'tab',text:page.attrs.string,});return $('<li>',{class:'nav-item'}).append($a);},_renderTabPage:function(page,page_id){var $result=$('<div class="tab-pane" id="'+page_id+'">');$result.append(_.map(page.children,this._renderNode.bind(this)));return $result;},_renderTagButton:function(node){var $button=this._renderButtonFromNode(node);$button.append(_.map(node.children,this._renderNode.bind(this)));this._addOnClickAction($button,node);this._handleAttributes($button,node);this._registerModifiers(node,this.state,$button);if(config.debug||node.attrs.help){this._addButtonTooltip(node,$button);}
return $button;},_renderTagField:function(node){return this._renderFieldWidget(node,this.state);},_renderTagForm:function(node){var $result=$('<div/>');if(node.attrs.class){$result.addClass(node.attrs.class);}
$result.append(_.map(node.children,this._renderNode.bind(this)));return $result;},_renderTagGroup:function(node){var isOuterGroup=_.some(node.children,function(child){return child.tag==='group';});if(!isOuterGroup){return this._renderInnerGroup(node);}
return this._renderOuterGroup(node);},_renderTagHeader:function(node){var self=this;var $statusbar=$('<div>',{class:'o_form_statusbar'});$statusbar.append(this._renderHeaderButtons(node));_.each(node.children,function(child){if(child.tag==='field'){var $el=self._renderFieldWidget(child,self.state);$statusbar.append($el);}});this._handleAttributes($statusbar,node);this._registerModifiers(node,this.state,$statusbar);return $statusbar;},_renderTagLabel:function(node){var self=this;var text;var fieldName=node.tag==='label'?node.attrs.for:node.attrs.name;if('string'in node.attrs){text=node.attrs.string;}else if(fieldName){text=this.state.fields[fieldName].string;}else{return this._renderGenericTag(node);}
var $result=$('<label>',{class:'o_form_label',for:this._getIDForLabel(fieldName),text:text,});if(node.tag==='label'){this._handleAttributes($result,node);}
var modifiersOptions;if(fieldName){modifiersOptions={callback:function(element,modifiers,record){var widgets=self.allFieldWidgets[record.id];var widget=_.findWhere(widgets,{name:fieldName});if(!widget){return;}
element.$el.toggleClass('o_form_label_empty',!!(record.data.id&&(modifiers.readonly||self.mode==='readonly')&&!widget.isSet()));},};}
this._registerModifiers(node,this.state,$result,modifiersOptions);return $result;},_renderTagNotebook:function(node){var self=this;var $headers=$('<ul class="nav nav-tabs">');var $pages=$('<div class="tab-content">');var autofocusTab=-1;var renderedTabs=_.map(node.children,function(child,index){var pageID=_.uniqueId('notebook_page_');var $header=self._renderTabHeader(child,pageID);var $page=self._renderTabPage(child,pageID);if(autofocusTab===-1&&child.attrs.autofocus==='autofocus'){autofocusTab=index;}
self._handleAttributes($header,child);$headers.append($header);$pages.append($page);return{$header:$header,$page:$page,node:child,};});if(renderedTabs.length){var tabToFocus=renderedTabs[Math.max(0,autofocusTab)];tabToFocus.$header.find('.nav-link').addClass('active');tabToFocus.$page.addClass('active');}
_.each(renderedTabs,function(tab){self._registerModifiers(tab.node,self.state,tab.$header,{callback:function(element,modifiers){var $link=element.$el.find('.nav-link');var $firstVisibleTab=$headers.find('li:not(.o_invisible_modifier):first() > a');if(modifiers.invisible&&$link.hasClass('active')){$link.removeClass('active');tab.$page.removeClass('active');$firstVisibleTab.addClass('active');$pages.find($firstVisibleTab.attr('href')).addClass('active');}
if(!modifiers.invisible){var $visibleTabs=$headers.find('li:not(.o_invisible_modifier)');if($visibleTabs.length===1){$firstVisibleTab.addClass('active');$pages.find($firstVisibleTab.attr('href')).addClass('active');}}},});});var $notebook=$('<div class="o_notebook">').data('name',node.attrs.name||'_default_').append($headers,$pages);this._registerModifiers(node,this.state,$notebook);this._handleAttributes($notebook,node);return $notebook;},_renderTagSeparator:function(node){var $separator=$('<div/>').addClass('o_horizontal_separator').text(node.attrs.string);this._handleAttributes($separator,node);this._registerModifiers(node,this.state,$separator);return $separator;},_renderTagSheet:function(node){this.has_sheet=true;var $sheet=$('<div>',{class:'clearfix o_form_sheet'});$sheet.append(_.map(node.children,this._renderNode.bind(this)));return $sheet;},_renderTagWidget:function(node){return this._renderWidget(this.state,node);},_renderView:function(){var self=this;var defs=[];this.defs=defs;var $form=this._renderNode(this.arch).addClass(this.className);delete this.defs;return $.when.apply($,defs).then(function(){self._updateView($form.contents());if(self.state.res_id in self.alertFields){self.displayTranslationAlert();}},function(){$form.remove();}).then(function(){if(self.lastActivatedFieldIndex>=0){self._activateNextFieldWidget(self.state,self.lastActivatedFieldIndex);}});},_updateView:function($newContent){var self=this;this.$el.html($newContent);this.$el.toggleClass('o_form_nosheet',!this.has_sheet);if(this.has_sheet){this.$el.children().not('.oe_chatter').wrapAll($('<div/>',{class:'o_form_sheet_bg'}));}
this.$el.toggleClass('o_form_editable',this.mode==='edit');this.$el.toggleClass('o_form_readonly',this.mode==='readonly');if(config.device.isMobile&&this.mode==='readonly'&&this.state.count>1){this._enableSwipe();}
_.each(this.allFieldWidgets[this.state.id],function(widget){var idForLabel=self.idsForLabels[widget.name];var $widgets=self.$('.o_field_widget[name='+widget.name+']');var $label=idForLabel?self.$('.o_form_label[for='+idForLabel+']'):$();$label=$label.eq($widgets.index(widget.$el));if(config.debug||widget.attrs.help||widget.field.help){self._addFieldTooltip(widget,$label);}
if(widget.attrs.widget==='upgrade_boolean'){widget.renderWithLabel($label);}});},_setIDForLabel:function(widget,idForLabel){widget.setIDForLabel(idForLabel);},_onActivateNextWidget:function(e){e.stopPropagation();var index=this.allFieldWidgets[this.state.id].indexOf(e.data.target);this._activateNextFieldWidget(this.state,index);},_onClick:function(){if(this.mode==='readonly'){this.trigger_up('bounce_edit');}},_onNavigationMove:function(ev){ev.stopPropagation();var index;if(ev.data.direction==="next"){index=this.allFieldWidgets[this.state.id].indexOf(ev.data.target||ev.target);this._activateNextFieldWidget(this.state,index);}else if(ev.data.direction==="previous"){index=this.allFieldWidgets[this.state.id].indexOf(ev.data.target);this._activatePreviousFieldWidget(this.state,index);}},_onTranslate:function(event){event.preventDefault();this.trigger_up('translate',{fieldName:event.target.name,id:this.state.id});},_onTranslateNotificationClose:function(ev){delete this.alertFields[this.state.res_id];},});return FormRenderer;});;

/* /web/static/src/js/views/form/form_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.FormController',function(require){"use strict";var BasicController=require('web.BasicController');var dialogs=require('web.view_dialogs');var core=require('web.core');var Dialog=require('web.Dialog');var Sidebar=require('web.Sidebar');var _t=core._t;var qweb=core.qweb;var FormController=BasicController.extend({custom_events:_.extend({},BasicController.prototype.custom_events,{bounce_edit:'_onBounceEdit',button_clicked:'_onButtonClicked',do_action:'_onDoAction',edited_list:'_onEditedList',open_one2many_record:'_onOpenOne2ManyRecord',open_record:'_onOpenRecord',toggle_column_order:'_onToggleColumnOrder',focus_control_button:'_onFocusControlButton',form_dialog_discarded:'_onFormDialogDiscarded',swipe_left:'_onSwipeLeft',swipe_right:'_onSwipeRight',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.actionButtons=params.actionButtons;this.disableAutofocus=params.disableAutofocus;this.footerToButtons=params.footerToButtons;this.defaultButtons=params.defaultButtons;this.hasSidebar=params.hasSidebar;this.toolbarActions=params.toolbarActions||{};},willRestore:function(){this.mode='readonly';},autofocus:function(){if(!this.disableAutofocus){var isControlActivted=this.renderer.autofocus();if(!isControlActivted){if(this.$buttons&&this.mode==='readonly'){return this.$buttons.find('.o_form_button_edit').focus();}}}},createRecord:function(parentID){var self=this;var record=this.model.get(this.handle,{raw:true});return this.model.load({context:record.getContext(),fields:record.fields,fieldsInfo:record.fieldsInfo,modelName:this.modelName,parentID:parentID,res_ids:record.res_ids,type:'record',viewType:'form',}).then(function(handle){self.handle=handle;self._updateEnv();return self._setMode('edit');});},getSelectedIds:function(){var env=this.model.get(this.handle,{env:true});return env.currentId?[env.currentId]:[];},getTitle:function(){return this.model.getName(this.handle);},on_attach_callback:function(){this._super.apply(this,arguments);this.autofocus();},renderButtons:function($node){var $footer=this.footerToButtons?this.$('footer'):null;var mustRenderFooterButtons=$footer&&$footer.length;if(!this.defaultButtons&&!mustRenderFooterButtons){return;}
this.$buttons=$('<div/>');if(mustRenderFooterButtons){this.$buttons.append($footer);}else{this.$buttons.append(qweb.render("FormView.buttons",{widget:this}));this.$buttons.on('click','.o_form_button_edit',this._onEdit.bind(this));this.$buttons.on('click','.o_form_button_create',this._onCreate.bind(this));this.$buttons.on('click','.o_form_button_save',this._onSave.bind(this));this.$buttons.on('click','.o_form_button_cancel',this._onDiscard.bind(this));this._assignSaveCancelKeyboardBehavior(this.$buttons.find('.o_form_buttons_edit'));this.$buttons.find('.o_form_buttons_edit').tooltip({delay:{show:200,hide:0},title:function(){return qweb.render('SaveCancelButton.tooltip');},trigger:'manual',});this._updateButtons();}
this.$buttons.appendTo($node);},renderPager:function($node,options){options=_.extend({},options,{validate:this.canBeDiscarded.bind(this),});this._super($node,options);},renderSidebar:function($node){if(this.hasSidebar){var otherItems=[];if(this.is_action_enabled('delete')){otherItems.push({label:_t('Delete'),callback:this._onDeleteRecord.bind(this),});}
if(this.is_action_enabled('create')&&this.is_action_enabled('duplicate')){otherItems.push({label:_t('Duplicate'),callback:this._onDuplicateRecord.bind(this),});}
this.sidebar=new Sidebar(this,{editable:this.is_action_enabled('edit'),viewType:'form',env:{context:this.model.get(this.handle).getContext(),activeIds:this.getSelectedIds(),model:this.modelName,},actions:_.extend(this.toolbarActions,{other:otherItems}),});this.sidebar.appendTo($node);this._updateSidebar();}},saveRecord:function(){var self=this;return this._super.apply(this,arguments).then(function(changedFields){self.set('title',self.getTitle());self._updateEnv();if(_t.database.multi_lang&&changedFields.length){var fields=self.renderer.state.fields;var data=self.renderer.state.data;var alertFields={};for(var k=0;k<changedFields.length;k++){var field=fields[changedFields[k]];var fieldData=data[changedFields[k]];if(field.translate&&fieldData&&fieldData!=='<p><br></p>'){alertFields[changedFields[k]]=field;}}
if(!_.isEmpty(alertFields)){self.renderer.updateAlertFields(alertFields);}}
return changedFields;});},update:function(params,options){params=_.extend({viewType:'form',mode:this.mode},params);return this._super(params,options);},_assignSaveCancelKeyboardBehavior:function($saveCancelButtonContainer){var self=this;$saveCancelButtonContainer.children().on('keydown',function(e){switch(e.which){case $.ui.keyCode.ENTER:e.preventDefault();self.saveRecord.apply(self);break;case $.ui.keyCode.ESCAPE:e.preventDefault();self._discardChanges.apply(self);break;case $.ui.keyCode.TAB:if(!e.shiftKey&&e.target.classList.contains("btn-primary")){$saveCancelButtonContainer.tooltip('show');e.preventDefault();}
break;}});},_confirmSave:function(id){if(id===this.handle){if(this.mode==='readonly'){return this.reload();}else{return this._setMode('readonly');}}else{var record=this.model.get(this.handle);var containsChangedRecord=function(value){return _.isObject(value)&&(value.id===id||_.find(value.data,containsChangedRecord));};var changedFields=_.findKey(record.data,containsChangedRecord);return this.renderer.confirmChange(record,record.id,[changedFields]);}},_disableButtons:function(){this._super.apply(this,arguments);this.renderer.disableButtons();},_enableButtons:function(){this._super.apply(this,arguments);this.renderer.enableButtons();},_onDeletedRecords:function(){var state=this.model.get(this.handle,{raw:true});if(!state.res_ids.length){this.trigger_up('history_back');}else{this._super.apply(this,arguments);}},_pushState:function(state){state=state||{};var env=this.model.get(this.handle,{env:true});state.id=env.currentId;this._super(state);},_rejectSave:function(){if(this.mode==='readonly'){return this.reload();}
return this._super.apply(this,arguments);},_setMode:function(mode,recordID){if((recordID||this.handle)===this.handle){this.model.unfreezeOrder(this.handle);}
if(this.mode!==mode){this.renderer.resetLastActivatedField();}
return this._super.apply(this,arguments);},_update:function(){var title=this.getTitle();this.set('title',title);this._updateButtons();this._updateSidebar();return this._super.apply(this,arguments).then(this.autofocus.bind(this));},_updateButtons:function(){if(this.$buttons){if(this.footerToButtons){var $footer=this.$('footer');if($footer.length){this.$buttons.empty().append($footer);}}
var edit_mode=(this.mode==='edit');this.$buttons.find('.o_form_buttons_edit').toggleClass('o_hidden',!edit_mode);this.$buttons.find('.o_form_buttons_view').toggleClass('o_hidden',edit_mode);}},_updateSidebar:function(){if(this.sidebar){this.sidebar.do_toggle(this.mode==='readonly');}},_onBounceEdit:function(){if(this.$buttons){this.$buttons.find('.o_form_button_edit').odooBounce();}},_onButtonClicked:function(event){event.stopPropagation();var self=this;var def;this._disableButtons();function saveAndExecuteAction(){return self.saveRecord(self.handle,{stayInEdit:true,}).then(function(){var record=self.model.get(event.data.record.id);return self._callButtonAction(attrs,record);});}
var attrs=event.data.attrs;if(attrs.confirm){var d=$.Deferred();Dialog.confirm(this,attrs.confirm,{confirm_callback:saveAndExecuteAction,}).on("closed",null,function(){d.resolve();});def=d.promise();}else if(attrs.special==='cancel'){def=this._callButtonAction(attrs,event.data.record);}else if(!attrs.special||attrs.special==='save'){def=saveAndExecuteAction();}
def.always(this._enableButtons.bind(this));},_onCreate:function(){this.createRecord();},_onDeleteRecord:function(){this._deleteRecords([this.handle]);},_onDiscard:function(){this._discardChanges();},_onDoAction:function(event){var self=this;var callback=event.data.on_success||function(){};event.data.on_success=function(){callback();function isDialog(widget){return(widget instanceof Dialog);}
_.invoke(self.getChildren().filter(isDialog),'destroy');};},_onDuplicateRecord:function(){var self=this;this.model.duplicateRecord(this.handle).then(function(handle){self.handle=handle;self._updateEnv();self._setMode('edit');});},_onEdit:function(){this.mutex.getUnlockedDef().then(this._setMode.bind(this,'edit'));},_onEditedList:function(ev){ev.stopPropagation();if(ev.data.id){this.model.save(ev.data.id,{savePoint:true});}
this.model.freezeOrder(ev.data.id);},_onFocusControlButton:function(e){if(this.$buttons){e.stopPropagation();this.$buttons.find('.btn-primary:visible:first()').focus();}},_onFormDialogDiscarded:function(ev){ev.stopPropagation();var isFocused=this.renderer.focusLastActivatedWidget();if(ev.data.callback){ev.data.callback(_.str.toBool(isFocused));}},_onOpenOne2ManyRecord:function(event){event.stopPropagation();var data=event.data;var record;if(data.id){record=this.model.get(data.id,{raw:true});}
new dialogs.FormViewDialog(this,{context:data.context,domain:data.domain,fields_view:data.fields_view,model:this.model,on_saved:data.on_saved,on_remove:data.on_remove,parentID:data.parentID,readonly:data.readonly,deletable:data.deletable,recordID:record&&record.id,res_id:record&&record.res_id,res_model:data.field.relation,shouldSaveLocally:true,title:(record?_t("Open: "):_t("Create "))+(event.target.string||data.field.string),}).open();},_onOpenRecord:function(event){event.stopPropagation();var self=this;var record=this.model.get(event.data.id,{raw:true});new dialogs.FormViewDialog(self,{context:event.data.context,fields_view:event.data.fields_view,on_saved:event.data.on_saved,on_remove:event.data.on_remove,readonly:event.data.readonly,deletable:event.data.deletable,res_id:record.res_id,res_model:record.model,title:_t("Open: ")+event.data.string,}).open();},_onSave:function(ev){ev.stopPropagation();var self=this;this._disableButtons();this.saveRecord().always(function(){self._enableButtons();});},_onSwipeLeft:function(ev){ev.stopPropagation();if(this.pager){this.pager.next();}},_onSwipeRight:function(ev){ev.stopPropagation();if(this.pager){this.pager.previous();}},_onToggleColumnOrder:function(event){event.stopPropagation();var self=this;this.model.setSort(event.data.id,event.data.name).then(function(){var field=event.data.field;var state=self.model.get(self.handle);self.renderer.confirmChange(state,state.id,[field]);});},});return FormController;});;

/* /web/static/src/js/views/form/form_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.FormView',function(require){"use strict";var BasicView=require('web.BasicView');var config=require('web.config');var Context=require('web.Context');var core=require('web.core');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var _lt=core._lt;var FormView=BasicView.extend({config:_.extend({},BasicView.prototype.config,{Renderer:FormRenderer,Controller:FormController,}),display_name:_lt('Form'),icon:'fa-edit',multi_record:false,searchable:false,jsLibs:[],viewType:'form',init:function(viewInfo,params){this._super.apply(this,arguments);var mode=params.mode||params.context.form_view_initial_mode||(params.currentId?'readonly':'edit');this.loadParams.type='record';this.controllerParams.disableAutofocus=params.disable_autofocus;this.controllerParams.hasSidebar=params.hasSidebar;this.controllerParams.toolbarActions=viewInfo.toolbar;this.controllerParams.footerToButtons=params.footerToButtons;if('action'in params&&'flags'in params.action){this.controllerParams.footerToButtons=params.action.flags.footerToButtons;}
var defaultButtons='default_buttons'in params?params.default_buttons:true;this.controllerParams.defaultButtons=defaultButtons;this.controllerParams.mode=mode;this.rendererParams.mode=mode;if(config.device.isMobile){this.jsLibs.push('/web/static/lib/jquery.touchSwipe/jquery.touchSwipe.js');}},getController:function(parent){return this._loadSubviews(parent).then(this._super.bind(this,parent));},_loadSubviews:function(parent){var self=this;var defs=[];if(this.loadParams&&this.loadParams.fieldsInfo){var fields=this.loadParams.fields;_.each(this.loadParams.fieldsInfo.form,function(attrs,fieldName){var field=fields[fieldName];if(!field){return;}
if(field.type!=='one2many'&&field.type!=='many2many'){return;}
if(attrs.Widget.prototype.useSubview&&!attrs.__no_fetch&&!attrs.views[attrs.mode]){var context={};var regex=/'([a-z]*_view_ref)' *: *'(.*?)'/g;var matches;while(matches=regex.exec(attrs.context)){context[matches[1]]=matches[2];}
var refinedContext=_.pick(self.loadParams.context,function(value,key){return key.indexOf('_view_ref')===-1;});refinedContext.base_model_name=self.controllerParams.modelName;defs.push(parent.loadViews(field.relation,new Context(context,self.userContext,refinedContext).eval(),[[null,attrs.mode==='tree'?'list':attrs.mode]]).then(function(views){for(var viewName in views){attrs.views[viewName]=self._processFieldsView(views[viewName],viewName);attrs.views[viewName].fields=attrs.views[viewName].viewFields;self._processSubViewAttrs(attrs.views[viewName],attrs);}
self._setSubViewLimit(attrs);}));}else{self._setSubViewLimit(attrs);}});}
return $.when.apply($,defs);},_setSubViewLimit:function(attrs){var view=attrs.views&&attrs.views[attrs.mode];var limit=view&&view.arch.attrs.limit&&parseInt(view.arch.attrs.limit,10);attrs.limit=limit||attrs.Widget.prototype.limit||40;},});return FormView;});;

/* /web/static/src/js/views/graph/graph_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');return AbstractModel.extend({init:function(){this._super.apply(this,arguments);this.chart=null;},get:function(){return _.extend({},this.chart,{fields:this.fields});},load:function(params){var groupBys=params.context.graph_groupbys||params.groupBys;this.initialGroupBys=groupBys;this.fields=params.fields;this.modelName=params.modelName;this.chart={compare:params.compare,comparisonTimeRange:params.comparisonTimeRange,data:[],groupedBy:params.groupedBy.length?params.groupedBy:groupBys,intervalMapping:params.intervalMapping,measure:params.context.graph_measure||params.measure,mode:params.context.graph_mode||params.mode,timeRange:params.timeRange,domain:params.domain,context:params.context,};return this._loadGraph();},reload:function(handle,params){if('context'in params){this.chart.context=params.context;this.chart.groupedBy=params.context.graph_groupbys||this.chart.groupedBy;this.chart.measure=params.context.graph_measure||this.chart.measure;this.chart.mode=params.context.graph_mode||this.chart.mode;var timeRangeMenuData=params.context.timeRangeMenuData;if(timeRangeMenuData){this.chart.timeRange=timeRangeMenuData.timeRange||[];this.chart.comparisonTimeRange=timeRangeMenuData.comparisonTimeRange||[];this.chart.compare=this.chart.comparisonTimeRange.length>0;}else{this.chart.timeRange=[];this.chart.comparisonTimeRange=[];this.chart.compare=false;this.chart=_.omit(this.chart,'comparisonData');}}
if('domain'in params){this.chart.domain=params.domain;}
if('groupBy'in params){this.chart.groupedBy=params.groupBy.length?params.groupBy:this.initialGroupBys;}
if('intervalMapping'in params){this.chart.intervalMapping=params.intervalMapping;}
if('measure'in params){this.chart.measure=params.measure;}
if('mode'in params){this.chart.mode=params.mode;return $.when();}
return this._loadGraph();},_loadGraph:function(){var groupedBy=this.chart.groupedBy;var fields=_.map(groupedBy,function(groupBy){return groupBy.split(':')[0];});if(this.chart.measure!=='__count__'){if(this.fields[this.chart.measure].type==='many2one'){fields=fields.concat(this.chart.measure+":count_distinct");}
else{fields=fields.concat(this.chart.measure);}}
var context=_.extend({fill_temporal:true},this.chart.context);var defs=[];defs.push(this._rpc({model:this.modelName,method:'read_group',context:context,domain:this.chart.domain.concat(this.chart.timeRange),fields:fields,groupBy:groupedBy,lazy:false,}).then(this._processData.bind(this,'data')));if(this.chart.compare){defs.push(this._rpc({model:this.modelName,method:'read_group',context:context,domain:this.chart.domain.concat(this.chart.comparisonTimeRange),fields:fields,groupBy:groupedBy,lazy:false,}).then(this._processData.bind(this,'comparisonData')));}
return $.when.apply($,defs);},_processData:function(dataKey,raw_data){var self=this;var is_count=this.chart.measure==='__count__';var data_pt,labels;this.chart[dataKey]=[];for(var i=0;i<raw_data.length;i++){data_pt=raw_data[i];labels=_.map(this.chart.groupedBy,function(field){return self._sanitizeValue(data_pt[field],field);});var count=data_pt.__count||data_pt[this.chart.groupedBy[0]+'_count']||0;var value=is_count?count:data_pt[this.chart.measure];if(value instanceof Array){value=1;}
this.chart[dataKey].push({count:count,value:value,labels:labels,});}},_sanitizeValue:function(value,field){var fieldName=field.split(':')[0];if(value===false&&this.fields[fieldName].type!=='boolean'){return undefined;}
if(value instanceof Array)return value[1];if(field&&(this.fields[fieldName].type==='selection')){var selected=_.where(this.fields[fieldName].selection,{0:value})[0];return selected?selected[1]:value;}
return value;},});});;

/* /web/static/src/js/views/graph/graph_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphController',function(require){"use strict";var core=require('web.core');var AbstractController=require('web.AbstractController');var GroupByMenuInterfaceMixin=require('web.GroupByMenuInterfaceMixin');var qweb=core.qweb;var GraphController=AbstractController.extend(GroupByMenuInterfaceMixin,{className:'o_graph',init:function(parent,model,renderer,params){GroupByMenuInterfaceMixin.init.call(this);this._super.apply(this,arguments);this.measures=params.measures;this.isEmbedded=params.isEmbedded;this.groupableFields=params.groupableFields;},destroy:function(){if(this.$buttons){this.$buttons.find('button').off().tooltip('dispose');}
this._super.apply(this,arguments);},getContext:function(){var state=this.model.get();return{graph_measure:state.measure,graph_mode:state.mode,graph_groupbys:state.groupedBy,graph_intervalMapping:state.intervalMapping,};},renderButtons:function($node){if($node){var context={measures:_.sortBy(_.pairs(_.omit(this.measures,'__count__')),function(x){return x[1].string.toLowerCase();}),};this.$buttons=$(qweb.render('GraphView.buttons',context));this.$measureList=this.$buttons.find('.o_graph_measures_list');this.$buttons.find('button').tooltip();this.$buttons.click(this._onButtonClick.bind(this));this._updateButtons();this.$buttons.appendTo($node);if(this.isEmbedded){this._addGroupByMenu($node,this.groupableFields);}}},_setGroupby:function(groupbys){this.update({groupBy:groupbys});},_setMode:function(mode){this.update({mode:mode});this._updateButtons();},_setMeasure:function(measure){var self=this;this.update({measure:measure}).then(function(){self._updateButtons();});},_update:function(){this._updateButtons();return this._super.apply(this,arguments);},_updateButtons:function(){if(!this.$buttons){return;}
var state=this.model.get();this.$buttons.find('.o_graph_button').removeClass('active');this.$buttons.find('.o_graph_button[data-mode="'+state.mode+'"]').addClass('active');_.each(this.$measureList.find('.dropdown-item'),function(item){var $item=$(item);$item.toggleClass('selected',$item.data('field')===state.measure);});},_onButtonClick:function(event){var $target=$(event.target);var field;if($target.hasClass('o_graph_button')){this._setMode($target.data('mode'));}else if($target.parents('.o_graph_measures_list').length){event.preventDefault();event.stopPropagation();field=$target.data('field');this._setMeasure(field);}},});return GraphController;});;

/* /web/static/src/js/views/graph/graph_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var config=require('web.config');var core=require('web.core');var field_utils=require('web.field_utils');var _t=core._t;var qweb=core.qweb;var CHART_TYPES=['pie','bar','line'];var MAX_LEGEND_LENGTH=25*(Math.max(1,config.device.size_class));var SPLIT_THRESHOLD=config.device.isMobile?Infinity:20;return AbstractRenderer.extend({className:"o_graph_container",init:function(parent,state,params){this._super.apply(this,arguments);this.isComparison=!!state.comparisonData;this.isEmbedded=params.isEmbedded;this.stacked=this.isComparison?false:params.stacked;this.title=params.title||'';},destroy:function(){nv.utils.offWindowResize(this.to_remove);this._super();},on_attach_callback:function(){this._super.apply(this,arguments);this.isInDOM=true;this._render();},on_detach_callback:function(){this._super.apply(this,arguments);this.isInDOM=false;},updateState:function(state,params){this.isComparison=!!state.comparisonData;this.stacked=this.isComparison?false:params.stacked;return this._super.apply(this,arguments);},_render:function(){if(this.to_remove){nv.utils.offWindowResize(this.to_remove);}
if(!_.contains(CHART_TYPES,this.state.mode)){this.$el.empty();this.trigger_up('warning',{title:_t('Invalid mode for chart'),message:_t('Cannot render chart with mode : ')+this.state.mode});}else if(!this.state.data.length&&this.state.mode!=='pie'){this.$el.empty();this.$el.append(qweb.render('GraphView.error',{title:_t("No data to display"),description:_t("Try to add some records, or make sure that "+"there is no active filter in the search bar."),}));}else if(this.isInDOM){this._renderGraph();}
return this._super.apply(this,arguments);},_renderBarChart:function(){var self=this;var data=[];var values;var measure=this.state.fields[this.state.measure].string;this.state.data.forEach(self._sanitizeLabel);if(this.state.groupedBy.length===0){data=[{values:[{x:measure,y:this.state.data[0].value}],key:measure}];}else if(this.state.groupedBy.length===1){values=this.state.data.map(function(datapt,index){return{x:datapt.labels,y:datapt.value};});data.push({values:values,key:measure,});if(this.state.comparisonData){values=this.state.comparisonData.map(function(datapt,index){return{x:datapt.labels,y:datapt.value};});data.push({values:values,key:measure+' (compare)',color:'#ff7f0e',});}}else if(this.state.groupedBy.length>1){var xlabels=[],series=[],label,serie,value;values={};for(var i=0;i<this.state.data.length;i++){label=this.state.data[i].labels[0];serie=this.state.data[i].labels[1];value=this.state.data[i].value;if((!xlabels.length)||(xlabels[xlabels.length-1]!==label)){xlabels.push(label);}
series.push(this.state.data[i].labels[1]);if(!(serie in values)){values[serie]={};}
values[serie][label]=this.state.data[i].value;}
series=_.uniq(series);data=[];var current_serie,j;for(i=0;i<series.length;i++){current_serie={values:[],key:series[i]};for(j=0;j<xlabels.length;j++){current_serie.values.push({x:xlabels[j],y:values[series[i]][xlabels[j]]||0,});}
data.push(current_serie);}}
if(this.state.groupedBy.length<=1){data[0].values=_.filter(data[0].values,function(elem,index){return self.state.data[index].count>0;});}
var $svgContainer=$('<div/>',{class:'o_graph_svg_container'});this.$el.append($svgContainer);var svg=d3.select($svgContainer[0]).append('svg');svg.datum(data);svg.transition().duration(0);var chart=nv.models.multiBarChart();chart.options({margin:{left:80,bottom:100,top:80,right:0},delay:100,transition:10,controlLabels:{'grouped':_t('Grouped'),'stacked':_t('Stacked'),},showLegend:_.size(data)<=MAX_LEGEND_LENGTH,showXAxis:true,showYAxis:true,rightAlignYAxis:false,stacked:this.stacked,reduceXTicks:false,rotateLabels:-20,showControls:(this.state.groupedBy.length>1)});chart.yAxis.tickFormat(function(d){var measure_field=self.state.fields[self.measure];return field_utils.format.float(d,{digits:measure_field&&measure_field.digits||[69,2],});});chart(svg);return chart;},_renderPieChart:function(stateData){var self=this;var data=[];var all_negative=true;var some_negative=false;var all_zero=true;stateData.forEach(self._sanitizeLabel);stateData.forEach(function(datapt){all_negative=all_negative&&(datapt.value<0);some_negative=some_negative||(datapt.value<0);all_zero=all_zero&&(datapt.value===0);});if(some_negative&&!all_negative){this.$el.append(qweb.render('GraphView.error',{title:_t("Invalid data"),description:_t("Pie chart cannot mix positive and negative numbers. "+"Try to change your domain to only display positive results"),}));return;}
if(all_zero){if(this.isEmbedded||this.isComparison){data=[{x:"No data",y:1}];}else{this.$el.append(qweb.render('GraphView.error',{title:_t("Invalid data"),description:_t("Pie chart cannot display all zero numbers.. "+"Try to change your domain to display positive results"),}));return;}}else{if(this.state.groupedBy.length){data=stateData.map(function(datapt){return{x:datapt.labels.join("/"),y:datapt.value};});}
data=_.filter(data,function(elem,index){return stateData[index].count>0;});}
var $svgContainer=$('<div/>',{class:'o_graph_svg_container'});this.$el.append($svgContainer);var svg=d3.select($svgContainer[0]).append('svg');svg.datum(data);svg.transition().duration(100);var color;var legend_right=config.device.size_class>config.device.SIZES.VSM;if(all_zero){color=(['lightgrey']);svg.append("text").attr("text-anchor","middle").attr("x","50%").attr("y","50%").text(_t("No data to display"));}else{color=d3.scale.category10().range();}
var chart=nv.models.pieChart().labelType('percent');chart.options({delay:250,showLegend:!all_zero&&(legend_right||_.size(data)<=MAX_LEGEND_LENGTH),legendPosition:legend_right?'right':'top',transition:100,color:color,showLabels:all_zero?false:true,});chart(svg);return chart;},_renderLineChart:function(){var self=this;var graphData=_.filter(this.state.data,function(elem){return elem.labels[0]!==undefined&&elem.labels[0]!==_t("Undefined");});this.state.data.forEach(self._sanitizeLabel);var data=[];var ticksLabels=[];var measure=this.state.fields[this.state.measure].string;var values;if(this.state.groupedBy.length===1){values=graphData.map(function(datapt,index){return{x:index,y:datapt.value};});data.push({area:true,values:values,key:measure,});if(this.state.comparisonData&&this.state.comparisonData.length>0){values=this.state.comparisonData.map(function(datapt,index){return{x:index,y:datapt.value};});data.push({values:values,key:measure+' (compare)',color:'#ff7f0e',});}
for(i=0;i<graphData.length;i++){ticksLabels.push(graphData[i].labels);}
if(this.state.comparisonData&&this.state.comparisonData.length>this.state.data.length){var diff=this.state.comparisonData.length-this.state.data.length;var length=self.state.data.length
var diffTime=0;if(length<self.state.data.length){var date1=moment(self.state.data[length-1].labels[0]);var date2=moment(self.state.data[length-2].labels[0]);diffTime=date1-date2;for(i=0;i<diff;i++){var value=moment(date1).add(diffTime+i*diffTime).format('DD MMM YYYY');ticksLabels.push([value]);}}}}else if(this.state.groupedBy.length>1){var data_dict={};var tick=0;var serie,tickLabel;var identity=function(p){return p;};for(var i=0;i<graphData.length;i++){if(graphData[i].labels[0]!==tickLabel){tickLabel=graphData[i].labels[0];ticksLabels.push(tickLabel);tick++;}
serie=graphData[i].labels[1];if(!data_dict[serie]){data_dict[serie]={values:[],key:serie,};}
data_dict[serie].values.push({x:tick-1,y:graphData[i].value,});data=_.map(data_dict,identity);}}
var $svgContainer=$('<div/>',{class:'o_graph_svg_container'});if(data.length>=SPLIT_THRESHOLD){$svgContainer.addClass('o_tooltip_split_in_columns');}
this.$el.append($svgContainer);var svg=d3.select($svgContainer[0]).append('svg');svg.datum(data);svg.transition().duration(0);var chart=nv.models.lineChart();chart.options({margin:{left:0,bottom:20,top:0,right:0},useInteractiveGuideline:true,showLegend:_.size(data)<=MAX_LEGEND_LENGTH,showXAxis:true,showYAxis:true,});chart.forceY([0]);chart.xAxis.tickFormat(function(d){return ticksLabels[d];});chart.yAxis.showMaxMin(false).tickFormat(function(d){return field_utils.format.float(d,{digits:self.state.fields[self.state.measure]&&self.state.fields[self.state.measure].digits||[69,2],});});chart.yAxis.tickPadding(5);chart.yAxis.orient("right");chart(svg);$svgContainer.find('.nvd3 .nv-groups g.nv-group').css('stroke-width','2px')
if(ticksLabels.length>3){$svgContainer.find('svg .nv-x g.nv-axisMaxMin-x > text').hide();}
return chart;},_renderGraph:function(){var self=this;this.$el.empty();var chartResize=function(chart){if(chart&&chart.tooltip.chartContainer){self.to_remove=chart.update;nv.utils.onWindowResize(chart.update);chart.tooltip.chartContainer(self.$('.o_graph_svg_container').last()[0]);}}
var chart=this['_render'+_.str.capitalize(this.state.mode)+'Chart'](this.state.data);if(chart){chart.dispatch.on('renderEnd',function(){$('.nv-y .tick > line').attr('x2',function(i,value){return Math.abs(value);});})
chartResize(chart);}
if(this.state.mode==='pie'&&this.isComparison){var timeRangeMenuData=this.state.context.timeRangeMenuData;var chartTitle=this.title+' ('+timeRangeMenuData.timeRangeDescription+')';this.$('.o_graph_svg_container').last().prepend($('<label/>',{text:chartTitle,}));var comparisonChart=this['_render'+_.str.capitalize(this.state.mode)+'Chart'](this.state.comparisonData);var comparisonChartTitle=this.title+' ('+timeRangeMenuData.comparisonTimeRangeDescription+')';this.$('.o_graph_svg_container').last().prepend($('<label/>',{text:comparisonChartTitle,}));chartResize(comparisonChart);if(chart){chart.update();}}else if(this.title){this.$('.o_graph_svg_container').last().prepend($('<label/>',{text:this.title,}));}},_sanitizeLabel:function(datapt){datapt.labels=datapt.labels.map(function(label){if(label===undefined)return _t("Undefined");if(label===true)return _t("True");if(label===false)return _t("False");return label;});},});});;

/* /web/static/src/js/views/graph/graph_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.GraphView',function(require){"use strict";var AbstractView=require('web.AbstractView');var core=require('web.core');var GraphModel=require('web.GraphModel');var Controller=require('web.GraphController');var GraphRenderer=require('web.GraphRenderer');var _t=core._t;var _lt=core._lt;var GROUPABLE_TYPES=['many2one','char','boolean','selection','date','datetime'];var GraphView=AbstractView.extend({display_name:_lt('Graph'),icon:'fa-bar-chart',cssLibs:['/web/static/lib/nvd3/nv.d3.css'],jsLibs:['/web/static/lib/nvd3/d3.v3.js','/web/static/lib/nvd3/nv.d3.js','/web/static/src/js/libs/nvd3.js'],config:{Model:GraphModel,Controller:Controller,Renderer:GraphRenderer,},viewType:'graph',enableTimeRangeMenu:'true',init:function(viewInfo,params){this._super.apply(this,arguments);var self=this;var measure;var groupBys=[];var measures={__count__:{string:_t("Count"),type:"integer"}};var groupableFields={};var intervalMapping={};this.fields.__count__={string:_t("Count"),type:"integer"};this.arch.children.forEach(function(field){var fieldName=field.attrs.name;if(fieldName==="id"){return;}
var interval=field.attrs.interval;if(interval){intervalMapping[fieldName]=interval;fieldName=fieldName+':'+interval;}
if(field.attrs.type==='measure'){measure=fieldName;measures[fieldName]=self.fields[fieldName];}else{groupBys.push(fieldName);}});_.each(this.fields,function(field,name){if(name!=='id'&&field.store===true){if(_.contains(['integer','float','monetary'],field.type)||_.contains(params.additionalMeasures,name)){measures[name]=field;}
if(_.contains(GROUPABLE_TYPES,field.type)){groupableFields[name]=field;}}});this.controllerParams.measures=measures;this.controllerParams.groupableFields=groupableFields;this.rendererParams.stacked=this.arch.attrs.stacked!=="False";this.rendererParams.title=this.arch.attrs.title;this.loadParams.mode=this.arch.attrs.type||'bar';this.loadParams.measure=measure||'__count__';this.loadParams.groupBys=groupBys||[];this.loadParams.intervalMapping=intervalMapping;this.loadParams.fields=this.fields;this.loadParams.comparisonDomain=params.comparisonDomain;},});return GraphView;});;

/* /web/static/src/js/views/kanban/kanban_column.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanColumn',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var KanbanRecord=require('web.KanbanRecord');var RecordQuickCreate=require('web.kanban_record_quick_create');var view_dialogs=require('web.view_dialogs');var viewUtils=require('web.viewUtils');var Widget=require('web.Widget');var KanbanColumnProgressBar=require('web.KanbanColumnProgressBar');var _t=core._t;var QWeb=core.qweb;var KanbanColumn=Widget.extend({template:'KanbanView.Group',custom_events:{cancel_quick_create:'_onCancelQuickCreate',quick_create_add_record:'_onQuickCreateAddRecord',tweak_column:'_onTweakColumn',tweak_column_records:'_onTweakColumnRecords',},events:{'click .o_column_edit':'_onEditColumn','click .o_column_delete':'_onDeleteColumn','click .o_kanban_quick_add':'_onAddQuickCreate','click .o_kanban_load_more':'_onLoadMore','click .o_kanban_toggle_fold':'_onToggleFold','click .o_column_archive_records':'_onArchiveRecords','click .o_column_unarchive_records':'_onUnarchiveRecords'},init:function(parent,data,options,recordOptions){this._super(parent);this.db_id=data.id;this.data_records=data.data;this.data=data;var value=data.value;this.id=data.res_id;this.folded=!data.isOpen;this.has_active_field='active'in data.fields;this.fields=data.fields;this.records=[];this.modelName=data.model;this.quick_create=options.quick_create;this.quickCreateView=options.quickCreateView;this.groupedBy=options.groupedBy;this.grouped_by_m2o=options.grouped_by_m2o;this.editable=options.editable;this.deletable=options.deletable;this.archivable=options.archivable;this.draggable=options.draggable;this.KanbanRecord=options.KanbanRecord||KanbanRecord;this.records_editable=options.records_editable;this.records_deletable=options.records_deletable;this.relation=options.relation;this.offset=0;this.remaining=data.count-this.data_records.length;if(options.hasProgressBar){this.barOptions={columnID:this.db_id,progressBarStates:options.progressBarStates,};}
this.record_options=_.clone(recordOptions);if(options.grouped_by_m2o){this.title=value?value:_t('Undefined');}else{this.title=value===undefined?_t('Undefined'):value;}
if(options.group_by_tooltip){this.tooltipInfo=_.map(options.group_by_tooltip,function(help,field){return(data.tooltipData&&data.tooltipData[field]&&"<div>"+help+"<br>"+data.tooltipData[field]+"</div>")||'';}).join('');}else{this.tooltipInfo="";}},start:function(){var self=this;var defs=[this._super.apply(this,arguments)];this.$header=this.$('.o_kanban_header');for(var i=0;i<this.data_records.length;i++){var def=this._addRecord(this.data_records[i]);if(def.state()==='pending'){defs.push(def);}}
this.$header.find('.o_kanban_header_title').tooltip();if(!config.device.isMobile){this.$el.sortable({connectWith:'.o_kanban_group',containment:this.draggable?false:'parent',revert:0,delay:0,items:'> .o_kanban_record:not(.o_updating)',cursor:'move',over:function(){self.$el.addClass('o_kanban_hover');},out:function(){self.$el.removeClass('o_kanban_hover');},start:function(event,ui){ui.item.addClass('o_currently_dragged');},stop:function(event,ui){var item=ui.item;setTimeout(function(){item.removeClass('o_currently_dragged');});},update:function(event,ui){var record=ui.item.data('record');var index=self.records.indexOf(record);record.$el.removeAttr('style');if(index>=0){if($.contains(self.$el[0],record.$el[0])){self.trigger_up('kanban_column_resequence',{ids:self._getIDs()});}}else{ui.item.addClass('o_updating');self.trigger_up('kanban_column_add_record',{record:record,ids:self._getIDs()});}}});}
this.$el.click(function(event){if(self.folded){self._onToggleFold(event);}});if(this.barOptions){this.$el.addClass('o_kanban_has_progressbar');this.progressBar=new KanbanColumnProgressBar(this,this.barOptions,this.data);defs.push(this.progressBar.appendTo(this.$header));}
var title=this.folded?this.title+' ('+this.data.count+')':this.title;this.$header.find('.o_column_title').text(title);this.$el.toggleClass('o_column_folded',this.folded&&!config.device.isMobile);var tooltip=this.data.count+_t(' records');tooltip='<p>'+tooltip+'</p>'+this.tooltipInfo;this.$header.find('.o_kanban_header_title').tooltip({}).attr('data-original-title',tooltip);if(!this.remaining){this.$('.o_kanban_load_more').remove();}else{this.$('.o_kanban_load_more').html(QWeb.render('KanbanView.LoadMore',{widget:this}));}
return $.when.apply($,defs);},on_attach_callback:function(){_.invoke(this.records,'on_attach_callback');if(this.quickCreateWidget){this.quickCreateWidget.on_attach_callback();}},addQuickCreate:function(){if(this.folded){this.trigger_up('column_toggle_fold',{openQuickCreate:true,});return;}
if(this.quickCreateWidget){return $.Deferred().reject();}
this.trigger_up('close_quick_create');this.trigger_up('start_quick_create');var context=this.data.getContext();context['default_'+this.groupedBy]=viewUtils.getGroupValue(this.data,this.groupedBy);this.quickCreateWidget=new RecordQuickCreate(this,{context:context,formViewRef:this.quickCreateView,model:this.modelName,});return this.quickCreateWidget.insertAfter(this.$header);},cancelQuickCreate:function(){if(this.quickCreateWidget){this.quickCreateWidget.cancel();}},isEmpty:function(){return!this.records.length;},_addRecord:function(recordState,options){var record=new this.KanbanRecord(this,recordState,this.record_options);this.records.push(record);if(options&&options.position==='before'){return record.insertAfter(this.quickCreateWidget?this.quickCreateWidget.$el:this.$header);}else{var $load_more=this.$('.o_kanban_load_more');if($load_more.length){return record.insertBefore($load_more);}else{return record.appendTo(this.$el);}}},_cancelQuickCreate:function(){this.quickCreateWidget.destroy();this.quickCreateWidget=undefined;},_getIDs:function(){var ids=[];this.$('.o_kanban_record').each(function(index,r){ids.push($(r).data('record').id);});return ids;},_onAddQuickCreate:function(){this.addQuickCreate();},_onCancelQuickCreate:function(){this._cancelQuickCreate();},_onDeleteColumn:function(event){event.preventDefault();var buttons=[{text:_t("Ok"),classes:'btn-primary',close:true,click:this.trigger_up.bind(this,'kanban_column_delete'),},{text:_t("Cancel"),close:true}];new Dialog(this,{size:'medium',buttons:buttons,$content:$('<div>',{text:_t("Are you sure that you want to remove this column ?")}),}).open();},_onEditColumn:function(event){event.preventDefault();new view_dialogs.FormViewDialog(this,{res_model:this.relation,res_id:this.id,title:_t("Edit Column"),on_saved:this.trigger_up.bind(this,'reload'),}).open();},_onLoadMore:function(event){event.preventDefault();this.trigger_up('kanban_load_more');},_onQuickCreateAddRecord:function(event){this.trigger_up('quick_create_record',event.data);},_onToggleFold:function(event){event.preventDefault();this.trigger_up('column_toggle_fold');},_onTweakColumn:function(ev){ev.data.callback(this.$el);},_onTweakColumnRecords:function(ev){_.each(this.records,function(record){ev.data.callback(record.$el,record.state.data);});},_onArchiveRecords:function(event){event.preventDefault();Dialog.confirm(this,_t("Are you sure that you want to archive all the records from this column?"),{confirm_callback:this.trigger_up.bind(this,'kanban_column_records_toggle_active',{archive:true,}),});},_onUnarchiveRecords:function(event){event.preventDefault();this.trigger_up('kanban_column_records_toggle_active',{archive:false,});}});return KanbanColumn;});;

/* /web/static/src/js/views/kanban/kanban_column_progressbar.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanColumnProgressBar',function(require){'use strict';var Widget=require('web.Widget');var session=require('web.session');var utils=require('web.utils');var KanbanColumnProgressBar=Widget.extend({template:'KanbanView.ColumnProgressBar',events:{'click .o_kanban_counter_progress':'_onProgressBarParentClick','click .progress-bar':'_onProgressBarClick',},ANIMATE:true,init:function(parent,options,columnState){this._super.apply(this,arguments);this.columnID=options.columnID;this.columnState=columnState;this.fieldName=columnState.progressBarValues.field;this.colors=columnState.progressBarValues.colors;this.sumField=columnState.progressBarValues.sum_field;this.progressBarHelp=columnState.progressBarValues.help;var state=options.progressBarStates[this.columnID];if(state){this.groupCount=state.groupCount;this.subgroupCounts=state.subgroupCounts;this.totalCounterValue=state.totalCounterValue;this.activeFilter=state.activeFilter;}
var sumFieldInfo=this.sumField&&columnState.fieldsInfo.kanban[this.sumField];var currencyField=sumFieldInfo&&sumFieldInfo.options&&sumFieldInfo.options.currency_field;if(currencyField&&columnState.data.length){this.currency=session.currencies[columnState.data[0].data[currencyField].res_id];}},start:function(){var self=this;this.$bars={};_.each(this.colors,function(val,key){self.$bars[val]=self.$('.bg-'+val+'-full');});this.$counter=this.$('.o_kanban_counter_side');this.$number=this.$counter.find('b');if(this.currency){var $currency=$('<span/>',{text:this.currency.symbol,});if(this.currency.position==='before'){$currency.prependTo(this.$counter);}else{$currency.appendTo(this.$counter);}}
return this._super.apply(this,arguments).then(function(){var subgroupCounts={};_.each(self.colors,function(val,key){var subgroupCount=self.columnState.progressBarValues.counts[key]||0;if(self.activeFilter===key&&subgroupCount===0){self.activeFilter=false;}
subgroupCounts[key]=subgroupCount;});self.groupCount=self.columnState.count;self.subgroupCounts=subgroupCounts;self.prevTotalCounterValue=self.totalCounterValue;self.totalCounterValue=self.sumField?(self.columnState.aggregateValues[self.sumField]||0):self.columnState.count;self._notifyState();self._render();});},_render:function(){var self=this;this.trigger_up('tweak_column',{callback:function($el){$el.removeClass('o_kanban_group_show');_.each(self.colors,function(val,key){$el.removeClass('o_kanban_group_show_'+val);});if(self.activeFilter){$el.addClass('o_kanban_group_show o_kanban_group_show_'+self.colors[self.activeFilter]);}},});this.trigger_up('tweak_column_records',{callback:function($el,recordData){var categoryValue=recordData[self.fieldName];_.each(self.colors,function(val,key){$el.removeClass('oe_kanban_card_'+val);});if(self.colors[categoryValue]){$el.addClass('oe_kanban_card_'+self.colors[categoryValue]);}},});if(this.progressBarHelp&&_.every(this.subgroupCounts,function(val){return val===0;})){this.$el.tooltip({delay:0,trigger:'hover',title:this.progressBarHelp,});}
var barNumber=0;var barMinWidth=6;_.each(self.colors,function(val,key){var $bar=self.$bars[val];var count=self.subgroupCounts&&self.subgroupCounts[key]||0;if(!$bar){return;}
$bar.attr('data-original-title',count+' '+key);$bar.tooltip({delay:0,trigger:'hover',});$bar.toggleClass('progress-bar-animated progress-bar-striped',key===self.activeFilter);$bar.removeClass('o_bar_has_records transition-off');window.getComputedStyle($bar[0]).getPropertyValue('width');if(count>0){$bar.addClass('o_bar_has_records');var maxWidth=100-barMinWidth*barNumber;self.$('.progress-bar.o_bar_has_records').css('max-width',maxWidth+'%');$bar.css('width',(count*100/self.groupCount)+'%');barNumber++;$bar.attr('aria-valuemin',0);$bar.attr('aria-valuemax',self.groupCount);$bar.attr('aria-valuenow',count);}else{$bar.css('width','');}});this.$('.progress-bar.o_bar_has_records').css('min-width',barMinWidth+'%');var start=this.prevTotalCounterValue;var end=this.totalCounterValue;if(this.activeFilter){if(this.sumField){end=0;_.each(self.columnState.data,function(record){var recordData=record.data;if(self.activeFilter===recordData[self.fieldName]){end+=parseFloat(recordData[self.sumField]);}});}else{end=this.subgroupCounts[this.activeFilter];}}
this.prevTotalCounterValue=end;var animationClass=start>999?'o_kanban_grow':'o_kanban_grow_huge';if(start!==undefined&&(end>start||this.activeFilter)&&this.ANIMATE){$({currentValue:start}).animate({currentValue:end},{duration:1000,start:function(){self.$counter.addClass(animationClass);},step:function(){self.$number.html(_getCounterHTML(this.currentValue));},complete:function(){self.$number.html(_getCounterHTML(this.currentValue));self.$counter.removeClass(animationClass);},});}else{this.$number.html(_getCounterHTML(end));}
function _getCounterHTML(value){return utils.human_number(value,0,3);}},_notifyState:function(){this.trigger_up('set_progress_bar_state',{columnID:this.columnID,values:{groupCount:this.groupCount,subgroupCounts:this.subgroupCounts,totalCounterValue:this.totalCounterValue,activeFilter:this.activeFilter,},});},_onProgressBarClick:function(ev){this.$clickedBar=$(ev.currentTarget);var filter=this.$clickedBar.data('filter');this.activeFilter=(this.activeFilter===filter?false:filter);this._notifyState();this._render();},_onProgressBarParentClick:function(ev){if(ev.target!==ev.currentTarget){return;}
this.activeFilter=false;this._notifyState();this._render();},});return KanbanColumnProgressBar;});;

/* /web/static/src/js/views/kanban/kanban_column_quick_create.js defined in bundle 'web.assets_backend' */
odoo.define('web.kanban_column_quick_create',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var ColumnQuickCreate=Widget.extend({template:'KanbanView.ColumnQuickCreate',events:{'click .o_quick_create_folded':'_onUnfold','click .o_kanban_add':'_onAddClicked','click .o_kanban_examples':'_onShowExamples','keydown':'_onKeydown','keypress input':'_onKeypress','blur input':'_onInputBlur','focus input':'_onInputFocus',},init:function(parent,options){this._super.apply(this,arguments);this.examples=options.examples;this.folded=true;},start:function(){this.$quickCreateFolded=this.$('.o_quick_create_folded');this.$quickCreateUnfolded=this.$('.o_quick_create_unfolded');this.$input=this.$('input');core.bus.on('click',this,this._onWindowClicked);this._update();return this._super.apply(this,arguments);},on_attach_callback:function(){if(!this.folded){this.$input.focus();}},toggleFold:function(){this.folded=!this.folded;this._update();if(!this.folded){this.$input.focus();this.trigger_up('scrollTo',{selector:'.o_column_quick_create'});}},_add:function(){var value=this.$input.val().trim();if(!value.length){this._cancel();return;}
this.$input.val('');this.trigger_up('quick_create_add_column',{value:value});this.$input.focus();},_cancel:function(){if(!this.folded){this.folded=true;this.$input.val('');this._update();}},_update:function(){this.$quickCreateFolded.toggle(this.folded);this.$quickCreateUnfolded.toggle(!this.folded);this.trigger_up('quick_create_column_updated');},_onAddClicked:function(event){event.stopPropagation();this._add();},_onInputBlur:function(){this.$('.o_discard_msg').hide();},_onInputFocus:function(){this.$('.o_discard_msg').show();},_onKeydown:function(event){if(event.keyCode===$.ui.keyCode.ESCAPE){this._cancel();}},_onKeypress:function(event){if(event.keyCode===$.ui.keyCode.ENTER){this._add();}},_onShowExamples:function(){var self=this;var dialog=new Dialog(this,{$content:$(QWeb.render('KanbanView.ExamplesDialog',{examples:this.examples,})),buttons:[{classes:'btn-primary float-right',close:true,text:_t('Got it'),}],size:"large",title:"Kanban Examples",}).open();dialog.on('closed',this,function(){self.$input.focus();});},_onUnfold:function(){if(this.folded){this.toggleFold();}},_onWindowClicked:function(event){if(!document.contains(this.el)){return;}
if($(event.target).closest('.modal').length){return;}
if(this.el.contains(event.target)){return;}
this._cancel();},});return ColumnQuickCreate;});;

/* /web/static/src/js/views/kanban/kanban_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanModel',function(require){"use strict";var BasicModel=require('web.BasicModel');var viewUtils=require('web.viewUtils');var KanbanModel=BasicModel.extend({addRecordToGroup:function(groupID,resId){var self=this;var group=this.localData[groupID];var new_record=this._makeDataPoint({res_id:resId,modelName:group.model,fields:group.fields,fieldsInfo:group.fieldsInfo,viewType:group.viewType,parentID:groupID,});var def=this._fetchRecord(new_record).then(function(result){group.data.unshift(new_record.id);group.res_ids.unshift(resId);group.count++;self.localData[group.parentID].count++;self._updateParentResIDs(group);return result.id;});return this._reloadProgressBarGroupFromRecord(new_record.id,def);},createGroup:function(name,parentID){var self=this;var parent=this.localData[parentID];var groupBy=parent.groupedBy[0];var groupByField=parent.fields[groupBy];if(!groupByField||groupByField.type!=='many2one'){return $.Deferred().reject();}
return this._rpc({model:groupByField.relation,method:'name_create',args:[name],context:parent.context,}).then(function(result){var newGroup=self._makeDataPoint({modelName:parent.model,context:parent.context,domain:parent.domain.concat([[groupBy,"=",result[0]]]),fields:parent.fields,fieldsInfo:parent.fieldsInfo,isOpen:true,limit:parent.limit,parentID:parent.id,openGroupByDefault:true,orderedBy:parent.orderedBy,value:result,viewType:parent.viewType,});if(parent.progressBar){newGroup.progressBarValues=_.extend({counts:{},},parent.progressBar);}
parent.data.push(newGroup.id);return newGroup.id;});},createRecordInGroup:function(groupID,values){var self=this;var group=this.localData[groupID];var context=this._getContext(group);var parent=this.localData[group.parentID];var groupedBy=parent.groupedBy;context['default_'+groupedBy]=viewUtils.getGroupValue(group,groupedBy);var def;if(Object.keys(values).length===1&&'display_name'in values){def=this._rpc({model:parent.model,method:'name_create',args:[values.display_name],context:context,}).then(function(records){return records[0];});}else{def=this._rpc({model:parent.model,method:'create',args:[values],context:context,});}
return def.then(function(resID){return self.addRecordToGroup(group.id,resID);});},get:function(){var result=this._super.apply(this,arguments);var dp=result&&this.localData[result.id];if(dp){if(dp.tooltipData){result.tooltipData=$.extend(true,{},dp.tooltipData);}
if(dp.progressBarValues){result.progressBarValues=$.extend(true,{},dp.progressBarValues);}
if(dp.fields[dp.groupedBy[0]]){var groupedByM2O=dp.fields[dp.groupedBy[0]].type==='many2one';result.isGroupedByM2ONoColumn=!dp.data.length&&groupedByM2O;}else{result.isGroupedByM2ONoColumn=false;}}
return result;},getColumn:function(id){var element=this.localData[id];if(element){return this.get(element.parentID);}
return null;},load:function(params){this.defaultGroupedBy=params.groupBy;params.groupedBy=(params.groupedBy&&params.groupedBy.length)?params.groupedBy:this.defaultGroupedBy;return this._super(params);},loadColumnRecords:function(groupID){var dataPoint=this.localData[groupID];dataPoint.isOpen=true;return this.reload(groupID);},loadMore:function(groupID){var group=this.localData[groupID];var offset=group.loadMoreOffset+group.limit;return this.reload(group.id,{loadMoreOffset:offset,});},moveRecord:function(recordID,groupID,parentID){var self=this;var parent=this.localData[parentID];var new_group=this.localData[groupID];var changes={};var groupedFieldName=parent.groupedBy[0];var groupedField=parent.fields[groupedFieldName];if(groupedField.type==='many2one'){changes[groupedFieldName]={id:new_group.res_id,display_name:new_group.value,};}else if(groupedField.type==='selection'){var value=_.findWhere(groupedField.selection,{1:new_group.value});changes[groupedFieldName]=value&&value[0]||false;}else{changes[groupedFieldName]=new_group.value;}
var record=self.localData[recordID];var resID=record.res_id;var old_group;for(var i=0;i<parent.data.length;i++){old_group=self.localData[parent.data[i]];var index=_.indexOf(old_group.data,recordID);if(index>=0){old_group.data.splice(index,1);old_group.count--;old_group.res_ids=_.without(old_group.res_ids,resID);self._updateParentResIDs(old_group);break;}}
new_group.data.push(recordID);new_group.res_ids.push(resID);new_group.count++;return this.notifyChanges(recordID,changes,{force_fail:true}).then(function(){return self.save(recordID);}).then(function(){record.parentID=new_group.id;return[old_group.id,new_group.id];});},reload:function(id,options){if(options&&options.groupBy&&!options.groupBy.length){options.groupBy=this.defaultGroupedBy;}
var def=this._super(id,options);if(options&&options.loadMoreOffset){return def;}
return this._reloadProgressBarGroupFromRecord(id,def);},save:function(recordID){var def=this._super.apply(this,arguments);return this._reloadProgressBarGroupFromRecord(recordID,def);},_makeDataPoint:function(params){var dataPoint=this._super.apply(this,arguments);if(params.progressBar){dataPoint.progressBar=params.progressBar;}
return dataPoint;},_load:function(dataPoint,options){if(dataPoint.groupedBy.length&&dataPoint.progressBar){return this._readProgressBarGroup(dataPoint,options);}
return this._super.apply(this,arguments);},_readGroup:function(list){var self=this;if(list.groupedBy.length>1){list.groupedBy=[list.groupedBy[0]];}
return this._super.apply(this,arguments).then(function(result){return self._readTooltipFields(list).then(_.constant(result));});},_readProgressBarGroup:function(list,options){var self=this;var groupsDef=this._readGroup(list,options);var progressBarDef=this._rpc({model:list.model,method:'read_progress_bar',kwargs:{domain:list.domain,group_by:list.groupedBy[0],progress_bar:list.progressBar,context:list.context,},});return $.when(groupsDef,progressBarDef).then(function(a,data){_.each(list.data,function(groupID){var group=self.localData[groupID];group.progressBarValues=_.extend({counts:data[group.value]||{},},list.progressBar);});return list;});},_readTooltipFields:function(list){var self=this;var groupedByField=list.fields[list.groupedBy[0].split(':')[0]];if(groupedByField.type!=='many2one'){return $.when();}
var groupIds=_.reduce(list.data,function(groupIds,id){var res_id=self.get(id,{raw:true}).res_id;if(res_id){groupIds.push(res_id);}
return groupIds;},[]);var tooltipFields=[];var groupedByFieldInfo=list.fieldsInfo.kanban[list.groupedBy[0]];if(groupedByFieldInfo&&groupedByFieldInfo.options){tooltipFields=Object.keys(groupedByFieldInfo.options.group_by_tooltip||{});}
if(groupIds.length&&tooltipFields.length){var fieldNames=_.union(['display_name'],tooltipFields);return this._rpc({model:groupedByField.relation,method:'read',args:[groupIds,fieldNames],context:list.context,}).then(function(result){_.each(list.data,function(id){var dp=self.localData[id];dp.tooltipData=_.findWhere(result,{id:dp.res_id});});});}
return $.when();},_reloadProgressBarGroupFromRecord:function(recordID,def){var element=this.localData[recordID];if(element.type==='list'&&!element.parentID){return def;}
var self=this;while(element){if(element.progressBar){return def.then(function(data){return self._load(element,{keepEmptyGroups:true,onlyGroups:true,}).then(function(){return data;});});}
element=this.localData[element.parentID];}
return def;},});return KanbanModel;});;

/* /web/static/src/js/views/kanban/kanban_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanController',function(require){"use strict";var BasicController=require('web.BasicController');var Context=require('web.Context');var core=require('web.core');var Domain=require('web.Domain');var view_dialogs=require('web.view_dialogs');var viewUtils=require('web.viewUtils');var _t=core._t;var qweb=core.qweb;var KanbanController=BasicController.extend({custom_events:_.extend({},BasicController.prototype.custom_events,{quick_create_add_column:'_onAddColumn',quick_create_record:'_onQuickCreateRecord',resequence_columns:'_onResequenceColumn',button_clicked:'_onButtonClicked',kanban_record_delete:'_onRecordDelete',kanban_record_update:'_onUpdateRecord',kanban_column_delete:'_onDeleteColumn',kanban_column_add_record:'_onAddRecordToColumn',kanban_column_resequence:'_onColumnResequence',kanban_load_more:'_onLoadMore',kanban_load_records:'_onLoadColumnRecords',column_toggle_fold:'_onToggleColumn',kanban_column_records_toggle_active:'_onToggleActiveRecords',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.on_create=params.on_create;this.hasButtons=params.hasButtons;this.quickCreateEnabled=params.quickCreateEnabled;},renderButtons:function($node){if(this.hasButtons&&this.is_action_enabled('create')){this.$buttons=$(qweb.render('KanbanView.buttons',{btnClass:'btn-primary',widget:this,}));this.$buttons.on('click','button.o-kanban-button-new',this._onButtonNew.bind(this));this.$buttons.on('keydown',this._onButtonsKeyDown.bind(this));this._updateButtons();this.$buttons.appendTo($node);}},_confirmSave:function(id){var data=this.model.get(this.handle,{raw:true});var grouped=data.groupedBy.length;if(grouped){var columnState=this.model.getColumn(id);return this.renderer.updateColumn(columnState.id,columnState);}
return this.renderer.updateRecord(this.model.get(id));},_reloadAfterButtonClick:function(kanbanRecord,params){var self=this;var recordModel=this.model.localData[params.record.id];var group=this.model.localData[recordModel.parentID];var parent=this.model.localData[group.parentID];this.model.reload(params.record.id).then(function(db_id){var data=self.model.get(db_id);kanbanRecord.update(data);var domain=(parent?parent.domain:group.domain)||[];var domInData=_.every(domain,function(d){return d[0]in data.data;});var activeInDomain=_.pluck(domain,0).indexOf('active')!==-1;var activeInData='active'in data.data;if(domInData&&!activeInDomain&&activeInData){domain=domain.concat([['active','=',true]]);}else if(!domInData&&!activeInDomain&&activeInData){domain=[['active','=',true]];}
try{var visible=new Domain(domain).compute(data.evalContext);}catch(e){return;}
if(!visible){kanbanRecord.destroy();}});},_resequenceColumns:function(ids){var state=this.model.get(this.handle,{raw:true});var model=state.fields[state.groupedBy[0]].relation;return this.model.resequence(model,ids,this.handle);},_resequenceRecords:function(column_id,ids){var self=this;return this.model.resequence(this.modelName,ids,column_id).then(function(){self._updateEnv();});},_update:function(){this._updateButtons();return this._super.apply(this,arguments);},_updateButtons:function(){if(this.$buttons){var state=this.model.get(this.handle,{raw:true});var createHidden=this.is_action_enabled('group_create')&&state.isGroupedByM2ONoColumn;this.$buttons.find('.o-kanban-button-new').toggleClass('o_hidden',createHidden);}},_onAddColumn:function(event){var self=this;this.mutex.exec(function(){return self.model.createGroup(event.data.value,self.handle).then(function(){var state=self.model.get(self.handle,{raw:true});var ids=_.pluck(state.data,'res_id').filter(_.isNumber);return self._resequenceColumns(ids);}).then(function(){return self.update({},{reload:false});}).then(function(){self._updateButtons();self.renderer.quickCreateToggleFold();});});},_onAddRecordToColumn:function(event){var self=this;var record=event.data.record;var column=event.target;this.alive(this.model.moveRecord(record.db_id,column.db_id,this.handle)).then(function(column_db_ids){return self._resequenceRecords(column.db_id,event.data.ids).then(function(){_.each(column_db_ids,function(db_id){var data=self.model.get(db_id);self.renderer.updateColumn(db_id,data);});});}).fail(this.reload.bind(this));},_onButtonClicked:function(event){event.stopPropagation();var attrs=event.data.attrs;var record=event.data.record;if(attrs.context){attrs.context=new Context(attrs.context).set_eval_context({active_id:record.res_id,active_ids:[record.res_id],active_model:record.model,});}
this.trigger_up('execute_action',{action_data:attrs,env:{context:record.getContext(),currentID:record.res_id,model:record.model,resIDs:record.res_ids,},on_closed:this._reloadAfterButtonClick.bind(this,event.target,event.data),});},_onButtonNew:function(){var self=this;var state=this.model.get(this.handle,{raw:true});var quickCreateEnabled=this.quickCreateEnabled&&viewUtils.isQuickCreateEnabled(state);if(this.on_create==='quick_create'&&quickCreateEnabled&&state.data.length){this.mutex.getUnlockedDef().then(function(){self.renderer.addQuickCreate();});}else if(this.on_create&&this.on_create!=='quick_create'){this.do_action(this.on_create,{on_close:this.reload.bind(this),additional_context:state.context,});}else{this.trigger_up('switch_view',{view_type:'form',res_id:undefined});}},_onButtonsKeyDown:function(e){switch(e.keyCode){case $.ui.keyCode.DOWN:this.$('.o_kanban_record:first').focus();}},_onColumnResequence:function(event){this._resequenceRecords(event.target.db_id,event.data.ids);},_onDeleteColumn:function(event){var self=this;var column=event.target;var state=this.model.get(this.handle,{raw:true});var relatedModelName=state.fields[state.groupedBy[0]].relation;this.model.deleteRecords([column.db_id],relatedModelName).done(function(){if(column.isEmpty()){self.renderer.removeWidget(column);self._updateButtons();}else{self.reload();}});},_onLoadColumnRecords:function(event){var self=this;this.model.loadColumnRecords(event.data.columnID).then(function(dbID){var data=self.model.get(dbID);self.renderer.updateColumn(dbID,data);self._updateEnv();if(event.data.onSuccess){event.data.onSuccess();}});},_onLoadMore:function(event){var self=this;var column=event.target;this.model.loadMore(column.db_id).then(function(db_id){var data=self.model.get(db_id);self.renderer.updateColumn(db_id,data);self._updateEnv();});},_onQuickCreateRecord:function(ev){var self=this;var values=ev.data.values;var column=ev.target;var onFailure=ev.data.onFailure||function(){};var update=function(db_id){self._updateEnv();var columnState=self.model.getColumn(db_id);var state=self.model.get(self.handle);return self.renderer.updateColumn(columnState.id,columnState,{openQuickCreate:true,state:state}).then(function(){if(ev.data.openRecord){self.trigger_up('open_record',{id:db_id,mode:'edit'});}});};this.model.createRecordInGroup(column.db_id,values).then(update).fail(function(error,ev){ev.preventDefault();var columnState=self.model.get(column.db_id,{raw:true});var context=columnState.getContext();var state=self.model.get(self.handle,{raw:true});var groupedBy=state.groupedBy[0];context['default_'+groupedBy]=viewUtils.getGroupValue(columnState,groupedBy);new view_dialogs.FormViewDialog(self,{res_model:state.model,context:_.extend({default_name:values.name||values.display_name},context),title:_t("Create"),disable_multiple_selection:true,on_saved:function(record){self.model.addRecordToGroup(column.db_id,record.res_id).then(update);},}).open().opened(onFailure);});},_onRecordDelete:function(event){this._deleteRecords([event.data.id]);},_onResequenceColumn:function(event){var self=this;this._resequenceColumns(event.data.ids).then(function(){self._updateEnv();});},_onToggleColumn:function(event){var self=this;var column=event.target;this.model.toggleGroup(column.db_id).then(function(db_id){var data=self.model.get(db_id);var options={openQuickCreate:!!event.data.openQuickCreate,};self.renderer.updateColumn(db_id,data,options);self._updateEnv();});},_onUpdateRecord:function(ev){var changes=_.clone(ev.data);ev.data.force_save=true;this._applyChanges(ev.target.db_id,changes,ev);},_onToggleActiveRecords:function(event){var self=this;var active=!event.data.archive;var column=event.target;var recordIds=_.pluck(column.records,'db_id');if(recordIds.length){this.model.toggleActive(recordIds,active,column.db_id).then(function(dbID){var data=self.model.get(dbID);self.renderer.updateColumn(dbID,data);self._updateEnv();});}},});return KanbanController;});;

/* /web/static/src/js/views/kanban/kanban_examples_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web.kanban_examples_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});;

/* /web/static/src/js/views/kanban/kanban_record.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanRecord',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Domain=require('web.Domain');var field_utils=require('web.field_utils');var utils=require('web.utils');var Widget=require('web.Widget');var widgetRegistry=require('web.widget_registry');var _t=core._t;var QWeb=core.qweb;var KANBAN_RECORD_COLORS=[_t('No color'),_t('Red'),_t('Orange'),_t('Yellow'),_t('Light blue'),_t('Dark purple'),_t('Salmon pink'),_t('Medium blue'),_t('Dark blue'),_t('Fushia'),_t('Green'),_t('Purple'),];var NB_KANBAN_RECORD_COLORS=KANBAN_RECORD_COLORS.length;var KanbanRecord=Widget.extend({events:{'click .oe_kanban_action':'_onKanbanActionClicked','click .o_kanban_manage_toggle_button':'_onManageTogglerClicked',},init:function(parent,state,options){this._super(parent);this.fields=state.fields;this.fieldsInfo=state.fieldsInfo.kanban;this.modelName=state.model;this.options=options;this.editable=options.editable;this.deletable=options.deletable;this.read_only_mode=options.read_only_mode;this.qweb=options.qweb;this.subWidgets={};this._setState(state);this._onKanbanActionClicked=_.debounce(this._onKanbanActionClicked,300,true);},start:function(){return $.when(this._super.apply(this,arguments),this._render());},on_attach_callback:function(){_.invoke(this.subWidgets,'on_attach_callback');},on_detach_callback:function(){_.invoke(this.subWidgets,'on_detach_callback');},update:function(state){_.invoke(_.pluck(this.subWidgets,'$el'),'detach');this._setState(state);return this._render();},_attachTooltip:function(){var self=this;this.$('[tooltip]').each(function(){var $el=$(this);var tooltip=$el.attr('tooltip');if(tooltip){$el.tooltip({title:self.qweb.render(tooltip,self.qweb_context)});}});},_computeDomain:function(d){return new Domain(d).compute(this.state.evalContext);},_getColorClassname:function(variable){var color=this._getColorID(variable);return'oe_kanban_color_'+color;},_getColorID:function(variable){if(typeof variable==='number'){return Math.round(variable)%NB_KANBAN_RECORD_COLORS;}
if(typeof variable==='string'){var index=0;for(var i=0;i<variable.length;i++){index+=variable.charCodeAt(i);}
return index%NB_KANBAN_RECORD_COLORS;}
return 0;},_getColorname:function(variable){var colorID=this._getColorID(variable);return KANBAN_RECORD_COLORS[colorID];},file_type_magic_word:{'/':'jpg','R':'gif','i':'png','P':'svg+xml',},_getImageURL:function(model,field,id,cache,options){options=options||{};var url;if(this.record[field]&&this.record[field].value&&!utils.is_bin_size(this.record[field].value)){url='data:image/'+this.file_type_magic_word[this.record[field].value[0]]+';base64,'+this.record[field].value;}else if(this.record[field]&&!this.record[field].value){url="/web/static/src/img/placeholder.png";}else{if(_.isArray(id)){id=id[0];}
if(!id){id=undefined;}
if(options.preview_image)
field=options.preview_image;var unique=this.record.__last_update&&this.record.__last_update.value.replace(/[^0-9]/g,'');var session=this.getSession();url=session.url('/web/image',{model:model,field:field,id:id,unique:unique});if(cache!==undefined){url+='&cache='+parseInt(cache,10);}}
return url;},_openRecord:function(){if(this.$el.hasClass('o_currently_dragged')){return;}
var editMode=this.$el.hasClass('oe_kanban_global_click_edit');this.trigger_up('open_record',{id:this.db_id,mode:editMode?'edit':'readonly',});},_processFields:function(){var self=this;this.$("field").each(function(){var $field=$(this);var field_name=$field.attr("name");var field_widget=$field.attr("widget");if(field_widget||self.fields[field_name].type==='many2many'){var widget=self.subWidgets[field_name];if(!widget){var Widget=self.fieldsInfo[field_name].Widget;if(Widget){widget=self._processWidget($field,field_name,Widget);self.subWidgets[field_name]=widget;}else if(config.debug){$field.replaceWith($('<span>',{text:_.str.sprintf(_t('[No widget %s]'),field_widget),}));}}else{widget.reset(self.state);$field.replaceWith(widget.$el);}}else{self._processField($field,field_name);}});},_processField:function($field,field_name){var field=this.fields[field_name];var value=this.recordData[field_name];var options={data:this.recordData};var formatted_value=field_utils.format[field.type](value,field,options);var $result=$('<span>',{text:formatted_value,});$field.replaceWith($result);this._setFieldDisplay($result,field_name);return $result;},_processWidget:function($field,field_name,Widget){var self=this;var attrs=Object.create(null);_.each(this.fieldsInfo[field_name],function(value,key){if(_.str.startsWith(key,'t-att-')){key=key.slice(6);value=$field.attr(key);}
attrs[key]=value;});var options=_.extend({},this.options,{attrs:attrs});var widget=new Widget(this,field_name,this.state,options);var def=widget.replace($field).then(function(){self._setFieldDisplay(widget.$el,field_name);});if(def.state()==='pending'){this.defs.push(def);}
return widget;},_processWidgets:function(){var self=this;this.$("widget").each(function(){var $field=$(this);var Widget=widgetRegistry.get($field.attr('name'));var widget=new Widget(self,self.state);var def=widget._widgetRenderAndInsert(function(){}).then(function(){widget.$el.addClass('o_widget');$field.replaceWith(widget.$el);});if(def.state()==='pending'){self.defs.push(def);}});},_render:function(){this.defs=[];this._replaceElement(this.qweb.render('kanban-box',this.qweb_context));this.$el.addClass('o_kanban_record').attr("tabindex",0);this.$el.attr('role','article');this.$el.data('record',this);if(this.$el.hasClass('oe_kanban_global_click')||this.$el.hasClass('oe_kanban_global_click_edit')){this.$el.on('click',this._onGlobalClick.bind(this));this.$el.on('keydown',this._onKeyDownCard.bind(this));}else{this.$el.on('keydown',this._onKeyDownOpenFirstLink.bind(this));}
this._processFields();this._processWidgets();this._setupColor();this._setupColorPicker();this._attachTooltip();this.$('span.o_tag').tooltip({delay:{'show':50}});return $.when.apply(this,this.defs);},_setFieldDisplay:function($el,fieldName){if(this.fieldsInfo[fieldName].display==='right'){$el.addClass('float-right');}else if(this.fieldsInfo[fieldName].display==='full'){$el.addClass('o_text_block');}
if(this.fieldsInfo[fieldName].bold){$el.addClass('o_text_bold');}},_setState:function(recordState){this.state=recordState;this.id=recordState.res_id;this.db_id=recordState.id;this.recordData=recordState.data;this.record=this._transformRecord(recordState.data);this.qweb_context={kanban_image:this._getImageURL.bind(this),kanban_color:this._getColorClassname.bind(this),kanban_getcolor:this._getColorID.bind(this),kanban_getcolorname:this._getColorname.bind(this),kanban_compute_domain:this._computeDomain.bind(this),read_only_mode:this.read_only_mode,record:this.record,user_context:this.getSession().user_context,widget:this,};},_setupColor:function(){var color_field=this.$el.attr('color');if(color_field&&color_field in this.fields){var colorHelp=_.str.sprintf(_t("Card color: %s"),this._getColorname(this.recordData[color_field]));var colorClass=this._getColorClassname(this.recordData[color_field]);this.$el.addClass(colorClass);this.$el.prepend('<span title="'+colorHelp+'" aria-label="'+colorHelp+'" role="img" class="oe_kanban_color_help"/>');}},_setupColorPicker:function(){var $colorpicker=this.$('ul.oe_kanban_colorpicker');if(!$colorpicker.length){return;}
$colorpicker.html(QWeb.render('KanbanColorPicker'));$colorpicker.on('click','a',this._onColorChanged.bind(this));},_transformRecord:function(recordData){var self=this;var new_record={};_.each(this.state.getFieldNames(),function(name){var value=recordData[name];var r=_.clone(self.fields[name]||{});if((r.type==='date'||r.type==='datetime')&&value){r.raw_value=value.toDate();}else if(r.type==='one2many'||r.type==='many2many'){r.raw_value=value.count?value.res_ids:[];}else if(r.type==='many2one'){r.raw_value=value&&value.res_id||false;}else{r.raw_value=value;}
if(r.type){var formatter=field_utils.format[r.type];r.value=formatter(value,self.fields[name],recordData,self.state);}else{r.value=value;}
new_record[name]=r;});return new_record;},_updateRecord:function(data){this.trigger_up('kanban_record_update',data);},_onColorChanged:function(event){event.preventDefault();var data={};var color_field=$(event.delegateTarget).data('field')||'color';data[color_field]=$(event.currentTarget).data('color');this.trigger_up('kanban_record_update',data);},_onGlobalClick:function(event){if($(event.target).parents('.o_dropdown_kanban').length){return;}
var trigger=true;var elem=event.target;var ischild=true;var children=[];while(elem){var events=$._data(elem,'events');if(elem===event.currentTarget){ischild=false;}
var test_event=events&&events.click&&(events.click.length>1||events.click[0].namespace!=='bs.tooltip');var testLinkWithHref=elem.nodeName.toLowerCase()==='a'&&elem.href;if(ischild){children.push(elem);if(test_event||testLinkWithHref){trigger=false;}}
if(trigger&&test_event){_.each(events.click,function(click_event){if(click_event.selector){_.each(children,function(child){if($(child).is(click_event.selector)){trigger=false;}});}});}
elem=elem.parentElement;}
if(trigger){this._openRecord();}},_onKanbanActionClicked:function(event){event.preventDefault();var $action=$(event.currentTarget);var type=$action.data('type')||'button';switch(type){case'edit':this.trigger_up('open_record',{id:this.db_id,mode:'edit'});break;case'open':this.trigger_up('open_record',{id:this.db_id});break;case'delete':this.trigger_up('kanban_record_delete',{id:this.db_id,record:this});break;case'action':case'object':this.trigger_up('button_clicked',{attrs:$action.data(),record:this.state,});break;default:this.do_warn("Kanban: no action for type : "+type);}},_onKeyDownCard:function(event){switch(event.keyCode){case $.ui.keyCode.ENTER:event.preventDefault();this._onGlobalClick(event);break;}},_onKeyDownOpenFirstLink:function(event){switch(event.keyCode){case $.ui.keyCode.ENTER:event.preventDefault();$(event.target).find('a, button').first().click();break;}},_onManageTogglerClicked:function(event){event.preventDefault();this.$el.toggleClass('o_dropdown_open');var colorClass=this._getColorClassname(this.recordData.color||0);this.$('.o_kanban_manage_button_section').toggleClass(colorClass);},});return KanbanRecord;});;

/* /web/static/src/js/views/kanban/kanban_record_quick_create.js defined in bundle 'web.assets_backend' */
odoo.define('web.kanban_record_quick_create',function(require){"use strict";var core=require('web.core');var QuickCreateFormView=require('web.QuickCreateFormView');var Widget=require('web.Widget');var qweb=core.qweb;var RecordQuickCreate=Widget.extend({className:'o_kanban_quick_create',custom_events:{add:'_onAdd',cancel:'_onCancel',},events:{'click .o_kanban_add':'_onAddClicked','click .o_kanban_edit':'_onEditClicked','click .o_kanban_cancel':'_onCancelClicked','mousedown':'_onMouseDown',},mouseDownInside:false,init:function(parent,options){this._super.apply(this,arguments);this.context=options.context;this.formViewRef=options.formViewRef;this.model=options.model;this._disabled=false;},willStart:function(){var self=this;var def1=this._super.apply(this,arguments);var def2;if(this.formViewRef){var views=[[false,'form']];var context=_.extend({},this.context,{form_view_ref:this.formViewRef,});def2=this.loadViews(this.model,context,views);}else{var fieldsView={};fieldsView.arch='<form>'+'<field name="display_name" placeholder="Title" modifiers=\'{"required": true}\'/>'+'</form>';var fields={display_name:{string:'Display name',type:'char'},};fieldsView.fields=fields;fieldsView.viewFields=fields;def2=$.when({form:fieldsView});}
def2=def2.then(function(fieldsViews){var formView=new QuickCreateFormView(fieldsViews.form,{context:self.context,modelName:self.model,userContext:self.getSession().user_context,});return formView.getController(self).then(function(controller){self.controller=controller;return self.controller.appendTo(document.createDocumentFragment());});});return $.when(def1,def2);},start:function(){this.$el.append(this.controller.$el);this.$el.append(qweb.render('KanbanView.RecordQuickCreate.buttons'));this.controller.autofocus();core.bus.on('click',this,this._onWindowClicked);return this._super.apply(this,arguments);},on_attach_callback:function(){if(this.controller){this.controller.autofocus();}},cancel:function(){var self=this;return this.controller.commitChanges().then(function(){if(!self.controller.isDirty()){self._cancel();}});},_add:function(options){var self=this;if(this._disabled){return $.Deferred();}
this._disableQuickCreate();this.controller.commitChanges().then(function(){var canBeSaved=self.controller.canBeSaved();if(canBeSaved){self.trigger_up('quick_create_add_record',{openRecord:options&&options.openRecord||false,values:self.controller.getChanges(),onFailure:self._enableQuickCreate.bind(self),});}else{self._enableQuickCreate();}}).fail(this._enableQuickCreate.bind(this));},_cancel:function(){this.trigger_up('cancel_quick_create');},_disableQuickCreate:function(){this._disabled=true;this.$el.addClass('o_disabled');this.$('input:not(:disabled)').addClass('o_temporarily_disabled').attr('disabled','disabled');},_enableQuickCreate:function(){this._disabled=false;this.$el.removeClass('o_disabled');this.$('input.o_temporarily_disabled').removeClass('o_temporarily_disabled').attr('disabled',false);},_onAdd:function(ev){ev.stopPropagation();this._add();},_onAddClicked:function(ev){ev.stopPropagation();this._add();},_onCancel:function(ev){ev.stopPropagation();this._cancel();},_onCancelClicked:function(ev){ev.stopPropagation();this._cancel();},_onEditClicked:function(ev){ev.stopPropagation();this._add({openRecord:true});},_onWindowClicked:function(ev){var mouseDownInside=this.mouseDownInside;this.mouseDownInside=false;if(!document.contains(this.el)){return;}
if($(ev.target).closest('.o-kanban-button-new, .o_kanban_quick_add').length){return;}
if($(ev.target).parents('.ui-autocomplete').length){return;}
if($(ev.target).closest('.modal').length){return;}
if($(document.body).hasClass('modal-open')){return;}
if(!document.contains(ev.target)){return;}
if(this.el.contains(ev.target)||this.el===ev.target||mouseDownInside){return;}
this.cancel();},_onMouseDown:function(ev){this.mouseDownInside=true;}});return RecordQuickCreate;});;

/* /web/static/src/js/views/kanban/kanban_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanRenderer',function(require){"use strict";var BasicRenderer=require('web.BasicRenderer');var core=require('web.core');var KanbanColumn=require('web.KanbanColumn');var KanbanRecord=require('web.KanbanRecord');var ColumnQuickCreate=require('web.kanban_column_quick_create');var QWeb=require('web.QWeb');var session=require('web.session');var utils=require('web.utils');var viewUtils=require('web.viewUtils');var qweb=core.qweb;function findInNode(node,predicate){if(predicate(node)){return node;}
if(!node.children){return undefined;}
for(var i=0;i<node.children.length;i++){if(findInNode(node.children[i],predicate)){return node.children[i];}}}
function qwebAddIf(node,condition){if(node.attrs[qweb.prefix+'-if']){condition=_.str.sprintf("(%s) and (%s)",node.attrs[qweb.prefix+'-if'],condition);}
node.attrs[qweb.prefix+'-if']=condition;}
function transformQwebTemplate(node,fields){if(node.tag&&node.attrs.modifiers){var modifiers=node.attrs.modifiers||{};if(modifiers.invisible){qwebAddIf(node,_.str.sprintf("!kanban_compute_domain(%s)",JSON.stringify(modifiers.invisible)));}}
switch(node.tag){case'button':case'a':var type=node.attrs.type||'';if(_.indexOf('action,object,edit,open,delete,url,set_cover'.split(','),type)!==-1){_.each(node.attrs,function(v,k){if(_.indexOf('icon,type,name,args,string,context,states,kanban_states'.split(','),k)!==-1){node.attrs['data-'+k]=v;delete(node.attrs[k]);}});if(node.attrs['data-string']){node.attrs.title=node.attrs['data-string'];}
if(node.tag==='a'&&node.attrs['data-type']!=="url"){node.attrs.href='#';}else{node.attrs.type='button';}
var action_classes=" oe_kanban_action oe_kanban_action_"+node.tag;if(node.attrs['t-attf-class']){node.attrs['t-attf-class']+=action_classes;}else if(node.attrs['t-att-class']){node.attrs['t-att-class']+=" + '"+action_classes+"'";}else{node.attrs['class']=(node.attrs['class']||'')+action_classes;}}
break;}
if(node.children){for(var i=0,ii=node.children.length;i<ii;i++){transformQwebTemplate(node.children[i],fields);}}}
var KanbanRenderer=BasicRenderer.extend({className:'o_kanban_view',config:{KanbanColumn:KanbanColumn,KanbanRecord:KanbanRecord,},custom_events:_.extend({},BasicRenderer.prototype.custom_events||{},{close_quick_create:'_onCloseQuickCreate',cancel_quick_create:'_onCloseQuickCreate',set_progress_bar_state:'_onSetProgressBarState',start_quick_create:'_onStartQuickCreate',quick_create_column_updated:'_onQuickCreateColumnUpdated',}),events:_.extend({},BasicRenderer.prototype.events||{},{'keydown .o_kanban_record':'_onRecordKeyDown'}),init:function(parent,state,params){this._super.apply(this,arguments);this.widgets=[];this.qweb=new QWeb(session.debug,{_s:session.origin},false);var templates=findInNode(this.arch,function(n){return n.tag==='templates';});transformQwebTemplate(templates,state.fields);this.qweb.add_template(utils.json_node_to_xml(templates));this.examples=params.examples;this.recordOptions=_.extend({},params.record_options,{qweb:this.qweb,viewType:'kanban',});this.columnOptions=_.extend({KanbanRecord:this.KanbanRecord},params.column_options);if(this.columnOptions.hasProgressBar){this.columnOptions.progressBarStates={};}
this.quickCreateEnabled=params.quickCreateEnabled;this._setState(state);},on_attach_callback:function(){this._isInDom=true;_.invoke(this.widgets,'on_attach_callback');if(this.quickCreate){this.quickCreate.on_attach_callback();}},on_detach_callback:function(){this._isInDom=false;_.invoke(this.widgets,'on_detach_callback');},addQuickCreate:function(){return this.widgets[0].addQuickCreate();},giveFocus:function(){this.$('.o_kanban_record:first').focus();},quickCreateToggleFold:function(){this.quickCreate.toggleFold();this._toggleNoContentHelper();},removeWidget:function(widget){this.widgets.splice(this.widgets.indexOf(widget),1);widget.destroy();},updateColumn:function(localID,columnState,options){var self=this;var KanbanColumn=this.config.KanbanColumn;var newColumn=new KanbanColumn(this,columnState,this.columnOptions,this.recordOptions);var index=_.findIndex(this.widgets,{db_id:localID});var column=this.widgets[index];this.widgets[index]=newColumn;if(options&&options.state){this.state=options.state;}
return newColumn.appendTo(document.createDocumentFragment()).then(function(){var def;if(options&&options.openQuickCreate){def=newColumn.addQuickCreate();}
return $.when(def).then(function(){newColumn.$el.insertAfter(column.$el);self._toggleNoContentHelper();newColumn.on_attach_callback();column.destroy();});});},updateRecord:function(recordState){var isGrouped=!!this.state.groupedBy.length;var record;if(isGrouped){_.each(this.widgets,function(widget){record=record||_.findWhere(widget.records,{db_id:recordState.id,});});}else{record=_.findWhere(this.widgets,{db_id:recordState.id});}
if(record){return record.update(recordState);}
return $.when();},updateState:function(state){this._setState(state);return this._super.apply(this,arguments);},_focusOnNextCard:function(currentCardElement){var nextCard=currentCardElement.nextElementSibling;if(nextCard){nextCard.focus();}},_focusOnPreviousCard:function(currentCardElement){var previousCard=currentCardElement.previousElementSibling;if(previousCard&&previousCard.classList.contains("o_kanban_record")){previousCard.focus();}},_renderGhostDivs:function(fragment,nbDivs){for(var $ghost,i=0;i<nbDivs;i++){$ghost=$('<div>').addClass('o_kanban_record o_kanban_ghost');$ghost.appendTo(fragment);}},_renderGrouped:function(fragment){var self=this;var KanbanColumn=this.config.KanbanColumn;_.each(this.state.data,function(group){var column=new KanbanColumn(self,group,self.columnOptions,self.recordOptions);var def;if(!group.value){def=column.prependTo(fragment);self.widgets.unshift(column);}else{def=column.appendTo(fragment);self.widgets.push(column);}
if(def.state()==='pending'){self.defs.push(def);}});if(this.$el.sortable('instance')!==undefined){this.$el.sortable('destroy');}
if(this.groupedByM2O){this.$el.sortable({axis:'x',items:'> .o_kanban_group',handle:'.o_kanban_header_title',cursor:'move',revert:150,delay:100,tolerance:'pointer',forcePlaceholderSize:true,stop:function(){var ids=[];self.$('.o_kanban_group').each(function(index,u){if(_.isNumber($(u).data('id'))){ids.push($(u).data('id'));}});self.trigger_up('resequence_columns',{ids:ids});},});if(this.createColumnEnabled){this.quickCreate=new ColumnQuickCreate(this,{examples:this.examples,});this.quickCreate.appendTo(fragment).then(function(){if(!self.state.data.length){self.quickCreate.toggleFold();}});}}},_renderUngrouped:function(fragment){var self=this;var KanbanRecord=this.config.KanbanRecord;_.each(this.state.data,function(record){var kanbanRecord=new KanbanRecord(self,record,self.recordOptions);self.widgets.push(kanbanRecord);var def=kanbanRecord.appendTo(fragment);if(def.state()==='pending'){self.defs.push(def);}});this._renderGhostDivs(fragment,6);},_renderView:function(){var self=this;var oldWidgets=this.widgets;this.widgets=[];var isGrouped=!!this.state.groupedBy.length;var fragment=document.createDocumentFragment();this.defs=[];if(isGrouped){this._renderGrouped(fragment);}else{this._renderUngrouped(fragment);}
var defs=this.defs;delete this.defs;defs.push(this._super.apply(this,arguments));return $.when.apply($,defs).then(function(){_.invoke(oldWidgets,'destroy');self.$el.empty();self.$el.toggleClass('o_kanban_grouped',isGrouped);self.$el.toggleClass('o_kanban_ungrouped',!isGrouped);self.$el.append(fragment);self._toggleNoContentHelper();if(self._isInDom){_.invoke(self.widgets,'on_attach_callback');}});},_toggleNoContentHelper:function(remove){var displayNoContentHelper=!remove&&!this._hasContent()&&!!this.noContentHelp&&!(this.quickCreate&&!this.quickCreate.folded)&&!this.state.isGroupedByM2ONoColumn;var $noContentHelper=this.$('.o_view_nocontent');if(displayNoContentHelper&&!$noContentHelper.length){this.$el.append(this._renderNoContentHelper());}
if(!displayNoContentHelper&&$noContentHelper.length){$noContentHelper.remove();}},_setState:function(state){this.state=state;var groupByField=state.groupedBy.length&&state.groupedBy[0].split(":")[0];var groupByFieldAttrs=state.fields[groupByField];var groupByFieldInfo=state.fieldsInfo.kanban[groupByField];var draggable=true;if(groupByFieldAttrs){if(groupByFieldAttrs.type==="date"||groupByFieldAttrs.type==="datetime"){draggable=false;}else if(groupByFieldAttrs.readonly!==undefined){draggable=!(groupByFieldAttrs.readonly);}}
if(groupByFieldInfo){if(draggable&&groupByFieldInfo.readonly!==undefined){draggable=!(groupByFieldInfo.readonly);}}
this.groupedByM2O=groupByFieldAttrs&&(groupByFieldAttrs.type==='many2one');var relation=this.groupedByM2O&&groupByFieldAttrs.relation;var groupByTooltip=groupByFieldInfo&&groupByFieldInfo.options.group_by_tooltip;this.columnOptions=_.extend(this.columnOptions,{draggable:draggable,group_by_tooltip:groupByTooltip,groupedBy:groupByField,grouped_by_m2o:this.groupedByM2O,relation:relation,quick_create:this.quickCreateEnabled&&viewUtils.isQuickCreateEnabled(state),});this.createColumnEnabled=this.groupedByM2O&&this.columnOptions.group_creatable;},_focusOnCardInColumn:function(eventTarget,direction){var currentColumn=eventTarget.parentElement;var hasSelectedACard=false;var cannotSelectAColumn=false;while(!hasSelectedACard&&!cannotSelectAColumn){var candidateColumn=direction==='LEFT'?currentColumn.previousElementSibling:currentColumn.nextElementSibling;currentColumn=candidateColumn;if(candidateColumn){var allCardsOfCandidateColumn=candidateColumn.getElementsByClassName('o_kanban_record');if(allCardsOfCandidateColumn.length){allCardsOfCandidateColumn[0].focus();hasSelectedACard=true;}}
else{direction==='LEFT'?this._focusOnPreviousCard(eventTarget):this._focusOnNextCard(eventTarget);cannotSelectAColumn=true;}}},_onCloseQuickCreate:function(){if(this.state.groupedBy.length){_.invoke(this.widgets,'cancelQuickCreate');}
this._toggleNoContentHelper();},_onQuickCreateColumnUpdated:function(event){event.stopPropagation();this._toggleNoContentHelper();},_onRecordKeyDown:function(e){switch(e.which){case $.ui.keyCode.DOWN:this._focusOnNextCard(e.currentTarget);e.stopPropagation();e.preventDefault();break;case $.ui.keyCode.UP:this._focusOnPreviousCard(e.currentTarget);e.stopPropagation();e.preventDefault();break;case $.ui.keyCode.RIGHT:this._focusOnCardInColumn(e.currentTarget,'RIGHT');e.stopPropagation();e.preventDefault();break;case $.ui.keyCode.LEFT:this._focusOnCardInColumn(e.currentTarget,'LEFT');e.stopPropagation();e.preventDefault();break;}},_onSetProgressBarState:function(ev){if(!this.columnOptions.progressBarStates[ev.data.columnID]){this.columnOptions.progressBarStates[ev.data.columnID]={};}
_.extend(this.columnOptions.progressBarStates[ev.data.columnID],ev.data.values);},_onStartQuickCreate:function(){this._toggleNoContentHelper(true);},});return KanbanRenderer;});;

/* /web/static/src/js/views/kanban/kanban_renderer_mobile.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanRendererMobile',function(require){"use strict";var config=require('web.config');var core=require('web.core');var KanbanRenderer=require('web.KanbanRenderer');var _t=core._t;var qweb=core.qweb;if(!config.device.isMobile){return;}
KanbanRenderer.include({events:_.extend({},KanbanRenderer.prototype.events,{'click .o_kanban_mobile_tab':'_onMobileTabClicked',}),ANIMATE:true,init:function(){this._super.apply(this,arguments);this.activeColumnIndex=0;this._scrollPosition=null;},on_attach_callback:function(){if(this._scrollPosition&&this.state.groupedBy.length&&this.widgets.length){var $column=this.widgets[this.activeColumnIndex].$el;$column.scrollLeft(this._scrollPosition.left);$column.scrollTop(this._scrollPosition.top);}
this._super.apply(this,arguments);},on_detach_callback:function(){if(this.state.groupedBy.length&&this.widgets.length){var $column=this.widgets[this.activeColumnIndex].$el;this._scrollPosition={left:$column.scrollLeft(),top:$column.scrollTop(),};}else{this._scrollPosition=null;}
this._super.apply(this,arguments);},addQuickCreate:function(){return this.widgets[this.activeColumnIndex].addQuickCreate();},updateColumn:function(localID){var self=this;var index=_.findIndex(this.widgets,{db_id:localID});var $column=this.widgets[index].$el;var left=$column.css('left');var right=$column.css('right');var scrollTop=$column.scrollTop();return this._super.apply(this,arguments).then(function(){$column=self.widgets[index].$el;if(_t.database.parameters.direction==='rtl'){$column.css({right:right});}else{$column.css({left:left});}
$column.scrollTop(scrollTop);self._enableSwipe();});},_enableSwipe:function(){var self=this;var step=_t.database.parameters.direction==='rtl'?-1:1;this.$el.swipe({swipeLeft:function(){self._moveToGroup(self.activeColumnIndex+step,self.ANIMATE);},swipeRight:function(){self._moveToGroup(self.activeColumnIndex-step,self.ANIMATE);}});},_moveToGroup:function(moveToIndex,animate){var self=this;if(moveToIndex<0||moveToIndex>=this.widgets.length){return $.when();}
var def=$.Deferred();this.activeColumnIndex=moveToIndex;var column=this.widgets[this.activeColumnIndex];this.trigger_up('kanban_load_records',{columnID:column.db_id,onSuccess:function(){var updateFunc=animate?'animate':'css';self.$('.o_kanban_mobile_tab').removeClass('o_current');_.each(self.widgets,function(column,index){var columnID=column.id||column.db_id;var $column=self.$('.o_kanban_group[data-id="'+columnID+'"]');var $tab=self.$('.o_kanban_mobile_tab[data-id="'+columnID+'"]');var colPosition,tabPosition;if(index===moveToIndex-1){colPosition='-100%';tabPosition='0%';}else if(index===moveToIndex+1){colPosition='100%';tabPosition='100%';}else if(index===moveToIndex){colPosition='0%';tabPosition='50%';$tab.addClass('o_current');}else if(index<moveToIndex){colPosition='-100%';tabPosition='-100%';}else if(index>moveToIndex){colPosition='100%';tabPosition='200%';}else{return;}
if(_t.database.parameters.direction==='rtl'){$column[updateFunc]({right:colPosition});$tab[updateFunc]({right:tabPosition});}else{$column[updateFunc]({left:colPosition});$tab[updateFunc]({left:tabPosition});}});def.resolve();},});return def;},_renderGrouped:function(fragment){var data=[];_.each(this.state.data,function(group){if(!group.value){group=_.extend({},group,{value:_t('Undefined')});data.unshift(group);}
else{data.push(group);}});var $tabs=$(qweb.render('KanbanView.MobileTabs',{data:data,}));$tabs.appendTo(fragment);return this._super.apply(this,arguments);},_renderView:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.state.groupedBy.length){return self._moveToGroup(self.activeColumnIndex);}});},_onMobileTabClicked:function(event){this._moveToGroup($(event.currentTarget).index(),true);},});});;

/* /web/static/src/js/views/kanban/kanban_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.KanbanView',function(require){"use strict";var BasicView=require('web.BasicView');var core=require('web.core');var config=require('web.config');var KanbanModel=require('web.KanbanModel');var KanbanRenderer=require('web.KanbanRenderer');var KanbanController=require('web.KanbanController');var kanbanExamplesRegistry=require('web.kanban_examples_registry');var utils=require('web.utils');var _lt=core._lt;var KanbanView=BasicView.extend({accesskey:"k",display_name:_lt("Kanban"),icon:'fa-th-large',mobile_friendly:true,config:{Model:KanbanModel,Controller:KanbanController,Renderer:KanbanRenderer,},jsLibs:[],viewType:'kanban',init:function(viewInfo,params){this._super.apply(this,arguments);this.loadParams.limit=this.loadParams.limit||40;this.loadParams.openGroupByDefault=config.device.isMobile?false:true;this.loadParams.type='list';if(this.groupable){this.loadParams.groupBy=this.arch.attrs.default_group_by?[this.arch.attrs.default_group_by]:(params.groupBy||[]);}else{this.loadParams.groupBy=[];}
var progressBar;utils.traverse(this.arch,function(n){var isProgressBar=(n.tag==='progressbar');if(isProgressBar){progressBar=_.clone(n.attrs);progressBar.colors=JSON.parse(progressBar.colors);progressBar.sum_field=progressBar.sum_field||false;}
return!isProgressBar;});if(progressBar){this.loadParams.progressBar=progressBar;}
var activeActions=this.controllerParams.activeActions;activeActions=_.extend(activeActions,{group_create:this.arch.attrs.group_create?JSON.parse(this.arch.attrs.group_create):true,group_edit:this.arch.attrs.group_edit?JSON.parse(this.arch.attrs.group_edit):true,group_delete:this.arch.attrs.group_delete?JSON.parse(this.arch.attrs.group_delete):true,});this.rendererParams.column_options={editable:activeActions.group_edit,deletable:activeActions.group_delete,archivable:this.arch.attrs.archivable?JSON.parse(this.arch.attrs.archivable):true,group_creatable:activeActions.group_create&&!config.device.isMobile,quickCreateView:this.arch.attrs.quick_create_view||null,hasProgressBar:!!progressBar,};this.rendererParams.record_options={editable:activeActions.edit,deletable:activeActions.delete,read_only_mode:params.readOnlyMode,};this.rendererParams.quickCreateEnabled=this._isQuickCreateEnabled();var examples=this.arch.attrs.examples;if(examples){this.rendererParams.examples=kanbanExamplesRegistry.get(examples);}
this.controllerParams.on_create=this.arch.attrs.on_create;this.controllerParams.readOnlyMode=false;this.controllerParams.hasButtons=true;this.controllerParams.quickCreateEnabled=this.rendererParams.quickCreateEnabled;if(config.device.isMobile){this.jsLibs.push('/web/static/lib/jquery.touchSwipe/jquery.touchSwipe.js');}},_isQuickCreateEnabled:function(){if(!this.controllerParams.activeActions.create){return false;}
if(this.arch.attrs.quick_create!==undefined){return JSON.parse(this.arch.attrs.quick_create);}
return true;},});return KanbanView;});;

/* /web/static/src/js/views/kanban/quick_create_form_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.QuickCreateFormView',function(require){"use strict";var BasicModel=require('web.BasicModel');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var FormView=require('web.FormView');var QuickCreateFormRenderer=FormRenderer.extend({start:function(){this.$el.addClass('o_xxs_form_view');return this._super.apply(this,arguments);},_onNavigationMove:function(ev){var direction=ev.data.direction;if(direction==='cancel'||direction==='next_line'){ev.stopPropagation();this.trigger_up(direction==='cancel'?'cancel':'add');}else{this._super.apply(this,arguments);}},});var QuickCreateFormModel=BasicModel.extend({getChanges:function(localID){var record=this.localData[localID];return this._generateChanges(record,{changesOnly:false});},});var QuickCreateFormController=FormController.extend({custom_events:_.extend({},FormController.prototype.custom_events,{env_updated:'_onEnvUpdated',}),commitChanges:function(){var mutexDef=this.mutex.getUnlockedDef();return $.when(mutexDef,this.renderer.commitChanges(this.handle));},getChanges:function(){return this.model.getChanges(this.handle);},_onEnvUpdated:function(ev){ev.stopPropagation();},});var QuickCreateFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Model:QuickCreateFormModel,Renderer:QuickCreateFormRenderer,Controller:QuickCreateFormController,}),});return QuickCreateFormView;});;

/* /web/static/src/js/views/list/list_editable_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.EditableListRenderer',function(require){"use strict";var core=require('web.core');var dom=require('web.dom');var ListRenderer=require('web.ListRenderer');var utils=require('web.utils');var _t=core._t;ListRenderer.include({custom_events:_.extend({},ListRenderer.prototype.custom_events,{navigation_move:'_onNavigationMove',}),events:_.extend({},ListRenderer.prototype.events,{'click .o_field_x2many_list_row_add a':'_onAddRecord','keydown .o_field_x2many_list_row_add a':'_onKeyDownAddRecord','click tbody td.o_data_cell':'_onCellClick','click tbody tr:not(.o_data_row)':'_onEmptyRowClick','click tfoot':'_onFooterClick','click tr .o_list_record_remove':'_onRemoveIconClick',}),init:function(parent,state,params){var self=this;this._super.apply(this,arguments);this.addCreateLine=params.addCreateLine;if(this.addCreateLine){this.creates=[];_.each(this.arch.children,function(child){if(child.tag!=='control'){return;}
_.each(child.children,function(child){if(child.tag!=='create'||child.attrs.invisible){return;}
self.creates.push({context:child.attrs.context,string:child.attrs.string,});});});if(this.creates.length===0){this.creates.push({string:_t("Add a line"),});}}
this.addTrashIcon=params.addTrashIcon;this.isMany2Many=params.isMany2Many;this.currentRow=null;this.currentFieldIndex=null;},start:function(){if(this.editable){this.$el.css({height:'100%'});core.bus.on('click',this,this._onWindowClicked.bind(this));}
return this._super();},canBeSaved:function(recordID){if((recordID||this.state.id)===this.state.id){recordID=this.getEditableRecordID();if(recordID===null){return[];}}
return this._super(recordID);},confirmChange:function(state,id){var self=this;return this._super.apply(this,arguments).then(function(widgets){if(widgets.length){var rowIndex=_.findIndex(state.data,function(r){return r.id===id;});var $row=self.$('.o_data_row:nth('+rowIndex+')');self._setDecorationClasses(state.data[rowIndex],$row);self._updateFooter();}
return widgets;});},confirmUpdate:function(state,id,fields,ev){var self=this;var currentRowID,currentWidget,focusedElement,selectionRange;if(self.currentRow!==null){currentRowID=this.state.data[this.currentRow].id;currentWidget=this.allFieldWidgets[currentRowID][this.currentFieldIndex];if(currentWidget){focusedElement=currentWidget.getFocusableElement().get(0);if(currentWidget.formatType!=='boolean'&&focusedElement){selectionRange=dom.getSelectionRange(focusedElement);}}}
var oldData=this.state.data;this.state=state;return this.confirmChange(state,id,fields,ev).then(function(){var record=_.findWhere(state.data,{id:id});if(!record){return;}
var oldRowIndex=_.findIndex(oldData,{id:id});var $row=self.$('.o_data_row:nth('+oldRowIndex+')');$row.nextAll('.o_data_row').remove();$row.prevAll().remove();_.each(oldData,function(rec){if(rec.id!==id){self._destroyFieldWidgets(rec.id);}});var newRowIndex=_.findIndex(state.data,{id:id});var $lastRow=$row;_.each(state.data,function(record,index){if(index===newRowIndex){return;}
var $newRow=self._renderRow(record);if(index<newRowIndex){$newRow.insertBefore($row);}else{$newRow.insertAfter($lastRow);$lastRow=$newRow;}});if(self.currentRow!==null){self.currentRow=newRowIndex;return self._selectCell(newRowIndex,self.currentFieldIndex,{force:true}).then(function(){currentRowID=self.state.data[newRowIndex].id;currentWidget=self.allFieldWidgets[currentRowID][self.currentFieldIndex];if(currentWidget){focusedElement=currentWidget.getFocusableElement().get(0);if(selectionRange){dom.setSelectionRange(focusedElement,selectionRange);}}});}});},editRecord:function(recordID){var rowIndex=_.findIndex(this.state.data,{id:recordID});this._selectCell(rowIndex,0);},getEditableRecordID:function(){if(this.currentRow!==null){return this.state.data[this.currentRow].id;}
return null;},removeLine:function(state,recordID){var rowIndex=_.findIndex(this.state.data,{id:recordID});this.state=state;if(rowIndex===-1){return;}
if(rowIndex===this.currentRow){this.currentRow=null;}
this._destroyFieldWidgets(recordID);var $row=this.$('.o_data_row:nth('+rowIndex+')');if(this.state.count>=4){$row.remove();}else{$row.replaceWith(this._renderEmptyRow());}},setRowMode:function(recordID,mode){var self=this;var record;var rowIndex;if(this.state.groupedBy.length){rowIndex=-1;var count=0;utils.traverse_records(this.state,function(r){if(r.id===recordID){record=r;rowIndex=count;}
count++;});}else{rowIndex=_.findIndex(this.state.data,{id:recordID});record=this.state.data[rowIndex];}
if(rowIndex<0){return $.when();}
var editMode=(mode==='edit');this.currentRow=editMode?rowIndex:null;var $row=this.$('.o_data_row:nth('+rowIndex+')');var $tds=$row.children('.o_data_cell');var oldWidgets=_.clone(this.allFieldWidgets[record.id]);if(editMode){$tds.each(function(){var $td=$(this);$td.css({width:$td[0].getBoundingClientRect().width});});}
var options={renderInvisible:editMode,renderWidgets:editMode,};options.mode=editMode?'edit':'readonly';var defs=[];this.defs=defs;_.each(this.columns,function(node,colIndex){var $td=$tds.eq(colIndex);var $newTd=self._renderBodyCell(record,node,colIndex,options);if($td.hasClass('o_list_button')){self._unregisterModifiersElement(node,recordID,$td.children());}
if(editMode){$td.empty().append($newTd.contents());}else{self._unregisterModifiersElement(node,recordID,$td);$td.replaceWith($newTd);}});delete this.defs;_.each(oldWidgets,this._destroyFieldWidget.bind(this,recordID));$row.toggleClass('o_selected_row',editMode);$row.find('.o_list_record_selector input').prop('disabled',!record.res_id);return $.when.apply($,defs).then(function(){core.bus.trigger('DOM_updated');});},unselectRow:function(){if(this.currentRow===null){return $.when();}
var record=this.state.data[this.currentRow];var recordWidgets=this.allFieldWidgets[record.id];toggleWidgets(true);var def=$.Deferred();this.trigger_up('save_line',{recordID:record.id,onSuccess:def.resolve.bind(def),onFailure:def.reject.bind(def),});return def.fail(toggleWidgets.bind(null,false));function toggleWidgets(disabled){_.each(recordWidgets,function(widget){var $el=widget.getFocusableElement();$el.prop('disabled',disabled);});}},updateState:function(state,params){if(params.noRender){this.allModifiersData=[];}
return this._super.apply(this,arguments);},_destroyFieldWidgets:function(recordID){if(recordID in this.allFieldWidgets){var widgetsToDestroy=this.allFieldWidgets[recordID].slice();_.each(widgetsToDestroy,this._destroyFieldWidget.bind(this,recordID));delete this.allFieldWidgets[recordID];}},_getNumberOfCols:function(){var n=this._super();if(this.addTrashIcon){n++;}
return n;},_isEditable:function(){return!this.state.groupedBy.length&&this.editable;},_moveToPreviousLine:function(){if(this.currentRow>0){this._selectCell(this.currentRow-1,this.columns.length-1,{inc:-1});}else{this.unselectRow().then(this.trigger_up.bind(this,'add_record'));}},_moveToNextLine:function(){var self=this;var record=this.state.data[this.currentRow];this.commitChanges(record.id).then(function(){var fieldNames=self.canBeSaved(record.id);if(fieldNames.length){return;}
if(self.currentRow<self.state.data.length-1){self._selectCell(self.currentRow+1,0);}else{self.unselectRow().then(function(){self.trigger_up('add_record',{onFail:self._selectCell.bind(self,0,0,{}),});});}});},_render:function(){this.currentRow=null;this.currentFieldIndex=null;return this._super.apply(this,arguments);},_renderBody:function(){var $body=this._super();if(this.hasHandle){$body.sortable({axis:'y',items:'> tr.o_data_row',helper:'clone',handle:'.o_row_handle',stop:this._resequence.bind(this),});}
return $body;},_renderRow:function(record,index){var $row=this._super.apply(this,arguments);if(this.addTrashIcon){var $icon=this.isMany2Many?$('<button>',{class:'fa fa-times',name:'unlink','aria-label':_t('Unlink row ')+(index+1)}):$('<button>',{class:'fa fa-trash-o',name:'delete','aria-label':_t('Delete row ')+(index+1)});var $td=$('<td>',{class:'o_list_record_remove'}).append($icon);$row.append($td);}
return $row;},_renderRows:function(){var self=this;var $rows=this._super();if(this.addCreateLine){var $tr=$('<tr>');var colspan=self._getNumberOfCols();if(this.handleField){colspan=colspan-1;$tr.append('<td>');}
var $td=$('<td>').attr('colspan',colspan).addClass('o_field_x2many_list_row_add');$tr.append($td);$rows.push($tr);_.each(self.creates,function(create,index){var $a=$('<a href="#" role="button">').attr('data-context',create.context).text(create.string);if(index>0){$a.addClass('ml16');}
$td.append($a);});}
return $rows;},_renderView:function(){var self=this;this.currentRow=null;return this._super.apply(this,arguments).then(function(){if(self._isEditable()){self.$('table').addClass('o_editable_list');}});},_resequence:function(event,ui){var self=this;var movedRecordID=ui.item.data('id');self.unselectRow().then(function(){var rows=self.state.data;var row=_.findWhere(rows,{id:movedRecordID});var index0=rows.indexOf(row);var index1=ui.item.index();var lower=Math.min(index0,index1);var upper=Math.max(index0,index1)+1;var order=_.findWhere(self.state.orderedBy,{name:self.handleField});var asc=!order||order.asc;var reorderAll=false;var sequence=(asc?-1:1)*Infinity;_.each(rows,function(row,index){if((index<lower||index>=upper)&&((asc&&sequence>=row.data[self.handleField])||(!asc&&sequence<=row.data[self.handleField]))){reorderAll=true;}
sequence=row.data[self.handleField];});if(reorderAll){rows=_.without(rows,row);rows.splice(index1,0,row);}else{rows=rows.slice(lower,upper);rows=_.without(rows,row);if(index0>index1){rows.unshift(row);}else{rows.push(row);}}
var sequences=_.pluck(_.pluck(rows,'data'),self.handleField);var rowIDs=_.pluck(rows,'id');if(!asc){rowIDs.reverse();}
self.trigger_up('resequence',{rowIDs:rowIDs,offset:_.min(sequences),handleField:self.handleField,});});},_selectCell:function(rowIndex,fieldIndex,options){options=options||{};if(!options.force&&rowIndex===this.currentRow&&fieldIndex===this.currentFieldIndex){return $.when();}
var wrap=options.wrap===undefined?true:options.wrap;var self=this;return this._selectRow(rowIndex).then(function(){var record=self.state.data[rowIndex];if(fieldIndex>=(self.allFieldWidgets[record.id]||[]).length){return $.Deferred().reject();}
var oldFieldIndex=self.currentFieldIndex;self.currentFieldIndex=fieldIndex;fieldIndex=self._activateFieldWidget(record,fieldIndex,{inc:options.inc||1,wrap:wrap,event:options&&options.event,});if(fieldIndex<0){self.currentFieldIndex=oldFieldIndex;return $.Deferred().reject();}
self.currentFieldIndex=fieldIndex;});},_selectRow:function(rowIndex){if(rowIndex===this.currentRow){return $.when();}
var self=this;return this.unselectRow().then(function(){if(self.state.data.length<=rowIndex){return $.Deferred().reject();}
var def=$.Deferred();self.trigger_up('edit_line',{index:rowIndex,onSuccess:def.resolve.bind(def),});return def;});},_onAddRecord:function(ev){ev.preventDefault();ev.stopPropagation();var self=this;this.unselectRow().then(function(){self.trigger_up('add_record',{context:ev.currentTarget.dataset.context&&[ev.currentTarget.dataset.context]});});},_onCellClick:function(event){if(!this._isEditable()||$(event.target).prop('special_click')){return;}
var $td=$(event.currentTarget);var $tr=$td.parent();var rowIndex=this.$('.o_data_row').index($tr);var fieldIndex=Math.max($tr.find('.o_data_cell').not('.o_list_button').index($td),0);this._selectCell(rowIndex,fieldIndex,{event:event});},_onEmptyRowClick:function(){this.unselectRow();},_onFooterClick:function(){this.unselectRow();},_onKeyDownAddRecord:function(e){switch(e.keyCode){case $.ui.keyCode.ENTER:e.stopPropagation();e.preventDefault();this._onAddRecord(e);break;}},_getLastWidget:function(){var record=this.state.data[this.currentRow];var recordWidgets=this.allFieldWidgets[record.id];var lastWidget=_.chain(recordWidgets).filter(function(widget){var isLast=widget.$el.is(':visible')&&(widget.$('input').length>0||widget.tagName==='input'||widget.$('textarea').length>0||widget.tagName==='textarea')&&!widget.$el.hasClass('o_readonly_modifier');return isLast;}).last().value();return lastWidget;},_onNavigationMove:function(ev){ev.stopPropagation();switch(ev.data.direction){case'previous':if(this.currentFieldIndex>0){this._selectCell(this.currentRow,this.currentFieldIndex-1,{inc:-1,wrap:false}).fail(this._moveToPreviousLine.bind(this));}else{this._moveToPreviousLine();}
break;case'next':var column=this.columns[this.currentFieldIndex];var lastWidget=this._getLastWidget();if(column.attrs.name===lastWidget.name){if(this.currentRow+1<this.state.data.length){this._selectCell(this.currentRow+1,0,{wrap:false}).fail(this._moveToNextLine.bind(this));}else{var currentRowData=this.state.data[this.currentRow];if(currentRowData.isDirty(currentRowData.id)){this._moveToNextLine();}
else{this.trigger_up('activate_next_widget');}}}else{if(this.currentFieldIndex+1<this.columns.length){this._selectCell(this.currentRow,this.currentFieldIndex+1,{wrap:false}).fail(this._moveToNextLine.bind(this));}else{this._moveToNextLine();}}
break;case'next_line':this._moveToNextLine();break;case'cancel':ev.data.originalEvent.stopPropagation();this.trigger_up('discard_changes',{recordID:ev.target.dataPointID,});this.$('.o_field_x2many_list_row_add a:first').focus();break;}},_onRemoveIconClick:function(event){event.stopPropagation();var $row=$(event.target).closest('tr');var id=$row.data('id');if($row.hasClass('o_selected_row')){this.trigger_up('list_record_remove',{id:id});}else{var self=this;this.unselectRow().then(function(){self.trigger_up('list_record_remove',{id:id});});}},_onRowClicked:function(){if(!this._isEditable()){this._super.apply(this,arguments);}},_onSortColumn:function(){if(this.currentRow===null){this._super.apply(this,arguments);}},_onWindowClicked:function(event){if(!document.contains(this.el)){return;}
if(this.currentRow===null){return;}
if($(event.target).closest('.ui-autocomplete').length){return;}
var $clickModal=$(event.target).closest('.modal');if($clickModal.length){var $listModal=this.$el.closest('.modal');if($clickModal.prop('id')!==$listModal.prop('id')){return;}}
if(!document.contains(event.target)){return;}
if(this.el.contains(event.target)&&this.el!==event.target){return;}
this.unselectRow();},});});;

/* /web/static/src/js/views/list/list_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.ListRenderer',function(require){"use strict";var BasicRenderer=require('web.BasicRenderer');var config=require('web.config');var core=require('web.core');var dom=require('web.dom');var field_utils=require('web.field_utils');var Pager=require('web.Pager');var utils=require('web.utils');var _t=core._t;var DECORATIONS=['decoration-bf','decoration-it','decoration-danger','decoration-info','decoration-muted','decoration-primary','decoration-success','decoration-warning'];var FIELD_CLASSES={float:'o_list_number',integer:'o_list_number',monetary:'o_list_number',text:'o_list_text',};var HEADING_COLUMNS_TO_SKIP_IN_GROUPS=2;var ListRenderer=BasicRenderer.extend({events:{'click tbody tr':'_onRowClicked','click tbody .o_list_record_selector':'_onSelectRecord','click thead th.o_column_sortable':'_onSortColumn','click .o_group_header':'_onToggleGroup','click thead .o_list_record_selector input':'_onToggleSelection','keypress thead tr td':'_onKeyPress','keydown tr':'_onKeyDown','keydown thead tr':'_onKeyDown',},init:function(parent,state,params){this._super.apply(this,arguments);this.handleField=null;this._processColumns(params.columnInvisibleFields||{});this.rowDecorations=_.chain(this.arch.attrs).pick(function(value,key){return DECORATIONS.indexOf(key)>=0;}).mapObject(function(value){return py.parse(py.tokenize(value));}).value();this.hasSelectors=params.hasSelectors;this.selection=params.selectedRecords||[];this.pagers=[];this.editable=params.editable;this.isGrouped=this.state.groupedBy.length>0;},giveFocus:function(){this.$('tbody .o_list_record_selector input:first()').focus();},updateState:function(state,params){this.isGrouped=state.groupedBy.length>0;this._processColumns(params.columnInvisibleFields||{});if(params.selectedRecords){this.selection=params.selectedRecords;}
return this._super.apply(this,arguments);},_computeAggregates:function(){var self=this;var data=[];if(this.selection.length){utils.traverse_records(this.state,function(record){if(_.contains(self.selection,record.id)){data.push(record);}});}else{data=this.state.data;}
_.each(this.columns,this._computeColumnAggregates.bind(this,data));},_computeColumnAggregates:function(data,column){var attrs=column.attrs;var field=this.state.fields[attrs.name];if(!field){return;}
var type=field.type;if(type!=='integer'&&type!=='float'&&type!=='monetary'){return;}
var func=(attrs.sum&&'sum')||(attrs.avg&&'avg')||(attrs.max&&'max')||(attrs.min&&'min');if(func){var count=0;var aggregateValue=(func==='max')?-Infinity:(func==='min')?Infinity:0;_.each(data,function(d){count+=1;var value=(d.type==='record')?d.data[attrs.name]:d.aggregateValues[attrs.name];if(func==='avg'){aggregateValue+=value;}else if(func==='sum'){aggregateValue+=value;}else if(func==='max'){aggregateValue=Math.max(aggregateValue,value);}else if(func==='min'){aggregateValue=Math.min(aggregateValue,value);}});if(func==='avg'){aggregateValue=count?aggregateValue/count:aggregateValue;}
column.aggregate={help:attrs[func],value:aggregateValue,};}},_getNumberOfCols:function(){var n=this.columns.length;return this.hasSelectors?n+1:n;},_processColumns:function(columnInvisibleFields){var self=this;self.handleField=null;this.columns=_.reject(this.arch.children,function(c){if(c.tag==='control'){return true;}
var reject=c.attrs.modifiers.column_invisible;if(c.attrs.name in columnInvisibleFields){reject=columnInvisibleFields[c.attrs.name];}
if(!reject&&c.attrs.widget==='handle'){self.handleField=c.attrs.name;}
return reject;});},_renderAggregateCells:function(aggregateValues,isHeader){var self=this;return _.map(this.columns,function(column,index){if(isHeader&&index===0){return;}
var $cell=$('<td>');if(config.debug){$cell.addClass(column.attrs.name);}
if(column.attrs.name in aggregateValues){var field=self.state.fields[column.attrs.name];var value=aggregateValues[column.attrs.name].value;var help=aggregateValues[column.attrs.name].help;var formatFunc=field_utils.format[column.attrs.widget];if(!formatFunc){formatFunc=field_utils.format[field.type];}
var formattedValue=formatFunc(value,field,{escape:true,digits:column.attrs.digits?JSON.parse(column.attrs.digits):undefined,});$cell.addClass('o_list_number').attr('title',help).html(formattedValue);}
return $cell;});},_renderBody:function(){var $rows=this._renderRows();while($rows.length<4){$rows.push(this._renderEmptyRow());}
return $('<tbody>').append($rows);},_renderBodyCell:function(record,node,colIndex,options){var tdClassName='o_data_cell';if(node.tag==='button'){tdClassName+=' o_list_button';}else if(node.tag==='field'){var typeClass=FIELD_CLASSES[this.state.fields[node.attrs.name].type];if(typeClass){tdClassName+=(' '+typeClass);}
if(node.attrs.widget){tdClassName+=(' o_'+node.attrs.widget+'_cell');}}
var $td=$('<td>',{class:tdClassName});var modifiers=this._registerModifiers(node,record,$td,_.pick(options,'mode'));if(modifiers.invisible&&!(options&&options.renderInvisible)){return $td;}
if(node.tag==='button'){return $td.append(this._renderButton(record,node));}else if(node.tag==='widget'){return $td.append(this._renderWidget(record,node));}
if(node.attrs.widget||(options&&options.renderWidgets)){var $el=this._renderFieldWidget(node,record,_.pick(options,'mode'));this._handleAttributes($el,node);return $td.append($el);}
var name=node.attrs.name;var field=this.state.fields[name];var value=record.data[name];var formattedValue=field_utils.format[field.type](value,field,{data:record.data,escape:true,isPassword:'password'in node.attrs,digits:node.attrs.digits?JSON.parse(node.attrs.digits):undefined,});this._handleAttributes($td,node);return $td.html(formattedValue);},_renderButton:function(record,node){var self=this;var $button=this._renderButtonFromNode(node,{extraClass:node.attrs.icon?'o_icon_button':undefined,textAsTitle:!!node.attrs.icon,});this._handleAttributes($button,node);this._registerModifiers(node,record,$button);if(record.res_id){$button.on("click",function(e){e.stopPropagation();self.trigger_up('button_clicked',{attrs:node.attrs,record:record,});});}else{if(node.attrs.options.warn){$button.on("click",function(e){e.stopPropagation();self.do_warn(_t("Warning"),_t('Please click on the "save" button first.'));});}else{$button.prop('disabled',true);}}
return $button;},_renderEmptyRow:function(){var $td=$('<td>&nbsp;</td>').attr('colspan',this._getNumberOfCols());return $('<tr>').append($td);},_renderFooter:function(){var aggregates={};_.each(this.columns,function(column){if('aggregate'in column){aggregates[column.attrs.name]=column.aggregate;}});var $cells=this._renderAggregateCells(aggregates,false);if(this.hasSelectors){$cells.unshift($('<td>'));}
return $('<tfoot>').append($('<tr>').append($cells));},_renderGroupPager:function(group){var pager=new Pager(this,group.count,group.offset+1,group.limit);pager.on('pager_changed',this,function(newState){var self=this;pager.disable();this.trigger_up('load',{id:group.id,limit:newState.limit,offset:newState.current_min-1,on_success:function(reloadedGroup){_.extend(group,reloadedGroup);self._renderView();},on_fail:pager.enable.bind(pager),});});this.pagers.push(pager);var fragment=document.createDocumentFragment();pager.appendTo(fragment);return pager.$el;},_renderGroupRow:function(group,groupLevel){var aggregateValues=_.mapObject(group.aggregateValues,function(value){return{value:value};});var $cells=this._renderAggregateCells(aggregateValues,true);var name=group.value===undefined?_t('Undefined'):group.value;var groupBy=this.state.groupedBy[groupLevel];if(group.fields[groupBy.split(':')[0]].type!=='boolean'){name=name||_t('Undefined');}
var $th=$('<th>').addClass('o_group_name').text(name+' ('+group.count+')');if(this.hasSelectors){$th.attr('colspan',HEADING_COLUMNS_TO_SKIP_IN_GROUPS);}
var $arrow=$('<span>').css('padding-left',(groupLevel*20)+'px').css('padding-right','5px').addClass('fa');if(group.count>0){$arrow.toggleClass('fa-caret-right',!group.isOpen).toggleClass('fa-caret-down',group.isOpen);}
$th.prepend($arrow);if(group.isOpen&&!group.groupedBy.length&&(group.count>group.data.length)){var $pager=this._renderGroupPager(group);var $lastCell=$cells[$cells.length-1]||$th;$lastCell.addClass('o_group_pager').append($pager);}
return $('<tr>').addClass('o_group_header').toggleClass('o_group_open',group.isOpen).toggleClass('o_group_has_content',group.count>0).data('group',group).append($th).append($cells);},_renderGroups:function(data,groupLevel){var self=this;groupLevel=groupLevel||0;var result=[];var $tbody=$('<tbody>');_.each(data,function(group){if(!$tbody){$tbody=$('<tbody>');}
$tbody.append(self._renderGroupRow(group,groupLevel));if(group.data.length){result.push($tbody);if(group.groupedBy.length){result=result.concat(self._renderGroups(group.data,groupLevel+1));}else{var $records=_.map(group.data,function(record){return self._renderRow(record);});result.push($('<tbody>').append($records));}
$tbody=null;}});if($tbody){result.push($tbody);}
return result;},_renderHeader:function(isGrouped){var $tr=$('<tr>').append(_.map(this.columns,this._renderHeaderCell.bind(this)));if(this.hasSelectors){$tr.prepend(this._renderSelector('th'));}
return $('<thead>').append($tr);},_renderHeaderCell:function(node){var name=node.attrs.name;var order=this.state.orderedBy;var isNodeSorted=order[0]&&order[0].name===name;var field=this.state.fields[name];var $th=$('<th>');if(!field){return $th;}
var description;if(node.attrs.widget){description=this.state.fieldsInfo.list[name].Widget.prototype.description;}
if(description===undefined){description=node.attrs.string||field.string;}
$th.text(description).data('name',name).toggleClass('o-sort-down',isNodeSorted?!order[0].asc:false).toggleClass('o-sort-up',isNodeSorted?order[0].asc:false).addClass(field.sortable&&'o_column_sortable');if(isNodeSorted){$th.attr('aria-sort',order[0].asc?'ascending':'descending');}
if(field.type==='float'||field.type==='integer'||field.type==='monetary'){$th.addClass('o_list_number_th');}
if(config.debug){var fieldDescr={field:field,name:name,string:description||name,record:this.state,attrs:node.attrs,};this._addFieldTooltip(fieldDescr,$th);}
return $th;},_renderRow:function(record){var self=this;this.defs=[];var $cells=_.map(this.columns,function(node,index){return self._renderBodyCell(record,node,index,{mode:'readonly'});});delete this.defs;var $tr=$('<tr/>',{class:'o_data_row'}).data('id',record.id).append($cells);if(this.hasSelectors){$tr.prepend(this._renderSelector('td',!record.res_id));}
this._setDecorationClasses(record,$tr);return $tr;},_renderRows:function(){return _.map(this.state.data,this._renderRow.bind(this));},_renderSelector:function(tag,disableInput){var $content=dom.renderCheckbox();if(disableInput){$content.find("input[type='checkbox']").prop('disabled',disableInput);}
return $('<'+tag+' width="1">').addClass('o_list_record_selector').append($content);},_renderView:function(){var self=this;this.$el.removeClass('table-responsive').empty();_.invoke(this.pagers,'destroy');this.pagers=[];var displayNoContentHelper=!this._hasContent()&&!!this.noContentHelp;if(displayNoContentHelper){this.$el.html(this._renderNoContentHelper());return this._super();}
var $table=$('<table>').addClass('o_list_view table table-sm table-hover table-striped');this.$el.addClass('table-responsive').append($table);this._computeAggregates();$table.toggleClass('o_list_view_grouped',this.isGrouped);$table.toggleClass('o_list_view_ungrouped',!this.isGrouped);this.hasHandle=this.state.orderedBy.length===0||this.state.orderedBy[0].name===this.handleField;if(this.isGrouped){$table.append(this._renderHeader(true)).append(this._renderGroups(this.state.data)).append(this._renderFooter());}else{$table.append(this._renderHeader()).append(this._renderBody()).append(this._renderFooter());}
if(this.selection.length){var $checked_rows=this.$('tr').filter(function(index,el){return _.contains(self.selection,$(el).data('id'));});$checked_rows.find('.o_list_record_selector input').prop('checked',true);}
return this._super();},_setDecorationClasses:function(record,$tr){_.each(this.rowDecorations,function(expr,decoration){var cssClass=decoration.replace('decoration','text');$tr.toggleClass(cssClass,py.PY_isTrue(py.evaluate(expr,record.evalContext)));});},_updateFooter:function(){this._computeAggregates();this.$('tfoot').replaceWith(this._renderFooter());},_updateSelection:function(){var $selectedRows=this.$('tbody .o_list_record_selector input:checked').closest('tr');this.selection=_.map($selectedRows,function(row){return $(row).data('id');});this.trigger_up('selection_changed',{selection:this.selection});this._updateFooter();},_onKeyDown:function(e){if(!this.editable){switch(e.which){case $.ui.keyCode.DOWN:$(e.currentTarget).next().find('input').focus();e.preventDefault();break;case $.ui.keyCode.UP:$(e.currentTarget).prev().find('input').focus();e.preventDefault();break;case $.ui.keyCode.ENTER:e.preventDefault();var id=$(e.currentTarget).data('id');if(id){this.trigger_up('open_record',{id:id,target:e.target});}
break;}}},_onRowClicked:function(event){if(!$(event.target).prop('special_click')){var id=$(event.currentTarget).data('id');if(id){this.trigger_up('open_record',{id:id,target:event.target});}}},_onSelectRecord:function(event){event.stopPropagation();this._updateSelection();if(!$(event.currentTarget).find('input').prop('checked')){this.$('thead .o_list_record_selector input').prop('checked',false);}},_onSortColumn:function(event){var name=$(event.currentTarget).data('name');this.trigger_up('toggle_column_order',{id:this.state.id,name:name});},_onToggleGroup:function(event){var group=$(event.currentTarget).data('group');if(group.count){this.trigger_up('toggle_group',{group:group});}},_onToggleSelection:function(event){var checked=$(event.currentTarget).prop('checked')||false;this.$('tbody .o_list_record_selector input:not(":disabled")').prop('checked',checked);this._updateSelection();},});return ListRenderer;});;

/* /web/static/src/js/views/list/list_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.ListView',function(require){"use strict";var BasicView=require('web.BasicView');var core=require('web.core');var ListRenderer=require('web.ListRenderer');var ListController=require('web.ListController');var _lt=core._lt;var ListView=BasicView.extend({accesskey:"l",display_name:_lt('List'),icon:'fa-list-ul',config:_.extend({},BasicView.prototype.config,{Renderer:ListRenderer,Controller:ListController,}),viewType:'list',init:function(viewInfo,params){this._super.apply(this,arguments);var selectedRecords=[];var mode=this.arch.attrs.editable&&!params.readonly?"edit":"readonly";this.controllerParams.editable=this.arch.attrs.editable;this.controllerParams.hasSidebar=params.hasSidebar;this.controllerParams.toolbarActions=viewInfo.toolbar;this.controllerParams.noLeaf=!!this.loadParams.context.group_by_no_leaf;this.controllerParams.mode=mode;this.controllerParams.selectedRecords=selectedRecords;this.rendererParams.arch=this.arch;this.rendererParams.hasSelectors='hasSelectors'in params?params.hasSelectors:true;this.rendererParams.editable=params.readonly?false:this.arch.attrs.editable;this.rendererParams.selectedRecords=selectedRecords;this.loadParams.limit=this.loadParams.limit||80;this.loadParams.type='list';},});return ListView;});;

/* /web/static/src/js/views/list/list_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.ListController',function(require){"use strict";var core=require('web.core');var BasicController=require('web.BasicController');var DataExport=require('web.DataExport');var Dialog=require('web.Dialog');var pyUtils=require('web.py_utils');var Sidebar=require('web.Sidebar');var _t=core._t;var qweb=core.qweb;var ListController=BasicController.extend({custom_events:_.extend({},BasicController.prototype.custom_events,{add_record:'_onAddRecord',button_clicked:'_onButtonClicked',edit_line:'_onEditLine',save_line:'_onSaveLine',resequence:'_onResequence',selection_changed:'_onSelectionChanged',toggle_column_order:'_onToggleColumnOrder',toggle_group:'_onToggleGroup',navigation_move:'_onNavigationMove',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.hasSidebar=params.hasSidebar;this.toolbarActions=params.toolbarActions||{};this.editable=params.editable;this.noLeaf=params.noLeaf;this.selectedRecords=params.selectedRecords||[];},getActiveDomain:function(){var self=this;if(this.$('thead .o_list_record_selector input').prop('checked')){var searchData=this.searchView.build_search_data();var userContext=this.getSession().user_context;var results=pyUtils.eval_domains_and_contexts({domains:searchData.domains,contexts:[userContext].concat(searchData.contexts),group_by_seq:searchData.groupbys||[]});var record=self.model.get(self.handle,{raw:true});return $.when(record.getDomain().concat(results.domain||[]));}else{return $.Deferred().resolve();}},getContext:function(){var context=this._super.apply(this,arguments);context.orderedBy=this.model.get(this.handle,{raw:true}).orderedBy||[];return context;},getSelectedIds:function(){return _.map(this.getSelectedRecords(),function(record){return record.res_id;});},getSelectedRecords:function(){var self=this;return _.map(this.selectedRecords,function(db_id){return self.model.get(db_id,{raw:true});});},buttons_template:'ListView.buttons',renderButtons:function($node){if(!this.noLeaf&&this.hasButtons){this.$buttons=$(qweb.render(this.buttons_template,{widget:this}));this.$buttons.on('click','.o_list_button_add',this._onCreateRecord.bind(this));this._assignCreateKeyboardBehavior(this.$buttons.find('.o_list_button_add'));this.$buttons.find('.o_list_button_add').tooltip({delay:{show:200,hide:0},title:function(){return qweb.render('CreateButton.tooltip');},trigger:'manual',});this.$buttons.on('click','.o_list_button_discard',this._onDiscard.bind(this));this.$buttons.appendTo($node);}},renderSidebar:function($node){var self=this;if(this.hasSidebar){var other=[{label:_t("Export"),callback:this._onExportData.bind(this)}];if(this.archiveEnabled){other.push({label:_t("Archive"),callback:function(){Dialog.confirm(self,_t("Are you sure that you want to archive all the selected records?"),{confirm_callback:self._onToggleArchiveState.bind(self,true),});}});other.push({label:_t("Unarchive"),callback:this._onToggleArchiveState.bind(this,false)});}
if(this.is_action_enabled('delete')){other.push({label:_t('Delete'),callback:this._onDeleteSelectedRecords.bind(this)});}
this.sidebar=new Sidebar(this,{editable:this.is_action_enabled('edit'),env:{context:this.model.get(this.handle,{raw:true}).getContext(),activeIds:this.getSelectedIds(),model:this.modelName,},actions:_.extend(this.toolbarActions,{other:other}),});this.sidebar.appendTo($node);this._toggleSidebar();}},update:function(params,options){var self=this;if(options&&options.keepSelection){var res_ids=this.model.get(this.handle).res_ids;this.selectedRecords=_.filter(this.selectedRecords,function(id){return _.contains(res_ids,self.model.get(id).res_id);});}else{this.selectedRecords=[];}
params.selectedRecords=this.selectedRecords;return this._super.apply(this,arguments);},_abandonRecord:function(recordID){this._super.apply(this,arguments);if((recordID||this.handle)!==this.handle){var state=this.model.get(this.handle);this.renderer.removeLine(state,recordID);this._updatePager();}},_addRecord:function(){var self=this;this._disableButtons();return this.renderer.unselectRow().then(function(){return self.model.addDefaultRecord(self.handle,{position:self.editable,});}).then(function(recordID){var state=self.model.get(self.handle);self.renderer.updateState(state,{});self.renderer.editRecord(recordID);self._updatePager();}).always(this._enableButtons.bind(this));},_archive:function(ids,archive){if(ids.length===0){return $.when();}
return this.model.toggleActive(ids,!archive,this.handle).then(this.update.bind(this,{},{reload:false}));},_assignCreateKeyboardBehavior:function($createButton){var self=this;$createButton.on('keydown',function(e){$createButton.tooltip('hide');switch(e.which){case $.ui.keyCode.ENTER:e.preventDefault();self._onCreateRecord.apply(self);break;case $.ui.keyCode.DOWN:e.preventDefault();self.renderer.giveFocus();break;case $.ui.keyCode.TAB:if(!e.shiftKey&&e.target.classList.contains("btn-primary")){e.preventDefault();$createButton.tooltip('show');}
break;}});},_confirmSave:function(id){var state=this.model.get(this.handle);return this.renderer.updateState(state,{noRender:true}).then(this._setMode.bind(this,'readonly',id));},_discardChanges:function(recordID){if((recordID||this.handle)===this.handle){recordID=this.renderer.getEditableRecordID();if(recordID===null){return $.when();}}
var self=this;return this._super(recordID).then(function(){self._updateButtons('readonly');});},_getSidebarEnv:function(){var env=this._super.apply(this,arguments);var record=this.model.get(this.handle);return _.extend(env,{domain:record.getDomain()});},_setMode:function(mode,recordID){if((recordID||this.handle)!==this.handle){this._updateButtons(mode);return this.renderer.setRowMode(recordID,mode);}else{return this._super.apply(this,arguments);}},_toggleSidebar:function(){if(this.sidebar){this.sidebar.do_toggle(this.selectedRecords.length>0);}},_update:function(){return this._super.apply(this,arguments).then(this._toggleSidebar.bind(this)).then(this._updateButtons.bind(this,'readonly'));},_updateButtons:function(mode){if(this.$buttons){this.$buttons.toggleClass('o-editing',mode==='edit');}},_onAddRecord:function(event){event.stopPropagation();if(this.activeActions.create){this._addRecord();}else if(event.data.onFail){event.data.onFail();}},_onButtonClicked:function(event){event.stopPropagation();this._callButtonAction(event.data.attrs,event.data.record);},_onCreateRecord:function(event){if(event){event.stopPropagation();}
var state=this.model.get(this.handle,{raw:true});if(this.editable&&!state.groupedBy.length){this._addRecord();}else{this.trigger_up('switch_view',{view_type:'form',res_id:undefined});}},_onDeleteSelectedRecords:function(){this._deleteRecords(this.selectedRecords);},_onDiscard:function(ev){ev.stopPropagation();this._discardChanges();},_onEditLine:function(ev){var self=this;ev.stopPropagation();this.trigger_up('mutexify',{action:function(){var record=self.model.get(self.handle);var editedRecord=record.data[ev.data.index];self._setMode('edit',editedRecord.id).done(ev.data.onSuccess);},});},_onExportData:function(){var record=this.model.get(this.handle);var defaultExportFields=_.map(this.renderer.columns,function(field){return field.attrs.name;});new DataExport(this,record,defaultExportFields).open();},_onSaveLine:function(ev){var recordID=ev.data.recordID;this.saveRecord(recordID).done(ev.data.onSuccess).fail(ev.data.onFailure);},_onResequence:function(event){var self=this;this.trigger_up('mutexify',{action:function(){var state=self.model.get(self.handle);var resIDs=_.map(event.data.rowIDs,function(rowID){return _.findWhere(state.data,{id:rowID}).res_id;});var options={offset:event.data.offset,field:event.data.handleField,};return self.model.resequence(self.modelName,resIDs,self.handle,options).then(function(){self._updateEnv();state=self.model.get(self.handle);return self.renderer.updateState(state,{noRender:true});});},});},_onSelectionChanged:function(event){this.selectedRecords=event.data.selection;this._toggleSidebar();},_onSidebarDataAsked:function(event){var env=this._getSidebarEnv();event.data.callback(env);},_onToggleArchiveState:function(archive){this._archive(this.selectedRecords,archive);},_onToggleColumnOrder:function(event){event.stopPropagation();var data=this.model.get(this.handle);if(!data.groupedBy){this.pager.updateState({current_min:1});}
var self=this;this.model.setSort(data.id,event.data.name).then(function(){self.update({});});},_onToggleGroup:function(event){event.stopPropagation();this.model.toggleGroup(event.data.group.id).then(this.update.bind(this,{},{keepSelection:true,reload:false}));},});return ListController;});;

/* /web/static/src/js/views/pivot/pivot_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.PivotModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var concurrency=require('web.concurrency');var dataComparisonUtils=require('web.dataComparisonUtils');var core=require('web.core');var session=require('web.session');var utils=require('web.utils');var computeVariation=dataComparisonUtils.computeVariation;var _t=core._t;var PivotModel=AbstractModel.extend({init:function(){this._super.apply(this,arguments);this.numbering={};this.data=null;this._loadDataDropPrevious=new concurrency.DropPrevious();},closeHeader:function(headerID){var header=this.data.headers[headerID];header.expanded=false;header.children=[];var newGroupbyLength=this._getHeaderDepth(header.root)-1;header.root.groupbys.splice(newGroupbyLength);},expandAll:function(){return this._loadData();},expandHeader:function(header,field){var self=this;var other_root=header.root.other_root;var other_groupbys=header.root.other_root.groupbys;var measures=_.map(this.data.measures,function(measure){var type=self.fields[measure].type;return(type==='many2one')?measure+":count_distinct":measure;});var groupBys=[];for(var i=0;i<=other_groupbys.length;i++){groupBys.push([field].concat(other_groupbys.slice(0,i)));}
var defs=[];if((typeof header.count==='object'&&header.count.data)||(typeof header.count==='number'&&header.count)){defs=defs.concat(groupBys.map(function(groupBy){return self._rpc({model:self.modelName,method:'read_group',context:self.data.context,domain:header.domain||self.data.domain.concat(self.data.timeRange),fields:measures,groupBy:groupBy,lazy:false,}).then(function(result){return['data',result];});}));}
if(header.comparisonCount&&this.data.compare){defs=defs.concat(groupBys.map(function(groupBy){return self._rpc({model:self.modelName,method:'read_group',context:self.data.context,domain:header.comparisonDomain||self.data.domain.concat(self.data.comparisonTimeRange),fields:measures,groupBy:groupBy,lazy:false,}).then(function(result){return['comparisonData',result];});}));}
return $.when.apply(null,defs).then(function(){var results=Array.prototype.slice.call(arguments);var data=[];var comparisonData=[];_.each(results,function(result){if(result[0]==='data'){data.push(result[1]);}else{comparisonData.push(result[1]);}});var allData=self._mergeData(data,comparisonData,groupBys);var dataPoint,attrs,j,l,row,col,cell_value;for(i=0;i<allData.length;i++){for(j=0;j<allData[i].length;j++){dataPoint=allData[i][j];groupBys=[field].concat(other_groupbys.slice(0,i));attrs={value:self._getValue(dataPoint,groupBys),domain:dataPoint.__domain,comparisonDomain:dataPoint.__comparisonDomain,length:dataPoint.__count.data?dataPoint.__count.data:dataPoint.__count,comparisonLength:dataPoint.__comparisonCount||0,};if(i===0){row=self._makeHeader(attrs.value,attrs.domain,attrs.comparisonDomain,attrs.length,attrs.comparisonLength,header.root,0,1,header);}else{row=self._getHeader(attrs.value,header.root,0,1,header);}
col=self._getHeader(attrs.value,other_root,1,i+1);if(!col){continue;}
for(cell_value={},l=0;l<self.data.measures.length;l++){var _value=dataPoint[self.data.measures[l]];if(_value instanceof Array){if(self.data.compare){_value=dataPoint[self.data.measures[l]+'Aggregate'];}else{_value=1;}}
cell_value[self.data.measures[l]]=_value;}
if(!self.data.cells[row.id]){self.data.cells[row.id]=[];}
self.data.cells[row.id][col.id]=cell_value;}}
if(!_.contains(header.root.groupbys,field)){header.root.groupbys.push(field);}});},exportData:function(){var self=this;var measureNbr=this.data.measures.length;var headers=this._computeHeaders();if(this.data.compare){_.each(headers,function(headerGroup){_.each(headerGroup,function(header){header.width=header.width?3*header.width:3;});});}
var measureRow=measureNbr>=1?_.last(headers):[];var rows=this._computeRows();var i,j,value,values,is_bold,additionalHeaders=[];headers[0].splice(0,1);function isBold(i,j){return(i===0)||((self.data.main_col.width>1)&&(j>=rows[i].values.length-measureNbr));}
function makeValue(value,is_bold){return{is_bold:is_bold,value:(value===undefined)?"":value,};}
function makeMeasure(name){return{is_bold:false,measure:name};}
additionalHeaders=[];for(i=0;i<measureRow.length;i++){if(this.data.compare){measureRow[i].title=this.fields[measureRow[i].measure].string;measureRow[i].height=1;measureRow[i].expanded=true;additionalHeaders=additionalHeaders.concat(_.map([this.data.timeRangeDescription.toString(),this.data.comparisonTimeRangeDescription.toString(),_t('Variation')],makeMeasure));}else{measureRow[i].measure=this.fields[measureRow[i].measure].string;}}
if(this.data.compare){for(i=0,j,value;i<rows.length;i++){values=[];for(j=0;j<rows[i].values.length;j++){value=rows[i].values[j];is_bold=isBold(i,j);if(value instanceof Object){for(var origin in value){if(origin==='variation'){values.push(makeValue(value[origin].magnitude*100,is_bold));}else{values.push(makeValue(value[origin],is_bold));}}}else{for(var l=0;l<3;l++){values.push(makeValue(undefined,isBold(i,j)));}}}
rows[i].values=values;}
headers.push(additionalHeaders);return{headers:_.initial(headers),measure_row:additionalHeaders,rows:rows,nbr_measures:3*measureNbr,};}else{for(i=0,j,value;i<rows.length;i++){for(j=0;j<rows[i].values.length;j++){rows[i].values[j]=makeValue(rows[i].values[j],isBold(i,j));}}
return{headers:_.initial(headers),measure_row:measureRow,rows:rows,nbr_measures:measureNbr,};}},flip:function(){var temp=this.data.main_col;this.data.main_col=this.data.main_row;this.data.main_row=temp;temp=this.data.groupedBy;this.data.groupedBy=this.data.colGroupBys;this.data.colGroupBys=temp;},get:function(options){var isRaw=options&&options.raw;if(!this.data.has_data){return{has_data:false,colGroupBys:this.data.main_col.root.groupbys,rowGroupBys:this.data.main_row.root.groupbys,measures:this.data.measures,};}
return{colGroupBys:this.data.main_col.root.groupbys,context:this.data.context,domain:this.data.domain,compare:this.data.compare,fields:this.fields,headers:!isRaw&&this._computeHeaders(),has_data:true,mainColWidth:this.data.main_col.width,measures:this.data.measures,rows:!isRaw&&this._computeRows(),rowGroupBys:this.data.main_row.root.groupbys,sortedColumn:this.data.sorted_column,};},getHeader:function(id){return this.data.headers[id];},load:function(params){var self=this;this.initialDomain=params.domain;this.initialRowGroupBys=params.context.pivot_row_groupby||params.rowGroupBys;this.fields=params.fields;this.modelName=params.modelName;this.data={domain:this.initialDomain,timeRange:params.timeRange||[],timeRangeDescription:params.timeRangeDescription||"",comparisonTimeRange:params.comparisonTimeRange||[],comparisonTimeRangeDescription:params.comparisonTimeRangeDescription||"",compare:params.compare||false,context:_.extend({},session.user_context,params.context),groupedBy:params.groupedBy,colGroupBys:params.context.pivot_column_groupby||params.colGroupBys,measures:this._processMeasures(params.context.pivot_measures)||params.measures,sorted_column:{},};this.variationData={};this.defaultGroupedBy=params.groupedBy;return this._loadData().then(function(){if(params.default_order){var info=params.default_order.split(' ');self.sortRows(self.data.main_col.root.id,info[0],info[1]==='desc');}});},reload:function(handle,params){var self=this;if('context'in params){this.data.context=params.context;this.data.colGroupBys=params.context.pivot_column_groupby||this.data.colGroupBys;this.data.groupedBy=params.context.pivot_row_groupby||this.data.groupedBy;this.data.measures=this._processMeasures(params.context.pivot_measures)||this.data.measures;this.defaultGroupedBy=this.data.groupedBy.length?this.data.groupedBy:this.defaultGroupedBy;var timeRangeMenuData=params.context.timeRangeMenuData;if(timeRangeMenuData){this.data.timeRange=timeRangeMenuData.timeRange||[];this.data.timeRangeDescription=timeRangeMenuData.timeRangeDescription||"";this.data.comparisonTimeRange=timeRangeMenuData.comparisonTimeRange||[];this.data.comparisonTimeRangeDescription=timeRangeMenuData.comparisonTimeRangeDescription||"";this.data.compare=this.data.comparisonTimeRange.length>0;}else{this.data.timeRange=[];this.data.timeRangeDescription="";this.data.comparisonTimeRange=[];this.data.comparisonTimeRangeDescription="";this.data.compare=false;this.data.context=_.omit(this.data.context,'timeRangeMenuData');}}
if('domain'in params){this.data.domain=params.domain;}else{this.data.domain=this.initialDomain;}
if('groupBy'in params){this.data.groupedBy=params.groupBy.length?params.groupBy:this.defaultGroupedBy;}
if(!this.data.has_data){return this._loadData();}
var old_row=this.data.main_row;var old_col=this.data.main_col;return this._loadData().then(function(){if(!('groupBy'in params)&&!('pivot_row_groupby'in(params.context||{}))){self._updateTree(old_row.root,self.data.main_row.root);}
if(!('pivot_column_groupby'in(params.context||{}))){self._updateTree(old_col.root,self.data.main_col.root);}});},sortRows:function(col_id,measure,descending,dataType){var cells=this.data.cells;var comparisonFunction=compare;if(this.data.compare){dataType=dataType||'data';comparisonFunction=specialCompare;}
this._traverseTree(this.data.main_row.root,function(header){header.children.sort(comparisonFunction);});this.data.sorted_column={id:col_id,measure:measure,order:descending?'desc':'asc',dataType:dataType,};function _getValue(id1,id2){if((id1 in cells)&&(id2 in cells[id1])){return cells[id1][id2];}
if(id2 in cells)return cells[id2][id1];}
function compare(row1,row2){var values1=_getValue(row1.id,col_id);var values2=_getValue(row2.id,col_id);var value1=values1?values1[measure]:0;var value2=values2?values2[measure]:0;return descending?value1-value2:value2-value1;}
function specialCompare(row1,row2){var values1=_getValue(row1.id,col_id);var values2=_getValue(row2.id,col_id);var value1=values1?values1[measure]:{data:0,comparisonData:0,variation:{magnitude:0}};var value2=values2?values2[measure]:{data:0,comparisonData:0,variation:{magnitude:0}};if(dataType==='variation'){return descending?value1[dataType].magnitude-value2[dataType].magnitude:value2[dataType].magnitude-value1[dataType].magnitude;}
return descending?value1[dataType]-value2[dataType]:value2[dataType]-value1[dataType];}},toggleMeasure:function(field){if(_.contains(this.data.measures,field)){this.data.measures=_.without(this.data.measures,field);return $.when();}else{this.data.measures.push(field);}
return this._loadData();},_computeHeaders:function(){var self=this;var main_col_dims=this._getHeaderDim(this.data.main_col.root);var depth=main_col_dims.depth;var width=main_col_dims.width;var nbr_measures=this.data.measures.length;var result=[[{width:1,height:depth+1}]];var col_ids=[];this.data.main_col.width=width;this._traverseTree(this.data.main_col.root,function(header){var index=header.path.length-1;var cell={width:self._getHeaderWidth(header)*nbr_measures,height:header.expanded?1:depth-index,title:header.path[header.path.length-1],id:header.id,expanded:header.expanded,};if(!header.expanded)col_ids.push(header.id);if(result[index])result[index].push(cell);else result[index]=[cell];});col_ids.push(this.data.main_col.root.id);this.data.main_col.width=width;if(width>1){var total_cell={width:nbr_measures,height:depth,title:""};if(nbr_measures===1){total_cell.total=true;}
result[0].push(total_cell);}
var nbr_cols=width===1?nbr_measures:(width+1)*nbr_measures;for(var i=0,measure_row=[],measure;i<nbr_cols;i++){measure=this.data.measures[i%nbr_measures];measure_row.push({measure:measure,is_bold:(width>1)&&(i>=nbr_measures*width),id:col_ids[Math.floor(i/nbr_measures)],});}
result.push(measure_row);return result;},_computeRows:function(){var self=this;var aggregates,i;var result=[];this._traverseTree(this.data.main_row.root,function(header){var values=[],col_ids=[];result.push({id:header.id,col_ids:col_ids,indent:header.path.length-1,title:header.path[header.path.length-1],expanded:header.expanded,values:values,});self._traverseTree(self.data.main_col.root,add_cells,header.id,values,col_ids);if(self.data.main_col.width>1){aggregates=self._getCellValue(header.id,self.data.main_col.root.id);for(i=0;i<self.data.measures.length;i++){values.push(aggregates&&aggregates[self.data.measures[i]]);}
col_ids.push(self.data.main_col.root.id);}});return result;function add_cells(col_hdr,row_id,values,col_ids){if(col_hdr.expanded)return;col_ids.push(col_hdr.id);aggregates=self._getCellValue(row_id,col_hdr.id);for(i=0;i<self.data.measures.length;i++){values.push(aggregates&&aggregates[self.data.measures[i]]);}}},_findPathInTree:function(root,path){var i,l=root.path.length;if(l===path.length){return(root.path[l-1]===path[l-1])?root:null;}
for(i=0;i<root.children.length;i++){if(root.children[i].path[l]===path[l]){return this._findPathInTree(root.children[i],path);}}
return null;},_getCellValue:function(id1,id2){if((id1 in this.data.cells)&&(id2 in this.data.cells[id1])){return this.data.cells[id1][id2];}
if(id2 in this.data.cells)return this.data.cells[id2][id1];},_getHeader:function(value,root,i,j,parent){var path;var total=_t("Total");if(parent){path=parent.path.concat(value.slice(i,j));}else{path=[total].concat(value.slice(i,j));}
return this._findPathInTree(root,path);},_getHeaderDepth:function(header){var depth=1;this._traverseTree(header,function(hdr){depth=Math.max(depth,hdr.path.length);});return depth;},_getHeaderDim:function(header){var depth=1;var width=0;this._traverseTree(header,function(hdr){depth=Math.max(depth,hdr.path.length);if(!hdr.expanded)width++;});return{width:width,depth:depth};},_getHeaderWidth:function(header){var self=this;if(!header.children.length)return 1;if(!header.expanded)return 1;return header.children.reduce(function(s,c){return s+self._getHeaderWidth(c);},0);},_getNumberedValue:function(value,field){var id=value[0];var name=value[1];this.numbering[field]=this.numbering[field]||{};this.numbering[field][name]=this.numbering[field][name]||{};var numbers=this.numbering[field][name];numbers[id]=numbers[id]||_.size(numbers)+1;return name+(numbers[id]>1?"  ("+numbers[id]+")":"");},_getValue:function(dataPoint,fields){var result=[];var value;for(var i=0;i<fields.length;i++){value=this._sanitizeValue(dataPoint[fields[i]],fields[i]);result.push(value);}
return result;},_loadData:function(){var self=this;var groupBys=[];var rowGroupBys=!_.isEmpty(this.data.groupedBy)?this.data.groupedBy:this.initialRowGroupBys;var colGroupBys=this.data.colGroupBys;var measures=_.map(this.data.measures,function(measure){if(self.fields[measure].type==='many2one'){return measure+":count_distinct";}
else{return measure;}});for(var i=0;i<rowGroupBys.length+1;i++){for(var j=0;j<colGroupBys.length+1;j++){groupBys.push(rowGroupBys.slice(0,i).concat(colGroupBys.slice(0,j)));}}
var defs=groupBys.map(function(groupBy){return self._rpc({model:self.modelName,method:'read_group',context:self.data.context,domain:self.data.domain.concat(self.data.timeRange),fields:measures,groupBy:groupBy,lazy:false,}).then(function(result){return['data',result];});});if(this.data.compare){defs=defs.concat(groupBys.map(function(groupBy){return self._rpc({model:self.modelName,method:'read_group',context:self.data.context,domain:self.data.domain.concat(self.data.comparisonTimeRange),fields:measures,groupBy:groupBy,lazy:false,}).then(function(result){return['comparisonData',result];});}));}
return this._loadDataDropPrevious.add($.when.apply(null,defs)).then(function(){var results=Array.prototype.slice.call(arguments);var data=[];var comparisonData=[];_.each(results,function(result){if(result[0]==='data'){data.push(result[1]);}else{comparisonData.push(result[1]);}});var allData=self._mergeData(data,comparisonData,groupBys);if(allData[0][0].__count===0&&allData[0][0].__comparisonCount===0){self.data.has_data=false;}
self._prepareData(allData);});},_makeHeader:function(value,domain,comparisonDomain,count,comparisonCount,root,i,j,parent_header){var total=_t("Total");var title=value.length?value[value.length-1]:total;var path,parent;if(parent_header){path=parent_header.path.concat(title);parent=parent_header;}else{path=[total].concat(value.slice(i,j-1));parent=value.length?this._findPathInTree(root,path):null;}
var header={id:utils.generateID(),expanded:false,domain:domain,comparisonDomain:comparisonDomain,count:count,comparisonCount:comparisonCount,children:[],path:value.length?parent.path.concat(title):[title]};this.data.headers[header.id]=header;header.root=root||header;if(parent){parent.children.push(header);parent.expanded=true;}
return header;},_mergeData:function(data,comparisonData,groupBys){if(!this.data.compare){return data;}
var allData=[];var dataPoints;var value,groupIdentifier,dataPoint,m,measureName,measureValue,measureComparisonValue;for(var index=0;index<groupBys.length;index++){dataPoints={};if(data.length){for(var k=0;k<data[index].length;k++){dataPoint=data[index][k];if(_.isEmpty(dataPoint)){break;}
value=this._getValue(dataPoint,groupBys[index]);groupIdentifier=value.join();for(m=0;m<this.data.measures.length;m++){measureName=this.data.measures[m];measureValue=dataPoint[measureName];if(typeof measureValue==='boolean'){measureValue=measureValue?1:0;}
if(measureValue===null){measureValue=0;}
if(!(measureValue instanceof Array)&&measureName!=='__count'){dataPoint[measureName]={data:measureValue,comparisonData:0,variation:computeVariation(measureValue,0),};}
if(measureValue instanceof Array){dataPoint[measureName+'Aggregate']={data:1,comparisonData:0,variation:computeVariation(1,0),};}}
dataPoint.__count={data:dataPoint.__count,comparisonData:0,variation:computeVariation(dataPoint.__count,0)};dataPoint.__comparisonDomain=[[0,'=',1]];dataPoints[groupIdentifier]=dataPoint;}}
if(comparisonData.length){for(var l=0;l<comparisonData[index].length;l++){dataPoint=comparisonData[index][l];if(_.isEmpty(dataPoint)){break;}
value=this._getValue(dataPoint,groupBys[index]);groupIdentifier=value.join();if(!dataPoints[groupIdentifier]){for(m=0;m<this.data.measures.length;m++){measureName=this.data.measures[m];measureComparisonValue=dataPoint[measureName];if(typeof(measureComparisonValue)==='boolean'){measureComparisonValue=measureComparisonValue?1:0;}
if(measureComparisonValue===null){measureComparisonValue=0;}
if(!(measureComparisonValue instanceof Array)&&measureName!=='__count'){dataPoint[measureName]={data:0,comparisonData:measureComparisonValue,variation:computeVariation(0,measureComparisonValue),};}
if(measureComparisonValue instanceof Array){dataPoint[measureName+'Aggregate']={data:0,comparisonData:1,variation:computeVariation(0,1),};}}
dataPoint.__count={data:0,comparisonData:dataPoint.__count,variation:computeVariation(0,dataPoint.__count)};dataPoint.__comparisonCount=dataPoint.__count;dataPoint.__comparisonDomain=dataPoint.__domain;dataPoint.__domain=[[0,'=',1]];dataPoints[groupIdentifier]=dataPoint;}else{for(m=0;m<this.data.measures.length;m++){measureName=this.data.measures[m];measureComparisonValue=dataPoint[measureName];if(typeof(measureComparisonValue)==='boolean'){measureComparisonValue=measureComparisonValue?1:0;}
if(measureComparisonValue===null){measureComparisonValue=0;}
if(!(measureComparisonValue instanceof Array)&&measureName!=='__count'){dataPoints[groupIdentifier][measureName].comparisonData=measureComparisonValue;dataPoints[groupIdentifier][measureName].variation=computeVariation(dataPoints[groupIdentifier][measureName].data,measureComparisonValue);}
if(measureComparisonValue instanceof Array){dataPoints[groupIdentifier][measureName+'Aggregate'].comparisonData=1;dataPoints[groupIdentifier][measureName+'Aggregate'].variation=computeVariation(dataPoints[groupIdentifier][measureName+'Aggregate'].data,1);}}
dataPoints[groupIdentifier].__count.comparisonData=dataPoint.__count;dataPoints[groupIdentifier].__count.variation=computeVariation(dataPoints[groupIdentifier].__count.data,dataPoint.__count);dataPoints[groupIdentifier].__comparisonCount=dataPoint.__count;dataPoints[groupIdentifier].__comparisonDomain=dataPoint.__domain;}}}
allData.push(_.values(dataPoints));}
return allData;},_prepareData:function(data){var self=this;_.extend(this.data,{main_row:{},main_col:{},headers:{},cells:[],});var index=0;var rowGroupBys=!_.isEmpty(this.data.groupedBy)?this.data.groupedBy:this.initialRowGroupBys.slice();this.data.groupedBy=rowGroupBys;var colGroupBys=this.data.colGroupBys;var dataPoint,row,col,attrs,cell_value;var main_row_header,main_col_header;var groupBys;var m;for(var i=0;i<rowGroupBys.length+1;i++){for(var j=0;j<colGroupBys.length+1;j++){for(var k=0;k<data[index].length;k++){dataPoint=data[index][k];groupBys=rowGroupBys.slice(0,i).concat(colGroupBys.slice(0,j));attrs={value:self._getValue(dataPoint,groupBys),domain:dataPoint.__domain,comparisonDomain:dataPoint.__comparisonDomain,};if(dataPoint.__count){attrs.length=dataPoint.__count instanceof Object?dataPoint.__count.data:dataPoint.__count;attrs.comparisonLength=dataPoint.__comparisonCount;}
if(j===0){row=this._makeHeader(attrs.value,attrs.domain,attrs.comparisonDomain,attrs.length,attrs.comparisonLength,main_row_header,0,i);}else{row=this._getHeader(attrs.value,main_row_header,0,i);}
if(i===0){col=this._makeHeader(attrs.value,attrs.domain,attrs.comparisonDomain,attrs.length,attrs.comparisonLength,main_col_header,i,i+j);}else{col=this._getHeader(attrs.value,main_col_header,i,i+j);}
if(i+j===0){this.data.has_data=attrs.length>0||attrs.comparisonLength>0;row.domain=col.domain=this.data.domain.concat(this.data.timeRange);row.comparisonDomain=col.comparisonDomain=this.data.domain.concat(this.data.comparisonTimeRange);main_row_header=row;main_col_header=col;}
if(!this.data.cells[row.id])this.data.cells[row.id]=[];for(cell_value={},m=0;m<this.data.measures.length;m++){var _value=dataPoint[this.data.measures[m]];if(_value instanceof Array){if(this.data.compare){_value=dataPoint[this.data.measures[m]+'Aggregate'];}else{_value=1;}}
cell_value[this.data.measures[m]]=_value;}
this.data.cells[row.id][col.id]=cell_value;}
index++;}}
main_row_header.other_root=main_col_header;main_col_header.other_root=main_row_header;main_row_header.groupbys=rowGroupBys;main_col_header.groupbys=colGroupBys;this.data.main_row.root=main_row_header;this.data.main_col.root=main_col_header;},_processMeasures:function(measures){if(measures){return _.map(measures,function(measure){return measure==='__count__'?'__count':measure;});}},_sanitizeValue:function(value,field){if(value===false){return _t("Undefined");}
if(value instanceof Array){return this._getNumberedValue(value,field);}
if(field&&this.fields[field]&&(this.fields[field].type==='selection')){var selected=_.where(this.fields[field].selection,{0:value})[0];return selected?selected[1]:value;}
return value;},_traverseTree:function(root,f,arg1,arg2,arg3){f(root,arg1,arg2,arg3);if(!root.expanded)return;for(var i=0;i<root.children.length;i++){this._traverseTree(root.children[i],f,arg1,arg2,arg3);}},_updateTree:function(old_tree,new_tree){if(!old_tree.expanded){new_tree.expanded=false;new_tree.children=[];return;}
var tree,j,old_title,new_title;for(var i=0;i<new_tree.children.length;i++){tree=undefined;new_title=new_tree.children[i].path[new_tree.children[i].path.length-1];for(j=0;j<old_tree.children.length;j++){old_title=old_tree.children[j].path[old_tree.children[j].path.length-1];if(old_title===new_title){tree=old_tree.children[j];break;}}
if(tree){this._updateTree(tree,new_tree.children[i]);}else{new_tree.children[i].expanded=false;new_tree.children[i].children=[];}}},});return PivotModel;});;

/* /web/static/src/js/views/pivot/pivot_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.PivotController',function(require){"use strict";var AbstractController=require('web.AbstractController');var core=require('web.core');var crash_manager=require('web.crash_manager');var framework=require('web.framework');var session=require('web.session');var _t=core._t;var QWeb=core.qweb;var PivotController=AbstractController.extend({template:'PivotView',events:{'click .o_pivot_header_cell_opened':'_onOpenHeaderClick','click .o_pivot_header_cell_closed':'_onClosedHeaderClick','click .o_pivot_field_menu a':'_onFieldMenuSelection','click td':'_onCellClick','click .o_pivot_measure_row':'_onMeasureRowClick',},init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.measures=params.measures;this.groupableFields=params.groupableFields;this.title=params.title;this.enableLinking=params.enableLinking;this.views=params.views;this.lastHeaderSelected=null;},start:function(){this.$el.toggleClass('o_enable_linking',this.enableLinking);this.$fieldSelection=this.$('.o_field_selection');core.bus.on('click',this,function(){this.$fieldSelection.empty();});return this._super();},destroy:function(){if(this.$buttons){this.$buttons.find('button').off();}
return this._super.apply(this,arguments);},getContext:function(){var state=this.model.get();return{pivot_measures:state.measures,pivot_column_groupby:state.colGroupBys,pivot_row_groupby:state.rowGroupBys,};},renderButtons:function($node){if($node){var context={measures:_.sortBy(_.pairs(_.omit(this.measures,'__count')),function(x){return x[1].string.toLowerCase();})};this.$buttons=$(QWeb.render('PivotView.buttons',context));this.$buttons.click(this._onButtonClick.bind(this));this.$buttons.find('button').tooltip();this.$buttons.appendTo($node);this._updateButtons();}},_downloadTable:function(){var table=this.model.exportData();if(table.measure_row.length+1>256){crash_manager.show_message(_t("For Excel compatibility, data cannot be exported if there are more than 256 columns.\n\nTip: try to flip axis, filter further or reduce the number of measures."));framework.unblockUI();return;}
framework.blockUI();table.title=this.title;session.get_file({url:'/web/pivot/export_xls',data:{data:JSON.stringify(table)},complete:framework.unblockUI,error:crash_manager.rpc_error.bind(crash_manager)});},_renderFieldSelection:function(top,left){var state=this.model.get({raw:true});var groupedFields=state.rowGroupBys.concat(state.colGroupBys).map(function(f){return f.split(':')[0];});var fields=_.chain(this.groupableFields).pairs().sortBy(function(f){return f[1].string;}).map(function(f){return[f[0],f[1],_.contains(groupedFields,f[0])];}).value();this.$fieldSelection.html(QWeb.render('PivotView.FieldSelection',{fields:fields}));var cssProps={top:top};cssProps[_t.database.parameters.direction==='rtl'?'right':'left']=_t.database.parameters.direction==='rtl'?this.$el.width()-left:left;this.$fieldSelection.find('.dropdown-menu').first().css(cssProps).addClass('show');},_update:function(){this._updateButtons();return this._super.apply(this,arguments);},_updateButtons:function(){if(!this.$buttons){return;}
var self=this;var state=this.model.get({raw:true});_.each(this.measures,function(measure,name){var isSelected=_.contains(state.measures,name);self.$buttons.find('.dropdown-item[data-field="'+name+'"]').toggleClass('selected',isSelected);});var noDataDisplayed=!state.has_data||!state.measures.length;this.$buttons.find('.o_pivot_flip_button').prop('disabled',noDataDisplayed);this.$buttons.find('.o_pivot_expand_button').prop('disabled',noDataDisplayed);this.$buttons.find('.o_pivot_download').prop('disabled',noDataDisplayed);},_onButtonClick:function(event){var $target=$(event.target);if($target.hasClass('o_pivot_flip_button')){this.model.flip();this.update({},{reload:false});}
if($target.hasClass('o_pivot_expand_button')){this.model.expandAll().then(this.update.bind(this,{},{reload:false}));}
if($target.parents('.o_pivot_measures_list').length||$target.hasClass('o_pivot_measures_list')){event.preventDefault();event.stopPropagation();var field=$target.data('field');if(field){this.model.toggleMeasure(field).then(this.update.bind(this,{},{reload:false}));}}
if($target.hasClass('o_pivot_download')){this._downloadTable();}},_onCellClick:function(event){var $target=$(event.currentTarget);if($target.hasClass('o_pivot_header_cell_closed')||$target.hasClass('o_pivot_header_cell_opened')||$target.hasClass('o_empty')||$target.data('type')==='variation'||!this.enableLinking){return;}
var state=this.model.get(this.handle);var colDomain,rowDomain;if($target.data('type')==='comparisonData'){colDomain=this.model.getHeader($target.data('col_id')).comparisonDomain||[];rowDomain=this.model.getHeader($target.data('id')).comparisonDomain||[];}else{colDomain=this.model.getHeader($target.data('col_id')).domain||[];rowDomain=this.model.getHeader($target.data('id')).domain||[];}
var context=_.omit(state.context,function(val,key){return key==='group_by'||_.str.startsWith(key,'search_default_');});this.do_action({type:'ir.actions.act_window',name:this.title,res_model:this.modelName,views:this.views,view_type:'list',view_mode:'list',target:'current',context:context,domain:state.domain.concat(rowDomain,colDomain),});},_onClosedHeaderClick:function(event){var $target=$(event.target);var id=$target.data('id');var header=this.model.getHeader(id);var groupbys=header.root.groupbys;if(header.path.length-1<groupbys.length){this.model.expandHeader(header,groupbys[header.path.length-1]).then(this.update.bind(this,{},{reload:false}));}else{this.lastHeaderSelected=id;var position=$target.position();var $parent=$target.offsetParent();var top=position.top+$target.height()+$parent.scrollTop();var left=position.left+event.offsetX+$parent.scrollLeft();this._renderFieldSelection(top,left);event.stopPropagation();}},_onFieldMenuSelection:function(event){event.preventDefault();var $target=$(event.target);if($target.hasClass('disabled')){event.stopPropagation();return;}
var field=$target.data('field');var interval=$target.data('interval');var header=this.model.getHeader(this.lastHeaderSelected);if(interval){field=field+':'+interval;}
this.model.expandHeader(header,field).then(this.update.bind(this,{},{reload:false}));},_onMeasureRowClick:function(event){var $target=$(event.target);var col_id=$target.data('id');var measure=$target.data('measure');var isAscending=$target.hasClass('o_pivot_measure_row_sorted_asc');var dataType=$target.data('data_type');this.model.sortRows(col_id,measure,isAscending,dataType);this.update({},{reload:false});},_onOpenHeaderClick:function(event){event.preventDefault();event.stopImmediatePropagation();var headerID=$(event.target).data('id');this.model.closeHeader(headerID);this.update({},{reload:false});},});return PivotController;});;

/* /web/static/src/js/views/pivot/pivot_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.PivotRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var core=require('web.core');var field_utils=require('web.field_utils');var QWeb=core.qweb;var _t=core._t;var PivotRenderer=AbstractRenderer.extend({tagName:'table',className:'table-hover table-sm table-bordered',events:_.extend({},AbstractRenderer.prototype.events,{'hover td':'_onTdHover',}),init:function(parent,state,params){this._super.apply(this,arguments);this.compare=state.compare;this.fieldWidgets=params.widgets||{};this.timeRangeDescription=params.timeRangeDescription;this.comparisonTimeRangeDescription=params.comparisonTimeRangeDescription;},updateState:function(state,params){if(params.context!==undefined){var timeRangeMenuData=params.context.timeRangeMenuData;if(timeRangeMenuData){this.timeRangeDescription=timeRangeMenuData.timeRangeDescription;this.comparisonTimeRangeDescription=timeRangeMenuData.comparisonTimeRangeDescription;}else{this.timeRangeDescription=undefined;this.comparisonTimeRangeDescription=undefined;}}
this.compare=state.compare;return this._super.apply(this,arguments);},_hasContent:function(){return this.state.has_data&&this.state.measures.length;},_render:function(){if(!this._hasContent()){this._replaceElement(QWeb.render('PivotView.nodata'));return this._super.apply(this,arguments);}
if(!this.$el.is('table')){this.renderElement();}
var $fragment=$(document.createDocumentFragment());var $table=$('<table>').appendTo($fragment);var $thead=$('<thead>').appendTo($table);var $tbody=$('<tbody>').appendTo($table);var nbr_measures=this.state.measures.length;var nbrCols=(this.state.mainColWidth===1)?nbr_measures:(this.state.mainColWidth+1)*nbr_measures;var i;if(this.compare){for(i=0;i<3*nbrCols+1;i++){$table.prepend($('<col>'));}}else{for(i=0;i<nbrCols+1;i++){$table.prepend($('<col>'));}}
this._renderHeaders($thead,this.state.headers,nbrCols);this._renderRows($tbody,this.state.rows);$table.find('.o_pivot_header_cell_opened,.o_pivot_header_cell_closed').tooltip();this.$el.html($table.contents());return this._super.apply(this,arguments);},_renderHeaders:function($thead,headers,nbrCols){var self=this;var i,j,cell,$row,$cell;var measure,dataType;var id,measureCellIds=[];var groupbyLabels=_.map(this.state.colGroupBys,function(gb){return self.state.fields[gb.split(':')[0]].string;});for(i=0;i<headers.length;i++){$row=$('<tr>');for(j=0;j<headers[i].length;j++){cell=headers[i][j];if(i==0&&j==0){$cell=$('<th>').text(cell.title).attr('rowspan',cell.height+1).attr('colspan',cell.width);}else{$cell=$('<th>').text(cell.title).attr('rowspan',cell.height).attr('colspan',(cell.width&&self.compare)?3*cell.width:cell.width||(self.compare&&cell.measure&&3));}
if(i>0){$cell.attr('title',groupbyLabels[i-1]);}
if(cell.expanded!==undefined){$cell.addClass(cell.expanded?'o_pivot_header_cell_opened':'o_pivot_header_cell_closed');$cell.data('id',cell.id);}
if(cell.measure){measure=cell.measure;measureCellIds.push(cell.id);$cell.addClass('o_pivot_measure_row text-muted').text(this.state.fields[measure].string);$cell.data('id',cell.id).data('measure',measure);if(cell.id===this.state.sortedColumn.id&&measure===this.state.sortedColumn.measure){$cell.addClass('o_pivot_measure_row_sorted_'+this.state.sortedColumn.order);if(this.state.sortedColumn.order=='asc'){$cell.attr('aria-sorted','ascending');}else{$cell.attr('aria-sorted','descending');}}}
$row.append($cell);$cell.toggleClass('d-none d-md-table-cell',(cell.expanded!==undefined)||(cell.measure!==undefined&&j<headers[i].length-this.state.measures.length));if(cell.height>1){$cell.css('padding',0);}}
$thead.append($row);}
if(this.compare){var colLabels=[this.timeRangeDescription,this.comparisonTimeRangeDescription,_t('Variation')];var dataTypes=['data','comparisonData','variation'];$row=$('<tr>');for(i=0;i<3*nbrCols;i++){id=measureCellIds[~~(i/3)];measure=this.state.measures[(~~(i/3))%this.state.measures.length];dataType=dataTypes[i%3];$cell=$('<th>').addClass('o_pivot_measure_row text-muted').data('data_type',dataType).data('id',id).data('measure',measure).text(colLabels[i%3]).attr('rowspan',1).attr('colspan',1);if(dataType===this.state.sortedColumn.dataType&&id===this.state.sortedColumn.id&&measure===this.state.sortedColumn.measure){$cell.addClass('o_pivot_measure_row_sorted_'+this.state.sortedColumn.order);if(this.state.sortedColumn.order==='asc'){$cell.attr('aria-sorted','ascending');}else{$cell.attr('aria-sorted','descending');}}
$row.append($cell);}
$thead.append($row);}},_renderRows:function($tbody,rows){var self=this;var i,j,value,measure,name,formatter,$row,$cell,$header;var nbrMeasures=this.state.measures.length;var length=rows[0].values.length;var shouldDisplayTotal=this.state.mainColWidth>1;var groupbyLabels=_.map(this.state.rowGroupBys,function(gb){return self.state.fields[gb.split(':')[0]].string;});var measureTypes=this.state.measures.map(function(name){var type=self.state.fields[name].type;return type==='many2one'?'integer':type;});for(i=0;i<rows.length;i++){$row=$('<tr>');$header=$('<td>').text(rows[i].title).data('id',rows[i].id).css('padding-left',(5+rows[i].indent*30)+'px').addClass(rows[i].expanded?'o_pivot_header_cell_opened':'o_pivot_header_cell_closed');if(rows[i].indent>0)$header.attr('title',groupbyLabels[rows[i].indent-1]);$header.appendTo($row);for(j=0;j<length;j++){value=rows[i].values[j];name=this.state.measures[j%nbrMeasures];formatter=field_utils.format[this.fieldWidgets[name]||measureTypes[j%nbrMeasures]];measure=this.state.fields[name];var options;if(this.arch.children[j%nbrMeasures]&&this.arch.children[j%nbrMeasures].attrs.digits){options={digits:JSON.parse(this.arch.children[j%nbrMeasures].attrs.digits)}}
if(this.compare){if(value instanceof Object){for(var origin in value){$cell=$('<td>').data('id',rows[i].id).data('col_id',rows[i].col_ids[Math.floor(j/nbrMeasures)]).data('type',origin).toggleClass('o_empty',false).addClass('o_pivot_cell_value text-right');if(origin==='data'){$cell.append($('<div>',{class:'o_value'}).html(formatter(value[origin],measure,options)));}else if(origin==='comparisonData'){$cell.append($('<div>',{class:'o_comparison_value'}).html(formatter(value[origin],measure,options)));}else{$cell.append($('<div>',{class:'o_variation'+value[origin].signClass}).html(field_utils.format.percentage(value[origin].magnitude,measure)));}
if(((j>=length-this.state.measures.length)&&shouldDisplayTotal)||i===0){$cell.css('font-weight','bold');}
$cell.toggleClass('d-none d-md-table-cell',j<length-nbrMeasures);$row.append($cell);}}else{for(var l=0;l<3;l++){$cell=$('<td>').data('id',rows[i].id).toggleClass('o_empty',true).addClass('o_pivot_cell_value text-right');$row.append($cell);}}}else{$cell=$('<td>').data('id',rows[i].id).data('col_id',rows[i].col_ids[Math.floor(j/nbrMeasures)]).toggleClass('o_empty',!value).addClass('o_pivot_cell_value text-right');if(value!==undefined){$cell.append($('<div>',{class:'o_value'}).html(formatter(value,measure,options)));}
if(((j>=length-this.state.measures.length)&&shouldDisplayTotal)||i===0){$cell.css('font-weight','bold');}
$row.append($cell);$cell.toggleClass('d-none d-md-table-cell',j<length-nbrMeasures);}}
$tbody.append($row);}},_onTdHover:function(event){var $td=$(event.target);$td.closest('table').find('col:eq('+$td.index()+')').toggleClass('hover');}});return PivotRenderer;});;

/* /web/static/src/js/views/pivot/pivot_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.PivotView',function(require){"use strict";var AbstractView=require('web.AbstractView');var core=require('web.core');var PivotModel=require('web.PivotModel');var PivotController=require('web.PivotController');var PivotRenderer=require('web.PivotRenderer');var _t=core._t;var _lt=core._lt;var GROUPABLE_TYPES=['many2one','char','boolean','selection','date','datetime'];var PivotView=AbstractView.extend({display_name:_lt('Pivot'),icon:'fa-table',config:{Model:PivotModel,Controller:PivotController,Renderer:PivotRenderer,},viewType:'pivot',enableTimeRangeMenu:'true',init:function(viewInfo,params){var self=this;this._super.apply(this,arguments);var activeMeasures=[];var colGroupBys=[];var rowGroupBys=[];var measures={};var groupableFields={};var widgets={};this.fields.__count={string:_t("Count"),type:"integer"};_.each(this.fields,function(field,name){if((name!=='id')&&(field.store===true)){if(_.contains(['integer','float','monetary'],field.type)||_.contains(params.additionalMeasures,name)){measures[name]=field;}
if(_.contains(GROUPABLE_TYPES,field.type)){groupableFields[name]=field;}}});measures.__count={string:_t("Count"),type:"integer"};this.arch.children.forEach(function(field){var name=field.attrs.name;if(field.attrs.interval){name+=':'+field.attrs.interval;}
if(field.attrs.widget){widgets[name]=field.attrs.widget;}
if(field.attrs.invisible&&py.eval(field.attrs.invisible)){delete measures[name];return;}
if(field.attrs.type==='measure'&&!(field.attrs.name in measures)){measures[field.attrs.name]=self.fields[field.attrs.name];}
if(field.attrs.string&&name in measures){measures[name].string=field.attrs.string;}
if(field.attrs.type==='measure'||'operator'in field.attrs){activeMeasures.push(name);measures[name]=self.fields[name];}
if(field.attrs.type==='col'){colGroupBys.push(name);}
if(field.attrs.type==='row'){rowGroupBys.push(name);}});if((!activeMeasures.length)||this.arch.attrs.display_quantity){activeMeasures=['__count'].concat(activeMeasures);}
this.loadParams.measures=activeMeasures;this.loadParams.colGroupBys=colGroupBys;this.loadParams.rowGroupBys=rowGroupBys;this.loadParams.fields=this.fields;this.loadParams.default_order=params.default_order||this.arch.attrs.default_order;this.rendererParams.widgets=widgets;this.controllerParams.title=params.title||this.arch.attrs.string||_t("Untitled");this.controllerParams.enableLinking=!this.arch.attrs.disable_linking;this.controllerParams.measures=measures;this.controllerParams.groupableFields=groupableFields;this.controllerParams.views=[_findView(params.action&&params.action.views,'list'),_findView(params.action&&params.action.views,'form'),];function _findView(views,viewType){var view=_.find(views,function(view){return view.type===viewType;});return[view?view.viewID:false,viewType];}},});return PivotView;});;

/* /web/static/src/js/views/calendar/calendar_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarController',function(require){"use strict";var AbstractController=require('web.AbstractController');var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var dialogs=require('web.view_dialogs');var QuickCreate=require('web.CalendarQuickCreate');var _t=core._t;var QWeb=core.qweb;function dateToServer(date){return date.clone().utc().locale('en').format('YYYY-MM-DD HH:mm:ss');}
var CalendarController=AbstractController.extend({custom_events:_.extend({},AbstractController.prototype.custom_events,{changeDate:'_onChangeDate',changeFilter:'_onChangeFilter',dropRecord:'_onDropRecord',next:'_onNext',openCreate:'_onOpenCreate',openEvent:'_onOpenEvent',prev:'_onPrev',quickCreate:'_onQuickCreate',toggleFullWidth:'_onToggleFullWidth',updateRecord:'_onUpdateRecord',viewUpdated:'_onViewUpdated',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.current_start=null;this.displayName=params.displayName;this.quickAddPop=params.quickAddPop;this.disableQuickCreate=params.disableQuickCreate;this.eventOpenPopup=params.eventOpenPopup;this.formViewId=params.formViewId;this.readonlyFormViewId=params.readonlyFormViewId;this.mapping=params.mapping;this.context=params.context;this.quickCreating=false;},destroy:function(){this._super.apply(this,arguments);if(this.$todayButton){this.$todayButton.off();}},getTitle:function(){return this.get('title');},renderButtons:function($node){var self=this;this.$buttons=$(QWeb.render('CalendarView.buttons',{isMobile:config.device.isMobile,}));this.$buttons.on('click','button.o_calendar_button_new',function(){self.trigger_up('switch_view',{view_type:'form'});});_.each(['prev','today','next'],function(action){self.$buttons.on('click','.o_calendar_button_'+action,function(){self._move(action);});});_.each(['day','week','month'],function(scale){self.$buttons.on('click','.o_calendar_button_'+scale,function(){self.model.setScale(scale);self.reload();});});this.$buttons.find('.o_calendar_button_'+this.mode).addClass('active');if($node){this.$buttons.appendTo($node);}else{this.$('.o_calendar_buttons').replaceWith(this.$buttons);}},renderPager:function($node){if(config.device.isMobile){this.$todayButton=$(QWeb.render('CalendarView.TodayButtonMobile'));this.$todayButton.on('click',this._move.bind(this,'today'));$node.append(this.$todayButton);}},_move:function(to){this.model[to]();return this.reload();},_updateRecord:function(record){return this.model.updateRecord(record).always(this.reload.bind(this));},_onChangeDate:function(event){var modelData=this.model.get();if(modelData.target_date.format('YYYY-MM-DD')===event.data.date.format('YYYY-MM-DD')){switch(modelData.scale){case'month':this.model.setScale('week');break;case'week':this.model.setScale('day');break;case'day':this.model.setScale('month');break;}}else if(modelData.target_date.week()===event.data.date.week()){this.model.setScale('day');}else{this.model.setScale('week');}
this.model.setDate(event.data.date);this.reload();},_onChangeFilter:function(event){if(this.model.changeFilter(event.data)&&!event.data.no_reload){this.reload();}},_onDropRecord:function(event){this._updateRecord(_.extend({},event.data,{'drop':true,}));},_onNext:function(event){event.stopPropagation();this._move('next');},_onOpenCreate:function(event){var self=this;if(this.model.get().scale==="month"){event.data.allDay=true;}
var data=this.model.calendarEventToRecord(event.data);var context=_.extend({},this.context,event.options&&event.options.context);context.default_name=data.name||null;context['default_'+this.mapping.date_start]=data[this.mapping.date_start]||null;if(this.mapping.date_stop){context['default_'+this.mapping.date_stop]=data[this.mapping.date_stop]||null;}
if(this.mapping.date_delay){context['default_'+this.mapping.date_delay]=data[this.mapping.date_delay]||null;}
if(this.mapping.all_day){context['default_'+this.mapping.all_day]=data[this.mapping.all_day]||null;}
for(var k in context){if(context[k]&&context[k]._isAMomentObject){context[k]=dateToServer(context[k]);}}
var options=_.extend({},this.options,event.options,{context:context,title:_.str.sprintf(_t('Create: %s'),(this.displayName||this.renderer.arch.attrs.string))});if(this.quick!=null){this.quick.destroy();this.quick=null;}
if(!options.disableQuickCreate&&!event.data.disableQuickCreate&&this.quickAddPop){this.quick=new QuickCreate(this,true,options,data,event.data);this.quick.open();this.quick.opened(function(){self.quick.focus();});return;}
var title=_t("Create");if(this.renderer.arch.attrs.string){title+=': '+this.renderer.arch.attrs.string;}
if(this.eventOpenPopup){new dialogs.FormViewDialog(self,{res_model:this.modelName,context:context,title:title,view_id:this.formViewId||false,disable_multiple_selection:true,on_saved:function(){if(event.data.on_save){event.data.on_save();}
self.reload();},}).open();}else{this.do_action({type:'ir.actions.act_window',res_model:this.modelName,views:[[this.formViewId||false,'form']],target:'current',context:context,});}},_onOpenEvent:function(event){var self=this;var id=event.data._id;id=id&&parseInt(id).toString()===id?parseInt(id):id;if(!this.eventOpenPopup){this._rpc({model:self.modelName,method:'get_formview_id',args:[[id],event.context||self.context],}).then(function(viewId){self.do_action({type:'ir.actions.act_window',res_id:id,res_model:self.modelName,views:[[viewId||false,'form']],target:'current',context:event.context||self.context,});});return;}
var open_dialog=function(readonly){var options={res_model:self.modelName,res_id:id||null,context:event.context||self.context,readonly:readonly,title:_t("Open: ")+_.escape(event.data.title),on_saved:function(){if(event.data.on_save){event.data.on_save();}
self.reload();},};if(readonly){if(self.readonlyFormViewId){options.view_id=parseInt(self.readonlyFormViewId);}
options.buttons=[{text:_t("Edit"),classes:'btn-primary',close:true,click:function(){open_dialog(false);}},{text:_t("Delete"),click:function(){Dialog.confirm(this,_t("Are you sure you want to delete this record ?"),{confirm_callback:function(){self.model.deleteRecords([id],self.modelName).then(function(){self.dialog.destroy();self.reload();});}});},},{text:_t("Close"),close:true}];}else if(self.formViewId){options.view_id=parseInt(self.formViewId);}
self.dialog=new dialogs.FormViewDialog(self,options).open();};open_dialog(true);},_onPrev:function(){event.stopPropagation();this._move('prev');},_onQuickCreate:function(event){var self=this;if(this.quickCreating){return;}
this.quickCreating=true;this.model.createRecord(event).then(function(){self.quick.destroy();self.quick=null;self.reload();}).fail(function(error,errorEvent){errorEvent.preventDefault();event.data.options.disableQuickCreate=true;event.data.data.on_save=self.quick.destroy.bind(self.quick);self._onOpenCreate(event.data);}).always(function(){self.quickCreating=false;});},_onToggleFullWidth:function(){this.model.toggleFullWidth();this.reload();},_onUpdateRecord:function(event){this._updateRecord(event.data);},_onViewUpdated:function(event){this.mode=event.data.mode;if(this.$buttons){this.$buttons.find('.active').removeClass('active');this.$buttons.find('.o_calendar_button_'+this.mode).addClass('active');}
this.set({title:this.displayName+' ('+event.data.title+')'});},});return CalendarController;});;

/* /web/static/src/js/views/calendar/calendar_model.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var Context=require('web.Context');var core=require('web.core');var fieldUtils=require('web.field_utils');var session=require('web.session');var _t=core._t;var scales=['day','week','month'];function dateToServer(date){return date.clone().utc().locale('en').format('YYYY-MM-DD HH:mm:ss');}
return AbstractModel.extend({init:function(){this._super.apply(this,arguments);this.end_date=null;var week_start=_t.database.parameters.week_start;this.week_start=week_start!==undefined&&week_start!==false?week_start%7:moment().startOf('week').day();this.week_stop=this.week_start+6;},calendarEventToRecord:function(event){var data={'name':event.title};var start=event.start.clone();var end=event.end&&event.end.clone();if(event.reset_allday===false){event.allDay=false;start.hours(event.r_start.hours()).minutes(event.r_start.minutes()).seconds(event.r_start.seconds()).milliseconds(event.r_start.milliseconds());if(end){end.subtract(1,'days');end.hours(event.r_end.hours()).minutes(event.r_end.minutes()).seconds(event.r_end.seconds()).milliseconds(event.r_end.milliseconds());}}
if(event.allDay||(end&&end.diff(start)%86400000===0)){event.allDay=true;}
if(!end||end.diff(start)<0){if(event.allDay){end=start.clone();}else{end=start.clone().add(2,'h');}}else if(event.allDay){end.add(-1,'days');}
var isDateEvent=this.fields[this.mapping.date_start].type==='date';if(event.allDay){if(!this.mapping.all_day&&!isDateEvent){if(event.r_start){start.hours(event.r_start.hours()).minutes(event.r_start.minutes()).seconds(event.r_start.seconds()).utc();end.hours(event.r_end.hours()).minutes(event.r_end.minutes()).seconds(event.r_end.seconds()).utc();}else{start.hours(7);end.hours(19);}
start.add(-this.getSession().getTZOffset(start),'minutes');end.add(-this.getSession().getTZOffset(end),'minutes');}}else{start.add(-this.getSession().getTZOffset(start),'minutes');end.add(-this.getSession().getTZOffset(end),'minutes');}
if(this.mapping.all_day){if(event.record){data[this.mapping.all_day]=(this.scale!=='month'&&event.allDay)||event.record[this.mapping.all_day]&&end.diff(start)<10||false;}else{data[this.mapping.all_day]=event.allDay;}}
data[this.mapping.date_start]=start;if(this.mapping.date_stop){data[this.mapping.date_stop]=end;}
if(this.mapping.date_delay){if(this.data.scale!=='month'||(this.data.scale==='month'&&!event.drop)){data[this.mapping.date_delay]=(end.diff(start)<=0?end.endOf('day').diff(start):end.diff(start))/1000/3600;}}
return data;},changeFilter:function(filter){var Filter=this.data.filters[filter.fieldName];if(filter.value==='all'){Filter.all=filter.active;}
var f=_.find(Filter.filters,function(f){return f.value===filter.value;});if(f){if(f.active!==filter.active){f.active=filter.active;}else{return false;}}else if(filter.active){Filter.filters.push({value:filter.value,active:true,});}
return true;},createRecord:function(event){var data=this.calendarEventToRecord(event.data.data);for(var k in data){if(data[k]&&data[k]._isAMomentObject){data[k]=dateToServer(data[k]);}}
return this._rpc({model:this.modelName,method:'create',args:[data],context:event.data.options.context,});},deleteRecords:function(ids,model){return this._rpc({model:model,method:'unlink',args:[ids],context:session.user_context,});},get:function(){return _.extend({},this.data,{fields:this.fields});},load:function(params){var self=this;this.modelName=params.modelName;this.fields=params.fields;this.fieldNames=params.fieldNames;this.fieldsInfo=params.fieldsInfo;this.mapping=params.mapping;this.mode=params.mode;this.scales=params.scales;this.editable=params.editable;this.creatable=params.creatable;this.eventLimit=params.eventLimit;this.fieldColor=params.fieldColor;if(!this.preload_def){this.preload_def=$.Deferred();$.when(this._rpc({model:this.modelName,method:'check_access_rights',args:["write",false]}),this._rpc({model:this.modelName,method:'check_access_rights',args:["create",false]})).then(function(write,create){self.write_right=write;self.create_right=create;self.preload_def.resolve();});}
this.data={domain:params.domain,context:params.context,filters:params.filters,};this.setDate(params.initialDate);this.setScale(params.mode);_.each(this.data.filters,function(filter){if(filter.avatar_field&&!filter.avatar_model){filter.avatar_model=self.modelName;}});return this.preload_def.then(this._loadCalendar.bind(this));},next:function(){this.setDate(this.data.target_date.clone().add(1,this.data.scale));},prev:function(){this.setDate(this.data.target_date.clone().add(-1,this.data.scale));},reload:function(handle,params){if(params.domain){this.data.domain=params.domain;}
if(params.context){this.data.context=params.context;}
return this._loadCalendar();},setDate:function(start){this.data.highlight_date=this.data.target_date=start.clone();this.data.start_date=this.data.end_date=start;switch(this.data.scale){case'month':var monthStart=this.data.start_date.clone().startOf('month');var monthStartDay;if(monthStart.day()>=this.week_start){monthStartDay=this.week_start;}else{monthStartDay=this.week_start-7;}
this.data.start_date=monthStart.day(monthStartDay).startOf('day');this.data.end_date=this.data.start_date.clone().add(5,'week').day(this.week_stop).endOf('day');break;case'week':var weekStart=this.data.start_date.clone().startOf('week');var weekStartDay=this.week_start;if(this.data.start_date.day()<this.week_start){weekStartDay-=7;}
this.data.start_date=this.data.start_date.clone().day(weekStartDay).startOf('day');this.data.end_date=this.data.end_date.clone().day(weekStartDay+6).endOf('day');break;default:this.data.start_date=this.data.start_date.clone().startOf('day');this.data.end_date=this.data.end_date.clone().endOf('day');}
var manualUtcDateStart=this.data.start_date.clone().add(-this.getSession().getTZOffset(this.data.start_date),'minutes');var formattedUtcDateStart=manualUtcDateStart.format('YYYY-MM-DDTHH:mm:ss')+'Z';this.data.start_date=moment.utc(formattedUtcDateStart);var manualUtcDateEnd=this.data.end_date.clone().add(-this.getSession().getTZOffset(this.data.start_date),'minutes');var formattedUtcDateEnd=manualUtcDateEnd.format('YYYY-MM-DDTHH:mm:ss')+'Z';this.data.end_date=moment.utc(formattedUtcDateEnd);},setScale:function(scale){if(!_.contains(scales,scale)){scale="week";}
this.data.scale=scale;this.setDate(this.data.target_date);},today:function(){this.setDate(moment(new Date()));},toggleFullWidth:function(){var fullWidth=this.call('local_storage','getItem','calendar_fullWidth')!==true;this.call('local_storage','setItem','calendar_fullWidth',fullWidth);},updateRecord:function(record){var data=_.omit(this.calendarEventToRecord(record),'name');for(var k in data){if(data[k]&&data[k]._isAMomentObject){data[k]=dateToServer(data[k]);}}
var context=new Context(this.data.context,{from_ui:true});return this._rpc({model:this.modelName,method:'write',args:[[record.id],data],context:context});},_getFilterDomain:function(){var authorizedValues={};var avoidValues={};_.each(this.data.filters,function(filter){if(filter.all)return;_.each(filter.filters,function(f){if(filter.write_model){if(!authorizedValues[filter.fieldName])
authorizedValues[filter.fieldName]=[];if(f.active){authorizedValues[filter.fieldName].push(f.value);}}else{if(!avoidValues[filter.fieldName])
avoidValues[filter.fieldName]=[];if(!f.active){avoidValues[filter.fieldName].push(f.value);}}});});var domain=[];for(var field in authorizedValues){domain.push([field,'in',authorizedValues[field]]);}
for(var field in avoidValues){if(avoidValues[field].length>0){domain.push([field,'not in',avoidValues[field]]);}}
return domain;},_getFullCalendarOptions:function(){return{defaultView:(this.mode==="month")?"month":((this.mode==="week")?"agendaWeek":((this.mode==="day")?"agendaDay":"agendaWeek")),header:false,selectable:this.creatable&&this.create_right,selectHelper:true,editable:this.editable,droppable:true,navLinks:false,eventLimit:this.eventLimit,snapMinutes:15,longPressDelay:500,eventResizableFromStart:true,weekNumbers:true,weekNumberTitle:_t("W"),allDayText:_t("All day"),monthNames:moment.months(),monthNamesShort:moment.monthsShort(),dayNames:moment.weekdays(),dayNamesShort:moment.weekdaysShort(),firstDay:this.week_start,slotLabelFormat:_t.database.parameters.time_format.search("%H")!=-1?'H:mm':'h(:mm)a',};},_getRangeDomain:function(){var domain=[[this.mapping.date_start,'<=',dateToServer(this.data.end_date)]];if(this.mapping.date_stop){domain.push([this.mapping.date_stop,'>=',dateToServer(this.data.start_date)]);}else if(!this.mapping.date_delay){domain.push([this.mapping.date_start,'>=',dateToServer(this.data.start_date)]);}
return domain;},_loadCalendar:function(){var self=this;this.data.fullWidth=this.call('local_storage','getItem','calendar_fullWidth')===true;this.data.fc_options=this._getFullCalendarOptions();var defs=_.map(this.data.filters,this._loadFilter.bind(this));return $.when.apply($,defs).then(function(){return self._rpc({model:self.modelName,method:'search_read',context:self.data.context,fields:self.fieldNames,domain:self.data.domain.concat(self._getRangeDomain()).concat(self._getFilterDomain())}).then(function(events){self._parseServerData(events);self.data.data=_.map(events,self._recordToCalendarEvent.bind(self));return $.when(self._loadColors(self.data,self.data.data),self._loadRecordsToFilters(self.data,self.data.data));});});},_loadColors:function(element,events){if(this.fieldColor){var fieldName=this.fieldColor;_.each(events,function(event){var value=event.record[fieldName];event.color_index=_.isArray(value)?value[0]:value;});this.model_color=this.fields[fieldName].relation||element.model;}
return $.Deferred().resolve();},_loadFilter:function(filter){if(!filter.write_model){return;}
var field=this.fields[filter.fieldName];return this._rpc({model:filter.write_model,method:'search_read',domain:[["user_id","=",session.uid]],fields:[filter.write_field],}).then(function(res){var records=_.map(res,function(record){var _value=record[filter.write_field];var value=_.isArray(_value)?_value[0]:_value;var f=_.find(filter.filters,function(f){return f.value===value;});var formater=fieldUtils.format[_.contains(['many2many','one2many'],field.type)?'many2one':field.type];return{'id':record.id,'value':value,'label':formater(_value,field),'active':!f||f.active,};});records.sort(function(f1,f2){return _.string.naturalCmp(f2.label,f1.label);});if(field.relation==='res.partner'||field.relation==='res.users'){var value=field.relation==='res.partner'?session.partner_id:session.uid;var me=_.find(records,function(record){return record.value===value;});if(me){records.splice(records.indexOf(me),1);}else{var f=_.find(filter.filters,function(f){return f.value===value;});me={'value':value,'label':session.name+_t(" [Me]"),'active':!f||f.active,};}
records.unshift(me);}
records.push({'value':'all','label':field.relation==='res.partner'||field.relation==='res.users'?_t("Everybody's calendars"):_t("Everything"),'active':filter.all,});filter.filters=records;});},_loadRecordsToFilters:function(element,events){var self=this;var new_filters={};var to_read={};_.each(this.data.filters,function(filter,fieldName){var field=self.fields[fieldName];new_filters[fieldName]=filter;if(filter.write_model){if(field.relation===self.model_color){_.each(filter.filters,function(f){f.color_index=f.value;});}
return;}
_.each(filter.filters,function(filter){filter.display=!filter.active;});var fs=[];var undefined_fs=[];_.each(events,function(event){var data=event.record[fieldName];if(!_.contains(['many2many','one2many'],field.type)){data=[data];}else{to_read[field.relation]=(to_read[field.relation]||[]).concat(data);}
_.each(data,function(_value){var value=_.isArray(_value)?_value[0]:_value;var f={'color_index':self.model_color===(field.relation||element.model)?value:false,'value':value,'label':fieldUtils.format[field.type](_value,field)||_t("Undefined"),'avatar_model':field.relation||element.model,};value?fs.push(f):undefined_fs.push(f);});});_.each(_.union(fs,undefined_fs),function(f){var f1=_.findWhere(filter.filters,f);if(f1){f1.display=true;}else{f.display=f.active=true;filter.filters.push(f);}});});var defs=[];_.each(to_read,function(ids,model){defs.push(self._rpc({model:model,method:'name_get',args:[_.uniq(ids)],}).then(function(res){to_read[model]=_.object(res);}));});return $.when.apply($,defs).then(function(){_.each(self.data.filters,function(filter){if(filter.write_model){return;}
if(filter.filters.length&&(filter.filters[0].avatar_model in to_read)){_.each(filter.filters,function(f){f.label=to_read[f.avatar_model][f.value];});}});});},_parseServerData:function(data){var self=this;_.each(data,function(event){_.each(self.fieldNames,function(fieldName){event[fieldName]=self._parseServerValue(self.fields[fieldName],event[fieldName]);});});},_recordToCalendarEvent:function(evt){var date_start;var date_stop;var date_delay=evt[this.mapping.date_delay]||1.0,all_day=this.fields[this.mapping.date_start].type==='date'||this.mapping.all_day&&evt[this.mapping.all_day]||false,the_title='',attendees=[];if(!all_day){date_start=evt[this.mapping.date_start].clone();date_stop=this.mapping.date_stop?evt[this.mapping.date_stop].clone():null;}else{date_start=evt[this.mapping.date_start].clone().startOf('day');date_stop=this.mapping.date_stop?evt[this.mapping.date_stop].clone().startOf('day'):null;}
if(!date_stop&&date_delay){date_stop=date_start.clone().add(date_delay,'hours');}
if(!all_day){date_start.add(this.getSession().getTZOffset(date_start),'minutes');date_stop.add(this.getSession().getTZOffset(date_stop),'minutes');}
if(this.mapping.all_day&&evt[this.mapping.all_day]){date_stop.add(1,'days');}
var r={'record':evt,'start':date_start,'end':date_stop,'r_start':date_start,'r_end':date_stop,'title':the_title,'allDay':all_day,'id':evt.id,'attendees':attendees,};if(this.mapping.all_day&&evt[this.mapping.all_day]){}else if(this.data.scale==='month'&&this.fields[this.mapping.date_start].type!=='date'){var month_date_stop=date_stop.clone().add(1,'days').startOf('day');r.reset_allday=r.allDay;r.allDay=true;r.start=date_start.format('YYYY-MM-DD');r.end=month_date_stop.format('YYYY-MM-DD');}
return r;},});});;

/* /web/static/src/js/views/calendar/calendar_quick_create.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarQuickCreate',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var _t=core._t;var QWeb=core.qweb;var QuickCreate=Dialog.extend({events:_.extend({},Dialog.events,{'keyup input':'_onkeyup',}),init:function(parent,buttons,options,dataTemplate,dataCalendar){this._buttons=buttons||false;this.options=options;this.dataTemplate=dataTemplate||{};this.dataCalendar=dataCalendar;var self=this;this._super(parent,{title:options.title,size:'small',buttons:this._buttons?[{text:_t("Create"),classes:'btn-primary',click:function(){if(!self._quickAdd(dataCalendar)){self.focus();}}},{text:_t("Edit"),click:function(){dataCalendar.disableQuickCreate=true;dataCalendar.title=self.$('input').val().trim();dataCalendar.on_save=self.destroy.bind(self);self.trigger_up('openCreate',dataCalendar);}},{text:_t("Cancel"),close:true},]:[],$content:QWeb.render('CalendarView.quick_create',{widget:this})});},focus:function(){this.$('input').focus();},_quickAdd:function(dataCalendar){dataCalendar=$.extend({},this.dataTemplate,dataCalendar);var val=this.$('input').val().trim();dataCalendar.title=val;return(val)?this.trigger_up('quickCreate',{data:dataCalendar,options:this.options}):false;},_onkeyup:function(event){if(this._flagEnter){return;}
if(event.keyCode===$.ui.keyCode.ENTER){this._flagEnter=true;if(!this._quickAdd(this.dataCalendar)){this._flagEnter=false;}}else if(event.keyCode===$.ui.keyCode.ESCAPE&&this._buttons){this.close();}},});return QuickCreate;});;

/* /web/static/src/js/views/calendar/calendar_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var field_utils=require('web.field_utils');var FieldManagerMixin=require('web.FieldManagerMixin');var QWeb=require('web.QWeb');var relational_fields=require('web.relational_fields');var session=require('web.session');var utils=require('web.utils');var Widget=require('web.Widget');var _t=core._t;var qweb=core.qweb;var scales={day:'agendaDay',week:'agendaWeek',month:'month'};var SidebarFilterM2O=relational_fields.FieldMany2One.extend({_getSearchBlacklist:function(){return this._super.apply(this,arguments).concat(this.filter_ids||[]);},});var SidebarFilter=Widget.extend(FieldManagerMixin,{template:'CalendarView.sidebar.filter',custom_events:_.extend({},FieldManagerMixin.custom_events,{field_changed:'_onFieldChanged',}),init:function(parent,options){this._super.apply(this,arguments);FieldManagerMixin.init.call(this);this.title=options.title;this.fields=options.fields;this.fieldName=options.fieldName;this.write_model=options.write_model;this.write_field=options.write_field;this.avatar_field=options.avatar_field;this.avatar_model=options.avatar_model;this.filters=options.filters;this.label=options.label;this.getColor=options.getColor;},willStart:function(){var self=this;var defs=[this._super.apply(this,arguments)];if(this.write_model||this.write_field){var def=this.model.makeRecord(this.write_model,[{name:this.write_field,relation:this.fields[this.fieldName].relation,type:'many2one',}]).then(function(recordID){self.many2one=new SidebarFilterM2O(self,self.write_field,self.model.get(recordID),{mode:'edit',attrs:{placeholder:_.str.sprintf(_t("Add %s"),self.title),can_create:false},});});defs.push(def);}
return $.when.apply($,defs);},start:function(){this._super();if(this.many2one){this.many2one.appendTo(this.$el);this.many2one.filter_ids=_.without(_.pluck(this.filters,'value'),'all');}
this.$el.on('click','.o_remove',this._onFilterRemove.bind(this));this.$el.on('click','.custom-checkbox input',this._onFilterActive.bind(this));},_onFieldChanged:function(event){var self=this;event.stopPropagation();var createValues={'user_id':session.uid};var value=event.data.changes[this.write_field].id;createValues[this.write_field]=value;this._rpc({model:this.write_model,method:'create',args:[createValues],}).then(function(){self.trigger_up('changeFilter',{'fieldName':self.fieldName,'value':value,'active':true,});});},_onFilterActive:function(e){var $input=$(e.currentTarget);this.trigger_up('changeFilter',{'fieldName':this.fieldName,'value':$input.closest('.o_calendar_filter_item').data('value'),'active':$input.prop('checked'),});},_onFilterRemove:function(e){var self=this;var $filter=$(e.currentTarget).closest('.o_calendar_filter_item');Dialog.confirm(this,_t("Do you really want to delete this filter from favorites ?"),{confirm_callback:function(){self._rpc({model:self.write_model,method:'unlink',args:[[$filter.data('id')]],}).then(function(){self.trigger_up('changeFilter',{'fieldName':self.fieldName,'id':$filter.data('id'),'active':false,'value':$filter.data('value'),});});},});},});return AbstractRenderer.extend({template:"CalendarView",events:_.extend({},AbstractRenderer.prototype.events,{'click .o_calendar_sidebar_toggler':'_onToggleSidebar',}),init:function(parent,state,params){this._super.apply(this,arguments);this.displayFields=params.displayFields;this.model=params.model;this.filters=[];this.color_map={};if(params.eventTemplate){this.qweb=new QWeb(session.debug,{_s:session.origin});this.qweb.add_template(utils.json_node_to_xml(params.eventTemplate));}},start:function(){this._initSidebar();this._initCalendar();if(config.device.isMobile){this._bindSwipe();}
return this._super();},destroy:function(){if(this.$calendar){this.$calendar.fullCalendar('destroy');}
if(this.$small_calendar){this.$small_calendar.datepicker('destroy');$('#ui-datepicker-div:empty').remove();}
this._super.apply(this,arguments);},getAvatars:function(record,fieldName,imageField){var field=this.state.fields[fieldName];if(!record[fieldName]){return[];}
if(field.type==='one2many'||field.type==='many2many'){return _.map(record[fieldName],function(id){return'<img src="/web/image/'+field.relation+'/'+id+'/'+imageField+'" />';});}else if(field.type==='many2one'){return['<img src="/web/image/'+field.relation+'/'+record[fieldName][0]+'/'+imageField+'" />'];}else{var value=this._format(record,fieldName);var color=this.getColor(value);if(isNaN(color)){return['<span class="o_avatar_square" style="background-color:'+color+';"/>'];}
else{return['<span class="o_avatar_square o_calendar_color_'+color+'"/>'];}}},getColor:function(key){if(!key){return;}
if(this.color_map[key]){return this.color_map[key];}
if(typeof key==='string'&&key.match(/^((#[A-F0-9]{3})|(#[A-F0-9]{6})|((hsl|rgb)a?\(\s*(?:(\s*\d{1,3}%?\s*),?){3}(\s*,[0-9.]{1,4})?\))|)$/i)){return this.color_map[key]=key;}
var index=(((_.keys(this.color_map).length+1)*5)%24)+1;this.color_map[key]=index;return index;},getLocalState:function(){var $fcScroller=this.$calendar.find('.fc-scroller');return{scrollPosition:$fcScroller.scrollTop(),};},setLocalState:function(localState){if(localState.scrollPosition){var $fcScroller=this.$calendar.find('.fc-scroller');$fcScroller.scrollTop(localState.scrollPosition);}},_bindSwipe:function(){var self=this;var touchStartX;var touchEndX;this.$calendar.on('touchstart',function(event){touchStartX=event.originalEvent.touches[0].pageX;});this.$calendar.on('touchend',function(event){touchEndX=event.originalEvent.changedTouches[0].pageX;if(touchStartX-touchEndX>100){self.trigger_up('next');}else if(touchStartX-touchEndX<-100){self.trigger_up('prev');}});},_eventRender:function(event){var qweb_context={event:event,fields:this.state.fields,format:this._format.bind(this),isMobile:config.device.isMobile,read_only_mode:this.read_only_mode,record:event.record,user_context:session.user_context,widget:this,};this.qweb_context=qweb_context;if(_.isEmpty(qweb_context.record)){return'';}else{return(this.qweb||qweb).render("calendar-box",qweb_context);}},_format:function(record,fieldName){var field=this.state.fields[fieldName];if(field.type==="one2many"||field.type==="many2many"){return field_utils.format[field.type]({data:record[fieldName]},field);}else{return field_utils.format[field.type](record[fieldName],field,{forceString:true});}},_initCalendar:function(){var self=this;this.$calendar=this.$(".o_calendar_widget");var locale=moment.locale();$.fullCalendar.locale(locale);var fc_options=$.extend({},this.state.fc_options,{eventDrop:function(event){self.trigger_up('dropRecord',event);},eventResize:function(event){self.trigger_up('updateRecord',event);},eventClick:function(event){self.trigger_up('openEvent',event);self.$calendar.fullCalendar('unselect');},select:function(target_date,end_date,event,_js_event,_view){var data={'start':target_date,'end':end_date};if(self.state.context.default_name){data.title=self.state.context.default_name;}
self.trigger_up('openCreate',data);self.$calendar.fullCalendar('unselect');},eventRender:function(event,element){var $render=$(self._eventRender(event));event.title=$render.find('.o_field_type_char:first').text();element.find('.fc-content').html($render.html());element.addClass($render.attr('class'));var display_hour='';if(!event.allDay){var start=event.r_start||event.start;var end=event.r_end||event.end;var timeFormat=_t.database.parameters.time_format.search("%H")!=-1?'HH:mm':'h:mma';display_hour=start.format(timeFormat)+' - '+end.format(timeFormat);if(display_hour==='00:00 - 00:00'){display_hour=_t('All day');}}
element.find('.fc-content .fc-time').text(display_hour);},eventAfterAllRender:function(){$(window).trigger('resize');},viewRender:function(view){var mode=view.name==='month'?'month':(view.name==='agendaWeek'?'week':'day');self.trigger_up('viewUpdated',{mode:mode,title:view.title,});},height:'parent',unselectAuto:false,isRTL:_t.database.parameters.direction==="rtl",locale:locale,});this.$calendar.fullCalendar(fc_options);},_initCalendarMini:function(){var self=this;this.$small_calendar=this.$(".o_calendar_mini");this.$small_calendar.datepicker({'onSelect':function(datum,obj){self.trigger_up('changeDate',{date:moment(new Date(+obj.currentYear,+obj.currentMonth,+obj.currentDay))});},'dayNamesMin':this.state.fc_options.dayNamesShort,'monthNames':this.state.fc_options.monthNamesShort,'firstDay':this.state.fc_options.firstDay,});},_initSidebar:function(){this.$sidebar=this.$('.o_calendar_sidebar');this.$sidebar_container=this.$(".o_calendar_sidebar_container");this._initCalendarMini();},_render:function(){var $calendar=this.$calendar;var $fc_view=$calendar.find('.fc-view');var scrollPosition=$fc_view.scrollLeft();var scrollTop=this.$calendar.find('.fc-scroller').scrollTop();$fc_view.scrollLeft(0);$calendar.fullCalendar('unselect');if(scales[this.state.scale]!==$calendar.data('fullCalendar').getView().type){$calendar.fullCalendar('changeView',scales[this.state.scale]);}
if(this.target_date!==this.state.target_date.toString()){$calendar.fullCalendar('gotoDate',moment(this.state.target_date));this.target_date=this.state.target_date.toString();}
this.$small_calendar.datepicker("setDate",this.state.highlight_date.toDate()).find('.o_selected_range').removeClass('o_color o_selected_range');var $a;switch(this.state.scale){case'month':$a=this.$small_calendar.find('td a');break;case'week':$a=this.$small_calendar.find('tr:has(.ui-state-active) a');break;case'day':$a=this.$small_calendar.find('a.ui-state-active');break;}
$a.addClass('o_selected_range');setTimeout(function(){$a.not('.ui-state-active').addClass('o_color');});$fc_view.scrollLeft(scrollPosition);var fullWidth=this.state.fullWidth;this.$('.o_calendar_sidebar_toggler').toggleClass('fa-close',!fullWidth).toggleClass('fa-chevron-left',fullWidth).attr('title',!fullWidth?_('Close Sidebar'):_('Open Sidebar'));this.$sidebar_container.toggleClass('o_sidebar_hidden',fullWidth);this.$sidebar.toggleClass('o_hidden',fullWidth);this._renderFilters();this.$calendar.appendTo('body');if(scrollTop){this.$calendar.fullCalendar('reinitView');}else{this.$calendar.fullCalendar('render');}
this._renderEvents();this.$calendar.prependTo(this.$('.o_calendar_view'));return this._super.apply(this,arguments);},_renderEvents:function(){this.$calendar.fullCalendar('removeEvents');this.$calendar.fullCalendar('addEventSource',this.state.data);},_renderFilters:function(){var self=this;_.each(this.filters||(this.filters=[]),function(filter){filter.destroy();});if(this.state.fullWidth){return;}
_.each(this.state.filters,function(options){if(!_.find(options.filters,function(f){return f.display==null||f.display;})){return;}
options.getColor=self.getColor.bind(self);options.fields=self.state.fields;var filter=new SidebarFilter(self,options);filter.appendTo(self.$sidebar);self.filters.push(filter);});},_onToggleSidebar:function(){this.trigger_up('toggleFullWidth');},});});;

/* /web/static/src/js/views/calendar/calendar_view.js defined in bundle 'web.assets_backend' */
odoo.define('web.CalendarView',function(require){"use strict";var AbstractView=require('web.AbstractView');var CalendarModel=require('web.CalendarModel');var CalendarController=require('web.CalendarController');var CalendarRenderer=require('web.CalendarRenderer');var core=require('web.core');var utils=require('web.utils');var _lt=core._lt;var fieldsToGather=["date_start","date_delay","date_stop","all_day",];var CalendarView=AbstractView.extend({display_name:_lt('Calendar'),icon:'fa-calendar',jsLibs:['/web/static/lib/fullcalendar/js/fullcalendar.js'],cssLibs:['/web/static/lib/fullcalendar/css/fullcalendar.css'],config:{Model:CalendarModel,Controller:CalendarController,Renderer:CalendarRenderer,},viewType:'calendar',groupable:false,init:function(viewInfo,params){this._super.apply(this,arguments);var arch=this.arch;var fields=this.fields;var attrs=arch.attrs;if(!attrs.date_start){throw new Error(_lt("Calendar view has not defined 'date_start' attribute."));}
var mapping={};var fieldNames=fields.display_name?['display_name']:[];var displayFields={};_.each(fieldsToGather,function(field){if(arch.attrs[field]){var fieldName=attrs[field];mapping[field]=fieldName;fieldNames.push(fieldName);}});var filters={};var eventLimit=attrs.event_limit!==null&&(isNaN(+attrs.event_limit)?_.str.toBool(attrs.event_limit):+attrs.event_limit);var modelFilters=[];_.each(arch.children,function(child){if(child.tag!=='field')return;var fieldName=child.attrs.name;fieldNames.push(fieldName);if(!child.attrs.invisible){displayFields[fieldName]=child.attrs;if(params.sidebar===false)return;if(child.attrs.avatar_field){filters[fieldName]=filters[fieldName]||{'title':fields[fieldName].string,'fieldName':fieldName,'filters':[],};filters[fieldName].avatar_field=child.attrs.avatar_field;filters[fieldName].avatar_model=fields[fieldName].relation;}
if(child.attrs.write_model){filters[fieldName]=filters[fieldName]||{'title':fields[fieldName].string,'fieldName':fieldName,'filters':[],};filters[fieldName].write_model=child.attrs.write_model;filters[fieldName].write_field=child.attrs.write_field;modelFilters.push(fields[fieldName].relation);}}});if(attrs.color){var fieldName=attrs.color;fieldNames.push(fieldName);filters[fieldName]={'title':fields[fieldName].string,'fieldName':fieldName,'filters':[],};if(fields[fieldName].relation){if(['res.users','res.partner'].indexOf(fields[fieldName].relation)!==-1){filters[fieldName].avatar_field='image_small';}
filters[fieldName].avatar_model=fields[fieldName].relation;}}
if(_.isEmpty(displayFields)){displayFields=fields.display_name?{'display_name':{}}:[];}
this.controllerParams.quickAddPop=(!('quick_add'in attrs)||utils.toBoolElse(attrs.quick_add+'',true));this.controllerParams.disableQuickCreate=params.disable_quick_create||!this.controllerParams.quickAddPop;this.controllerParams.formViewId=attrs.form_view_id?parseInt(attrs.form_view_id,10):false;if(!this.controllerParams.formViewId&&params.action){var formViewDescr=_.find(params.action.views,function(v){return v.type==='form';});if(formViewDescr){this.controllerParams.formViewId=formViewDescr.viewID;}}
this.controllerParams.readonlyFormViewId=!attrs.readonly_form_view_id||!utils.toBoolElse(attrs.readonly_form_view_id,true)?false:attrs.readonly_form_view_id;this.controllerParams.eventOpenPopup=utils.toBoolElse(attrs.event_open_popup||'',false);this.controllerParams.mapping=mapping;this.controllerParams.context=params.context||{};this.controllerParams.displayName=params.action&&params.action.name;this.rendererParams.displayFields=displayFields;this.rendererParams.eventTemplate=_.findWhere(arch.children,{'tag':'templates'});this.rendererParams.model=viewInfo.model;this.loadParams.fieldNames=_.uniq(fieldNames);this.loadParams.mapping=mapping;this.loadParams.fields=fields;this.loadParams.fieldsInfo=viewInfo.fieldsInfo;this.loadParams.editable=!fields[mapping.date_start].readonly;this.loadParams.creatable=true;this.loadParams.eventLimit=eventLimit;this.loadParams.fieldColor=attrs.color;this.loadParams.filters=filters;this.loadParams.mode=(params.context&&params.context.default_mode)||attrs.mode;this.loadParams.initialDate=moment(params.initialDate||(params.context&&params.context.initial_date)||new Date());},});return CalendarView;});;

/* /web/static/src/js/widgets/attach_document.js defined in bundle 'web.assets_backend' */
odoo.define('web.AttachDocument',function(require){"use static";var core=require('web.core');var framework=require('web.framework');var widgetRegistry=require('web.widget_registry');var Widget=require('web.Widget');var _t=core._t;var AttachDocument=Widget.extend({template:'AttachDocument',events:{'click':'_onClickAttachDocument','change input.o_input_file':'_onFileChanged',},init:function(parent,record,nodeInfo){this._super.apply(this,arguments);this.res_id=record.res_id;this.res_model=record.model;this.state=record;this.node=nodeInfo;this.fileuploadID=_.uniqueId('o_fileupload');},start:function(){$(window).on(this.fileuploadID,this._onFileLoaded.bind(this));return this._super.apply(this,arguments);},destroy:function(){$(window).off(this.fileuploadID);this._super.apply(this,arguments);},_notifyInvalidFields:function(invalidFields){var fields=this.state.fields;var warnings=invalidFields.map(function(fieldName){var fieldStr=fields[fieldName].string;return _.str.sprintf('<li>%s</li>',_.escape(fieldStr));});warnings.unshift('<ul>');warnings.push('</ul>');this.do_warn(_t("The following fields are invalid:"),warnings.join(''));},_onClickAttachDocument:function(ev){if($(ev.target).is('input.o_input_file')){return;}
var fieldNames=this.getParent().canBeSaved(this.state.id);if(fieldNames.length){return this._notifyInvalidFields(fieldNames);}
if(!this.res_id){return this.do_warn(_t('Warning : You have to save first before attaching a file.'));}
this.$('input.o_input_file').trigger('click');},_onFileChanged:function(ev){ev.stopPropagation();this.$('form.o_form_binary_form').trigger('submit');framework.blockUI();},_onFileLoaded:function(){var self=this,def=$.Deferred();if(self.node.attrs.action){var files=Array.prototype.slice.call(arguments,1);self._rpc({model:self.res_model,method:self.node.attrs.action,args:[self.res_id],kwargs:{'attachment_ids':_.map(files,function(file){return file.id;}),}}).then(function(){def.resolve();});}else{def.resolve();}
return $.when(def).then(function(){self.trigger_up('reload');framework.unblockUI();});},});widgetRegistry.add('attach_document',AttachDocument);});;

/* /web/static/src/js/report/utils.js defined in bundle 'web.assets_backend' */
odoo.define('report.utils',function(require){'use strict';function get_protocol_from_url(url){var a=document.createElement('a');a.href=url;return a.protocol;}
function get_host_from_url(url){var a=document.createElement('a');a.href=url;return a.host;}
function build_origin(protocol,host){return protocol+'//'+host;}
return{'get_protocol_from_url':get_protocol_from_url,'get_host_from_url':get_host_from_url,'build_origin':build_origin,};});;

/* /web/static/src/js/report/client_action.js defined in bundle 'web.assets_backend' */
odoo.define('report.client_action',function(require){'use strict';var AbstractAction=require('web.AbstractAction');var config=require('web.config');var core=require('web.core');var ControlPanelMixin=require('web.ControlPanelMixin');var session=require('web.session');var utils=require('report.utils');var QWeb=core.qweb;var AUTHORIZED_MESSAGES=['report.editor:save_ok','report.editor:discard_ok','report:do_action',];var ReportAction=AbstractAction.extend(ControlPanelMixin,{template:'report.client_action',init:function(parent,action,options){this._super.apply(this,arguments);options=options||{};this.action_manager=parent;this.title=options.display_name||options.name;this.edit_mode_available=false;this.in_edit_mode=false;this.report_url=options.report_url;this.report_name=options.report_name;this.report_file=options.report_file;this.data=options.data||{};this.context=options.context||{};},start:function(){var self=this;this.set('title',this.title);this.iframe=this.$('iframe')[0];return $.when(this._super.apply(this,arguments),session.is_bound).then(function(){var web_base_url=session['web.base.url'];var trusted_host=utils.get_host_from_url(web_base_url);var trusted_protocol=utils.get_protocol_from_url(web_base_url);self.trusted_origin=utils.build_origin(trusted_protocol,trusted_host);self.$buttons=$(QWeb.render('report.client_action.ControlButtons',{}));self.$buttons.on('click','.o_report_edit',self.on_click_edit);self.$buttons.on('click','.o_report_print',self.on_click_print);self.$buttons.on('click','.o_report_save',self.on_click_save);self.$buttons.on('click','.o_report_discard',self.on_click_discard);self._update_control_panel();self.iframe.src=self.report_url;self.iframe.onload=function(){self._on_iframe_loaded();};});},do_show:function(){this._update_control_panel();return this._super.apply(this,arguments);},on_attach_callback:function(){$(window).on('message',this,this.on_message_received);},on_detach_callback:function(){$(window).off('message',this.on_message_received);},_on_iframe_loaded:function(){var editable=$(this.iframe).contents().find('html').data('editable');if(editable===1){this.edit_mode_available=true;this._update_control_panel();}},_update_control_panel:function(){this.update_control_panel({cp_content:{$buttons:this.$buttons,},});this._update_control_panel_buttons();},_update_control_panel_buttons:function(){this.$buttons.filter('div.o_report_edit_mode').toggle(this.in_edit_mode);this.$buttons.filter('div.o_report_no_edit_mode').toggle(!this.in_edit_mode);this.$buttons.filter('div.o_edit_mode_available').toggle(config.debug&&this.edit_mode_available&&!this.in_edit_mode);},on_message_received:function(ev){var message_origin=utils.build_origin(ev.originalEvent.source.location.protocol,ev.originalEvent.source.location.host);if(message_origin===this.trusted_origin){var message=ev.originalEvent.data;if(_.isObject(message)){message=message.message;}
if(!_.isString(message)||(_.isString(message)&&!_.contains(AUTHORIZED_MESSAGES,message))){return;}
switch(message){case'report.editor:save_ok':this.iframe.src=this.report_url;this.in_edit_mode=false;this._update_control_panel_buttons();break;case'report.editor:discard_ok':this.iframe.src=this.report_url;this.in_edit_mode=false;this._update_control_panel_buttons();break;case'report:do_action':return this.do_action(ev.originalEvent.data.action);default:}}},_post_message:function(message){this.iframe.contentWindow.postMessage(message,this.trusted_origin);},on_click_edit:function(){if(this.report_url.indexOf('?')===-1){this.iframe.src=this.report_url+'?enable_editor=1';}else{this.iframe.src=this.report_url+'&enable_editor=1';}
this.in_edit_mode=true;this._update_control_panel_buttons();},on_click_discard:function(){this._post_message('report.editor:ask_discard');},on_click_save:function(){this._post_message('report.editor:ask_save');},on_click_print:function(){var action={'type':'ir.actions.report','report_type':'qweb-pdf','report_name':this.report_name,'report_file':this.report_file,'data':this.data,'context':this.context,'display_name':this.title,};return this.do_action(action);},});core.action_registry.add('report.client_action',ReportAction);return ReportAction;});;

/* /base_import/static/lib/javascript-state-machine/state-machine.js defined in bundle 'web.assets_backend' */
(function(window){StateMachine={VERSION:"2.1.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,ASYNC:4,},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300,},WILDCARD:'*',ASYNC:'async',create:function(cfg,target){var initial=(typeof cfg.initial=='string')?{state:cfg.initial}:cfg.initial;var fsm=target||cfg.target||{};var events=cfg.events||[];var callbacks=cfg.callbacks||{};var map={};var add=function(e){var from=(e.from instanceof Array)?e.from:(e.from?[e.from]:[StateMachine.WILDCARD]);map[e.name]=map[e.name]||{};for(var n=0;n<from.length;n++)
map[e.name][from[n]]=e.to||from[n];};if(initial){initial.event=initial.event||'startup';add({name:initial.event,from:'none',to:initial.state});}
for(var n=0;n<events.length;n++)
add(events[n]);for(var name in map){if(map.hasOwnProperty(name))
fsm[name]=StateMachine.buildEvent(name,map[name]);}
for(var name in callbacks){if(callbacks.hasOwnProperty(name))
fsm[name]=callbacks[name]}
fsm.current='none';fsm.is=function(state){return this.current==state;};fsm.can=function(event){return!this.transition&&(map[event].hasOwnProperty(this.current)||map[event].hasOwnProperty(StateMachine.WILDCARD));}
fsm.cannot=function(event){return!this.can(event);};fsm.error=cfg.error||function(name,from,to,args,error,msg){throw msg;};if(initial&&!initial.defer)
fsm[initial.event]();return fsm;},doCallback:function(fsm,func,name,from,to,args){if(func){try{return func.apply(fsm,[name,from,to].concat(args));}
catch(e){return fsm.error(name,from,to,args,StateMachine.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function");}}},beforeEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onbefore'+name],name,from,to,args);},afterEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onafter'+name]||fsm['on'+name],name,from,to,args);},leaveState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onleave'+from],name,from,to,args);},enterState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onenter'+to]||fsm['on'+to],name,from,to,args);},changeState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onchangestate'],name,from,to,args);},buildEvent:function(name,map){return function(){var from=this.current;var to=map[from]||map[StateMachine.WILDCARD]||from;var args=Array.prototype.slice.call(arguments);if(this.transition)
return this.error(name,from,to,args,StateMachine.Error.PENDING_TRANSITION,"event "+name+" inappropriate because previous transition did not complete");if(this.cannot(name))
return this.error(name,from,to,args,StateMachine.Error.INVALID_TRANSITION,"event "+name+" inappropriate in current state "+this.current);if(false===StateMachine.beforeEvent(this,name,from,to,args))
return StateMachine.CANCELLED;if(from===to){StateMachine.afterEvent(this,name,from,to,args);return StateMachine.NOTRANSITION;}
var fsm=this;this.transition=function(){fsm.transition=null;fsm.current=to;StateMachine.enterState(fsm,name,from,to,args);StateMachine.changeState(fsm,name,from,to,args);StateMachine.afterEvent(fsm,name,from,to,args);};var leave=StateMachine.leaveState(this,name,from,to,args);if(false===leave){this.transition=null;return StateMachine.CANCELLED;}
else if("async"===leave){return StateMachine.ASYNC;}
else{if(this.transition)
this.transition();return StateMachine.SUCCEEDED;}};}};if("function"===typeof define){define("statemachine",[],function(){return StateMachine;});}
else{window.StateMachine=StateMachine;}}(this));;

/* /base_import/static/src/js/import_action.js defined in bundle 'web.assets_backend' */
odoo.define('base_import.import',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var ControlPanelMixin=require('web.ControlPanelMixin');var core=require('web.core');var session=require('web.session');var time=require('web.time');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var StateMachine=window.StateMachine;function jsonp(form,attributes,callback){attributes=attributes||{};var options={jsonp:_.uniqueId('import_callback_')};window[options.jsonp]=function(){delete window[options.jsonp];callback.apply(null,arguments);};if('data'in attributes){_.extend(attributes.data,options);}else{_.extend(attributes,{data:options});}
_.extend(attributes,{dataType:'script',});$(form).ajaxSubmit(attributes);}
function _make_option(term){return{id:term,text:term};}
function _from_data(data,term){return _.findWhere(data,{id:term})||_make_option(term);}
function dataFilteredQuery(q){var suggestions=_.clone(this.data);if(q.term){var exact=_.filter(suggestions,function(s){return s.id===q.term||s.text===q.term;});if(exact.length){suggestions=exact;}else{suggestions=[_make_option(q.term)].concat(_.filter(suggestions,function(s){return s.id.indexOf(q.term)!==-1||s.text.indexOf(q.term)!==-1}));}}
q.callback({results:suggestions});}
var DataImport=AbstractAction.extend(ControlPanelMixin,{template:'ImportView',opts:[{name:'encoding',label:_lt("Encoding:"),value:''},{name:'separator',label:_lt("Separator:"),value:''},{name:'quoting',label:_lt("Text Delimiter:"),value:'"'}],parse_opts_formats:[{name:'date_format',label:_lt("Date Format:"),value:''},{name:'datetime_format',label:_lt("Datetime Format:"),value:''},],parse_opts_separators:[{name:'float_thousand_separator',label:_lt("Thousands Separator:"),value:','},{name:'float_decimal_separator',label:_lt("Decimal Separator:"),value:'.'}],events:{'change .oe_import_file':'loaded_file','change input.oe_import_has_header, .js_import_options input':'settings_changed','change input.oe_import_advanced_mode':function(e){this.do_not_change_match=true;this['settings_changed']();},'click a.oe_import_toggle':function(e){e.preventDefault();this.$('.oe_import_options').toggle();},'click .oe_import_report a.oe_import_report_count':function(e){e.preventDefault();$(e.target).parent().toggleClass('oe_import_report_showmore');},'click .oe_import_moreinfo_action a':function(e){e.preventDefault();var action=JSON.parse($(e.target).attr('data-action'));action.views=_(action.views).map(function(view){var id=view[0],type=view[1];return[id,type!=='tree'?type:action.view_type==='form'?'list':'tree'];});this.do_action(_.extend(action,{target:'new',flags:{search_view:true,display_title:true,pager:true,list:{selectable:false}}}));},},init:function(parent,action){this._super.apply(this,arguments);this.action_manager=parent;this.res_model=action.params.model;this.parent_context=action.params.context||{};this.id=null;this.session=session;action.display_name=_t('Import a File');this.do_not_change_match=false;},willStart:function(){var self=this;return this._rpc({model:this.res_model,method:'get_import_templates',context:this.parent_context,}).then(function(result){self.importTemplates=result;});},start:function(){var self=this;this.setup_encoding_picker();this.setup_separator_picker();this.setup_float_format_picker();this.setup_date_format_picker();return $.when(this._super(),self.create_model().done(function(id){self.id=id;self.$('input[name=import_id]').val(id);self.renderButtons();var status={cp_content:{$buttons:self.$buttons},};self.update_control_panel(status);}));},create_model:function(){return this._rpc({model:'base_import.import',method:'create',args:[{res_model:this.res_model}],kwargs:{context:session.user_context},});},renderButtons:function(){var self=this;this.$buttons=$(QWeb.render("ImportView.buttons",this));this.$buttons.filter('.o_import_validate').on('click',this.validate.bind(this));this.$buttons.filter('.o_import_import').on('click',this.import.bind(this));this.$buttons.filter('.oe_import_file').on('click',function(){self.$('.oe_import_file').click();});this.$buttons.filter('.o_import_cancel').on('click',function(e){e.preventDefault();self.exit();});},setup_encoding_picker:function(){this.$('input.oe_import_encoding').select2({width:'160px',data:_.map(('utf-8 utf-16 windows-1252 latin1 latin2 big5 gb18030 shift_jis windows-1251 koir8_r').split(/\s+/),_make_option),query:dataFilteredQuery,initSelection:function($e,c){return c(_make_option($e.val()));}});},setup_separator_picker:function(){var data=[{id:',',text:_t("Comma")},{id:';',text:_t("Semicolon")},{id:'\t',text:_t("Tab")},{id:' ',text:_t("Space")}];this.$('input.oe_import_separator').select2({width:'160px',data:data,query:dataFilteredQuery,initSelection:function($e,c){c(_from_data(data,$e.val())||_make_option($e.val()))}});},setup_float_format_picker:function(){var data_decimal=[{id:',',text:_t("Comma")},{id:'.',text:_t("Dot")},];var data_digits=data_decimal.concat([{id:'',text:_t("No Separator")}]);this.$('input.oe_import_float_thousand_separator').select2({width:'160px',data:data_digits,query:dataFilteredQuery,initSelection:function($e,c){c(_from_data(data_digits,$e.val())||_make_option($e.val()))}});this.$('input.oe_import_float_decimal_separator').select2({width:'160px',data:data_decimal,query:dataFilteredQuery,initSelection:function($e,c){c(_from_data(data_decimal,$e.val())||_make_option($e.val()))}});},setup_date_format_picker:function(){var data=_(['YYYY-MM-DD','DD/MM/YY','DD/MM/YYYY','DD-MM-YYYY','DD-MMM-YY','DD-MMM-YYYY','MM/DD/YY','MM/DD/YYYY','MM-DD-YY','MM-DD-YYYY','DDMMYY','DDMMYYYY','YYMMDD','YYYYMMDD','YY/MM/DD','YYYY/MM/DD','MMDDYY','MMDDYYYY',]).map(_make_option);this.$('input.oe_import_date_format').select2({width:'160px',data:data,query:dataFilteredQuery,initSelection:function($e,c){c(_from_data(data,$e.val())||_make_option($e.val()));}})},import_options:function(){var self=this;var options={headers:this.$('input.oe_import_has_header').prop('checked'),advanced:this.$('input.oe_import_advanced_mode').prop('checked'),keep_matches:this.do_not_change_match,name_create_enabled_fields:{},};_(this.opts).each(function(opt){options[opt.name]=self.$('input.oe_import_'+opt.name).val();});_(this.parse_opts_formats).each(function(opt){options[opt.name]=time.moment_to_strftime_format(self.$('input.oe_import_'+opt.name).val());});_(this.parse_opts_separators).each(function(opt){options[opt.name]=self.$('input.oe_import_'+opt.name).val();});options['fields']=[];if(this.do_not_change_match){options['fields']=this.$('.oe_import_fields input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();}
this.do_not_change_match=false;this.$('input.o_import_create_option').each(function(){var field=this.getAttribute('field');if(field){options.name_create_enabled_fields[field]=this.checked;}});return options;},onfile_loaded:function(){this.$buttons.filter('.o_import_import, .o_import_validate').addClass('d-none');if(!this.$('input.oe_import_file').val()){return this['settings_changed']();}
this.$('.oe_import_date_format').select2('val','');this.$('.oe_import_datetime_format').val('');this.$el.removeClass('oe_import_preview oe_import_error');var import_toggle=false;var file=this.$('input.oe_import_file')[0].files[0];if((file.type&&_.last(file.type.split('/'))==="csv")||(_.last(file.name.split('.'))==="csv")){import_toggle=true;}
this.$el.find('.oe_import_box').toggle(import_toggle);jsonp(this.$el,{url:'/base_import/set_file'},this.proxy('settings_changed'));},onpreviewing:function(){var self=this;this.$buttons.filter('.o_import_import, .o_import_validate').addClass('d-none');this.$el.addClass('oe_import_with_file');this.$el.removeClass('oe_import_preview_error oe_import_error');this.$el.toggleClass('oe_import_noheaders text-muted',!this.$('input.oe_import_has_header').prop('checked'));self.$('input.oe_import_file').val('');this._rpc({model:'base_import.import',method:'parse_preview',args:[this.id,this.import_options()],kwargs:{context:session.user_context},}).done(function(result){var signal=result.error?'preview_failed':'preview_succeeded';self[signal](result);});},onpreview_error:function(event,from,to,result){this.$('.oe_import_options').show();this.$el.addClass('oe_import_preview_error oe_import_error');this.$el.find('.oe_import_box, .oe_import_with_file').removeClass('d-none');this.$el.find('.o_view_nocontent').addClass('d-none');this.$('.oe_import_error_report').html(QWeb.render('ImportView.preview.error',result));},onpreview_success:function(event,from,to,result){var self=this;this.$buttons.filter('.oe_import_file').text(_t('Load New File')).removeClass('btn-primary').addClass('btn-secondary').blur();this.$buttons.filter('.o_import_import, .o_import_validate').removeClass('d-none');this.$el.find('.oe_import_box, .oe_import_with_file').removeClass('d-none');this.$el.find('.o_view_nocontent').addClass('d-none');this.$el.addClass('oe_import_preview');this.$('input.oe_import_advanced_mode').prop('checked',result.advanced_mode);this.$('.oe_import_grid').html(QWeb.render('ImportView.preview',result));if(result.headers.length===1){this.$('.oe_import_options').show();this.onresults(null,null,null,{'messages':[{type:'warning',message:_t("A single column was found in the file, this often means the file separator is incorrect")}]});}
_.each(['encoding','separator','float_thousand_separator','float_decimal_separator'],function(id){self.$('.oe_import_'+id).select2('val',result.options[id])});this.$('.oe_import_date_format').select2('val',time.strftime_to_moment_format(result.options.date_format));this.$('.oe_import_datetime_format').val(time.strftime_to_moment_format(result.options.datetime_format));if(result.debug===false){this.$('.oe_import_tracking').hide();this.$('.oe_import_deferparentstore').hide();}
var $fields=this.$('.oe_import_fields input');this.render_fields_matches(result,$fields);var data=this.generate_fields_completion(result);var item_finder=function(id,items){items=items||data;for(var i=0;i<items.length;++i){var item=items[i];if(item.id===id){return item;}
var val;if(item.children&&(val=item_finder(id,item.children))){return val;}}
return'';};$fields.each(function(k,v){var filtered_data=self.generate_fields_completion(result,k);var $thing=$();var bind=function(d){};if(session.debug){$thing=$(QWeb.render('ImportView.create_record_option')).insertAfter(v).hide();bind=function(data){switch(data.type){case'many2one':case'many2many':$thing.find('input').attr('field',data.id);$thing.show();break;default:$thing.find('input').attr('field','').prop('checked',false);$thing.hide();}}}
$(v).select2({allowClear:true,minimumInputLength:0,data:filtered_data,initSelection:function(element,callback){var default_value=element.val();if(!default_value){callback('');return;}
var data=item_finder(default_value);bind(data);callback(data);},placeholder:_t('Don\'t import'),width:'resolve',dropdownCssClass:'oe_import_selector'}).on('change',function(e){bind(item_finder(e.currentTarget.value));});});},generate_fields_completion:function(root,index){var basic=[];var regulars=[];var o2m=[];var headers_type=root.headers_type;function traverse(field,ancestors,collection,type){var subfields=field.fields;var advanced_mode=self.$('input.oe_import_advanced_mode').prop('checked');var field_path=ancestors.concat(field);var label=_(field_path).pluck('string').join(' / ');var id=_(field_path).pluck('name').join('/');if(type===undefined||(type!==undefined&&(type.indexOf('all')!==-1||type.indexOf(field['type'])!==-1))){if(!collection){if(field.name==='id'){collection=basic;}else if(_.isEmpty(subfields)||_.isEqual(_.pluck(subfields,'name'),['id','.id'])){collection=regulars;}else{collection=o2m;}}
collection.push({id:id,text:label,required:field.required,type:field.type});}
if(advanced_mode){for(var i=0,end=subfields.length;i<end;++i){traverse(subfields[i],field_path,collection,type);}}}
_(root.fields).each(function(field){if(index===undefined){traverse(field,[]);}
else{if(self.$('input.oe_import_advanced_mode').prop('checked')){traverse(field,[],undefined,['all']);}
else{traverse(field,[],undefined,headers_type[index]);}}});var cmp=function(field1,field2){return field1.text.localeCompare(field2.text);};regulars.sort(cmp);o2m.sort(cmp);if(!_.isEmpty(regulars)&&!_.isEmpty(o2m)){basic=basic.concat([{text:_t("Normal Fields"),children:regulars},{text:_t("Relation Fields"),children:o2m},]);}
else if(!_.isEmpty(regulars)){basic=basic.concat(regulars);}
else if(!_.isEmpty(o2m)){basic=basic.concat(o2m);}
return basic;},render_fields_matches:function(result,$fields){if(_(result.matches).isEmpty()){return;}
$fields.each(function(index,input){var match=result.matches[index];if(!match){return;}
var current_field=result;input.value=_(match).chain().map(function(name){return current_field=_(current_field.fields).find(function(subfield){return subfield.name===name;});}).pluck('name').value().join('/');});},call_import:function(kwargs){var fields=this.$('.oe_import_fields input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();var columns=this.$('.oe_import_grid-header .oe_import_grid-cell .o_import_header_name').map(function(){return $(this).text().trim().toLowerCase()||false;}).get();var tracking_disable='tracking_disable'in kwargs?kwargs.tracking_disable:!this.$('#oe_import_tracking').prop('checked')
var defer_parent_store='defer_parent_store'in kwargs?kwargs.defer_parent_store:!!this.$('#oe_import_deferparentstore').prop('checked')
delete kwargs.tracking_disable;delete kwargs.defer_parent_store;kwargs.context=_.extend({},this.parent_context,{tracking_disable:tracking_disable,defer_parent_store_computation:defer_parent_store});return this._rpc({model:'base_import.import',method:'do',args:[this.id,fields,columns,this.import_options()],kwargs:kwargs,}).then(null,function(error,event){if(event){event.preventDefault();}
var msg;if(error.data.type==='xhrerror'){var xhr=error.data.objects[0];switch(xhr.status){case 504:msg=_t("Import timed out. Please retry. If you still encounter this issue, the file may be too big for the system's configuration, try to split it (import less records per file).");break;default:msg=_t("An unknown issue occurred during import (possibly lost connection, data limit exceeded or memory limits exceeded). Please retry in case the issue is transient. If the issue still occurs, try to split the file rather than import it at once.");}}else{msg=(error.data.arguments&&error.data.arguments[1]||error.data.arguments[0])||error.message;}
return $.when({'messages':[{type:'error',record:false,message:msg,}]});});},onvalidate:function(){return this.call_import({dryrun:true,tracking_disable:true}).done(this.proxy('validated'));},onimport:function(){var self=this;return this.call_import({dryrun:false}).done(function(results){var message=results.messages;if(!_.any(message,function(message){return message.type==='error';})){self['import_succeeded'](results);return;}
self['import_failed'](results);});},onimported:function(event,from,to,results){this.do_notify(_t("Import completed"),_.str.sprintf(_t("%d records were successfully imported"),results.ids.length));this.exit();},exit:function(){this.trigger_up('history_back');},onresults:function(event,from,to,results){var message=results.messages;var no_messages=_.isEmpty(message);if(no_messages){message.push({type:'info',message:_t("Everything seems valid.")});}
var offset=1;if(this.import_options().headers){offset+=1;}
this.$el.addClass('oe_import_error');this.$('.oe_import_error_report').html(QWeb.render('ImportView.error',{errors:_(message).groupBy('message'),at:function(rows){var from=rows.from+offset;var to=rows.to+offset;if(from===to){return _.str.sprintf(_t("at row %d"),from);}
return _.str.sprintf(_t("between rows %d and %d"),from,to);},more:function(n){return _.str.sprintf(_t("(%d more)"),n);},info:function(msg){if(typeof msg==='string'){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_message">%s</div>',_.str.escapeHTML(msg));}
if(msg instanceof Array){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_choices">%s <ul>%s</ul></div>',_.str.escapeHTML(_t("Here are the possible values:")),_(msg).map(function(msg){return'<li>'
+_.str.escapeHTML(msg)
+'</li>';}).join(''));}
return['<div class="oe_import_moreinfo oe_import_moreinfo_action">',_.str.sprintf('<a href="#" data-action="%s">',_.str.escapeHTML(JSON.stringify(msg))),_.str.escapeHTML(_t("Get all possible values")),'</a>','</div>'].join('');},}));},});core.action_registry.add('import',DataImport);StateMachine.create({target:DataImport.prototype,events:[{name:'loaded_file',from:['none','file_loaded','preview_error','preview_success','results'],to:'file_loaded'},{name:'settings_changed',from:['file_loaded','preview_error','preview_success','results'],to:'previewing'},{name:'preview_failed',from:'previewing',to:'preview_error'},{name:'preview_succeeded',from:'previewing',to:'preview_success'},{name:'validate',from:'preview_success',to:'validating'},{name:'validate',from:'results',to:'validating'},{name:'validated',from:'validating',to:'results'},{name:'import',from:['preview_success','results'],to:'importing'},{name:'import_succeeded',from:'importing',to:'imported'},{name:'import_failed',from:'importing',to:'results'}],});return{DataImport:DataImport,};});;

/* /base_import/static/src/js/import_buttons.js defined in bundle 'web.assets_backend' */
odoo.define('base_import.import_buttons',function(require){"use strict";var config=require('web.config');var KanbanController=require('web.KanbanController');var KanbanView=require('web.KanbanView');var ListController=require('web.ListController');var ListView=require('web.ListView');var ImportViewMixin={init:function(viewInfo,params){var importEnabled='import_enabled'in params?params.import_enabled:true;this.controllerParams.importEnabled=importEnabled&&!config.device.isMobile;},};var ImportControllerMixin={init:function(parent,model,renderer,params){this.importEnabled=params.importEnabled;},_bindImport:function(){if(!this.$buttons){return;}
var self=this;this.$buttons.on('click','.o_button_import',function(){var state=self.model.get(self.handle,{raw:true});self.do_action({type:'ir.actions.client',tag:'import',params:{model:self.modelName,context:state.getContext(),}});});}};ListView.include({init:function(){this._super.apply(this,arguments);ImportViewMixin.init.apply(this,arguments);},});ListController.include({init:function(){this._super.apply(this,arguments);ImportControllerMixin.init.apply(this,arguments);},renderButtons:function(){this._super.apply(this,arguments);ImportControllerMixin._bindImport.call(this);}});KanbanView.include({init:function(){this._super.apply(this,arguments);ImportViewMixin.init.apply(this,arguments);},});KanbanController.include({init:function(){this._super.apply(this,arguments);ImportControllerMixin.init.apply(this,arguments);},renderButtons:function(){this._super.apply(this,arguments);ImportControllerMixin._bindImport.call(this);}});});;

/* /web_diagram/static/src/js/vec2.js defined in bundle 'web.assets_backend' */
(function(window){function Vec2(x,y){this.x=x;this.y=y;}
window.Vec2=Vec2;var rad2deg=57.29577951308232;var deg2rad=0.017453292519943295;var epsilon=0.0000001;Vec2.new_polar_deg=function(len,angle){var v=new Vec2(len,0);return v.rotate_deg(angle);};Vec2.new_polar=function(len,angle){var v=new Vec2(len,0);v.rotate(angle);return v;};Vec2.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y);};Vec2.prototype.len_sq=function(){return this.x*this.x+this.y*this.y;};Vec2.prototype.dist=function(v){var dx=this.x-v.x;var dy=this.y-v.y;return Math.sqrt(dx*dx+dy*dy);};Vec2.prototype.dist_xy=function(x,y){var dx=this.x-x;var dy=this.y-y;return Math.sqrt(dx*dx+dy*dy);};Vec2.prototype.dist_sq=function(v){var dx=this.x-v.x;var dy=this.y-v.y;return dx*dx+dy*dy;};Vec2.prototype.dist_sq_xy=function(x,y){var dx=this.x-x;var dy=this.y-y;return dx*dx+dy*dy;};Vec2.prototype.dot=function(v){return this.x*v.x+this.y*v.y;};Vec2.prototype.dot_xy=function(x,y){return this.x*x+this.y*y;};Vec2.prototype.clone=function(){return new Vec2(this.x,this.y);};Vec2.prototype.add=function(v){return new Vec2(this.x+v.x,this.y+v.y);};Vec2.prototype.add_xy=function(x,y){return new Vec2(this.x+x,this.y+y);};Vec2.prototype.sub=function(v){return new Vec2(this.x-v.x,this.y-v.y);};Vec2.prototype.sub_xy=function(x,y){return new Vec2(this.x-x,this.y-y);};Vec2.prototype.mult=function(v){return new Vec2(this.x*v.x,this.y*v.y);};Vec2.prototype.mult_xy=function(x,y){return new Vec2(this.x*x,this.y*y);};Vec2.prototype.scale=function(f){return new Vec2(this.x*f,this.y*f);};Vec2.prototype.neg=function(f){return new Vec2(-this.x,-this.y);};Vec2.prototype.normalize=function(){var len=this.len();if(len==0){return new Vec2(0,1);}else if(len!=1){return this.scale(1.0/len);}
return new Vec2(this.x,this.y);};Vec2.prototype.set_len=function(l){return this.normalize().scale(l);};Vec2.prototype.project=function(v){return v.set_len(this.dot(v));};Vec2.prototype.toString=function(){var str="";str+="[";str+=this.x;str+=",";str+=this.y;str+="]";return str;};Vec2.prototype.rotate=function(rad){var c=Math.cos(rad);var s=Math.sin(rad);var px=this.x*c-this.y*s;var py=this.x*s+this.y*c;return new Vec2(px,py);};Vec2.prototype.rotate_deg=function(deg){return this.rotate(deg*deg2rad);};Vec2.prototype.lerp=function(v,alpha){var inv_alpha=1-alpha;return new Vec2(this.x*inv_alpha+v.x*alpha,this.y*inv_alpha+v.y*alpha);};Vec2.prototype.angle=function(){return Math.atan2(this.y,this.x);};Vec2.prototype.angle_deg=function(){return Math.atan2(this.y,this.x)*rad2deg;};Vec2.prototype.equals=function(v){if(Math.abs(this.x-v.x)>epsilon){return false;}else if(Math.abs(this.y-v.y)>epsilon){return false;}
return true;};Vec2.prototype.equals_xy=function(x,y){if(Math.abs(this.x-x)>epsilon){return false;}else if(Math.abs(this.y-y)>epsilon){return false;}
return true;};})(window);(function(window){function BEllipse(cx,cy,rx,ry){this.type='ellipse';this.x=cx-rx;this.y=cy-ry;this.sx=2*rx;this.sy=2*ry;this.hx=rx;this.hy=ry;this.cx=cx;this.cy=cy;this.mx=cx+rx;this.my=cy+ry;}
window.BEllipse=BEllipse;BEllipse.prototype.collide_segment=function(a,b){var collisions=[];if(a.equals(b)){return collisions;}
var c=new Vec2(this.cx,this.cy);a=a.sub(c).mult_xy(1/this.hx,1/this.hy);b=b.sub(c).mult_xy(1/this.hx,1/this.hy);if(a.len_sq()<1&&b.len_sq()<1){return collisions;}
var ab=b.sub(a);var A=(ab.x*ab.x+ab.y*ab.y);var B=2*(ab.x*a.x+ab.y*a.y);var C=a.x*a.x+a.y*a.y-1;var u=B*B-4*A*C;if(u<0){return collisions;}
u=Math.sqrt(u);var u1=(-B+u)/(2*A);var u2=(-B-u)/(2*A);if(u1>=0&&u1<=1){var pos=a.add(ab.scale(u1));collisions.push(pos);}
if(u1!=u2&&u2>=0&&u2<=1){var pos=a.add(ab.scale(u2));collisions.push(pos);}
for(var i=0;i<collisions.length;i++){collisions[i]=collisions[i].mult_xy(this.hx,this.hy);collisions[i]=collisions[i].add_xy(this.cx,this.cy);}
return collisions;};function BRect(x,y,sx,sy){this.type='rect';this.x=x;this.y=y;this.sx=sx;this.sy=sy;this.hx=sx/2;this.hy=sy/2;this.cx=x+this.hx;this.cy=y+this.hy;this.mx=x+sx;this.my=y+sy;}
window.BRect=BRect;BRect.new_centered=function(cx,cy,sx,sy){return new BRect(cx-sx/2,cy-sy/2,sx,sy);};function line_intersect(a,b,c,d){var f=((d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y));if(f==0){return null;}
f=1/f;var fab=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))*f;if(fab<0||fab>1){return null;}
var fcd=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))*f;if(fcd<0||fcd>1){return null;}
return new Vec2(a.x+fab*(b.x-a.x),a.y+fab*(b.y-a.y));}
BRect.prototype.collide_segment=function(a,b){var collisions=[];var corners=[new Vec2(this.x,this.y),new Vec2(this.x,this.my),new Vec2(this.mx,this.my),new Vec2(this.mx,this.y)];var pos=line_intersect(a,b,corners[0],corners[1]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[1],corners[2]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[2],corners[3]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[3],corners[0]);if(pos)collisions.push(pos);return collisions;};BRect.prototype.contains_vec=function(vec){return(vec.x>=this.x&&vec.x<=this.mx&&vec.y>=this.y&&vec.y<=this.my);};BRect.prototype.contains_xy=function(x,y){return(x>=this.x&&x<=this.mx&&y>=this.y&&y<=this.my);};BEllipse.prototype.contains_vec=function(v){v=v.mult_xy(this.hx,this.hy);return v.len_sq()<=1;};BEllipse.prototype.contains_xy=function(x,y){return this.contains(new Vec2(x,y));};})(window);;

/* /web_diagram/static/src/js/graph.js defined in bundle 'web.assets_backend' */
(function(window){function EdgeEnd(pos_x,pos_y){this.x=pos_x;this.y=pos_y;this.get_pos=function(){return new Vec2(this.x,this.y);}}
function CloseButton(graph,entity,entity_type,pos_x,pos_y){var self=this;var visible=false;var close_button_radius=graph.style.close_button_radius||8;var close_circle=graph.r.circle(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,close_button_radius);close_circle.attr({'opacity':0,'fill':graph.style.close_button_color||"black",'cursor':'pointer','stroke':'none'});close_circle.transform(graph.get_transform());graph.set_scrolling(close_circle);var close_label=graph.r.text(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,"x");close_label.attr({'fill':graph.style.close_button_x_color||"white",'font-size':close_button_radius,'cursor':'pointer'});close_label.transform(graph.get_transform());graph.set_scrolling(close_label);var dummy_circle=graph.r.circle(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,close_button_radius);dummy_circle.attr({'opacity':1,'fill':'transparent','stroke':'none','cursor':'pointer'});dummy_circle.transform(graph.get_transform());graph.set_scrolling(dummy_circle);this.get_pos=function(){return entity.get_pos().add_xy(pos_x,pos_y);};this.update_pos=function(){var pos=self.get_pos();close_circle.attr({'cx':pos.x,'cy':pos.y});dummy_circle.attr({'cx':pos.x,'cy':pos.y});close_label.attr({'x':pos.x,'y':pos.y});};function hover_in(){if(!visible){return;}
close_circle.animate({'r':close_button_radius*1.5},300,'elastic');dummy_circle.animate({'r':close_button_radius*1.5},300,'elastic');}
function hover_out(){if(!visible){return;}
close_circle.animate({'r':close_button_radius},400,'linear');dummy_circle.animate({'r':close_button_radius},400,'linear');}
dummy_circle.hover(hover_in,hover_out);close_circle.hover(hover_in,hover_out);close_label.hover(hover_in,hover_out);function click_action(){if(!visible){return;}
close_circle.attr({'r':close_button_radius*2});dummy_circle.attr({'r':close_button_radius*2});close_circle.animate({'r':close_button_radius},400,'linear');dummy_circle.animate({'r':close_button_radius},400,'linear');if(entity_type=="node"){$.when(GraphNode.destruction_callback(entity)).done(function(){entity.remove();});}else if(entity_type=="edge"){$.when(GraphEdge.destruction_callback(entity)).done(function(){entity.remove();});}}
dummy_circle.click(click_action);close_circle.click(click_action);close_label.click(click_action);this.show=function(){if(!visible){close_circle.animate({'opacity':1},100,'linear');close_label.animate({'opacity':1},100,'linear');visible=true;}}
this.hide=function(){if(visible){close_circle.animate({'opacity':0},100,'linear');close_label.animate({'opacity':0},100,'linear');visible=false;}}
this.remove=function(){if(visible){visible=false;close_circle.animate({'opacity':0},100,'linear');close_label.animate({'opacity':0},100,'linear',self.remove);}else{close_circle.remove();close_label.remove();dummy_circle.remove();}}}
function Connector(graph,node,pos_x,pos_y){var visible=false;var conn_circle=graph.r.circle(node.get_pos().x+pos_x,node.get_pos().y+pos_y,4);conn_circle.attr({'opacity':0,'fill':graph.style.node_outline_color,'stroke':'none'});conn_circle.transform(graph.get_transform());graph.set_scrolling(conn_circle);var self=this;this.update_pos=function(){conn_circle.attr({'cx':node.get_pos().x+pos_x,'cy':node.get_pos().y+pos_y});};this.get_pos=function(){return new node.get_pos().add_xy(pos_x,pos_y);};this.remove=function(){conn_circle.remove();}
function hover_in(){if(!visible){return;}
conn_circle.animate({'r':8},300,'elastic');if(graph.creating_edge){graph.target_node=node;conn_circle.animate({'fill':graph.style.connector_active_color,'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_selected_width,},100,'linear');}}
function hover_out(){if(!visible){return;}
conn_circle.animate({'r':graph.style.connector_radius,'fill':graph.style.node_outline_color,'stroke':'none'},400,'linear');graph.target_node=null;}
conn_circle.hover(hover_in,hover_out);var drag_down=function(){if(!visible){return;}
self.ox=conn_circle.attr("cx");self.oy=conn_circle.attr("cy");self.edge_start=new EdgeEnd(self.ox,self.oy);self.edge_end=new EdgeEnd(self.ox,self.oy);self.edge_tmp=new GraphEdge(graph,'',self.edge_start,self.edge_end,true);graph.creating_edge=true;};var drag_move=function(dx,dy){if(!visible){return;}
self.edge_end.x=self.ox+dx;self.edge_end.y=self.oy+dy;self.edge_tmp.update();};var drag_up=function(){if(!visible){return;}
graph.creating_edge=false;self.edge_tmp.remove();if(graph.target_node){var edge_prop=GraphEdge.creation_callback(node,graph.target_node);if(edge_prop){var new_edge=new GraphEdge(graph,edge_prop.label,node,graph.target_node);GraphEdge.new_edge_callback(new_edge);}}};conn_circle.drag(drag_move,drag_down,drag_up);function show(){if(!visible){conn_circle.animate({'opacity':1},100,'linear');visible=true;}}
function hide(){if(visible){conn_circle.animate({'opacity':0},100,'linear');visible=false;}}
this.show=show;this.hide=hide;}
function Graph(r,style,viewport){var self=this;var nodes=[];var edges=[];var graph={};var links={};var uid=1;var selected_entity=null;self.creating_edge=false;self.target_node=null;self.r=r;self.style=style;var tr_x=0,tr_y=0;var background=r.rect(0,0,'100%','100%').attr({'fill':'white','stroke':'none','opacity':0,'cursor':'move'});this.get_transform=function(){return"T"+tr_x+","+tr_y};var translate_all=function(dx,dy){tr_x+=dx;tr_y+=dy;var tstr=self.get_transform();r.forEach(function(el){if(el!=background){el.transform(tstr);}});};var get_bounds=function(){var minx=Number.MAX_VALUE;var miny=Number.MAX_VALUE;var maxx=Number.MIN_VALUE;var maxy=Number.MIN_VALUE;for(var i=0;i<nodes.length;i++){var pos=nodes[i].get_pos();minx=Math.min(minx,pos.x);miny=Math.min(miny,pos.y);maxx=Math.max(maxx,pos.x);maxy=Math.max(maxy,pos.y);}
minx=minx-style.node_size_x/2+tr_x;miny=miny-style.node_size_y/2+tr_y;maxx=maxx+style.node_size_x/2+tr_x;maxy=maxy+style.node_size_y/2+tr_y;return{minx:minx,miny:miny,maxx:maxx,maxy:maxy};};var translation_respects_viewport=function(dx,dy,margin){if(!viewport){return true;}
margin=margin||0;var b=get_bounds();var width=viewport.offsetWidth;var height=viewport.offsetHeight;if((dy<0&&b.maxy+dy<margin)||(dy>0&&b.miny+dy>height-margin)||(dx<0&&b.maxx+dx<margin)||(dx>0&&b.minx+dx>width-margin)){return false;}
return true;}
this.set_scrolling=function(raph_element){$(raph_element.node).bind('mousewheel',function(event,delta){var dy=delta*20;if(translation_respects_viewport(0,dy,style.viewport_margin)){translate_all(0,dy);}});};var px,py;var bg_drag_down=function(){px=py=0;};var bg_drag_move=function(x,y){var dx=x-px;var dy=y-py;px=x;py=y;if(translation_respects_viewport(dx,dy,style.viewport_margin)){translate_all(dx,dy);}};var bg_drag_up=function(){};background.drag(bg_drag_move,bg_drag_down,bg_drag_up);this.set_scrolling(background);this.add_node=function(n){nodes.push(n);n.uid=uid++;};this.get_node_list=function(){return nodes;};this.add_edge=function(n1,n2,e){edges.push(e);e.uid=uid++;if(!graph[n1.uid])graph[n1.uid]={};if(!graph[n1.uid][n2.uid])graph[n1.uid][n2.uid]=[];if(!links[n1.uid])links[n1.uid]=[];if(!links[n2.uid])links[n2.uid]=[];graph[n1.uid][n2.uid].push(e);links[n1.uid].push(e);if(n1!=n2){links[n2.uid].push(e);}};this.remove_edge=function(edge){edges=_.without(edges,edge);var n1=edge.get_start();var n2=edge.get_end();links[n1.uid]=_.without(links[n1.uid],edge);links[n2.uid]=_.without(links[n2.uid],edge);graph[n1.uid][n2.uid]=_.without(graph[n1.uid][n2.uid],edge);if(selected_entity==edge){selected_entity=null;}};this.remove_node=function(node){var linked_edges=self.get_linked_edge_list(node);for(var i=0;i<linked_edges.length;i++){linked_edges[i].remove();}
nodes=_.without(nodes,node);if(selected_entity==node){selected_entity=null;}}
this.get_edge_list=function(n1,n2){var list=[];if(!graph[n1.uid])return list;if(!graph[n1.uid][n2.uid])return list;return graph[n1.uid][n2.uid];};this.get_linked_edge_list=function(n){if(!links[n.uid])return[];return links[n.uid];};this.get_edge_curvature=function(n1,n2,e){var el_12=this.get_edge_list(n1,n2);var c12=el_12.length;var el_21=this.get_edge_list(n2,n1);var c21=el_21.length;if(c12+c21==1){return 0;}else{var index=0;for(var i=0;i<c12;i++){if(el_12[i].uid<e.uid){index++;}}
if(c21==0){return index-(c12-1)/2.0;}else{return index+0.5;}}};this.get_loop_angle=function(n,e){var loop_list=this.get_edge_list(n,n);var slots=[];for(var angle=0;angle<360;angle+=45){slots.push(Vec2.new_polar_deg(1,angle));}
var links=this.get_linked_edge_list(n);for(var i=0;i<links.length;i++){var edge=links[i];if(!edge.is_loop||edge.is_loop()){continue;}
var end=edge.get_end();if(end==n){end=edge.get_start();}
var dir=end.get_pos().sub(n.get_pos()).normalize();for(var s=0;s<slots.length;s++){var score=slots[s].dot(dir);if(score<0){score=-0.2*Math.pow(score,2);}else{score=Math.pow(score,2);}
if(!slots[s].score){slots[s].score=score;}else{slots[s].score+=score;}}}
slots.sort(function(a,b){return a.score<b.score?-1:1;});var index=0;for(var i=0;i<links.length;i++){var edge=links[i];if(!edge.is_loop||!edge.is_loop()){continue;}
if(edge.uid<e.uid){index++;}}
index%=slots.length;return slots[index].angle_deg();}
this.select=function(entity){if(selected_entity){if(selected_entity==entity){return;}else{if(selected_entity.set_not_selected){selected_entity.set_not_selected();}
selected_entity=null;}}
selected_entity=entity;if(entity&&entity.set_selected){entity.set_selected();}};}
function GraphNode(graph,pos_x,pos_y,label,type,color){var self=this;var r=graph.r;var sy=graph.style.node_size_y;var sx=graph.style.node_size_x;var node_fig=null;var selected=false;this.connectors=[];this.close_button=null;this.uid=0;graph.add_node(this);if(type=='circle'){node_fig=r.ellipse(pos_x,pos_y,sx/2,sy/2);}else{node_fig=r.rect(pos_x-sx/2,pos_y-sy/2,sx,sy);}
node_fig.attr({'fill':color,'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_outline_width,'cursor':'pointer'});node_fig.transform(graph.get_transform());graph.set_scrolling(node_fig);var node_label=r.text(pos_x,pos_y,label);node_label.attr({'fill':graph.style.node_label_color,'font-size':graph.style.node_label_font_size,'cursor':'pointer'});node_label.transform(graph.get_transform());graph.set_scrolling(node_label);var update_linked_edges=function(){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].update();}};var set_pos=function(pos){if(type=='circle'){node_fig.attr({'cx':pos.x,'cy':pos.y});}else{node_fig.attr({'x':pos.x-sx/2,'y':pos.y-sy/2});}
node_label.attr({'x':pos.x,'y':pos.y});for(var i=0;i<self.connectors.length;i++){self.connectors[i].update_pos();}
if(self.close_button){self.close_button.update_pos();}
update_linked_edges();};var get_fig=function(){return node_fig;};var get_pos=function(){if(type=='circle'){return new Vec2(node_fig.attr('cx'),node_fig.attr('cy'));}else{return new Vec2(node_fig.attr('x')+sx/2,node_fig.attr('y')+sy/2);}};var get_label=function(){return node_label.attr("text");};var set_label=function(text){node_label.attr({'text':text});};var get_bound=function(){if(type=='circle'){return new BEllipse(get_pos().x,get_pos().y,sx/2,sy/2);}else{return BRect.new_centered(get_pos().x,get_pos().y,sx,sy);}};var set_selected=function(){if(!selected){selected=true;node_fig.attr({'stroke':graph.style.node_selected_color,'stroke-width':graph.style.node_selected_width});if(!self.close_button){self.close_button=new CloseButton(graph,self,"node",sx/2,-sy/2);self.close_button.show();}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].show();}}};var set_not_selected=function(){if(selected){node_fig.animate({'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_outline_width},100,'linear');if(self.close_button){self.close_button.remove();self.close_button=null;}
selected=false;}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].hide();}};var remove=function(){if(self.close_button){self.close_button.remove();}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].remove();}
graph.remove_node(self);node_fig.remove();node_label.remove();}
this.set_pos=set_pos;this.get_pos=get_pos;this.set_label=set_label;this.get_label=get_label;this.get_bound=get_bound;this.get_fig=get_fig;this.set_selected=set_selected;this.set_not_selected=set_not_selected;this.update_linked_edges=update_linked_edges;this.remove=remove;var click_action=function(){if(type=='circle'){node_fig.attr({'rx':sx/2+3,'ry':sy/2+3});node_fig.animate({'rx':sx/2,'ry':sy/2},500,'elastic');}else{var cx=get_pos().x;var cy=get_pos().y;node_fig.attr({'x':cx-(sx/2)-3,'y':cy-(sy/2)-3,'ẃidth':sx+6,'height':sy+6});node_fig.animate({'x':cx-sx/2,'y':cy-sy/2,'ẃidth':sx,'height':sy},500,'elastic');}
graph.select(self);};node_fig.click(click_action);node_label.click(click_action);var drag_down=function(){this.opos=get_pos();};var drag_move=function(dx,dy){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].label_disable();}
if(self.close_button){self.close_button.hide();}
set_pos(this.opos.add_xy(dx,dy));};var drag_up=function(){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].label_enable();}
if(self.close_button){self.close_button.show();}};node_fig.drag(drag_move,drag_down,drag_up);node_label.drag(drag_move,drag_down,drag_up);function hover_in(){if(graph.creating_edge){graph.target_node=self;}}
function hover_out(){graph.target_node=null;}
node_fig.hover(hover_in,hover_out);node_label.hover(hover_in,hover_out);function double_click(){GraphNode.double_click_callback(self);}
node_fig.dblclick(double_click);node_label.dblclick(double_click);this.connectors.push(new Connector(graph,this,-sx/2,0));this.connectors.push(new Connector(graph,this,sx/2,0));this.connectors.push(new Connector(graph,this,0,-sy/2));this.connectors.push(new Connector(graph,this,0,sy/2));this.close_button=new CloseButton(graph,this,"node",sx/2,-sy/2);}
GraphNode.double_click_callback=function(node){console.log("double click from node:",node);};GraphNode.destruction_callback=function(node){return true;};function GraphEdge(graph,label,start,end,tmp){var self=this;var r=graph.r;var curvature=0;var s,e;var mc;var mc1,mc2;var elfs=graph.style.edge_label_font_size||10;var label_enabled=true;this.uid=0;var edge_path="";var selected=false;if(!tmp){graph.add_edge(start,end,this);}
function get_label_pos(path){var cpos=path.getTotalLength()*0.5;var cindex=Math.abs(Math.floor(curvature));var mod=((cindex%3))*(elfs*3.1)-(elfs*0.5);var verticality=Math.abs(end.get_pos().sub(start.get_pos()).normalize().dot_xy(0,1));verticality=Math.max(verticality-0.5,0)*2;var lpos=path.getPointAtLength(cpos+mod*verticality);return new Vec2(lpos.x,lpos.y-elfs*(1-verticality));}
this.get_pos=function(){if(!edge){return start.get_pos().lerp(end.get_pos(),0.5);}
return get_label_pos(edge);}
function make_line(){return"M"+s.x+","+s.y+"L"+e.x+","+e.y;}
function make_curve(){return"M"+s.x+","+s.y+"Q"+mc.x+","+mc.y+" "+e.x+","+e.y;}
function make_loop(){return"M"+s.x+" "+s.y+"C"+mc1.x+" "+mc1.y+" "+mc2.x+" "+mc2.y+" "+e.x+" "+e.y;}
function update_curve(){if(start!=end){if(!tmp){curvature=graph.get_edge_curvature(start,end,self);}else{curvature=0;}
s=start.get_pos();e=end.get_pos();mc=s.lerp(e,0.5);var se=e.sub(s);se=se.normalize();se=se.rotate_deg(-90);se=se.scale(curvature*graph.style.edge_spacing);mc=mc.add(se);if(start.get_bound){var col=start.get_bound().collide_segment(s,mc);if(col.length>0){s=col[0];}}
if(end.get_bound){var col=end.get_bound().collide_segment(mc,e);if(col.length>0){e=col[0];}}
if(curvature!=0){edge_path=make_curve();}else{edge_path=make_line();}}else{var rad=graph.style.edge_loop_radius||100;s=start.get_pos();e=end.get_pos();var r=Vec2.new_polar_deg(rad,graph.get_loop_angle(start,self));mc=s.add(r);var p=r.rotate_deg(90);mc1=mc.add(p.set_len(rad*0.5));mc2=mc.add(p.set_len(-rad*0.5));if(start.get_bound){var col=start.get_bound().collide_segment(s,mc1);if(col.length>0){s=col[0];}
var col=start.get_bound().collide_segment(e,mc2);if(col.length>0){e=col[0];}}
edge_path=make_loop();}}
update_curve();var edge=r.path(edge_path).attr({'stroke':graph.style.edge_color,'stroke-width':graph.style.edge_width,'arrow-end':'block-wide-long','cursor':'pointer'}).insertBefore(graph.get_node_list()[0].get_fig());var labelpos=get_label_pos(edge);var edge_label=r.text(labelpos.x,labelpos.y-elfs,label).attr({'fill':graph.style.edge_label_color,'cursor':'pointer','font-size':elfs});edge.transform(graph.get_transform());graph.set_scrolling(edge);edge_label.transform(graph.get_transform());graph.set_scrolling(edge_label);if(!tmp){var edges_start=graph.get_linked_edge_list(start);var edges_end=graph.get_linked_edge_list(end);var edges=edges_start.length<edges_end.length?edges_start:edges_end;for(var i=0;i<edges.length;i++){if(edges[i]!=self){edges[i].update();}}}
function label_enable(){if(!label_enabled){label_enabled=true;edge_label.animate({'opacity':1},100,'linear');if(self.close_button){self.close_button.show();}
self.update();}}
function label_disable(){if(label_enabled){label_enabled=false;edge_label.animate({'opacity':0},100,'linear');if(self.close_button){self.close_button.hide();}}}
function update(){update_curve();edge.attr({'path':edge_path});if(label_enabled){var labelpos=get_label_pos(edge);edge_label.attr({'x':labelpos.x,'y':labelpos.y-14});}}
function remove(){edge.remove();edge_label.remove();if(!tmp){graph.remove_edge(self);}
if(start.update_linked_edges){start.update_linked_edges();}
if(start!=end&&end.update_linked_edges){end.update_linked_edges();}
if(self.close_button){self.close_button.remove();}}
this.set_selected=function(){if(!selected){selected=true;edge.attr({'stroke':graph.style.node_selected_color,'stroke-width':graph.style.node_selected_width});edge_label.attr({'fill':graph.style.node_selected_color});if(!self.close_button){self.close_button=new CloseButton(graph,self,"edge",0,30);self.close_button.show();}}};this.set_not_selected=function(){if(selected){selected=false;edge.animate({'stroke':graph.style.edge_color,'stroke-width':graph.style.edge_width},100,'linear');edge_label.animate({'fill':graph.style.edge_label_color},100,'linear');if(self.close_button){self.close_button.remove();self.close_button=null;}}};function click_action(){graph.select(self);}
edge.click(click_action);edge_label.click(click_action);function double_click_action(){GraphEdge.double_click_callback(self);}
edge.dblclick(double_click_action);edge_label.dblclick(double_click_action);this.label_enable=label_enable;this.label_disable=label_disable;this.update=update;this.remove=remove;this.is_loop=function(){return start==end;};this.get_start=function(){return start;};this.get_end=function(){return end;};}
GraphEdge.double_click_callback=function(edge){console.log("double click from edge:",edge);};GraphEdge.creation_callback=function(start,end){var edge_prop={};edge_prop.label='new edge!';return edge_prop;};GraphEdge.new_edge_callback=function(new_edge){};GraphEdge.destruction_callback=function(edge){return true;};function wordwrap(str,width){width=width||32;var cut=true;var brk='\n';if(!str){return str;}
var regex='.{1,'+width+'}(\\s|$)'+(cut?'|.{'+width+'}|.+$':'|\\S+?(\\s|$)');return str.match(new RegExp(regex,'g')).join(brk);}
window.CuteGraph=Graph;window.CuteNode=GraphNode;window.CuteEdge=GraphEdge;window.CuteGraph.wordwrap=wordwrap;})(window);;

/* /web_diagram/static/src/js/diagram_model.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.DiagramModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var DiagramModel=AbstractModel.extend({get:function(){return $.extend(true,{},{labels:this.labels,nodes:this.datanodes,edges:this.edges,node_model:this.node_model,parent_field:this.parent_field,res_id:this.res_id,connector_model:this.connector_model,connectors:this.connectors,});},load:function(params){this.modelName=params.modelName;this.res_id=params.res_id;this.node_model=params.node_model;this.connector_model=params.connector_model;this.connectors=params.connectors;this.nodes=params.nodes;this.visible_nodes=params.visible_nodes;this.invisible_nodes=params.invisible_nodes;this.node_fields_string=params.node_fields_string;this.connector_fields_string=params.connector_fields_string;this.labels=params.labels;return this._fetchDiagramInfo();},reload:function(){return this._fetchDiagramInfo();},_fetchDiagramInfo:function(){var self=this;return this._rpc({route:'/web_diagram/diagram/get_diagram_info',params:{id:this.res_id,model:this.modelName,node:this.node_model,connector:this.connector_model,src_node:this.connectors.attrs.source,des_node:this.connectors.attrs.destination,label:this.connectors.attrs.label||false,bgcolor:this.nodes.attrs.bgcolor,shape:this.nodes.attrs.shape,visible_nodes:this.visible_nodes,invisible_nodes:this.invisible_nodes,node_fields_string:this.node_fields_string,connector_fields_string:this.connector_fields_string,},}).then(function(data){self.datanodes=data.nodes;self.edges=data.conn;self.parent_field=data.parent_field;});},});return DiagramModel;});;

/* /web_diagram/static/src/js/diagram_controller.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.DiagramController',function(require){"use strict";var AbstractController=require('web.AbstractController');var core=require('web.core');var Dialog=require('web.Dialog');var view_dialogs=require('web.view_dialogs');var _t=core._t;var QWeb=core.qweb;var FormViewDialog=view_dialogs.FormViewDialog;var DiagramController=AbstractController.extend({className:'o_diagram_view',custom_events:{add_edge:'_onAddEdge',edit_edge:'_onEditEdge',edit_node:'_onEditNode',remove_edge:'_onRemoveEdge',remove_node:'_onRemoveNode',},init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.domain=params.domain||[];this.context=params.context;this.ids=params.ids;this.currentId=params.currentId;},renderButtons:function($node){this.$buttons=$(QWeb.render("DiagramView.buttons",{widget:this}));this.$buttons.on('click','.o_diagram_new_button',this._addNode.bind(this));this.$buttons.appendTo($node);},_addNode:function(){var state=this.model.get();var pop=new FormViewDialog(this,{res_model:state.node_model,domain:this.domain,context:this.context,title:_.str.sprintf("%s %s",_t("Create:"),_t('Activity')),disable_multiple_selection:true,on_saved:this.reload.bind(this),}).open();pop.opened().then(function(){var changes={};changes[state.parent_field]={id:state.res_id};pop.form_view.trigger_up('field_changed',{dataPointID:pop.form_view.handle,changes:changes,});});},_onAddEdge:function(event){var self=this;var state=this.model.get();var pop=new FormViewDialog(self,{res_model:state.connector_model,domain:this.domain,context:this.context,title:_.str.sprintf("%s %s",_t("Create:"),_t('Transition')),disable_multiple_selection:true,}).open();pop.opened().then(function(){var changes={};changes[state.connectors.attrs.source]={id:event.data.source_id};changes[state.connectors.attrs.destination]={id:event.data.dest_id};pop.form_view.trigger_up('field_changed',{dataPointID:pop.form_view.handle,changes:changes,});});pop.on('closed',this,this.reload.bind(this));},_onEditEdge:function(event){var state=this.model.get();new FormViewDialog(this,{res_model:state.connector_model,res_id:parseInt(event.data.id,10),context:this.context,title:_.str.sprintf("%s %s",_t("Open:"),_t('Transition')),on_saved:this.reload.bind(this),}).open();},_onEditNode:function(event){var state=this.model.get();new FormViewDialog(this,{res_model:state.node_model,res_id:event.data.id,context:this.context,title:_.str.sprintf("%s %s",_t("Open:"),_t('Activity')),on_saved:this.reload.bind(this),}).open();},_onRemoveEdge:function(event){var self=this;Dialog.confirm(this,(_t("Are you sure you want to remove this transition?")),{confirm_callback:function(){var state=self.model.get();self._rpc({model:state.connector_model,method:'unlink',args:[event.data.id],}).then(self.reload.bind(self));},});},_onRemoveNode:function(event){var self=this;var msg=_t("Are you sure you want to remove this node ? This will remove its connected transitions as well.");Dialog.confirm(this,(msg),{confirm_callback:function(){var state=self.model.get();self._rpc({model:state.node_model,method:'unlink',args:[event.data.id],}).then(self.reload.bind(self));},});},});return DiagramController;});;

/* /web_diagram/static/src/js/diagram_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.DiagramRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var DiagramRenderer=AbstractRenderer.extend({template:'DiagramView',start:function(){var $header=this.$el.filter('.o_diagram_header');_.each(this.state.labels,function(label){$header.append($('<span>').html(label));});this.$diagram_container=this.$el.filter('.o_diagram');return this._super.apply(this,arguments);},_render:function(){var self=this;var nodes=this.state.nodes;var edges=this.state.edges;var id_to_node={};var style={edge_color:"#A0A0A0",edge_label_color:"#555",edge_label_font_size:10,edge_width:2,edge_spacing:100,edge_loop_radius:100,node_label_color:"#333",node_label_font_size:12,node_outline_color:"#333",node_outline_width:1,node_selected_color:"#0097BE",node_selected_width:2,node_size_x:110,node_size_y:80,connector_active_color:"#FFF",connector_radius:4,close_button_radius:8,close_button_color:"#333",close_button_x_color:"#FFF",gray:"#DCDCDC",white:"#FFF",viewport_margin:50};this.$diagram_container.empty();var $div=$('<div>').css({position:'absolute',top:-10000,right:-10000}).appendTo($('body'));var r=new Raphael($div[0],'100%','100%');var graph=new CuteGraph(r,style,this.$diagram_container[0]);_.each(nodes,function(node){var n=new CuteNode(graph,node.x+50,node.y+50,CuteGraph.wordwrap(node.name,14),node.shape==='rectangle'?'rect':'circle',node.color==='white'?style.white:style.gray);n.id=node.id;id_to_node[node.id]=n;});_.each(edges,function(edge){var e=new CuteEdge(graph,CuteGraph.wordwrap(edge.signal,32),id_to_node[edge.s_id],id_to_node[edge.d_id]||id_to_node[edge.s_id]);e.id=edge.id;});$div.contents().appendTo(this.$diagram_container);$div.remove();CuteNode.double_click_callback=function(cutenode){self.trigger_up('edit_node',{id:cutenode.id});};CuteNode.destruction_callback=function(cutenode){self.trigger_up('remove_node',{id:cutenode.id});return $.Deferred().reject();};CuteEdge.double_click_callback=function(cuteedge){self.trigger_up('edit_edge',{id:cuteedge.id});};CuteEdge.creation_callback=function(node_start,node_end){return{label:''};};CuteEdge.new_edge_callback=function(cuteedge){self.trigger_up('add_edge',{source_id:cuteedge.get_start().id,dest_id:cuteedge.get_end().id,});};CuteEdge.destruction_callback=function(cuteedge){self.trigger_up('remove_edge',{id:cuteedge.id});return $.Deferred().reject();};return this._super.apply(this,arguments);},});return DiagramRenderer;});;

/* /web_diagram/static/src/js/diagram_view.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.DiagramView',function(require){"use strict";var BasicView=require('web.BasicView');var core=require('web.core');var DiagramModel=require('web_diagram.DiagramModel');var DiagramRenderer=require('web_diagram.DiagramRenderer');var DiagramController=require('web_diagram.DiagramController');var _lt=core._lt;var DiagramView=BasicView.extend({display_name:_lt('Diagram'),icon:'fa-code-fork',multi_record:false,searchable:false,jsLibs:[['/web_diagram/static/lib/js/jquery.mousewheel.js','/web_diagram/static/lib/js/raphael.js',]],config:{Model:DiagramModel,Renderer:DiagramRenderer,Controller:DiagramController,},viewType:'diagram',init:function(viewInfo,params){this._super.apply(this,arguments);var self=this;var arch=this.arch;function toTitleCase(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase();});}
var nodes=arch.children[0];var connectors=arch.children[1];var node_model=nodes.attrs.object;var connector_model=connectors.attrs.object;var labels=_.map(_.where(arch.children,{tag:'label'}),function(label){return label.attrs.string;});var invisible_nodes=[];var visible_nodes=[];var node_fields_string=[];_.each(nodes.children,function(child){if(child.attrs.invisible==='1')
invisible_nodes.push(child.attrs.name);else{var fieldString=self.fields[child.attrs.name].string||toTitleCase(child.attrs.name);visible_nodes.push(child.attrs.name);node_fields_string.push(fieldString);}});var connector_fields_string=_.map(connectors.children,function(conn){return self.fields[conn.attrs.name].string||toTitleCase(conn.attrs.name);});this.loadParams=_.extend({},this.loadParams,{currentId:params.currentId,nodes:nodes,labels:labels,invisible_nodes:invisible_nodes,visible_nodes:visible_nodes,node_fields_string:node_fields_string,node_model:node_model,connectors:connectors,connector_model:connector_model,connector_fields_string:connector_fields_string,});this.controllerParams=_.extend({},this.controllerParams,{domain:params.domain,context:params.context,ids:params.ids,currentId:params.currentId,});},getController:function(){var oldDefine=window.define;delete window.define;return this._super.apply(this,arguments).then(function(view){window.define=oldDefine;return view;});},});return DiagramView;});;

/* /web_diagram/static/src/js/view_registry.js defined in bundle 'web.assets_backend' */
odoo.define('web_diagram.view_registry',function(require){"use strict";var view_registry=require('web.view_registry');var DiagramView=require('web_diagram.DiagramView');view_registry.add('diagram',DiagramView);});;

/* /web_editor/static/src/js/backend/fields.js defined in bundle 'web.assets_backend' */
odoo.define('web_editor.backend',function(require){'use strict';var AbstractField=require('web.AbstractField');var basic_fields=require('web.basic_fields');var config=require('web.config');var core=require('web.core');var session=require('web.session');var field_registry=require('web.field_registry');var SummernoteManager=require('web_editor.rte.summernote');var transcoder=require('web_editor.transcoder');var TranslatableFieldMixin=basic_fields.TranslatableFieldMixin;var QWeb=core.qweb;var _t=core._t;var FieldTextHtmlSimple=basic_fields.DebouncedField.extend(TranslatableFieldMixin,{className:'oe_form_field oe_form_field_html_text',supportedFieldTypes:['html'],start:function(){this._summernoteManager=new SummernoteManager(this);return this._super.apply(this,arguments);},commitChanges:function(){var self=this;if(config.debug&&this.mode==='edit'){var layoutInfo=this.$textarea.data('layoutInfo');$.summernote.pluginEvents.codeview(undefined,undefined,layoutInfo,false);}
if(this._getValue()!==this.value){this._isDirty=true;}
var _super=this._super;var args=arguments;return this._summernoteManager.saveCroppedImages(this.$content).then(function(){return _super.apply(self,args);});},isSet:function(){return this.value&&this.value!=="<p><br/></p>"&&this.value.match(/\S/);},getFocusableElement:function(){return this.$content||this._super.apply(this,arguments);},reset:function(record,event){this._reset(record,event);if(!event||event.target!==this){if(this.mode==='edit'){this.$content.html(this._textToHtml(this.value));}else{this._renderReadonly();}}
return $.when();},_getAttachmentsDomain:function(){var domain=['|',['id','in',_.pluck(this.attachments,'id')]];var attachedDocumentDomain=['&',['res_model','=',this.model],['res_id','=',this.res_id|0]];if(!this.res_id){attachedDocumentDomain.unshift('&');attachedDocumentDomain.push(['create_uid','=',session.uid]);}
if(this.recordData.res_model||this.recordData.model){var relatedDomain=['&',['res_model','=',this.recordData.res_model||this.recordData.model],['res_id','=',this.recordData.res_id|0]];if(!this.recordData.res_id){relatedDomain.unshift('&');relatedDomain.push(['create_uid','=',session.uid]);}
domain=domain.concat(['|'],attachedDocumentDomain,relatedDomain);}else{domain=domain.concat(attachedDocumentDomain);}
return domain;},_getSummernoteConfig:function(){var summernoteConfig={model:this.model,id:this.res_id,focus:false,height:180,toolbar:[['style',['style']],['font',['bold','italic','underline','clear']],['fontsize',['fontsize']],['color',['color']],['para',['ul','ol','paragraph']],['table',['table']],['insert',this.nodeOptions['no-attachment']?['link']:['link','picture']],['history',['undo','redo']]],prettifyHtml:false,styleWithSpan:false,inlinemedia:['p'],lang:"odoo",onChange:this._doDebouncedAction.bind(this),disableDragAndDrop:!!this.nodeOptions['no-attachment'],};var fieldNameAttachment=_.chain(this.recordData).pairs().find(function(value){return _.isObject(value[1])&&value[1].model==="ir.attachment";}).first().value();if(fieldNameAttachment){this.fieldNameAttachment=fieldNameAttachment;this.attachments=[];summernoteConfig.onUpload=this._onUpload.bind(this);}
summernoteConfig.getMediaDomain=this._getAttachmentsDomain.bind(this);if(config.debug){summernoteConfig.toolbar.splice(7,0,['view',['codeview']]);}
return summernoteConfig;},_getValue:function(){if(this.nodeOptions['style-inline']){transcoder.attachmentThumbnailToLinkImg(this.$content);transcoder.fontToImg(this.$content);transcoder.classToStyle(this.$content);}
return this.$content.html();},_onUpload:function(attachments){var self=this;attachments=_.filter(attachments,function(attachment){return!_.findWhere(self.attachments,{id:attachment.id});});if(!attachments.length){return;}
this.attachments=this.attachments.concat(attachments);this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:_.object([this.fieldNameAttachment],[{operation:'ADD_M2M',ids:attachments}])});},_renderEdit:function(){this.$textarea=$('<textarea>');this.$textarea.appendTo(this.$el);this.$textarea.summernote(this._getSummernoteConfig());this.$content=this.$('.note-editable:first');this.$content.html(this._textToHtml(this.value));var mouseupEvent=$.Event('mouseup',{'setStyleInfoFromEditable':true});this.$content.trigger(mouseupEvent);if(this.nodeOptions['style-inline']){transcoder.styleToClass(this.$content);transcoder.imgToFont(this.$content);transcoder.linkImgToAttachmentThumbnail(this.$content);}
var history=this.$content.data('NoteHistory');if(history){history.reset();}
this.$('.note-toolbar').append(this._renderTranslateButton());},_renderReadonly:function(){var self=this;this.$el.empty();if(this.nodeOptions['style-inline']){var $iframe=$('<iframe class="o_readonly"/>');$iframe.on('load',function(){self.$content=$($iframe.contents()[0]).find("body");self.$content.html(self._textToHtml(self.value));self._resize();});$iframe.appendTo(this.$el);}else{this.$content=$('<div class="o_readonly"/>');this.$content.html(this._textToHtml(this.value));this.$content.appendTo(this.$el);}},_resize:function(){var height=this.$content[0]?this.$content[0].scrollHeight:0;this.$('iframe').css('height',Math.max(30,Math.min(height,500))+'px');},_textToHtml:function(text){var value=text||"";try{$(text)[0].innerHTML;}catch(e){if(value.match(/^\s*$/)){value='<p><br/></p>';}else{value="<p>"+value.split(/<br\/?>/).join("<br/></p><p>")+"</p>";value=value.replace(/<p><\/p>/g,'').replace('<p><p>','<p>').replace('<p><p ','<p ').replace('</p></p>','</p>');}}
return value;},_renderTranslateButton:function(){if(_t.database.multi_lang&&this.field.translate&&this.res_id){return $(QWeb.render('web_editor.FieldTextHtml.button.translate',{widget:this})).on('click',this._onTranslate.bind(this));}
return $();},});var FieldTextHtml=AbstractField.extend({template:'web_editor.FieldTextHtml',supportedFieldTypes:['html'],start:function(){var self=this;this.editorLoadedDeferred=$.Deferred();this.contentLoadedDeferred=$.Deferred();this.callback=_.uniqueId('FieldTextHtml_');window.odoo[this.callback+"_editor"]=function(EditorBar){setTimeout(function(){self.on_editor_loaded(EditorBar);},0);};window.odoo[this.callback+"_content"]=function(){self.on_content_loaded();};window.odoo[this.callback+"_updown"]=null;window.odoo[this.callback+"_downup"]=function(){self.resize();};this.$iframe=this.$el.find('iframe');this.document=null;this.$body=$();this.$content=$();this.$iframe.css('min-height','calc(100vh - 360px)');this.resize=function resize(){if(self.mode==='edit'){if($("body").hasClass("o_field_widgetTextHtml_fullscreen")){self.$iframe.css('height',(document.body.clientHeight-self.$iframe.offset().top)+'px');}else{self.$iframe.css("height",(self.$body.find("#oe_snippets").length?500:300)+"px");}}};$(window).on('resize',this.resize);this.old_initialize_content();var def=this._super.apply(this,arguments);return def;},getDatarecord:function(){return this.recordData;},get_url:function(_attr){var src=this.nodeOptions.editor_url||"/mass_mailing/field/email_template";var k;var datarecord=this.getDatarecord();var attr={'model':this.model,'field':this.name,'res_id':datarecord.id||'','callback':this.callback};_attr=_attr||{};if(this.nodeOptions['style-inline']){attr.inline_mode=1;}
if(this.nodeOptions.snippets){attr.snippets=this.nodeOptions.snippets;}
if(this.nodeOptions.template){attr.template=this.nodeOptions.template;}
if(this.mode==="edit"){attr.enable_editor=1;}
if(session.debug){attr.debug=session.debug;}
for(k in _attr){attr[k]=_attr[k];}
if(src.indexOf('?')===-1){src+="?";}
for(k in attr){if(attr[k]!==null){src+="&"+k+"="+(_.isBoolean(attr[k])?+attr[k]:attr[k]);}}
return src;},old_initialize_content:function(){this.$el.closest('.modal-body').css('max-height','none');this.$iframe=this.$el.find('iframe');this.document=null;this.$body=$();this.$content=$();this.editor=false;window.odoo[this.callback+"_updown"]=null;this.$iframe.attr("src",this.get_url());},on_content_loaded:function(){var self=this;this.document=this.$iframe.contents()[0];this.$body=$("body",this.document);this.$content=this.$body.find("#editable_area");this.render();this.add_button();this.contentLoadedDeferred.resolve();setTimeout(self.resize,0);},on_editor_loaded:function(EditorBar){var self=this;this.editor=EditorBar;if(this.value&&window.odoo[self.callback+"_updown"]&&!(this.$content.html()||"").length){this.render();}
this.editorLoadedDeferred.resolve();setTimeout(function(){setTimeout(self.resize,0);},0);},add_button:function(){var self=this;var $to=this.$body.find("#web_editor-top-edit, #wrapwrap").first();$(QWeb.render('web_editor.FieldTextHtml.fullscreen')).appendTo($to).on('click','.o_fullscreen',function(){$("body").toggleClass("o_field_widgetTextHtml_fullscreen");var full=$("body").hasClass("o_field_widgetTextHtml_fullscreen");self.$iframe.parents().toggleClass('o_form_fullscreen_ancestor',full);$(window).trigger("resize");});this.$body.on('click','[data-action="cancel"]',function(event){event.preventDefault();self.old_initialize_content();});},render:function(){var value=(this.value||"").replace(/^<p[^>]*>(\s*|<br\/?>)<\/p>$/,'');if(!this.$content){return;}
if(this.mode==="edit"){if(window.odoo[this.callback+"_updown"]){this.resize();}}else{this.$content.html(value);if(this.$iframe[0].contentWindow){this.$iframe.css("height",(this.$body.height()+20)+"px");}}},has_no_value:function(){return this.value===false||!this.$content.html()||!this.$content.html().match(/\S/);},destroy:function(){$(window).off('resize',this.resize);delete window.odoo[this.callback+"_editor"];delete window.odoo[this.callback+"_content"];delete window.odoo[this.callback+"_updown"];delete window.odoo[this.callback+"_downup"];},commitChanges:function(){var self=this;var result=this._super.bind(this,arguments);if(this.mode==='readonly'){return;}
return $.when(this.contentLoadedDeferred,this.editorLoadedDeferred,result).then(function(){if(config.debug&&self.editor.rte){var layoutInfo=self.editor.rte.editable().data('layoutInfo');$.summernote.pluginEvents.codeview(undefined,undefined,layoutInfo,false);}
var $ancestors=self.$iframe.filter(':not(:visible)').parentsUntil(':visible').addBack();var ancestorsStyle=[];_.each($ancestors,function(el){var $el=$(el);ancestorsStyle.unshift($el.attr('style')||null);$el.css({display:'initial',visibility:'hidden',height:1});});self.editor.snippetsMenu&&self.editor.snippetsMenu.cleanForSave();_.each($ancestors,function(el){var $el=$(el);$el.attr('style',ancestorsStyle.pop());});self._setValue(self.$content.html());});},});field_registry.add('html',FieldTextHtmlSimple).add('html_frame',FieldTextHtml);return{FieldTextHtmlSimple:FieldTextHtmlSimple,FieldTextHtml:FieldTextHtml,};});;

/* /web_kanban_gauge/static/src/js/kanban_gauge.js defined in bundle 'web.assets_backend' */
odoo.define('web_kanban_gauge.widget',function(require){"use strict";var AbstractField=require('web.AbstractField');var field_registry=require('web.field_registry');var utils=require('web.utils');var GaugeWidget=AbstractField.extend({className:"oe_gauge",cssLibs:['/web/static/lib/nvd3/nv.d3.css'],jsLibs:['/web/static/lib/nvd3/d3.v3.js','/web/static/lib/nvd3/nv.d3.js','/web/static/src/js/libs/nvd3.js'],_render:function(){var max_value=this.nodeOptions.max_value||100;if(this.nodeOptions.max_field){max_value=this.recordData[this.nodeOptions.max_field];}
var label=this.nodeOptions.label||"";if(this.nodeOptions.label_field){label=this.recordData[this.nodeOptions.label_field];}
var title=this.nodeOptions.title||this.field.string;var val=this.value;if(_.isArray(JSON.parse(val))){val=JSON.parse(val);}
var value=_.isArray(val)&&val.length?val[val.length-1].value:val;var gauge_value=value;if(this.nodeOptions.gauge_value_field){gauge_value=this.recordData[this.nodeOptions.gauge_value_field];}
var degree=Math.PI/180,width=200,height=150,outerRadius=Math.min(width,height)*0.5,innerRadius=outerRadius*0.7,fontSize=height/7;this.$el.empty().attr('style',this.nodeOptions.style+';position:relative; display:inline-block;');var arc=d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius).startAngle(-90*degree);var svg=d3.select(this.$el[0]).append("svg").attr("width",'100%').attr("height",'100%').attr('viewBox','0 0 '+width+' '+height).attr('preserveAspectRatio','xMinYMin').append("g").attr("transform","translate("+(width/2)+","+(height-(width-height)/2-12)+")");function addText(text,fontSize,dx,dy){return svg.append("text").attr("text-anchor","middle").style("font-size",fontSize+'px').attr("dy",dy).attr("dx",dx).text(text);}
addText(title,16,0,-outerRadius-16).style("font-weight",'bold');addText(utils.human_number(value,1),fontSize,0,-2).style("font-weight",'bold');addText(0,8,-(outerRadius+innerRadius)/2,12);addText(label,8,0,12);addText(utils.human_number(max_value,1),8,(outerRadius+innerRadius)/2,12);svg.append("path").datum({endAngle:Math.PI/2}).style("fill","#ddd").attr("d",arc);var foreground=svg.append("path").datum({endAngle:0}).style("fill","hsl(0,80%,50%)").attr("d",arc);var ratio=max_value?value/max_value:0;var hue=Math.round(ratio*120);foreground.transition().style("fill","hsl("+hue+",80%,50%)").duration(1500).call(arcTween,(ratio-0.5)*Math.PI);function arcTween(transition,newAngle){transition.attrTween("d",function(d){var interpolate=d3.interpolate(d.endAngle,newAngle);return function(t){d.endAngle=interpolate(t);return arc(d);};});}},});field_registry.add("gauge",GaugeWidget);return GaugeWidget;});;

/* /web_tour/static/src/js/debug_manager.js defined in bundle 'web.assets_backend' */
odoo.define('web_tour.DebugManager',function(require){"use strict";var core=require("web.core");var DebugManager=require('web.DebugManager');var Dialog=require("web.Dialog");var tour=require('web_tour.tour');function get_active_tours(){return _.difference(_.keys(tour.tours),tour.consumed_tours);}
DebugManager.include({start:function(){this.consume_tours_enabled=get_active_tours().length>0;return this._super.apply(this,arguments);},consume_tours:function(){var active_tours=get_active_tours();if(active_tours.length>0){this._rpc({model:'web_tour.tour',method:'consume',args:[active_tours],}).then(function(){window.location.reload();});}},start_tour:function(){var dialog=new Dialog(this,{title:'Tours',$content:core.qweb.render('WebClient.DebugManager.ToursDialog',{tours:tour.tours}),});dialog.opened().then(function(){dialog.$('.o_start_tour').on('click',function(e){e.preventDefault();tour.run($(e.target).data('name'));});});dialog.open();},});});;

/* /iap/static/src/js/iap_credit.js defined in bundle 'web.assets_backend' */
odoo.define('iap.redirect_odoo_credit_widget',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var core=require('web.core');var IapOdooCreditRedirect=AbstractAction.extend({template:'iap.redirect_to_odoo_credit',events:{"click .redirect_confirm":"odoo_redirect",},init:function(parent,action){this._super(parent,action);this.url=action.params.url;},odoo_redirect:function(){window.open(this.url,'_blank');this.do_action({type:'ir.actions.act_window_close'});},});core.action_registry.add('iap_odoo_credit_redirect',IapOdooCreditRedirect);});;

/* /iap/static/src/js/crash_manager.js defined in bundle 'web.assets_backend' */
odoo.define('iap.CrashManager',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var CrashManager=require('web.CrashManager');var Dialog=require('web.Dialog');var _t=core._t;var QWeb=core.qweb;CrashManager.include({_getButtonMessage:function(isTrial){var isEnterprise=_.last(odoo.session_info.server_version_info)==='e';return isTrial&&isEnterprise?_t('Start a Trial at Odoo'):_t('Buy credits at Odoo');},rpc_error:function(error){var self=this;if(error.data.name==="odoo.addons.iap.models.iap.InsufficientCreditError"){var error_data=JSON.parse(error.data.message);ajax.jsonRpc('/web/dataset/call_kw','call',{model:'iap.account',method:'get_credits_url',args:[],kwargs:{base_url:error_data.base_url,service_name:error_data.service_name,credit:error_data.credit,trial:error_data.trial}}).then(function(url){var content=$(QWeb.render('iap.redirect_to_odoo_credit',{data:error_data,}));if(error_data.body){content.css('padding',0);}
new Dialog(this,{size:'large',title:error_data.title||_t("Insufficient Balance"),$content:content,buttons:[{text:self._getButtonMessage(error_data.trial),classes:"btn-primary",click:function(){window.open(url,'_blank');},close:true,},{text:_t("Cancel"),close:true,}],}).open();});}else{this._super.apply(this,arguments);}},});});;

/* /iap/static/src/js/dashboard.js defined in bundle 'web.assets_backend' */
odoo.define('iap.Dashboard',function(require){"use strict";var Dashboard=require('web_settings_dashboard');Dashboard.Dashboard.include({load_apps:function(data){var _super=this._super.bind(this);return this._rpc({model:'iap.account',method:'get_account_url',args:[],kwargs:{},}).then(function(url){data.apps.url=url;return _super(data);});},});});;

/* /iap/static/src/js/iap_credit_checker_widget.js defined in bundle 'web.assets_backend' */
odoo.define('iap.credit.checker',function(require){'use strict';var widgetRegistry=require('web.widget_registry');var Widget=require('web.Widget');var core=require('web.core');var rpc=require('web.rpc');var QWeb=core.qweb;var IAPCreditChecker=Widget.extend({className:'o_field_iap_credit_checker',init:function(parent,data,options){this._super.apply(this,arguments);this.service_name=options.attrs.service_name;},start:function(){this.$widget=$(QWeb.render('iap.credit_checker'));this.$loading=this.$widget.find('.loading');this.$sufficient=this.$widget.find('.sufficient');this.$insufficient=this.$widget.find('.insufficient');this.$error=this.$widget.find('.error');this.$buyLink=this.$widget.find('.buy_credits');this.$widget.appendTo(this.$el);this.$buyLink.click(this._getLink.bind(this));this._getCredits();},_getCredits:function(){var self=this;this._showLoading();return rpc.query({model:'iap.account',method:'get_credits',args:[this.service_name],},{shadow:true,}).then(function(credit){if(credit>0)self._showSufficient(credit);else if(credit<0)self._showError();else self._showInsufficient();});},_getLink:function(){console.log(true)
var self=this;return rpc.query({model:'iap.account',method:'get_credits_url',args:[this.service_name],},{shadow:true,}).then(function(url){return self.do_action({type:'ir.actions.act_url',url:url,});});},_showLoading:function(){this.$loading.show();this.$sufficient.hide();this.$insufficient.hide();this.$error.hide();},_showSufficient:function(credits){this.$loading.hide();this.$sufficient.show().find('.remaining_credits').text(credits);this.$insufficient.hide();this.$error.hide();},_showInsufficient:function(){this.$loading.hide();this.$sufficient.hide();this.$insufficient.show();this.$error.hide();},_showError:function(){this.$loading.hide();this.$sufficient.hide();this.$insufficient.hide();this.$error.show();},});widgetRegistry.add('iap_credit_checker',IAPCreditChecker);return IAPCreditChecker;});;

/* /bus/static/src/js/longpolling_bus.js defined in bundle 'web.assets_backend' */
odoo.define('bus.Longpolling',function(require){"use strict";var Bus=require('web.Bus');var ServicesMixin=require('web.ServicesMixin');var LongpollingBus=Bus.extend(ServicesMixin,{PARTNERS_PRESENCE_CHECK_PERIOD:30000,ERROR_RETRY_DELAY:10000,POLL_ROUTE:'/longpolling/poll',_isActive:null,_lastNotificationID:0,_isOdooFocused:true,_pollRetryTimeout:null,init:function(parent,params){this._super.apply(this,arguments);this._id=_.uniqueId('bus');this._longPollingBusId=this._id;this._options={};this._channels=[];this._lastPresenceTime=new Date().getTime();this._lastPartnersPresenceCheck=this._lastPresenceTime;$(window).on("focus."+this._longPollingBusId,this._onFocusChange.bind(this,{focus:true}));$(window).on("blur."+this._longPollingBusId,this._onFocusChange.bind(this,{focus:false}));$(window).on("unload."+this._longPollingBusId,this._onFocusChange.bind(this,{focus:false}));$(window).on("click."+this._longPollingBusId,this._onPresence.bind(this));$(window).on("keydown."+this._longPollingBusId,this._onPresence.bind(this));$(window).on("keyup."+this._longPollingBusId,this._onPresence.bind(this));},destroy:function(){this.stopPolling();$(window).off("focus."+this._longPollingBusId);$(window).off("blur."+this._longPollingBusId);$(window).off("unload."+this._longPollingBusId);$(window).off("click."+this._longPollingBusId);$(window).off("keydown."+this._longPollingBusId);$(window).off("keyup."+this._longPollingBusId);this._super();},addChannel:function(channel){if(this._channels.indexOf(channel)===-1){this._channels.push(channel);if(this._pollRpc){this._pollRpc.abort();}else{this.startPolling();}}},deleteChannel:function(channel){var index=this._channels.indexOf(channel);if(index!==-1){this._channels.splice(index,1);if(this._pollRpc){this._pollRpc.abort();}}},isOdooFocused:function(){return this._isOdooFocused;},startPolling:function(){if(this._isActive===null){this._poll=this._poll.bind(this);}
if(!this._isActive){this._isActive=true;this._poll();}},stopPolling:function(){this._isActive=false;this._channels=[];clearTimeout(this._pollRetryTimeout);if(this._pollRpc){this._pollRpc.abort();}},updateOption:function(key,value){this._options[key]=value;},_getLastPresence:function(){return this._lastPresenceTime;},_poll:function(){var self=this;if(!this._isActive){return;}
var now=new Date().getTime();var options=_.extend({},this._options,{bus_inactivity:now-this._getLastPresence(),});if(this._lastPartnersPresenceCheck+this.PARTNERS_PRESENCE_CHECK_PERIOD>now){options=_.omit(options,'bus_presence_partner_ids');}else{this._lastPartnersPresenceCheck=now;}
var data={channels:this._channels,last:this._lastNotificationID,options:options};this._pollRpc=this._makePoll(data);this._pollRpc.then(function(result){self._pollRpc=false;self._onPoll(result);self._poll();},function(error,ev){self._pollRpc=false;ev.preventDefault();if(error&&error.message==="XmlHttpRequestError abort"){self._poll();}else{self._pollRetryTimeout=setTimeout(self._poll,self.ERROR_RETRY_DELAY+(Math.floor((Math.random()*20)+1)*1000));}});},_makePoll:function(data){return this._rpc({route:this.POLL_ROUTE,params:data},{shadow:true,timeout:60000});},_onFocusChange:function(params){this._isOdooFocused=params.focus;if(params.focus){this._lastPresenceTime=new Date().getTime();this.trigger('window_focus',this._isOdooFocused);}},_onPoll:function(notifications){var self=this;var notifs=_.map(notifications,function(notif){if(notif.id>self._lastNotificationID){self._lastNotificationID=notif.id;}
return[notif.channel,notif.message];});this.trigger("notification",notifs);return notifs;},_onPresence:function(){this._lastPresenceTime=new Date().getTime();},});return LongpollingBus;});;

/* /bus/static/src/js/crosstab_bus.js defined in bundle 'web.assets_backend' */
odoo.define('bus.CrossTab',function(require){"use strict";var Longpolling=require('bus.Longpolling');var session=require('web.session');var CrossTabBus=Longpolling.extend({TAB_HEARTBEAT_PERIOD:10000,MASTER_TAB_HEARTBEAT_PERIOD:1500,HEARTBEAT_OUT_OF_DATE_PERIOD:5000,HEARTBEAT_KILL_OLD_PERIOD:15000,LOCAL_STORAGE_PREFIX:'bus',_isMasterTab:false,_isRegistered:false,init:function(){this._super.apply(this,arguments);var now=new Date().getTime();this._sanitizedOrigin=session.origin.replace(/:\/{0,2}/g,'_');this._id=_.uniqueId(this.LOCAL_STORAGE_PREFIX)+':'+now;if(this._callLocalStorage('getItem','last_ts',0)+50000<now){this._callLocalStorage('removeItem','last');}
this._lastNotificationID=this._callLocalStorage('getItem','last',0);this.call('local_storage','onStorage',this,this._onStorage);},destroy:function(){this._super();clearTimeout(this._heartbeatTimeout);},addChannel:function(){this._super.apply(this,arguments);this._callLocalStorage('setItem','channels',this._channels);},deleteChannel:function(){this._super.apply(this,arguments);this._callLocalStorage('setItem','channels',this._channels);},getTabId:function(){return this._id;},isMasterTab:function(){return this._isMasterTab;},startPolling:function(){if(this._isActive===null){this._heartbeat=this._heartbeat.bind(this);}
if(!this._isRegistered){this._isRegistered=true;var peers=this._callLocalStorage('getItem','peers',{});peers[this._id]=new Date().getTime();this._callLocalStorage('setItem','peers',peers);this._registerWindowUnload();if(!this._callLocalStorage('getItem','master')){this._startElection();}
this._heartbeat();if(this._isMasterTab){this._callLocalStorage('setItem','channels',this._channels);this._callLocalStorage('setItem','options',this._options);}else{this._channels=this._callLocalStorage('getItem','channels',this._channels);this._options=this._callLocalStorage('getItem','options',this._options);}
return;}
if(this._isMasterTab){this._super.apply(this,arguments);}},updateOption:function(){this._super.apply(this,arguments);this._callLocalStorage('setItem','options',this._options);},_callLocalStorage:function(method,key,param){return this.call('local_storage',method,this._generateKey(key),param);},_generateKey:function(key){return this.LOCAL_STORAGE_PREFIX+'.'+this._sanitizedOrigin+'.'+key;},_getLastPresence:function(){return this._callLocalStorage('getItem','lastPresence')||this._super();},_heartbeat:function(){var now=new Date().getTime();var heartbeatValue=parseInt(this._callLocalStorage('getItem','heartbeat',0));var peers=this._callLocalStorage('getItem','peers',{});if((heartbeatValue+this.HEARTBEAT_OUT_OF_DATE_PERIOD)<now){this._startElection();heartbeatValue=parseInt(this._callLocalStorage('getItem','heartbeat',0));}
if(this._isMasterTab){var cleanedPeers={};for(var peerName in peers){if(peers[peerName]+this.HEARTBEAT_KILL_OLD_PERIOD>now){cleanedPeers[peerName]=peers[peerName];}}
if(heartbeatValue!==this.lastHeartbeat){this._isMasterTab=false;this.lastHeartbeat=0;peers[this._id]=now;this._callLocalStorage('setItem','peers',peers);this.stopPolling();this.trigger('no_longer_master');}else{this.lastHeartbeat=now;this._callLocalStorage('setItem','heartbeat',now);this._callLocalStorage('setItem','peers',cleanedPeers);}}else{peers[this._id]=now;this._callLocalStorage('setItem','peers',peers);}
var hbPeriod=this._isMasterTab?this.MASTER_TAB_HEARTBEAT_PERIOD:this.TAB_HEARTBEAT_PERIOD;if(this._lastPresenceTime+hbPeriod>now){this._callLocalStorage('setItem','lastPresence',this._lastPresenceTime);}
this._heartbeatTimeout=setTimeout(this._heartbeat.bind(this),hbPeriod);},_registerWindowUnload:function(){$(window).on('unload.'+this._id,this._onUnload.bind(this));},_startElection:function(){if(this._isMasterTab){return;}
var now=new Date().getTime();var peers=this._callLocalStorage('getItem','peers',{});var heartbeatKillOld=now-this.HEARTBEAT_KILL_OLD_PERIOD;var newMaster;for(var peerName in peers){if(peers[peerName]<heartbeatKillOld){continue;}
newMaster=peerName;break;}
if(newMaster===this._id){this.lastHeartbeat=now;this._callLocalStorage('setItem','heartbeat',this.lastHeartbeat);this._callLocalStorage('setItem','master',true);this._isMasterTab=true;this.startPolling();this.trigger('become_master');delete peers[newMaster];this._callLocalStorage('setItem','peers',peers);}},_onFocusChange:function(params){this._super.apply(this,arguments);this._callLocalStorage('setItem','focus',params.focus);},_onPoll:function(notifications){var notifs=this._super(notifications);if(this._isMasterTab&&notifs.length){this._callLocalStorage('setItem','last',this._lastNotificationID);this._callLocalStorage('setItem','last_ts',new Date().getTime());this._callLocalStorage('setItem','notification',notifs);}},_onStorage:function(e){var value=JSON.parse(e.newValue);var key=e.key;if(this._isRegistered&&key===this._generateKey('master')&&!value){this._startElection();}
if(key===this._generateKey('last')){this._lastNotificationID=value||0;}
else if(key===this._generateKey('notification')){if(!this._isMasterTab){this.trigger("notification",value);}}
else if(key===this._generateKey('channels')){this._channels=value;}
else if(key===this._generateKey('options')){this._options=value;}
else if(key===this._generateKey('focus')){this._isOdooFocused=value;this.trigger('window_focus',this._isOdooFocused);}},_onUnload:function(){var peers=this._callLocalStorage('getItem','peers',{});delete peers[this._id];this._callLocalStorage('setItem','peers',peers);if(this._isMasterTab){this._callLocalStorage('removeItem','master');}},});return CrossTabBus;});;

/* /bus/static/src/js/services/bus_service.js defined in bundle 'web.assets_backend' */
odoo.define('bus.BusService',function(require){"use strict";var CrossTab=require('bus.CrossTab');var core=require('web.core');var ServicesMixin=require('web.ServicesMixin');var BusService=CrossTab.extend(ServicesMixin,{dependencies:['local_storage'],_audio:null,start:function(){},sendNotification:function(title,content,callback){if(window.Notification&&Notification.permission==="granted"){if(this.isMasterTab()){try{this._sendNativeNotification(title,content,callback);}catch(error){if(error.message.indexOf('ServiceWorkerRegistration')>-1){this.do_notify(title,content);this._beep();}else{throw error;}}}}else{this.do_notify(title,content);if(this.isMasterTab()){this._beep();}}},onNotification:function(){this.on.apply(this,["notification"].concat(Array.prototype.slice.call(arguments)));},_beep:function(){if(typeof(Audio)!=="undefined"){if(!this._audio){this._audio=new Audio();var ext=this._audio.canPlayType("audio/ogg; codecs=vorbis")?".ogg":".mp3";var session=this.getSession();this._audio.src=session.url("/mail/static/src/audio/ting"+ext);}
this._audio.play();}},_sendNativeNotification:function(title,content,callback){var notification=new Notification(title,{body:content,icon:"/mail/static/src/img/odoobot.png"});notification.onclick=function(){window.focus();if(this.cancel){this.cancel();}else if(this.close){this.close();}
if(callback){callback();}};},});core.serviceRegistry.add('bus_service',BusService);return BusService;});;

/* /mail/static/src/js/many2many_tags_email.js defined in bundle 'web.assets_backend' */
odoo.define('mail.many2manytags',function(require){"use strict";var BasicModel=require('web.BasicModel');var core=require('web.core');var form_common=require('web.view_dialogs');var field_registry=require('web.field_registry');var relational_fields=require('web.relational_fields');var M2MTags=relational_fields.FieldMany2ManyTags;var _t=core._t;BasicModel.include({_setInvalidMany2ManyTagsEmail:function(record,fieldName){var self=this;var localID=(record._changes&&fieldName in record._changes)?record._changes[fieldName]:record.data[fieldName];var list=this._applyX2ManyOperations(this.localData[localID]);var invalidPartnerIds=[];_.each(list.data,function(id){var record=self.localData[id];if(!record.data.email){invalidPartnerIds.push(record);}});var def;if(invalidPartnerIds.length){var changes={operation:'DELETE',ids:_.pluck(invalidPartnerIds,'id')};def=this._applyX2ManyChange(record,fieldName,changes);}
return $.when(def).then(function(){return $.when({invalidPartnerIds:_.pluck(invalidPartnerIds,'res_id'),});});},});var FieldMany2ManyTagsEmail=M2MTags.extend({tag_template:"FieldMany2ManyTagsEmail",fieldsToFetch:_.extend({},M2MTags.prototype.fieldsToFetch,{email:{type:'char'},}),specialData:"_setInvalidMany2ManyTagsEmail",_checkEmailPopup:function(){var self=this;var popupDefs=[];var validPartners=[];_.each(this.record.specialData[this.name].invalidPartnerIds,function(resID){var def=$.Deferred();popupDefs.push(def);var pop=new form_common.FormViewDialog(self,{res_model:self.field.relation,res_id:resID,context:self.record.context,title:"",on_saved:function(record){if(record.data.email){validPartners.push(record.res_id);}},}).open();pop.on('closed',self,function(){def.resolve();});});return $.when.apply($,popupDefs).then(function(){validPartners=_.uniq(validPartners);if(validPartners.length){var values=_.map(validPartners,function(id){return{id:id};});self._setValue({operation:'ADD_M2M',ids:values,});}});},_render:function(){var self=this;var def=$.Deferred();var _super=this._super.bind(this);if(this.record.specialData[this.name].invalidPartnerIds.length){def=this._checkEmailPopup();}else{def.resolve();}
return def.then(function(){return _super.apply(self,arguments);});},});field_registry.add('many2many_tags_email',FieldMany2ManyTagsEmail);});;

/* /mail/static/src/js/services/mail_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Manager',function(require){"use strict";var AbstractService=require('web.AbstractService');var DMChat=require('mail.model.DMChat');var Livechat=require('mail.model.Livechat');var Mailbox=require('mail.model.Mailbox');var MailFailure=require('mail.model.MailFailure');var Message=require('mail.model.Message');var MultiUserChannel=require('mail.model.MultiUserChannel');var mailUtils=require('mail.utils');var Bus=require('web.Bus');var config=require('web.config');var core=require('web.core');var session=require('web.session');var _t=core._t;var PREVIEW_MSG_MAX_SIZE=350;var MailManager=AbstractService.extend({dependencies:['ajax','bus_service','local_storage'],_ODOOBOT_ID:"ODOOBOT",start:function(){this._super.apply(this,arguments);this._initializeInternalState();this._listenOnBuses();this._fetchMailStateFromServer();},addMessage:function(data,options){options=options||{};var message=this.getMessage(data.id);if(!message){message=this._addNewMessage(data,options);}else{if(data.moderation_status==='accepted'){message.setModerationStatus('accepted',{additionalThreadIDs:data.channel_ids});}
if(options.domain&&options.domain!==[]){this._addMessageToThreads(message,options);}}
return message;},createChannel:function(name,type){if(type==='dm_chat'){return this._createDMChat(name);}else{return this._createChannel(name,type);}},getCannedResponses:function(){return this._cannedResponses;},getChannel:function(threadID){return _.find(this._threads,function(thread){return thread.isChannel()&&(thread.getID()===threadID);});},getChannels:function(){return _.filter(this._threads,function(thread){return thread.isChannel();});},getChannelPreviews:function(channels){var self=this;return this._getChannelPreviews(channels).then(function(previews){var sortedPreviews=self._sortPreviews(previews);return sortedPreviews;});},getMailBus:function(){return this._mailBus;},getDiscussMenuID:function(){return this._discussMenuID;},getDMChatFromPartnerID:function(partnerID){return _.find(this._threads,function(thread){return thread.getType()==='dm_chat'&&thread.getDirectPartnerID()===partnerID;});},getMailbox:function(mailboxID){return _.find(this._threads,function(thread){return thread.getID()==='mailbox_'+mailboxID;});},getMailFailures:function(){return this._mailFailures;},getMentionPartnerSuggestions:function(){return this._mentionPartnerSuggestions;},getMessage:function(messageID){return _.find(this._messages,function(message){return message.getID()===messageID;});},getSystrayPreviews:function(filter){var self=this;var defs=[];var channelDef=this._getSystrayChannelPreviews(filter);var inboxDef=this._getSystrayInboxPreviews(filter);var failureDef=this._getSystrayMailFailurePreviews(filter);defs=defs.concat([channelDef,inboxDef,failureDef]);return $.when.apply($,defs).then(function(previewsChannel,previewsInbox,previewsFailure){previewsChannel=self._sortPreviews(previewsChannel);previewsInbox=self._sortPreviews(previewsInbox);previewsFailure=self._sortPreviews(previewsFailure);return _.union(previewsFailure,previewsInbox,previewsChannel);});},getModeratedChannelIDs:function(){return this._moderatedChannelIDs||[];},getOdoobotID:function(){return this._ODOOBOT_ID;},getThread:function(threadID){return _.find(this._threads,function(thread){return thread.getID()===threadID;});},getThreads:function(){return this._threads;},isMyselfModerator:function(){return this._isMyselfModerator;},isReady:function(){return this._isReady;},joinChannel:function(channelID,options){var def;var channel=this.getChannel(channelID);if(channel){def=$.when(channelID);}else{def=this._joinAndAddChannel(channelID,options);}
return def;},markMessagesAsRead:function(messageIDs){var self=this;var ids=_.filter(messageIDs,function(id){var message=self.getMessage(id);return!message||message.isNeedaction();});if(ids.length){return this._rpc({model:'mail.message',method:'set_message_done',args:[ids],});}else{return $.when();}},openThread:function(threadID){this._openThreadInDiscuss(threadID);},redirect:function(resModel,resID,dmRedirectionCallback){if(resModel==='res.partner'){this._redirectPartner(resModel,resID,dmRedirectionCallback);}else{this._redirectDefault(resModel,resID);}},removeMessageFromThreads:function(message){var self=this;_.each(message.getThreadIDs(),function(threadID){var thread=self.getThread(threadID);if(thread){thread.removeMessage(message.getID());}});},searchPartner:function(searchVal,limit){var def=$.Deferred();var partners=this._searchPartnerPrefetch(searchVal,limit);if(!partners.length){def=this._searchPartnerFetch(searchVal,limit);}else{def=$.when(partners);}
return def.then(function(partners){var suggestions=_.map(partners,function(partner){return{id:partner.id,value:partner.name,label:partner.name};});return _.sortBy(suggestions,'label');});},unstarAll:function(){return this._rpc({model:'mail.message',method:'unstar_all',args:[[]]});},_addChannel:function(data,options){options=typeof options==='object'?options:{};var channel=this.getChannel(data.id);if(!channel){channel=this._makeChannel(data,options);if(channel.getType()==='dm_chat'){this._pinnedDmPartners.push(channel.getDirectPartnerID());this.call('bus_service','updateOption','bus_presence_partner_ids',this._pinnedDmPartners);}
this._threads.push(channel);if(data.last_message){this.addMessage(data.last_message);}
this._sortThreads();if(!options.silent){this._mailBus.trigger('new_channel',channel);}}
return channel.getID();},_addMailbox:function(data,options){options=typeof options==='object'?options:{};var mailbox=new Mailbox({parent:this,data:data,options:options,commands:this._commands});this._threads.push(mailbox);this._sortThreads();return mailbox;},_addMessageToThreads:function(message,options){var self=this;options=options||{};_.each(message.getThreadIDs(),function(threadID){var thread=self.getThread(threadID);if(thread){thread.addMessage(message,options);}});},_addNewMessage:function(data,options){var message=this._makeMessage(data);var index=_.sortedIndex(this._messages,message,function(msg){return msg.getID();});this._messages.splice(index,0,message);this._addNewMessagePostprocessThread(message,options);this._addMessageToThreads(message,options);if(!options.silent){this._mailBus.trigger('new_message',message);}
return message;},_addNewMessagePostprocessThread:function(message,options){var self=this;_.each(message.getThreadIDs(),function(threadID){var thread=self.getThread(threadID);if(thread){if(thread.getType()!=='mailbox'&&!message.isMyselfAuthor()&&!message.isSystemNotification()){if(thread.isTwoUserThread()&&options.showNotification){if(!self._isDiscussOpen()&&!config.device.isMobile&&!thread.isDetached()){thread.detach({passively:true});}
var query={isVisible:false};self._mailBus.trigger('is_thread_bottom_visible',thread,query);if(!self.call('bus_service','isOdooFocused')||!query.isVisible){self._notifyIncomingMessage(message);}}}}});},_createChannel:function(name,type){var context=_.extend({isMobile:config.device.isMobile},session.user_context);return this._rpc({model:'mail.channel',method:'channel_create',args:[name,type],kwargs:{context:context},}).then(this._addChannel.bind(this));},_createDMChat:function(name){var context=_.extend({isMobile:config.device.isMobile},session.user_context);return this._rpc({model:'mail.channel',method:'channel_get',args:[[name]],kwargs:{context:context},}).then(this._addChannel.bind(this));},_fetchChannelPreviews:function(channelIDs){return this._rpc({model:'mail.channel',method:'channel_fetch_preview',args:[channelIDs],},{shadow:true});},_fetchMailStateFromServer:function(){var self=this;this._isReady=session.is_bound.then(function(){var context=_.extend({isMobile:config.device.isMobile},session.user_context);return self._rpc({route:'/mail/init_messaging',params:{context:context},});}).then(function(result){self._updateInternalStateFromServer(result);self.call('bus_service','startPolling');});},_getChannelPreviews:function(channels){var self=this;var unpreviewedChannels=_.reject(channels,function(channel){return channel.hasBeenPreviewed();});var fetchDef;if(unpreviewedChannels.length){var ids=_.map(unpreviewedChannels,function(channel){return channel.getID();});fetchDef=this._fetchChannelPreviews(ids);}else{fetchDef=$.when();}
return fetchDef.then(function(fetchedPreviews){_.each(fetchedPreviews,function(fetchedPreview){if(fetchedPreview.last_message){self.addMessage(fetchedPreview.last_message);}
var channel=self.getChannel(fetchedPreview.id);channel.markAsPreviewed();});return _.map(channels,function(channel){return channel.getPreview();});});},_getMailFailurePreviews:function(){var items=[];_.each(this._mailFailures,function(failure){var unreadCounter=1;var isSameDocument=true;var sameModelItem=_.find(items,function(item){if(item.failure.isLinkedToDocument()&&(item.failure.getDocumentModel()===failure.getDocumentModel())){isSameDocument=item.failure.getDocumentID()===failure.getDocumentID();return true;}
return false;});if(failure.isLinkedToDocument()&&sameModelItem){unreadCounter=sameModelItem.unreadCounter+1;isSameDocument=sameModelItem.isSameDocument&&isSameDocument;var index=_.findIndex(items,sameModelItem);items[index]={unreadCounter:unreadCounter,failure:failure,isSameDocument:isSameDocument,};}else{items.push({unreadCounter:unreadCounter,failure:failure,isSameDocument:true,});}});return _.map(items,function(item){var preview={};_.extend(preview,item.failure.getPreview(),{unreadCounter:item.unreadCounter,});if(!item.isSameDocument){preview.documentID=undefined;}
return preview;});},_getSystrayChannelPreviews:function(filter){var filteredThreads=_.filter(this._threads,function(thread){if(!thread.isChannel()){return false;}
if(filter==='chat'){return thread.isTwoUserThread();}else if(filter==='channels'){return!thread.isTwoUserThread();}
return true;});return this.getChannelPreviews(filteredThreads);},_getSystrayInboxPreviews:function(filter){if(filter==='mailbox_inbox'||!filter){var inbox=this.getMailbox('inbox');return inbox.getMessagePreviews();}else{return $.when([]);}},_getSystrayMailFailurePreviews:function(filter){if(filter==='mailbox_inbox'||!filter){return this._getMailFailurePreviews();}else{return $.when([]);}},_initializeInternalState:function(){this._cannedResponses=[];this._mailBus=new Bus(this);this._commands=[];this._discussMenuID=undefined;this._discussOpen=false;this._isMyselfModerator=false;this._mailFailures=[];this._mentionPartnerSuggestions=[];this._messages=[];this._moderatedChannelIDs=[];this._outOfFocusUnreadMessageCounter=0;this._pinnedDmPartners=[];this._threads=[];},_isDiscussOpen:function(){return this._discussOpen;},_joinAndAddChannel:function(channelID,options){var self=this;return this._rpc({model:'mail.channel',method:'channel_join_and_get_info',args:[[channelID]],}).then(function(result){return self._addChannel(result,options);});},_listenOnBuses:function(){this._mailBus.on('discuss_open',this,this._onDiscussOpen);this.call('bus_service','on','window_focus',this,this._onWindowFocus);},_makeChannel:function(data,options){if(_.size(data.direct_partner)>0){return new DMChat({parent:this,data:data,options:options,commands:this._commands});}
if(data.channel_type==='livechat'){return new Livechat({parent:this,data:data,options:options,commands:this._commands,});}
return new MultiUserChannel({parent:this,data:data,options:options,commands:this._commands,});},_makeMessage:function(data){return new Message(this,data);},_notifyIncomingMessage:function(message){if(this.call('bus_service','isOdooFocused')){return;}
var title=_t("New message");if(message.hasAuthor()){title=_.escape(message.getAuthorName());}
var content=mailUtils.parseAndTransform(message.getBody(),mailUtils.stripHTML).substr(0,PREVIEW_MSG_MAX_SIZE);if(!this.call('bus_service','isOdooFocused')){this._outOfFocusUnreadMessageCounter++;var tabTitle=_.str.sprintf(_t("%d Messages"),this._outOfFocusUnreadMessageCounter);this.trigger_up('set_title_part',{part:'_chat',title:tabTitle});}
this.call('bus_service','sendNotification',title,content);},_openThreadInDiscuss:function(threadID){var thread=this.getThread(threadID);this._mailBus.trigger('open_thread_in_discuss',thread);},_redirectDefault:function(resModel,resID){var self=this;this._rpc({model:resModel,method:'get_formview_id',args:[[resID],session.user_context],}).then(function(viewID){self._redirectToDocument(resModel,resID,viewID);});},_redirectToDocument:function(resModel,resID,viewID){this.do_action({type:'ir.actions.act_window',view_type:'form',view_mode:'form',res_model:resModel,views:[[viewID||false,'form']],res_id:resID,});},_redirectPartner:function(resModel,resID,dmRedirection){var self=this;var domain=[['partner_id','=',resID],['share','=',false]];this._rpc({model:'res.users',method:'search',args:[domain],}).then(function(userIDs){if(userIDs.length&&userIDs[0]!==session.uid&&dmRedirection){self.createChannel(resID,'dm_chat').then(dmRedirection);}else{self._redirectToDocument(resModel,resID);}});},_removeChannel:function(channel){if(!channel){return;}
if(channel.getType()==='dm_chat'){var index=this._pinnedDmPartners.indexOf(channel.getDirectPartnerID());if(index>-1){this._pinnedDmPartners.splice(index,1);this.call('bus_service','updateOption','bus_presence_partner_ids',this._pinnedDmPartners);}}
this._threads=_.without(this._threads,channel);},_removeMessageFromThread:function(threadID,message){message.removeThread(threadID);var thread=_.find(this._threads,function(thread){return thread.getID()===threadID;});thread.removeMessage(message.getID());},_resetOutOfFocusUnreadMessageCounter:function(){this._outOfFocusUnreadMessageCounter=0;},_searchPartnerFetch:function(searchVal,limit){return this._rpc({model:'res.partner',method:'im_search',args:[searchVal,limit||20],},{shadow:true});},_searchPartnerPrefetch:function(searchVal,limit){var values=[];var searchRegexp=new RegExp(_.str.escapeRegExp(mailUtils.unaccent(searchVal)),'i');_.each(this._mentionPartnerSuggestions,function(partners){if(values.length<limit){values=values.concat(_.filter(partners,function(partner){return(session.partner_id!==partner.id)&&searchRegexp.test(partner.name);})).splice(0,limit);}});return values;},_sortPreviews:function(previews){var res=previews.sort(function(p1,p2){var unreadDiff=Math.min(1,p2.unreadCounter)-Math.min(1,p1.unreadCounter);var datedDiff=!!p2.date-!!p1.date;var isTwoUserThreadDiff=p2.isTwoUserThread-p1.isTwoUserThread;var dateDiff=p2.date&&p2.date.diff(p1.date);return unreadDiff||datedDiff||isTwoUserThreadDiff||dateDiff;});return res;},_sortThreads:function(){this._threads=_.sortBy(this._threads,function(thread){var name=thread.getName();return _.isString(name)?name.toLowerCase():'';});},_updateCannedResponsesFromServer:function(data){var self=this;_.each(data.shortcodes,function(s){var cannedResponse=_.pick(s,['id','source','substitution']);self._cannedResponses.push(cannedResponse);});},_updateChannelsFromServer:function(data){var self=this;_.each(data.channel_slots,function(channels){_.each(channels,self._addChannel.bind(self));});},_updateCommandsFromServer:function(data){this._commands=_.map(data.commands,function(command){return _.extend({id:command.name},command);});},_updateInternalStateFromServer:function(result){this._updateCommandsFromServer(result);this._updateChannelsFromServer(result);this._updateModerationSettingsFromServer(result);this._updateMailboxesFromServer(result);this._updateMailFailuresFromServer(result);this._updateCannedResponsesFromServer(result);this._mentionPartnerSuggestions=result.mention_partner_suggestions;this._discussMenuID=result.menu_id;},_updateMailboxesFromServer:function(data){this._addMailbox({id:'inbox',name:_t("Inbox"),mailboxCounter:data.needaction_inbox_counter||0,});this._addMailbox({id:'starred',name:_t("Starred"),mailboxCounter:data.starred_counter||0,});if(data.is_moderator){this._addMailbox({id:'moderation',name:_t("Moderate Messages"),mailboxCounter:data.moderation_counter||0,});}},_updateMailFailuresFromServer:function(data){var self=this;this._mailFailures=_.map(data.mail_failures,function(mailFailureData){return new MailFailure(self,mailFailureData);});},_updateModerationSettingsFromServer:function(data){this._isMyselfModerator=data.is_moderator;this._moderatedChannelIDs=data.moderation_channel_ids;},_onDiscussOpen:function(open){this._discussOpen=open;},_onWindowFocus:function(){this._resetOutOfFocusUnreadMessageCounter();this.trigger_up('set_title_part',{part:'_chat'});},});return MailManager;});;

/* /mail/static/src/js/services/mail_document_thread_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Manager.DocumentThread',function(require){"use strict";var MailManager=require('mail.Manager');var DocumentThread=require('mail.model.DocumentThread');var session=require('web.session');MailManager.include({DOCUMENT_THREAD_MESSAGE_KEY:'mail.document_threads_last_message',DOCUMENT_THREAD_STATE_KEY:'mail.document_threads_state',start:function(){this._super.apply(this,arguments);this._documentThreadWindowStates={};this._tabId=this.call('bus_service','getTabId');var localStorageLength=this.call('local_storage','length');for(var i=0;i<localStorageLength;i++){var key=this.call('local_storage','key',i);if(key.indexOf(this.DOCUMENT_THREAD_STATE_KEY)===0){var documentThreadId=key.substring(this.DOCUMENT_THREAD_STATE_KEY.length+1);this._documentThreadWindowStates[documentThreadId]=this.call('local_storage','getItem',key);}}
this.isReady().then(this._updateDocumentThreadWindows.bind(this,this._documentThreadWindowStates));this.call('local_storage','onStorage',this,this._onStorage);},addMessage:function(data,options){var message=this.getMessage(data.id);if(!message&&options&&options.postedFromDocumentThread){var key=this.DOCUMENT_THREAD_MESSAGE_KEY;this.call('local_storage','setItem',key,{messageData:data,tabId:this._tabId,});}
return this._super.apply(this,arguments);},getDocumentThread:function(model,resID){return this.getThread(model+'_'+resID);},getOrAddDocumentThread:function(params){var thread=this.getDocumentThread(params.resModel,params.resID);if(!thread){thread=new DocumentThread({parent:this,data:{messageIDs:params.messageIDs,name:params.name,resID:params.resID,resModel:params.resModel,},});this._threads.push(thread);}else{if('messageIDs'in params){thread.setMessageIDs(params.messageIDs);}
if('name'in params&&params.name){thread.setName(params.name);}}
return thread;},openThread:function(threadID){var thread=this.getThread(threadID);if(thread&&thread.getType()==='document_thread'&&this._isDiscussOpen()){var resModel=thread.getDocumentModel();var resID=thread.getDocumentID();this._redirectToDocument(resModel,resID);}else{this._super.apply(this,arguments);}},updateDocumentThreadState:function(threadID,state){this._documentThreadWindowStates[threadID]=state;this.call('local_storage','setItem',this.DOCUMENT_THREAD_STATE_KEY+'/'+threadID,{state:state,tabId:this._tabId,});},_addNewMessagePostprocessThread:function(message){var resModel=message.getDocumentModel();var resID=message.getDocumentID();if(resModel&&resModel!=='mail.channel'&&resID){this.getOrAddDocumentThread({name:message.getDocumentName(),resID:resID,resModel:resModel,});}
this._super.apply(this,arguments);},_updateDocumentThreadWindows:function(documentThreadStates){var self=this;_.each(documentThreadStates,function(state,key){var info=key.split('_');var documentThread=self.getOrAddDocumentThread({name:state.name,resID:parseInt(info[1]),resModel:info[0],});if(state.windowState==='closed'){documentThread.close({skipCrossTabSync:true,});}else{documentThread.fold(state.windowState==='folded',{skipCrossTabSync:true,});self.openThreadWindow(documentThread.getID(),{keepFoldState:true,skipCrossTabSync:true,});}});},_onStorage:function(ev){var value;try{value=JSON.parse(ev.newValue);}catch(err){return;}
if(ev.key.indexOf(this.DOCUMENT_THREAD_STATE_KEY)===0){if(value.tabId===this._tabId){return;}
var documentThreadId=ev.key.substring(this.DOCUMENT_THREAD_STATE_KEY.length+1);var param={};param[documentThreadId]=value.state;this._updateDocumentThreadWindows(param);}else if(ev.key===this.DOCUMENT_THREAD_MESSAGE_KEY){if(value.tabId===this._tabId){return;}
if(value.messageData){this.addMessage(value.messageData);}}},});return MailManager;});;

/* /mail/static/src/js/services/mail_notification_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Manager.Notification',function(require){"use strict";var MailManager=require('mail.Manager');var MailFailure=require('mail.model.MailFailure');var core=require('web.core');var session=require('web.session');var _t=core._t;MailManager.include({_filterNotificationsOnUnsubscribe:function(notifications){var unsubscribedNotif=_.find(notifications,function(notif){return notif[1].info==='unsubscribe';});if(unsubscribedNotif){notifications=_.reject(notifications,function(notif){return notif[0][1]==='mail.channel'&&notif[0][2]===unsubscribedNotif[1].id;});}
return notifications;},_handleChannelNotification:function(params){if(params.data&&params.data.info==='typing_status'){this._handleChannelTypingNotification(params.channelID,params.data);}else{this._handleChannelMessageNotification(params.data);}},_handleChannelMessageNotification:function(messageData){var self=this;var def;var channelAlreadyInCache=true;if(messageData.channel_ids.length===1){channelAlreadyInCache=!!this.getChannel(messageData.channel_ids[0]);def=this.joinChannel(messageData.channel_ids[0],{autoswitch:false});}else{def=$.when();}
def.then(function(){self.addMessage(messageData,{showNotification:true,incrementUnread:channelAlreadyInCache});});},_handleChannelTypingNotification:function(channelID,typingData){var isWebsiteUser=typingData.is_website_user;var partnerID=typingData.partner_id;if(partnerID===session.partner_id&&!isWebsiteUser){return;}
var channel=this.getChannel(channelID);if(!channel){return;}
var typingID={isWebsiteUser:typingData.is_website_user,partnerID:typingData.partner_id,};if(typingData.is_typing){channel.registerTyping(typingID);}else{channel.unregisterTyping(typingID);}},_handleNeedactionNotification:function(messageData){var self=this;var inbox=this.getMailbox('inbox');var message=this.addMessage(messageData,{incrementUnread:true,showNotification:true,});inbox.incrementMailboxCounter();_.each(message.getThreadIDs(),function(threadID){var channel=self.getChannel(threadID);if(channel){channel.incrementNeedactionCounter();}});this._mailBus.trigger('update_needaction',inbox.getMailboxCounter());},_handlePartnerActivityUpdateNotification:function(data){this._mailBus.trigger('activity_updated',data);},_handlePartnerChannelSeenNotification:function(data){var channel=this.getChannel(data.id);if(channel){channel.setLastSeenMessageID(data.last_message_id);if(channel.hasUnreadMessages()){channel.resetUnreadCounter();}}},_handlePartnerChannelNotification:function(channelData){if((channelData.channel_type==='channel')&&(channelData.state==='open')){this._addChannel(channelData,{autoswitch:false});if(!channelData.is_minimized&&channelData.info!=='creation'){this.do_notify(_t("Invitation"),_.str.sprintf(_t("You have been invited to: %s"),_.escape(channelData.name)));}}
var channel=this.getChannel(channelData.id);if(channel&&channelData.info!=='join'){channel.updateWindowState({folded:channelData.state==='folded'?true:false,detached:channelData.is_minimized,});}},_handlePartnerMailFailureNotification:function(datas){var self=this;_.each(datas.elements,function(data){var isNewFailure=_.some(data.notifications,function(notif){return notif[0]==='exception'||notif[0]==='bounce';});var matchedFailure=_.find(self._mailFailures,function(failure){return failure.getMessageID()===data.message_id;});if(matchedFailure){var index=_.findIndex(self._mailFailures,matchedFailure);if(isNewFailure){self._mailFailures[index]=new MailFailure(self,data);}else{self._mailFailures.splice(index,1);}}else if(isNewFailure){self._mailFailures.push(new MailFailure(self,data));}
var message=_.find(self._messages,function(msg){return msg.getID()===data.message_id;});if(message){if(isNewFailure){message.updateCustomerEmailStatus('exception');}else{message.updateCustomerEmailStatus('sent');}
self._updateMessageNotificationStatus(data,message);self._mailBus.trigger('update_message',message);}});this._mailBus.trigger('update_needaction',this.needactionCounter);},_handlePartnerMarkAsReadNotification:function(data){var self=this;_.each(data.message_ids,function(messageID){var message=_.find(self._messages,function(msg){return msg.getID()===messageID;});if(message){self._removeMessageFromThread('mailbox_inbox',message);self._mailBus.trigger('update_message',message,data.type);}});if(data.channel_ids){_.each(data.channel_ids,function(channelID){var channel=self.getChannel(channelID);if(channel){channel.decrementNeedactionCounter(data.message_ids.length,0);}});}else{_.each(this.getChannels(),function(channel){channel.resetNeedactionCounter();});}
var inbox=this.getMailbox('inbox');inbox.decrementMailboxCounter(data.message_ids.length);this._mailBus.trigger('update_needaction',inbox.getMailboxCounter());},_handlePartnerMessageAuthorNotification:function(data){this.addMessage(data.message);},_handlePartnerMessageDeletionNotification:function(data){var self=this;_.each(data.message_ids,function(messageID){var message=self.getMessage(messageID);if(message){message.setModerationStatus('rejected');}});},_handlePartnerMessageModeratorNotification:function(data){this.addMessage(data.message);this._mailBus.trigger('update_moderation_counter');},_handlePartnerNotification:function(data){if(data.info==='unsubscribe'){this._handlePartnerUnsubscribeNotification(data);}else if(data.type==='toggle_star'){this._handlePartnerToggleStarNotification(data);}else if(data.type==='mark_as_read'){this._handlePartnerMarkAsReadNotification(data);}else if(data.type==='moderator'){this._handlePartnerMessageModeratorNotification(data);}else if(data.type==='author'){this._handlePartnerMessageAuthorNotification(data);}else if(data.type==='deletion'){this._handlePartnerMessageDeletionNotification(data);}else if(data.info==='channel_seen'){this._handlePartnerChannelSeenNotification(data);}else if(data.info==='transient_message'){this._handlePartnerTransientMessageNotification(data);}else if(data.type==='activity_updated'){this._handlePartnerActivityUpdateNotification(data);}else if(data.type==='mail_failure'){this._handlePartnerMailFailureNotification(data);}else if(data.type==='user_connection'){this._handlePartnerUserConnectionNotification(data);}else if(data.type==='simple_notification'){var title=_.escape(data.title),message=_.escape(data.message);data.warning?this.do_warn(title,message,data.sticky):this.do_notify(title,message,data.sticky);}else{this._handlePartnerChannelNotification(data);}},_handlePartnerToggleStarNotification:function(data){var self=this;var starred=this.getMailbox('starred');_.each(data.message_ids,function(messageID){var message=_.find(self._messages,function(msg){return msg.getID()===messageID;});if(message){message.setStarred(data.starred);if(!message.isStarred()){self._removeMessageFromThread('mailbox_starred',message);}else{self._addMessageToThreads(message,[]);var channelStarred=self.getMailbox('starred');channelStarred.invalidateCaches();}
self._mailBus.trigger('update_message',message);}});if(data.starred){starred.incrementMailboxCounter(data.message_ids.length);}else{starred.decrementMailboxCounter(data.message_ids.length);}
this._mailBus.trigger('update_starred',starred.getMailboxCounter());},_handlePartnerTransientMessageNotification:function(data){var lastMessage=_.last(this._messages);data.id=(lastMessage?lastMessage.getID():0)+0.01;data.author_id=data.author_id||this.getOdoobotID();this.addMessage(data);},_handlePartnerUnsubscribeNotification:function(data){var channel=this.getChannel(data.id);if(channel){var message;if(_.contains(['public','private'],channel.getType())){message=_.str.sprintf(_t("You unsubscribed from <b>%s</b>."),_.escape(channel.getName()));}else{message=_.str.sprintf(_t("You unpinned your conversation with <b>%s</b>."),_.escape(channel.getName()));}
this._removeChannel(channel);this._mailBus.trigger('unsubscribe_from_channel',data.id);this.do_notify(_t("Unsubscribed"),message);}},_handlePartnerUserConnectionNotification:function(data){var self=this;var partnerID=data.partner_id;this.call('bus_service','sendNotification',data.title,data.message,function(){self.call('mail_service','openDMChatWindowFromBlankThreadWindow',partnerID);});},_handlePresenceNotification:function(data){var dmChat=this.getDMChatFromPartnerID(data.id);if(dmChat){dmChat.setStatus(data.im_status);this._mailBus.trigger('update_dm_presence',dmChat);}},_listenOnBuses:function(){this._super.apply(this,arguments);this.call('bus_service','onNotification',this,this._onNotification);},_updateMessageNotificationStatus:function(data,message){_.each(data.notifications,function(notif,id){var partnerName=notif[1];var notifStatus=notif[0];var res=_.find(message.getCustomerEmailData(),function(entry){return entry[0]===parseInt(id);});if(res){res[2]=notifStatus;}else{message.addCustomerEmailData([parseInt(id),partnerName,notifStatus]);}});},_onNotification:function(notifs){var self=this;notifs=this._filterNotificationsOnUnsubscribe(notifs);_.each(notifs,function(notif){var model=notif[0][1];if(model==='ir.needaction'){self._handleNeedactionNotification(notif[1]);}else if(model==='mail.channel'){self._handleChannelNotification({channelID:notif[0][2],data:notif[1],});}else if(model==='res.partner'){self._handlePartnerNotification(notif[1]);}else if(model==='bus.presence'){self._handlePresenceNotification(notif[1]);}});},});return MailManager;});;

/* /mail/static/src/js/services/mail_window_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Manager.Window',function(require){"use strict";var MailManager=require('mail.Manager');var ThreadWindow=require('mail.ThreadWindow');var config=require('web.config');var core=require('web.core');var utils=require('web.utils');var QWeb=core.qweb;var _t=core._t;MailManager.include({custom_events:_.extend({},MailManager.prototype.custom_events,{close_blank_thread_window:'_onCloseBlankThreadWindow',}),HIDDEN_THREAD_WINDOW_DROPDOWN_BUTTON_WIDTH:50,THREAD_WINDOW_APPENDTO:'body',THREAD_WINDOW_WIDTH:325+5,openBlankThreadWindow:function(){var blankThreadWindow=this._getBlankThreadWindow();if(!blankThreadWindow){blankThreadWindow=new ThreadWindow(this,null);this._addThreadWindow(blankThreadWindow);blankThreadWindow.appendTo(this.THREAD_WINDOW_APPENDTO).then(this._repositionThreadWindows.bind(this));}else{if(blankThreadWindow.isHidden()){this._makeThreadWindowVisible(blankThreadWindow);}else if(blankThreadWindow.isFolded()){blankThreadWindow.toggleFold(false);}}},openDMChatWindowFromBlankThreadWindow:function(partnerID){var dmChat=this.getDMChatFromPartnerID(partnerID);if(!dmChat){this._openAndDetachDMChat(partnerID);}else{this.openThreadWindow(dmChat.getID());}
this._closeBlankThreadWindow();},openThread:function(threadID){if(!this._isDiscussOpen()){var thread=this.getThread(threadID);if(thread){thread.detach();}}else{this._super.apply(this,arguments);}},openThreadWindow:function(threadID,options){var self=this;options=options||{};var thread=this.getThread(threadID);if(thread.isCreatingWindow){return;}
var threadWindow=this._getThreadWindow(threadID);var def=$.when();if(!threadWindow){thread.isCreatingWindow=true;def=thread.fetchMessages().then(function(){threadWindow=self._makeNewThreadWindow(thread,options);self._placeNewThreadWindow(threadWindow,options.passively);return threadWindow.appendTo($(self.THREAD_WINDOW_APPENDTO));}).then(function(){self._repositionThreadWindows();threadWindow.render();threadWindow.scrollToBottom();if(!self._areAllThreadWindowsHidden()&&!thread.isFolded()&&!threadWindow.isPassive()){thread.markAsRead();}}).fail(function(){thread.close({skipCrossTabSync:true,});}).always(function(){thread.isCreatingWindow=false;});}
def.then(function(){threadWindow.updateVisualFoldState();});},updateThreadWindow:function(threadID,options){var thread=this.getThread(threadID);if(thread){if(thread.isDetached()){_.extend(options,{keepFoldState:true});this.openThreadWindow(threadID,options);}else{this._closeThreadWindow(threadID);}}},_addThreadWindow:function(threadWindow){this._threadWindows.push(threadWindow);this._computeAvailableSlotsForThreadWindows();this._threadWindows.pop();this._threadWindows.splice(this._availableSlotsForThreadWindows-1,0,threadWindow);},_areAllThreadWindowsHidden:function(){return $(this.THREAD_WINDOW_APPENDTO).hasClass('o_no_thread_window');},_closeThreadWindow:function(threadID){var threadWindow=_.find(this._threadWindows,function(threadWindow){return threadWindow.getID()===threadID;});if(threadWindow){this._threadWindows=_.without(this._threadWindows,threadWindow);this._repositionThreadWindows();threadWindow.destroy();}},_closeBlankThreadWindow:function(){var blankThreadWindow=this._getBlankThreadWindow();if(blankThreadWindow){this._closeThreadWindow(blankThreadWindow.getID());}},_computeAvailableSlotsForThreadWindows:function(){if(config.device.isMobile){this._availableSlotsForThreadWindows=1;return;}
var GLOBAL_WIDTH=this._getGlobalWidth();var THREAD_WINDOW_NUM=this._threadWindows.length;var availableSlots=Math.floor(GLOBAL_WIDTH/this.THREAD_WINDOW_WIDTH);var spaceLeft=GLOBAL_WIDTH-(Math.min(availableSlots,THREAD_WINDOW_NUM)*this.THREAD_WINDOW_WIDTH);if(availableSlots<THREAD_WINDOW_NUM&&spaceLeft<this.HIDDEN_THREAD_WINDOW_DROPDOWN_BUTTON_WIDTH){availableSlots--;spaceLeft+=this.THREAD_WINDOW_WIDTH;}
this._availableSlotsForThreadWindows=availableSlots;this._spaceLeftForThreadWindows=spaceLeft;},_getBlankThreadWindow:function(){return _.find(this._threadWindows,function(threadWindow){return threadWindow.getID()==='_blank';});},_getGlobalWidth:function(){return window.innerWidth;},_getHiddenThreadWindow:function(threadID){return _.find(this._hiddenThreadWindows,function(threadWindow){return threadWindow.getID()===threadID;});},_getThreadWindow:function(threadID){return _.find(this._threadWindows,function(threadWindow){return threadWindow.getID()===threadID;});},_initializeInternalState:function(){this._super.apply(this,arguments);this._availableSlotsForThreadWindows=0;this._hiddenThreadWindows=[];this._keepHiddenThreadWindowsDropdownOpen=false;this._spaceLeftForThreadWindows=0;this._threadWindows=[];this._$hiddenThreadWindowsDropdown=null;},_listenOnBuses:function(){this._super.apply(this,arguments);this._mailBus.on('update_message',this,this._onUpdateMessage).on('new_message',this,this._onNewMessage).on('new_channel',this,this._onNewChannel).on('is_thread_bottom_visible',this,this._onIsThreadBottomVisible).on('unsubscribe_from_channel',this,this._onUnsubscribeFromChannel).on('update_thread_unread_counter',this,this._onUpdateThreadUnreadCounter).on('update_dm_presence',this,this._onUpdateDmPresence).on('update_typing_partners',this,this._onTypingPartnersUpdated);core.bus.on('resize',this,_.debounce(this._repositionThreadWindows.bind(this),100));},_makeHiddenThreadWindowsDropdown:function(){var self=this;if(this._$hiddenThreadWindowsDropdown){this._$hiddenThreadWindowsDropdown.remove();}
if(this._hiddenThreadWindows.length){this._$hiddenThreadWindowsDropdown=this._renderHiddenThreadWindowsDropdown();var $hiddenWindowsDropdown=this._$hiddenThreadWindowsDropdown;$hiddenWindowsDropdown.css({right:this.THREAD_WINDOW_WIDTH*this._availableSlotsForThreadWindows,bottom:0}).appendTo(this.THREAD_WINDOW_APPENDTO);this._repositionHiddenWindowsDropdown();this._keepHiddenThreadWindowsDropdownOpen=false;$hiddenWindowsDropdown.on('click','.o_thread_window_header',function(ev){var threadID=$(ev.currentTarget).data('thread-id');var threadWindow=self._getHiddenThreadWindow(threadID);if(threadWindow){self._makeThreadWindowVisible(threadWindow);}}).on('click','.o_thread_window_close',function(ev){ev.preventDefault();var threadID=$(ev.currentTarget).closest('.o_thread_window_header').data('thread-id');var threadWindow=self._getHiddenThreadWindow(threadID);if(threadWindow){threadWindow.close();self._keepHiddenThreadWindowsDropdownOpen=true;}});}},_makeNewThreadWindow:function(thread,options){return new ThreadWindow(this,thread,_.extend(options,{autofocus:!options.passively,}));},_makeThreadWindowVisible:function(threadWindow){utils.swap(this._threadWindows,threadWindow,this._threadWindows[this._availableSlotsForThreadWindows-1]);this._repositionThreadWindows();threadWindow.toggleFold(false);},_openAndDetachDMChat:function(partnerID){return this._rpc({model:'mail.channel',method:'channel_get_and_minimize',args:[[partnerID]],}).then(this._addChannel.bind(this));},_placeNewThreadWindow:function(threadWindow,passively){var thread=this.getThread(threadWindow.getID());var blankThreadWindow=this._getBlankThreadWindow();if(blankThreadWindow&&thread.getType()==='dm_chat'&&thread.getDirectPartnerID()===blankThreadWindow.directPartnerID){var index=_.indexOf(this._threadWindows,blankThreadWindow);this._threadWindows[index]=threadWindow;blankThreadWindow.destroy();}else if(passively){this._threadWindows.push(threadWindow);}else{this._addThreadWindow(threadWindow);}},_repositionHiddenWindowsDropdown:function(){var $dropdownUL=this._$hiddenThreadWindowsDropdown.children('ul');if(this._spaceLeftForThreadWindows>$dropdownUL.width()+10){$dropdownUL.addClass('dropdown-menu-right');}},_renderHiddenThreadWindowsDropdown:function(){var $dropdown=$(QWeb.render('mail.HiddenThreadWindowsDropdown',{threadWindows:this._hiddenThreadWindows,open:this._keepHiddenThreadWindowsDropdownOpen,unreadCounter:this._hiddenThreadWindowsUnreadCounter,widget:{isMobile:function(){return config.device.isMobile;},},}));return $dropdown;},_repositionHiddenThreadWindows:function(){var hiddenWindows=[];var hiddenUnreadCounter=0;var index=this._availableSlotsForThreadWindows;while(index<this._threadWindows.length){var threadWindow=this._threadWindows[index];hiddenWindows.push(threadWindow);hiddenUnreadCounter+=threadWindow.getUnreadCounter();threadWindow.do_hide();index++;}
this._hiddenThreadWindows=hiddenWindows;this._hiddenThreadWindowsUnreadCounter=hiddenUnreadCounter;this._makeHiddenThreadWindowsDropdown();},_repositionThreadWindows:function(){this._computeAvailableSlotsForThreadWindows();this._repositionVisibleThreadWindows();this._repositionHiddenThreadWindows();},_repositionVisibleThreadWindows:function(){var index=0;while(index<this._availableSlotsForThreadWindows&&index<this._threadWindows.length){var threadWindow=this._threadWindows[index];var cssProps={bottom:0};cssProps[_t.database.parameters.direction==='rtl'?'left':'right']=this.THREAD_WINDOW_WIDTH*index;threadWindow.$el.css(cssProps);threadWindow.do_show();index++;}},_updateThreadWindowsFromMessage:function(message,options){_.each(this._threadWindows,function(threadWindow){if(_.contains(message.getThreadIDs(),threadWindow.getID())){threadWindow.update(options);}});},_onCloseBlankThreadWindow:function(){this._closeBlankThreadWindow();},_onDiscussOpen:function(open){this._super.apply(this,arguments);if(open){$(this.THREAD_WINDOW_APPENDTO).addClass('o_no_thread_window');}else{$(this.THREAD_WINDOW_APPENDTO).removeClass('o_no_thread_window');this._repositionThreadWindows();}},_onIsThreadBottomVisible:function(thread,query){_.each(this._threadWindows,function(threadWindow){if(thread.getID()===threadWindow.getID()&&threadWindow.isAtBottom()&&!threadWindow.isHidden()){query.isVisible=true;}});},_onNewChannel:function(channel){if(channel.isDetached()){this.openThreadWindow(channel.getID(),{keepFoldState:true,passively:true});}else{this._closeThreadWindow(channel.getID());}},_onNewMessage:function(message){this._updateThreadWindowsFromMessage(message,{keepBottom:true,passively:true});},_onTypingPartnersUpdated:function(threadID){var threadWindow=this._getThreadWindow(threadID);if(!threadWindow){return;}
var thread=this.getThread(threadID);if(thread.isChannel()){thread.getMentionPartnerSuggestions().then(function(){threadWindow.renderTypingNotificationBar();});}},_onUnsubscribeFromChannel:function(channelID){this._closeThreadWindow(channelID);},_onUpdateThreadUnreadCounter:function(thread){var self=this;this._hiddenThreadWindowsUnreadCounter=0;_.each(this._threadWindows,function(threadWindow){if(thread.getID()===threadWindow.getID()){threadWindow.renderHeader();if(thread.getUnreadCounter()===0){threadWindow.removePassive();}}
if(threadWindow.isHidden()){self._hiddenThreadWindowsUnreadCounter+=threadWindow.getUnreadCounter();}});if(this._$hiddenThreadWindowsDropdown){this._$hiddenThreadWindowsDropdown.html(this._renderHiddenThreadWindowsDropdown().html());this._repositionHiddenWindowsDropdown();}},_onUpdateDmPresence:function(thread){_.each(this._threadWindows,function(threadWindow){if(thread.getID()===threadWindow.getID()){threadWindow.renderHeader();}});},_onUpdateMessage:function(message){this._updateThreadWindowsFromMessage(message,{keepBottom:false});},});return MailManager;});;

/* /mail/static/src/js/services/mail_service.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Service',function(require){"use strict";var core=require('web.core');var MailManager=require('mail.Manager');require('mail.Manager.Notification');require('mail.Manager.Window');require('mail.Manager.DocumentThread');core.serviceRegistry.add('mail_service',MailManager);return MailManager;});;

/* /mail/static/src/js/models/mail_failure.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.MailFailure',function(require){"use strict";var Class=require('web.Class');var core=require('web.core');var Mixins=require('web.mixins');var ServicesMixin=require('web.ServicesMixin');var time=require('web.time');var _t=core._t;var MailFailure=Class.extend(Mixins.EventDispatcherMixin,ServicesMixin,{init:function(parent,data){Mixins.EventDispatcherMixin.init.call(this,arguments);this.setParent(parent);this._documentID=data.res_id;this._documentModel=data.model;this._lastMessageDate=moment();this._messageID=data.message_id;this._modelName=data.model_name;this._moduleIcon=data.module_icon;this._notifications=data.notifications;this._recordName=data.record_name;this._uuid=data.uuid;if(data.last_message_date){this._lastMessageDate=moment(time.str_to_datetime(data.last_message_date));}},getDocumentModel:function(){return this._documentModel;},getDocumentID:function(){return this._documentID;},getMessageID:function(){return this._messageID;},getPreview:function(){var preview={body:_t("An error occured when sending an email"),date:this._lastMessageDate,documentID:this._documentID,documentModel:this._documentModel,id:'mail_failure',imageSRC:this._moduleIcon,title:this._modelName,};return preview;},isLinkedToDocument:function(){return!!(this._documentModel&&this._documentID);},});return MailFailure;});;

/* /mail/static/src/js/models/messages/abstract_message.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.AbstractMessage',function(require){"use strict";var mailUtils=require('mail.utils');var Class=require('web.Class');var core=require('web.core');var session=require('web.session');var time=require('web.time');var _t=core._t;var AbstractMessage=Class.extend({init:function(parent,data){this._attachmentIDs=data.attachment_ids||[];this._body=data.body||"";this._date=data.date?moment(time.str_to_datetime(data.date)):moment();this._id=data.id;this._isDiscussion=data.is_discussion;this._isNotification=data.is_notification;this._serverAuthorID=data.author_id;this._type=data.message_type||undefined;this._processAttachmentURL();this._attachmentIDs.forEach(function(attachment){attachment.filename=attachment.filename||attachment.name||_t("unnamed");});},getAttachments:function(){return this._attachmentIDs;},getAuthorID:function(){if(!this.hasAuthor()){return-1;}
return this._serverAuthorID[0];},getAvatarSource:function(){},getBody:function(){return this._body;},getDate:function(){return this._date;},getDateDay:function(){var date=this.getDate().format('YYYY-MM-DD');if(date===moment().format('YYYY-MM-DD')){return _t("Today");}else if(date===moment().subtract(1,'days').format('YYYY-MM-DD')){return _t("Yesterday");}
return this.getDate().format('LL');},getDisplayedAuthor:function(){return this.hasAuthor()?this._getAuthorName():null;},getID:function(){return this._id;},getImageAttachments:function(){return _.filter(this.getAttachments(),function(attachment){return attachment.mimetype&&attachment.mimetype.split('/')[0]==='image';});},getNonImageAttachments:function(){return _.difference(this.getAttachments(),this.getImageAttachments());},getTimeElapsed:function(){return mailUtils.timeFromNow(this.getDate());},getType:function(){return this._type;},hasAttachments:function(){return this.getAttachments().length>0;},hasAuthor:function(){return!!(this._serverAuthorID&&this._serverAuthorID[0]);},hasCustomerEmailData:function(){return false;},hasEmailFrom:function(){return false;},hasImageAttachments:function(){return _.some(this.getAttachments(),function(attachment){return attachment.mimetype&&attachment.mimetype.split('/')[0]==='image';});},hasNonImageAttachments:function(){return _.some(this.getAttachments(),function(attachment){return!(attachment.mimetype&&attachment.mimetype.split('/')[0]==='image');});},originatesFromChannel:function(){return false;},hasSubject:function(){return false;},hasSubtypeDescription:function(){return false;},hasTrackingValues:function(){return false;},isDiscussion:function(){return this._isDiscussion;},isLinkedToDocumentThread:function(){return false;},isNeedaction:function(){return false;},isNote:function(){return this._isNote;},isNotification:function(){return this._isNotification;},isStarred:function(){return false;},isSystemNotification:function(){return false;},needsModeration:function(){return false;},removeAttachments:function(attachmentIDs){this._attachmentIDs=_.reject(this._attachmentIDs,function(attachment){return _.contains(attachmentIDs,attachment.id);});},shouldRedirectToAuthor:function(){return!this._isMyselfAuthor();},_getAuthorName:function(){if(!this.hasAuthor()){return"";}
return this._serverAuthorID[1];},_isMyselfAuthor:function(){return this.hasAuthor()&&(this.getAuthorID()===session.partner_id);},_processAttachmentURL:function(){_.each(this.getAttachments(),function(attachment){attachment.url='/web/content/'+attachment.id+'?download=true';});},});return AbstractMessage;});;

/* /mail/static/src/js/models/messages/message.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.Message',function(require){"use strict";var emojis=require('mail.emojis');var AbstractMessage=require('mail.model.AbstractMessage');var mailUtils=require('mail.utils');var core=require('web.core');var Mixins=require('web.mixins');var ServicesMixin=require('web.ServicesMixin');var session=require('web.session');var _t=core._t;var Message=AbstractMessage.extend(Mixins.EventDispatcherMixin,ServicesMixin,{init:function(parent,data,emojis){this._super.apply(this,arguments);Mixins.EventDispatcherMixin.init.call(this,arguments);this.setParent(parent);this._customerEmailData=data.customer_email_data||[];this._customerEmailStatus=data.customer_email_status;this._documentModel=data.model;this._documentName=data.record_name;this._documentID=data.res_id;this._emailFrom=data.email_from;this._info=data.info;this._isNote=data.is_note;this._moduleIcon=data.module_icon;this._needactionPartnerIDs=data.needaction_partner_ids||[];this._starredPartnerIDs=data.starred_partner_ids||[];this._subject=data.subject;this._subtypeDescription=data.subtype_description;this._threadIDs=data.channel_ids||[];this._trackingValueIDs=data.tracking_value_ids;this._moderationStatus=data.moderation_status||'accepted';this._processBody(emojis);this._processMailboxes();this._processModeration();this._processDocumentThread();this._processTrackingValues();},addCustomerEmailData:function(data){this._customerEmailData.push(data);},getAuthorName:function(){return this._getAuthorName();},getAvatarSource:function(){if(this._isOdoobotAuthor()){return'/mail/static/src/img/odoobot.png';}else if(this.hasAuthor()){return'/web/image/res.partner/'+this.getAuthorID()+'/image_small';}else if(this.getType()==='email'){return'/mail/static/src/img/email_icon.png';}
return'/mail/static/src/img/smiley/avatar.jpg';},getCustomerEmailData:function(){if(!this.hasCustomerEmailData()){return undefined;}
return this._customerEmailData;},getCustomerEmailStatus:function(){if(!this.hasCustomerEmailData()){return undefined;}
return this._customerEmailStatus;},getDisplayedAuthor:function(){var res=this._super.apply(this,arguments);if(res){return res;}else{return this.hasEmailFrom()?this.getEmailFrom():_t("Anonymous");}},getDocumentID:function(){return this._documentID;},getDocumentModel:function(){return this._documentModel;},getDocumentName:function(){if(!this.isLinkedToDocumentThread()){return"";}
var model=this.getDocumentModel();var id=this.getDocumentID();var documentThread=this.call('mail_service','getDocumentThread',model,id);if(documentThread){this._documentName=documentThread.getName();}
return this._documentName;},getEmailFrom:function(){if(!this.hasEmailFrom()){return"";}
return this._emailFrom;},getOriginChannelID:function(){if(!this.originatesFromChannel()){return-1;}
return this._documentID;},getOriginChannelName:function(){if(!this.originatesFromChannel()){return"";}
var originChannelID=this.getOriginChannelID();var channel=originChannelID&&this.call('mail_service','getChannel',originChannelID);if(!channel){return"";}
return channel.getName();},getPreview:function(){var id,title;if(this.isLinkedToDocumentThread()){id=this.getDocumentModel()+'_'+this.getDocumentID();title=this.getDocumentName();}else{id='mailbox_inbox';title=this.hasSubject()?this.getSubject():this.getDisplayedAuthor();}
return{author:this.getDisplayedAuthor(),body:mailUtils.parseAndTransform(this.getBody(),mailUtils.inline),date:this.getDate(),documentModel:this.getDocumentModel(),documentID:this.getDocumentID(),id:id,imageSRC:this._getModuleIcon()||this.getAvatarSource(),messageID:this.getID(),status:this.status,title:title,};},getSubject:function(){if(!this.hasSubject()){return"";}
return this._subject;},getSubtypeDescription:function(){return this._subtypeDescription;},getThreadIDs:function(){return this._threadIDs;},getTrackingValues:function(){if(!this.hasTrackingValues()){return undefined;}
return this._trackingValueIDs;},getURL:function(){return session.url('/mail/view?message_id='+this._id);},hasCustomerEmailData:function(){return!!(this._customerEmailData&&(this._customerEmailData.length>0));},hasEmailFrom:function(){return!!(this._emailFrom);},hasSubject:function(){return!!(this._subject);},hasSubtypeDescription:function(){return!!(this._subtypeDescription);},hasTrackingValues:function(){return!!(this._trackingValueIDs&&(this._trackingValueIDs.length>0));},isLinkedToDocumentThread:function(){return!!(this._documentModel!=='mail.channel'&&this._documentID);},isMyselfAuthor:function(){return this._isMyselfAuthor();},needsModeration:function(){return this._moderationStatus==='pending_moderation';},needsModerationByUser:function(){return _.contains(this._threadIDs,'mailbox_moderation');},isNeedaction:function(){return _.contains(this._threadIDs,'mailbox_inbox');},isStarred:function(){return _.contains(this._threadIDs,'mailbox_starred');},isSystemNotification:function(){return(this.getType()==='notification'&&this._documentModel==='mail.channel')||this._isTransient();},originatesFromChannel:function(){return this._documentModel==='mail.channel';},removeThread:function(threadID){this._threadIDs=_.without(this._threadIDs,threadID);},setModerationStatus:function(newModerationStatus,options){var self=this;if(newModerationStatus===this._moderationStatus){return;}
this._moderationStatus=newModerationStatus;if(newModerationStatus==='accepted'&&options){_.each(options.additionalThreadIDs,function(threadID){self._addThread(threadID);});}
this._warnMessageModerated();},setStarred:function(starred){if(starred){this._addThread('mailbox_starred');}else{this.removeThread('mailbox_starred');}},shouldDisplaySubject:function(){return this.hasSubject()&&this.getType()!=='notification'&&!this.originatesFromChannel();},shouldRedirectToAuthor:function(){return this._super.apply(this,arguments)&&!this._isOdoobotAuthor();},toggleStarStatus:function(){return this._rpc({model:'mail.message',method:'toggle_message_starred',args:[[this._id]],});},updateCustomerEmailStatus:function(newCustomerEmailStatus){this._customerEmailStatus=newCustomerEmailStatus;},_addThread:function(threadID){if(!this._threadIDs){this._threadIDs=[];}
this._threadIDs.push(threadID);this._threadIDs=_.uniq(this._threadIDs);},_getAuthorName:function(){if(this._isOdoobotAuthor()){return"OdooBot";}
return this._super.apply(this,arguments);},_getModuleIcon:function(){return this._moduleIcon;},_isOdoobotAuthor:function(){return this._serverAuthorID===this.call('mail_service','getOdoobotID');},_isTransient:function(){return this._info==='transient_message';},_processBody:function(){var self=this;_.each(emojis,function(emoji){var unicode=emoji.unicode;var regexp=new RegExp("(?:^|\\s|<[a-z]*>)("+unicode+")(?=\\s|$|</[a-z]*>)",'g');var originalBody=self._body;self._body=self._body.replace(regexp,' <span class="o_mail_emoji">'+unicode+'</span> ');if(_.str.count(self._body,'o_mail_emoji')>200){self._body=originalBody;}});self._body=mailUtils.parseAndTransform(self._body,mailUtils.addLink);},_processDocumentThread:function(){if(!this.isLinkedToDocumentThread()){return;}
var resModel=this.getDocumentModel();var resID=this.getDocumentID();var documentThread=this.call('mail_service','getOrAddDocumentThread',{resModel:resModel,resID:resID,name:this.getDocumentName(),});this._threadIDs.push(documentThread.getID());},_processMailboxes:function(){if(_.contains(this._needactionPartnerIDs,session.partner_id)){this._setNeedaction(true);}
if(_.contains(this._starredPartnerIDs,session.partner_id)){this.setStarred(true);}
if(this.originatesFromChannel()&&_.contains(this.call('mail_service','getModeratedChannelIDs'),this.getOriginChannelID())&&this.needsModeration()){this._setModeratedByUser(true);}},_processModeration:function(){if(this.needsModeration()){this._threadIDs.push(this.getOriginChannelID());}},_processTrackingValues:function(){if(this.hasTrackingValues()){_.each(this.getTrackingValues(),function(trackingValue){if(trackingValue.field_type==='datetime'){if(trackingValue.old_value){trackingValue.old_value=moment.utc(trackingValue.old_value).local().format('LLL');}
if(trackingValue.new_value){trackingValue.new_value=moment.utc(trackingValue.new_value).local().format('LLL');}}else if(trackingValue.field_type==='date'){if(trackingValue.old_value){trackingValue.old_value=moment(trackingValue.old_value).local().format('LL');}
if(trackingValue.new_value){trackingValue.new_value=moment(trackingValue.new_value).local().format('LL');}}});}},_setModeratedByUser:function(moderated){if(moderated){this._addThread('mailbox_moderation');}else{this.removeThread('mailbox_moderation');}},_setNeedaction:function(needaction){if(needaction){this._addThread('mailbox_inbox');}else{this.removeThread('mailbox_inbox');}},_warnMessageModerated:function(){var mailBus=this.call('mail_service','getMailBus');if(this.needsModerationByUser()){var moderationBox=this.call('mail_service','getMailbox','moderation');moderationBox.decrementMailboxCounter();moderationBox.removeMessage(this.getID());mailBus.trigger('update_moderation_counter');}
if(this._moderationStatus!=='accepted'){this.call('mail_service','removeMessageFromThreads',this);}
mailBus.trigger('update_message',this);},});return Message;});;

/* /mail/static/src/js/models/threads/abstract_thread.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.AbstractThread',function(require){"use strict";var Class=require('web.Class');var Mixins=require('web.mixins');var AbstractThread=Class.extend(Mixins.EventDispatcherMixin,{init:function(params){Mixins.EventDispatcherMixin.init.call(this,arguments);this.setParent(params.parent);this._folded=false;this._id=params.data.id;this._name=params.data.name;this._status=params.data.status||'';this._unreadCounter=0;},addMessage:function(message){this._addMessage.apply(this,arguments);this.trigger('message_added',message);},fold:function(folded){this._folded=folded;},getID:function(){return this._id;},getMessages:function(){},getName:function(){return this._name;},getStatus:function(){return this._status;},getTitle:function(){return this.getName();},getUnreadCounter:function(){return this._unreadCounter;},hasMessages:function(){return!_.isEmpty(this.getMessages());},hasTypingNotification:function(){return false;},isFolded:function(){return this._folded;},markAsRead:function(){if(this._unreadCounter>0){return this._markAsRead();}
return $.when();},postMessage:function(){return this._postMessage.apply(this,arguments).then(this.trigger.bind(this,'message_posted'));},resetUnreadCounter:function(){this._unreadCounter=0;this._warnUpdatedUnreadCounter();},_addMessage:function(message){},_incrementUnreadCounter:function(){this._unreadCounter++;},_markAsRead:function(){this.resetUnreadCounter();return $.when();},_postMessage:function(){return $.when();},_warnUpdatedUnreadCounter:function(){},});return AbstractThread;});;

/* /mail/static/src/js/models/threads/channel.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.Channel',function(require){"use strict";var SearchableThread=require('mail.model.SearchableThread');var ThreadTypingMixin=require('mail.model.ThreadTypingMixin');var mailUtils=require('mail.utils');var session=require('web.session');var time=require('web.time');var Channel=SearchableThread.extend(ThreadTypingMixin,{init:function(params){var self=this;this._super.apply(this,arguments);ThreadTypingMixin.init.call(this,arguments);var data=params.data;var options=params.options;var commands=params.commands;this._autoswitch='autoswitch'in options?options.autoswitch:true;this._commands=undefined;this._creatorUID=data.create_uid;this._detached=data.is_minimized||false;this._directPartnerID=undefined;this._folded=data.state==='folded';this._groupBasedSubscription=data.group_based_subscription;this._isModerated=data.moderation;this._isMyselfModerator=data.is_moderator;this._lastMessageDate=undefined;this._members=[];this._membersDef=undefined;this._needactionCounter=data.message_needaction_counter||0;this._serverType=data.channel_type;this._throttleFetchSeen=_.throttle(this._fetchSeen.bind(this),3000);this._uuid=data.uuid;this._commands=_.filter(commands,function(command){return!command.channel_types||_.contains(command.channel_types,self._serverType);});if(data.last_message_date){this._lastMessageDate=moment(time.str_to_datetime(data.last_message_date));}
if(data.message_unread_counter){this._unreadCounter=data.message_unread_counter;}},close:function(){this._super.apply(this,arguments);this._rpc({model:'mail.channel',method:'channel_fold',kwargs:{uuid:this.getUUID(),state:'closed'},},{shadow:true});},decrementNeedactionCounter:function(num){num=_.isNumber(num)?num:1;this._needactionCounter=Math.max(this._needactionCounter-1,0);},detach:function(){this._super.apply(this,arguments);this._rpc({model:'mail.channel',method:'channel_minimize',args:[this.getUUID(),true],},{shadow:true,});},forceFetchMembers:function(){this._membersDef=undefined;return this.getMentionPartnerSuggestions();},fold:function(folded){this._super.apply(this,arguments);var args={uuid:this.getUUID(),};if(_.isBoolean(folded)){args.state=folded?'folded':'open';}
this._rpc({model:'mail.channel',method:'channel_fold',kwargs:args,},{shadow:true});},getCommands:function(){return this._commands;},getLastMessage:function(){return _.last(this._cache['[]'].messages);},getMentionPartnerSuggestions:function(){var self=this;if(!this._membersDef){this._membersDef=this._rpc({model:'mail.channel',method:'channel_fetch_listeners',args:[this.getUUID()],},{shadow:true}).then(function(members){self._members=members;return[members];});}
return this._membersDef;},getNeedactionCounter:function(){return this._needactionCounter;},getPreview:function(){var result=this._super.apply(this,arguments);if(!this.isTwoUserThread()){result.imageSRC='/web/image/mail.channel/'+this.getID()+'/image_small';}
var lastMessage=this.getLastMessage();return _.extend(result,{author:lastMessage?lastMessage.getDisplayedAuthor():'',body:lastMessage?mailUtils.parseAndTransform(lastMessage.getBody(),mailUtils.inline):'',date:lastMessage?lastMessage.getDate():undefined,isMyselfAuthor:this.hasMessages()&&this.getLastMessage().isMyselfAuthor(),});},getUUID:function(){return this._uuid;},incrementNeedactionCounter:function(){this._needactionCounter++;},isAutoswitch:function(){return this._autoswitch;},isChannel:function(){return true;},isGroupBasedSubscription:function(){return this._groupBasedSubscription;},isModerated:function(){return this._isModerated;},isMyselfAdministrator:function(){return session.uid===this._creatorUID&&!this.isTwoUserThread();},isMyselfModerator:function(){return this._isMyselfModerator;},unsubscribe:function(){},updateWindowState:function(params){this._folded='folded'in params?params.folded:this._folded;this._detached='detached'in params?params.detached:this._detached;this._warnUpdatedWindowState();},resetNeedactionCounter:function(){this._needactionCounter=0;},_fetchSeen:function(){var self=this;return this._rpc({model:'mail.channel',method:'channel_seen',args:[[this._id]],},{shadow:true}).then(function(lastSeenMessageID){self._lastSeenMessageID=lastSeenMessageID;return lastSeenMessageID;});},_getFetchMessagesKwargs:function(){var kwargs=this._super.apply(this,arguments);if(this.isModerated()){kwargs.moderated_channel_ids=[this.getID()];}
return kwargs;},_getThreadDomain:function(){return[['channel_ids','in',[this._id]]];},_isTypingMyselfInfo:function(params){return session.partner_id===params.partnerID;},_markAsRead:function(){var superDef=this._super.apply(this,arguments);var seenDef=this._throttleFetchSeen();return $.when(superDef,seenDef);},_notifyMyselfTyping:function(params){return this._rpc({model:'mail.channel',method:'notify_typing',args:[this.getID()],kwargs:{is_typing:params.typing},},{shadow:true});},_postMessage:function(data){var self=this;return this._super.apply(this,arguments).then(function(messageData){_.extend(messageData,{message_type:'comment',subtype:'mail.mt_comment',command:data.command,});return self._rpc({model:'mail.channel',method:data.command?'execute_command':'message_post',args:[self._id],kwargs:messageData,}).then(function(){return messageData;});});},_warnUpdatedTypingPartners:function(){this.call('mail_service','getMailBus').trigger('update_typing_partners',this.getID());},});return Channel;});;

/* /mail/static/src/js/models/threads/multi_user_channel.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.MultiUserChannel',function(require){"use strict";var Channel=require('mail.model.Channel');var MultiUserChannel=Channel.extend({init:function(params){this._super.apply(this,arguments);var data=params.data;this._isMassMailing=data.mass_mailing||false;this._type=data.public!=='private'?'public':'private';},getTitle:function(){return"#"+this._super.apply(this,arguments);},isMassMailing:function(){return this._isMassMailing;},unsubscribe:function(){return this._rpc({model:'mail.channel',method:'action_unfollow',args:[[this.getID()]],});},});return MultiUserChannel;});;

/* /mail/static/src/js/models/threads/two_user_channel.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.TwoUserChannel',function(require){"use strict";var Channel=require('mail.model.Channel');var TwoUserChannel=Channel.extend({isTwoUserThread:function(){return true;},unsubscribe:function(){return this._rpc({model:'mail.channel',method:'channel_pin',args:[this.getUUID(),false],});},});return TwoUserChannel;});;

/* /mail/static/src/js/models/threads/create_mode_document_thread.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.CreateModeDocumentThread',function(require){"use strict";var AbstractMessage=require('mail.model.AbstractMessage');var AbstractThread=require('mail.model.AbstractThread');var core=require('web.core');var session=require('web.session');var _t=core._t;var CreateModeDocumentThread=AbstractThread.extend({init:function(){var params={data:{id:'_createModeDocumentThread'}};this._super(params);this._messages=this._forgeCreateMessages();},getMessages:function(){return this._messages;},_forgeCreateMessages:function(){var createMessage=new AbstractMessage(this,{id:0,body:_t("<p>Creating a new record...</p>"),author_id:[session.partner_id,session.partner_display_name],});return[createMessage];},});return CreateModeDocumentThread;});;

/* /mail/static/src/js/models/threads/dm_chat.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.DMChat',function(require){"use strict";var TwoUserChannel=require('mail.model.TwoUserChannel');var DMChat=TwoUserChannel.extend({init:function(params){this._super.apply(this,arguments);var data=params.data;this._directPartnerID=data.direct_partner[0].id;this._name=data.direct_partner[0].name;this._status=data.direct_partner[0].im_status;this._type='dm_chat';},getDirectPartnerID:function(){return this._directPartnerID;},getPreview:function(){var result=this._super.apply(this,arguments);result.imageSRC='/web/image/res.partner/'+this.getDirectPartnerID()+'/image_small';return result;},setStatus:function(newStatus){this._status=newStatus;},});return DMChat;});;

/* /mail/static/src/js/models/threads/document_thread.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.DocumentThread',function(require){"use strict";var Thread=require('mail.model.Thread');var session=require('web.session');var DocumentThread=Thread.extend({init:function(params){var data=params.data;data.id=data.resModel+'_'+data.resID;data.type='document_thread';this._super.apply(this,arguments);this._documentID=data.resID;this._documentModel=data.resModel;this._messageIDs=data.messageIDs||[];this._messages=[];this._mustFetchMessageIDs=!_.isArray(data.messageIDs);},close:function(options){this._super.apply(this,arguments);if(options&&options.skipCrossTabSync){return;}
this.call('mail_service','updateDocumentThreadState',this._id,{name:this.getName(),windowState:'closed',});},detach:function(options){this._super.apply(this,arguments);if(options&&options.skipCrossTabSync){return;}
var windowState=this._folded?'folded':'open';this.call('mail_service','updateDocumentThreadState',this._id,{name:this.getName(),windowState:windowState,});},fetchMessages:function(options){var self=this;return this._fetchMessages(options).then(function(){return self._messages;});},fold:function(folded,options){this._super.apply(this,arguments);if(options&&options.skipCrossTabSync){return;}
var windowState=this._folded?'folded':'open';this.call('mail_service','updateDocumentThreadState',this._id,{name:this.getName(),windowState:windowState,});},getDocumentModel:function(){return this._documentModel;},getDocumentID:function(){return this._documentID;},getMessageIDs:function(){return this._messageIDs;},getMessages:function(){return this._messages;},isLinkedToDocument:function(){return true;},removeAttachmentsFromMessages:function(attachmentIDs){_.each(this.getMessages(),function(message){message.removeAttachments(attachmentIDs);});},setMessageIDs:function(messageIDs){this._mustFetchMessageIDs=false;this._messageIDs=messageIDs;},setName:function(newName){this._name=newName;},_addMessage:function(message){this._super.apply(this,arguments);if(_.contains(this._messages,message)){return;}
this._messages.push(message);this._messages=_.sortBy(this._messages,function(msg){return msg.getID();});if(!_.contains(this._messageIDs,message.getID())){this._messageIDs.push(message.getID());}
if(message.isNeedaction()){this._unreadCounter++;}},_fetchMessageIDs:function(){var self=this;var resID=this.getDocumentID();if(!resID||!this._mustFetchMessageIDs){return $.when();}
return this._rpc({model:this.getDocumentModel(),method:'read',args:[[resID],['message_ids']],}).then(function(result){self.setMessageIDs(result[0].message_ids);});},_fetchMessages:function(options){var self=this;return this._fetchMessageIDs().then(function(){var messageIDs=self._messageIDs;var loadedMessages=_.filter(self._messages,function(message){return _.contains(messageIDs,message.getID());});var loadedMessageIDs=_.map(loadedMessages,function(message){return message.getID();});options=options||{};var shouldFetch=_.difference(messageIDs.slice(0,self._FETCH_LIMIT),loadedMessageIDs).length>0;if(options.forceFetch||shouldFetch){var idsToLoad=_.difference(messageIDs,loadedMessageIDs).slice(0,self._FETCH_LIMIT);return self._rpc({model:'mail.message',method:'message_format',args:[idsToLoad],context:session.user_context,}).then(function(messagesData){_.each(messagesData,function(messageData){self.call('mail_service','addMessage',messageData,{silent:true});});});}else{return $.when();}});},_markAsRead:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.call('mail_service','markMessagesAsRead',self._messageIDs);});},_postMessage:function(data){var self=this;var resModel=this.getDocumentModel();var resID=this.getDocumentID();return this._super.apply(this,arguments).then(function(messageData){_.extend(messageData,{context:data.context,message_type:data.message_type,subtype:data.subtype||"mail.mt_comment",subtype_id:data.subtype_id,});return self._rpc({model:resModel,method:'message_post',args:[resID],kwargs:messageData,}).then(function(messageID){return self._rpc({model:'mail.message',method:'message_format',args:[[messageID]],}).then(function(messages){messages[0].model=resModel;messages[0].res_id=resID;self.call('mail_service','addMessage',messages[0],{postedFromDocumentThread:true,});return messages[0];});});});},});return DocumentThread;});;

/* /mail/static/src/js/models/threads/livechat.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.Livechat',function(require){"use strict";var TwoUserChannel=require('mail.model.TwoUserChannel');var Livechat=TwoUserChannel.extend({_WEBSITE_USER_ID:'_websiteUser',_WEBSITE_USER_NAME:'Website user',init:function(params){this._super.apply(this,arguments);this._name=params.data.anonymous_name;this._WEBSITE_USER_NAME=this._name;},getMentionPartnerSuggestions:function(){var self=this;return this._super.apply(this,arguments).then(function(){var websiteUser=_.findWhere(self._members,{id:self._WEBSITE_USER_ID});if(!websiteUser){self._members.push({id:self._WEBSITE_USER_ID,name:self._WEBSITE_USER_NAME,});}
return[self._members];});},registerTyping:function(params){params.partnerID=this._WEBSITE_USER_ID;this._super.call(this,params);},unregisterTyping:function(params){params.partnerID=this._WEBSITE_USER_ID;this._super.call(this,params);},});return Livechat;});;

/* /mail/static/src/js/models/threads/mailbox.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.Mailbox',function(require){"use strict";var SearchableThread=require('mail.model.SearchableThread');var core=require('web.core');var _t=core._t;var Mailbox=SearchableThread.extend({init:function(params){var data=params.data;data.id='mailbox_'+data.id;data.type='mailbox';this._super.apply(this,arguments);this._mailboxCounter=data.mailboxCounter||0;},decrementMailboxCounter:function(num){num=_.isNumber(num)?num:1;this._mailboxCounter=Math.max(this._mailboxCounter-num,0);},getMailboxCounter:function(){return this._mailboxCounter;},getMessagePreviews:function(){var self=this;return this.fetchMessages().then(function(messages){var items=[];_.each(messages,function(message){var unreadCounter=1;var messageIDs=[message.getID()];var similarItem=_.find(items,function(item){return self._areMessagesFromSameDocumentThread(item.message,message)||self._areMessagesFromSameChannel(item.message,message);});if(similarItem){unreadCounter=similarItem.unreadCounter+1;messageIDs=similarItem.messageIDs.concat(messageIDs);var index=_.findIndex(items,similarItem);items[index]={unreadCounter:unreadCounter,message:message,messageIDs:messageIDs};}else{items.push({unreadCounter:unreadCounter,message:message,messageIDs:messageIDs,});}});return _.map(items,function(item){return _.extend(item.message.getPreview(),{unreadCounter:item.unreadCounter,messageIDs:item.messageIDs,});});});},incrementMailboxCounter:function(num){num=_.isNumber(num)?num:1;this._mailboxCounter=Math.max(this._mailboxCounter+num,0);},markAllMessagesAsRead:function(domain){if(this._id==='mailbox_inbox'&&this.getMailboxCounter()>0){return this._rpc({model:'mail.message',method:'mark_all_as_read',kwargs:{channel_ids:[],domain:domain,},});}
return $.when();},_areMessagesFromSameChannel:function(message1,message2){return message1.originatesFromChannel()&&message2.originatesFromChannel()&&message1.getOriginChannelID()===message2.getOriginChannelID();},_areMessagesFromSameDocumentThread:function(message1,message2){return message1.isLinkedToDocumentThread()&&message2.isLinkedToDocumentThread()&&message1.getDocumentModel()===message2.getDocumentModel()&&message1.getDocumentID()===message2.getDocumentID();},_getThreadDomain:function(){if(this._id==='mailbox_inbox'){return[['needaction','=',true]];}else if(this._id==='mailbox_starred'){return[['starred','=',true]];}else if(this._id==='mailbox_moderation'){return[['need_moderation','=',true]];}else{throw(_.str(_t("Missing domain for mailbox with ID '%s'"),this._id));}},_postMessage:function(messageData,options){var documentThread=this.call('mail_service','getDocumentThread',options.documentModel,options.documentID);return documentThread.postMessage(messageData);},});return Mailbox;});;

/* /mail/static/src/js/models/threads/searchable_thread.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.SearchableThread',function(require){"use strict";var Thread=require('mail.model.Thread');var session=require('web.session');var SearchableThread=Thread.extend({init:function(params){this._super.apply(this,arguments);this._cache={'[]':{allHistoryLoaded:false,loaded:false,messages:[],}};this._lastSeenMessageID=params.data.seen_message_id;},fetchMessages:function(domain,loadMore){if(loadMore){return this._fetchMessages(domain,true);}
var cache=this._getCache(domain);if(cache.loaded){return $.when(cache.messages);}else{return this._fetchMessages(domain);}},getLastSeenMessageID:function(){return this._lastSeenMessageID||null;},getMessages:function(options){options=options||{};var domain=options.domain||[];return this._getCache(domain).messages;},hasMessages:function(options){options=options||{};var domain=options.domain||[];return!_.isEmpty(this.getMessages({domain:domain}));},invalidateCaches:function(){this._cache=_.pick(this._cache,'[]');},isAllHistoryLoaded:function(domain){return this._getCache(domain).allHistoryLoaded;},removeMessage:function(messageID){_.each(this._cache,function(cache){cache.messages=_.reject(cache.messages,function(message){return message.getID()===messageID;});});},setLastSeenMessageID:function(messageID){this._lastSeenMessageID=messageID;},_addMessage:function(message,options){this._super.apply(this,arguments);var cache=this._getCache(options.domain||[]);var index=_.sortedIndex(cache.messages,message,function(msg){return msg.getID();});if(cache.messages[index]!==message){cache.messages.splice(index,0,message);}
if(!message.isMyselfAuthor()&&options.incrementUnread){this._incrementUnreadCounter();}},_fetchMessages:function(pDomain,loadMore){var self=this;var domain=this._getThreadDomain();var cache=this._getCache(pDomain);if(pDomain){domain=domain.concat(pDomain||[]);}
if(loadMore){var minMessageID=cache.messages[0].getID();domain=[['id','<',minMessageID]].concat(domain);}
return this._rpc({model:'mail.message',method:'message_fetch',args:[domain],kwargs:this._getFetchMessagesKwargs(),}).then(function(messages){if(!cache.allHistoryLoaded){cache.allHistoryLoaded=messages.length<self._FETCH_LIMIT;}
cache.loaded=true;_.each(messages,function(message){self.call('mail_service','addMessage',message,{silent:true,domain:pDomain,});});cache=self._getCache(pDomain||[]);return cache.messages;});},_getCache:function(domain){var stringifiedDomain=JSON.stringify(domain||[]);if(!this._cache[stringifiedDomain]){this._cache[stringifiedDomain]={allHistoryLoaded:false,loaded:false,messages:[],};}
return this._cache[stringifiedDomain];},_getFetchMessagesKwargs:function(){return{limit:this._FETCH_LIMIT,context:session.user_context};},_getThreadDomain:function(){},});return SearchableThread;});;

/* /mail/static/src/js/models/threads/thread.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.Thread',function(require){"use strict";var emojis=require('mail.emojis');var AbstractThread=require('mail.model.AbstractThread');var mailUtils=require('mail.utils');var ServicesMixin=require('web.ServicesMixin');var Thread=AbstractThread.extend(ServicesMixin,{_FETCH_LIMIT:30,init:function(params){this._super.apply(this,arguments);this._detached=false;this._previewed=false;this._type=params.data.type||params.data.channel_type;},close:function(){this._detached=false;this._folded=false;this._warnUpdatedWindowState();},detach:function(options){options=options||{};this._detached=true;this._folded=options.keepFoldState?this._folded:false;this._warnUpdatedWindowState({passively:options.passively,});},fetchMessages:function(){return $.when([]);},fold:function(folded){this._super.apply(this,arguments);this._detached=true;this._warnUpdatedWindowState();},getCommands:function(){return[];},getMentionPartnerSuggestions:function(){return $.when([]);},getPreview:function(){return{id:this.getID(),imageSRC:'/mail/static/src/img/smiley/avatar.jpg',isTwoUserThread:this.isTwoUserThread(),status:this.getStatus(),title:this.getName(),unreadCounter:this.getUnreadCounter(),};},getType:function(){return this._type;},hasBeenPreviewed:function(){return this._previewed;},hasUnreadMessages:function(){return this._unreadCounter!==0;},incrementNeedactionCounter:function(){},isAutoswitch:function(){return false;},isChannel:function(){return false;},isDetached:function(){return this._detached;},isLinkedToDocument:function(){return false;},isMassMailing:function(){return false;},isModerated:function(){return false;},isMyselfModerator:function(){return false;},isTwoUserThread:function(){return false;},markAsPreviewed:function(){this._previewed=true;},_fetchMessages:function(){return $.when();},_generateEmojis:function(htmlString){_.each(emojis,function(emoji){_.each(emoji.sources,function(source){var escapedSource=String(source).replace(/([.*+?=^!:${}()|[\]/\\])/g,'\\$1');var regexp=new RegExp("(\\s|^)("+escapedSource+")(?=\\s|$)",'g');htmlString=htmlString.replace(regexp,'$1'+emoji.unicode);});});return htmlString;},_incrementUnreadCounter:function(){this._super.apply(this,arguments);this._warnUpdatedUnreadCounter();},_postMessage:function(data){var body=mailUtils.parseAndTransform(_.str.trim(data.content),mailUtils.addLink);body=this._generateEmojis(body);var messageData={partner_ids:data.partner_ids,channel_ids:_.map(data.channel_ids,function(channelID){return[4,channelID,false];}),body:body,attachment_ids:data.attachment_ids,canned_response_ids:data.canned_response_ids,};if('subject'in data){messageData.subject=data.subject;}
return this._super.apply(this,arguments).then(function(){return $.when(messageData);});},_warnUpdatedUnreadCounter:function(){this.call('mail_service','getMailBus').trigger('update_thread_unread_counter',this);},_warnUpdatedWindowState:function(options){options=options||{};this.call('mail_service','updateThreadWindow',this.getID(),options);},});return Thread;});;

/* /mail/static/src/js/models/threads/thread_typing_mixin/thread_typing_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.ThreadTypingMixin',function(require){"use strict";var CCThrottleFunction=require('mail.model.CCThrottleFunction');var Timer=require('mail.model.Timer');var Timers=require('mail.model.Timers');var core=require('web.core');var _t=core._t;var ThreadTypingMixin={_DEFAULT_TYPING_PARTNER_ID:'_default',_DEFAULT_TYPING_PARTNER_NAME:'Someone',init:function(){this._lastNotifiedMyselfTyping=false;this._myselfLongTypingTimer=new Timer({duration:50*1000,onTimeout:this._onMyselfLongTypingTimeout.bind(this),});this._myselfTypingInactivityTimer=new Timer({duration:5*1000,onTimeout:this._onMyselfTypingInactivityTimeout.bind(this),});this._othersTypingTimers=new Timers({duration:60*1000,onTimeout:this._onOthersTypingTimeout.bind(this),});this._throttleNotifyMyselfTyping=CCThrottleFunction({duration:2.5*1000,func:this._onNotifyMyselfTyping.bind(this),});this._typingPartnerIDs=[];this.on('message_added',this,this._onTypingMessageAdded);this.on('message_posted',this,this._onTypingMessagePosted);},getTypingMembersToText:function(){var typingPartnerIDs=this._typingPartnerIDs;var typingMembers=_.filter(this._members,function(member){return _.contains(typingPartnerIDs,member.id);});var sortedTypingMembers=_.sortBy(typingMembers,function(member){return _.indexOf(typingPartnerIDs,member.id);});var displayableTypingMembers=sortedTypingMembers.slice(0,3);if(displayableTypingMembers.length===0){return'';}else if(displayableTypingMembers.length===1){return _.str.sprintf(_t("%s is typing..."),displayableTypingMembers[0].name);}else if(displayableTypingMembers.length===2){return _.str.sprintf(_t("%s and %s are typing..."),displayableTypingMembers[0].name,displayableTypingMembers[1].name);}else{return _.str.sprintf(_t("%s, %s and more are typing..."),displayableTypingMembers[0].name,displayableTypingMembers[1].name);}},hasTypingNotification:function(){return true;},registerTyping:function(params){if(this._isTypingMyselfInfo(params)){return;}
this._othersTypingTimers.registerTimer({timeoutCallbackArguments:[params.partnerID],timerID:params.partnerID,});this._typingPartnerIDs.push(params.partnerID);this._warnUpdatedTypingPartners();},setMyselfTyping:function(params){var typing=params.typing;if(this._lastNotifiedMyselfTyping===typing){this._throttleNotifyMyselfTyping.cancel();}else{this._throttleNotifyMyselfTyping(params);}
if(typing){this._myselfTypingInactivityTimer.reset();}else{this._myselfTypingInactivityTimer.clear();}},unregisterTyping:function(params){var partnerID=params.partnerID;this._othersTypingTimers.unregisterTimer({timerID:partnerID});this._typingPartnerIDs=_.reject(this._typingPartnerIDs,function(id){return id===partnerID;});this._warnUpdatedTypingPartners();},_isTypingMyselfInfo:function(params){return false;},_notifyMyselfTyping:function(params){return $.when();},_warnUpdatedTypingPartners:function(){},_onMyselfLongTypingTimeout:function(){this._throttleNotifyMyselfTyping.clear();this._throttleNotifyMyselfTyping({typing:true});},_onMyselfTypingInactivityTimeout:function(){this._throttleNotifyMyselfTyping.clear();this._throttleNotifyMyselfTyping({typing:false});},_onNotifyMyselfTyping:function(params){var typing=params.typing;this._lastNotifiedMyselfTyping=typing;this._notifyMyselfTyping(params);if(typing){this._myselfLongTypingTimer.reset();}else{this._myselfLongTypingTimer.clear();}},_onOthersTypingTimeout:function(partnerID){this.unregisterTyping({partnerID:partnerID});},_onTypingMessageAdded:function(message){var partnerID=message.hasAuthor()?message.getAuthorID():this._DEFAULT_TYPING_PARTNER_ID;this.unregisterTyping({partnerID:partnerID});},_onTypingMessagePosted:function(){this._lastNotifiedMyselfTyping=false;this._throttleNotifyMyselfTyping.clear();this._myselfLongTypingTimer.clear();this._myselfTypingInactivityTimer.clear();},};return ThreadTypingMixin;});;

/* /mail/static/src/js/models/threads/thread_typing_mixin/timer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.Timer',function(require){"use strict";var Class=require('web.Class');var Timer=Class.extend({init:function(params){this._duration=params.duration;this._timeout=undefined;this._timeoutCallback=params.onTimeout;},clear:function(){clearTimeout(this._timeout);},reset:function(){this.clear();this.start();},start:function(){this._timeout=setTimeout(this._onTimeout.bind(this),this._duration);},_onTimeout:function(){this._timeoutCallback();},});return Timer;});;

/* /mail/static/src/js/models/threads/thread_typing_mixin/timers.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.Timers',function(require){"use strict";var Timer=require('mail.model.Timer');var Class=require('web.Class');var Timers=Class.extend({init:function(params){this._duration=params.duration;this._timeoutCallback=params.onTimeout;this._timers={};},registerTimer:function(params){var timerID=params.timerID;if(this._timers[timerID]){this._timers[timerID].clear();}
var timerParams={duration:this._duration,onTimeout:this._timeoutCallback,};if('timeoutCallbackArguments'in params){timerParams.onTimeout=this._timeoutCallback.bind.apply(this._timeoutCallback,[null].concat(params.timeoutCallbackArguments));}else{timerParams.onTimeout=this._timeoutCallback;}
this._timers[timerID]=new Timer(timerParams);this._timers[timerID].start();},unregisterTimer:function(params){var timerID=params.timerID;if(this._timers[timerID]){this._timers[timerID].clear();delete this._timers[timerID];}},});return Timers;});;

/* /mail/static/src/js/models/threads/thread_typing_mixin/cc_throttle_function.js defined in bundle 'web.assets_backend' */
odoo.define('mail.model.CCThrottleFunctionObject',function(require){"use strict";var Class=require('web.Class');var CCThrottleFunctionObject=Class.extend({init:function(params){this._arguments=undefined;this._cooldownTimeout=undefined;this._duration=params.duration;this._func=params.func;this._shouldCallFunctionAfterCD=false;},cancel:function(){this._arguments=undefined;this._shouldCallFunctionAfterCD=false;},clear:function(){if(this._cooldownTimeout){clearTimeout(this._cooldownTimeout);this._onCooldownTimeout();}},do:function(){this._arguments=Array.prototype.slice.call(arguments);if(this._cooldownTimeout===undefined){this._callFunction();}else{this._shouldCallFunctionAfterCD=true;}},_callFunction:function(){this._func.apply(null,this._arguments);this._cooldown();},_cooldown:function(){this.cancel();this._cooldownTimeout=setTimeout(this._onCooldownTimeout.bind(this),this._duration);},_onCooldownTimeout:function(){if(this._shouldCallFunctionAfterCD){this._callFunction();}else{this._cooldownTimeout=undefined;}},});return CCThrottleFunctionObject;});odoo.define('mail.model.CCThrottleFunction',function(require){"use strict";var CCThrottleFunctionObject=require('mail.model.CCThrottleFunctionObject');var CCThrottleFunction=function(params){var duration=params.duration;var func=params.func;var throttleFunctionObject=new CCThrottleFunctionObject({duration:duration,func:func,});var callable=function(){return throttleFunctionObject.do.apply(throttleFunctionObject,arguments);};callable.cancel=function(){throttleFunctionObject.cancel();};callable.clear=function(){throttleFunctionObject.clear();};return callable;};return CCThrottleFunction;});;

/* /mail/static/src/js/thread_windows/abstract_thread_window.js defined in bundle 'web.assets_backend' */
odoo.define('mail.AbstractThreadWindow',function(require){"use strict";var ThreadWidget=require('mail.widget.Thread');var config=require('web.config');var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var AbstractThreadWindow=Widget.extend({template:'mail.AbstractThreadWindow',custom_events:{escape_pressed:'_onEscapePressed',document_viewer_closed:'_onDocumentViewerClose',},events:{'click .o_thread_window_close':'_onClickClose','click .o_thread_window_title':'_onClickFold','click .o_composer_text_field':'_onComposerClick','click .o_mail_thread':'_onThreadWindowClicked','keydown .o_composer_text_field':'_onKeydown','keypress .o_composer_text_field':'_onKeypress',},FOLD_ANIMATION_DURATION:200,HEIGHT_OPEN:'400px',HEIGHT_FOLDED:'34px',init:function(parent,thread,options){this._super(parent);this.options=_.defaults(options||{},{autofocus:true,displayStars:true,displayReplyIcons:false,displayEmailIcons:false,placeholder:_t("Say something"),});this._hidden=false;this._thread=thread||null;this._debouncedOnScroll=_.debounce(this._onScroll.bind(this),100);if(!this.hasThread()){this._folded=false;}},start:function(){var self=this;this.$input=this.$('.o_composer_text_field');this.$header=this.$('.o_thread_window_header');this._threadWidget=new ThreadWidget(this,{areMessageAttachmentsDeletable:false,displayMarkAsRead:false,displayStars:this.options.displayStars,});if(this.isFolded()){this.$el.css('height',this.HEIGHT_FOLDED);}else if(this.options.autofocus){this._focusInput();}
if(!config.device.isMobile){var margin_dir=_t.database.parameters.direction==="rtl"?"margin-left":"margin-right";this.$el.css(margin_dir,$.position.scrollbarWidth());}
var def=this._threadWidget.replace(this.$('.o_thread_window_content')).then(function(){self._threadWidget.$el.on('scroll',self,self._debouncedOnScroll);});return $.when(this._super(),def);},do_hide:function(){this._hidden=true;this._super.apply(this,arguments);},do_show:function(){this._hidden=false;this._super.apply(this,arguments);},do_toggle:function(display){this._hidden=_.isBoolean(display)?!display:!this._hidden;this._super.apply(this,arguments);},close:function(){},getID:function(){return this._getThreadID();},getThreadStatus:function(){if(!this.hasThread()){return undefined;}
return this._thread.getStatus();},getTitle:function(){if(!this.hasThread()){return _t("Undefined");}
return this._thread.getTitle();},getUnreadCounter:function(){if(!this.hasThread()){return 0;}
return this._thread.getUnreadCounter();},hasThread:function(){return!!this._thread;},isAtBottom:function(){return this._threadWidget.isAtBottom();},isFolded:function(){if(!this.hasThread()){return this._folded;}
return this._thread.isFolded();},isMobile:function(){return config.device.isMobile;},isHidden:function(){return this._hidden;},needsComposer:function(){return this.hasThread();},render:function(){this.renderHeader();if(this.hasThread()){this._threadWidget.render(this._thread,{displayLoadMore:false});}},renderHeader:function(){var options=this._getHeaderRenderingOptions();this.$header.html(QWeb.render('mail.AbstractThreadWindow.HeaderContent',options));},renderTypingNotificationBar:function(){this._threadWidget.renderTypingNotificationBar(this._thread);},scrollToBottom:function(){this._threadWidget.scrollToBottom();},toggleFold:function(folded){if(!_.isBoolean(folded)){folded=!this.isFolded();}
this._updateThreadFoldState(folded);},updateVisualFoldState:function(){if(!this.isFolded()){this._threadWidget.scrollToBottom();if(this.options.autofocus){this._focusInput();}}
this._animateFold();},_animateFold:function(){this.$el.animate({height:this.isFolded()?this.HEIGHT_FOLDED:this.HEIGHT_OPEN},this.FOLD_ANIMATION_DURATION);},_focusInput:function(){if(config.device.touch&&config.device.size_class<=config.device.SIZES.SM){return;}
this.$input.focus();},_getHeaderRenderingOptions:function(){return{status:this.getThreadStatus(),title:this.getTitle(),unreadCounter:this.getUnreadCounter(),widget:this,};},_getThreadID:function(){if(!this.hasThread()){return'_blank';}
return this._thread.getID();},_hasFocus:function(){return this.$input.is(':focus');},_postMessage:function(messageData){var self=this;if(!this.hasThread()){return;}
this._thread.postMessage(messageData).then(function(){self._threadWidget.scrollToBottom();});},_updateThreadFoldState:function(folded){if(this.hasThread()){this._thread.fold(folded);}else{this._folded=folded;this.updateVisualFoldState();}},_onClickClose:function(ev){ev.stopPropagation();ev.preventDefault();if(this.hasThread()&&this._thread.getUnreadCounter()>0&&!this.isFolded()){this._thread.markAsRead();}
this.close();},_onClickFold:function(){if(!config.device.isMobile){this.toggleFold();}},_onComposerClick:function(ev){if($(ev.target).closest('a, button').length){return;}
this._focusInput();},_onDocumentViewerClose:function(){this._focusInput();},_onEscapePressed:function(){if(!this.isFolded()){this.close();}},_onKeydown:function(ev){ev.stopPropagation();if(ev.which===13){var content=_.str.trim(this.$input.val());var messageData={content:content,attachment_ids:[],partner_ids:[],};this.$input.val('');if(content){this._postMessage(messageData);}}},_onKeypress:function(ev){ev.stopPropagation();},_onScroll:function(){if(this.hasThread()&&this.isAtBottom()){this._thread.markAsRead();}},_onThreadWindowClicked:function(){var selectObj=window.getSelection();if(selectObj.anchorOffset===selectObj.focusOffset){this.$input.focus();}},});return AbstractThreadWindow;});;

/* /mail/static/src/js/thread_windows/thread_window.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ThreadWindow',function(require){"use strict";var AbstractThreadWindow=require('mail.AbstractThreadWindow');var BasicComposer=require('mail.composer.Basic');var ExtendedComposer=require('mail.composer.Extended');var config=require('web.config');var core=require('web.core');var _t=core._t;var ThreadWindow=AbstractThreadWindow.extend({template:'mail.ThreadWindow',custom_events:AbstractThreadWindow.prototype.custom_events,events:_.extend({},AbstractThreadWindow.prototype.events,{'click .o_mail_thread':'_onThreadWindowFocus','click .o_thread_composer':'_onThreadWindowFocus','click .o_thread_window_expand':'_onClickExpand',}),init:function(parent,thread,options){this._super.apply(this,arguments);this._passive=this.options.passively||false;if(!this.hasThread()){this.directPartnerID=null;}},start:function(){var self=this;var superDef=this._super().then(this._listenThreadWidget.bind(this));var composerDef;if(!this.hasThread()){this._startWithoutThread();}else if(this.needsComposer()){var composer;var composerParams={mentionPartnersRestricted:this._thread.getType()!=='document_thread',thread:this._thread,};if(config.device.isMobile&&this._thread.isMassMailing()){composer=new ExtendedComposer(this,composerParams);}else{composer=new BasicComposer(this,_.extend({isMini:true},composerParams));}
composer.on('post_message',this,this._postMessage);composer.once('input_focused',this,function(){var commands=this._thread.getCommands();var partners=this._thread.getMentionPartnerSuggestions();composer.mentionSetCommands(commands);composer.mentionSetPrefetchedPartners(partners);});composerDef=composer.replace(this.$('.o_thread_composer'));composerDef.then(function(){self.$input=self.$('.o_composer_text_field');});}
return $.when(superDef,composerDef);},close:function(){if(this.hasThread()){this._thread.close();}else{this.trigger_up('close_blank_thread_window');}},focusInput:function(){this._focusInput();},getTitle:function(){if(!this.hasThread()){return _t("New message");}
return this._super.apply(this,arguments);},isPassive:function(){return this._passive;},removePassive:function(){this._passive=false;},update:function(options){var self=this;if(options.passively&&!this._hasFocus()){this._setPassive();}
var bottomVisible=!this.isFolded()&&!this.isHidden()&&this.isAtBottom();if(bottomVisible&&!this.isPassive()){this._thread.markAsRead();}
this._thread.fetchMessages().then(function(){self.render();if(bottomVisible&&options.keepBottom){self.scrollToBottom();}});},_getHeaderRenderingOptions:function(){var options=this._super.apply(this,arguments);if(this._thread.getType()==='document_thread'){options.expandTitle=_t("Open document");}else{options.expandTitle=_t("Open in Discuss");}
return options;},_listenThreadWidget:function(){this._threadWidget.on('redirect',this,this._onRedirect).on('redirect_to_channel',this,this._onRedirectToChannel).on('toggle_star_status',this,this._onToggleStarStatus);},_open:function(channelID){this.call('mail_service','openThreadWindow',channelID||this.getID());},_setPassive:function(){this._passive=true;},_startWithoutThread:function(){var self=this;this.$el.addClass('o_thread_less');this.$('.o_thread_search_input input').autocomplete({source:function(request,response){self.call('mail_service','searchPartner',request.term,10).done(response);},select:function(event,ui){var partnerID=ui.item.id;self.directPartnerID=partnerID;self.call('mail_service','openDMChatWindowFromBlankThreadWindow',partnerID);},}).focus();},_onClickExpand:_.debounce(function(ev){var self=this;ev.preventDefault();if(this.hasThread()&&this._thread.getType()==='document_thread'){this.do_action({type:'ir.actions.act_window',res_model:this._thread.getDocumentModel(),views:[[false,'form']],res_id:this._thread.getDocumentID(),});}else{this.do_action('mail.action_discuss',{clear_breadcrumbs:false,active_id:this.hasThread()?this._getThreadID():undefined,on_reverse_breadcrumb:function(){var mailBus=self.call('mail_service','getMailBus');if(mailBus){mailBus.trigger('discuss_open',false);}},});}},1000,true),_onKeydown:function(ev){ev.stopPropagation();},_onRedirect:function(resModel,resID){var callback=this._open.bind(this);this.call('mail_service','redirect',resModel,resID,callback);},_onRedirectToChannel:function(channelID){var thread=this.call('mail_service','getThread',channelID);if(!thread){this.call('mail_service','joinChannel',channelID).then(function(channel){channel.detach();});}else{this.toggleFold(false);}},_onScroll:function(){if(this.isPassive()){return;}
return this._super.apply(this,arguments);},_onThreadWindowFocus:function(){if(this.isPassive()){this.removePassive();this._thread.markAsRead();}},_onToggleStarStatus:function(messageID){var message=this.call('mail_service','getMessage',messageID);message.toggleStarStatus();},});return ThreadWindow;});;

/* /mail/static/src/js/discuss.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Discuss',function(require){"use strict";var BasicComposer=require('mail.composer.Basic');var ExtendedComposer=require('mail.composer.Extended');var ThreadWidget=require('mail.widget.Thread');var AbstractAction=require('web.AbstractAction');var config=require('web.config');var ControlPanelMixin=require('web.ControlPanelMixin');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var dom=require('web.dom');var pyUtils=require('web.py_utils');var SearchView=require('web.SearchView');var session=require('web.session');var QWeb=core.qweb;var _t=core._t;var PartnerInviteDialog=Dialog.extend({dialog_title:_t("Invite people"),template:'mail.PartnerInviteDialog',init:function(parent,title,channelID){this._channelID=channelID;this._super(parent,{title:title,size:'medium',buttons:[{text:_t("Invite"),close:true,classes:'btn-primary',click:this._addChannel.bind(this),}],});},start:function(){var self=this;this.$input=this.$('.o_mail_discuss_partner_invite_input');this.$input.select2({width:'100%',allowClear:true,multiple:true,formatResult:function(item){var status=QWeb.render('mail.UserStatus',{status:item.im_status});return $('<span>').text(item.text).prepend(status);},query:function(query){self.call('mail_service','searchPartner',query.term,20).then(function(partners){query.callback({results:_.map(partners,function(partner){return _.extend(partner,{text:partner.label});}),});});}});return this._super.apply(this,arguments);},_addChannel:function(){var self=this;var data=this.$input.select2('data');if(data.length>=1){return this._rpc({model:'mail.channel',method:'channel_invite',args:[this._channelID],kwargs:{partner_ids:_.pluck(data,'id')},}).then(function(){var names=_.escape(_.pluck(data,'text').join(', '));var notification=_.str.sprintf(_t("You added <b>%s</b> to the conversation."),names);self.do_notify(_t("New people"),notification);var channel=self.call('mail_service','getChannel',self._channelID);channel.forceFetchMembers();});}},});var ModeratorRejectMessageDialog=Dialog.extend({template:'mail.ModeratorRejectMessageDialog',init:function(parent,params){this._messageIDs=params.messageIDs;this._proceedReject=params.proceedReject;this._super(parent,{title:_t("Send explanation to author"),size:'medium',buttons:[{text:_t("Send"),close:true,classes:'btn-primary',click:_.bind(this._onSendClicked,this),}],});},_onSendClicked:function(){var title=this.$('#message_title').val();var comment=this.$('#reject_message').val();if(title&&comment){this._proceedReject({title:title,comment:comment});}},});var Discuss=AbstractAction.extend(ControlPanelMixin,{template:'mail.discuss',custom_events:{message_moderation:'_onMessageModeration',search:'_onSearch',update_moderation_buttons:'_onUpdateModerationButtons',},events:{'click .o_mail_sidebar_title .o_add':'_onAddThread','blur .o_mail_add_thread input':'_onAddThreadBlur','click .o_mail_channel_settings':'_onChannelSettingsClicked','click .o_mail_discuss_item':'_onDiscussItemClicked','keydown':'_onKeydown','click .o_mail_open_channels':'_onPublicChannelsClick','click .o_mail_partner_unpin':'_onUnpinChannel',},init:function(parent,action,options){this._super.apply(this,arguments);this.action=action;this.action_manager=parent;this.dataset=new data.DataSetSearch(this,'mail.message');this.domain=[];this.options=options||{};this._threadsScrolltop={};this._composerStates={};this._defaultThreadID=this.options.active_id||this.action.context.active_id||this.action.params.default_active_id||'mailbox_inbox';this._selectedMessage=null;this._throttledUpdateThreads=_.throttle(this._updateThreads.bind(this),100,{leading:false});},willStart:function(){var self=this;var viewID=this.action&&this.action.search_view_id&&this.action.search_view_id[0];var def=this.loadFieldView(this.dataset,viewID,'search').then(function(fieldsView){self.fields_view=fieldsView;});return $.when(this._super(),this.call('mail_service','isReady'),def);},start:function(){var self=this;this._basicComposer=new BasicComposer(this,{mentionPartnersRestricted:true});this._extendedComposer=new ExtendedComposer(this,{mentionPartnersRestricted:true});this._basicComposer.on('post_message',this,this._onPostMessage).on('input_focused',this,this._onComposerFocused);this._extendedComposer.on('post_message',this,this._onPostMessage).on('input_focused',this,this._onComposerFocused);this._renderButtons();var defs=[];defs.push(this._renderThread());defs.push(this._basicComposer.appendTo(this.$('.o_mail_discuss_content')));defs.push(this._extendedComposer.appendTo(this.$('.o_mail_discuss_content')));defs.push(this._renderSearchView());return this.alive($.when.apply($,defs)).then(function(){return self.alive(self._setThread(self._defaultThreadID));}).then(function(){self._updateThreads();self._startListening();self._threadWidget.$el.on('scroll',null,_.debounce(function(){if(self._threadWidget.getScrolltop()<20&&!self._threadWidget.$('.o_mail_no_content').length&&!self._thread.isAllHistoryLoaded(self.domain)){self._loadMoreMessages();}
if(self._threadWidget.isAtBottom()&&self._thread.getType()!=='mailbox'){self._thread.markAsRead();}},100));});},do_show:function(){this._super.apply(this,arguments);this._updateControlPanel();this.action_manager.do_push_state({action:this.action.id,active_id:this._thread.getID(),});},destroy:function(){if(this.$buttons){this.$buttons.off().destroy();}
this._super.apply(this,arguments);},on_attach_callback:function(){this.call('mail_service','getMailBus').trigger('discuss_open',true);if(this._thread){this._threadWidget.scrollToPosition(this._threadsScrolltop[this._thread.getID()]);}
this._loadEnoughMessages();},on_detach_callback:function(){this.call('mail_service','getMailBus').trigger('discuss_open',false);this._threadsScrolltop[this._thread.getID()]=this._threadWidget.getScrolltop();},_askConfirmationAdminUnsubscribe:function(channel){Dialog.confirm(this,_t("You are the administrator of this channel. Are you sure you want to unsubscribe?"),{buttons:[{text:_t("Unsubscribe"),classes:'btn-primary',close:true,click:function(){channel.unsubscribe();}},{text:_t("Discard"),close:true,}]});},_banAuthorsFromMessageIDs:function(messageIDs){var self=this;var emailList=_.map(messageIDs,function(messageID){return self.call('mail_service','getMessage',messageID).getEmailFrom();}).join(", ");var text=_.str.sprintf(_t("You are going to ban: %s. Do you confirm the action?"),emailList);var options={confirm_callback:function(){self._moderateMessages(messageIDs,'ban');}};Dialog.confirm(this,text,options);},_discardMessages:function(messageIDs){var self=this;var num=messageIDs.length;var text;if(num>1){text=_.str.sprintf(_t("You are going to discard %s messages. Do you confirm the action?"),num);}else if(num===1){text=_t("You are going to discard 1 message. Do you confirm the action?");}
var options={confirm_callback:function(){self._moderateMessages(messageIDs,'discard');}};Dialog.confirm(this,text,options);},_fetchAndRenderThread:function(){var self=this;return this._thread.fetchMessages(this.domain).then(function(){self._threadWidget.render(self._thread,self._getThreadRenderingOptions());self._updateButtonStatus(!self._thread.hasMessages());return self._loadEnoughMessages();});},_getThreadRenderingOptions:function(){if(_.isUndefined(this.messagesSeparatorPosition)){if(!this._unreadCounter){this.messagesSeparatorPosition=false;}else{var messageID=this._thread.getLastSeenMessageID();this.messagesSeparatorPosition=messageID||'top';}}
var hasThreadMessages=this._thread.hasMessages({domain:this.domain});return{displayLoadMore:!this._thread.isAllHistoryLoaded(this.domain),displayMarkAsRead:this._thread.getID()==='mailbox_inbox',domain:this.domain,messagesSeparatorPosition:this.messagesSeparatorPosition,squashCloseMessages:this._thread.getType()!=='mailbox'&&!this._thread.isMassMailing(),displayEmptyThread:!hasThreadMessages&&!this.domain.length,displayNoMatchFound:!hasThreadMessages&&!!this.domain.length,displaySubjectOnMessages:this._thread.isMassMailing()||this._thread.getID()==='mailbox_inbox'||this._thread.getID()==='mailbox_moderation',displayEmailIcons:false,displayReplyIcons:true,displayBottomThreadFreeSpace:true,displayModerationCommands:true,};},_handleModerationDecision:function(messageIDs,decision){if(messageIDs){if(decision==='reject'){this._rejectMessages(messageIDs);}else if(decision==='discard'){this._discardMessages(messageIDs);}else if(decision==='ban'){this._banAuthorsFromMessageIDs(messageIDs);}else{this._moderateMessages(messageIDs,decision);}}},_loadEnoughMessages:function(){var loadMoreMessages=this._threadWidget.el.clientHeight&&(this._threadWidget.el.clientHeight===this._threadWidget.el.scrollHeight)&&!this._thread.isAllHistoryLoaded(this.domain);if(loadMoreMessages){return this._loadMoreMessages().then(this._loadEnoughMessages.bind(this));}},_loadMoreMessages:function(){var self=this;var oldestMessageID=this.$('.o_thread_message').first().data('messageId');var oldestMessageSelector='.o_thread_message[data-message-id="'+oldestMessageID+'"]';var offset=-dom.getPosition(document.querySelector(oldestMessageSelector)).top;return this._thread.fetchMessages(this.domain,true).then(function(){if(self.messagesSeparatorPosition==='top'){self.messagesSeparatorPosition=undefined;}
self._threadWidget.render(self._thread,self._getThreadRenderingOptions());offset+=dom.getPosition(document.querySelector(oldestMessageSelector)).top;self._threadWidget.scrollToPosition(offset);});},_moderateMessages:function(messageIDs,decision,kwargs){if(messageIDs.length&&decision){return this._rpc({model:'mail.message',method:'moderate',args:[messageIDs,decision],kwargs:kwargs});}},_prepareAddThreadInput:function($input,type){var self=this;if(type==='public'){$input.autocomplete({source:function(request,response){self._lastSearchVal=request.term;self._searchChannel(self._lastSearchVal).done(function(result){result.push({label:_.str.sprintf('<strong>'+_t("Create %s")+'</strong>','<em>"#'+_.escape(self._lastSearchVal)+'"</em>'),value:'_create',});response(result);});},select:function(ev,ui){if(self._lastSearchVal){if(ui.item.value==='_create'){self.call('mail_service','createChannel',self._lastSearchVal,'public');}else{self.call('mail_service','joinChannel',ui.item.id);}}},focus:function(ev){ev.preventDefault();},html:true,});}else if(type==='private'){$input.on('keyup',this,function(ev){var name=$(ev.target).val();if(ev.which===$.ui.keyCode.ENTER&&name){self.call('mail_service','createChannel',name,'private');}});}else if(type==='dm_chat'){$input.autocomplete({source:function(request,response){self._lastSearchVal=request.term;self.call('mail_service','searchPartner',self._lastSearchVal,10).done(response);},select:function(ev,ui){var partnerID=ui.item.id;var dmChat=self.call('mail_service','getDMChatFromPartnerID',partnerID);if(dmChat){self._setThread(dmChat.getID());}else{self.call('mail_service','createChannel',partnerID,'dm_chat');}
$(this).val('');return false;},focus:function(ev){ev.preventDefault();},});}},_rejectMessages:function(messageIDs){var self=this;new ModeratorRejectMessageDialog(this,{messageIDs:messageIDs,proceedReject:function(reason){self._moderateMessages(messageIDs,'reject',reason);}}).open();},_renderButtons:function(){this.$buttons=$(QWeb.render('mail.discuss.ControlButtons',{debug:session.debug}));this.$buttons.find('button').css({display:'inline-block'});this.$buttons.on('click','.o_mail_discuss_button_invite',this._onInviteButtonClicked.bind(this)).on('click','.o_mail_discuss_button_mark_all_read',this._onMarkAllAsReadClicked.bind(this)).on('click','.o_mail_discuss_button_unstar_all',this._onUnstarAllClicked.bind(this)).on('click','.o_mail_discuss_button_moderate_all',this._onModerateAllClicked.bind(this)).on('click','.o_mail_discuss_button_select_all',this._onSelectAllClicked.bind(this)).on('click','.o_mail_discuss_button_unselect_all',this._onUnselectAllClicked.bind(this));},_renderSearchView:function(){var self=this;var options={$buttons:$('<div>'),action:this.action,disable_groupby:true,};this.searchview=new SearchView(this,this.dataset,this.fields_view,options);return this.alive(this.searchview.appendTo($('<div>'))).then(function(){self.$searchview_buttons=self.searchview.$buttons;self.searchview.do_search();});},_renderSidebar:function(options){var inbox=this.call('mail_service','getMailbox','inbox');var starred=this.call('mail_service','getMailbox','starred');var moderation=this.call('mail_service','getMailbox','moderation');var $sidebar=$(QWeb.render('mail.discuss.Sidebar',{activeThreadID:this._thread?this._thread.getID():undefined,threads:options.threads,needactionCounter:inbox.getMailboxCounter(),starredCounter:starred.getMailboxCounter(),moderationCounter:moderation?moderation.getMailboxCounter():0,isMyselfModerator:this.call('mail_service','isMyselfModerator'),}));return $sidebar;},_renderSnackbar:function(template,context,timeout){if(this.$snackbar){this.$snackbar.remove();}
timeout=timeout||20000;this.$snackbar=$(QWeb.render(template,context));this.$('.o_mail_discuss_content').append(this.$snackbar);var $snackbar=this.$snackbar;setTimeout(function(){$snackbar.fadeOut();},timeout);},_renderThread:function(){this._threadWidget=new ThreadWidget(this,{areMessageAttachmentsDeletable:false,loadMoreOnScroll:true,});this._threadWidget.on('redirect',this,function(resModel,resID){this.call('mail_service','redirect',resModel,resID,this._setThread.bind(this));}).on('redirect_to_channel',this,function(channelID){this.call('mail_service','joinChannel',channelID).then(this._setThread.bind(this));}).on('load_more_messages',this,this._loadMoreMessages).on('mark_as_read',this,function(messageID){this.call('mail_service','markMessagesAsRead',[messageID]);}).on('toggle_star_status',this,function(messageID){var message=this.call('mail_service','getMessage',messageID);message.toggleStarStatus();}).on('select_message',this,this._selectMessage).on('unselect_message',this,this._unselectMessage);return this._threadWidget.appendTo(this.$('.o_mail_discuss_content'));},_restoreComposerState:function(channel){var composer=channel.isMassMailing()?this._extendedComposer:this._basicComposer;var composerState=this._composerStates[channel.getUUID()];if(composerState){composer.setState(composerState);}},_restoreThreadState:function(){var $newMessagesSeparator=this.$('.o_thread_new_messages_separator');if($newMessagesSeparator.length){this._threadWidget.$el.scrollTo($newMessagesSeparator);}else{var newThreadScrolltop=this._threadsScrolltop[this._thread.getID()];this._threadWidget.scrollToPosition(newThreadScrolltop);}
if(this._thread.getType()!=='mailbox'){this._restoreComposerState(this._thread);}},_searchChannel:function(searchVal){return this._rpc({model:'mail.channel',method:'channel_search_to_join',args:[searchVal]}).then(function(result){var values=[];_.each(result,function(channel){var escapedName=_.escape(channel.name);values.push(_.extend(channel,{'value':escapedName,'label':escapedName,}));});return values;});},_selectMessage:function(messageID){this.$el.addClass('o_mail_selection_mode');var message=this.call('mail_service','getMessage',messageID);this._selectedMessage=message;var subject="Re: "+message.getDocumentName();this._extendedComposer.setSubject(subject);if(this._thread.getType()!=='mailbox'){this._basicComposer.do_hide();}
this._extendedComposer.do_show();this._threadWidget.scrollToMessage({msgID:messageID,duration:200,onlyIfNecessary:true});this._extendedComposer.focus('body');},_setThread:function(threadID){var self=this;this._storeThreadState();this._thread=this.call('mail_service','getThread',threadID)||this.call('mail_service','getMailbox','inbox');this.messagesSeparatorPosition=undefined;this._unreadCounter=this._thread.getUnreadCounter();if(this.$snackbar){this.$snackbar.remove();}
this.action.context.active_id=this._thread.getID();this.action.context.active_ids=[this._thread.getID()];this._basicComposer.setThread(this._thread);this._extendedComposer.setThread(this._thread);return this._fetchAndRenderThread().then(function(){if(self._thread.getType()!=='mailbox'){self._thread.markAsRead();}
self._restoreThreadState();self.set("title",self._thread.getTitle());self._updateControlPanel();self._updateControlPanelButtons(self._thread);self._unselectMessage();self.action_manager.do_push_state({action:self.action.id,active_id:self._thread.getID(),});});},_startListening:function(){this.call('mail_service','getMailBus').on('open_thread_in_discuss',this,this._onOpenThreadInDiscuss).on('new_message',this,this._onNewMessage).on('update_message',this,this._onMessageUpdated).on('new_channel',this,this._onNewChannel).on('is_thread_bottom_visible',this,this._onIsThreadBottomVisible).on('unsubscribe_from_channel',this,this._onChannelLeft).on('update_needaction',this,this._throttledUpdateThreads).on('update_starred',this,this._throttledUpdateThreads).on('update_thread_unread_counter',this,this._throttledUpdateThreads).on('update_dm_presence',this,this._throttledUpdateThreads).on('activity_updated',this,this._throttledUpdateThreads).on('update_moderation_counter',this,this._throttledUpdateThreads).on('update_typing_partners',this,this._onTypingPartnersUpdated);},_storeComposerState:function(channel){var composer=channel.isMassMailing()?this._extendedComposer:this._basicComposer;this._composerStates[channel.getUUID()]=composer.getState();composer.clearComposer();},_storeThreadState:function(){if(this._thread){this._threadsScrolltop[this._thread.getID()]=this._threadWidget.getScrolltop();if(this._thread.getType()!=='mailbox'){this._storeComposerState(this._thread);}}},_unselectMessage:function(){this._basicComposer.do_toggle(this._thread.getType()!=='mailbox'&&!this._thread.isMassMailing());this._extendedComposer.do_toggle(this._thread.isMassMailing());if(!config.device.isMobile){var composer=this._thread.getType()!=='mailbox'&&this._thread.isMassMailing()?this._extendedComposer:this._basicComposer;composer.focus();}
this.$el.removeClass('o_mail_selection_mode');this._threadWidget.unselectMessage();this._selectedMessage=null;},_updateButtonStatus:function(disabled,type){if(this._thread.getID()==='mailbox_inbox'){this.$buttons.find('.o_mail_discuss_button_mark_all_read').toggleClass('disabled',disabled);if(disabled&&type==='mark_as_read'){this.trigger_up('show_effect',{message:_t("Congratulations, your inbox is empty!"),type:'rainbow_man',});}}
if(this._thread.getID()==='mailbox_starred'){this.$buttons.find('.o_mail_discuss_button_unstar_all').toggleClass('disabled',disabled);}
if(this._thread.getID()==='mailbox_moderation'||(this._thread.isModerated()&&this._thread.isMyselfModerator())){this._updateModerationButtons();}},_updateControlPanel:function(){this.update_control_panel({cp_content:{$buttons:this.$buttons,$searchview:this.searchview.$el,$searchview_buttons:this.$searchview_buttons,},searchview:this.searchview,});},_updateControlPanelButtons:function(thread){if(thread.getType()!=='dm_chat'&&thread.getType()!=='mailbox'){this.$buttons.find('.o_mail_discuss_button_invite, .o_mail_discuss_button_settings').removeClass('d-none d-md-inline-block').addClass('d-none d-md-inline-block');}else{this.$buttons.find('.o_mail_discuss_button_invite, .o_mail_discuss_button_settings').removeClass('d-none d-md-inline-block').addClass('d-none');}
if(thread.getID()==='mailbox_inbox'){this.$buttons.find('.o_mail_discuss_button_mark_all_read').removeClass('d-none d-md-inline-block').addClass('d-none d-md-inline-block');}else{this.$buttons.find('.o_mail_discuss_button_mark_all_read').removeClass('d-none d-md-inline-block').addClass('d-none');}
if(thread.getID()==='mailbox_starred'){this.$buttons.find('.o_mail_discuss_button_unstar_all').removeClass('d-none');}else{this.$buttons.find('.o_mail_discuss_button_unstar_all').addClass('d-none');}
if((thread.isModerated()&&thread.isMyselfModerator())||thread.getID()==='mailbox_moderation'){this.$buttons.find('.o_mail_discuss_button_select_all').removeClass('d-none');this.$buttons.find('.o_mail_discuss_button_unselect_all').removeClass('d-none');}else{this.$buttons.find('.o_mail_discuss_button_select_all').addClass('d-none');this.$buttons.find('.o_mail_discuss_button_unselect_all').addClass('d-none');}
this.$buttons.find('.o_mail_discuss_button_moderate_all').addClass('d-none');this.$('.o_mail_discuss_item').removeClass('o_active').filter('[data-thread-id='+thread.getID()+']').removeClass('o_unread_message').addClass('o_active');},_updateModerationButtons:function(){this._updateSelectUnselectAllButtons();this._updateModerationDecisionButton();},_updateModerationDecisionButton:function(){if(this._threadWidget.$('.moderation_checkbox:checked').length){this.$buttons.find('.o_mail_discuss_button_moderate_all').removeClass('d-none');}else{this.$buttons.find('.o_mail_discuss_button_moderate_all').addClass('d-none');}},_updateSelectUnselectAllButtons:function(){var buttonSelect=this.$buttons.find('.o_mail_discuss_button_select_all');var buttonUnselect=this.$buttons.find('.o_mail_discuss_button_unselect_all');var numCheckboxes=this._threadWidget.$('.moderation_checkbox').length;var numCheckboxesChecked=this._threadWidget.$('.moderation_checkbox:checked').length;if(numCheckboxes){if(numCheckboxesChecked===numCheckboxes){buttonSelect.toggleClass('disabled',true);buttonUnselect.toggleClass('disabled',false);}else if(numCheckboxesChecked===0){buttonSelect.toggleClass('disabled',false);buttonUnselect.toggleClass('disabled',true);}else{buttonSelect.toggleClass('disabled',false);buttonUnselect.toggleClass('disabled',false);}}else{buttonSelect.toggleClass('disabled',true);buttonUnselect.toggleClass('disabled',true);}},_updateThreads:function(){var self=this;var $sidebar=this._renderSidebar({threads:_.filter(this.call('mail_service','getThreads'),function(thread){return thread.getType()!=='document_thread';}),});this.$('.o_mail_discuss_sidebar').html($sidebar.contents());_.each(['dm_chat','public','private'],function(type){var $input=self.$('.o_mail_add_thread[data-type='+type+'] input');self._prepareAddThreadInput($input,type);});},_onAddThread:function(ev){ev.preventDefault();var type=$(ev.target).data('type');this.$('.o_mail_add_thread[data-type='+type+']').show().find('input').focus();},_onAddThreadBlur:function(){this.$('.o_mail_add_thread').hide();},_onChannelLeft:function(channelID){if(this._thread.getID()===channelID){this._setThread('mailbox_inbox');}
this._updateThreads();delete this._threadsScrolltop[channelID];},_onChannelSettingsClicked:function(ev){var threadID=$(ev.target).data('thread-id');this.do_action({type:'ir.actions.act_window',res_model:'mail.channel',res_id:threadID,views:[[false,'form']],target:'current'});},_onComposerFocused:function(){var composer=this._thread.isMassMailing()?this._extendedComposer:this._basicComposer;var commands=this._thread.getCommands();var partners=this._thread.getMentionPartnerSuggestions();composer.mentionSetCommands(commands);composer.mentionSetPrefetchedPartners(partners);},_onDiscussItemClicked:function(ev){ev.preventDefault();var threadID=$(ev.currentTarget).data('thread-id');this._setThread(threadID);},_onInviteButtonClicked:function(){var title=_.str.sprintf(_t("Invite people to #%s"),_.escape(this._thread.getName()));new PartnerInviteDialog(this,title,this._thread.getID()).open();},_onIsThreadBottomVisible:function(thread,query){query.isVisible=query.isVisible||(thread.getID()===this._thread.getID()&&this._threadWidget.isAtBottom());},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ESCAPE&&this._selectedMessage){this._unselectMessage();}},_onMarkAllAsReadClicked:function(){this._thread.markAllMessagesAsRead(this.domain);},_onMessageModeration:function(ev){var messageIDs=[ev.data.messageID];var decision=ev.data.decision;this._handleModerationDecision(messageIDs,decision);},_onMessageUpdated:function(message,type){var self=this;var currentThreadID=this._thread.getID();if((currentThreadID==='mailbox_starred'&&!message.isStarred())||(currentThreadID==='mailbox_inbox'&&!message.isNeedaction())||(currentThreadID==='mailbox_moderation'&&!message.needsModeration())){this._thread.fetchMessages(this.domain).then(function(){var options=self._getThreadRenderingOptions();self._threadWidget.removeMessageAndRender(message.getID(),self._thread,options).then(function(){self._updateButtonStatus(!self._thread.hasMessages(),type);});});}else if(_.contains(message.getThreadIDs(),currentThreadID)){this._fetchAndRenderThread();}},_onModerateAllClicked:function(ev){var decision=$(ev.target).data('decision');var messageIDs=this._threadWidget.$('.moderation_checkbox:checked').map(function(){return $(this).data('message-id');}).get();this._handleModerationDecision(messageIDs,decision);},_onNewChannel:function(channel){this._updateThreads();if(channel.isAutoswitch()){this._setThread(channel.getID());}},_onNewMessage:function(message){var self=this;if(_.contains(message.getThreadIDs(),this._thread.getID())){if(this._thread.getType()!=='mailbox'&&this._threadWidget.isAtBottom()){this._thread.markAsRead();}
var shouldScroll=this._threadWidget.isAtBottom();this._fetchAndRenderThread().then(function(){if(shouldScroll){self._threadWidget.scrollToMessage({msgID:message.getID()});}});}
this._updateThreads();this._threadsScrolltop=_.omit(this._threadsScrolltop,message.getThreadIDs());},_onOpenThreadInDiscuss:function(thread){if(thread.getType()!=='document_thread'){this._setThread(thread.getID());}},_onPostMessage:function(messageData){var self=this;var options={};if(this._selectedMessage){messageData.subtype=this._selectedMessage.isNote()?'mail.mt_note':'mail.mt_comment';messageData.subtype_id=false;messageData.message_type='comment';options.documentID=this._selectedMessage.getDocumentID();options.documentModel=this._selectedMessage.getDocumentModel();}
this._thread.postMessage(messageData,options).then(function(){if(self._selectedMessage){self._renderSnackbar('mail.discuss.MessageSentSnackbar',{documentName:self._selectedMessage.getDocumentName()},5000);self._unselectMessage();}else{self._threadWidget.scrollToBottom();}}).fail(function(){});},_onPublicChannelsClick:function(){this.do_action({name:_t("Public Channels"),type:'ir.actions.act_window',res_model:'mail.channel',views:[[false,'kanban'],[false,'form']],domain:[['public','!=','private']],},{on_reverse_breadcrumb:this.on_reverse_breadcrumb,});},_onSearch:function(ev){ev.stopPropagation();var session=this.getSession();var result=pyUtils.eval_domains_and_contexts({domains:ev.data.domains,contexts:[session.user_context],});this.domain=result.domain;if(this._thread){this._fetchAndRenderThread();}},_onSelectAllClicked:function(ev){var $button=$(ev.target);if(!$button.hasClass('disabled')){this._threadWidget.toggleModerationCheckboxes(true);this._updateModerationButtons();}},_onTypingPartnersUpdated:function(threadID){var self=this;if(this._thread.getID()!==threadID){return;}
if(this._thread.hasTypingNotification()){this._thread.getMentionPartnerSuggestions().then(function(){self._threadWidget.renderTypingNotificationBar(self._thread);});}},_onUnpinChannel:function(ev){ev.stopPropagation();var channelID=$(ev.target).data('thread-id');var channel=this.call('mail_service','getChannel',channelID);if(channel.isMyselfAdministrator()){this._askConfirmationAdminUnsubscribe(channel);}else{channel.unsubscribe();}},_onUnselectAllClicked:function(ev){var $button=$(ev.target);if(!$button.hasClass('disabled')){this._threadWidget.toggleModerationCheckboxes(false);this._updateModerationButtons();}},_onUnstarAllClicked:function(){this.call('mail_service','unstarAll');},_onUpdateModerationButtons:function(){this._updateModerationButtons();},});core.action_registry.add('mail.discuss',Discuss);return Discuss;});;

/* /mail/static/src/js/discuss_mobile.js defined in bundle 'web.assets_backend' */
odoo.define('mail.DiscussMobile',function(require){"use strict";var Discuss=require('mail.Discuss');var config=require('web.config');var core=require('web.core');var QWeb=core.qweb;if(!config.device.isMobile){return;}
Discuss.include({template:'mail.discuss_mobile',events:_.extend(Discuss.prototype.events,{'click .o_mail_mobile_tab':'_onMobileTabClicked','click .o_mailbox_inbox_item':'_onMobileInboxButtonClicked','click .o_mail_preview':'_onMobileThreadClicked',}),init:function(){this._super.apply(this,arguments);this._currentState=this._defaultThreadID;},start:function(){var self=this;this._$mainContent=this.$('.o_mail_discuss_content');return this._super.apply(this,arguments).then(this._updateControlPanel.bind(this)).then(function(def){self._updateContent(self._thread._type=='mailbox'?'mailbox_inbox':self._thread._type);return def;});},on_attach_callback:function(){if(this._thread&&this._isInInboxTab()){this._threadWidget.scrollToPosition(this._threadsScrolltop[this._thread.getID()]);}},on_detach_callback:function(){if(this._isInInboxTab()){this._threadsScrolltop[this._thread.getID()]=this._threadWidget.getScrolltop();}},_isInInboxTab:function(){return _.contains(['mailbox_inbox','mailbox_starred'],this._currentState);},_renderButtons:function(){var self=this;this._super.apply(this,arguments);_.each(['dm_chat','public','private'],function(type){var selector='.o_mail_discuss_button_'+type;self.$buttons.on('click',selector,self._onAddThread.bind(self));});},_restoreThreadState:function(){if(this._isInInboxTab()){this._super.apply(this,arguments);}},_selectMessage:function(){this._super.apply(this,arguments);this.$('.o_mail_mobile_tabs').addClass('o_hidden');},_setThread:function(threadID){var thread=this.call('mail_service','getThread',threadID);this._thread=thread;if(thread.getType()!=='mailbox'){this.call('mail_service','openThreadWindow',threadID);return $.when();}else{return this._super.apply(this,arguments);}},_storeThreadState:function(){if(this._thread&&this._isInInboxTab()){this._super.apply(this,arguments);}},_unselectMessage:function(){this._super.apply(this,arguments);this.$('.o_mail_mobile_tabs').removeClass('o_hidden');},_updateThreads:function(){return this._updateContent(this._currentState);},_updateContent:function(type){var self=this;var inMailbox=type==='mailbox_inbox'||type==='mailbox_starred';if(!inMailbox&&this._isInInboxTab()){this._storeThreadState();}
var previouslyInInbox=this._isInInboxTab();this._currentState=type;var def;if(inMailbox){def=this._fetchAndRenderThread();}else{var allChannels=this.call('mail_service','getChannels');var channels=_.filter(allChannels,function(channel){return channel.getType()===type;});def=this.call('mail_service','getChannelPreviews',channels);}
return $.when(def).then(function(previews){if(inMailbox){if(!previouslyInInbox){self.$('.o_mail_discuss_tab_pane').remove();self._$mainContent.append(self._threadWidget.$el);self._$mainContent.append(self._extendedComposer.$el);}
self._restoreThreadState();}else{self._threadWidget.$el.detach();self._extendedComposer.$el.detach();var $content=$(QWeb.render('mail.discuss.MobileTabPane',{previews:previews,type:type,}));self._prepareAddThreadInput($content.find('.o_mail_add_thread input'),type);self._$mainContent.html($content);}
self.$buttons.find('button').removeClass('d-block').addClass('d-none');self.$buttons.find('.o_mail_discuss_button_'+type).removeClass('d-none').addClass('d-block');self.$buttons.find('.o_mail_discuss_button_mark_all_read').toggleClass('d-none',type!=='mailbox_inbox').toggleClass('d-block',type==='mailbox_inbox');self.$buttons.find('.o_mail_discuss_button_unstar_all').toggleClass('d-none',type!=='mailbox_starred').toggleClass('d-block',type==='mailbox_starred');if(inMailbox){self.$('.o_mail_discuss_mobile_mailboxes_buttons').removeClass('o_hidden');self.$('.o_mailbox_inbox_item').removeClass('btn-primary').addClass('btn-secondary');self.$('.o_mailbox_inbox_item[data-type='+type+']').removeClass('btn-secondary').addClass('btn-primary');}else{self.$('.o_mail_discuss_mobile_mailboxes_buttons').addClass('o_hidden');}
self.$('.o_mail_mobile_tab').removeClass('active');type=type==='mailbox_starred'?'mailbox_inbox':type;self.$('.o_mail_mobile_tab[data-type='+type+']').addClass('active');});},_onAddThread:function(){this.$('.o_mail_add_thread').show().find('input').focus();},_onMobileInboxButtonClicked:function(ev){var mailboxID=$(ev.currentTarget).data('type');this._setThread(mailboxID);this._updateContent(this._thread.getID());},_onMobileTabClicked:function(ev){var type=$(ev.currentTarget).data('type');if(type==='mailbox_inbox'){this._setThread(type);}
this._updateContent(type);},_onMobileThreadClicked:function(ev){var threadID=$(ev.currentTarget).data('preview-id');this.call('mail_service','openThreadWindow',threadID);},});});;

/* /mail/static/src/js/document_viewer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.DocumentViewer',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var SCROLL_ZOOM_STEP=0.1;var ZOOM_STEP=0.5;var DocumentViewer=Widget.extend({template:"DocumentViewer",events:{'click .o_download_btn':'_onDownload','click .o_split_btn':'_onSplitPDF','click .o_viewer_img':'_onImageClicked','click .o_viewer_video':'_onVideoClicked','click .move_next':'_onNext','click .move_previous':'_onPrevious','click .o_rotate':'_onRotate','click .o_zoom_in':'_onZoomIn','click .o_zoom_out':'_onZoomOut','click .o_zoom_reset':'_onZoomReset','click .o_close_btn, .o_viewer_img_wrapper':'_onClose','click .o_print_btn':'_onPrint','DOMMouseScroll .o_viewer_content':'_onScroll','mousewheel .o_viewer_content':'_onScroll','keydown':'_onKeydown','keyup':'_onKeyUp','mousedown .o_viewer_img':'_onStartDrag','mousemove .o_viewer_content':'_onDrag','mouseup .o_viewer_content':'_onEndDrag'},init:function(parent,attachments,activeAttachmentID){this._super.apply(this,arguments);this.attachment=_.filter(attachments,function(attachment){var match=attachment.type=='url'?attachment.url.match("(youtu|.png|.jpg|.gif)"):attachment.mimetype.match("(image|video|application/pdf|text)");if(match){attachment.type=match[1];if(match[1].match("(.png|.jpg|.gif)")){attachment.type='image';}
if(match[1]==='youtu'){var youtube_array=attachment.url.split('/');var youtube_token=youtube_array[youtube_array.length-1];if(youtube_token.indexOf('watch')!==-1){youtube_token=youtube_token.split('v=')[1];var amp=youtube_token.indexOf('&')
if(amp!==-1){youtube_token=youtube_token.substring(0,amp);}}
attachment.youtube=youtube_token;}
return true;}});this.activeAttachment=_.findWhere(attachments,{id:activeAttachmentID});this._reset();},start:function(){this.$el.modal('show');this.$el.on('hidden.bs.modal',_.bind(this._onDestroy,this));this.$('.o_viewer_img').load(_.bind(this._onImageLoaded,this));this.$('[data-toggle="tooltip"]').tooltip({delay:0});return this._super.apply(this,arguments);},destroy:function(){if(this.isDestroyed()){return;}
this.trigger_up('document_viewer_closed');this.$el.modal('hide');this.$el.remove();this._super.apply(this,arguments);},_next:function(){var index=_.findIndex(this.attachment,this.activeAttachment);index=(index+1)%this.attachment.length;this.activeAttachment=this.attachment[index];this._updateContent();},_previous:function(){var index=_.findIndex(this.attachment,this.activeAttachment);index=index===0?this.attachment.length-1:index-1;this.activeAttachment=this.attachment[index];this._updateContent();},_reset:function(){this.scale=1;this.dragStartX=this.dragstopX=0;this.dragStartY=this.dragstopY=0;},_updateContent:function(){this.$('.o_viewer_content').html(QWeb.render('DocumentViewer.Content',{widget:this}));this.$('.o_viewer_img').load(_.bind(this._onImageLoaded,this));this.$('[data-toggle="tooltip"]').tooltip({delay:0});this._reset();},_getTransform:function(scale,angle){return'scale3d('+scale+', '+scale+', 1) rotate('+angle+'deg)';},_rotate:function(angle){this._reset();var new_angle=(this.angle||0)+angle;this.$('.o_viewer_img').css('transform',this._getTransform(this.scale,new_angle));this.$('.o_viewer_img').css('max-width',new_angle%180!==0?$(document).height():'100%');this.$('.o_viewer_img').css('max-height',new_angle%180!==0?$(document).width():'100%');this.angle=new_angle;},_zoom:function(scale){if(scale>0.5){this.$('.o_viewer_img').css('transform',this._getTransform(scale,this.angle||0));this.scale=scale;}
this.$('.o_zoom_reset').add('.o_zoom_out').toggleClass('disabled',scale===1);},_onClose:function(e){e.preventDefault();this.destroy();},_onDestroy:function(){this.destroy();},_onDownload:function(e){e.preventDefault();window.location='/web/content/'+this.activeAttachment.id+'?download=true';},_onDrag:function(e){e.preventDefault();if(this.enableDrag){var $image=this.$('.o_viewer_img');var $zoomer=this.$('.o_viewer_zoomer');var top=$image.prop('offsetHeight')*this.scale>$zoomer.height()?e.clientY-this.dragStartY:0;var left=$image.prop('offsetWidth')*this.scale>$zoomer.width()?e.clientX-this.dragStartX:0;$zoomer.css("transform","translate3d("+left+"px, "+top+"px, 0)");$image.css('cursor','move');}},_onEndDrag:function(e){e.preventDefault();if(this.enableDrag){this.enableDrag=false;this.dragstopX=e.clientX-this.dragStartX;this.dragstopY=e.clientY-this.dragStartY;this.$('.o_viewer_img').css('cursor','');}},_onImageClicked:function(e){e.stopPropagation();},_onImageLoaded:function(){this.$('.o_loading_img').hide();},_onKeydown:function(e){switch(e.which){case $.ui.keyCode.RIGHT:e.preventDefault();this._next();break;case $.ui.keyCode.LEFT:e.preventDefault();this._previous();break;}},_onKeyUp:function(e){switch(e.which){case $.ui.keyCode.ESCAPE:e.preventDefault();this._onClose(e);break;}},_onNext:function(e){e.preventDefault();this._next();},_onPrevious:function(e){e.preventDefault();this._previous();},_onPrint:function(e){e.preventDefault();var src=this.$('.o_viewer_img').prop('src');var script=QWeb.render('PrintImage',{src:src});var printWindow=window.open('about:blank',"_new");printWindow.document.open();printWindow.document.write(script);printWindow.document.close();},_onScroll:function(e){var scale;if(e.originalEvent.wheelDelta>0||e.originalEvent.detail<0){scale=this.scale+SCROLL_ZOOM_STEP;this._zoom(scale);}else{scale=this.scale-SCROLL_ZOOM_STEP;this._zoom(scale);}},_onSplitPDF:function(e){e.stopPropagation();var self=this;var indices=$("input[name=Indices]").val();var remainder=$("input[type=checkbox][name=remainder]").is(":checked");this._rpc({model:'ir.attachment',method:'split_pdf',args:[this.activeAttachment.id,indices,remainder],}).always(function(){self.trigger_up('document_viewer_attachment_changed');self.destroy();});},_onStartDrag:function(e){e.preventDefault();this.enableDrag=true;this.dragStartX=e.clientX-(this.dragstopX||0);this.dragStartY=e.clientY-(this.dragstopY||0);},_onVideoClicked:function(e){e.stopPropagation();var videoElement=e.target;if(videoElement.paused){videoElement.play();}else{videoElement.pause();}},_onRotate:function(e){e.preventDefault();this._rotate(90);},_onZoomIn:function(e){e.preventDefault();var scale=this.scale+ZOOM_STEP;this._zoom(scale);},_onZoomOut:function(e){e.preventDefault();var scale=this.scale-ZOOM_STEP;this._zoom(scale);},_onZoomReset:function(e){e.preventDefault();this.$('.o_viewer_zoomer').css("transform","");this._zoom(1);},});return DocumentViewer;});;

/* /mail/static/src/js/composers/basic_composer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.composer.Basic',function(require){"use strict";var emojis=require('mail.emojis');var MentionManager=require('mail.composer.MentionManager');var DocumentViewer=require('mail.DocumentViewer');var mailUtils=require('mail.utils');var config=require('web.config');var core=require('web.core');var data=require('web.data');var dom=require('web.dom');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var BasicComposer=Widget.extend({template:"mail.Composer",events:{'change input.o_input_file':'_onAttachmentChange','click .o_attachment_delete':'_onAttachmentDelete','click .o_attachment_download':'_onAttachmentDownload','click .o_attachment_view':'_onAttachmentView','click .o_composer_button_add_attachment':'_onClickAddAttachment','click .o_composer_button_emoji':'_onEmojiButtonClick','focusout .o_composer_button_emoji':'_onEmojiButtonFocusout','click .o_mail_emoji_container .o_mail_emoji':'_onEmojiImageClick','focus .o_mail_emoji_container .o_mail_emoji':'_onEmojiImageFocus','input .o_input':'_onInput','keydown .o_composer_input textarea':'_onKeydown','keyup .o_composer_input':'_onKeyup','click .o_composer_button_send':'_sendMessage',},MENTION_THROTTLE:200,init:function(parent,options){this._super.apply(this,arguments);this.options=_.defaults(options||{},{commandsEnabled:true,context:{},inputMinHeight:28,mentionFetchLimit:8,mentionPartnersRestricted:false,sendText:_t("Send"),defaultBody:'',defaultMentionSelections:{},isMobile:config.device.isMobile});this.context=this.options.context;this._attachmentDataSet=new data.DataSetSearch(this,'ir.attachment',this.context);this.fileuploadID=_.uniqueId('o_chat_fileupload');this.set('attachment_ids',options.attachmentIds||[]);this._mentionManager=new MentionManager(this);this._mentionManager.register({delimiter:'@',fetchCallback:this._mentionFetchPartners.bind(this),generateLinks:true,model:'res.partner',redirectClassname:'o_mail_redirect',selection:this.options.defaultMentionSelections['@'],suggestionTemplate:'mail.MentionSuggestions.Partner',});this._mentionManager.register({delimiter:'#',fetchCallback:this._mentionFetchChannels.bind(this),generateLinks:true,model:'mail.channel',redirectClassname:'o_channel_redirect',selection:this.options.defaultMentionSelections['#'],suggestionTemplate:'mail.MentionSuggestions.Channel',});this._mentionManager.register({delimiter:':',fetchCallback:this._mentionGetCannedResponses.bind(this),selection:this.options.defaultMentionSelections[':'],suggestionTemplate:'mail.MentionSuggestions.CannedResponse',});if(this.options.commandsEnabled){this._mentionManager.register({beginningOnly:true,delimiter:'/',fetchCallback:this._mentionGetCommands.bind(this),selection:this.options.defaultMentionSelections['/'],suggestionTemplate:'mail.MentionSuggestions.Command',});}
this.isMini=options.isMini;this.avatarURL=session.uid>0?session.url('/web/image',{model:'res.users',field:'image_small',id:session.uid,}):'/web/static/src/img/user_menu_avatar.png';},start:function(){var self=this;this._$attachmentButton=this.$('.o_composer_button_add_attachment');this._$attachmentsList=this.$('.o_composer_attachments_list');this.$input=this.$('.o_composer_input textarea');this.$input.focus(function(){self.trigger('input_focused');});this.$input.val(this.options.defaultBody);dom.autoresize(this.$input,{parent:this,min_height:this.options.inputMinHeight});this._renderAttachments();$(window).on(this.fileuploadID,this._onAttachmentLoaded.bind(this));this.on('change:attachment_ids',this,this._renderAttachments);this._mentionManager.prependTo(this.$('.o_composer'));return this._super();},destroy:function(){$(window).off(this.fileuploadID);return this._super.apply(this,arguments);},clearComposer:function(){this.$input.val('');this._mentionManager.resetSelections();this.set('attachment_ids',[]);},focus:function(){this.$input.focus();},getState:function(){return{attachments:this.get('attachment_ids'),text:this.$input.val(),};},isEmpty:function(){return!this.$input.val().trim()&&!this.$('.o_attachments').children().length;},setState:function(state){this.set('attachment_ids',state.attachments);this.$input.val(state.text);},setThread:function(thread){this.options.thread=thread;},mentionSetCommands:function(commands){this._mentionCommands=commands;},mentionSetPrefetchedPartners:function(prefetchedPartners){this._mentionPrefetchedPartners=prefetchedPartners;},getMentionListenerSelections:function(){return this._mentionManager.getListenerSelections();},_clearComposerOnSend:function(){this.clearComposer();},_doCheckAttachmentUpload:function(){if(_.find(this.get('attachment_ids'),function(file){return file.upload;})){this.do_warn(_t("Uploading error"),_t("Please, wait while the file is uploading."));return false;}
return true;},_hideEmojis:function(){this._$emojisContainer.remove();},_mentionGetCannedResponses:function(search){var self=this;var def=$.Deferred();clearTimeout(this._cannedTimeout);this._cannedTimeout=setTimeout(function(){var cannedResponses=self.call('mail_service','getCannedResponses');var matches=fuzzy.filter(mailUtils.unaccent(search),_.pluck(cannedResponses,'source'));var indexes=_.pluck(matches.slice(0,self.options.mentionFetchLimit),'index');def.resolve(_.map(indexes,function(index){return cannedResponses[index];}));},500);return def;},_mentionGetCommands:function(search){var searchRegexp=new RegExp(_.str.escapeRegExp(mailUtils.unaccent(search)),'i');return _.filter(this._mentionCommands,function(command){return searchRegexp.test(command.name);}).slice(0,this.options.mentionFetchLimit);},_mentionFetchChannels:function(search){return this._mentionFetchThrottled('mail.channel','get_mention_suggestions',{limit:this.options.mentionFetchLimit,search:search,}).then(function(suggestions){return _.partition(suggestions,function(suggestion){return _.contains(['public','groups'],suggestion.public);});});},_mentionFetchPartners:function(search){var self=this;return $.when(this._mentionPrefetchedPartners).then(function(prefetchedPartners){var suggestions=[];var limit=self.options.mentionFetchLimit;var searchRegexp=new RegExp(_.str.escapeRegExp(mailUtils.unaccent(search)),'i');_.each(prefetchedPartners,function(partners){if(limit>0){var filteredPartners=_.filter(partners,function(partner){return partner.email&&searchRegexp.test(partner.email)||partner.name&&searchRegexp.test(mailUtils.unaccent(partner.name));});if(filteredPartners.length){suggestions.push(filteredPartners.slice(0,limit));limit-=filteredPartners.length;}}});if(!suggestions.length&&!self.options.mentionPartnersRestricted){suggestions=self._mentionFetchThrottled('res.partner','get_mention_suggestions',{limit:limit,search:search});}
return suggestions;});},_mentionFetchThrottled:function(model,method,kwargs){var self=this;var def=$.Deferred();clearTimeout(this.mentionFetchTimer);this.mentionFetchTimer=setTimeout(function(){return self._rpc({model:model,method:method,kwargs:kwargs}).then(function(results){def.resolve(results);});},this.MENTION_THROTTLE);return def;},_preprocessMessage:function(){var value=_.escape(this.$input.val()).trim();value=value.replace(/(\r|\n){2,}/g,'<br/><br/>');value=value.replace(/(\r|\n)/g,'<br/>');value=value.replace(/ /g,'&nbsp;').replace(/([^>])&nbsp;([^<])/g,'$1 $2');var commands=this.options.commandsEnabled?this._mentionManager.getListenerSelection('/'):[];return $.when({content:this._mentionManager.generateLinks(value),attachment_ids:_.pluck(this.get('attachment_ids'),'id'),partner_ids:_.uniq(_.pluck(this._mentionManager.getListenerSelection('@'),'id')),canned_response_ids:_.uniq(_.pluck(this._mentionManager.getListenerSelections()[':'],'id')),channel_ids:_.uniq(_.pluck(this._mentionManager.getListenerSelection('#'),'id')),command:commands.length>0?commands[0].name:undefined,});},_renderAttachments:function(){this._$attachmentsList.html(QWeb.render('mail.composer.Attachments',{attachments:this.get('attachment_ids'),}));},_sendMessage:function(){if(this.isEmpty()||!this._doCheckAttachmentUpload()){return;}
clearTimeout(this._cannedTimeout);var self=this;this._preprocessMessage().then(function(message){self.trigger('post_message',message);self._clearComposerOnSend();self.$input.focus();});},_shouldSend:function(ev){return!ev.shiftKey;},_onAttachmentChange:function(ev){var self=this;var files=ev.target.files;var attachments=this.get('attachment_ids');_.each(files,function(file){var attachment=_.findWhere(attachments,{name:file.name});if(attachment){self._attachmentDataSet.unlink([attachment.id]);attachments=_.without(attachments,attachment);}});this.$('form.o_form_binary_form').submit();this._$attachmentButton.prop('disabled',true);var uploadAttachments=_.map(files,function(file){return{id:0,name:file.name,filename:file.name,url:'',upload:true,mimetype:'',};});attachments=attachments.concat(uploadAttachments);this.set('attachment_ids',attachments);ev.target.value="";},_onAttachmentDelete:function(ev){ev.stopPropagation();var self=this;var attachmentID=$(ev.currentTarget).data('id');if(attachmentID){var attachments=[];_.each(this.get('attachment_ids'),function(attachment){if(attachmentID!==attachment.id){attachments.push(attachment);}else{self._attachmentDataSet.unlink([attachmentID]);}});this.set('attachment_ids',attachments);this.$('input.o_input_file').val('');}},_onAttachmentDownload:function(ev){ev.stopPropagation();},_onAttachmentLoaded:function(){var attachments=this.get('attachment_ids');var files=Array.prototype.slice.call(arguments,1);_.each(files,function(file){if(file.error||!file.id){this.do_warn(file.error);attachments=_.filter(attachments,function(attachment){return!attachment.upload;});}else{var attachment=_.findWhere(attachments,{filename:file.filename,upload:true});if(attachment){attachments=_.without(attachments,attachment);attachments.push({id:file.id,name:file.name||file.filename,filename:file.filename,mimetype:file.mimetype,url:session.url('/web/content',{id:file.id,download:true}),});}}}.bind(this));this.set('attachment_ids',attachments);this._$attachmentButton.prop('disabled',false);},_onAttachmentView:function(ev){var activeAttachmentID=$(ev.currentTarget).data('id');var attachments=this.get('attachment_ids');if(activeAttachmentID){var attachmentViewer=new DocumentViewer(this,attachments,activeAttachmentID);attachmentViewer.appendTo($('body'));}},_onClickAddAttachment:function(){this.$('input.o_input_file').click();this.$input.focus();},_onEmojiButtonClick:function(){if(!this._$emojisContainer){this._$emojisContainer=$(QWeb.render('mail.Composer.emojis',{emojis:emojis,}));}
if(this._$emojisContainer.parent().length){this._hideEmojis();}else{this._$emojisContainer.appendTo(this.$('.o_composer'));}},_onEmojiButtonFocusout:function(){if(this._$emojisContainer){this._hideEmojisTimeout=setTimeout(this._hideEmojis.bind(this),0);}},_onEmojiImageClick:function(ev){this.$input.val(this.$input.val()+" "+$(ev.currentTarget).data('emoji')+" ");this.$input.focus();this._hideEmojis();},_onEmojiImageFocus:function(){clearTimeout(this._hideEmojisTimeout);},_onInput:function(){if(this.options.thread&&this.options.thread.hasTypingNotification()){var isTyping=this.$input.val().length>0;this.options.thread.setMyselfTyping({typing:isTyping});}},_onKeydown:function(ev){switch(ev.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:case $.ui.keyCode.TAB:if(this._mentionManager.isOpen()){ev.preventDefault();}
break;case $.ui.keyCode.ENTER:if(this._mentionManager.isOpen()){ev.preventDefault();}else{var sendMessage=ev.ctrlKey||this._shouldSend(ev);if(sendMessage){ev.preventDefault();this._sendMessage();}}
break;}},_onKeyup:function(ev){switch(ev.which){case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:break;case $.ui.keyCode.ESCAPE:if(this._mentionManager.isOpen()){ev.stopPropagation();this._mentionManager.resetSuggestions();}else{this.trigger_up('escape_pressed');}
break;case $.ui.keyCode.ENTER:case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:case $.ui.keyCode.TAB:if(this._mentionManager.isOpen()){this._mentionManager.propositionNavigation(ev.which);}
break;default:this._mentionManager.detectDelimiter();}},});return BasicComposer;});;

/* /mail/static/src/js/composers/chatter_composer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.composer.Chatter',function(require){"use strict";var BasicComposer=require('mail.composer.Basic');var mailUtils=require('mail.utils');var session=require('web.session');var core=require('web.core');var viewDialogs=require('web.view_dialogs');var _t=core._t;var ChatterComposer=BasicComposer.extend({template:'mail.chatter.Composer',events:_.extend({},BasicComposer.prototype.events,{'click .o_composer_button_full_composer':'_onOpenFullComposer',}),init:function(parent,model,suggestedPartners,options){this._super(parent,options);this._model=model;this.suggestedPartners=suggestedPartners;this.options=_.defaults(this.options,{display_mode:'textarea',recordName:false,isLog:false,});if(this.options.isLog){this.options.sendText=_t("Log");}
this.notInline=true;},_clearComposerOnSend:function(){},_checkSuggestedPartners:function(checkedSuggestedPartners){var self=this;var checkDone=$.Deferred();var recipients=_.filter(checkedSuggestedPartners,function(recipient){return recipient.checked;});var recipientsToFind=_.filter(recipients,function(recipient){return(!recipient.partner_id);});var namesToFind=_.pluck(recipientsToFind,'full_name');var recipientsToCheck=_.filter(recipients,function(recipient){return(recipient.partner_id&&!recipient.email_address);});var recipientIDs=_.pluck(_.filter(recipients,function(recipient){return recipient.partner_id&&recipient.email_address;}),'partner_id');var namesToRemove=[];var recipientIDsToRemove=[];var def;if(namesToFind.length>0){def=this._rpc({model:this._model,method:'message_partner_info_from_emails',args:[[this.context.default_res_id],namesToFind],});}
$.when(def).pipe(function(result){result=result||[];var emailDefs=[];var recipientPopups=result.concat(recipientsToCheck);_.each(recipientPopups,function(partnerInfo){var deferred=$.Deferred();emailDefs.push(deferred);var partnerName=partnerInfo.full_name;var partnerID=partnerInfo.partner_id;var parsedEmail=mailUtils.parseEmail(partnerName);var dialog=new viewDialogs.FormViewDialog(self,{res_model:'res.partner',res_id:partnerID,context:{active_model:self._model,active_id:self.context.default_res_id,force_email:true,ref:'compound_context',default_name:parsedEmail[0],default_email:parsedEmail[1],},title:_t("Please complete customer's informations"),disable_multiple_selection:true,}).open();dialog.on('closed',self,function(){deferred.resolve();});dialog.opened().then(function(){dialog.form_view.on('on_button_cancel',self,function(){namesToRemove.push(partnerName);if(partnerID){recipientIDsToRemove.push(partnerID);}});});});$.when.apply($,emailDefs).then(function(){var newNamesToFind=_.difference(namesToFind,namesToRemove);var def;if(newNamesToFind.length>0){def=self._rpc({model:self._model,method:'message_partner_info_from_emails',args:[[self.context.default_res_id],newNamesToFind,true],});}
$.when(def).pipe(function(result){result=result||[];var recipientPopups=result.concat(recipientsToCheck);_.each(recipientPopups,function(partnerInfo){if(partnerInfo.partner_id&&_.indexOf(partnerInfo.partner_id,recipientIDsToRemove)===-1){recipientIDs.push(partnerInfo.partner_id);}});}).pipe(function(){checkDone.resolve(recipientIDs);});});});return checkDone;},_getCheckedSuggestedPartners:function(){var self=this;var checkedPartners=[];this.$('.o_composer_suggested_partners input:checked').each(function(){var fullName=$(this).data('fullname');checkedPartners=checkedPartners.concat(_.filter(self.suggestedPartners,function(item){return fullName===item.full_name;}));});return checkedPartners;},_preprocessMessage:function(){var self=this;var def=$.Deferred();this._super().then(function(message){message=_.extend(message,{subtype:'mail.mt_comment',message_type:'comment',context:_.defaults({},self.context,session.user_context),});if(self.options.isLog){message.subtype='mail.mt_note';}
if(!self.options.isLog){var checkedSuggestedPartners=self._getCheckedSuggestedPartners();self._checkSuggestedPartners(checkedSuggestedPartners).done(function(partnerIDs){message.partner_ids=(message.partner_ids||[]).concat(partnerIDs);message.context=_.defaults({},message.context,{mail_post_autofollow:true,});def.resolve(message);});}else{def.resolve(message);}});return def;},_shouldSend:function(){return false;},_onOpenFullComposer:function(){if(!this._doCheckAttachmentUpload()){return false;}
var self=this;var recipientDoneDef=$.Deferred();this.trigger_up('discard_record_changes',{proceed:function(){if(self.options.isLog){recipientDoneDef.resolve([]);}else{var checkedSuggestedPartners=self._getCheckedSuggestedPartners();self._checkSuggestedPartners(checkedSuggestedPartners).then(recipientDoneDef.resolve.bind(recipientDoneDef));}},});recipientDoneDef.then(function(partnerIDs){var context={default_parent_id:self.id,default_body:mailUtils.getTextToHTML(self.$input.val()),default_attachment_ids:_.pluck(self.get('attachment_ids'),'id'),default_partner_ids:partnerIDs,default_is_log:self.options.isLog,mail_post_autofollow:true,};if(self.context.default_model&&self.context.default_res_id){context.default_model=self.context.default_model;context.default_res_id=self.context.default_res_id;}
var action={type:'ir.actions.act_window',res_model:'mail.compose.message',view_mode:'form',view_type:'form',views:[[false,'form']],target:'new',context:context,};self.do_action(action,{on_close:self.trigger.bind(self,'need_refresh'),}).then(self.trigger.bind(self,'close_composer'));});}});return ChatterComposer;});;

/* /mail/static/src/js/composers/extended_composer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.composer.Extended',function(require){"use strict";var BasicComposer=require('mail.composer.Basic');var ExtendedComposer=BasicComposer.extend({init:function(parent,options){options=_.defaults(options||{},{inputMinHeight:120,});this._super(parent,options);this.extended=true;},start:function(){this._$subjectInput=this.$('.o_composer_subject input');return this._super.apply(this,arguments);},clearComposer:function(){this._super.apply(this,arguments);this._$subjectInput.val('');},focus:function(target){if(target==='body'){this.$input.focus();}else{this._$subjectInput.focus();}},getState:function(){var state=this._super.apply(this,arguments);state.subject=this._$subjectInput.val();return state;},setState:function(state){this._super.apply(this,arguments);this.setSubject(state.subject);},setSubject:function(subject){this.$('.o_composer_subject input').val(subject);},_preprocessMessage:function(){var self=this;return this._super().then(function(message){var subject=self._$subjectInput.val();self._$subjectInput.val("");message.subject=subject;return message;});},_shouldSend:function(){return false;},});return ExtendedComposer;});;

/* /mail/static/src/js/composers/mention_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.composer.MentionManager',function(require){"use strict";var core=require('web.core');var dom=require('web.dom');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var NON_BREAKING_SPACE='\u00a0';var MentionManager=Widget.extend({className:'dropup o_composer_mention_dropdown',events:{'click .o_mention_proposition':'_onClickMentionItem','mouseover .o_mention_proposition':'_onHoverMentionProposition',},init:function(parent){this._super.apply(this,arguments);this._composer=parent;this._open=false;this._listeners=[];this.set('mention_suggestions',[]);this.on('change:mention_suggestions',this,this._renderSuggestions);},isOpen:function(){return this._open;},getListenerSelection:function(delimiter){var listener=_.findWhere(this._listeners,{delimiter:delimiter});if(listener){var escapedVal=_.escape(this._composer.$input.val().replace(/\n/g,"\n "));var inputMentions=escapedVal.match(new RegExp(delimiter+'[^ ]+(?= |&nbsp;|$)','g'));return this._validateSelection(listener.selection,inputMentions);}
return[];},getListenerSelections:function(){var selections={};_.each(this._listeners,function(listener){selections[listener.delimiter]=listener.selection;});return selections;},detectDelimiter:function(){var self=this;var textVal=this._composer.$input.val();var cursorPosition=this._getSelectionPositions().start;var leftString=textVal.substring(0,cursorPosition);function validateKeyword(delimiter,beginningOnly){var beforeDelimiterPosition=leftString.lastIndexOf(delimiter)-1;if(beginningOnly&&beforeDelimiterPosition>0){return false;}
var searchStr=textVal.substring(beforeDelimiterPosition,cursorPosition);var pattern="^"+delimiter+"|^\\s"+delimiter;var regexStart=new RegExp(pattern,'g');searchStr=searchStr.replace(/^\s\s*|^[\n\r]/g,'');if(regexStart.test(searchStr)&&searchStr.length){searchStr=searchStr.replace(pattern,'');return searchStr.indexOf(' ')<0&&!/[\r\n]/.test(searchStr)?searchStr.replace(delimiter,''):false;}
return false;}
this._activeListener=undefined;for(var i=0;i<this._listeners.length;i++){var listener=this._listeners[i];this._mentionWord=validateKeyword(listener.delimiter,listener.beginningOnly);if(this._mentionWord!==false){this._activeListener=listener;break;}}
if(this._activeListener){var mentionWord=this._mentionWord;$.when(this._activeListener.fetchCallback(mentionWord)).then(function(suggestions){if(mentionWord===self._mentionWord){self.set('mention_suggestions',suggestions);}});}else{this.set('mention_suggestions',[]);}},generateLinks:function(s){var self=this;var baseHREF=session.url('/web');var linkParams="href='%s' class='%s' data-oe-id='%s' data-oe-model='%s' target='_blank'";var mentionLink="<a "+linkParams+" >"+"%s%s"+"</a>";_.each(this._listeners,function(listener){if(!listener.generateLinks){return;}
var selection=listener.selection;if(selection.length){var matches=self._getMatch(s,listener);var substrings=[];var startIndex=0;for(var i=0;i<matches.length;i++){var match=matches[i];var endIndex=match.index+match[0].length;var selectionID=self._getSelectionID(match,selection);var matchName=match[0].substring(1).replace(new RegExp(NON_BREAKING_SPACE,'g'),' ');var href=baseHREF+
_.str.sprintf("#model=%s&id=%s",listener.model,selectionID);var processedText=_.str.sprintf(mentionLink,href,listener.redirectClassname,selectionID,listener.model,listener.delimiter,matchName);substrings.push(s.substring(startIndex,match.index));substrings.push(processedText);startIndex=endIndex;}
substrings.push(s.substring(startIndex,s.length));s=substrings.join('');}});return s;},propositionNavigation:function(keycode){var $active=this.$('.o_mention_proposition.active');if(keycode===$.ui.keyCode.ENTER){$active.click();}else{var $to;if(keycode===$.ui.keyCode.DOWN){$to=$active.nextAll('.o_mention_proposition').first();}else if(keycode===$.ui.keyCode.UP){$to=$active.prevAll('.o_mention_proposition').first();}else if(keycode===$.ui.keyCode.TAB){$to=$active.nextAll('.o_mention_proposition').first();if(!$to.length){$to=$active.prevAll('.o_mention_proposition').last();}}
if($to&&$to.length){$active.removeClass('active');$to.addClass('active');}}},register:function(listener){this._listeners.push(_.defaults(listener,{model:'',redirectClassname:'',selection:[],}));},resetSuggestions:function(){this.set('mention_suggestions',[]);},resetSelections:function(){_.each(this._listeners,function(listener){listener.selection=[];});},_getMatch:function(inputText,listener){var names=_.pluck(listener.selection,'name');var escapedNames=_.map(names,function(str){return"("+_.str.escapeRegExp(listener.delimiter+str)+")(?= |&nbsp;|$)";});var regexStr=escapedNames.join('|');var result=[];if(regexStr.length){var myRegexp=new RegExp(regexStr,'g');var match=myRegexp.exec(inputText);while(match!==null){result.push(match);match=myRegexp.exec(inputText);}}
return result;},_getSelectionID:function(match,selection){return _.findWhere(selection,{name:match[0].slice(1)}).id;},_getSelectionPositions:function(){var InputElement=this._composer.$input.get(0);return InputElement?dom.getSelectionRange(InputElement):{start:0,end:0};},_renderSuggestions:function(){var suggestions=[];if(_.find(this.get('mention_suggestions'),_.isArray)){var insertDivider=false;_.each(this.get('mention_suggestions'),function(suggestionGroup){if(suggestionGroup.length>0){if(insertDivider){suggestions.push({divider:true});}
suggestions=suggestions.concat(suggestionGroup);insertDivider=true;}});}else{suggestions=this.get('mention_suggestions');}
if(suggestions.length){this.$el.html(QWeb.render(this._activeListener.suggestionTemplate,{suggestions:_.map(suggestions,function(suggestion){return _.extend({},suggestion,{name:_.unescape(suggestion.name)});})}));this.$el.addClass('show').find('.dropdown-menu').addClass('show').css('max-width',this._composer.$input.width()).find('.o_mention_proposition').first().addClass('active');this._open=true;}else{this.$el.removeClass('show').find('.dropdown-menu').removeClass('show');this.$el.empty();this._open=false;}},_setCursorPosition:function(pos){this._composer.$input.each(function(index,elem){dom.setSelectionRange(elem,{start:pos,end:pos});});},_validateSelection:function(selection,inputMentions){var validatedSelection=[];_.each(inputMentions,function(mention){var validatedMention=_.findWhere(selection,{name:mention.slice(1)});if(validatedMention){validatedSelection.push(validatedMention);}});return validatedSelection;},_onClickMentionItem:function(ev){ev.preventDefault();var textInput=this._composer.$input.val();var id=$(ev.currentTarget).data('id');var suggestions=_.flatten(this.get('mention_suggestions'));var selectedSuggestion=_.clone(_.find(suggestions,function(s){return s.id===id;}));var substitution=selectedSuggestion.substitution;if(!substitution){selectedSuggestion.name=_.unescape(selectedSuggestion.name.replace(/ /g,NON_BREAKING_SPACE));substitution=this._activeListener.delimiter+selectedSuggestion.name;}
var getMentionIndex=function(matches,cursorPosition){for(var i=0;i<matches.length;i++){if(cursorPosition<=matches[i].index){return i;}}
return i;};if(this._activeListener.selection.length){var matches=this._getMatch(textInput,this._activeListener);var index=getMentionIndex(matches,this._getSelectionPositions().start);this._activeListener.selection.splice(index,0,selectedSuggestion);}else{this._activeListener.selection.push(selectedSuggestion);}
var cursorPosition=this._getSelectionPositions().start;var textLeft=textInput.substring(0,cursorPosition-(this._mentionWord.length+1));var textRight=textInput.substring(cursorPosition,textInput.length);var textInputNew=textLeft+substitution+' '+textRight;this._composer.$input.val(textInputNew);this._setCursorPosition(textLeft.length+substitution.length+2);this.set('mention_suggestions',[]);this._composer.focus('body');if(selectedSuggestion.name){selectedSuggestion.name=_.escape(selectedSuggestion.name);}},_onHoverMentionProposition:function(ev){var $elem=$(ev.currentTarget);this.$('.o_mention_proposition').removeClass('active');$elem.addClass('active');},});return MentionManager;});;

/* /mail/static/src/js/chatter.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Chatter',function(require){"use strict";var Activity=require('mail.Activity');var AttachmentBox=require('mail.AttachmentBox');var ChatterComposer=require('mail.composer.Chatter');var Dialog=require('web.Dialog');var Followers=require('mail.Followers');var ThreadField=require('mail.ThreadField');var mailUtils=require('mail.utils');var concurrency=require('web.concurrency');var config=require('web.config');var core=require('web.core');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var Chatter=Widget.extend({template:'mail.Chatter',custom_events:{delete_attachment:'_onDeleteAttachment',discard_record_changes:'_onDiscardRecordChanges',reload_attachment_box:'_onReloadAttachmentBox',reload_mail_fields:'_onReloadMailFields',},events:{'click .o_chatter_button_new_message':'_onOpenComposerMessage','click .o_chatter_button_log_note':'_onOpenComposerNote','click .o_chatter_button_attachment':'_onClickAttachmentButton','click .o_chatter_button_schedule_activity':'_onScheduleActivity',},supportedFieldTypes:['one2many'],init:function(parent,record,mailFields,options){this._super.apply(this,arguments);this._setState(record);this.attachments={};this.fields={};this._areAttachmentsLoaded=false;this._disableAttachmentBox=!!options.disable_attachment_box;this._dp=new concurrency.DropPrevious();this._isAttachmentBoxOpen=false;this._mentionPartnerSuggestions=this.call('mail_service','getMentionPartnerSuggestions');this._mentionSuggestions=this._mentionPartnerSuggestions;if(mailFields.mail_activity){this.fields.activity=new Activity(this,mailFields.mail_activity,record,options);}
if(mailFields.mail_followers){this.fields.followers=new Followers(this,mailFields.mail_followers,record,options);}
if(mailFields.mail_thread){this.fields.thread=new ThreadField(this,mailFields.mail_thread,record,options);var fieldsInfo=record.fieldsInfo[options.viewType||record.viewType];var nodeOptions=fieldsInfo[mailFields.mail_thread].options||{};this.hasLogButton=options.display_log_button||nodeOptions.display_log_button;this.postRefresh=nodeOptions.post_refresh||'never';this.reloadOnUploadAttachment=this.postRefresh==='always';}},start:function(){this._$topbar=this.$('.o_chatter_topbar');if(!this._disableAttachmentBox){this.$('.o_topbar_right_area').append(QWeb.render('mail.chatter.Attachment.Button',{displayCounter:!!this.fields.thread,count:this.record.data.message_attachment_count||0,}));}
this._$topbar.prepend(this._renderButtons());var fieldDefs=_.invoke(this.fields,'appendTo',$('<div>'));var def=this._dp.add($.when.apply($,fieldDefs));this._render(def).then(this._updateMentionSuggestions.bind(this));return this._super.apply(this,arguments);},update:function(record,fieldNames){var self=this;if(this.record.res_id!==record.res_id){this._closeComposer(true);this._closeAttachments();this._areAttachmentsLoaded=false;this.attachments={};}
this._setState(record);this.$el.height(this.$el.height());if(this.fields.activity){this.fields.activity.$el.detach();}
if(this.fields.thread&&this.fields.thread.$el){this.fields.thread.$el.detach();}
var fieldsToReset;if(fieldNames){fieldsToReset=_.filter(this.fields,function(field){return _.contains(fieldNames,field.name);});}else{fieldsToReset=this.fields;}
var fieldDefs=_.invoke(fieldsToReset,'reset',record);var def=this._dp.add($.when.apply($,fieldDefs));this._render(def).then(function(){self.$el.height('auto');self._updateMentionSuggestions();});this._updateAttachmentCounter();},_closeAttachments:function(){if(this.fields.attachments){this.$('.o_chatter_button_attachment').removeClass('o_active_attach');this.fields.attachments.destroy();this._isAttachmentBoxOpen=false;}},_closeComposer:function(force){if(this._composer&&(this._composer.isEmpty()||force)){this.$el.removeClass('o_chatter_composer_active');this.$('.o_chatter_button_new_message, .o_chatter_button_log_note').removeClass('o_active');this._composer.do_hide();this._composer.clearComposer();}},_disableChatter:function(){this.$('.btn').prop('disabled',true);},_disableComposer:function(){this.$(".o_composer_button_send").prop('disabled',true);},_discardChanges:function(){var def=$.Deferred();this.trigger_up('discard_changes',{recordID:this.record.id,onSuccess:def.resolve.bind(def),onFailure:def.reject.bind(def),});return def;},_discardOnReload:function(messageData){if(this._reloadAfterPost(messageData)){return this._discardChanges();}
return $.when();},_enableChatter:function(){this.$('.btn').prop('disabled',false);},_enableComposer:function(){this.$(".o_composer_button_send").prop('disabled',false);},_fetchAttachments:function(){var self=this;var domain=[['res_id','=',this.record.res_id],['res_model','=',this.record.model],];return this._rpc({model:'ir.attachment',method:'search_read',domain:domain,fields:['id','name','datas_fname','mimetype'],}).then(function(result){self._areAttachmentsLoaded=true;self.attachments=result;});},_openAttachmentBox:function(){if(this.fields.attachments){this._closeAttachments();}
this.fields.attachments=new AttachmentBox(this,this.record,this.attachments);var $anchor=this.$('.o_chatter_topbar');if(this._composer){var $anchor=this.$('.o_thread_composer');}else{var $anchor=this.$('.o_chatter_topbar');}
this.fields.attachments.insertAfter($anchor);this.$el.addClass('o_chatter_composer_active');this.$('.o_chatter_button_attachment').addClass('o_active_attach');this._isAttachmentBoxOpen=true;},_openComposer:function(options){var self=this;var oldComposer=this._composer;this._composer=new ChatterComposer(this,this.record.model,options.suggested_partners||[],{commandsEnabled:false,context:this.context,inputMinHeight:50,isLog:options&&options.isLog,recordName:this.recordName,defaultBody:oldComposer&&oldComposer.$input&&oldComposer.$input.val(),defaultMentionSelections:oldComposer&&oldComposer.getMentionListenerSelections(),attachmentIds:(oldComposer&&oldComposer.get('attachment_ids'))||[],});this._composer.on('input_focused',this,function(){this._composer.mentionSetPrefetchedPartners(this._mentionSuggestions||[]);});this._composer.insertAfter(this.$('.o_chatter_topbar')).then(function(){if(oldComposer){oldComposer.destroy();}
self._composer.focus();self._composer.on('post_message',self,function(messageData){self._discardOnReload(messageData).then(function(){self._disableComposer();self.fields.thread.postMessage(messageData).then(function(){self._closeComposer(true);if(self._reloadAfterPost(messageData)){self.trigger_up('reload',{keepChanges:true});}else if(messageData.attachment_ids.length){self._reloadAttachmentBox();self.trigger_up('reload',{fieldNames:['message_attachment_count'],keepChanges:true});}}).fail(function(){self._enableComposer();});});});self._composer.on('need_refresh',self,self.trigger_up.bind(self,'reload',{keepChanges:true}));self._composer.on('close_composer',null,self._closeComposer.bind(self,true));self.$el.addClass('o_chatter_composer_active');self.$('.o_chatter_button_new_message, .o_chatter_button_log_note').removeClass('o_active');self.$('.o_chatter_button_new_message').toggleClass('o_active',!self._composer.options.isLog);self.$('.o_chatter_button_log_note').toggleClass('o_active',self._composer.options.isLog);});},_reloadAfterPost:function(messageData){return this.postRefresh==='always'||(this.postRefresh==='recipients'&&messageData.partner_ids&&messageData.partner_ids.length);},_reloadAttachmentBox:function(){this._areAttachmentsLoaded=false;if(this._isAttachmentBoxOpen){this._fetchAttachments().then(this._openAttachmentBox.bind(this));}
if(this.fields.thread){this.trigger_up('reload',{fieldNames:['message_attachment_count'],keepChanges:true});}},_render:function(def){var self=this;var $spinner=$(QWeb.render('Spinner'));concurrency.rejectAfter(concurrency.delay(500),def).then(function(){$spinner.appendTo(self.$el);});return def.then(function(){if(self.fields.activity){self.fields.activity.$el.appendTo(self.$el);}
if(self.fields.followers){if(self._disableAttachmentBox){self.fields.followers.$el.appendTo(self.$('.o_topbar_right_area'));}else{self.fields.followers.$el.insertBefore(self.$('.o_chatter_button_attachment'));}}
if(self.fields.thread&&self.fields.thread.$el){self.fields.thread.$el.appendTo(self.$el);}}).always(function(){self._isCreateMode?self._disableChatter():self._enableChatter();$spinner.remove();});},_renderButtons:function(){return QWeb.render('mail.chatter.Buttons',{newMessageButton:!!this.fields.thread,logNoteButton:this.hasLogButton,scheduleActivityButton:!!this.fields.activity,isMobile:config.device.isMobile,});},_setState:function(record){this._isCreateMode=!record.res_id;if(!this.record||this.record.res_id!==record.res_id){this.context={default_res_id:record.res_id||false,default_model:record.model||false,};this.suggested_partners_def=undefined;}
this.record=record;this.recordName=record.data.display_name;},_updateAttachmentCounter:function(){var count=this.record.data.message_attachment_count||0;var $element=this.$('.o_chatter_attachment_button_count');if(Number($element.html())!==count){this._areAttachmentsLoaded=false;$element.html(count);}},_updateMentionSuggestions:function(){if(!this.fields.followers){return;}
var self=this;this._mentionSuggestions=[];var followerSuggestions=[];var followers=this.fields.followers.getFollowers();_.each(followers,function(follower){if(follower.res_model==='res.partner'){followerSuggestions.push({id:follower.res_id,name:follower.name,email:follower.email,});}});if(followerSuggestions.length){this._mentionSuggestions.push(followerSuggestions);}
_.each(this._mentionPartnerSuggestions,function(partners){self._mentionSuggestions.push(_.filter(partners,function(partner){return!_.findWhere(followerSuggestions,{id:partner.id});}));});},_onDeleteAttachment:function(ev){ev.stopPropagation();var self=this;var options={confirm_callback:function(){self._rpc({model:'ir.attachment',method:'unlink',args:[parseInt(ev.data.attachmentId,10)],}).then(function(){self._reloadAttachmentBox();if(self.fields.thread){self.fields.thread.removeAttachments([ev.data.attachmentId]);}
self.trigger_up('reload',{keepChanges:true});});}};var promptText=_.str.sprintf(_t("Do you really want to delete %s?"),_.escape(ev.data.attachmentName));Dialog.confirm(this,promptText,options);},_onClickAttachmentButton:function(){if(this._disableAttachmentBox){return;}
if(this._isAttachmentBoxOpen){this._closeAttachments();}else{var def;if(!this._areAttachmentsLoaded){def=this._fetchAttachments();}
$.when(def).then(this._openAttachmentBox.bind(this));}},_onDiscardRecordChanges:function(ev){this._discardChanges().then(ev.data.proceed);},_onOpenComposerMessage:function(){var self=this;if(!this.suggested_partners_def){this.suggested_partners_def=$.Deferred();var method='message_get_suggested_recipients';var args=[[this.context.default_res_id],this.context];this._rpc({model:this.record.model,method:method,args:args}).then(function(result){if(!self.suggested_partners_def){return;}
var suggested_partners=[];var thread_recipients=result[self.context.default_res_id];_.each(thread_recipients,function(recipient){var parsed_email=recipient[1]&&mailUtils.parseEmail(recipient[1]);suggested_partners.push({checked:true,partner_id:recipient[0],full_name:recipient[1],name:parsed_email[0],email_address:parsed_email[1],reason:recipient[2],});});self.suggested_partners_def.resolve(suggested_partners);});}
this.suggested_partners_def.then(function(suggested_partners){self._openComposer({isLog:false,suggested_partners:suggested_partners});});},_onOpenComposerNote:function(){this._openComposer({isLog:true});},_onReloadAttachmentBox:function(){if(this.reloadOnUploadAttachment){this.trigger_up('reload',{keepChanges:true});}
this._reloadAttachmentBox();},_onReloadMailFields:function(event){var fieldNames=[];if(this.fields.activity&&event.data.activity){fieldNames.push(this.fields.activity.name);}
if(this.fields.followers&&event.data.followers){fieldNames.push(this.fields.followers.name);}
if(this.fields.thread&&event.data.thread){fieldNames.push(this.fields.thread.name);}
this.trigger_up('reload',{fieldNames:fieldNames,keepChanges:true,});},_onScheduleActivity:function(){this.fields.activity.scheduleActivity();},});return Chatter;});;

/* /mail/static/src/js/followers.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Followers',function(require){"use strict";var AbstractField=require('web.AbstractField');var concurrency=require('web.concurrency');var core=require('web.core');var Dialog=require('web.Dialog');var field_registry=require('web.field_registry');var _t=core._t;var QWeb=core.qweb;var Followers=AbstractField.extend({template:'mail.Followers',events:{'click .o_followers_follow_button':'_onFollowButtonClicked','click .o_subtypes_list .custom-checkbox':'_onSubtypeClicked','click .o_add_follower':'_onAddFollower','click .o_add_follower_channel':'_onAddChannel','click .o_edit_subtype':'_onEditSubtype','click .o_remove_follower':'_onRemoveFollower','click .o_mail_redirect':'_onRedirect',},init:function(parent,name,record,options){this._super.apply(this,arguments);this.image=this.attrs.image||'image_small';this.comment=this.attrs.help||false;this.followers=[];this.subtypes=[];this.data_subtype={};this._isFollower=undefined;var session=this.getSession();this.partnerID=session.partner_id;this.dp=new concurrency.DropPrevious();options=options||{};this.isEditable=options.isEditable;},_render:function(){var self=this;var fetch_def=this.dp.add(this._readFollowers());concurrency.rejectAfter(concurrency.delay(0),fetch_def).then(this._displayGeneric.bind(this));fetch_def.then(function(){self._displayButtons();self._displayFollowers(self.followers);if(self.subtypes){self._displaySubtypes(self.subtypes);}});},isSet:function(){return true;},_reset:function(record){this._super.apply(this,arguments);this.res_id=record.res_id;},getFollowers:function(){return this.followers;},_displayButtons:function(){if(this._isFollower){this.$('button.o_followers_follow_button').removeClass('o_followers_notfollow').addClass('o_followers_following');this.$('.o_subtypes_list > .dropdown-toggle').attr('disabled',false);this.$('.o_followers_actions .dropdown-toggle').addClass('o_followers_following');}else{this.$('button.o_followers_follow_button').removeClass('o_followers_following').addClass('o_followers_notfollow');this.$('.o_subtypes_list > .dropdown-toggle').attr('disabled',true);this.$('.o_followers_actions .dropdown-toggle').removeClass('o_followers_following');}
this.$('button.o_followers_follow_button').attr("aria-pressed",this.is_follower);},_displayGeneric:function(){this.$('.o_followers_actions').hide();this.$('.o_followers_title_box > button').prop('disabled',true);this.$('.o_followers_count').html(this.value.res_ids.length).parent().attr('title',this._formatFollowers(this.value.res_ids.length));},_displayFollowers:function(){var self=this;var $followers_list=this.$('.o_followers_list').empty();$(QWeb.render('mail.Followers.add_more',{widget:this})).appendTo($followers_list);var $follower_li;_.each(this.followers,function(record){$follower_li=$(QWeb.render('mail.Followers.partner',{'record':_.extend(record,{'avatar_url':'/web/image/'+record.res_model+'/'+record.res_id+'/image_small'}),'widget':self}));$follower_li.appendTo($followers_list);if(record.is_editable){$follower_li.on('mouseenter mouseleave',function(e){$(e.currentTarget).find('.o_edit_subtype').toggleClass('d-none',e.type==='mouseleave');});}});this.$('.o_followers_actions').show();this.$('.o_followers_title_box > button').prop('disabled',!$followers_list.children().length);this.$('.o_followers_count').html(this.value.res_ids.length).parent().attr('title',this._formatFollowers(this.value.res_ids.length));},_displaySubtypes:function(data,dialog,display_warning){var old_parent_model;var $list;if(dialog){$list=$('<div>').appendTo(this.dialog.$el);}else{$list=this.$('.o_subtypes_list .dropdown-menu');}
$list.empty();this.data_subtype=data;_.each(data,function(record){if(old_parent_model!==record.parent_model&&old_parent_model!==undefined){$list.append($('<div>',{class:'dropdown-divider'}));}
old_parent_model=record.parent_model;record.followed=record.followed||undefined;$list.append(QWeb.render('mail.Followers.subtype',{'record':record,'dialog':dialog,'display_warning':display_warning&&record.internal,}));});if(display_warning){$(QWeb.render('mail.Followers.subtypes.warning')).appendTo(this.dialog.$el);}},_inviteFollower:function(channel_only){var action={type:'ir.actions.act_window',res_model:'mail.wizard.invite',view_mode:'form',view_type:'form',views:[[false,'form']],name:_t("Invite Follower"),target:'new',context:{'default_res_model':this.model,'default_res_id':this.res_id,'mail_invite_follower_channel_only':channel_only,},};this.do_action(action,{on_close:this._reload.bind(this),});},_formatFollowers:function(count){var str='';if(count<=0){str=_t("No follower");}else if(count===1){str=_t("One follower");}else{str=''+count+' '+_t("followers");}
return str;},_readFollowers:function(){var self=this;var missing_ids=_.difference(this.value.res_ids,_.pluck(this.followers,'id'));var def;if(missing_ids.length){def=this._rpc({route:'/mail/read_followers',params:{follower_ids:missing_ids,res_model:this.model}});}
return $.when(def).then(function(results){if(results){self.followers=_.uniq(results.followers.concat(self.followers),'id');if(results.subtypes){self.subtypes=results.subtypes;}}
self.followers=_.filter(self.followers,function(follower){return _.contains(self.value.res_ids,follower.id);});var user_follower=_.filter(self.followers,function(rec){return rec.is_uid;});self._isFollower=user_follower.length>=1;});},_reload:function(){this.trigger_up('reload',{fieldNames:[this.name],keepChanges:true});},_follow:function(){var kwargs={partner_ids:[this.partnerID],context:{},};this._rpc({model:this.model,method:'message_subscribe',args:[[this.res_id]],kwargs:kwargs,}).then(this._reload.bind(this));},_unfollow:function(ids){var self=this;var def=$.Deferred();var text=_t("Warning! \n If you remove a follower, he won't be notified of any email or discussion on this document.\n Do you really want to remove this follower ?");Dialog.confirm(this,text,{confirm_callback:function(){var args=[[self.res_id],ids.partner_ids,ids.channel_ids,{},];self._rpc({model:self.model,method:'message_unsubscribe',args:args}).then(self._reload.bind(self));def.resolve();},cancel_callback:def.reject.bind(def),});return def;},_updateSubscription:function(event,followerID,isChannel){var ids={};var subtypes;if(followerID!==undefined){subtypes=this.dialog.$('input[type="checkbox"]');if(isChannel){ids.channel_ids=[followerID];}else{ids.partner_ids=[followerID];}}else{subtypes=this.$('.o_followers_actions input[type="checkbox"]');ids.partner_ids=[this.partnerID];}
var checklist=[];_.each(subtypes,function(record){if($(record).is(':checked')){checklist.push(parseInt($(record).data('id')));}});if(!checklist.length){this._unfollow(ids).fail(function(){$(event.currentTarget).find('input').addBack('input').prop('checked',true);});}else{var kwargs=_.extend({},ids);if(followerID===undefined||followerID===this.partnerID){_.each(this.subtypes,function(subtype){subtype.followed=checklist.indexOf(subtype.id)>-1;});}
kwargs.subtype_ids=checklist;kwargs.context={};this._rpc({model:this.model,method:'message_subscribe',args:[[this.res_id]],kwargs:kwargs,}).then(this._reload.bind(this));}},_onAddFollower:function(ev){ev.preventDefault();this._inviteFollower(false);},_onAddChannel:function(ev){ev.preventDefault();this._inviteFollower(true);},_onEditSubtype:function(ev){var self=this;var $currentTarget=$(ev.currentTarget);var follower_id=$currentTarget.data('follower-id');this._rpc({route:'/mail/read_subscription_data',params:{res_model:this.model,follower_id:follower_id},}).then(function(data){var res_id=$currentTarget.data('oe-id');var is_channel=$currentTarget.data('oe-model')==='mail.channel';self.dialog=new Dialog(this,{size:'medium',title:_t("Edit Subscription of ")+$currentTarget.siblings('a').text(),buttons:[{text:_t("Apply"),classes:'btn-primary',click:function(){self._updateSubscription(ev,res_id,is_channel);},close:true},{text:_t("Cancel"),close:true,},],});self.dialog.opened().then(function(){self._displaySubtypes(data,true,is_channel);});self.dialog.open();});},_onFollowButtonClicked:function(){if(!this._isFollower){this._follow();}else{this._unfollow({partner_ids:[this.partnerID]});}},_onRedirect:function(ev){ev.preventDefault();var $target=$(ev.target);this.do_action({type:'ir.actions.act_window',view_type:'form',view_mode:'form',res_model:$target.data('oe-model'),views:[[false,'form']],res_id:$target.data('oe-id'),});},_onRemoveFollower:function(ev){var resModel=$(ev.target).parent().find('a').data('oe-model');var resID=$(ev.target).parent().find('a').data('oe-id');if(resModel==='res.partner'){return this._unfollow({partner_ids:[resID]});}else{return this._unfollow({channel_ids:[resID]});}},_onSubtypeClicked:function(ev){ev.stopPropagation();this._updateSubscription(ev);var $list=this.$('.o_subtypes_list');if(!$list.hasClass('show')){$list.addClass('show');}
if(this.$('.o_subtypes_list .dropdown-menu')[0].children.length<1){$list.removeClass('show');}},});field_registry.add('mail_followers',Followers);return Followers;});;

/* /mail/static/src/js/form_controller.js defined in bundle 'web.assets_backend' */
odoo.define('mail.form_controller',function(require){"use strict";var FormController=require('web.FormController');FormController.include({custom_events:_.extend({},FormController.prototype.custom_events,{new_message:'_onNewMessage',}),_onNewMessage:function(ev){this.model.updateMessageIDs(ev.data.id,ev.data.messageIDs);},});});;

/* /mail/static/src/js/form_view.js defined in bundle 'web.assets_backend' */
odoo.define('mail.FormView',function(require){"use strict";var FormView=require('web.FormView');FormView.include({init:function(){this._super.apply(this,arguments);var fieldsInfo=this.fieldsInfo[this.viewType];if('message_ids'in fieldsInfo&&!('message_attachment_count'in fieldsInfo)){fieldsInfo.message_attachment_count={};}},});});;

/* /mail/static/src/js/form_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.form_renderer',function(require){"use strict";var Chatter=require('mail.Chatter');var FormRenderer=require('web.FormRenderer');FormRenderer.include({init:function(parent,state,params){this._super.apply(this,arguments);this.mailFields=params.mailFields;this.chatter=undefined;},confirmChange:function(state,id,fields){if(this.chatter){var chatterFields=['message_attachment_count'].concat(_.values(this.mailFields));var updatedMailFields=_.intersection(fields,chatterFields);if(updatedMailFields.length){this.chatter.update(state,updatedMailFields);}}
return this._super.apply(this,arguments);},_renderNode:function(node){if(node.tag==='div'&&node.attrs.class==='oe_chatter'){if(!this.chatter){this.chatter=new Chatter(this,this.state,this.mailFields,{isEditable:this.activeActions.edit,viewType:'form',});this.chatter.appendTo($('<div>'));this._handleAttributes(this.chatter.$el,node);}else{this.chatter.update(this.state);}
return this.chatter.$el;}else{return this._super.apply(this,arguments);}},});});;

/* /mail/static/src/js/basic_model.js defined in bundle 'web.assets_backend' */
odoo.define('mail.basic_model',function(require){"use strict";var BasicModel=require('web.BasicModel');BasicModel.include({updateMessageIDs:function(id,msgIDs){var element=this.localData[id];element.res_ids=msgIDs;element.count=msgIDs.length;},});});;

/* /mail/static/src/js/basic_view.js defined in bundle 'web.assets_backend' */
odoo.define('mail.BasicView',function(require){"use strict";var BasicView=require('web.BasicView');var mailWidgets=['mail_followers','mail_thread','mail_activity','kanban_activity'];BasicView.include({init:function(){this._super.apply(this,arguments);this.mailFields={};var fieldsInfo=this.fieldsInfo[this.viewType];for(var fieldName in fieldsInfo){var fieldInfo=fieldsInfo[fieldName];if(_.contains(mailWidgets,fieldInfo.widget)){this.mailFields[fieldInfo.widget]=fieldName;fieldInfo.__no_fetch=true;}}
this.rendererParams.activeActions=this.controllerParams.activeActions;this.rendererParams.mailFields=this.mailFields;},});});;

/* /mail/static/src/js/thread_field.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ThreadField',function(require){"use strict";var CreateModeDocumentThread=require('mail.model.CreateModeDocumentThread');var ThreadWidget=require('mail.widget.Thread');var AbstractField=require('web.AbstractField');var core=require('web.core');var field_registry=require('web.field_registry');var concurrency=require('web.concurrency');var _t=core._t;var ThreadField=AbstractField.extend({init:function(){this._super.apply(this,arguments);this._isMessagingReady=this.call('mail_service','isReady');this._markAsReadOnNextRender=false;this._setDocumentThread();},start:function(){var self=this;this.dp=new concurrency.DropPrevious();this._threadWidget=new ThreadWidget(this,{displayOrder:ThreadWidget.ORDER.DESC,displayDocumentLinks:false,displayMarkAsRead:false,squashCloseMessages:false,});this._threadWidget.on('load_more_messages',this,this._onLoadMoreMessages);this._threadWidget.on('redirect',this,this._onRedirect);this._threadWidget.on('redirect_to_channel',this,this._onRedirectToChannel);this._threadWidget.on('toggle_star_status',this,function(messageID){var message=self.call('mail_service','getMessage',messageID);message.toggleStarStatus();});var def1=this._threadWidget.appendTo(this.$el);var def2=this._super.apply(this,arguments);return this.alive($.when(def1,def2)).then(function(){self.setElement(self._threadWidget.$el);var mailBus=self.call('mail_service','getMailBus');mailBus.on('new_message',self,self._onNewMessage);mailBus.on('update_message',self,self._onUpdateMessage);});},removeAttachments:function(attachmentIDs){this._documentThread.removeAttachmentsFromMessages(attachmentIDs);},isSet:function(){return true;},postMessage:function(message){var self=this;return this._documentThread.postMessage(message).then(function(){if(message.partner_ids.length){self.trigger_up('reload_mail_fields',{followers:true});}}).fail(function(){self.do_notify(_t("Sending Error"),_t("Your message has not been sent."));});},_fetchAndRenderThread:function(options){var self=this;if(!this._isMessagingReady){return Promise.resolve();}else if(!this._documentThread){var thread=new CreateModeDocumentThread();options={isCreateMode:true};self._threadWidget.render(thread,options);return $.when();}else{var fetchDef=this.dp.add(this._documentThread.fetchMessages(options));return fetchDef.then(function(){self._threadWidget.render(self._documentThread,{displayLoadMore:self._documentThread.getMessages().length<self._documentThread.getMessageIDs().length,});if(self._markAsReadOnNextRender){self._markAsReadOnNextRender=false;return self._documentThread.markAsRead();}});}},_render:function(){return this._fetchAndRenderThread();},_reset:function(record){this._super.apply(this,arguments);this.res_id=record.res_id;this._setDocumentThread();},_setDocumentThread:function(){if(!this._isMessagingReady){return;}
var params={messageIDs:this.value.res_ids,name:this.recordData.display_name,resID:this.res_id,resModel:this.model,};if(!params.resID){this._documentThread=null;}else{this._documentThread=this.call('mail_service','getOrAddDocumentThread',params);this._markAsReadOnNextRender=true;}},_onLoadMoreMessages:function(){this._fetchAndRenderThread({forceFetch:true});},_onNewMessage:function(message){if(message.isLinkedToDocumentThread()&&message.getDocumentModel()===this.model&&message.getDocumentID()===this.res_id){this.trigger_up('new_message',{id:this.value.id,messageIDs:this._documentThread.getMessageIDs(),});this._fetchAndRenderThread();}},_onRedirectToChannel:function(channelID){var self=this;this.call('mail_service','joinChannel',channelID).then(function(){self.do_action('mail.action_discuss',{active_id:channelID});});},_onRedirect:function(resModel,resID){this.trigger_up('redirect',{res_id:resID,res_model:resModel,});},_onUpdateMessage:function(message){if(message.isLinkedToDocumentThread()&&message.getDocumentModel()===this.model&&message.getDocumentID()===this.res_id){this._fetchAndRenderThread();}},});field_registry.add('mail_thread',ThreadField);return ThreadField;});;

/* /mail/static/src/js/thread_widget.js defined in bundle 'web.assets_backend' */
odoo.define('mail.widget.Thread',function(require){"use strict";var DocumentViewer=require('mail.DocumentViewer');var mailUtils=require('mail.utils');var core=require('web.core');var time=require('web.time');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var ORDER={ASC:1,DESC:-1,};var READ_MORE=_lt("read more");var READ_LESS=_lt("read less");var ThreadWidget=Widget.extend({className:'o_mail_thread',events:{'click a':'_onClickRedirect','click img':'_onClickRedirect','click strong':'_onClickRedirect','click .o_thread_show_more':'_onClickShowMore','click .o_attachment_download':'_onAttachmentDownload','click .o_attachment_view':'_onAttachmentView','click .o_attachment_delete_cross':'_onDeleteAttachment','click .o_thread_message_needaction':'_onClickMessageNeedaction','click .o_thread_message_star':'_onClickMessageStar','click .o_thread_message_reply':'_onClickMessageReply','click .oe_mail_expand':'_onClickMailExpand','click .o_thread_message':'_onClickMessage','click':'_onClick','click .o_thread_message_email_exception':'_onClickEmailException','click .o_thread_message_email_bounce':'_onClickEmailException','click .o_thread_message_moderation':'_onClickMessageModeration','change .moderation_checkbox':'_onChangeModerationCheckbox',},init:function(parent,options){this._super.apply(this,arguments);this._enabledOptions=_.defaults(options||{},{areMessageAttachmentsDeletable:true,displayOrder:ORDER.ASC,displayMarkAsRead:true,displayModerationCommands:false,displayStars:true,displayDocumentLinks:true,displayAvatars:true,squashCloseMessages:true,displayEmailIcons:true,displayReplyIcons:false,loadMoreOnScroll:false,});this._disabledOptions={areMessageAttachmentsDeletable:false,displayOrder:this._enabledOptions.displayOrder,displayMarkAsRead:false,displayModerationCommands:false,displayStars:false,displayDocumentLinks:false,displayAvatars:this._enabledOptions.displayAvatars,squashCloseMessages:false,displayEmailIcons:false,displayReplyIcons:false,loadMoreOnScroll:this._enabledOptions.loadMoreOnScroll,};this._selectedMessageID=null;this._currentThreadID=null;this._messageMailPopover=null;},destroy:function(){clearInterval(this._updateTimestampsInterval);if(this._messageMailPopover){this._messageMailPopover.popover('hide');}
this._super();},render:function(thread,options){var self=this;var shouldScrollToBottomAfterRendering=false;if(this._currentThreadID===thread.getID()&&this.isAtBottom()){shouldScrollToBottomAfterRendering=true;}
this._currentThreadID=thread.getID();var messages=_.clone(thread.getMessages({domain:options.domain||[]}));var modeOptions=options.isCreateMode?this._disabledOptions:this._enabledOptions;this.attachments=_.uniq(_.flatten(_.map(messages,function(message){return message.getAttachments();})));options=_.extend({},modeOptions,options,{selectedMessageID:this._selectedMessageID,});var displayAuthorMessages={};var prevMessage;_.each(messages,function(message){if(!prevMessage||(Math.abs(message.getDate().diff(prevMessage.getDate()))>60000)||prevMessage.getType()!=='comment'||message.getType()!=='comment'||(prevMessage.getAuthorID()!==message.getAuthorID())||((prevMessage.isLinkedToDocumentThread()&&message.isLinkedToDocumentThread())&&(prevMessage.getDocumentModel()!==message.getDocumentModel()||prevMessage.getDocumentID()!==message.getDocumentID()))){displayAuthorMessages[message.getID()]=true;}else{displayAuthorMessages[message.getID()]=!options.squashCloseMessages;}
prevMessage=message;});if(modeOptions.displayOrder===ORDER.DESC){messages.reverse();}
this.$el.html(QWeb.render('mail.widget.Thread',{thread:thread,displayAuthorMessages:displayAuthorMessages,options:options,ORDER:ORDER,dateFormat:time.getLangDatetimeFormat(),}));if(thread.hasTypingNotification()){this.renderTypingNotificationBar(thread);}
_.each(messages,function(message){var $message=self.$('.o_thread_message[data-message-id="'+message.getID()+'"]');$message.find('.o_mail_timestamp').data('date',message.getDate());self._insertReadMore($message);});if(shouldScrollToBottomAfterRendering){this.scrollToBottom();}
if(!this._updateTimestampsInterval){this.updateTimestampsInterval=setInterval(function(){self._updateTimestamps();},1000*60);}
this._renderMessageMailPopover(messages);},getScrolltop:function(){return this.$el.scrollTop();},isAtBottom:function(){var fullHeight=this.el.scrollHeight;var topHiddenHeight=this.$el.scrollTop();var visibleHeight=this.$el.outerHeight();var bottomHiddenHeight=fullHeight-topHiddenHeight-visibleHeight;return bottomHiddenHeight<5;},removeMessageAndRender:function(messageID,thread,options){var self=this;var done=$.Deferred();this.$('.o_thread_message[data-message-id="'+messageID+'"]').fadeOut({done:function(){self.render(thread,options);done.resolve();},duration:200,});return done;},renderTypingNotificationBar:function(thread){if(this._currentThreadID===thread.getID()){var shouldScrollToBottomAfterRendering=this.isAtBottom();var $typingBar=this.$('.o_thread_typing_notification_bar');var text=thread.getTypingMembersToText();$typingBar.toggleClass('o_hidden',!text);$typingBar.text(text);if(shouldScrollToBottomAfterRendering){this.scrollToBottom();}}},scrollToBottom:function(){this.$el.scrollTop(this.el.scrollHeight);},scrollToMessage:function(options){var $target=this.$('.o_thread_message[data-message-id="'+options.msgID+'"]');if(options.onlyIfNecessary){var delta=$target.parent().height()-$target.height();var offset=delta<0?0:delta-($target.offset().top-$target.offsetParent().offset().top);offset=-Math.min(offset,0);this.$el.scrollTo("+="+offset+"px",options.duration);}else if($target.length){this.$el.scrollTo($target);}},scrollToPosition:function(position){if(position){this.$el.scrollTop(position);}else{this.scrollToBottom();}},toggleModerationCheckboxes:function(checked){this.$('.moderation_checkbox').prop('checked',checked);},unselectMessage:function(){this.$('.o_thread_message').removeClass('o_thread_selected_message');this._selectedMessageID=null;},_insertReadMore:function($element){var self=this;var groups=[];var readMoreNodes;var $children=$element.contents().filter(function(){return this.nodeType===1||this.nodeType===3&&this.nodeValue.trim();});_.each($children,function(child){var $child=$(child);if(child.nodeType===3&&$child.prevAll('[id*="stopSpelling"]').length>0){$child=$('<span>',{text:child.textContent,'data-o-mail-quote':'1',});child.parentNode.replaceChild($child[0],child);}
if($child.attr('data-o-mail-quote')||($child.get(0).nodeName==='BR'&&$child.prev('[data-o-mail-quote="1"]').length>0)){if(!readMoreNodes){readMoreNodes=[];groups.push(readMoreNodes);}
$child.hide();readMoreNodes.push($child);}else{readMoreNodes=undefined;self._insertReadMore($child);}});_.each(groups,function(group){var $readMore=$('<a>',{class:'o_mail_read_more',href:'#',text:READ_MORE,}).insertBefore(group[0]);var isReadMore=true;$readMore.click(function(e){e.preventDefault();isReadMore=!isReadMore;_.each(group,function($child){$child.hide();$child.toggle(!isReadMore);});$readMore.text(isReadMore?READ_MORE:READ_LESS);});});},_onDeleteAttachment:function(ev){ev.stopPropagation();var $target=$(ev.currentTarget);this.trigger_up('delete_attachment',{attachmentId:$target.data('id'),attachmentName:$target.data('name')});},_redirect:_.debounce(function(options){if('channelID'in options){this.trigger('redirect_to_channel',options.channelID);}else{this.trigger('redirect',options.model,options.id);}},500,true),_renderMessageMailPopover:function(messages){if(this._messageMailPopover){this._messageMailPopover.popover('hide');}
if(!this.$('.o_thread_tooltip').length){return;}
this._messageMailPopover=this.$('.o_thread_tooltip').popover({html:true,boundary:'viewport',placement:'auto',trigger:'hover',offset:'0, 1',content:function(){var messageID=$(this).data('message-id');var message=_.find(messages,function(message){return message.getID()===messageID;});return QWeb.render('mail.widget.Thread.Message.MailTooltip',{data:message.hasCustomerEmailData()?message.getCustomerEmailData():[],});},});},_updateTimestamps:function(){var isAtBottom=this.isAtBottom();this.$('.o_mail_timestamp').each(function(){var date=$(this).data('date');$(this).html(mailUtils.timeFromNow(date));});if(isAtBottom&&!this.isAtBottom()){this.scrollToBottom();}},_onAttachmentDownload:function(event){event.stopPropagation();},_onAttachmentView:function(event){event.stopPropagation();var activeAttachmentID=$(event.currentTarget).data('id');if(activeAttachmentID){var attachmentViewer=new DocumentViewer(this,this.attachments,activeAttachmentID);attachmentViewer.appendTo($('body'));}},_onChangeModerationCheckbox:function(ev){this.trigger_up('update_moderation_buttons');},_onClick:function(){if(this._selectedMessageID){this.unselectMessage();this.trigger('unselect_message');}},_onClickEmailException:function(ev){var messageID=$(ev.currentTarget).data('message-id');this.do_action('mail.mail_resend_message_action',{additional_context:{mail_message_to_resend:messageID}});},_onClickMailExpand:function(ev){ev.preventDefault();},_onClickMessage:function(ev){$(ev.currentTarget).toggleClass('o_thread_selected_message');},_onClickMessageNeedaction:function(ev){var messageID=$(ev.currentTarget).data('message-id');this.trigger('mark_as_read',messageID);},_onClickMessageReply:function(ev){this._selectedMessageID=$(ev.currentTarget).data('message-id');this.$('.o_thread_message').removeClass('o_thread_selected_message');this.$('.o_thread_message[data-message-id="'+this._selectedMessageID+'"]').addClass('o_thread_selected_message');this.trigger('select_message',this._selectedMessageID);ev.stopPropagation();},_onClickMessageStar:function(ev){var messageID=$(ev.currentTarget).data('message-id');this.trigger('toggle_star_status',messageID);},_onClickMessageModeration:function(ev){var $button=$(ev.currentTarget);var messageID=$button.data('message-id');var decision=$button.data('decision');this.trigger_up('message_moderation',{messageID:messageID,decision:decision,});},_onClickRedirect:function(ev){if($(ev.target).data('oe-field')!==undefined){return;}
var id=$(ev.target).data('oe-id');if(id){ev.preventDefault();var model=$(ev.target).data('oe-model');var options;if(model&&(model!=='mail.channel')){options={model:model,id:id};}else{options={channelID:id};}
this._redirect(options);}},_onClickShowMore:function(){this.trigger('load_more_messages');},});ThreadWidget.ORDER=ORDER;return ThreadWidget;});;

/* /mail/static/src/js/systray/systray_activity_menu.js defined in bundle 'web.assets_backend' */
odoo.define('mail.systray.ActivityMenu',function(require){"use strict";var core=require('web.core');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var QWeb=core.qweb;var ActivityMenu=Widget.extend({name:'activity_menu',template:'mail.systray.ActivityMenu',events:{'click .o_mail_activity_action':'_onActivityActionClick','click .o_mail_preview':'_onActivityFilterClick','show.bs.dropdown':'_onActivityMenuShow',},willStart:function(){return $.when(this.call('mail_service','isReady'));},start:function(){this._$activitiesPreview=this.$('.o_mail_systray_dropdown_items');this.call('mail_service','getMailBus').on('activity_updated',this,this._updateCounter);this._updateCounter();this._updateActivityPreview();return this._super();},_getActivityData:function(){var self=this;return self._rpc({model:'res.users',method:'systray_get_activities',args:[],kwargs:{context:session.user_context},}).then(function(data){self._activities=data;self.activityCounter=_.reduce(data,function(total_count,p_data){return total_count+p_data.total_count||0;},0);self.$('.o_notification_counter').text(self.activityCounter);self.$el.toggleClass('o_no_notification',!self.activityCounter);});},_getActivityModelViewID:function(model){return this._rpc({model:model,method:'get_activity_view_id'});},_updateActivityPreview:function(){var self=this;self._getActivityData().then(function(){self._$activitiesPreview.html(QWeb.render('mail.systray.ActivityMenu.Previews',{activities:self._activities}));});},_updateCounter:function(data){if(data){if(data.activity_created){this.activityCounter++;}
if(data.activity_deleted&&this.activityCounter>0){this.activityCounter--;}
this.$('.o_notification_counter').text(this.activityCounter);this.$el.toggleClass('o_no_notification',!this.activityCounter);}},_onActivityActionClick:function(ev){ev.stopPropagation();var actionXmlid=$(ev.currentTarget).data('action_xmlid');this.do_action(actionXmlid);},_onActivityFilterClick:function(event){var data=_.extend({},$(event.currentTarget).data(),$(event.target).data());var context={};if(data.filter==='my'){context['search_default_activities_overdue']=1;context['search_default_activities_today']=1;}else{context['search_default_activities_'+data.filter]=1;}
this.do_action({type:'ir.actions.act_window',name:data.model_name,res_model:data.res_model,views:[[false,'kanban'],[false,'form']],search_view_id:[false],domain:[['activity_user_id','=',session.uid]],context:context,},{clear_breadcrumbs:true,});},_onActivityMenuShow:function(){this._updateActivityPreview();},});SystrayMenu.Items.push(ActivityMenu);return ActivityMenu;});;

/* /mail/static/src/js/systray/systray_messaging_menu.js defined in bundle 'web.assets_backend' */
odoo.define('mail.systray.MessagingMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var QWeb=core.qweb;var MessagingMenu=Widget.extend({name:'messaging_menu',template:'mail.systray.MessagingMenu',events:{'click .o_mail_preview':'_onClickPreview','click .o_filter_button':'_onClickFilterButton','click .o_new_message':'_onClickNewMessage','click .o_mail_preview_mark_as_read':'_onClickPreviewMarkAsRead','show.bs.dropdown':'_onShowDropdown',},willStart:function(){return $.when(this._super.apply(this,arguments),this.call('mail_service','isReady'));},start:function(){this._$filterButtons=this.$('.o_filter_button');this._$previews=this.$('.o_mail_systray_dropdown_items');this._filter=false;this._updateCounter();var mailBus=this.call('mail_service','getMailBus');mailBus.on('update_needaction',this,this._updateCounter);mailBus.on('new_channel',this,this._updateCounter);mailBus.on('update_thread_unread_counter',this,this._updateCounter);return this._super.apply(this,arguments);},isMobile:function(){return config.device.isMobile;},_clickMailFailurePreview:function($target){var documentID=$target.data('document-id');var documentModel=$target.data('document-model');if(documentModel&&documentID){this._openDocument(documentModel,documentID);}else if(documentModel!=='mail.channel'){this.do_action({name:"Mail failures",type:'ir.actions.act_window',view_mode:'kanban,list,form',views:[[false,'kanban'],[false,'list'],[false,'form']],target:'current',res_model:documentModel,domain:[['message_has_error','=',true]],});}},_computeCounter:function(){var channels=this.call('mail_service','getChannels');var channelUnreadCounters=_.map(channels,function(channel){return channel.getUnreadCounter();});var unreadChannelCounter=_.reduce(channelUnreadCounters,function(acc,c){return c>0?acc+1:acc;},0);var inboxCounter=this.call('mail_service','getMailbox','inbox').getMailboxCounter();var mailFailureCounter=this.call('mail_service','getMailFailures').length;return unreadChannelCounter+inboxCounter+mailFailureCounter;},_getPreviews:function(){return this.call('mail_service','getSystrayPreviews',this._filter);},_isShown:function(){return this.$el.hasClass('show');},_openDiscuss:function(channelID){var self=this;var discussOptions={clear_breadcrumbs:true};if(channelID){discussOptions.active_id=channelID;}
this.do_action('mail.action_discuss',discussOptions).then(function(){self.trigger_up('hide_home_menu');core.bus.trigger('change_menu_section',self.call('mail_service','getDiscussMenuID'));});},_openDocument:function(documentModel,documentID){if(documentModel==='mail.channel'){this._openDiscuss(documentID);}else{this.do_action({type:'ir.actions.act_window',res_model:documentModel,views:[[false,'form']],res_id:documentID});}},_renderPreviews:function(previews){this._$previews.html(QWeb.render('mail.systray.MessagingMenu.Previews',{previews:previews,}));},_updatePreviews:function(){this._$previews.html(QWeb.render('Spinner'));this._getPreviews().then(this._renderPreviews.bind(this));},_updateCounter:function(){var counter=this._computeCounter();this.$('.o_notification_counter').text(counter);this.$el.toggleClass('o_no_notification',!counter);if(this._isShown()){this._updatePreviews();}},_onShowDropdown:function(){this._updatePreviews();},_onClickFilterButton:function(ev){ev.stopPropagation();this._$filterButtons.removeClass('active');var $target=$(ev.currentTarget);$target.addClass('active');this._filter=$target.data('filter');this._updatePreviews();},_onClickNewMessage:function(){this.call('mail_service','openBlankThreadWindow');},_onClickPreview:function(ev){var $target=$(ev.currentTarget);var previewID=$target.data('preview-id');if(previewID==='mail_failure'){this._clickMailFailurePreview($target);}else if(previewID==='mailbox_inbox'){var documentID=$target.data('document-id');var documentModel=$target.data('document-model');if(!documentModel){this._openDiscuss('mailbox_inbox');}else{this._openDocument(documentModel,documentID);}}else{this.call('mail_service','openThread',previewID);}},_onClickPreviewMarkAsRead:function(ev){ev.stopPropagation();var thread;var $preview=$(ev.currentTarget).closest('.o_mail_preview');var previewID=$preview.data('preview-id');if(previewID==='mailbox_inbox'){var messageIDs=[].concat($preview.data('message-ids'));this.call('mail_service','markMessagesAsRead',messageIDs);}else if(previewID==='mail_failure'){var documentModel=$preview.data('document-model');var unreadCounter=$preview.data('unread-counter');this.do_action('mail.mail_resend_cancel_action',{additional_context:{default_model:documentModel,unread_counter:unreadCounter}});}else{thread=this.call('mail_service','getThread',previewID);if(thread){thread.markAsRead();}}},});var activityMenuIndex=_.findIndex(SystrayMenu.Items,function(SystrayMenuItem){return SystrayMenuItem.prototype.name==='activity_menu';});if(activityMenuIndex>0){SystrayMenu.Items.splice(activityMenuIndex,0,MessagingMenu);}else{SystrayMenu.Items.push(MessagingMenu);}
return MessagingMenu;});;

/* /mail/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('mail.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('mail_tour',{url:"/web",},[tour.STEPS.SHOW_APPS_MENU_ITEM,{trigger:'.o_app[data-menu-xmlid="mail.menu_root_discuss"]',content:_t('Want to <b>get in touch</b> with your contacts? <i>Discuss with them here.</i>'),position:'right',edition:'community',},{trigger:'.o_app[data-menu-xmlid="mail.menu_root_discuss"]',content:_t('Want to <b>get in touch</b> with your contacts? <i>Discuss with them here.</i>'),position:'bottom',edition:'enterprise',},{trigger:'.o_mail_discuss .o_mail_discuss_sidebar .o_add[data-type="public"]',content:_t("<p>Channels make it easy to organize information across different topics and groups.</p> <p>Try to <b>create your first channel</b> (e.g. sales, marketing, product XYZ, after work party, etc).</p>"),position:'bottom',},{trigger:'.o_mail_discuss .o_mail_discuss_sidebar .o_mail_add_thread[data-type="public"]',content:_t("<p>Create a channel here.</p>"),position:'right',run:function(actions){var t=new Date().getTime();actions.text("SomeChannel_"+t,this.$anchor.find("input"));},},{trigger:".ui-menu-item > a",auto:true,in_modal:false,},{trigger:'.o_mail_discuss .o_composer_text_field',content:_t("<p><b>Write a message</b> to the members of the channel here.</p> <p>You can notify someone with <i>'@'</i> or link another channel with <i>'#'</i>. Start your message with <i>'/'</i> to get the list of possible commands.</p>"),position:"top",width:350,run:function(actions){var t=new Date().getTime();actions.text("SomeText_"+t,this.$anchor);},},{trigger:'.o_mail_discuss .o_thread_composer .o_composer_button_send',content:_t("Post your message on the thread"),position:"top",},{trigger:'.o_mail_discuss .o_mail_thread .o_thread_message_star',content:_t("Messages can be <b>starred</b> to remind you to check back later."),position:"right",},{trigger:'.o_mail_discuss .o_mail_discuss_item[data-thread-id="mailbox_starred"]',content:_t("Once a message has been starred, you can come back and review it at any time here."),position:"bottom",},{trigger:'.o_mail_discuss .o_mail_discuss_sidebar .o_add[data-type="dm_chat"]',content:_t("<p><b>Chat with coworkers</b> in real-time using direct messages.</p><p><i>You might need to invite users from the Settings app first.</i></p>"),position:'bottom',}]);});;

/* /mail/static/src/js/tools/debug_manager.js defined in bundle 'web.assets_backend' */
odoo.define('mail.DebugManager',function(require){"use strict";var core=require('web.core');var DebugManager=require('web.DebugManager');var _t=core._t;DebugManager.include({getMailMessages:function(){var self=this;var selectedIDs=this._controller.getSelectedIds();if(!selectedIDs.length){console.warn(_t("No message available"));return;}
this.do_action({res_model:'mail.message',name:_t('Manage Messages'),views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',domain:[['res_id','=',selectedIDs[0]],['model','=',this._controller.modelName]],context:{default_res_model:this._controller.modelName,default_res_id:selectedIDs[0],},});},});});;

/* /mail/static/src/js/utils.js defined in bundle 'web.assets_backend' */
odoo.define('mail.utils',function(require){"use strict";var core=require('web.core');var _t=core._t;function parseAndTransform(htmlString,transformFunction){var openToken="OPEN"+Date.now();var string=htmlString.replace(/&lt;/g,openToken);var children;try{children=$('<div>').html(string).contents();}catch(e){children=$('<div>').html('<pre>'+string+'</pre>').contents();}
return _parseAndTransform(children,transformFunction).replace(new RegExp(openToken,"g"),"&lt;");}
function _parseAndTransform(nodes,transformFunction){return _.map(nodes,function(node){return transformFunction(node,function(){return _parseAndTransform(node.childNodes,transformFunction);});}).join("");}
var urlRegexp=/\b(?:https?:\/\/\d{1,3}(?:\.\d{1,3}){3}|(?:https?:\/\/|(?:www\.))[-a-z0-9@:%._+~#=\u00C0-\u024F\u1E00-\u1EFF]{2,256}\.[a-z]{2,13})\b(?:[-a-z0-9@:%_+.~#?&'$//=;\u00C0-\u024F\u1E00-\u1EFF]*)/gi;function linkify(text,attrs){attrs=attrs||{};if(attrs.target===undefined){attrs.target='_blank';}
attrs=_.map(attrs,function(value,key){return key+'="'+_.escape(value)+'"';}).join(' ');return text.replace(urlRegexp,function(url){var href=(!/^https?:\/\//i.test(url))?"http://"+url:url;return'<a '+attrs+' href="'+href+'">'+url+'</a>';});}
function addLink(node,transformChildren){if(node.nodeType===3){return linkify(node.data);}
if(node.tagName==="A")return node.outerHTML;node.innerHTML=transformChildren();return node.outerHTML;}
function stripHTML(node,transformChildren){if(node.nodeType===3)return node.data;if(node.tagName==="BR")return"\n";return transformChildren();}
function inline(node,transform_children){if(node.nodeType===3)return node.data;if(node.nodeType===8)return"";if(node.tagName==="BR")return" ";if(node.tagName.match(/^(A|P|DIV|PRE|BLOCKQUOTE)$/))return transform_children();node.innerHTML=transform_children();return node.outerHTML;}
function parseEmail(text){if(text){var result=text.match(/(.*)<(.*@.*)>/);if(result){return[_.str.trim(result[1]),_.str.trim(result[2])];}
result=text.match(/(.*@.*)/);if(result){return[_.str.trim(result[1]),_.str.trim(result[1])];}
return[text,false];}}
function getTextToHTML(text){return text.replace(/((?:https?|ftp):\/\/[\S]+)/g,'<a href="$1">$1</a> ').replace(/[\n\r]/g,'<br/>');}
var accentedLettersMapping={'a':'[àáâãäå]','ae':'æ','c':'ç','e':'[èéêë]','i':'[ìíîï]','n':'ñ','o':'[òóôõö]','oe':'œ','u':'[ùúûűü]','y':'[ýÿ]',};function unaccent(str){_.each(accentedLettersMapping,function(value,key){str=str.replace(new RegExp(value,'g'),key);});return str;}
function timeFromNow(date){if(moment().diff(date,'seconds')<45){return _t("now");}
return date.fromNow();}
return{addLink:addLink,getTextToHTML:getTextToHTML,inline:inline,linkify:linkify,parseAndTransform:parseAndTransform,parseEmail:parseEmail,stripHTML:stripHTML,timeFromNow:timeFromNow,unaccent:unaccent,};});;

/* /mail/static/src/js/activity.js defined in bundle 'web.assets_backend' */
odoo.define('mail.Activity',function(require){"use strict";var mailUtils=require('mail.utils');var AbstractField=require('web.AbstractField');var BasicModel=require('web.BasicModel');var core=require('web.core');var field_registry=require('web.field_registry');var time=require('web.time');var QWeb=core.qweb;var _t=core._t;function _readActivities(self,ids){if(!ids.length){return $.when([]);}
var context=self.getSession().user_context;if(self.record&&!_.isEmpty(self.record.getContext())){context=self.record.getContext();}
return self._rpc({model:'mail.activity',method:'activity_format',args:[ids],context:context,}).then(function(activities){_.each(activities,function(activity){activity.create_date=moment(time.auto_str_to_date(activity.create_date));activity.date_deadline=moment(time.auto_str_to_date(activity.date_deadline));});activities=_.sortBy(activities,'date_deadline');return activities;});}
BasicModel.include({_fetchSpecialActivity:function(record,fieldName){var localID=(record._changes&&fieldName in record._changes)?record._changes[fieldName]:record.data[fieldName];return _readActivities(this,this.localData[localID].res_ids);},});var setDelayLabel=function(activities){var today=moment().startOf('day');_.each(activities,function(activity){var toDisplay='';var diff=activity.date_deadline.diff(today,'days',true);if(diff===0){toDisplay=_t("Today");}else{if(diff<0){if(diff===-1){toDisplay=_t("Yesterday");}else{toDisplay=_.str.sprintf(_t("%d days overdue"),Math.abs(diff));}}else{if(diff===1){toDisplay=_t("Tomorrow");}else{toDisplay=_.str.sprintf(_t("Due in %d days"),Math.abs(diff));}}}
activity.label_delay=toDisplay;});return activities;};var BasicActivity=AbstractField.extend({events:{'click .o_edit_activity':'_onEditActivity','click .o_mark_as_done':'_onMarkActivityDone','click .o_activity_template_preview':'_onPreviewMailTemplate','click .o_schedule_activity':'_onScheduleActivity','click .o_activity_template_send':'_onSendMailTemplate','click .o_unlink_activity':'_onUnlinkActivity',},init:function(){this._super.apply(this,arguments);this._draftFeedback={};},scheduleActivity:function(){var callback=this._reload.bind(this,{activity:true,thread:true});return this._openActivityForm(false,callback);},_markActivityDone:function(params){var activityID=params.activityID;var feedback=params.feedback;this._sendActivityFeedback(activityID,feedback).then(this._reload.bind(this,{activity:true,thread:true}));},_markActivityDoneAndScheduleNext:function(params){var activityID=params.activityID;var feedback=params.feedback;var self=this;this._rpc({model:'mail.activity',method:'action_feedback_schedule_next',args:[[activityID]],kwargs:{feedback:feedback},context:this.record.getContext(),}).then(function(rslt_action){if(rslt_action){self.do_action(rslt_action,{on_close:function(){self.trigger_up('reload',{keepChanges:true});},});}else{self.trigger_up('reload',{keepChanges:true});}});},_openActivityForm:function(id,callback){var action={type:'ir.actions.act_window',res_model:'mail.activity',view_mode:'form',view_type:'form',views:[[false,'form']],target:'new',context:{default_res_id:this.res_id,default_res_model:this.model,},res_id:id||false,};return this.do_action(action,{on_close:callback});},_sendActivityFeedback:function(activityID,feedback){return this._rpc({model:'mail.activity',method:'action_feedback',args:[[activityID]],kwargs:{feedback:feedback},context:this.record.getContext(),});},_bindPopoverFocusout:function($popover_el){var self=this;var $popover=$($popover_el.data("bs.popover").tip);var activityID=$popover_el.data('activity-id');$popover.off('focusout');$popover.focusout(function(e){if(!$popover.is(e.relatedTarget)&&!$popover.find(e.relatedTarget).length){self._draftFeedback[activityID]=$popover.find('#activity_feedback').val();$popover.popover('hide');}});},_onEditActivity:function(ev){ev.preventDefault();var activityID=$(ev.currentTarget).data('activity-id');return this._openActivityForm(activityID,this._reload.bind(this,{activity:true,thread:true}));},_onMarkActivityDone:function(ev){ev.stopPropagation();ev.preventDefault();var self=this;var $markDoneBtn=$(ev.currentTarget);var activityID=$markDoneBtn.data('activity-id');var previousActivityTypeID=$markDoneBtn.data('previous-activity-type-id')||false;var forceNextActivity=$markDoneBtn.data('force-next-activity');if($markDoneBtn.data('toggle')=='collapse'){var $actLi=$markDoneBtn.parents('.o_log_activity');var $panel=self.$('#o_activity_form_'+activityID);if(!$panel.data('bs.collapse')){var $form=$(QWeb.render('mail.activity_feedback_form',{previous_activity_type_id:previousActivityTypeID,force_next:forceNextActivity}));$panel.append($form);self._onMarkActivityDoneActions($markDoneBtn,$form,activityID);_.each($panel.siblings('.o_activity_form'),function(el){if($(el).data('bs.collapse')){$(el).empty().collapse('dispose').removeClass('show');}});$markDoneBtn.parents('.o_activity_log_container').scrollTo($actLi.position().top,100);}
$panel.on('hidden.bs.collapse',function(){if($panel.data('bs.collapse')){$actLi.removeClass('o_activity_selected');$panel.collapse('dispose');$panel.empty();}});this.$('.o_activity_selected').removeClass('o_activity_selected');$actLi.toggleClass('o_activity_selected');$panel.collapse('toggle');}else if(!$markDoneBtn.data('bs.popover')){$markDoneBtn.popover({template:$(Popover.Default.template).addClass('o_mail_activity_feedback')[0].outerHTML,container:$markDoneBtn,title:_t("Feedback"),html:true,trigger:'manual',placement:'right',content:function(){var $popover=$(QWeb.render('mail.activity_feedback_form',{previous_activity_type_id:previousActivityTypeID,force_next:forceNextActivity}));self._onMarkActivityDoneActions($markDoneBtn,$popover,activityID);return $popover;},}).on('shown.bs.popover',function(){var $popover=$($(this).data("bs.popover").tip);$(".o_mail_activity_feedback.popover").not($popover).popover("hide");$popover.addClass('o_mail_activity_feedback').attr('tabindex',0);$popover.find('#activity_feedback').focus();self._bindPopoverFocusout($(this));}).popover('show');}else{var popover=$markDoneBtn.data('bs.popover');if($('#'+popover.tip.id).length===0){popover.show();}}},_onMarkActivityDoneActions:function($btn,$form,activityID){var self=this;$form.find('#activity_feedback').val(self._draftFeedback[activityID]);$form.on('click','.o_activity_popover_done',function(ev){ev.stopPropagation();self._markActivityDone({activityID:activityID,feedback:_.escape($form.find('#activity_feedback').val()),});});$form.on('click','.o_activity_popover_done_next',function(ev){ev.stopPropagation();self._markActivityDoneAndScheduleNext({activityID:activityID,feedback:_.escape($form.find('#activity_feedback').val()),});});$form.on('click','.o_activity_popover_discard',function(ev){ev.stopPropagation();if($btn.data('bs.popover')){$btn.popover('hide');}else if($btn.data('toggle')=='collapse'){self.$('#o_activity_form_'+activityID).collapse('hide');}});},_onPreviewMailTemplate:function(ev){ev.stopPropagation();ev.preventDefault();var self=this;var templateID=$(ev.currentTarget).data('template-id');var action={name:_t('Compose Email'),type:'ir.actions.act_window',res_model:'mail.compose.message',views:[[false,'form']],target:'new',context:{default_res_id:this.res_id,default_model:this.model,default_use_template:true,default_template_id:templateID,force_email:true,},};return this.do_action(action,{on_close:function(){self.trigger_up('reload',{keepChanges:true});}});},_onSendMailTemplate:function(ev){ev.stopPropagation();ev.preventDefault();var templateID=$(ev.currentTarget).data('template-id');return this._rpc({model:this.model,method:'activity_send_mail',args:[[this.res_id],templateID],}).then(this._reload.bind(this,{activity:true,thread:true,followers:true}));},_onScheduleActivity:function(ev){ev.preventDefault();return this._openActivityForm(false,this._reload.bind(this));},_onUnlinkActivity:function(ev,options){ev.preventDefault();var activityID=$(ev.currentTarget).data('activity-id');options=_.defaults(options||{},{model:'mail.activity',args:[[activityID]],});return this._rpc({model:options.model,method:'unlink',args:options.args,}).then(this._reload.bind(this,{activity:true}));},});var Activity=BasicActivity.extend({className:'o_mail_activity',events:_.extend({},BasicActivity.prototype.events,{'click a':'_onClickRedirect',}),specialData:'_fetchSpecialActivity',init:function(){this._super.apply(this,arguments);this._activities=this.record.specialData[this.name];},_reload:function(fieldsToReload){this.trigger_up('reload_mail_fields',fieldsToReload);},_render:function(){_.each(this._activities,function(activity){var note=mailUtils.parseAndTransform(activity.note||'',mailUtils.inline);var is_blank=(/^\s*$/).test(note);if(!is_blank){activity.note=mailUtils.parseAndTransform(activity.note,mailUtils.addLink);}else{activity.note='';}});var activities=setDelayLabel(this._activities);if(activities.length){var nbActivities=_.countBy(activities,'state');this.$el.html(QWeb.render('mail.activity_items',{activities:activities,nbPlannedActivities:nbActivities.planned,nbTodayActivities:nbActivities.today,nbOverdueActivities:nbActivities.overdue,dateFormat:time.getLangDateFormat(),datetimeFormat:time.getLangDatetimeFormat(),}));}else{this.$el.empty();}},_reset:function(record){this._super.apply(this,arguments);this._activities=this.record.specialData[this.name];this.res_id=record.res_id;},_onClickRedirect:function(ev){var id=$(ev.currentTarget).data('oe-id');if(id){ev.preventDefault();var model=$(ev.currentTarget).data('oe-model');this.trigger_up('redirect',{res_id:id,res_model:model,});}},});var KanbanActivity=BasicActivity.extend({className:'o_mail_activity_kanban',template:'mail.KanbanActivity',events:_.extend({},BasicActivity.prototype.events,{'show.bs.dropdown':'_onDropdownShow',}),init:function(parent,name,record){this._super.apply(this,arguments);var selection={};_.each(record.fields.activity_state.selection,function(value){selection[value[0]]=value[1];});this.selection=selection;this._setState(record);},_reload:function(){this.trigger_up('reload',{db_id:this.record_id,keepChanges:true});},_render:function(){var $span=this.$('.o_activity_btn > span');$span.removeClass(function(index,classNames){return classNames.split(/\s+/).filter(function(className){return _.str.startsWith(className,'o_activity_color_');}).join(' ');});$span.addClass('o_activity_color_'+(this.activityState||'default'));if(this.$el.hasClass('show')){this._renderDropdown();}},_renderDropdown:function(){var self=this;this.$('.o_activity').html(QWeb.render('mail.KanbanActivityLoading'));return _readActivities(this,this.value.res_ids).then(function(activities){self.$('.o_activity').html(QWeb.render('mail.KanbanActivityDropdown',{selection:self.selection,records:_.groupBy(setDelayLabel(activities),'state'),uid:self.getSession().uid,}));});},_reset:function(record){this._super.apply(this,arguments);this._setState(record);},_setState:function(record){this.record_id=record.id;this.activityState=this.recordData.activity_state;},_onDropdownShow:function(){this._renderDropdown();},});field_registry.add('mail_activity',Activity).add('kanban_activity',KanbanActivity);return Activity;});;

/* /mail/static/src/js/views/activity/activity_view.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ActivityView',function(require){"use strict";var ActivityController=require('mail.ActivityController');var ActivityModel=require('mail.ActivityModel');var ActivityRenderer=require('mail.ActivityRenderer');var AbstractView=require('web.AbstractView');var core=require('web.core');var view_registry=require('web.view_registry');var _lt=core._lt;var ActivityView=AbstractView.extend({accesskey:"a",display_name:_lt('Activity'),icon:'fa-th',config:_.extend({},AbstractView.prototype.config,{Controller:ActivityController,Model:ActivityModel,Renderer:ActivityRenderer,}),viewType:'activity',groupable:false,});view_registry.add('activity',ActivityView);return ActivityView;});;

/* /mail/static/src/js/views/activity/activity_model.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ActivityModel',function(require){'use strict';var AbstractModel=require('web.AbstractModel');var session=require('web.session');var ActivityModel=AbstractModel.extend({get:function(){return this.data;},load:function(params){this.domain=params.domain;this.modelName=params.modelName;this.data={};return this._fetchData();},reload:function(handle,params){if(params&&'domain'in params){this.domain=params.domain;}
return this._fetchData();},_fetchData:function(){var self=this;return this._rpc({model:"mail.activity",method:'get_activity_data',kwargs:{res_model:this.modelName,domain:this.domain,context:session.user_context,}}).then(function(result){self.data.data=result;});},});return ActivityModel;});;

/* /mail/static/src/js/views/activity/activity_controller.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ActivityController',function(require){"use strict";var AbstractController=require('web.AbstractController');var ActivityController=AbstractController.extend({custom_events:_.extend({},AbstractController.prototype.custom_events,{send_mail_template:'_onSendMailTemplate',open_view_form:'_onOpenViewForm',reload:'_onReload',}),_onReload:function(event){event.stopPropagation();var self=this;this.model.reload().then(self.reload());},_onSendMailTemplate:function(ev){var templateID=ev.data.templateID;var activityTypeID=ev.data.activityTypeID;var state=this.model.get();var groupedActivities=state.data.grouped_activities;var resIDS=[];Object.keys(groupedActivities).forEach(function(resID){var activityByType=groupedActivities[resID];var activity=activityByType[activityTypeID];if(activity){resIDS.push(parseInt(resID));}});this._rpc({model:this.model.modelName,method:'activity_send_mail',args:[resIDS,templateID],});},_onOpenViewForm:function(ev){var resID=ev.data.resID;this.do_action({type:'ir.actions.act_window',res_model:this.model.modelName,res_id:resID,views:[[false,'form']],target:'current'});},});return ActivityController;});;

/* /mail/static/src/js/views/activity/activity_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('mail.ActivityRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var core=require('web.core');var field_registry=require('web.field_registry');var QWeb=core.qweb;var _t=core._t;var ActivityRenderer=AbstractRenderer.extend({className:'o_activity_view',events:{'click .o_res_name_cell':'_onResNameClicked','click .o_send_mail_template':'_onSenMailTemplateClicked',},_render:function(){this.$el.removeClass('table-responsive').empty();if(this.state.data.activity_types.length===0){this.$el.append(QWeb.render('ActivityView.nodata'));}else{var $table=$('<table>').addClass('table-bordered').append(this._renderHeader()).append(this._renderBody());this.$el.addClass('table-responsive').append($table);}
return this._super();},_renderBody:function(){var $rows=_.map(this.state.data.res_ids,this._renderRow.bind(this));return $('<tbody>').append($rows);},_renderHeader:function(){var $tr=$('<tr>').append($('<th>')).append(_.map(this.state.data.activity_types,this._renderHeaderCell.bind(this)));return $('<thead>').append($tr);},_renderHeaderCell:function(activity_type){return QWeb.render('mail.ActivityViewHeaderCell',{id:activity_type[0],name:activity_type[1],template_list:activity_type[2]||[],});},_renderRow:function(data){var self=this;var res_id=data[0];var name=data[1];var $nameTD=$('<td>').addClass("o_res_name_cell").html(name).data('res-id',res_id);var $cells=_.map(this.state.data.activity_types,function(node){var $td=$('<td>').addClass("o_activity_summary_cell");var activity_type_id=node[0];var activity_group=self.state.data.grouped_activities[res_id][activity_type_id];activity_group=activity_group||{count:0,ids:[],state:false};if(activity_group.state){$td.addClass(activity_group.state);}
var record={data:{activity_ids:{model:'mail.activity',res_ids:activity_group.ids,},activity_state:activity_group.state,},fields:{activity_ids:{},activity_state:{selection:[['overdue',_t("Overdue")],['today',_t("Today")],['planned',_t("Planned")],],},},fieldsInfo:{},model:self.state.data.model,ref:res_id,type:'record',res_id:res_id,getContext:function(){return{};},};var KanbanActivity=field_registry.get('kanban_activity');var widget=new KanbanActivity(self,"activity_ids",record,{});widget.appendTo($td);var $date=$('<div>');var formated_date=moment(activity_group.o_closest_deadline).format('ll');var current_year=(new Date()).getFullYear();if(formated_date.endsWith(current_year)){formated_date=formated_date.slice(0,-4);formated_date=formated_date.replace(/( |,)*$/g,"");}
$date.text(formated_date).addClass('o_closest_deadline');$td.find('a').empty().append($date);return $td;});var $tr=$('<tr/>',{class:'o_data_row'}).append($nameTD).append($cells);return $tr;},_onSenMailTemplateClicked:function(ev){var $target=$(ev.currentTarget);var templateID=$target.data('template-id');var activityTypeID=$target.closest('th').data('activity-type-id');this.trigger_up('send_mail_template',{activityTypeID:activityTypeID,templateID:templateID,});},_onResNameClicked:function(ev){var resID=$(ev.currentTarget).data('res-id');this.trigger_up('open_view_form',{resID:resID});},});return ActivityRenderer;});;

/* /mail/static/src/js/attachment_box.js defined in bundle 'web.assets_backend' */
odoo.define('mail.AttachmentBox',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var DocumentViewer=require('mail.DocumentViewer');var QWeb=core.qweb;var _t=core._t;var AttachmentBox=Widget.extend({template:'mail.chatter.AttachmentBox',events:{"click .o_attachment_download":"_onAttachmentDownload","click .o_attachment_view":"_onAttachmentView","click .o_attachment_delete_cross":"_onDeleteAttachment","click .o_upload_attachments_button":"_onUploadAttachments","change .o_chatter_attachment_form .o_form_binary_form":"_onAddAttachment",},init:function(parent,record,attachments){this._super.apply(this,arguments);this.fileuploadId=_.uniqueId('oe_fileupload');$(window).on(this.fileuploadId,this._onUploaded.bind(this));this.currentResID=record.res_id;this.currentResModel=record.model;this.attachmentIDs=attachments;this.imageList={};this.otherList={};_.each(attachments,function(attachment){attachment.url='/web/content/'+attachment.id+'?download=true';attachment.filename=attachment.datas_fname||_t('unnamed');});var sortedAttachments=_.partition(attachments,function(att){return att.mimetype&&att.mimetype.split('/')[0]==='image';});this.imageList=sortedAttachments[0];this.otherList=sortedAttachments[1];},destroy:function(){$(window).off(this.fileuploadId);this._super.apply(this,arguments);},update:function(record){this.currentResID=record.res_id;this.currentResModel=record.model;},_onAddAttachment:function(ev){var $input=$(ev.currentTarget).find('input.o_input_file');if($input.val()!==''){var $binaryForm=this.$('form.o_form_binary_form');$binaryForm.submit();}},_onAttachmentDownload:function(ev){ev.stopPropagation();},_onAttachmentView:function(ev){ev.stopPropagation();ev.preventDefault();var activeAttachmentID=$(ev.currentTarget).data('id');if(activeAttachmentID){var attachmentViewer=new DocumentViewer(this,this.attachmentIDs,activeAttachmentID);attachmentViewer.appendTo($('body'));}},_onUploadAttachments:function(ev){this.$('input.o_input_file').click();},_onDeleteAttachment:function(ev){ev.stopPropagation();var $target=$(ev.currentTarget);this.trigger_up('delete_attachment',{attachmentId:$target.data('id'),attachmentName:$target.data('name')});},_onUploaded:function(ev,response){if(response.error){this.do_warn(_t("Error"),_t("You are not allowed to upload an attachment here."));}else{this.trigger_up('reload_attachment_box');}},});return AttachmentBox;});;

/* /mail/static/src/js/emojis.js defined in bundle 'web.assets_backend' */
odoo.define('mail.emojis',function(require){"use strict";var data={":)":"😊",":-)":"😊","=)":"😊",":]":"😊",":D":"😃",":-D":"😃","=D":"😃","xD":"😆","XD":"😆","x'D":"😂",";)":"😉",";-)":"😉","B)":"😎","8)":"😎","B-)":"😎","8-)":"😎",";p":"😜",";P":"😜",":p":"😋",":P":"😋",":-p":"😋",":-P":"😋","=P":"😋","xp":"😝","xP":"😝","o_o":"😳",":|":"😐",":-|":"😐",":/":"😕",":-/":"😕",":(":"😞",":@":"😱",":O":"😲",":-O":"😲",":o":"😲",":-o":"😲",":'o":"😨","3:(":"😠",">:(":"😠","3:":"😠","3:)":"😈",">:)":"😈",":*":"😘",":-*":"😘","o:)":"😇",":'(":"😢",":'-(":"😭",":\"(":"😭","<3":"❤️","&lt;3":"❤️",":heart":"❤️",":heart_eyes":"😍",":turban":"👳",":+1":"👍",":-1":"👎",":ok":"👌",":poop":"💩",":no_see":"🙈",":no_hear":"🙉",":no_speak":"🙊",":bug":"🐞",":kitten":"😺",":bear":"🐻",":snail":"🐌",":boar":"🐗",":clover":"🍀",":sunflower":"🌹",":fire":"🔥",":sun":"☀️",":partly_sunny:":"⛅️",":rainbow":"🌈",":cloud":"☁️",":zap":"⚡️",":star":"⭐️",":cookie":"🍪",":pizza":"🍕",":hamburger":"🍔",":fries":"🍟",":cake":"🎂",":cake_part":"🍰",":coffee":"☕️",":banana":"🍌",":sushi":"🍣",":rice_ball":"🍙",":beer":"🍺",":wine":"🍷",":cocktail":"🍸",":tropical":"🍹",":beers":"🍻",":ghost":"👻",":skull":"💀",":et":"👽",":alien":"👽",":party":"🎉",":trophy":"🏆",":key":"🔑",":pin":"📌",":postal_horn":"📯",":music":"🎵",":trumpet":"🎺",":guitar":"🎸",":soccer":"⚽️",":football":"🏈",":8ball":"🎱",":clapper":"🎬",":microphone":"🎤",":cheese":"🧀",};var emojiDict={};_.each(data,function(unicode,source){if(!emojiDict[unicode]){emojiDict[unicode]={sources:[source],unicode:unicode,description:source,};}else{emojiDict[unicode].sources.push(source);}});var emojis=_.values(emojiDict);return emojis;});;

/* /app_odoo_customize/static/src/js/app_window_title.js defined in bundle 'web.assets_backend' */
odoo.define('app_odoo_customize.app_system_name',function(require){"use strict";var WebClient=require('web.WebClient');WebClient.include({init:function(){this._super.apply(this,arguments);this.set('title_part',{"zopenerp":document.title});}});});;

/* /app_odoo_customize/static/src/js/customize_user_menu.js defined in bundle 'web.assets_backend' */
odoo.define('app_odoo_customize.UserMenu',function(require){"use strict";var UserMenu=require('web.UserMenu');var documentation_url='https://www.sunpop.cn';var documentation_dev_url='https://www.sunpop.cn';var support_url='https://www.sunpop.cn';var account_title='My Account';var account_url='https://www.sunpop.cn';UserMenu.include({init:function(){this._super.apply(this,arguments);var self=this;var session=this.getSession();var lang_list='';self._rpc({model:'res.lang',method:'search_read',domain:[],fields:['name','code'],lazy:false,}).then(function(res){_.each(res,function(lang){var a='';if(lang['code']===session.user_context.lang){a='<i class="fa fa-check"></i>';}else{a='';}
lang_list+='<a role="menuitem" href="#" class="dropdown-item" data-lang-menu="lang" data-lang-id="'+lang['code']
+'"><img class="flag" src="app_odoo_customize/static/src/img/flags/'+lang['code']+'.png"/>'+lang['name']+a+'</a>';});lang_list+='<div role="separator" class="dropdown-divider"/>'
setTimeout(function(){$('switch-lang').replaceWith(lang_list);},1000)})
self._rpc({model:'ir.config_parameter',method:'search_read',domain:[['key','=like','app_%']],fields:['key','value'],lazy:false,}).then(function(res){$.each(res,function(key,val){if(val.key=='app_documentation_url')
documentation_url=val.value;if(val.key=='app_documentation_dev_url')
documentation_dev_url=val.value;if(val.key=='app_support_url')
support_url=val.value;if(val.key=='app_account_title')
account_title=val.value;if(val.key=='app_account_url')
account_url=val.value;if(val.key=='app_show_lang'&&val.value=="False"){$('switch-lang').hide();}
if(session.user_context.uid>2||(val.key=='app_show_debug'&&val.value=="False")){$('[data-menu="debug"]').hide();$('[data-menu="debugassets"]').hide();$('[data-menu="quitdebug"]').hide();}
if(val.key=='app_show_documentation'&&val.value=="False"){$('[data-menu="documentation"]').hide();}
if(val.key=='app_show_documentation_dev'&&val.value=="False"){$('[data-menu="documentation_dev"]').hide();}
if(val.key=='app_show_support'&&val.value=="False"){$('[data-menu="support"]').hide();}
if(val.key=='app_show_account'&&val.value=="False"){$('[data-menu="account"]').hide();}
if(val.key=='app_account_title'&&val.value){$('[data-menu="account"]').html(account_title);}
if(val.key=='app_show_poweredby'&&val.value=="False"){$('.o_sub_menu_footer').hide();}});})},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$el.on('click','a[data-lang-menu]',function(ev){ev.preventDefault();var f=self['_onMenuLang']
f.call(self,$(this));});var mMode='normal';if(window.location.href.indexOf('debug')!=-1)
mMode='debug';if(window.location.href.indexOf('debug=assets')!=-1)
mMode='assets';if(mMode=='normal')
$('[data-menu="quitdebug"]').hide();if(mMode=='debug')
$('[data-menu="debug"]').hide();if(mMode=='assets')
$('[data-menu="debugassets"]').hide();});},_onMenuAccount:function(){window.open(account_url,'_blank');},_onMenuDocumentation:function(){window.open(documentation_url,'_blank');},_onMenuSupport:function(){window.open(support_url,'_blank');},_onMenuDebug:function(){window.location=$.param.querystring(window.location.href,'debug=1');},_onMenuDebugassets:function(){window.location=$.param.querystring(window.location.href,'debug=assets');},_onMenuQuitdebug:function(){window.location.search="?";},_onMenuDocumentation_dev:function(){window.open(documentation_dev_url,'_blank');},_onMenuLang:function(ev){var self=this;var lang=($(ev).data("lang-id"));var session=this.getSession();return this._rpc({model:'res.users',method:'write',args:[session.uid,{'lang':lang}],}).then(function(result){self.do_action({type:'ir.actions.client',res_model:'res.users',tag:'reload_context',target:'current',});});},})});;

/* /mail_bot/static/src/js/mailbot_service.js defined in bundle 'web.assets_backend' */
odoo.define('mail_bot.MailBotService',function(require){"use strict";var AbstractService=require('web.AbstractService');var core=require('web.core');var session=require('web.session');var _t=core._t;var MailBotService=AbstractService.extend({start:function(){this._hasRequest=(window.Notification&&window.Notification.permission==="default")||false;if('odoobot_initialized'in session&&!session.odoobot_initialized){this._showOdoobotTimeout();}},getPreviews:function(filter){var previews=[];if(this.hasRequest()&&(filter==='mailbox_inbox'||!filter)){previews.push({title:_t("OdooBot has a request"),imageSRC:"/mail/static/src/img/odoobot.png",status:'bot',body:_t("Enable desktop notifications to chat"),id:'request_notification',unreadCounter:1,});}
return previews;},hasRequest:function(){return this._hasRequest;},removeRequest:function(){this._hasRequest=false;},_showOdoobotTimeout:function(){var self=this;setTimeout(function(){session.odoobot_initialized=true;self._rpc({model:'mail.channel',method:'init_odoobot',});},2*60*1000);},});core.serviceRegistry.add('mailbot_service',MailBotService);return MailBotService;});;

/* /mail_bot/static/src/js/systray_messaging_menu.js defined in bundle 'web.assets_backend' */
odoo.define('mail_bot.systray.MessagingMenu',function(require){"use strict";var MessagingMenu=require('mail.systray.MessagingMenu');var core=require('web.core');var _t=core._t;return MessagingMenu.include({_computeCounter:function(){var counter=this._super.apply(this,arguments);if(this.call('mailbot_service','hasRequest')){counter++;}
return counter;},_getPreviews:function(){var mailbotPreviews=this.call('mailbot_service','getPreviews',this._filter);return this._super.apply(this,arguments).then(function(previews){return _.union(mailbotPreviews,previews);});},_handleResponseNotificationPermission:function(value){this.call('mailbot_service','removeRequest');if(value!=='granted'){this.call('bus_service','sendNotification',_t('Permission denied'),_t('Odoo will not have the permission to send native notifications on this device.'));}else{this.call('bus_service','sendNotification',_t('Yay, push notifications are enabled!'),_t('Odoo has now the permission to send you native notifications on this device.'));}
this._updateCounter();},_requestNotificationPermission:function(){var def=window.Notification&&window.Notification.requestPermission();if(def){def.then(this._handleResponseNotificationPermission.bind(this));}
this.$('.o_mail_navbar_request_permission').slideUp();},_onClickPreview:function(ev){var previewID=$(ev.currentTarget).data('preview-id');if(previewID==='request_notification'){this._requestNotificationPermission();}else{this._super.apply(this,arguments);}},_onClickPreviewMarkAsRead:function(ev){ev.stopPropagation();var $preview=$(ev.currentTarget).closest('.o_mail_preview');var previewID=$preview.data('preview-id');if(previewID==='request_notification'){this._requestNotificationPermission();}else{this._super.apply(this,arguments);}}});});;

/* /partner_autocomplete/static/src/js/partner_autocomplete_core.js defined in bundle 'web.assets_backend' */
odoo.define('partner.autocomplete.core',function(require){'use strict';var rpc=require('web.rpc');var concurrency=require('web.concurrency');return{_dropPreviousOdoo:new concurrency.DropPrevious(),_dropPreviousClearbit:new concurrency.DropPrevious(),_timeout:1000,autocomplete:function(value){value=value.trim();var def=$.Deferred(),isVAT=this._isVAT(value),odooSuggestions=[],clearbitSuggestions=[];var odooPromise=this._getOdooSuggestions(value,isVAT).then(function(suggestions){odooSuggestions=suggestions;});var clearbitPromise=isVAT?false:this._getClearbitSuggestions(value).then(function(suggestions){clearbitSuggestions=suggestions;});var concatResults=function(){if(clearbitSuggestions&&clearbitSuggestions.length){var websites=odooSuggestions.map(function(suggestion){return suggestion.website;});clearbitSuggestions.forEach(function(suggestion){if(websites.indexOf(suggestion.domain)<0){websites.push(suggestion.domain);odooSuggestions.push(suggestion);}});}
odooSuggestions=_.filter(odooSuggestions,function(suggestion){return!suggestion.ignored;});_.each(odooSuggestions,function(suggestion){delete suggestion.ignored;});return def.resolve(odooSuggestions);};this._whenAll([odooPromise,clearbitPromise]).then(concatResults,concatResults);return def;},enrichCompany:function(company){return rpc.query({model:'res.partner',method:'enrich_company',args:[company.website,company.partner_gid,company.vat],});},getCompanyLogo:function(url){return this._getBase64Image(url).then(function(base64Image){return base64Image?base64Image.replace(/^data:image[^;]*;base64,?/,''):false;});},getCreateData:function(company){var removeUselessFields=function(company){var fields='label,description,domain,logo,legal_name,ignored'.split(',');fields.forEach(function(field){delete company[field];});var notEmptyFields="country_id,state_id".split(',');notEmptyFields.forEach(function(field){if(!company[field])delete company[field];});};var def=$.Deferred();var enrichPromise=this.enrichCompany(company);var logoPromise=company.logo?this.getCompanyLogo(company.logo):false;this._whenAll([enrichPromise,logoPromise]).always(function(company_data,logo_data){if(Array.isArray(company_data))company_data=company_data[0];else company_data={};if(Array.isArray(logo_data))logo_data=logo_data[0];else logo_data='';if(_.isEmpty(company_data))company_data=company;removeUselessFields(company_data);if(company.vat)company_data.vat=company.vat;def.resolve({company:company_data,logo:logo_data});});return def;},isOnline:function(){return navigator&&navigator.onLine;},validateSearchTerm:function(search_val,onlyVAT){if(onlyVAT)return this._isVAT(search_val);else return search_val&&search_val.length>2;},_getBase64Image:function(url){var def=$.Deferred();var xhr=new XMLHttpRequest();xhr.onload=function(){var reader=new FileReader();reader.onloadend=function(){def.resolve(reader.result);};reader.readAsDataURL(xhr.response);};xhr.open('GET',url);xhr.responseType='blob';xhr.onerror=def.reject.bind(def);xhr.send();return def;},_getClearbitSuggestions:function(value){var url='https://autocomplete.clearbit.com/v1/companies/suggest?query='+value;var def=$.ajax({url:url,dataType:'json',timeout:this._timeout,success:function(suggestions){suggestions.map(function(suggestion){suggestion.label=suggestion.name;suggestion.website=suggestion.domain;suggestion.description=suggestion.website;return suggestion;});return suggestions;},});return this._dropPreviousClearbit.add(def);},_getOdooSuggestions:function(value,isVAT){var method=isVAT?'read_by_vat':'autocomplete';var def=rpc.query({model:'res.partner',method:method,args:[value],},{shadow:true,}).then(function(suggestions){suggestions.map(function(suggestion){suggestion.logo=suggestion.logo||'';suggestion.label=suggestion.legal_name||suggestion.name;if(suggestion.vat)suggestion.description=suggestion.vat;else if(suggestion.website)suggestion.description=suggestion.website;if(suggestion.country_id&&suggestion.country_id.display_name){if(suggestion.description)suggestion.description+=_.str.sprintf(' (%s)',suggestion.country_id.display_name);else suggestion.description+=suggestion.country_id.display_name;}
return suggestion;});return suggestions;});return this._dropPreviousOdoo.add(def);},_isVAT:function(search_val){var str=this._sanitizeVAT(search_val);return checkVATNumber(str);},_sanitizeVAT:function(search_value){return search_value?search_value.replace(/[^A-Za-z0-9]/g,''):'';},_whenAll:function(array){var slice=[].slice;var
resolveValues=arguments.length===1&&$.isArray(array)?array:slice.call(arguments),length=resolveValues.length,remaining=length,deferred=$.Deferred(),i=0,failed=0,rejectContexts=Array(length),rejectValues=Array(length),resolveContexts=Array(length),value;function updateFunc(index,contexts,values){return function(){!(values===resolveValues)&&failed++;deferred.notifyWith(contexts[index]=this,values[index]=slice.call(arguments));if(!(--remaining)){deferred[(!failed?'resolve':'reject')+'With'](contexts,values);}};}
for(;i<length;i++){if((value=resolveValues[i])&&$.isFunction(value.promise)){value.promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(updateFunc(i,rejectContexts,rejectValues));}
else{deferred.notifyWith(this,value);--remaining;}}
if(!remaining){deferred.resolveWith(resolveContexts,resolveValues);}
return deferred.promise();},};});;

/* /partner_autocomplete/static/src/js/partner_autocomplete_fieldchar.js defined in bundle 'web.assets_backend' */
odoo.define('partner.autocomplete.fieldchar',function(require){'use strict';var basic_fields=require('web.basic_fields');var core=require('web.core');var field_registry=require('web.field_registry');var Autocomplete=require('partner.autocomplete.core');var QWeb=core.qweb;var FieldChar=basic_fields.FieldChar;var FieldAutocomplete=FieldChar.extend({className:'o_field_partner_autocomplete',debounceSuggestions:400,resetOnAnyFieldChange:true,jsLibs:['/partner_autocomplete/static/lib/jsvat.js'],events:_.extend({},FieldChar.prototype.events,{'keyup':'_onKeyup','mousedown .o_partner_autocomplete_suggestion':'_onMousedown','focusout':'_onFocusout','mouseenter .o_partner_autocomplete_suggestion':'_onHoverDropdown','click .o_partner_autocomplete_suggestion':'_onSuggestionClicked',}),init:function(){this._super.apply(this,arguments);this.onlyVAT=this.name==='vat';if(this.mode==='edit'){this.tagName='div';this.className+=' dropdown open';}
if(this.debounceSuggestions>0){this._suggestCompanies=_.debounce(this._suggestCompanies.bind(this),this.debounceSuggestions);}},_isActive:function(){return this.model==='res.company'||(this.model==='res.partner'&&this.record.data.is_company&&!(this.record.data&&this.record.data.id));},_removeDropdown:function(){if(this.$dropdown){this.$dropdown.remove();this.$dropdown=undefined;}},_renderEdit:function(){this.$el.empty();this._prepareInput().appendTo(this.$el);},_selectCompany:function(company){var self=this;Autocomplete.getCreateData(company).then(function(data){if(data.logo){var logoField=self.model==='res.partner'?'image':'logo';data.company[logoField]=data.logo;}
if(self.model==='res.company'){var fields='comment,child_ids,bank_ids,additional_info'.split(',');fields.forEach(function(field){delete data.company[field];});}
self._setOne2ManyField('child_ids',data.company.child_ids);delete data.company.child_ids;self._setOne2ManyField('bank_ids',data.company.bank_ids);delete data.company.bank_ids;self.trigger_up('field_changed',{dataPointID:self.dataPointID,changes:data.company,});});if(this.onlyVAT)
this.$input.val(this._formatValue(company.vat));else
this.$input.val(this._formatValue(company.name));this._removeDropdown();},_setOne2ManyField:function(field,list){var self=this;var viewType=this.record.viewType;if(list&&this.record.fieldsInfo[viewType]&&this.record.fieldsInfo[viewType][field]){list.forEach(function(item){var changes={};changes[field]={operation:'CREATE',data:item,};self.trigger_up('field_changed',{dataPointID:self.dataPointID,changes:changes,});});}},_showDropdown:function(){this._removeDropdown();if(this.suggestions.length>0){this.$dropdown=$(QWeb.render('partner_autocomplete.dropdown',{suggestions:this.suggestions,}));this.$dropdown.appendTo(this.$el);}},_suggestCompanies:function(value){var self=this;if(Autocomplete.validateSearchTerm(value,this.onlyVAT)&&Autocomplete.isOnline()){return Autocomplete.autocomplete(value).then(function(suggestions){if(suggestions&&suggestions.length){self.suggestions=suggestions;self._showDropdown();}else{self._removeDropdown();}});}else{this._removeDropdown();}},_onFocusout:function(){this._removeDropdown();},_onHoverDropdown:function(e){this.$dropdown.find('.active').removeClass('active');$(e.currentTarget).parent().addClass('active');},_onInput:function(){this._super.apply(this,arguments);if(this._isActive()){this._suggestCompanies(this.$input.val());}},_onKeydown:function(e){switch(e.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:if(!this.$dropdown){break;}
e.preventDefault();var $suggestions=this.$dropdown.children();var $active=$suggestions.filter('.active');var $to;if($active.length){$to=e.which===$.ui.keyCode.DOWN?$active.next():$active.prev();}else{$to=$suggestions.first();}
if($to.length){$active.removeClass('active');$to.addClass('active');}
return;}
this._super.apply(this,arguments);},_onKeyup:function(e){switch(e.which){case $.ui.keyCode.ESCAPE:e.preventDefault();this._removeDropdown();break;case $.ui.keyCode.ENTER:if(!this.$dropdown){break;}
e.preventDefault();var $active=this.$dropdown.find('.o_partner_autocomplete_suggestion.active');if(!$active.length){return;}
this._selectCompany(this.suggestions[$active.data('index')]);break;}},_onMousedown:function(e){e.preventDefault();},_onSuggestionClicked:function(e){e.preventDefault();this._selectCompany(this.suggestions[$(e.currentTarget).data('index')]);},});field_registry.add('field_partner_autocomplete',FieldAutocomplete);return FieldAutocomplete;});;

/* /partner_autocomplete/static/src/js/partner_autocomplete_many2one.js defined in bundle 'web.assets_backend' */
odoo.define('partner.autocomplete.many2one',function(require){'use strict';var FieldMany2One=require('web.relational_fields').FieldMany2One;var core=require('web.core');var Autocomplete=require('partner.autocomplete.core');var field_registry=require('web.field_registry');var _t=core._t;var PartnerField=FieldMany2One.extend({jsLibs:['/partner_autocomplete/static/lib/jsvat.js'],init:function(){this._super.apply(this,arguments);this._addAutocompleteSource(this._searchSuggestions,{placeholder:_t('Searching Autocomplete...'),order:20,validation:Autocomplete.validateSearchTerm,});this.additionalContext['show_vat']=true;},_createPartner:function(company){var self=this;self.$('input').val('');return Autocomplete.getCreateData(company).then(function(data){var context={'default_is_company':true};_.each(data.company,function(val,key){context['default_'+key]=val&&val.id?val.id:val;});if(data.logo)context.default_image=data.logo;return self._searchCreatePopup("form",false,context);});},_getDisplayNameWithoutVAT:function(value){return value.split(' ‒ ')[0];},_modifyAutompleteRendering:function(){var api=this.$input.data('ui-autocomplete');if(!api){return;}
api._renderItem=function(ul,item){ul.addClass('o_partner_autocomplete_dropdown');var $a=$('<a/>')["html"](item.label);if(item.logo){var $img=$('<img/>').attr('src',item.logo);$a.append($img);}
return $("<li></li>").data("item.autocomplete",item).append($a).appendTo(ul).addClass(item.classname);};},_renderEdit:function(){this.m2o_value=this._getDisplayNameWithoutVAT(this.m2o_value);this._super.apply(this,arguments);this._modifyAutompleteRendering();},_searchSuggestions:function(search_val){var def=$.Deferred();if(Autocomplete.isOnline()){var self=this;Autocomplete.autocomplete(search_val).then(function(suggestions){var choices=[];if(suggestions&&suggestions.length){_.each(suggestions,function(suggestion){var label='<i class="fa fa-magic text-muted"/> ';label+=_.str.sprintf('%s, <span class="text-muted">%s</span>',suggestion.label,suggestion.description);choices.push({label:label,action:function(){self._createPartner(suggestion);},logo:suggestion.logo,classname:'o_partner_autocomplete_dropdown_item',});});}
def.resolve(choices);});}else{def.resolve([]);}
return def;},});field_registry.add('res_partner_many2one',PartnerField);return PartnerField;});;

/* /sms/static/src/js/sms_widget.js defined in bundle 'web.assets_backend' */
odoo.define('sms.sms_widget',function(require){"use strict";var basicFields=require('web.basic_fields');var core=require('web.core');var fieldRegistry=require('web.field_registry');var dom=require('web.dom');var framework=require('web.framework');var FieldText=basicFields.FieldText;var InputField=basicFields.InputField;var QWeb=core.qweb;var _t=core._t
var SmsWidget=InputField.extend({init:function(){this._super.apply(this,arguments);this.nbrChar=0;this.nbrSMS=0;this.encoding="GSM7";this.tagName='div';},_compute:function(){var content=this._getValue();this.encoding=this._extractEncoding(content);this.nbrChar=content.length;this.nbrChar+=(content.match(/\n/g)||[]).length;this.nbrSMS=this._countSMS(this.nbrChar,this.encoding);this._renderSMS();},_countSMS:function(){if(this.nbrChar===0){return 0;}
if(this.encoding==='UNICODE'){if(this.nbrChar<=70){return 1;}
return Math.ceil(this.nbrChar/67);}
if(this.nbrChar<=160){return 1;}
return Math.ceil(this.nbrChar/153);},_renderEdit:function(){this.$el.empty();this._prepareInput($('<textarea/>')).appendTo(this.$el);this.$el.append($(QWeb.render("sms.sms_count",{})));this._compute();},_extractEncoding:function(content){if(String(content).match(RegExp("^[@£$¥èéùìòÇ\\nØø\\rÅåΔ_ΦΓΛΩΠΨΣΘΞÆæßÉ !\\\"#¤%&'()*+,-./0123456789:;<=>?¡ABCDEFGHIJKLMNOPQRSTUVWXYZÄÖÑÜ§¿abcdefghijklmnopqrstuvwxyzäöñüà]*$"))){return'GSM7';}
return'UNICODE';},_renderSMS:function(){this.$('.o_sms_count').text(_.str.sprintf(_t('%s chars, fits in %s SMS (%s) '),this.nbrChar,this.nbrSMS,this.encoding));},_onChange:function(){this._super.apply(this,arguments);this._compute();},_onInput:function(){this._super.apply(this,arguments);this._compute();},});fieldRegistry.add('sms_widget',SmsWidget);return SmsWidget;});;

/* /account/static/src/js/reconciliation/reconciliation_action.js defined in bundle 'web.assets_backend' */
odoo.define('account.ReconciliationClientAction',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var ReconciliationModel=require('account.ReconciliationModel');var ReconciliationRenderer=require('account.ReconciliationRenderer');var ControlPanelMixin=require('web.ControlPanelMixin');var Widget=require('web.Widget');var core=require('web.core');var _t=core._t;var StatementAction=AbstractAction.extend(ControlPanelMixin,{title:core._t('Bank Reconciliation'),template:'reconciliation',custom_events:{change_mode:'_onAction',change_filter:'_onAction',change_offset:'_onAction',change_partner:'_onAction',add_proposition:'_onAction',search_balance_amount:'_onAction',remove_proposition:'_onAction',update_proposition:'_onAction',create_proposition:'_onAction',quick_create_proposition:'_onAction',toggle_partial_reconcile:'_onAction',validate:'_onValidate',change_name:'_onChangeName',close_statement:'_onCloseStatement',load_more:'_onLoadMore',},config:{Model:ReconciliationModel.StatementModel,ActionRenderer:ReconciliationRenderer.StatementRenderer,LineRenderer:ReconciliationRenderer.LineRenderer,params:['statement_ids'],defaultDisplayQty:10,limitMoveLines:15,},init:function(parent,params){this._super.apply(this,arguments);this.action_manager=parent;this.params=params;this.model=new this.config.Model(this,{modelName:"account.reconciliation.widget",defaultDisplayQty:params.params&&params.params.defaultDisplayQty||this.config.defaultDisplayQty,limitMoveLines:params.params&&params.params.limitMoveLines||this.config.limitMoveLines,});this.widgets=[];if(!this.action_manager){this.set_cp_bus(new Widget());}
_.each(params.params,function(value,name){params.context[name]=name.indexOf('_ids')!==-1?_.map((value+'').split(),parseFloat):value;});params.params={};_.each(this.config.params,function(name){if(params.context[name]){params.params[name]=name.indexOf('_ids')!==-1&&_.isArray(params.context[name])?params.context[name].join():params.context[name];}});},willStart:function(){var self=this;var def=this.model.load(this.params.context).then(this._super.bind(this));return def.then(function(){self.title=self.model.bank_statement_id?self.model.bank_statement_id.display_name:self.title;self.renderer=new self.config.ActionRenderer(self,self.model,{'bank_statement_id':self.model.bank_statement_id,'valuenow':self.model.valuenow,'valuemax':self.model.valuemax,'defaultDisplayQty':self.model.defaultDisplayQty,'title':self.title,});});},start:function(){var self=this;this.set("title",this.title);this.update_control_panel({search_view_hidden:true},{clear:true});this.renderer.prependTo(self.$('.o_form_sheet'));this._renderLines();var initialState=this.renderer._initialState;if(initialState.valuenow===initialState.valuemax){initialState.context=this.model.getContext();this.renderer.showRainbowMan(initialState);}else{if(initialState.valuenow>0)
this.renderer._renderNotifications(this.model.statement.notifications);this._openFirstLine();}},do_show:function(){this._super.apply(this,arguments);if(this.action_manager){this.update_control_panel({search_view_hidden:true},{clear:true});this.action_manager.do_push_state({action:this.params.tag,active_id:this.params.res_id,});}},_getWidget:function(handle){return _.find(this.widgets,function(widget){return widget.handle===handle;});},_loadMore:function(qty){var self=this;return this.model.loadMore(qty).then(function(){self._renderLines();});},_openFirstLine:function(){var self=this;var handle=_.compact(_.map(this.model.lines,function(line,handle){return line.reconciled?null:handle;}))[0];if(handle){var line=this.model.getLine(handle);this.model.changeMode(handle,'match').always(function(){self._getWidget(handle).update(line);});}
return handle;},_renderLines:function(){var self=this;var linesToDisplay=this.model.getStatementLines();_.each(linesToDisplay,function(line,handle){var widget=new self.config.LineRenderer(self,self.model,line);widget.handle=handle;self.widgets.push(widget);widget.appendTo(self.$('.o_reconciliation_lines'));});if(this.model.hasMoreLines()===false){this.renderer.hideLoadMoreButton();}},_onAction:function(event){var self=this;var handle=event.target.handle;var line=this.model.getLine(handle);var mode=line.mode;this.model[_.str.camelize(event.name)](handle,event.data.data).always(function(){self._getWidget(handle).update(line);if(mode==='inactive'&&line.mode!=='inactive'){_.each(self.model.lines,function(line,_handle){if(line.mode!=='inactive'&&_handle!==handle){self.model.changeMode(_handle,'inactive');var widget=self._getWidget(_handle);if(widget){widget.update(line);}}});}});},_onChangeName:function(event){var self=this;var title=event.data.data;this.model.changeName(title).then(function(){self.title=title;self.set("title",title);self.renderer.update({'valuenow':self.model.valuenow,'valuemax':self.model.valuemax,'title':title,});});},_onCloseStatement:function(event){var self=this;return this.model.closeStatement().then(function(result){self.do_action({name:'Bank Statements',res_model:'account.bank.statement',res_id:result,views:[[false,'form']],type:'ir.actions.act_window',view_type:'form',view_mode:'form',});});},_onLoadMore:function(event){return this._loadMore(this.model.defaultDisplayQty);},_onValidate:function(event){var self=this;var handle=event.target.handle;var method='validate';this.model[method](handle).then(function(result){self.renderer.update({'valuenow':self.model.valuenow,'valuemax':self.model.valuemax,'title':self.title,'time':Date.now()-self.time,'notifications':result.notifications,'context':self.model.getContext(),});_.each(result.handles,function(handle){var widget=self._getWidget(handle);if(widget){widget.destroy();var index=_.findIndex(self.widgets,function(widget){return widget.handle===handle;});self.widgets.splice(index,1);}});if(self.widgets.length<self.model.defaultDisplayQty&&self.model.valuemax-self.model.valuenow>=self.model.defaultDisplayQty){var toLoad=self.model.defaultDisplayQty-self.widgets.length;self._loadMore(toLoad);}
self._openFirstLine();});},});var ManualAction=StatementAction.extend({title:core._t('Journal Items to Reconcile'),config:{Model:ReconciliationModel.ManualModel,ActionRenderer:ReconciliationRenderer.ManualRenderer,LineRenderer:ReconciliationRenderer.ManualLineRenderer,params:['company_ids','mode','partner_ids','account_ids'],defaultDisplayQty:30,limitMoveLines:15,},_onValidate:function(event){var self=this;var handle=event.target.handle;var method='validate';this.model[method](handle).then(function(result){_.each(result.reconciled,function(handle){self._getWidget(handle).destroy();});_.each(result.updated,function(handle){self._getWidget(handle).update(self.model.getLine(handle));});self.renderer.update({valuenow:_.compact(_.invoke(self.widgets,'isDestroyed')).length,valuemax:self.widgets.length,title:self.title,time:Date.now()-self.time,});if(!_.any(result.updated,function(handle){return self.model.getLine(handle).mode!=='inactive';})){self._openFirstLine();}});},});core.action_registry.add('bank_statement_reconciliation_view',StatementAction);core.action_registry.add('manual_reconciliation_view',ManualAction);return{StatementAction:StatementAction,ManualAction:ManualAction,};});;

/* /account/static/src/js/reconciliation/reconciliation_model.js defined in bundle 'web.assets_backend' */
odoo.define('account.ReconciliationModel',function(require){"use strict";var BasicModel=require('web.BasicModel');var field_utils=require('web.field_utils');var utils=require('web.utils');var session=require('web.session');var CrashManager=require('web.CrashManager');var core=require('web.core');var _t=core._t;var StatementModel=BasicModel.extend({avoidCreate:false,quickCreateFields:['account_id','amount','analytic_account_id','label','tax_id','force_tax_included','analytic_tag_ids'],init:function(parent,options){this._super.apply(this,arguments);this.reconcileModels=[];this.lines={};this.valuenow=0;this.valuemax=0;this.alreadyDisplayed=[];this.defaultDisplayQty=options&&options.defaultDisplayQty||10;this.limitMoveLines=options&&options.limitMoveLines||15;},addProposition:function(handle,mv_line_id){var self=this;var line=this.getLine(handle);var prop=_.clone(_.find(line.mv_lines,{'id':mv_line_id}));this._addProposition(line,prop);line.limit_override=(line.offset+1)*this.limitMoveLines;if(!line.st_line.partner_id&&line.reconciliation_proposition&&line.reconciliation_proposition.length==1&&prop.partner_id&&line.type===undefined){return this.changePartner(handle,{'id':prop.partner_id,'display_name':prop.partner_name},true).then(function(result){return $.when(self._computeLine(line),self._performMoveLine(handle));});}
return $.when(this._computeLine(line),this._performMoveLine(handle));},changeFilter:function(handle,filter){var line=this.getLine(handle);line.filter=filter;line.offset=0;return this._performMoveLine(handle);},changeMode:function(handle,mode){var line=this.getLine(handle);if(line.mode==='create'){this._blurProposition(handle);line.createForm=null;}
if(mode==='create'&&this.avoidCreate){mode='match';}
line.mode=mode;if(mode==='match'){return this._performMoveLine(handle);}
if(line.mode==='create'){return this.createProposition(handle);}
return $.when();},changeName:function(name){return this._rpc({model:'account.bank.statement',method:'write',args:[this.bank_statement_id.id,{name:name}],});},changeOffset:function(handle,offset){this.getLine(handle).offset+=(offset>0?1:-1)*this.limitMoveLines;return this._performMoveLine(handle);},changePartner:function(handle,partner,preserveMode){var self=this;var line=this.getLine(handle);line.st_line.partner_id=partner&&partner.id;line.st_line.partner_name=partner&&partner.display_name||'';return $.when(partner&&this._changePartner(handle,partner.id)).then(function(){if(line.st_line.partner_id){_.each(line.reconciliation_proposition,function(prop){if(prop.partner_id!=line.st_line.partner_id){line.reconciliation_proposition=[];return false;}})}
return self._computeLine(line);}).then(function(){if(!preserveMode)
return self.changeMode(handle,'match');return false;}).then(function(){return line.mode==='create'?self.createProposition(handle):false;})},closeStatement:function(){var self=this;return this._rpc({model:'account.bank.statement',method:'button_confirm_bank',args:[self.bank_statement_id.id],}).then(function(){return self.bank_statement_id.id;});},createProposition:function(handle){var line=this.getLine(handle);var prop=_.filter(line.reconciliation_proposition,'__focus');var last=prop[prop.length-1];if(last&&!this._isValid(last)){return $.Deferred().resolve(false);}
prop=this._formatQuickCreate(line);line.reconciliation_proposition.push(prop);line.createForm=_.pick(prop,this.quickCreateFields);return this._computeLine(line);},getContext:function(){return this.context;},getStatementLines:function(){var self=this;var linesToDisplay=_.pick(this.lines,function(value,key,object){if(value.visible===true&&self.alreadyDisplayed.indexOf(key)===-1){self.alreadyDisplayed.push(key);return object;}});return linesToDisplay;},hasMoreLines:function(){var self=this;var notDisplayed=_.filter(this.lines,function(line){return!line.visible;});if(notDisplayed.length>0){return true;}
return false;},getLine:function(handle){return this.lines[handle];},load:function(context){var self=this;var statement_ids=context.statement_ids;if(!statement_ids){return $.when();}
this.context=context;var def_statement=this._rpc({model:'account.reconciliation.widget',method:'get_bank_statement_data',args:[statement_ids],}).then(function(statement){self.statement=statement;self.bank_statement_id=statement_ids.length===1?{id:statement_ids[0],display_name:statement.statement_name}:false;self.valuenow=statement.value_min;self.valuemax=statement.value_max;self.context.journal_id=statement.journal_id;_.each(statement.lines,function(res){var handle=_.uniqueId('rline');self.lines[handle]={id:res.st_line.id,partner_id:res.st_line.partner_id,handle:handle,reconciled:false,mode:'inactive',mv_lines:[],offset:0,filter:"",reconciliation_proposition:[],reconcileModels:[],};});});var domainReconcile=[];if(context&&context.company_ids){domainReconcile.push(['company_id','in',context.company_ids]);}
if(context&&context.active_model==='account.journal'&&context.active_ids){domainReconcile.push('|');domainReconcile.push(['match_journal_ids','=',false]);domainReconcile.push(['match_journal_ids','in',context.active_ids]);}
var def_reconcileModel=this._loadReconciliationModel({domainReconcile:domainReconcile});var def_account=this._rpc({model:'account.account',method:'search_read',fields:['code'],}).then(function(accounts){self.accounts=_.object(_.pluck(accounts,'id'),_.pluck(accounts,'code'));});var def_taxes=self._loadTaxes();return $.when(def_statement,def_reconcileModel,def_account,def_taxes).then(function(){_.each(self.lines,function(line){line.reconcileModels=self.reconcileModels;});var ids=_.pluck(self.lines,'id');ids=ids.splice(0,self.defaultDisplayQty);self.pagerIndex=ids.length;return self._formatLine(self.statement.lines);});},_readAnalyticTags:function(params){var self=this;this.analyticTags={};if(!params||!params.res_ids||!params.res_ids.length){return $.when();}
var fields=(params&&params.fields||[]).concat(['id','display_name']);return this._rpc({model:'account.analytic.tag',method:'read',args:[params.res_ids,fields,],}).then(function(tags){for(var i=0;i<tags.length;i++){var tag=tags[i];self.analyticTags[tag.id]=tag;}});},_loadReconciliationModel:function(params){var self=this;return this._rpc({model:'account.reconcile.model',method:'search_read',domain:params.domainReconcile||[],}).then(function(reconcileModels){var analyticTagIds=[];for(var i=0;i<reconcileModels.length;i++){var modelTags=reconcileModels[i].analytic_tag_ids||[];for(var j=0;j<modelTags.length;j++){if(analyticTagIds.indexOf(modelTags[j])===-1){analyticTagIds.push(modelTags[j]);}}}
return self._readAnalyticTags({res_ids:analyticTagIds}).then(function(){for(var i=0;i<reconcileModels.length;i++){var recModel=reconcileModels[i];var analyticTagData=[];var modelTags=reconcileModels[i].analytic_tag_ids||[];for(var j=0;j<modelTags.length;j++){var tagId=modelTags[j];analyticTagData.push([tagId,self.analyticTags[tagId].display_name])}
recModel.analytic_tag_ids=analyticTagData;}
self.reconcileModels=reconcileModels;});});},_loadTaxes:function(){var self=this;self.taxes={};return this._rpc({model:'account.tax',method:'search_read',fields:['price_include','amount_type'],}).then(function(taxes){_.each(taxes,function(tax){self.taxes[tax.id]={price_include:tax.price_include,amount_type:tax.amount_type,}})});},loadMore:function(qty){if(qty===undefined){qty=this.defaultDisplayQty;}
var ids=_.pluck(this.lines,'id');ids=ids.splice(this.pagerIndex,qty);this.pagerIndex+=qty;return this.loadData(ids,this._getExcludedIds());},loadData:function(ids,excluded_ids){var self=this;return self._rpc({model:'account.reconciliation.widget',method:'get_bank_statement_line_data',args:[ids,excluded_ids],context:self.context,}).then(function(res){return self._formatLine(res['lines']);})},quickCreateProposition:function(handle,reconcileModelId){var line=this.getLine(handle);var reconcileModel=_.find(this.reconcileModels,function(r){return r.id===reconcileModelId;});var fields=['account_id','amount','amount_type','analytic_account_id','journal_id','label','force_tax_included','tax_id','analytic_tag_ids'];this._blurProposition(handle);var focus=this._formatQuickCreate(line,_.pick(reconcileModel,fields));focus.reconcileModelId=reconcileModelId;line.reconciliation_proposition.push(focus);if(reconcileModel.has_second_line){var second={};_.each(fields,function(key){second[key]=("second_"+key)in reconcileModel?reconcileModel["second_"+key]:reconcileModel[key];});focus=this._formatQuickCreate(line,second);focus.reconcileModelId=reconcileModelId;line.reconciliation_proposition.push(focus);this._computeReconcileModels(handle,reconcileModelId);}
line.createForm=_.pick(focus,this.quickCreateFields);return this._computeLine(line);},removeProposition:function(handle,id){var self=this;var line=this.getLine(handle);var defs=[];line.limit_override=(line.offset+1)*this.limitMoveLines;var prop=_.find(line.reconciliation_proposition,{'id':id});if(prop){line.reconciliation_proposition=_.filter(line.reconciliation_proposition,function(p){return p.id!==prop.id&&p.id!==prop.link&&p.link!==prop.id&&(!p.link||p.link!==prop.link);});if(line.reconciliation_proposition.length==0&&line.st_line.has_no_partner)
defs.push(self.changePartner(line.handle));}
line.mode=(id||line.mode!=="create")&&isNaN(id)&&!this.avoidCreate?'create':'match';defs.push(this._computeLine(line));if(line.mode==='create'){return $.when.apply($,defs).then(function(){return self.createProposition(handle);});}else if(line.mode==='match'){return $.when.apply($,defs).then(function(){return self._performMoveLine(handle);});}
return $.when.apply($,defs);},searchBalanceAmount:function(handle){var line=this.getLine(handle);var amount=line.balance.amount;var amount_str=_.str.sprintf('%.2f',Math.abs(amount));amount_str=(amount>'0'?'-':'+')+amount_str;if(line.balance.currency_id&&line.balance.amount_currency){var amount_currency=line.balance.amount_currency;var amount_currency_str=_.str.sprintf('%.2f',Math.abs(amount_currency));amount_str+='|'+(amount_currency>'0'?'-':'+')+amount_currency_str;}
if(amount_str===line.filter){line.filter='';line.offset=0;return this.changeMode(handle,'create');}
line.filter=amount_str;line.offset=0;return this.changeMode(handle,'match');},togglePartialReconcile:function(handle){var line=this.getLine(handle);var selected=_.filter(line.reconciliation_proposition,function(prop){return prop.display_triangle});if(selected.length!=1)
return $.Deferred().reject();selected=selected[0];selected.partial_reconcile=!selected.partial_reconcile;if(!selected.partial_reconcile){return this._computeLine(line);}
var format_options={currency_id:line.st_line.currency_id};selected.write_off_amount=selected.amount+line.balance.amount;selected.write_off_amount_str=field_utils.format.monetary(Math.abs(selected.write_off_amount),{},format_options);selected.write_off_amount_str=selected.write_off_amount_str.replace('&nbsp;',' ');return this._computeLine(line).then(function(){if(selected.partial_reconcile){line.balance.amount=0;line.balance.type=1;line.mode='inactive';}});},updateProposition:function(handle,values){var self=this;var line=this.getLine(handle);var prop=_.last(_.filter(line.reconciliation_proposition,'__focus'));if(!prop){prop=this._formatQuickCreate(line);line.reconciliation_proposition.push(prop);}
_.each(values,function(value,fieldName){if(fieldName==='analytic_tag_ids'){switch(value.operation){case"ADD_M2M":if(!_.findWhere(prop.analytic_tag_ids,{id:value.ids.id})){prop.analytic_tag_ids.push(value.ids);}
break;case"FORGET":var id=self.localData[value.ids[0]].ref;prop.analytic_tag_ids=_.filter(prop.analytic_tag_ids,function(val){return val.id!==id;});break;}}else{prop[fieldName]=values[fieldName];}});if('account_id'in values){prop.account_code=prop.account_id?this.accounts[prop.account_id.id]:'';}
if('amount'in values){prop.base_amount=values.amount;if(prop.reconcileModelId){this._computeReconcileModels(handle,prop.reconcileModelId);}}
if('label'in values||'account_id'in values||'amount'in values||'tax_id'in values||'force_tax_included'in values){prop.__tax_to_recompute=true;if(values.tax_id){values.tax_id.amount_type=this.taxes[values.tax_id.id].amount_type;values.tax_id.price_include=prop.force_tax_included=this.taxes[values.tax_id.id].price_include;}else if('tax_id'in values&&prop.base_amount&&prop.base_amount!=prop.amount)
prop.amount=prop.base_amount;}
line.createForm=_.pick(prop,this.quickCreateFields);if(prop.base_amount)
line.createForm.amount=prop.base_amount;return this._computeLine(line);},validate:function(handle){var self=this;var handles=[];if(handle){handles=[handle];}else{_.each(this.lines,function(line,handle){if(!line.reconciled&&line.balance&&!line.balance.amount&&line.reconciliation_proposition.length){handles.push(handle);}});}
var ids=[];var values=[];_.each(handles,function(handle){var line=self.getLine(handle);var props=_.filter(line.reconciliation_proposition,function(prop){return!prop.invalid;});if(props.length===0){props.push(self._formatQuickCreate(line,{account_id:[line.st_line.open_balance_account_id,self.accounts[line.st_line.open_balance_account_id]],}));line.reconciliation_proposition.push(props[0]);self._computeLine(line);}
ids.push(line.id);var values_dict={"partner_id":line.st_line.partner_id,"counterpart_aml_dicts":_.map(_.filter(props,function(prop){return!isNaN(prop.id)&&!prop.already_paid;}),self._formatToProcessReconciliation.bind(self,line)),"payment_aml_ids":_.pluck(_.filter(props,function(prop){return!isNaN(prop.id)&&prop.already_paid;}),'id'),"new_aml_dicts":_.map(_.filter(props,function(prop){return isNaN(prop.id)&&prop.display;}),self._formatToProcessReconciliation.bind(self,line)),};var currency=session.get_currency(line.st_line.currency_id);var balance=line.balance.amount;if(!utils.float_is_zero(balance,currency.digits[1])){var unreconciled_amount_dict={'account_id':line.st_line.open_balance_account_id,'credit':balance>0?balance:0,'debit':balance<0?-balance:0,'name':line.st_line.name+' : '+_t("Open balance"),};values_dict['new_aml_dicts'].push(unreconciled_amount_dict);}
values.push(values_dict);line.reconciled=true;self.valuenow++;});return this._rpc({model:'account.reconciliation.widget',method:'process_bank_statement_line',args:[ids,values],}).then(function(){return{handles:handles};});},_addProposition:function(line,prop){function checkAccountType(r){return!isNaN(r.id)&&r.account_type!==prop.account_type;}
if(_.any(line.reconciliation_proposition,checkAccountType)){new CrashManager().show_warning({data:{exception_type:_t("Incorrect Operation"),message:_t("You cannot mix items from receivable and payable accounts.")}});return $.when();}
line.reconciliation_proposition.push(prop);_.each(line.reconciliation_proposition,function(prop){prop.partial_reconcile=false;});},_blurProposition:function(handle){var line=this.getLine(handle);line.reconciliation_proposition=_.filter(line.reconciliation_proposition,function(l){l.__focus=false;return!l.invalid;});return this._computeLine(line);},_changePartner:function(handle,partner_id){var self=this;return this._rpc({model:'res.partner',method:'read',args:[partner_id,["property_account_receivable_id","property_account_payable_id"]],}).then(function(result){if(result.length>0){var line=self.getLine(handle);self.lines[handle].st_line.open_balance_account_id=line.balance.amount<0?result[0]['property_account_payable_id'][0]:result[0]['property_account_receivable_id'][0];}});},_computeLine:function(line){var self=this;var tax_defs=[];var reconciliation_proposition=[];var formatOptions={currency_id:line.st_line.currency_id,};_.each(line.reconciliation_proposition,function(prop){if(prop.is_tax){if(!_.find(line.reconciliation_proposition,{'id':prop.link}).__tax_to_recompute){reconciliation_proposition.push(prop);}
return;}
reconciliation_proposition.push(prop);if(prop.tax_id&&prop.__tax_to_recompute&&prop.base_amount){line.reconciliation_proposition=_.filter(line.reconciliation_proposition,function(p){return!p.is_tax||p.link!==prop.id;});var args=[[prop.tax_id.id],prop.base_amount,formatOptions.currency_id];var add_context={'round':true};if(line.createForm.force_tax_included&&prop.tax_id.amount_type!=="group")
add_context.force_price_include=true;tax_defs.push(self._rpc({model:'account.tax',method:'json_friendly_compute_all',args:args,context:$.extend({},self.context||{},add_context),}).then(function(result){_.each(result.taxes,function(tax){var tax_prop=self._formatQuickCreate(line,{'link':prop.id,'tax_id':[tax.id,null],'amount':tax.amount,'label':prop.label?prop.label+" "+tax.name:tax.name,'date':prop.date,'account_id':tax.account_id?[tax.account_id,null]:prop.account_id,'analytic':tax.analytic,'is_tax':true,'__focus':false});prop.tax_exigible=tax.tax_exigibility==='on_payment'?true:undefined
prop.amount=tax.base;prop.amount_str=field_utils.format.monetary(Math.abs(prop.amount),{},formatOptions);prop.invalid=!self._isValid(prop);tax_prop.amount_str=field_utils.format.monetary(Math.abs(tax_prop.amount),{},formatOptions);tax_prop.invalid=prop.invalid;reconciliation_proposition.push(tax_prop);});}));}else{prop.amount_str=field_utils.format.monetary(Math.abs(prop.amount),{},formatOptions);prop.display=self._isDisplayedProposition(prop);prop.invalid=!self._isValid(prop);}});return $.when.apply($,tax_defs).then(function(){_.each(reconciliation_proposition,function(prop){prop.__tax_to_recompute=false;});line.reconciliation_proposition=reconciliation_proposition;var amount_currency=0;var total=line.st_line.amount||0;var isOtherCurrencyId=_.uniq(_.pluck(_.reject(reconciliation_proposition,'invalid'),'currency_id'));isOtherCurrencyId=isOtherCurrencyId.length===1&&!total&&isOtherCurrencyId[0]!==formatOptions.currency_id?isOtherCurrencyId[0]:false;_.each(reconciliation_proposition,function(prop){if(!prop.invalid){total-=prop.amount;if(isOtherCurrencyId){amount_currency-=(prop.amount<0?-1:1)*Math.abs(prop.amount_currency);}}});var company_currency=session.get_currency(line.st_line.currency_id);var company_precision=company_currency&&company_currency.digits[1]||2;total=utils.round_decimals(total,company_precision)||0;if(isOtherCurrencyId){var other_currency=session.get_currency(isOtherCurrencyId);var other_precision=other_currency&&other_currency.digits[1]||2;amount_currency=utils.round_decimals(amount_currency,other_precision);}
line.balance={amount:total,amount_str:field_utils.format.monetary(Math.abs(total),{},formatOptions),currency_id:isOtherCurrencyId,amount_currency:isOtherCurrencyId?amount_currency:total,amount_currency_str:isOtherCurrencyId?field_utils.format.monetary(Math.abs(amount_currency),{},{currency_id:isOtherCurrencyId}):false,account_code:self.accounts[line.st_line.open_balance_account_id],};line.balance.type=line.balance.amount_currency?(line.st_line.partner_id?0:-1):1;});},_computeReconcileModels:function(handle,reconcileModelId){var line=this.getLine(handle);var props=_.filter(line.reconciliation_proposition,{'reconcileModelId':reconcileModelId,'__focus':true});if(props.length===2&&props[0].percent&&props[1].percent){if(props[0].percent+props[1].percent===100){props[0].base_amount=props[0].amount=line.st_line.amount-props[1].base_amount;props[0].__tax_to_recompute=true;}}},_formatNameGet:function(value){return value?(value.id?value:{'id':value[0],'display_name':value[1]}):false;},_formatMany2ManyTags:function(value){var res=[];for(var i=0,len=value.length;i<len;i++){res[i]={'id':value[i][0],'display_name':value[i][1]};}
return res;},_formatLineProposition:function(line,props){var self=this;if(props.length){_.each(props,function(prop){prop.amount=prop.debit||-prop.credit;prop.label=prop.name;prop.account_id=self._formatNameGet(prop.account_id||line.account_id);prop.is_partially_reconciled=prop.amount_str!==prop.total_amount_str;});}},_formatLine:function(lines){var self=this;var defs=[];_.each(lines,function(data){var line=_.find(self.lines,function(l){return l.id===data.st_line.id;});line.visible=true;line.limitMoveLines=self.limitMoveLines;_.extend(line,data);self._formatLineProposition(line,line.reconciliation_proposition);if(!line.reconciliation_proposition.length){delete line.reconciliation_proposition;}
defs.push(self._computeLine(line).then(function(){if(!line.st_line.partner_id&&line.reconciliation_proposition.length>0){var hasDifferentPartners=function(prop){return!prop.partner_id||prop.partner_id!=line.reconciliation_proposition[0].partner_id;}
if(!_.any(line.reconciliation_proposition,hasDifferentPartners)){return self.changePartner(line.handle,{'id':line.reconciliation_proposition[0].partner_id,'display_name':line.reconciliation_proposition[0].partner_name,},true);}}else if(!line.st_line.partner_id&&line.partner_id&&line.partner_name){return self.changePartner(line.handle,{'id':line.partner_id,'display_name':line.partner_name,},true);}
return true;}).then(function(){return data.write_off?self.quickCreateProposition(line.handle,data.model_id):true;}));});return $.when.apply($,defs);},_formatMoveLine:function(handle,mv_lines){var self=this;var line=this.getLine(handle);if(line.offset===0||line.limit_override){line.mv_lines=mv_lines;delete line.limit_override;}else{line.mv_lines=line.mv_lines.concat(mv_lines);}
this._formatLineProposition(line,mv_lines);if(line.mode!=='create'&&!line.mv_lines.length&&!line.filter.length){line.mode=this.avoidCreate||!line.balance.amount?'inactive':'create';if(line.mode==='create'){return this._computeLine(line).then(function(){return self.createProposition(handle);});}}else{return this._computeLine(line);}},_formatQuickCreate:function(line,values){values=values||{};var today=new moment().utc().format();var account=this._formatNameGet(values.account_id);var formatOptions={currency_id:line.st_line.currency_id,};var amount=values.amount!==undefined?values.amount:line.balance.amount;var prop={'id':_.uniqueId('createLine'),'label':values.label||line.st_line.name,'account_id':account,'account_code':account?this.accounts[account.id]:'','analytic_account_id':this._formatNameGet(values.analytic_account_id),'analytic_tag_ids':this._formatMany2ManyTags(values.analytic_tag_ids||[]),'journal_id':this._formatNameGet(values.journal_id),'tax_id':this._formatNameGet(values.tax_id),'debit':0,'credit':0,'date':values.date?values.date:field_utils.parse.date(today,{},{isUTC:true}),'base_amount':values.amount_type!=="percentage"?(amount):line.balance.amount*values.amount/100,'percent':values.amount_type==="percentage"?values.amount:null,'link':values.link,'display':true,'invalid':true,'__tax_to_recompute':true,'is_tax':values.is_tax,'__focus':'__focus'in values?values.__focus:true,};if(prop.base_amount){var sign=prop.base_amount<0?-1:1;var amount=field_utils.format.monetary(Math.abs(prop.base_amount),{},formatOptions);prop.base_amount=sign*field_utils.parse.monetary(amount,{},formatOptions);}
if(prop.tax_id){prop.tax_id.amount_type=this.taxes[prop.tax_id.id].amount_type;prop.tax_id.price_include=this.taxes[prop.tax_id.id].price_include;}
if(prop.tax_id&&values.force_tax_included!==undefined)
prop.force_tax_included=values.force_tax_included;else if(prop.tax_id&&this.taxes[prop.tax_id.id].price_include)
prop.force_tax_included=this.taxes[prop.tax_id.id].price_include;prop.amount=prop.base_amount;return prop;},_getExcludedIds:function(){var excludedIds=[];_.each(this.lines,function(line){if(line.reconciliation_proposition){_.each(line.reconciliation_proposition,function(prop){if(parseInt(prop['id'])){excludedIds.push(prop['id']);}})}});return excludedIds;},_isDisplayedProposition:function(prop){return!isNaN(prop.id)||!!prop.account_id;},_isValid:function(prop){return!isNaN(prop.id)||prop.account_id&&prop.amount&&prop.label&&!!prop.label.length;},_performMoveLine:function(handle){var line=this.getLine(handle);var excluded_ids=_.compact(_.flatten(_.map(this.lines,function(line){return _.map(line.reconciliation_proposition,function(prop){return!prop.partial_reconcile&&_.isNumber(prop.id)?prop.id:null;});})));var filter=line.filter||"";var limit=this.limitMoveLines;var offset=line.offset;if(line.limit_override){offset=0;limit=line.limit_override;}
return this._rpc({model:'account.reconciliation.widget',method:'get_move_lines_for_bank_statement_line',args:[line.id,line.st_line.partner_id,excluded_ids,filter,offset,limit],context:this.context,}).then(this._formatMoveLine.bind(this,handle));},_formatToProcessReconciliation:function(line,prop){var amount=-prop.amount;if(prop.partial_reconcile===true){amount=-prop.write_off_amount;}
var result={name:prop.label,debit:amount>0?amount:0,credit:amount<0?-amount:0,tax_exigible:prop.tax_exigible,analytic_tag_ids:[[6,null,_.pluck(prop.analytic_tag_ids,'id')]]};if(!isNaN(prop.id)){result.counterpart_aml_id=prop.id;}else{result.account_id=prop.account_id.id;if(prop.journal_id){result.journal_id=prop.journal_id.id;}}
if(!isNaN(prop.id))result.counterpart_aml_id=prop.id;if(prop.analytic_account_id)result.analytic_account_id=prop.analytic_account_id.id;if(prop.tax_id&&!prop.is_tax)result.tax_ids=[[4,prop.tax_id.id,null]];if(prop.tax_id&&prop.is_tax)result.tax_line_id=prop.tax_id.id;return result;},});var ManualModel=StatementModel.extend({quickCreateFields:['account_id','journal_id','amount','analytic_account_id','label','tax_id','force_tax_included','analytic_tag_ids','date'],hasMoreLines:function(){if(this.manualLines.length>this.pagerIndex){return true;}
return false;},load:function(context){var self=this;this.context=context;var domain_account_id=[];if(context&&context.company_ids){domain_account_id.push(['company_id','in',context.company_ids]);}
var def_account=this._rpc({model:'account.account',method:'search_read',domain:domain_account_id,fields:['code'],}).then(function(accounts){self.account_ids=_.pluck(accounts,'id');self.accounts=_.object(self.account_ids,_.pluck(accounts,'code'));});var domainReconcile=[];var company_ids=context&&context.company_ids||[session.company_id]
if(company_ids){domainReconcile.push(['company_id','in',company_ids]);}
var def_reconcileModel=this._loadReconciliationModel({domainReconcile:domainReconcile});var def_taxes=this._loadTaxes();return $.when(def_reconcileModel,def_account,def_taxes).then(function(){switch(context.mode){case'customers':case'suppliers':var mode=context.mode==='customers'?'receivable':'payable';var args=['partner',context.partner_ids||null,mode];return self._rpc({model:'account.reconciliation.widget',method:'get_data_for_manual_reconciliation',args:args,context:context,}).then(function(result){self.manualLines=result;self.valuenow=0;self.valuemax=Object.keys(self.manualLines).length;var lines=self.manualLines.slice(0,self.defaultDisplayQty);self.pagerIndex=lines.length;return self.loadData(lines);});case'accounts':return self._rpc({model:'account.reconciliation.widget',method:'get_data_for_manual_reconciliation',args:['account',context.account_ids||self.account_ids],context:context,}).then(function(result){self.manualLines=result;self.valuenow=0;self.valuemax=Object.keys(self.manualLines).length;var lines=self.manualLines.slice(0,self.defaultDisplayQty);self.pagerIndex=lines.length;return self.loadData(lines);});default:var partner_ids=context.partner_ids;var account_ids=self.account_ids;if(partner_ids&&!account_ids)account_ids=[];if(!partner_ids&&account_ids)partner_ids=[];account_ids=null;partner_ids=null;return self._rpc({model:'account.reconciliation.widget',method:'get_all_data_for_manual_reconciliation',args:[partner_ids,account_ids],context:context,}).then(function(result){self.manualLines=[].concat(result.accounts,result.customers,result.suppliers)
self.valuenow=0;self.valuemax=Object.keys(self.manualLines).length;var lines=self.manualLines.slice(0,self.defaultDisplayQty);self.pagerIndex=lines.length;return self.loadData(lines);});}});},loadMore:function(qty){if(qty===undefined){qty=this.defaultDisplayQty;}
var lines=this.manualLines.slice(this.pagerIndex,this.pagerIndex+qty);this.pagerIndex+=qty;return this.loadData(lines);},loadData:function(lines){var self=this;var defs=[];_.each(lines,function(l){defs.push(self._formatLine(l.mode,l))});return $.when.apply($,defs);},validate:function(handle){var self=this;var handles=[];if(handle){handles=[handle];}else{_.each(this.lines,function(line,handle){if(!line.reconciled&&!line.balance.amount&&line.reconciliation_proposition.length){handles.push(handle);}});}
var def=$.when();var process_reconciliations=[];var reconciled=[];_.each(handles,function(handle){var line=self.getLine(handle);if(line.reconciled){return;}
var props=line.reconciliation_proposition;if(!props.length){self.valuenow++;reconciled.push(handle);line.reconciled=true;process_reconciliations.push({id:line.type==='accounts'?line.account_id:line.partner_id,type:line.type,mv_line_ids:[],new_mv_line_dicts:[],});}else{var mv_line_ids=_.pluck(_.filter(props,function(prop){return!isNaN(prop.id);}),'id');var new_mv_line_dicts=_.map(_.filter(props,function(prop){return isNaN(prop.id)&&prop.display;}),self._formatToProcessReconciliation.bind(self,line));process_reconciliations.push({id:null,type:null,mv_line_ids:mv_line_ids,new_mv_line_dicts:new_mv_line_dicts});}
line.reconciliation_proposition=[];});if(process_reconciliations.length){def=self._rpc({model:'account.reconciliation.widget',method:'process_move_lines',args:[process_reconciliations],});}
return def.then(function(){var defs=[];var account_ids=[];var partner_ids=[];_.each(handles,function(handle){var line=self.getLine(handle);if(line.reconciled){return;}
line.filter="";line.offset=0;defs.push(self._performMoveLine(handle).then(function(){if(!line.mv_lines.length){self.valuenow++;reconciled.push(handle);line.reconciled=true;if(line.type==='accounts'){account_ids.push(line.account_id.id);}else{partner_ids.push(line.partner_id);}}}));});return $.when.apply($,defs).then(function(){if(account_ids.length){self._rpc({model:'account.account',method:'mark_as_reconciled',args:[account_ids],});}
if(partner_ids.length){self._rpc({model:'res.partner',method:'mark_as_reconciled',args:[partner_ids],});}
return{reconciled:reconciled,updated:_.difference(handles,reconciled)};});});},_computeLine:function(line){return this._super(line).then(function(){var props=_.reject(line.reconciliation_proposition,'invalid');line.balance.type=-1;if(!line.balance.amount_currency&&props.length){line.balance.type=1;}else if(_.any(props,function(prop){return prop.amount>0;})&&_.any(props,function(prop){return prop.amount<0;})){line.balance.type=0;}});},_formatLine:function(type,data){var line=this.lines[_.uniqueId('rline')]=_.extend(data,{type:type,reconciled:false,mode:'inactive',offset:0,limitMoveLines:this.limitMoveLines,filter:"",reconcileModels:this.reconcileModels,account_id:this._formatNameGet([data.account_id,data.account_name]),st_line:data,visible:true});this._formatLineProposition(line,line.reconciliation_proposition);if(!line.reconciliation_proposition.length){delete line.reconciliation_proposition;}
return this._computeLine(line);},_formatLineProposition:function(line,props){var self=this;this._super(line,props);if(props.length){_.each(props,function(prop){var tmp_value=prop.debit||prop.credit;prop.credit=prop.credit!==0?0:tmp_value;prop.debit=prop.debit!==0?0:tmp_value;prop.amount=-prop.amount;prop.journal_id=self._formatNameGet(prop.journal_id||line.journal_id);});}},_formatQuickCreate:function(line,values){var self=this;if(values&&values.journal_id===undefined&&line&&line.createForm&&line.createForm.journal_id){values.journal_id=line.createForm.journal_id;}
return this._super(line,values)},_isDisplayedProposition:function(prop){return!!prop.journal_id&&this._super(prop);},_isValid:function(prop){return prop.journal_id&&this._super(prop);},_performMoveLine:function(handle){var line=this.getLine(handle);var excluded_ids=_.compact(_.flatten(_.map(this.lines,function(line){return _.map(line.reconciliation_proposition,function(prop){return!prop.partial_reconcile&&_.isNumber(prop.id)?prop.id:null;});})));var filter=line.filter||"";var limit=this.limitMoveLines;var offset=line.offset;if(line.limit_override){limit=line.limit_override;offset=0;}
var args=[line.account_id.id,line.partner_id,excluded_ids,filter,offset,limit];return this._rpc({model:'account.reconciliation.widget',method:'get_move_lines_for_manual_reconciliation',args:args,context:this.context,}).then(this._formatMoveLine.bind(this,handle));},_formatToProcessReconciliation:function(line,prop){var result=this._super(line,prop);result['date']=prop.date;return result;},});return{StatementModel:StatementModel,ManualModel:ManualModel,};});;

/* /account/static/src/js/reconciliation/reconciliation_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('account.ReconciliationRenderer',function(require){"use strict";var Widget=require('web.Widget');var FieldManagerMixin=require('web.FieldManagerMixin');var relational_fields=require('web.relational_fields');var basic_fields=require('web.basic_fields');var core=require('web.core');var time=require('web.time');var session=require('web.session');var qweb=core.qweb;var _t=core._t;var StatementRenderer=Widget.extend(FieldManagerMixin,{template:'reconciliation.statement',events:{'click div:first h1.statement_name':'_onClickStatementName',"click *[rel='do_action']":"_onDoAction",'click button.js_load_more':'_onLoadMore','blur .statement_name_edition > input':'_onValidateName','keyup .statement_name_edition > input':'_onKeyupInput'},init:function(parent,model,state){this._super(parent);this.model=model;this._initialState=state;},start:function(){var self=this;var defs=[this._super.apply(this,arguments)];this.time=Date.now();this.$progress=this.$('.progress');this.clickStatementName=this._initialState.bank_statement_id?true:false;if(this._initialState.bank_statement_id){var def=this.model.makeRecord("account.bank.statement",[{type:'char',name:'name',attrs:{string:""},value:this._initialState.bank_statement_id.display_name}]).then(function(recordID){self.handleNameRecord=recordID;self.name=new basic_fields.FieldChar(self,'name',self.model.get(self.handleNameRecord),{mode:'edit'});self.name.appendTo(self.$('.statement_name_edition')).then(function(){self.name.$el.addClass('o_required_modifier');});self.$('.statement_name').text(self._initialState.bank_statement_id.display_name);});defs.push(def);}
this.$('h1.statement_name').text(this._initialState.title||_t('No Title'));return $.when.apply($,defs);},destroy:function(){this._super();$('body').off('keyup',this.enterHandler);},hideLoadMoreButton:function(){this.$('.js_load_more').hide();},showRainbowMan:function(state){var dt=Date.now()-this.time;var $done=$(qweb.render("reconciliation.done",{'duration':moment(dt).utc().format(time.getLangTimeFormat()),'number':state.valuenow,'timePerTransaction':Math.round(dt/1000/state.valuemax),'context':state.context,}));$done.find('.button_close_statement').click(this._onCloseBankStatement.bind(this));$done.find('.button_back_to_statement').click(this._onGoToBankStatement.bind(this));this.$el.children().hide();if(session.show_effect){this.trigger_up('show_effect',{type:'rainbow_man',fadeout:'no',message:$done,});this.$el.css('min-height','450px');}else{$done.appendTo(this.$el);}},update:function(state){var self=this;this.$progress.find('.valuenow').text(state.valuenow);this.$progress.find('.valuemax').text(state.valuemax);this.$progress.find('.progress-bar').attr('aria-valuenow',state.valuenow).attr('aria-valuemax',state.valuemax).css('width',(state.valuenow/state.valuemax*100)+'%');if(state.valuenow===state.valuemax&&!this.$('.done_message').length){this.showRainbowMan(state);}
if(state.notifications){this._renderNotifications(state.notifications);}
this.$('.statement_name, .statement_name_edition').toggle();this.$('h1.statement_name').text(state.title||_t('No Title'));},_renderNotifications:function(notifications){this.$(".notification_area").empty();for(var i=0;i<notifications.length;i++){var $notification=$(qweb.render("reconciliation.notification",notifications[i])).hide();$notification.appendTo(this.$(".notification_area")).slideDown(300);}},_onClickStatementName:function(){if(this._initialState.bank_statement_id){this.$('.statement_name, .statement_name_edition').toggle();this.$('.statement_name_edition input').focus();}},_onCloseBankStatement:function(e){this.trigger_up('close_statement');},_onDoAction:function(e){e.preventDefault();var name=e.currentTarget.dataset.action_name;var model=e.currentTarget.dataset.model;var ids=e.currentTarget.dataset.ids.split(",").map(Number);this.do_action({name:name,res_model:model,domain:[['id','in',ids]],views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',view_type:"list",view_mode:"list"});},_onGoToBankStatement:function(e){var journalId=$(e.target).attr('data_journal_id');if(journalId){journalId=parseInt(journalId);}
this.do_action({name:'Bank Statements',res_model:'account.bank.statement',views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',context:{search_default_journal_id:journalId},view_type:'list',view_mode:'form',});},_onLoadMore:function(e){this.trigger_up('load_more');},_onValidateName:function(){var name=this.$('.statement_name_edition input').val().trim();this.trigger_up('change_name',{'data':name});},_onKeyupInput:function(event){if(event.which===$.ui.keyCode.ENTER){this.$('.statement_name_edition input').blur();}},});var LineRenderer=Widget.extend(FieldManagerMixin,{template:"reconciliation.line",events:{'click .accounting_view caption .o_buttons button':'_onValidate','click .accounting_view thead td':'_onTogglePanel','click .accounting_view tfoot td:not(.cell_left,.cell_right)':'_onShowPanel','click tfoot .cell_left, tfoot .cell_right':'_onSearchBalanceAmount','change input.filter':'_onFilterChange','click .match .load-more a':'_onLoadMore','click .match .mv_line td':'_onSelectMoveLine','click .accounting_view tbody .mv_line td':'_onSelectProposition','click .o_reconcile_models button':'_onQuickCreateProposition','click .create .add_line':'_onCreateProposition','click .accounting_view .line_info_button.fa-exclamation-triangle':'_onTogglePartialReconcile','click .reconcile_model_create':'_onCreateReconcileModel','click .reconcile_model_edit':'_onEditReconcileModel','keyup input':'_onInputKeyup','blur input':'_onInputKeyup',},custom_events:_.extend({},FieldManagerMixin.custom_events,{'field_changed':'_onFieldChanged',}),_avoidFieldUpdate:{},MV_LINE_DEBOUNCE:200,init:function(parent,model,state){this._super(parent);FieldManagerMixin.init.call(this);this.model=model;this._initialState=state;if(this.MV_LINE_DEBOUNCE){this._onSelectMoveLine=_.debounce(this._onSelectMoveLine,this.MV_LINE_DEBOUNCE,true);}else{this._onSelectMoveLine=this._onSelectMoveLine;}},start:function(){var self=this;var def1=this._makePartnerRecord(this._initialState.st_line.partner_id,this._initialState.st_line.partner_name).then(function(recordID){self.fields={partner_id:new relational_fields.FieldMany2One(self,'partner_id',self.model.get(recordID),{mode:'edit',attrs:{placeholder:self._initialState.st_line.communication_partner_name||'',}})};self.fields.partner_id.appendTo(self.$('.accounting_view caption'));});var def3=session.user_has_group('analytic.group_analytic_tags').then(function(has_group){self.group_tags=has_group;});var def4=session.user_has_group('analytic.group_analytic_accounting').then(function(has_group){self.group_acc=has_group;});$('<span class="line_info_button fa fa-info-circle"/>').appendTo(this.$('thead .cell_info_popover')).attr("data-content",qweb.render('reconciliation.line.statement_line.details',{'state':this._initialState}));this.$el.popover({'selector':'.line_info_button','placement':'left','container':this.$el,'html':true,'trigger':'hover','animation':false,'toggle':'popover'});var def2=this._super.apply(this,arguments);return $.when(def1,def2,def3,def4);},update:function(state){var self=this;this.$('caption .o_buttons button.o_validate').toggleClass('d-none',!!state.balance.type);this.$('caption .o_buttons button.o_reconcile').toggleClass('d-none',state.balance.type<=0);this.$('caption .o_buttons .o_no_valid').toggleClass('d-none',state.balance.type>=0);this._makePartnerRecord(state.st_line.partner_id,state.st_line.partner_name).then(function(recordID){self.fields.partner_id.reset(self.model.get(recordID));self.$el.attr('data-partner',state.st_line.partner_id);});this.$('.create, .match').each(function(){var $panel=$(this);$panel.css('-webkit-transition','none');$panel.css('-moz-transition','none');$panel.css('-o-transition','none');$panel.css('transition','none');$panel.css('max-height',$panel.height());$panel.css('-webkit-transition','');$panel.css('-moz-transition','');$panel.css('-o-transition','');$panel.css('transition','');});this.$el.data('mode',state.mode).attr('data-mode',state.mode);this.$('.create, .match').each(function(){$(this).removeAttr('style');});var $props=this.$('.accounting_view tbody').empty();var props=[];var partialDebitProp;var partialCreditProp;var balance=state.balance.amount_currency;_.each(state.reconciliation_proposition,function(prop){if(prop.display){props.push(prop);if(!prop.display_new&&balance<0&&prop.amount>0&&balance+prop.amount>0)
partialDebitProp=prop;else if(!prop.display_new&&balance>0&&prop.amount<0&&balance+prop.amount<0)
partialCreditProp=prop;}});_.each(props,function(line){line.display_triangle=(line.already_paid===false&&(((state.balance.amount_currency<0||line.partial_reconcile)&&partialDebitProp&&partialDebitProp===line)||((state.balance.amount_currency>0||line.partial_reconcile)&&partialCreditProp&&partialCreditProp===line)));var $line=$(qweb.render("reconciliation.line.mv_line",{'line':line,'state':state}));if(!isNaN(line.id)){$('<span class="line_info_button fa fa-info-circle"/>').appendTo($line.find('.cell_info_popover')).attr("data-content",qweb.render('reconciliation.line.mv_line.details',{'line':line}));}
$props.append($line);});var stateMvLines=state.mv_lines||[];var recs_count=stateMvLines.length>0?stateMvLines[0].recs_count:0;var remaining=recs_count-stateMvLines.length;var $mv_lines=this.$('.match table tbody').empty();_.each(stateMvLines,function(line){var $line=$(qweb.render("reconciliation.line.mv_line",{'line':line,'state':state}));if(!isNaN(line.id)){$('<span class="line_info_button fa fa-info-circle"/>').appendTo($line.find('.cell_info_popover')).attr("data-content",qweb.render('reconciliation.line.mv_line.details',{'line':line}));}
$mv_lines.append($line);});this.$('.match div.load-more').toggle(remaining>0);this.$('.match div.load-more span').text(remaining);this.$('.match').css('max-height',!stateMvLines.length&&!state.filter.length?'0px':'');this.$('.popover').remove();this.$('table tfoot').html(qweb.render("reconciliation.line.balance",{'state':state}));if(_.str.strip(this.$('input.filter').val())!==state.filter){this.$('input.filter').val(state.filter);}
if(state.createForm){if(!this.fields.account_id){this._renderCreate(state);}
var data=this.model.get(this.handleCreateRecord).data;this.model.notifyChanges(this.handleCreateRecord,state.createForm).then(function(){self.model.notifyChanges(self.handleCreateRecord,{analytic_tag_ids:{operation:'REPLACE_WITH',ids:[]}}).then(function(){var defs=[];_.each(state.createForm.analytic_tag_ids,function(tag){defs.push(self.model.notifyChanges(self.handleCreateRecord,{analytic_tag_ids:{operation:'ADD_M2M',ids:tag}}));});$.when.apply($,defs).then(function(){var record=self.model.get(self.handleCreateRecord);_.each(self.fields,function(field,fieldName){if(self._avoidFieldUpdate[fieldName])return;if(fieldName==="partner_id")return;if((data[fieldName]||state.createForm[fieldName])&&!_.isEqual(state.createForm[fieldName],data[fieldName])){field.reset(record);}
if(fieldName==='tax_id'){if(!state.createForm[fieldName]||state.createForm[fieldName].amount_type==="group"){$('.create_force_tax_included').addClass('d-none');}
else{$('.create_force_tax_included').removeClass('d-none');}}});});});});if(state.createForm.tax_id){this.$('.create_force_tax_included input').attr('disabled',state.createForm.tax_id.price_include);}}
this.$('.create .add_line').toggle(!!state.balance.amount_currency);},_destroyPopover:function($el){var popover=$el.data('bs.popover');if(popover){popover.dispose();}},_makePartnerRecord:function(partnerID,partnerName){var field={relation:'res.partner',type:'many2one',name:'partner_id',};if(partnerID){field.value=[partnerID,partnerName];}
return this.model.makeRecord('account.bank.statement.line',[field],{partner_id:{domain:["|",["is_company","=",true],["parent_id","=",false],"|",["customer","=",true],["supplier","=",true]],options:{no_open:true}}});},_renderCreate:function(state){var self=this;this.model.makeRecord('account.bank.statement.line',[{relation:'account.account',type:'many2one',name:'account_id',domain:[['company_id','=',state.st_line.company_id],['deprecated','=',false]],},{relation:'account.journal',type:'many2one',name:'journal_id',domain:[['company_id','=',state.st_line.company_id],['type','=','general']],},{relation:'account.tax',type:'many2one',name:'tax_id',domain:[['company_id','=',state.st_line.company_id]],},{relation:'account.analytic.account',type:'many2one',name:'analytic_account_id',},{relation:'account.analytic.tag',type:'many2many',name:'analytic_tag_ids',},{type:'boolean',name:'force_tax_included',},{type:'char',name:'label',},{type:'float',name:'amount',},{type:'char',name:'date',}],{account_id:{string:_t("Account"),},label:{string:_t("Label")},amount:{string:_t("Account")},}).then(function(recordID){self.handleCreateRecord=recordID;var record=self.model.get(self.handleCreateRecord);self.fields.account_id=new relational_fields.FieldMany2One(self,'account_id',record,{mode:'edit'});self.fields.journal_id=new relational_fields.FieldMany2One(self,'journal_id',record,{mode:'edit'});self.fields.tax_id=new relational_fields.FieldMany2One(self,'tax_id',record,{mode:'edit',additionalContext:{append_type_to_tax_name:true}});self.fields.analytic_account_id=new relational_fields.FieldMany2One(self,'analytic_account_id',record,{mode:'edit'});self.fields.analytic_tag_ids=new relational_fields.FieldMany2ManyTags(self,'analytic_tag_ids',record,{mode:'edit'});self.fields.force_tax_included=new basic_fields.FieldBoolean(self,'force_tax_included',record,{mode:'edit'});self.fields.label=new basic_fields.FieldChar(self,'label',record,{mode:'edit'});self.fields.amount=new basic_fields.FieldFloat(self,'amount',record,{mode:'edit'});self.fields.date=new basic_fields.FieldDate(self,'date',record,{mode:'edit'});var $create=$(qweb.render("reconciliation.line.create",{'state':state,'group_tags':self.group_tags,'group_acc':self.group_acc}));self.fields.account_id.appendTo($create.find('.create_account_id .o_td_field')).then(addRequiredStyle.bind(self,self.fields.account_id));self.fields.journal_id.appendTo($create.find('.create_journal_id .o_td_field'));self.fields.tax_id.appendTo($create.find('.create_tax_id .o_td_field'));self.fields.analytic_account_id.appendTo($create.find('.create_analytic_account_id .o_td_field'));self.fields.analytic_tag_ids.appendTo($create.find('.create_analytic_tag_ids .o_td_field'));self.fields.force_tax_included.appendTo($create.find('.create_force_tax_included .o_td_field'))
self.fields.label.appendTo($create.find('.create_label .o_td_field')).then(addRequiredStyle.bind(self,self.fields.label));self.fields.amount.appendTo($create.find('.create_amount .o_td_field')).then(addRequiredStyle.bind(self,self.fields.amount));self.fields.date.appendTo($create.find('.create_date .o_td_field'))
self.$('.create').append($create);function addRequiredStyle(widget){widget.$el.addClass('o_required_modifier');}});},_onCreateReconcileModel:function(event){event.preventDefault();this.do_action({type:'ir.actions.act_window',res_model:'account.reconcile.model',views:[[false,'form']],target:'current'});},_onEditReconcileModel:function(event){event.preventDefault();this.do_action({type:'ir.actions.act_window',res_model:'account.reconcile.model',views:[[false,'list'],[false,'form']],view_type:"list",view_mode:"list",target:'current'});},_onFieldChanged:function(event){event.stopPropagation();var fieldName=event.target.name;if(fieldName==='partner_id'){var partner_id=event.data.changes.partner_id;this.trigger_up('change_partner',{'data':partner_id});}else{if(event.data.changes.amount&&isNaN(event.data.changes.amount)){return;}
this.trigger_up('update_proposition',{'data':event.data.changes});}},_onTogglePanel:function(){var mode=this.$el.data('mode')==='inactive'?'match':'inactive';this.trigger_up('change_mode',{'data':mode});},_onSearchBalanceAmount:function(){this.trigger_up('search_balance_amount');},_onShowPanel:function(){var mode=(this.$el.data('mode')==='inactive'||this.$el.data('mode')==='match')?'create':'match';this.trigger_up('change_mode',{'data':mode});},_onFilterChange:function(event){this.trigger_up('change_filter',{'data':_.str.strip($(event.target).val())});},_onInputKeyup:function(event){var target_partner_id=$(event.target).parents('[name="partner_id"]');if(target_partner_id.length===1){return;}
if(event.keyCode===13){var created_lines=_.findWhere(this.model.lines,{mode:'create'});if(created_lines&&created_lines.balance.amount){this._onCreateProposition();}
return;}
var self=this;for(var fieldName in this.fields){var field=this.fields[fieldName];if(!field.$el.is(event.target)){continue;}
this._avoidFieldUpdate[field.name]=event.type!=='focusout';field.value=false;field._setValue($(event.target).val()).then(function(){self._avoidFieldUpdate[field.name]=false;});break;}},_onLoadMore:function(ev){ev.preventDefault();this.trigger_up('change_offset',{'data':1});},_onSelectMoveLine:function(event){var $el=$(event.target);$el.prop('disabled',true);this._destroyPopover($el);var moveLineId=$el.closest('.mv_line').data('line-id');this.trigger_up('add_proposition',{'data':moveLineId});},_onSelectProposition:function(event){var $el=$(event.target);this._destroyPopover($el);var moveLineId=$el.closest('.mv_line').data('line-id');this.trigger_up('remove_proposition',{'data':moveLineId});},_onQuickCreateProposition:function(event){document.activeElement&&document.activeElement.blur();this.trigger_up('quick_create_proposition',{'data':$(event.target).data('reconcile-model-id')});},_onCreateProposition:function(){document.activeElement&&document.activeElement.blur();var invalid=[];_.each(this.fields,function(field){if(!field.isValid()){invalid.push(field.string);}});if(invalid.length){this.do_warn(_t("Some fields are undefined"),invalid.join(', '));return;}
this.trigger_up('create_proposition');},_onValidate:function(){this.trigger_up('validate');},_onTogglePartialReconcile:function(e){e.stopPropagation();var popover=$(e.target).data('bs.popover');popover&&popover.dispose();this.trigger_up('toggle_partial_reconcile');}});var ManualRenderer=StatementRenderer.extend({template:"reconciliation.manual.statement",_onClickStatementName:function(){}});var ManualLineRenderer=LineRenderer.extend({template:"reconciliation.manual.line",removeProposition:function(handle,id){if(!id){return $.when();}
return this._super(handle,id);},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){var defs=[];var def;if(self._initialState.partner_id){def=self._makePartnerRecord(self._initialState.partner_id,self._initialState.partner_name).then(function(recordID){self.fields.partner_id=new relational_fields.FieldMany2One(self,'partner_id',self.model.get(recordID),{mode:'readonly'});});defs.push(def);}else{def=self.model.makeRecord('account.move.line',[{relation:'account.account',type:'many2one',name:'account_id',value:[self._initialState.account_id.id,self._initialState.account_id.display_name],}]).then(function(recordID){self.fields.title_account_id=new relational_fields.FieldMany2One(self,'account_id',self.model.get(recordID),{mode:'readonly'});});defs.push(def);}
return $.when.apply($,defs).then(function(){if(!self.fields.title_account_id){return self.fields.partner_id.prependTo(self.$('.accounting_view thead td:eq(1) span:first'));}else{self.fields.partner_id.destroy();return self.fields.title_account_id.appendTo(self.$('.accounting_view thead td:eq(1) span:first'));}});});},update:function(state){this._super(state);var props=_.filter(state.reconciliation_proposition,{'display':true});if(!props.length){var $line=$(qweb.render("reconciliation.line.mv_line",{'line':{},'state':state}));this.$('.accounting_view tbody').append($line);}},_renderCreate:function(state){this._super(state);this.$('.create .create_journal_id').show();this.$('.create .create_date').removeClass('d-none')
this.$('.create .create_journal_id .o_input').addClass('o_required_modifier');},});return{StatementRenderer:StatementRenderer,ManualRenderer:ManualRenderer,LineRenderer:LineRenderer,ManualLineRenderer:ManualLineRenderer,};});;

/* /account/static/src/js/reconciliation/tour_reconciliation.js defined in bundle 'web.assets_backend' */
odoo.define('account.tour_bank_statement_reconciliation',function(require){'use strict';var core=require('web.core');var rpc=require('web.rpc');var Tour=require('web_tour.tour');Tour.register('bank_statement_reconciliation',{test:true,},[{content:"reconcile the line",trigger:'.o_reconciliation_line:nth-child(1) .o_reconcile:visible',},{content:"open the last line in match mode to test the partial reconciliation",extra_trigger:'.o_reconciliation_line:first[data-mode="match"]',trigger:'.o_reconciliation_line .cell_label:contains("First 2000 $ of"):contains("/0001"):last'},{content:"click on partial reconcile",trigger:'.o_reconciliation_line:contains("First 2000 $ of"):contains("/0001"):last .accounting_view .do_partial_reconcile_true'},{content:"reconcile the line",trigger:'.o_reconciliation_line:contains("First 2000 $ of"):contains("/0001"):last .o_reconcile:visible',},{content:"change the partner of the second line",trigger:'.o_reconciliation_line:nth-child(2) .o_field_many2one input',run:'text Deco'},{content:"select Deco Addict ",extra_trigger:'.ui-autocomplete:visible li:eq(1):contains(Create "Deco")',trigger:'.ui-autocomplete:visible li:contains(Deco Addict)',},{content:"use filter",trigger:'.o_reconciliation_line:nth-child(2) .match .match_controls .filter',run:'text 4610'},{content:"select a line linked to Deco Addict ",trigger:".o_reconciliation_line:nth-child(2) .match .line_info_button[data-content*='Deco Addict']"},{content:"deselect the line",trigger:'.o_reconciliation_line:nth-child(2) .accounting_view tbody .cell_label:first',run:function(){$('.o_reconciliation_line:nth-child(2) .accounting_view tbody .cell_label:first').trigger('click');}},{content:"create a write-off",extra_trigger:'.o_reconciliation_line:nth-child(2) .accounting_view tbody:not(:has(.cell_label))',trigger:'.o_reconciliation_line:nth-child(2) .accounting_view tfoot .cell_label'},{content:"enter an account",trigger:'.o_reconciliation_line:nth-child(2) .o_field_many2one[name="account_id"] input',run:'text 100000'},{content:"select the first account",extra_trigger:'.ui-autocomplete:visible li:eq(1):contains(Create "100000")',trigger:'.ui-autocomplete:visible li:contains(100000)',},{content:"reconcile the line with the write-off",trigger:'.o_reconciliation_line:nth-child(2) .o_reconcile:visible',},]);});;

/* /account/static/src/js/account_payment_field.js defined in bundle 'web.assets_backend' */
odoo.define('account.payment',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var field_registry=require('web.field_registry');var field_utils=require('web.field_utils');var QWeb=core.qweb;var ShowPaymentLineWidget=AbstractField.extend({events:_.extend({'click .outstanding_credit_assign':'_onOutstandingCreditAssign',},AbstractField.prototype.events),supportedFieldTypes:['char'],isSet:function(){return true;},_render:function(){var self=this;var info=JSON.parse(this.value);if(!info){this.$el.html('');return;}
_.each(info.content,function(k,v){k.index=v;k.amount=field_utils.format.float(k.amount,{digits:k.digits});if(k.date){k.date=field_utils.format.date(field_utils.parse.date(k.date,{},{isUTC:true}));}});this.$el.html(QWeb.render('ShowPaymentInfo',{lines:info.content,outstanding:info.outstanding,title:info.title}));_.each(this.$('.js_payment_info'),function(k,v){var content=info.content[v];var options={content:function(){var $content=$(QWeb.render('PaymentPopOver',{name:content.name,journal_name:content.journal_name,date:content.date,amount:content.amount,currency:content.currency,position:content.position,payment_id:content.payment_id,move_id:content.move_id,ref:content.ref,account_payment_id:content.account_payment_id,invoice_id:content.invoice_id,invoice_view_id:content.invoice_view_id,}));$content.filter('.js_unreconcile_payment').on('click',self._onRemoveMoveReconcile.bind(self));$content.filter('.js_open_payment').on('click',self._onOpenPayment.bind(self));return $content;},html:true,placement:'left',title:'Payment Information',trigger:'focus',delay:{"show":0,"hide":100},container:$(k).parent(),};$(k).popover(options);});},_onOpenPayment:function(event){var invoiceId=parseInt($(event.target).attr('invoice-id'));var invoiceViewId=parseInt($(event.target).attr('invoice-view-id'));var paymentId=parseInt($(event.target).attr('payment-id'));var moveId=parseInt($(event.target).attr('move-id'));var res_model;var id;var views=[[false,'form']];if(invoiceId!==undefined&&!isNaN(invoiceId)){res_model="account.invoice";id=invoiceId;if(invoiceViewId!==undefined&&!isNaN(invoiceViewId)){views=[[invoiceViewId,'form']];}}else if(paymentId!==undefined&&!isNaN(paymentId)){res_model="account.payment";id=paymentId;}else if(moveId!==undefined&&!isNaN(moveId)){res_model="account.move";id=moveId;}
if(res_model&&id){this.do_action({type:'ir.actions.act_window',res_model:res_model,res_id:id,views:views,target:'current'});}},_onOutstandingCreditAssign:function(event){event.stopPropagation();event.preventDefault();var self=this;var id=$(event.target).data('id')||false;this._rpc({model:'account.invoice',method:'assign_outstanding_credit',args:[JSON.parse(this.value).invoice_id,id],}).then(function(){self.trigger_up('reload');});},_onRemoveMoveReconcile:function(event){var self=this;var paymentId=parseInt($(event.target).attr('payment-id'));if(paymentId!==undefined&&!isNaN(paymentId)){this._rpc({model:'account.move.line',method:'remove_move_reconcile',args:[paymentId,{'invoice_id':this.res_id}]}).then(function(){self.trigger_up('reload');});}},});field_registry.add('payment',ShowPaymentLineWidget);return{ShowPaymentLineWidget:ShowPaymentLineWidget};});;

/* /account/static/src/js/bank_statement.js defined in bundle 'web.assets_backend' */
odoo.define('account.bank_statement',function(require){"use strict";var KanbanController=require("web.KanbanController");var ListController=require("web.ListController");var includeDict={renderButtons:function(){this._super.apply(this,arguments);if(this.modelName==="account.bank.statement"){var data=this.model.get(this.handle);if(data.context.journal_type!=='cash'){this.$buttons.find('button.o_button_import').hide();}}}};KanbanController.include(includeDict);ListController.include(includeDict);});;

/* /account/static/src/js/section_and_note_fields_backend.js defined in bundle 'web.assets_backend' */
odoo.define('account.section_and_note_backend',function(require){"use strict";var pyUtils=require('web.py_utils');var core=require('web.core');var _t=core._t;var FieldChar=require('web.basic_fields').FieldChar;var FieldOne2Many=require('web.relational_fields').FieldOne2Many;var fieldRegistry=require('web.field_registry');var FieldText=require('web.basic_fields').FieldText;var ListRenderer=require('web.ListRenderer');var SectionAndNoteListRenderer=ListRenderer.extend({_renderBodyCell:function(record,node,index,options){var $cell=this._super.apply(this,arguments);var isSection=record.data.display_type==='line_section';var isNote=record.data.display_type==='line_note';if(isSection||isNote){if(node.attrs.widget==="handle"){return $cell;}else if(node.attrs.name==="name"){var nbrColumns=this._getNumberOfCols();if(this.handleField){nbrColumns--;}
if(this.addTrashIcon){nbrColumns--;}
$cell.attr('colspan',nbrColumns);}else{return $cell.addClass('o_hidden');}}
return $cell;},_renderRow:function(record,index){var $row=this._super.apply(this,arguments);if(record.data.display_type){$row.addClass('o_is_'+record.data.display_type);}
return $row;},_renderView:function(){var def=this._super();this.$el.find('> table').addClass('o_section_and_note_list_view');return def;},_onAddRecord:function(ev){ev.preventDefault();ev.stopPropagation();var self=this;this.unselectRow().then(function(){var context=ev.currentTarget.dataset.context;var pricelistId=self._getPricelistId();if(context&&pyUtils.py_eval(context).open_product_configurator){self._rpc({model:'ir.model.data',method:'xmlid_to_res_id',kwargs:{xmlid:'sale.sale_product_configurator_view_form'},}).then(function(res_id){self.do_action({name:_t('Configure a product'),type:'ir.actions.act_window',res_model:'sale.product.configurator',views:[[res_id,'form']],target:'new',context:{'default_pricelist_id':pricelistId}},{on_close:function(products){if(products&&products!=='special'){self.trigger_up('add_record',{context:self._productsToRecords(products),forceEditable:"bottom",allowWarning:true,onSuccess:function(){self.unselectRow();}});}}});});}else{self.trigger_up('add_record',{context:context&&[context]});}});},_getPricelistId:function(){var saleOrderForm=this.getParent()&&this.getParent().getParent();var stateData=saleOrderForm&&saleOrderForm.state&&saleOrderForm.state.data;var pricelist_id=stateData.pricelist_id&&stateData.pricelist_id.data&&stateData.pricelist_id.data.id;return pricelist_id;},_productsToRecords:function(products){var records=[];_.each(products,function(product){var record={default_product_id:product.product_id,default_product_uom_qty:product.quantity};if(product.no_variant_attribute_values){var default_product_no_variant_attribute_values=[];_.each(product.no_variant_attribute_values,function(attribute_value){default_product_no_variant_attribute_values.push([4,parseInt(attribute_value.value)]);});record['default_product_no_variant_attribute_value_ids']=default_product_no_variant_attribute_values;}
if(product.product_custom_attribute_values){var default_custom_attribute_values=[];_.each(product.product_custom_attribute_values,function(attribute_value){default_custom_attribute_values.push([0,0,{attribute_value_id:attribute_value.attribute_value_id,custom_value:attribute_value.custom_value}]);});record['default_product_custom_attribute_value_ids']=default_custom_attribute_values;}
records.push(record);});return records;}});var SectionAndNoteFieldOne2Many=FieldOne2Many.extend({_getRenderer:function(){if(this.view.arch.tag==='tree'){return SectionAndNoteListRenderer;}
return this._super.apply(this,arguments);},});var SectionAndNoteFieldText=function(parent,name,record,options){var isSection=record.data.display_type==='line_section';var Constructor=isSection?FieldChar:FieldText;return new Constructor(parent,name,record,options);};fieldRegistry.add('section_and_note_one2many',SectionAndNoteFieldOne2Many);fieldRegistry.add('section_and_note_text',SectionAndNoteFieldText);});;

/* /account/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('account.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('account_tour',{'skip_enabled':true,},[{trigger:".o_form_readonly .o_invoice_validate",extra_trigger:'.o_invoice_form',content:_t("Click to <b>validate your invoice.</b> A reference will be assigned to this invoice and you will not be able to modify it anymore."),position:"right"},{trigger:".o_invoice_send",extra_trigger:'.o_invoice_form',content:_t("Click to <b>send the invoice by email.</b>"),position:"bottom"},{trigger:".o_mail_send",content:_t("Click to <b>send the invoice.</b>"),position:"bottom"}]);});;

/* /account/static/src/js/bills_tree_upload.js defined in bundle 'web.assets_backend' */
odoo.define('account.bills.tree',function(require){"use strict";var core=require('web.core');var ListController=require('web.ListController');var ListView=require('web.ListView');var viewRegistry=require('web.view_registry');var qweb=core.qweb;var BillsListController=ListController.extend({buttons_template:'BillsListView.buttons',renderButtons:function(){this._super.apply(this,arguments);if(this.$buttons){var self=this;this.$buttons.on('click','.o_button_upload_bill',function(){var state=self.model.get(self.handle,{raw:true});var context=state.getContext();context['type']=context.default_type||'in_invoice';self.do_action({type:'ir.actions.act_window',res_model:'account.invoice.import.wizard',target:'new',views:[[false,'form']],context:context,});});}}});var BillsListView=ListView.extend({config:_.extend({},ListView.prototype.config,{Controller:BillsListController,}),});viewRegistry.add('account_bills_tree',BillsListView);});;

/* /account_bank_statement_import/static/src/js/account_bank_statement_import.js defined in bundle 'web.assets_backend' */
odoo.define('account_bank_statement_import.import',function(require){"use strict";var core=require('web.core');var BaseImport=require('base_import.import');var _t=core._t;BaseImport.DataImport.include({renderImportLink:function(){this._super();if(this.res_model=='account.bank.statement'){this.$(".import-link").prop({"text":_t(" Import Template for Bank Statements"),"href":"/account_bank_statement_import/static/csv/account.bank.statement.csv"});this.$(".template-import").removeClass('d-none');}},});});;

/* /payment/static/src/js/payment_translations.js defined in bundle 'web.assets_backend' */
var _t=function(x){return x;};_t("Published");_t("Publish");;

/* /sale/static/src/js/sale.js defined in bundle 'web.assets_backend' */
odoo.define('sale.sales_team_dashboard',function(require){"use strict";var core=require('web.core');var KanbanRecord=require('web.KanbanRecord');var _t=core._t;KanbanRecord.include({events:_.defaults({'click .sales_team_target_definition':'_onSalesTeamTargetClick',},KanbanRecord.prototype.events),_onSalesTeamTargetClick:function(ev){ev.preventDefault();var self=this;this.$target_input=$('<input>');this.$('.o_kanban_primary_bottom:last').html(this.$target_input);this.$('.o_kanban_primary_bottom:last').prepend(_t("Set an invoicing target: "));this.$target_input.focus();this.$target_input.on({blur:this._onSalesTeamTargetSet.bind(this),keydown:function(ev){if(ev.keyCode===$.ui.keyCode.ENTER){self._onSalesTeamTargetSet();}},});},_onSalesTeamTargetSet:function(){var self=this;var value=Number(this.$target_input.val());if(isNaN(value)){this.do_warn(_t("Wrong value entered!"),_t("Only Integer Value should be valid."));}else{this.trigger_up('kanban_record_update',{invoiced_target:value});this.trigger_up('reload');}},});});;

/* /sale/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('sale.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('sale_tour',{url:"/web",},[tour.STEPS.SHOW_APPS_MENU_ITEM,{trigger:'.o_app[data-menu-xmlid="sale.sale_menu_root"]',content:_t('Organize your sales activities with the <b>Sales Management app</b>.'),position:'right',edition:'community'},{trigger:'.o_app[data-menu-xmlid="sale.sale_menu_root"]',content:_t('Organize your sales activities with the <b>Sales Management app</b>.'),position:'bottom',edition:'enterprise'},{trigger:".o_list_button_add",extra_trigger:".o_sale_order",content:_t("Let's create a new quotation.<br/><i>Note that colored buttons usually point to the next logical actions.</i>"),position:"bottom",},{trigger:".o_form_editable .o_field_many2one[name='partner_id']",extra_trigger:".o_sale_order",content:_t("Write the name of your customer to create one on the fly, or select an existing one."),position:"bottom",run:function(actions){actions.text("Agrolait",this.$anchor.find("input"));},},{trigger:".ui-menu-item > a",auto:true,in_modal:false,},{trigger:".o_field_x2many_list_row_add > a",extra_trigger:".o_field_many2one[name='partner_id'] .o_external_button",content:_t("Click here to add some products or services to your quotation."),position:"bottom",},{trigger:".o_form_editable .o_field_many2one[name='product_id']",extra_trigger:".o_sale_order",content:_t("Select a product, or create a new one on the fly."),position:"right",run:function(actions){actions.text("Chair",this.$anchor.find("input"));},},{trigger:".ui-menu-item > a",auto:true,in_modal:false,run:function(actions){actions.auto();if($('.modal-dialog:has(div.o_dialog_warning) footer.modal-footer .btn-primary').length){$('.modal-dialog:has(div.o_dialog_warning) footer.modal-footer .btn-primary').trigger('click');}},},{trigger:".o_form_button_save",extra_trigger:".o_sale_order",content:_t("Once your quotation is ready, you can save, print or send it by email."),position:"right",id:"form_button_save_clicked"},{trigger:".o_sale_print",extra_trigger:".o_sale_order.o_form_readonly",content:_t("<b>Print this quotation to preview it.</b>"),position:"bottom"},{trigger:".breadcrumb-item:not(.active):last",extra_trigger:".o_sale_order [data-value='sent'].btn-primary",content:_t("Use the breadcrumbs to <b>go back to preceeding screens</b>."),position:"bottom"},{trigger:'li a[data-menu-xmlid="sale.sale_order_menu"], .oe_secondary_menu_section[data-menu-xmlid="sale.sale_order_menu"]',content:_t("Use this menu to access quotations, sales orders and customers."),edition:"enterprise",position:"bottom"}]);});;

/* /sale/static/src/js/product_configurator_mixin.js defined in bundle 'web.assets_backend' */
odoo.define('sale.ProductConfiguratorMixin',function(require){'use strict';var concurrency=require('web.concurrency');var core=require('web.core');var utils=require('web.utils');var ajax=require('web.ajax');var _t=core._t;var ProductConfiguratorMixin={events:{'change .css_attribute_color input':'_onChangeColorAttribute','change .main_product:not(.in_cart) input.js_quantity':'onChangeAddQuantity','change [data-attribute_exclusions]':'onChangeVariant'},isSelectedVariantAllowed:true,computePriceTotal:function(){},onChangeVariant:function(ev){var $parent=$(ev.target).closest('.js_product');if(!$parent.data('uniqueId')){$parent.data('uniqueId',_.uniqueId());}
this._throttledGetCombinationInfo($parent.data('uniqueId'))(ev);},_getCombinationInfo:function(ev){var self=this;var $component;if($(ev.currentTarget).closest('form').length>0){$component=$(ev.currentTarget).closest('form');}else if($(ev.currentTarget).closest('.oe_optional_products_modal').length>0){$component=$(ev.currentTarget).closest('.oe_optional_products_modal');}else if($(ev.currentTarget).closest('.o_product_configurator').length>0){$component=$(ev.currentTarget).closest('.o_product_configurator');}else{$component=$(ev.currentTarget);}
var qty=$component.find('input[name="add_qty"]').val();var $parent=$(ev.target).closest('.js_product');var combination=this.getSelectedVariantValues($parent);var parentCombination=$parent.find('ul[data-attribute_exclusions]').data('attribute_exclusions').parent_combination;var productTemplateId=parseInt($parent.find('.product_template_id').val());self._checkExclusions($parent,combination);return ajax.jsonRpc(this._getUri('/product_configurator/get_combination_info'),'call',{'product_template_id':productTemplateId,'product_id':this._getProductId($parent),'combination':combination,'add_qty':parseInt(qty),'pricelist_id':this.pricelistId||false,'parent_combination':parentCombination,}).then(function(combinationData){self._onChangeCombination(ev,$parent,combinationData);});},handleCustomValues:function($target){var $variantContainer;var $customInput=false;if($target.is('input[type=radio]')&&$target.is(':checked')){$variantContainer=$target.closest('ul').closest('li');$customInput=$target;}else if($target.is('select')){$variantContainer=$target.closest('li');$customInput=$target.find('option[value="'+$target.val()+'"]');}
if($variantContainer){if($customInput&&$customInput.data('is_custom')){var attributeValueId=$customInput.data('value_id');var attributeValueName=$customInput.data('value_name');if($variantContainer.find('.variant_custom_value').length===0||$variantContainer.find('.variant_custom_value').data('attribute_value_id')!==parseInt(attributeValueId)){$variantContainer.find('.variant_custom_value_label').remove();$variantContainer.find('.variant_custom_value').remove();var $input=$('<input>',{type:'text','data-attribute_value_id':attributeValueId,'data-attribute_value_name':attributeValueName,class:'variant_custom_value form-control'});var isRadioInput=$target.is('input[type=radio]')&&$target.closest('label.css_attribute_color').length===0;if(isRadioInput){$input.addClass('custom_value_radio');$target.closest('div').after($input);}else{var $label=$('<label>',{html:attributeValueName+': ',class:'variant_custom_value_label'});$variantContainer.append($label).append($input);}}}else{$variantContainer.find('.variant_custom_value_label').remove();$variantContainer.find('.variant_custom_value').remove();}}},onClickAddCartJSON:function(ev){ev.preventDefault();var $link=$(ev.currentTarget);var $input=$link.closest('.input-group').find("input");var min=parseFloat($input.data("min")||0);var max=parseFloat($input.data("max")||Infinity);var previousQty=parseFloat($input.val()||0,10);var quantity=($link.has(".fa-minus").length?-1:1)+previousQty;var newQty=quantity>min?(quantity<max?quantity:max):min;if(newQty!==previousQty){$input.val(newQty).trigger('change');}
return false;},onChangeAddQuantity:function(ev){var $parent;if($(ev.currentTarget).closest('.oe_optional_products_modal').length>0){$parent=$(ev.currentTarget).closest('.oe_optional_products_modal');}else if($(ev.currentTarget).closest('form').length>0){$parent=$(ev.currentTarget).closest('form');}else{$parent=$(ev.currentTarget).closest('.o_product_configurator');}
this.triggerVariantChange($parent);},triggerVariantChange:function($container){var self=this;$container.find('ul[data-attribute_exclusions]').trigger('change',{$container:$container});$container.find('input.js_variant_change:checked, select.js_variant_change').each(function(){self.handleCustomValues($(this));});},getCustomVariantValues:function($container){var variantCustomValues=[];$container.find('.variant_custom_value').each(function(){var $variantCustomValueInput=$(this);if($variantCustomValueInput.length!==0){variantCustomValues.push({'attribute_value_id':$variantCustomValueInput.data('attribute_value_id'),'attribute_value_name':$variantCustomValueInput.data('attribute_value_name'),'custom_value':$variantCustomValueInput.val(),});}});return variantCustomValues;},getNoVariantAttributeValues:function($container){var noVariantAttributeValues=[];var variantsValuesSelectors=['input.no_variant.js_variant_change:checked','select.no_variant.js_variant_change'];$container.find(variantsValuesSelectors.join(',')).each(function(){var $variantValueInput=$(this);if($variantValueInput.is('select')){$variantValueInput=$variantValueInput.find('option[value='+$variantValueInput.val()+']');}
if($variantValueInput.length!==0){noVariantAttributeValues.push({'attribute_value_id':$variantValueInput.data('value_id'),'attribute_value_name':$variantValueInput.data('value_name'),'value':$variantValueInput.val(),'attribute_name':$variantValueInput.data('attribute_name'),'is_custom':$variantValueInput.data('is_custom')});}});return noVariantAttributeValues;},getSelectedVariantValues:function($container){var values=[];var unchangedValues=$container.find('div.oe_unchanged_value_ids').data('unchanged_value_ids')||[];var variantsValuesSelectors=['input.js_variant_change:checked','select.js_variant_change'];_.each($container.find(variantsValuesSelectors.join(', ')),function(el){values.push(+$(el).val());});return values.concat(unchangedValues);},selectOrCreateProduct:function($container,productId,productTemplateId,useAjax){var self=this;productId=parseInt(productId);productTemplateId=parseInt(productTemplateId);var productReady=$.Deferred();if(productId){productReady.resolve(productId);}else{var params={product_template_id:productTemplateId,product_template_attribute_value_ids:JSON.stringify(self.getSelectedVariantValues($container)),};var route='/product_configurator/create_product_variant';if(useAjax){productReady=ajax.jsonRpc(route,'call',params);}else{productReady=this._rpc({route:route,params:params});}}
return productReady;},_checkExclusions:function($parent,combination){var self=this;var combinationData=$parent.find('ul[data-attribute_exclusions]').data('attribute_exclusions');$parent.find('option, input, label').removeClass('css_not_available');if(combinationData.exclusions){_.each(combination,function(current_ptav){if(combinationData.exclusions.hasOwnProperty(current_ptav)){_.each(combinationData.exclusions[current_ptav],function(excluded_ptav){self._disableInput($parent,excluded_ptav);});}});}
_.each(combinationData.parent_exclusions,function(ptav){self._disableInput($parent,ptav);});},_getProductId:function($parent){return parseInt($parent.find('.product_id').val());},_disableInput:function($parent,attributeValueId){var $input=$parent.find('option[value='+attributeValueId+'], input[value='+attributeValueId+']');$input.addClass('css_not_available');$input.closest('label').addClass('css_not_available');},_onChangeCombination:function(ev,$parent,combination){var self=this;var $price=$parent.find(".oe_price:first .oe_currency_value");var $default_price=$parent.find(".oe_default_price:first .oe_currency_value");var $optional_price=$parent.find(".oe_optional:first .oe_currency_value");var isCombinationPossible=this.isSelectedVariantAllowed;if(combination.is_combination_possible!==undefined){isCombinationPossible=combination.is_combination_possible;}
this._toggleDisable($parent,isCombinationPossible);$price.html(self._priceToStr(combination.price));$default_price.html(self._priceToStr(combination.list_price));var compatibility_check=combination.list_price-combination.price>=0.01;if(combination.has_discounted_price!==undefined?combination.has_discounted_price:compatibility_check){$default_price.closest('.oe_website_sale').addClass("discount");$optional_price.closest('.oe_optional').removeClass('d-none').css('text-decoration','line-through');$default_price.parent().removeClass('d-none');}else{$default_price.closest('.oe_website_sale').removeClass("discount");$optional_price.closest('.oe_optional').addClass('d-none');$default_price.parent().addClass('d-none');}
var rootComponentSelectors=['tr.js_product','.oe_website_sale','.o_product_configurator'];if(combination.product_id!==this.last_product_id){this.last_product_id=combination.product_id;self._updateProductImage($parent.closest(rootComponentSelectors.join(', ')),combination.product_id,combination.product_template_id,combination.carousel,isCombinationPossible);}
$parent.find('.product_id').first().val(combination.product_id||0).trigger('change');$parent.find('.product_display_name').first().val(combination.display_name);$parent.find('.js_raw_price').first().html(combination.price);this.handleCustomValues($(ev.target));},_priceToStr:function(price){var l10n=_t.database.parameters;var precision=2;if($('.decimal_precision').length){precision=parseInt($('.decimal_precision').last().data('precision'));}
var formatted=_.str.sprintf('%.'+precision+'f',price).split('.');formatted[0]=utils.insert_thousand_seps(formatted[0]);return formatted.join(l10n.decimal_point);},_throttledGetCombinationInfo:_.memoize(function(uniqueId){var dropMisordered=new concurrency.DropMisordered();var _getCombinationInfo=_.throttle(this._getCombinationInfo.bind(this),500);return function(ev){return dropMisordered.add(_getCombinationInfo(ev));};}),_toggleDisable:function($parent,isCombinationPossible){$parent.toggleClass('css_not_available',!isCombinationPossible);},_updateProductImage:function($productContainer,productId,productTemplateId){var model=productId?'product.product':'product.template';var modelId=productId||productTemplateId;var imageUrl='/web/image/{0}/{1}/'+(this._productImageField?this._productImageField:'image');var imageSrc=imageUrl.replace("{0}",model).replace("{1}",modelId);var imagesSelectors=['span[data-oe-model^="product."][data-oe-type="image"] img:first','img.product_detail_img','span.variant_image img','img.variant_image',];var $img=$productContainer.find(imagesSelectors.join(', '));$img.attr('src',imageSrc);},_onChangeColorAttribute:function(ev){var $parent=$(ev.target).closest('.js_product');$parent.find('.css_attribute_color').removeClass("active").filter(':has(input:checked)').addClass("active");},_getUri:function(uri){if(this.isWebsite){return uri+'_website';}else{return uri;}}};return ProductConfiguratorMixin;});;

/* /sale/static/src/js/product_configurator_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('sale.ProductConfiguratorFormRenderer',function(require){"use strict";var FormRenderer=require('web.FormRenderer');var ProductConfiguratorMixin=require('sale.ProductConfiguratorMixin');var ProductConfiguratorFormRenderer=FormRenderer.extend(ProductConfiguratorMixin,{events:_.extend({},FormRenderer.prototype.events,ProductConfiguratorMixin.events,{'click button.js_add_cart_json':'onClickAddCartJSON',}),init:function(){this._super.apply(this,arguments);this.pricelistId=this.state.context.default_pricelist_id||0;},start:function(){this._super.apply(this,arguments);this.$el.append($('<div>',{class:'configurator_container'}));},renderConfigurator:function(configuratorHtml){var $configuratorContainer=this.$('.configurator_container');$configuratorContainer.empty();var $configuratorHtml=$(configuratorHtml);$configuratorHtml.appendTo($configuratorContainer);this.triggerVariantChange($configuratorContainer);},_toggleDisable:function($parent,isCombinationPossible){ProductConfiguratorMixin._toggleDisable.apply(this,arguments);$parent.parents('.modal').find('.o_sale_product_configurator_add').toggleClass('disabled',!isCombinationPossible);},});return ProductConfiguratorFormRenderer;});;

/* /sale/static/src/js/product_configurator_controller.js defined in bundle 'web.assets_backend' */
odoo.define('sale.ProductConfiguratorFormController',function(require){"use strict";var core=require('web.core');var _t=core._t;var FormController=require('web.FormController');var OptionalProductsModal=require('sale.OptionalProductsModal');var ProductConfiguratorFormController=FormController.extend({custom_events:_.extend({},FormController.prototype.custom_events,{field_changed:'_onFieldChanged'}),className:'o_product_configurator',init:function(){this._super.apply(this,arguments);},_onButtonClicked:function(event){if(event.stopPropagation){event.stopPropagation();}
var attrs=event.data.attrs;if(attrs.special==='cancel'){this._super.apply(this,arguments);}else{if(!this.$el.parents('.modal').find('.o_sale_product_configurator_add').hasClass('disabled')){this._handleAdd(this.$el);}}},_onFieldChanged:function(event){this._super.apply(this,arguments);var self=this;var product_id=event.data.changes.product_template_id.id;if(!product_id){return;}
this.$el.parents('.modal').find('.o_sale_product_configurator_add').removeClass('disabled');this._rpc({route:'/product_configurator/configure',params:{product_id:product_id,pricelist_id:this.renderer.pricelistId}}).then(function(configurator){self.renderer.renderConfigurator(configurator);});},_handleAdd:function($modal){var self=this;var productSelector=['input[type="hidden"][name="product_id"]','input[type="radio"][name="product_id"]:checked'];var productId=parseInt($modal.find(productSelector.join(', ')).first().val(),10);var productReady=this.renderer.selectOrCreateProduct($modal,productId,$modal.find('.product_template_id').val(),false);productReady.done(function(productId){$modal.find(productSelector.join(', ')).val(productId);var variantValues=self.renderer.getSelectedVariantValues($modal.find('.js_product'));var productCustomVariantValues=self.renderer.getCustomVariantValues($modal.find('.js_product'));var noVariantAttributeValues=self.renderer.getNoVariantAttributeValues($modal.find('.js_product'));self.rootProduct={product_id:productId,quantity:parseFloat($modal.find('input[name="add_qty"]').val()||1),variant_values:variantValues,product_custom_attribute_values:productCustomVariantValues,no_variant_attribute_values:noVariantAttributeValues};self.optionalProductsModal=new OptionalProductsModal($('body'),{rootProduct:self.rootProduct,pricelistId:self.renderer.pricelistId,okButtonText:_t('Confirm'),cancelButtonText:_t('Back'),title:_t('Configure')}).open();self.optionalProductsModal.on('options_empty',null,self._onModalOptionsEmpty.bind(self));self.optionalProductsModal.on('update_quantity',null,self._onOptionsUpdateQuantity.bind(self));self.optionalProductsModal.on('confirm',null,self._onModalConfirm.bind(self));});},_onModalOptionsEmpty:function(){this._addProducts([this.rootProduct]);},_onModalConfirm:function(){this._addProducts(this.optionalProductsModal.getSelectedProducts());},_onOptionsUpdateQuantity:function(quantity){this.$el.find('input[name="add_qty"]').val(quantity).trigger('change');},_addProducts:function(products){this.do_action({type:'ir.actions.act_window_close',infos:products});}});return ProductConfiguratorFormController;});;

/* /sale/static/src/js/product_configurator_view.js defined in bundle 'web.assets_backend' */
odoo.define('sale.ProductConfiguratorFormView',function(require){"use strict";var ProductConfiguratorFormController=require('sale.ProductConfiguratorFormController');var ProductConfiguratorFormRenderer=require('sale.ProductConfiguratorFormRenderer');var FormView=require('web.FormView');var viewRegistry=require('web.view_registry');var ProductConfiguratorFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Controller:ProductConfiguratorFormController,Renderer:ProductConfiguratorFormRenderer,}),});viewRegistry.add('product_configurator_form',ProductConfiguratorFormView);return ProductConfiguratorFormView;});;

/* /sale/static/src/js/product_configurator_modal.js defined in bundle 'web.assets_backend' */
odoo.define('sale.OptionalProductsModal',function(require){"use strict";var ajax=require('web.ajax');var Dialog=require('web.Dialog');var ServicesMixin=require('web.ServicesMixin');var ProductConfiguratorMixin=require('sale.ProductConfiguratorMixin');var weContext=require('web_editor.context');var productNameMap={};var optionalProductsMap={};var OptionalProductsModal=Dialog.extend(ServicesMixin,ProductConfiguratorMixin,{events:_.extend({},Dialog.prototype.events,ProductConfiguratorMixin.events,{'click a.js_add, a.js_remove':'_onAddOrRemoveOption','click button.js_add_cart_json':'onClickAddCartJSON','change .in_cart.main_product input.js_quantity':'_onChangeQuantity',}),init:function(parent,params){var self=this;var options=_.extend({size:'large',buttons:[{text:params.okButtonText,click:this._onConfirmButtonClick,classes:'btn-primary'},{text:params.cancelButtonText,click:this._onCancelButtonClick}],technical:!params.isWebsite,},params||{});this._super(parent,options);this.rootProduct=params.rootProduct;this.container=parent;this.pricelistId=params.pricelistId;this.isWebsite=params.isWebsite;this.dialogClass='oe_optional_products_modal'+(params.isWebsite?' oe_website_sale':'');this._productImageField='image_medium';},willStart:function(){var self=this;var uri=this._getUri("/product_configurator/show_optional_products");var getModalContent=ajax.jsonRpc(uri,'call',{product_id:self.rootProduct.product_id,variant_values:self.rootProduct.variant_values,pricelist_id:self.pricelistId||false,add_qty:self.rootProduct.quantity,kwargs:{context:_.extend({'quantity':self.rootProduct.quantity},weContext.get()),}}).then(function(modalContent){if(modalContent){var $modalContent=$(modalContent);$modalContent=self._postProcessContent($modalContent);self.$content=$modalContent;}else{self.trigger('options_empty');self.preventOpening=true;}});var parentInit=self._super.apply(self,arguments);return $.when(getModalContent,parentInit);},open:function(options){$('.tooltip').remove();var self=this;this.appendTo($('<div/>')).then(function(){if(!self.preventOpening){self.$modal.find(".modal-body").replaceWith(self.$el);self.$modal.attr('open',true);self.$modal.removeAttr("aria-hidden");self.$modal.modal().appendTo(self.container);self.$modal.focus();self._opened.resolve();}});if(options&&options.shouldFocusButtons){self._onFocusControlButton();}
return self;},start:function(){var def=this._super.apply(this,arguments);var self=this;this.$el.find('input[name="add_qty"]').val(this.rootProduct.quantity);return def.then(function(){self._opened.then(function(){self.triggerVariantChange(self.$el);});});},computePriceTotal:function(){if($('.js_price_total').length){var price=0;$('.js_product.in_cart').each(function(){var quantity=parseInt($('input[name="add_qty"]').first().val());price+=parseFloat($(this).find('.js_raw_price').html())*quantity;});$('.js_price_total .oe_currency_value').html(this._priceToStr(parseFloat(price)));}
ProductConfiguratorMixin.computePriceTotal.apply(this,arguments);},getSelectedProducts:function(){var self=this;var products=[this.rootProduct];this.$modal.find('.js_product.in_cart:not(.main_product)').each(function(){var quantity=0;var $item=$(this);if($item.find('input[name="add_qty"]').length){quantity=$item.find('input[name="add_qty"]').val();}else{quantity=parseInt($item.find('.optional_product_quantity span.add_qty').html().trim());}
var productCustomVariantValues=self.getCustomVariantValues($(this));var noVariantAttributeValues=self.getNoVariantAttributeValues($(this));products.push({product_id:parseInt($item.find('input.product_id').val()),quantity:quantity,product_custom_attribute_values:productCustomVariantValues,no_variant_attribute_values:noVariantAttributeValues});});return products;},_postProcessContent:function($modalContent){var productId=this.rootProduct.product_id;$modalContent.find('img:first').attr("src","/web/image/product.product/"+productId+"/image_medium");if(this.rootProduct&&(this.rootProduct.product_custom_attribute_values||this.rootProduct.no_variant_attribute_values)){var $productDescription=$modalContent.find('.main_product').find('td.td-product_name div.text-muted.small > div:first');var $updatedDescription=$('<div/>');$updatedDescription.append($('<p>',{text:$productDescription.text()}));$.each(this.rootProduct.product_custom_attribute_values,function(){$updatedDescription.append($('<div>',{text:this.attribute_value_name+': '+this.custom_value}));});$.each(this.rootProduct.no_variant_attribute_values,function(){if(this.is_custom!=='True'){$updatedDescription.append($('<div>',{text:this.attribute_name+': '+this.attribute_value_name}));}});$productDescription.replaceWith($updatedDescription);}
return $modalContent;},_onConfirmButtonClick:function(){this.trigger('confirm');this.close();},_onCancelButtonClick:function(){this.trigger('back');this.close();},_onAddOrRemoveOption:function(ev){ev.preventDefault();var self=this;var $target=$(ev.currentTarget);var $modal=$target.parents('.oe_optional_products_modal');var $parent=$target.parents('.js_product:first');$parent.find("a.js_add, span.js_remove").toggleClass('d-none');$parent.find("input.js_optional_same_quantity").val($target.hasClass("js_add")?1:0);$parent.find(".js_remove");var productTemplateId=$parent.find(".product_template_id").val();if($target.hasClass('js_add')){self._onAddOption($modal,$parent,productTemplateId);}else{self._onRemoveOption($modal,$parent,productTemplateId);}
self.computePriceTotal();},_onAddOption:function($modal,$parent,productTemplateId){var self=this;var $main_product=$modal.find('.js_product:first');var $selectOptionsText=$modal.find('.o_select_options');$parent.addClass('in_cart');$parent.find('.td-qty').addClass('text-center');$parent.find('.td-qty').append($parent.find('.optional_product_quantity'));productNameMap[productTemplateId]=$parent.find(".product-name").html();$parent.find(".product-name").html($parent.find(".product_display_name").val());var productCustomVariantValues=self.getCustomVariantValues($parent);var noVariantAttributeValues=self.getNoVariantAttributeValues($parent);if(productCustomVariantValues||noVariantAttributeValues){var $productDescription=$parent.find('td.td-product_name div.float-left');var $customAttributeValuesDescription=$('<div>',{class:'custom_attribute_values_description text-muted small'});if(productCustomVariantValues.length!==0||noVariantAttributeValues.length!==0){$customAttributeValuesDescription.append($('<br/>'));}
$.each(productCustomVariantValues,function(){$customAttributeValuesDescription.append($('<div>',{text:this.attribute_value_name+': '+this.custom_value}));});$.each(noVariantAttributeValues,function(){if(this.is_custom!=='True'){$customAttributeValuesDescription.append($('<div>',{text:this.attribute_name+': '+this.attribute_value_name}));}});$productDescription.append($customAttributeValuesDescription);}
var parentProductId=null;for(var productIdKey in optionalProductsMap){if(optionalProductsMap[productIdKey].indexOf(productTemplateId)!==-1){parentProductId=productIdKey;break;}
$('tr:last').after($parent);}
if(parentProductId){$modal.find('.product_template_id').filter(function(){return parentProductId===$(this).val();}).parents('.js_product:first').after($parent);}else{$main_product.after($parent);}
var productReady=this.selectOrCreateProduct($parent,$parent.find('.product_id').val(),productTemplateId,true);productReady.done(function(productId){$parent.find('.product_id').val(productId);ajax.jsonRpc(self._getUri("/product_configurator/optional_product_items"),'call',{'product_id':productId,'pricelist_id':self.pricelistId||false,}).then(function(addedItem){var $addedItem=$(addedItem);$modal.find('tr:last').after($addedItem);self.$el.find('input[name="add_qty"]').trigger('change');self.triggerVariantChange($addedItem);if($addedItem.find(".product_template_id").length>0){optionalProductsMap[productTemplateId]=$addedItem.find(".product_template_id").map(function(){return $(this).val();}).get();}
if($selectOptionsText.nextAll('.js_product').length===0){$selectOptionsText.hide();}});});},_onRemoveOption:function($modal,$parent,productTemplateId){$parent.removeClass('in_cart');$parent.find('.td-qty').removeClass('text-center');$parent.find('.js_remove.d-none').prepend($parent.find('.optional_product_quantity'));$parent.find('.custom_attribute_values_description').remove();var $select_options_text=$modal.find('.o_select_options');$select_options_text.show();$parent.find(".product-name").html(productNameMap[productTemplateId]);delete productNameMap[productTemplateId];this._removeOptionOption($modal,productTemplateId);$modal.find('tr:last').after($parent);},_removeOptionOption:function($modal,optionId){var self=this;if(optionalProductsMap[optionId]){optionalProductsMap[optionId].forEach(function(productId){$modal.find('.product_template_id').filter(function(){return productId===$(this).val();}).parents('.js_product:first').remove();self._removeOptionOption($modal,productId);});delete optionalProductsMap[optionId];}},_onChangeCombination:function(ev,$parent,combination){$parent.find('.td-product_name .product-name').first().text(combination.display_name);ProductConfiguratorMixin._onChangeCombination.apply(this,arguments);this.computePriceTotal();},_onChangeQuantity:function(ev){var $quantity=$(ev.currentTarget);var qty=parseFloat($quantity.val());var $modal=$quantity.parents('.oe_optional_products_modal');if(qty===1){$modal.find(".js_items").addClass('d-none').removeClass('add_qty');$modal.find(".js_item").removeClass('d-none').addClass('add_qty');}else{$modal.find(".js_items").removeClass('d-none').addClass('add_qty').text(qty);$modal.find(".js_item").addClass('d-none').removeClass('add_qty');}
this.rootProduct.quantity=qty;if(!this.isWebsite){this.onChangeAddQuantity(ev);}
this.trigger('update_quantity',qty);}});return OptionalProductsModal;});;

/* /date_range/static/src/js/date_range.js defined in bundle 'web.assets_backend' */
odoo.define('date_range.search_filters',function(require){"use strict";var core=require('web.core');var data=require('web.data');var filters=require('web.search_filters');var rpc=require('web.rpc');var framework=require('web.framework');filters.ExtendedSearchProposition.include({select_field:function(field){this._super.apply(this,arguments);this.is_date_range_selected=false;this.is_date=field.type==='date'||field.type==='datetime';this.$value=this.$el.find('.searchview_extended_prop_value, .o_searchview_extended_prop_value');if(this.is_date){var ds=new data.DataSetSearch(this,'date.range.type',this.context,[[1,'=',1]]);ds.read_slice(['name'],{}).done(this.proxy('add_date_range_types_operator'));}},add_date_range_types_operator:function(date_range_types){var self=this;_.each(date_range_types,function(drt){$('<option>',{value:'drt_'+drt.id}).text(_('in ')+drt.name).appendTo(self.$el.find('.searchview_extended_prop_op, .o_searchview_extended_prop_op'));});},operator_changed:function(e){var val=$(e.target).val();this.is_date_range_selected=val.startsWith('drt_');if(this.is_date_range_selected){var type_id=val.replace('drt_','');this.date_range_type_operator_selected(type_id);return;}
this._super.apply(this,arguments);},date_range_type_operator_selected:function(type_id){this.$value.empty().show();var ds=new data.DataSetSearch(this,'date.range',this.context,[['type_id','=',parseInt(type_id,10)]]);ds.read_slice(['name','date_start','date_end'],{}).done(this.proxy('on_range_type_selected'));},on_range_type_selected:function(date_range_values){this.value=new filters.ExtendedSearchProposition.DateRange(this,this.value.field,date_range_values);this.value.appendTo(this.$value);if(!this.$el.hasClass('o_filter_condition')){this.$value.find('.date-range-select').addClass('form-control');}
this.value.on_range_selected();},get_filter:function(){var res=this._super.apply(this,arguments);if(this.is_date_range_selected){res.attrs.domain=this.value.domain;}
return res;},});filters.ExtendedSearchProposition.DateRange=core.search_filters_registry.get('id').extend({template:'SearchView.extended_search.dateRange.selection',events:{'change':'on_range_selected',},init:function(parent,field,date_range_values){this._super(parent,field);this.date_range_values=date_range_values;},toString:function(){var select=this.$el[0];var option=select.options[select.selectedIndex];return option.label||option.text;},get_value:function(){return parseInt(this.$el.val(),10);},on_range_selected:function(e){var self=this;self.domain='';framework.blockUI();return rpc.query({args:[this.get_value()],kwargs:{field_name:this.field.name,},model:'date.range',method:'get_domain',}).then(function(domain){framework.unblockUI();self.domain=domain;});},get_domain:function(field,operator){return this.domain;},});});;

/* /calendar/static/src/js/base_calendar.js defined in bundle 'web.assets_backend' */
odoo.define('base_calendar.base_calendar',function(require){"use strict";var BasicModel=require('web.BasicModel');var field_registry=require('web.field_registry');var Notification=require('web.Notification');var relational_fields=require('web.relational_fields');var session=require('web.session');var WebClient=require('web.WebClient');var FieldMany2ManyTags=relational_fields.FieldMany2ManyTags;var CalendarNotification=Notification.extend({template:"CalendarNotification",init:function(parent,params){this._super(parent,params);this.eid=params.eventID;this.sticky=true;this.events=_.extend(this.events||{},{'click .link2event':function(){var self=this;this._rpc({route:'/web/action/load',params:{action_id:'calendar.action_calendar_event_notify',},}).then(function(r){r.res_id=self.eid;return self.do_action(r);});},'click .link2recall':function(){this.close();},'click .link2showed':function(){var self=this;this._rpc({route:'/calendar/notify_ack'}).always(function(){self.close();});},});},});WebClient.include({display_calendar_notif:function(notifications){var self=this;var last_notif_timer=0;clearTimeout(this.get_next_calendar_notif_timeout);_.each(this.calendar_notif_timeouts,clearTimeout);this.calendar_notif_timeouts={};_.each(notifications,function(notif){var key=notif.event_id+','+notif.alarm_id;if(key in self.calendar_notif){return;}
self.calendar_notif_timeouts[key]=setTimeout(function(){var notificationID=self.call('notification','notify',{Notification:CalendarNotification,title:notif.title,message:notif.message,eventID:notif.event_id,onClose:function(){delete self.calendar_notif[key];},});self.calendar_notif[key]=notificationID;},notif.timer*1000);last_notif_timer=Math.max(last_notif_timer,notif.timer);});if(last_notif_timer>0){this.get_next_calendar_notif_timeout=setTimeout(this.get_next_calendar_notif.bind(this),last_notif_timer*1000);}},get_next_calendar_notif:function(){session.rpc("/calendar/notify",{},{shadow:true}).done(this.display_calendar_notif.bind(this)).fail(function(err,ev){if(err.code===-32098){ev.preventDefault();}});},show_application:function(){this.calendar_notif_timeouts={};this.calendar_notif={};this.call('bus_service','onNotification',this,function(notifications){_.each(notifications,(function(notification){if(notification[0][1]==='calendar.alarm'){this.display_calendar_notif(notification[1]);}}).bind(this));});return this._super.apply(this,arguments).then(this.get_next_calendar_notif.bind(this));},});BasicModel.include({_fetchSpecialAttendeeStatus:function(record,fieldName){var context=record.getContext({fieldName:fieldName});var attendeeIDs=record.data[fieldName]?this.localData[record.data[fieldName]].res_ids:[];var meetingID=_.isNumber(record.res_id)?record.res_id:false;return this._rpc({model:'res.partner',method:'get_attendee_detail',args:[attendeeIDs,meetingID],context:context,}).then(function(result){return _.map(result,function(d){return _.object(['id','display_name','status','color'],d);});});},});var Many2ManyAttendee=FieldMany2ManyTags.extend({tag_template:"Many2ManyAttendeeTag",specialData:"_fetchSpecialAttendeeStatus",_getRenderTagsContext:function(){var result=this._super.apply(this,arguments);result.attendeesData=this.record.specialData.partner_ids;return result;},});field_registry.add('many2manyattendee',Many2ManyAttendee);});;

/* /calendar/static/src/js/mail_activity.js defined in bundle 'web.assets_backend' */
odoo.define('calendar.Activity',function(require){"use strict";var Activity=require('mail.Activity');var Dialog=require('web.Dialog');var core=require('web.core');var _t=core._t;Activity.include({_onEditActivity:function(event,options){var self=this;var activity_id=$(event.currentTarget).data('activity-id');var activity=_.find(this.activities,function(act){return act.id===activity_id;});if(activity&&activity.activity_category==='meeting'&&activity.calendar_event_id){return self._super(event,_.extend({res_model:'calendar.event',res_id:activity.calendar_event_id[0],}));}
return self._super(event,options);},_onUnlinkActivity:function(event,options){event.preventDefault();var self=this;var activity_id=$(event.currentTarget).data('activity-id');var activity=_.find(this.activities,function(act){return act.id===activity_id;});if(activity&&activity.activity_category==='meeting'&&activity.calendar_event_id){Dialog.confirm(self,_t("The activity is linked to a meeting. Deleting it will remove the meeting as well. Do you want to proceed ?"),{confirm_callback:function(){return self._rpc({model:'mail.activity',method:'unlink_w_meeting',args:[[activity_id]],}).then(self._reload.bind(self,{activity:true}));},});}
else{return self._super(event,options);}},});});;

/* /calendar/static/src/js/systray_activity_menu.js defined in bundle 'web.assets_backend' */
odoo.define('calendar.systray.ActivityMenu',function(require){"use strict";var ActivityMenu=require('mail.systray.ActivityMenu');var fieldUtils=require('web.field_utils');ActivityMenu.include({events:_.extend({},ActivityMenu.prototype.events,{'click .o_meeting_filter':'_onMeetingFilterClick'}),_getActivityData:function(){var self=this;return this._super.apply(this,arguments).then(function(){var meeting=_.find(self._activities,{type:'meeting'});if(meeting&&meeting.meetings){_.each(meeting.meetings,function(res){res.start=fieldUtils.parse.datetime(res.start,false,{isUTC:true});});}});},_onActivityFilterClick:function(ev){var $el=$(ev.currentTarget);var data=_.extend({},$el.data());if(data.res_model==="calendar.event"&&data.filter==="my"){this.do_action('calendar.action_calendar_event',{additional_context:{default_mode:'day',search_default_mymeetings:1,},clear_breadcrumbs:true,});}else{this._super.apply(this,arguments);}},_onMeetingFilterClick:function(ev){ev.stopPropagation();var $el=$(ev.currentTarget);var data=_.extend({},$el.data());if(data.res_model==="calendar.event"){this.do_action({type:'ir.actions.act_window',name:data.model_name,res_model:data.res_model,res_id:data.res_id,views:[[false,'form'],[false,'calendar'],[false,'list']],});}},});});;

/* /account_accountant/static/src/js/tour.js defined in bundle 'web.assets_backend' */
odoo.define('account_accountant.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('account_reports_widgets',{test:true,url:'/web?#action=account_reports.action_account_report_pnl',},[{content:"wait web client",trigger:".o_account_reports_body",extra_trigger:".breadcrumb",run:function(){}},{content:"unfold line",trigger:'.js_account_report_foldable:first',run:'click',},{content:"check that line has been unfolded",trigger:'[data-parent-id]',},{content:'Open dropdown menu of one of the unfolded line',trigger:'[data-parent-id] .o_account_report_line a:first',run:'click',},{content:'click on the annotate action',trigger:'[data-parent-id] .o_account_report_line .o_account_reports_domain_dropdown:first .js_account_reports_add_footnote',run:'click',},{content:'insert footnote text',trigger:'.js_account_reports_footnote_note',run:'text My awesome footnote!'},{content:'save footnote',trigger:'.modal-footer .btn-primary',run:'click'},{content:'wait for footnote to be saved',trigger:'.footnote#footnote1 .text:contains(1. My awesome footnote!)',extra_trigger:'.o_account_reports_footnote_sup a[href="#footnote1"]',},{content:"change date filter",trigger:".o_account_reports_filter_date > a",},{content:"change date filter",trigger:".dropdown-item.js_account_report_date_filter[data-filter='last_year']",run:'click'},{content:"wait refresh",trigger:".o_account_reports_level2:last() .o_account_report_column_value:contains(0.00)"},{content:"change comparison filter",trigger:".o_account_reports_filter_date_cmp > a"},{content:"change comparison filter",trigger:".dropdown-item.js_foldable_trigger[data-filter='previous_period_filter']"},{content:"change comparison filter",trigger:".js_account_report_date_cmp_filter[data-filter='previous_period']",run:'click',},{content:"wait refresh, report should have 4 columns",trigger:"th + th + th + th"},{content:"click summary",trigger:'.o_account_reports_summary',run:'click'},{content:"edit summary",trigger:'textarea[name="summary"]',run:'text v9 accounting reports are fabulous !'},{content:"save summary",trigger:'.js_account_report_save_summary',run:'click'},{content:"wait refresh and check that summary has been saved",trigger:".o_account_reports_summary:visible:contains(v9 accounting reports are fabulous !)",run:function(){}},{content:"change boolean filter",trigger:".o_account_reports_filter_bool > a",},{content:"change cash basis filter",trigger:".dropdown-item.js_account_report_bool_filter[data-filter='cash_basis']",run:'click'},{title:"export xlsx",trigger:'button[action="print_xlsx"]',run:'click'},]);tour.register('account_accountant_tour',{'skip_enabled':true,},[{trigger:'.o_app[data-menu-xmlid="account_accountant.menu_accounting"]',content:_t('Ready to discover your new favorite <b>accounting app</b>? Get started by clicking here.'),position:'bottom',},{trigger:".o_invoice_new",extra_trigger:'div.o_view_controller:not(.o_has_banner) .o_account_kanban',content:_t("Let\'s start with a new customer invoice."),position:"bottom"},{trigger:".breadcrumb-item:not(.active):last",extra_trigger:"[data-id='open'].btn-primary, [data-id='open'].oe_active",content:_t("Use the path to quickly click back to <b>previous screens</b>, without reloading the page."),position:"bottom"},{trigger:'li a[data-menu-xmlid="account.menu_finance_reports"], div[data-menu-xmlid="account.menu_finance_reports"]',content:_t("Your reports are available in real time. <i>No need to close a fiscal year to get a Profit &amp; Loss statement or view the Balance Sheet.</i>"),position:"bottom"}]);});;

/* /account_reports/static/src/js/account_reports.js defined in bundle 'web.assets_backend' */
odoo.define('account_reports.account_report',function(require){'use strict';var core=require('web.core');var Context=require('web.Context');var AbstractAction=require('web.AbstractAction');var ControlPanelMixin=require('web.ControlPanelMixin');var Dialog=require('web.Dialog');var crash_manager=require('web.crash_manager');var datepicker=require('web.datepicker');var session=require('web.session');var field_utils=require('web.field_utils');var RelationalFields=require('web.relational_fields');var StandaloneFieldManagerMixin=require('web.StandaloneFieldManagerMixin');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var M2MFilters=Widget.extend(StandaloneFieldManagerMixin,{init:function(parent,fields){this._super.apply(this,arguments);StandaloneFieldManagerMixin.init.call(this);this.fields=fields;this.widgets={};},willStart:function(){var self=this;var defs=[this._super.apply(this,arguments)];_.each(this.fields,function(field,fieldName){defs.push(self._makeM2MWidget(field,fieldName));});return $.when.apply($,defs);},start:function(){var self=this;_.each(this.fields,function(field,fieldName){self.$el.append($('<p/>',{style:'font-weight:bold;'}).text(field.label));self.widgets[fieldName].appendTo(self.$el);});return this._super.apply(this,arguments);},_confirmChange:function(){var self=this;var result=StandaloneFieldManagerMixin._confirmChange.apply(this,arguments);var data={};_.each(this.fields,function(filter,fieldName){data[fieldName]=self.widgets[fieldName].value.res_ids;});this.trigger_up('value_changed',data);return result;},_makeM2MWidget:function(fieldInfo,fieldName){var self=this;var options={};options[fieldName]={options:{no_create_edit:true,no_create:true,}};return this.model.makeRecord(fieldInfo.modelName,[{fields:[{name:'id',type:'integer',},{name:'display_name',type:'char',}],name:fieldName,relation:fieldInfo.modelName,type:'many2many',value:fieldInfo.value,}],options).then(function(recordID){self.widgets[fieldName]=new RelationalFields.FieldMany2ManyTags(self,fieldName,self.model.get(recordID),{mode:'edit',});self._registerWidget(recordID,fieldName,self.widgets[fieldName]);});},});var accountReportsWidget=AbstractAction.extend(ControlPanelMixin,{events:{'input .o_account_reports_filter_input':'filter_accounts','click .o_account_reports_summary':'edit_summary','click .js_account_report_save_summary':'save_summary','click .o_account_reports_footnote_icons':'delete_footnote','click .js_account_reports_add_footnote':'add_edit_footnote','click .js_account_report_foldable':'fold_unfold','click [action]':'trigger_action','click .o_account_reports_load_more span':'load_more',},custom_events:{'value_changed':function(ev){var self=this;self.report_options.partner_ids=ev.data.partner_ids;self.report_options.partner_categories=ev.data.partner_categories;return self.reload().then(function(){self.$searchview_buttons.find('.account_partner_filter').click();});},},init:function(parent,action){this.actionManager=parent;this.report_model=action.context.model;if(this.report_model===undefined){this.report_model='account.report';}
this.financial_id=false;if(action.context.id){this.financial_id=action.context.id;}
this.odoo_context=action.context;this.report_options=action.options||false;this.ignore_session=action.ignore_session;if((action.ignore_session==='read'||action.ignore_session==='both')!==true){var persist_key='report:'+this.report_model+':'+this.financial_id+':'+session.company_id;this.report_options=JSON.parse(sessionStorage.getItem(persist_key))||this.report_options;}
return this._super.apply(this,arguments);},start:function(){var self=this;var extra_info=this._rpc({model:self.report_model,method:'get_report_informations',args:[self.financial_id,self.report_options],context:self.odoo_context,}).then(function(result){return self.parse_reports_informations(result);});return $.when(extra_info,this._super.apply(this,arguments)).then(function(){self.render();});},parse_reports_informations:function(values){this.report_options=values.options;this.odoo_context=values.context;this.report_manager_id=values.report_manager_id;this.footnotes=values.footnotes;this.buttons=values.buttons;this.main_html=values.main_html;this.$searchview_buttons=$(values.searchview_html);this.persist_options();},persist_options:function(){if((this.ignore_session==='write'||this.ignore_session==='both')!==true){var persist_key='report:'+this.report_model+':'+this.financial_id+':'+session.company_id;sessionStorage.setItem(persist_key,JSON.stringify(this.report_options));}},do_show:function(){this._super.apply(this,arguments);this.update_cp();},update_cp:function(){if(!this.$buttons){this.renderButtons();}
var status={cp_content:{$buttons:this.$buttons,$searchview_buttons:this.$searchview_buttons,$pager:this.$pager,$searchview:this.$searchview},};return this.update_control_panel(status,{clear:true});},reload:function(){var self=this;return this._rpc({model:this.report_model,method:'get_report_informations',args:[self.financial_id,self.report_options],context:self.odoo_context,}).then(function(result){self.parse_reports_informations(result);return self.render();});},render:function(){this.render_template();this.render_footnotes();this.render_searchview_buttons();this.update_cp();},render_template:function(){this.$el.html(this.main_html);this.$el.find('.o_account_reports_summary_edit').hide();this._add_line_classes();},_add_line_classes:function(){this.$('.o_account_report_line').filter(function(){return $(this).data('unfolded')==='True';}).parent().addClass('o_js_account_report_parent_row_unfolded');this.$('tr[data-parent-id]').addClass('o_js_account_report_inner_row');},filter_accounts:function(e){var self=this;var query=e.target.value.trim().toLowerCase();this.filterOn=false;this.$('.o_account_reports_level2').each(function(index,el){var $accountReportLineFoldable=$(el);var line_id=$accountReportLineFoldable.find('.o_account_report_line').data('id');var $childs=self.$('tr[data-parent-id="'+line_id+'"]');var lineText=$accountReportLineFoldable.find('.account_report_line_name').contents().get(0).nodeValue.trim();var queryFound=lineText.split(' ').some(function(str){return str.toLowerCase().startsWith(query);});$accountReportLineFoldable.toggleClass('o_account_reports_filtered_lines',!queryFound);$childs.toggleClass('o_account_reports_filtered_lines',!queryFound);if(!queryFound){self.filterOn=true;}});if(this.filterOn){this.$('.o_account_reports_level1.total').hide();}
else{this.$('.o_account_reports_level1.total').show();}
this.report_options['filter_accounts']=query;this.render_footnotes();},render_searchview_buttons:function(){var self=this;var $datetimepickers=this.$searchview_buttons.find('.js_account_reports_datetimepicker');var options={locale:moment.locale(),format:'L',icons:{date:"fa fa-calendar",},};$datetimepickers.each(function(){$(this).datetimepicker(options);var dt=new datepicker.DateWidget(options);dt.replace($(this));dt.$el.find('input').attr('name',$(this).find('input').attr('name'));if($(this).data('default-value')){dt.setValue(moment($(this).data('default-value')));}});_.each(this.$searchview_buttons.find('.js_format_date'),function(dt){var date_value=$(dt).html();$(dt).html((new moment(date_value)).format('ll'));});this.$searchview_buttons.find('.js_foldable_trigger').click(function(event){$(this).toggleClass('o_closed_menu o_open_menu');self.$searchview_buttons.find('.o_foldable_menu[data-filter="'+$(this).data('filter')+'"]').toggleClass('o_closed_menu');});_.each(self.report_options,function(k){if(k!==null&&k.filter!==undefined){self.$searchview_buttons.find('[data-filter="'+k.filter+'"]').addClass('selected');}});_.each(this.$searchview_buttons.find('.js_account_report_bool_filter'),function(k){$(k).toggleClass('selected',self.report_options[$(k).data('filter')]);});_.each(this.$searchview_buttons.find('.js_account_report_choice_filter'),function(k){$(k).toggleClass('selected',(_.filter(self.report_options[$(k).data('filter')],function(el){return''+el.id==''+$(k).data('id')&&el.selected===true;})).length>0);});_.each(this.$searchview_buttons.find('.js_account_reports_one_choice_filter'),function(k){$(k).toggleClass('selected',''+self.report_options[$(k).data('filter')]===''+$(k).data('id'));});this.$searchview_buttons.find('.js_account_report_date_filter').click(function(event){self.report_options.date.filter=$(this).data('filter');var error=false;if($(this).data('filter')==='custom'){var date_from=self.$searchview_buttons.find('.o_datepicker_input[name="date_from"]');var date_to=self.$searchview_buttons.find('.o_datepicker_input[name="date_to"]');if(date_from.length>0){error=date_from.val()===""||date_to.val()==="";self.report_options.date.date_from=field_utils.parse.date(date_from.val());self.report_options.date.date_to=field_utils.parse.date(date_to.val());}
else{error=date_to.val()==="";self.report_options.date.date=field_utils.parse.date(date_to.val());}}
if(error){crash_manager.show_warning({data:{message:_t('Date cannot be empty')}});}else{self.reload();}});this.$searchview_buttons.find('.js_account_report_bool_filter').click(function(event){var option_value=$(this).data('filter');self.report_options[option_value]=!self.report_options[option_value];if(option_value==='unfold_all'){self.unfold_all(self.report_options[option_value]);}
self.reload();});this.$searchview_buttons.find('.js_account_report_choice_filter').click(function(event){var option_value=$(this).data('filter');var option_id=$(this).data('id');_.filter(self.report_options[option_value],function(el){if(''+el.id==''+option_id){if(el.selected===undefined||el.selected===null){el.selected=false;}
el.selected=!el.selected;}else if(option_value==='ir_filters'){el.selected=false;}
return el;});self.reload();});this.$searchview_buttons.find('.js_account_reports_one_choice_filter').click(function(event){self.report_options[$(this).data('filter')]=$(this).data('id');self.reload();});this.$searchview_buttons.find('.js_account_report_date_cmp_filter').click(function(event){self.report_options.comparison.filter=$(this).data('filter');var error=false;var number_period=$(this).parent().find('input[name="periods_number"]');self.report_options.comparison.number_period=(number_period.length>0)?parseInt(number_period.val()):1;if($(this).data('filter')==='custom'){var date_from=self.$searchview_buttons.find('.o_datepicker_input[name="date_from_cmp"]');var date_to=self.$searchview_buttons.find('.o_datepicker_input[name="date_to_cmp"]');if(date_from.length>0){error=date_from.val()===""||date_to.val()==="";self.report_options.comparison.date_from=field_utils.parse.date(date_from.val());self.report_options.comparison.date_to=field_utils.parse.date(date_to.val());}
else{error=date_to.val()==="";self.report_options.comparison.date=field_utils.parse.date(date_to.val());}}
if(error){crash_manager.show_warning({data:{message:_t('Date cannot be empty')}});}else{self.reload();}});this.$searchview_buttons.find('.js_account_reports_analytic_auto_complete').select2();if(self.report_options.analytic){self.$searchview_buttons.find('[data-filter="analytic_accounts"]').select2("val",self.report_options.analytic_accounts);self.$searchview_buttons.find('[data-filter="analytic_tags"]').select2("val",self.report_options.analytic_tags);}
this.$searchview_buttons.find('.js_account_reports_analytic_auto_complete').on('change',function(){self.report_options.analytic_accounts=self.$searchview_buttons.find('[data-filter="analytic_accounts"]').val();self.report_options.analytic_tags=self.$searchview_buttons.find('[data-filter="analytic_tags"]').val();return self.reload().then(function(){self.$searchview_buttons.find('.account_analytic_filter').click();})});if(this.report_options.partner){if(!this.M2MFilters){var fields={};if('partner_ids'in this.report_options){fields['partner_ids']={label:_t('Partners'),modelName:'res.partner',value:this.report_options.partner_ids.map(Number),};}
if('partner_categories'in this.report_options){fields['partner_categories']={label:_t('Tags'),modelName:'res.partner.category',value:this.report_options.partner_categories.map(Number),};}
if(!_.isEmpty(fields)){this.M2MFilters=new M2MFilters(this,fields);this.M2MFilters.appendTo(this.$searchview_buttons.find('.js_account_partner_m2m'));}}else{this.$searchview_buttons.find('.js_account_partner_m2m').append(this.M2MFilters.$el);}}},format_date:function(moment_date){var date_format='YYYY-MM-DD';return moment_date.format(date_format);},renderButtons:function(){var self=this;this.$buttons=$(QWeb.render("accountReports.buttons",{buttons:this.buttons}));_.each(this.$buttons.siblings('button'),function(el){$(el).click(function(){self.$buttons.attr('disabled',true);return self._rpc({model:self.report_model,method:$(el).attr('action'),args:[self.financial_id,self.report_options],context:self.odoo_context,}).then(function(result){return self.do_action(result);}).always(function(){self.$buttons.attr('disabled',false);});});});return this.$buttons;},edit_summary:function(e){var $textarea=$(e.target).parents('.o_account_reports_body').find('textarea[name="summary"]');var height=Math.max($(e.target).parents('.o_account_reports_body').find('.o_account_report_summary').height(),100);var text=$textarea.val().replace(new RegExp('<br />','g'),'\n');$textarea.height(height);$textarea.val(text);$(e.target).parents('.o_account_reports_body').find('.o_account_reports_summary_edit').show();$(e.target).parents('.o_account_reports_body').find('.o_account_reports_summary').hide();$(e.target).parents('.o_account_reports_body').find('textarea[name="summary"]').focus();},save_summary:function(e){var self=this;var text=$(e.target).siblings().val().replace(/[ \t]+/g,' ');return this._rpc({model:'account.report.manager',method:'write',args:[this.report_manager_id,{summary:text}],context:this.odoo_context,}).then(function(result){self.$el.find('.o_account_reports_summary_edit').hide();self.$el.find('.o_account_reports_summary').show();if(!text){var $content=$("<input type='text' class='o_input' name='summary'/>");$content.attr('placeholder',_t('Add a note'));}else{var $content=$('<span />').text(text).html(function(i,value){return value.replace(/\n/g,'<br>\n');});}
return $(e.target).parent().siblings('.o_account_reports_summary').find('> .o_account_report_summary').html($content);});},render_footnotes:function(){var self=this;var $dom_footnotes=self.$el.find('.js_account_report_line_footnote:not(.folded)');$dom_footnotes.html('');var number=1;var footnote_to_render=[];_.each($dom_footnotes,function(el){if($(el).parents('.o_account_reports_filtered_lines').length>0){return;}
var line_id=$(el).data('id');var footnote=_.filter(self.footnotes,function(footnote){return''+footnote.line===''+line_id;});if(footnote.length!==0){$(el).html('<sup><b class="o_account_reports_footnote_sup"><a href="#footnote'+number+'">'+number+'</a></b></sup>');footnote[0].number=number;number+=1;footnote_to_render.push(footnote[0]);}});return this._rpc({model:this.report_model,method:'get_html_footnotes',args:[self.financial_id,footnote_to_render],context:self.odoo_context,}).then(function(result){return self.$el.find('.js_account_report_footnotes').html(result);});},add_edit_footnote:function(e){var self=this;var line_id=$(e.target).data('id');var existing_footnote=_.filter(self.footnotes,function(footnote){return''+footnote.line===''+line_id;})
var text='';if(existing_footnote.length!==0){text=existing_footnote[0].text;}
var $content=$(QWeb.render('accountReports.footnote_dialog',{text:text,line:line_id}));var save=function(){var footnote_text=$('.js_account_reports_footnote_note').val().replace(/[ \t]+/g,' ');if(!footnote_text&&existing_footnote.length===0){return;}
if(existing_footnote.length!==0){if(!footnote_text){return self.$el.find('.footnote[data-id="'+existing_footnote[0].id+'"] .o_account_reports_footnote_icons').click();}
return this._rpc({model:'account.report.footnote',method:'write',args:[existing_footnote[0].id,{text:footnote_text}],context:this.odoo_context,}).then(function(result){_.each(self.footnotes,function(footnote){if(footnote.id===existing_footnote[0].id){footnote.text=footnote_text;}});return self.render_footnotes();});}
else{return this._rpc({model:'account.report.footnote',method:'create',args:[{line:line_id,text:footnote_text,manager_id:self.report_manager_id}],context:this.odoo_context,}).then(function(result){self.footnotes.push({id:result,line:line_id,text:footnote_text});return self.render_footnotes();});}};new Dialog(this,{title:'Annotate',size:'medium',$content:$content,buttons:[{text:'Save',classes:'btn-primary',close:true,click:save},{text:'Cancel',close:true}]}).open();},delete_footnote:function(e){var self=this;var footnote_id=$(e.target).parents('.footnote').data('id');return this._rpc({model:'account.report.footnote',method:'unlink',args:[footnote_id],context:this.odoo_context,}).then(function(result){self.footnotes=_.filter(self.footnotes,function(element){return element.id!==footnote_id;});return self.render_footnotes();});},fold_unfold:function(e){var self=this;if($(e.target).hasClass('caret')||$(e.target).parents('.o_account_reports_footnote_sup').length>0){return;}
e.stopPropagation();e.preventDefault();var line=$(e.target).parents('td');if(line.length===0){line=$(e.target);}
var method=line.data('unfolded')==='True'?this.fold(line):this.unfold(line);$.when(method).then(function(){self.render_footnotes();self.persist_options();});},fold:function(line){var self=this;var line_id=line.data('id');line.find('.fa-caret-down').toggleClass('fa-caret-right fa-caret-down');line.toggleClass('folded');$(line).parent('tr').removeClass('o_js_account_report_parent_row_unfolded');var $lines_to_hide=this.$el.find('tr[data-parent-id="'+line_id+'"]');var index=self.report_options.unfolded_lines.indexOf(line_id);if(index>-1){self.report_options.unfolded_lines.splice(index,1);}
if($lines_to_hide.length>0){line.data('unfolded','False');$lines_to_hide.find('.js_account_report_line_footnote').addClass('folded');$lines_to_hide.hide();_.each($lines_to_hide,function(el){var child=$(el).find('[data-id]:first');if(child){self.fold(child);}})}
return false;},unfold:function(line){var self=this;var line_id=line.data('id');line.toggleClass('folded');self.report_options.unfolded_lines.push(line_id);var $lines_in_dom=this.$el.find('tr[data-parent-id="'+line_id+'"]');if($lines_in_dom.length>0){$lines_in_dom.find('.js_account_report_line_footnote').removeClass('folded');$lines_in_dom.show();line.find('.fa-caret-right').toggleClass('fa-caret-right fa-caret-down');line.data('unfolded','True');this._add_line_classes();return true;}
else{return this._rpc({model:this.report_model,method:'get_html',args:[self.financial_id,self.report_options,line.data('id')],context:self.odoo_context,}).then(function(result){$(line).parent('tr').replaceWith(result);self._add_line_classes();});}},load_more:function(ev){var $line=$(ev.target).parents('td');var id=$line.data('id');var offset=$line.data('offset')||0;var progress=$line.data('progress')||0;var options=_.extend({},this.report_options,{lines_offset:offset,lines_progress:progress});var self=this;this._rpc({model:this.report_model,method:'get_html',args:[this.financial_id,options,id],context:this.odoo_context,}).then(function(result){var $tr=$line.parents('.o_account_reports_load_more');$tr.after(result);$tr.remove();self._add_line_classes();});},unfold_all:function(bool){var self=this;var lines=this.$el.find('.js_account_report_foldable');self.report_options.unfolded_lines=[];if(bool){_.each(lines,function(el){self.report_options.unfolded_lines.push($(el).data('id'));});}},trigger_action:function(e){e.stopPropagation();var self=this;var action=$(e.target).attr('action');var id=$(e.target).parents('td').data('id');var params=$(e.target).data();var context=new Context(this.odoo_context,params.actionContext||{},{active_id:id});params=_.omit(params,'actionContext');if(action){return this._rpc({model:this.report_model,method:action,args:[this.financial_id,this.report_options,params],context:context.eval(),}).then(function(result){return self.do_action(result);});}},});core.action_registry.add('account_report',accountReportsWidget);return accountReportsWidget;});;

/* /account_reports/static/src/js/followup_form/followup_form_view.js defined in bundle 'web.assets_backend' */
odoo.define('accountReports.FollowupFormView',function(require){"use strict";var FollowupFormController=require('accountReports.FollowupFormController');var FollowupFormModel=require('accountReports.FollowupFormModel');var FollowupFormRenderer=require('accountReports.FollowupFormRenderer');var FormView=require('web.FormView');var viewRegistry=require('web.view_registry');var FollowupFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Controller:FollowupFormController,Model:FollowupFormModel,Renderer:FollowupFormRenderer,}),searchable:true,});viewRegistry.add('followup_form',FollowupFormView);return FollowupFormView;});;

/* /account_reports/static/src/js/followup_form/followup_form_model.js defined in bundle 'web.assets_backend' */
odoo.define('accountReports.FollowupFormModel',function(require){"use strict";var BasicModel=require('web.BasicModel');var field_utils=require('web.field_utils');var session=require('web.session');var FollowupFormModel=BasicModel.extend({init:function(){this._super.apply(this,arguments);this.numberDone=undefined;this.numberTodo=undefined;this.numberSkipped=undefined;this.currentElementIndex=undefined;},changeBlockedMoveLine:function(moveLineID,blocked){return this._rpc({model:'account.move.line',method:'write_blocked',args:[[moveLineID],blocked]});},changeExpectedDate:function(handle,moveLineID,date){return this._rpc({model:'res.partner',method:'change_expected_date',args:[[this.localData[handle].res_id],{move_line_id:moveLineID,expected_pay_date:date}],});},changeTrust:function(handle,newTrust){return this._rpc({model:'res.partner',method:'write',args:[[this.localData[handle].res_id],{trust:newTrust}],});},getProgressInfos:function(){return{numberDone:this.numberDone,numberTodo:this.numberTodo,currentElementIndex:this.currentElementIndex};},getSkippedPartners:function(){return this.numberSkipped;},increaseNumberDone:function(){this.numberDone++;},increaseNumberSkipped:function(){this.numberSkipped++;},isAutoReminder:function(handle){return this.localData[handle].data.next_action==='auto';},isJobComplete:function(){return this.numberTodo===0;},load:function(params){var self=this;this.modelName=params.modelName;this._computeProgressBar(params.res_id,params.res_ids);return this._super(params).then(function(id){return self._fetch(id);});},reload:function(handle,params){if(params.offset!==undefined||params.currentId!==undefined){this.localData[handle].data.report_manager_id=undefined;}
if(params.offset!==undefined){this.currentElementIndex=params.offset;}
if(params.ids!==undefined&&params.currentId!==undefined){this._computeProgressBar(params.currentId,params.ids);}
var self=this;return this._super(handle,params).then(function(id){return self._fetch(id);});},removeCurrentRecord:function(handle){this.numberTodo--;var index=this.localData[handle].res_ids.indexOf(this.localData[handle].res_id);this.localData[handle].res_ids.splice(index,1);if(this.currentElementIndex>=this.localData[handle].res_ids.length){this.currentElementIndex=this.localData[handle].res_ids.length-1;}
return this.currentElementIndex;},saveSummary:function(handle,text){return this._rpc({model:'account.report.manager',method:'write',args:[this.localData[handle].data.report_manager_id,{summary:text}],});},setAutoReminder:function(handle){var data=this.localData[handle].data;data.next_action='auto';data.next_action_date=data.next_action_date_auto;return data.next_action_date_auto;},setManualReminder:function(handle){this.localData[handle].data.next_action='manual';},setNextActionDate:function(handle,date){this.localData[handle].data.next_action_date=date;},updateNextAction:function(handle){var record=this.localData[handle];var next_action_date=field_utils.parse.date(record.data.next_action_date,{},{});return this._rpc({model:'res.partner',method:'update_next_action',args:[[record.res_id],{next_action_type:record.data.next_action,next_action_date:next_action_date}],});},_computeProgressBar:function(id,records){this.numberTodo=records.length;this.currentElementIndex=records.indexOf(id);this.numberDone=0;this.numberSkipped=0;},_fetch:function(id){var self=this;var params={};if(this.localData[id].data.report_manager_id!==undefined){params.keep_summary=true;}
return this._rpc({model:'account.followup.report',method:'get_followup_informations',args:[this.localData[id].res_id,params],kwargs:{context:session.user_context},}).then(function(data){self.localData[id].data.report_manager_id=data.report_manager_id;self.localData[id].data.followup_html=data.html;if(data.next_action){self.localData[id].data.next_action=data.next_action.type;self.localData[id].data.next_action_date=data.next_action.date;self.localData[id].data.next_action_date_auto=data.next_action.date_auto;}
return self.localData[id].id;});},});return FollowupFormModel;});;

/* /account_reports/static/src/js/followup_form/followup_form_renderer.js defined in bundle 'web.assets_backend' */
odoo.define('accountReports.FollowupFormRenderer',function(require){"use strict";var core=require('web.core');var datepicker=require('web.datepicker');var Dialog=require('web.Dialog');var dom=require('web.dom');var FormRenderer=require('web.FormRenderer');var QWeb=core.qweb;var FollowupFormRenderer=FormRenderer.extend({events:_.extend({},FormRenderer.prototype.events,{'click .o_account_reports_followup_auto':'_onAuto','click .o_account_reports_followup_manual':'_onManual','change *[name="blocked"]':'_onChangeBlocked','click .o_change_expected_date':'_onChangeExpectedDate','click .o_change_trust':'_onChangeTrust','click .o_account_reports_summary':'_onEditSummary','click .js_account_report_save_summary':'_onSaveSummary','click [action]':'_onTriggerAction',}),init:function(){this._super.apply(this,arguments);this.nextActionDatePicker=new datepicker.DateWidget(this);this.nextActionDatePicker.on('datetime_changed',this,function(){this.trigger_up('next_action_date_changed',{newDate:this.nextActionDatePicker.getValue()});});},removeMailAlert:function(){if(this.chatter){this.chatter.trigger_up('reload_mail_fields',{activity:true,thread:true,followers:true});}
this.$('div.alert.alert-info.alert-dismissible').remove();},renderAutoReminder:function(date){this.$('.o_account_reports_next_action_date').html(date);this.$('.o_account_reports_followup_manual').toggleClass('btn-secondary btn-primary');this.$('.o_account_reports_followup_auto').toggleClass('btn-secondary btn-primary');this.$('div.o_account_reports_next_action_date_picker').hide();this.$('.o_account_reports_next_action_date').show();},renderEditSummary:function(){dom.autoresize(this.$('textarea[name="summary"]'));this.$('.o_account_reports_summary_edit').show();this.$('.o_account_reports_summary').hide();this.$('textarea[name="summary"]').focus();},renderMailAlert:function(){this.$('div.o_account_reports_page').prepend(QWeb.render("CustomerStatements.send_mail"));},renderManualReminder:function(){this.$('.o_account_reports_followup_manual').toggleClass('btn-secondary btn-primary');this.$('.o_account_reports_followup_auto').toggleClass('btn-secondary btn-primary');this.$('div.o_account_reports_next_action_date_picker').show();this.$('.o_account_reports_next_action_date').hide();},renderSavedSummary:function(text){this.$('.o_account_reports_summary_edit').hide();this.$('.o_account_reports_summary').show();if(!text){text="<input type='text' class='o_input o_field_widget' name='summary' />";}
this.$('.o_account_report_summary').html('<span>'+text+'</span');},renderTrust:function(newTrust){var colorMap={good:'green',normal:'grey',bad:'red',};var color=colorMap[newTrust];this.$('i.oe-account_followup-trust').attr('style','color: '+color+'; font-size: 0.8em;');},_renderTagFollowup:function(){var $element=$('<div>');$element.html(this.state.data.followup_html);$element.find('.o_account_reports_summary_edit').hide();$element.find('.o_account_reports_no_print').removeClass('container');this.nextActionDatePicker.appendTo($element.find('div.o_account_reports_next_action_date_picker'));this.nextActionDatePicker.setValue(moment());if(this.state.data.next_action==='auto'){$element.find('div.o_account_reports_next_action_date_picker').hide();$element.find('.o_account_reports_followup_manual').addClass('btn-secondary');$element.find('.o_account_reports_followup_auto').addClass('btn-primary');$element.find('.o_account_reports_next_action_date').html(this.state.data.next_action_date_auto);}else{$element.find('.o_account_reports_followup_manual').addClass('btn-primary');$element.find('.o_account_reports_followup_auto').addClass('btn-secondary');$element.find('.o_account_reports_next_action_date').hide();this.nextActionDatePicker.setValue(new moment(this.state.data.next_action_date));}
return $element;},_onAuto:function(){this.trigger_up('on_auto_reminder');},_onChangeBlocked:function(event){var checkbox=$(event.target).is(":checked");var targetID=$(event.target).parents('tr').find('td[data-id]').data('id');this.trigger_up('on_change_block',{checkbox:checkbox,targetID:targetID});},_onChangeExpectedDate:function(event){var self=this;var targetID=parseInt($(event.target).attr('data-id'));var $content=$(QWeb.render("paymentDateForm",{target_id:targetID}));var paymentDatePicker=new datepicker.DateWidget(this);paymentDatePicker.appendTo($content.find('div.o_account_reports_payment_date_picker'));var save=function(){self.trigger_up('expected_date_changed',{newDate:paymentDatePicker.getValue(),moveLineID:parseInt($content.find("#target_id").val())});};new Dialog(this,{title:'Odoo',size:'medium',$content:$content,buttons:[{text:'Save',classes:'btn-primary',close:true,click:save},{text:'Cancel',close:true}]}).open();},_onChangeTrust:function(event){var newTrust=$(event.target).data("new-trust");if(!newTrust){newTrust=$(event.target).parents('a.o_change_trust').data("new-trust");}
this.trigger_up('on_change_trust',{newTrust:newTrust});},_onEditSummary:function(){this.renderEditSummary();},_onManual:function(){this.trigger_up('on_manual_reminder');},_onSaveSummary:function(event){var text=$(event.target).siblings().val().replace(/[ \t]+/g,' ');this.trigger_up('on_save_summary',{text:text});},_onTriggerAction:function(event){event.stopPropagation();var actionName=$(event.target).attr('action');var resId=parseInt($(event.target).attr('data-id'));var view=parseInt($(event.target).attr('view-id'));this.trigger_up('on_trigger_action',{actionName:actionName,resId:resId,view:view});},});return FollowupFormRenderer;});;

/* /account_reports/static/src/js/followup_form/followup_form_controller.js defined in bundle 'web.assets_backend' */
odoo.define('accountReports.FollowupFormController',function(require){"use strict";var core=require('web.core');var FormController=require('web.FormController');var _t=core._t;var QWeb=core.qweb;var FollowupFormController=FormController.extend({custom_events:_.extend({},FormController.prototype.custom_events,{expected_date_changed:'_onExpectedDateChanged',next_action_date_changed:'_onNextActionDateChanged',on_auto_reminder:'_onAutoReminder',on_change_block:'_onChangeBlocked',on_change_trust:'_onChangeTrust',on_manual_reminder:'_onManualReminder',on_save_summary:'_onSaveSummary',on_trigger_action:'_onTriggerAction'}),init:function(){this._super.apply(this,arguments);delete this.searchView;this.hasSidebar=false;},renderButtons:function($node){this.$buttons=$(QWeb.render("CustomerStatements.buttons",{widget:this}));this.$buttons.on('click','.o_account_reports_followup_print_letter_button',this._onPrintLetter.bind(this));this.$buttons.on('click','.o_account_reports_followup_send_mail_button',this._onSendMail.bind(this));this.$buttons.on('click','.o_account_reports_followup_do_it_later_button',this._onDoItLater.bind(this));this.$buttons.on('click','.o_account_reports_followup_done_button',this._onDone.bind(this));this.$buttons.appendTo($node);},_checkDone:function(){if(this.model.isJobComplete()){var message=_.str.sprintf(_t('You are done with the follow-ups!<br/>You have skipped %s partner(s).'),this.model.getSkippedPartners(this.handle));this.trigger_up('show_effect',{type:'rainbow_man',fadeout:'no',message:message,});}},_displayDone:function(){this.$buttons.find('button.o_account_reports_followup_done_button').show();this.renderer.removeMailAlert();},_displayNextFollowup:function(){var currentIndex=this.model.removeCurrentRecord(this.handle);var params={limit:1,offset:currentIndex,};this.update(params);this.$buttons.find('button.o_account_reports_followup_done_button').hide();this._checkDone();},_removeHighlightEmail:function(){this.$buttons.find('button.o_account_reports_followup_send_mail_button').removeClass('btn-primary').addClass('btn-secondary');},_removeHighlightPrint:function(){this.$buttons.find('button.o_account_reports_followup_print_letter_button').removeClass('btn-primary').addClass('btn-secondary');},_update:function(){var self=this;return this._super.apply(this,arguments).then(function(){self._updateSearchView();});},_updatePager:function(){if(this.pager){var progressInfo=this.model.getProgressInfos();this.pager.updateState({current_min:progressInfo.currentElementIndex+1,size:progressInfo.numberTodo,});this.pager.do_toggle(true);}},_updateSearchView:function(){var progressInfo=this.model.getProgressInfos();var total=progressInfo.numberDone+progressInfo.numberTodo;this.$searchview=$(QWeb.render("CustomerStatements.followupProgressbar",{current:progressInfo.numberDone,max:progressInfo.numberDone+progressInfo.numberTodo,percent:(progressInfo.numberDone/total*100),}));this.update_control_panel({cp_content:{$searchview:this.$searchview,$searchview_buttons:$(),}},{clear:false,});},_onAutoReminder:function(){if(this.model.isAutoReminder(this.handle)){return;}
var date=this.model.setAutoReminder(this.handle);this.renderer.renderAutoReminder(date);},_onChangeBlocked:function(event){var self=this;var checkbox=event.data.checkbox;var targetID=event.data.targetID;this.model.changeBlockedMoveLine(parseInt(targetID),checkbox).then(function(){self.reload();});},_onChangeTrust:function(event){var self=this;var newTrust=event.data.newTrust;this.model.changeTrust(this.handle,newTrust).then(function(){self.renderer.renderTrust(newTrust);});},_onDoItLater:function(){var self=this;this.model.updateNextAction(this.handle).then(function(){self.model.increaseNumberSkipped();self._displayNextFollowup();});},_onDone:function(){var self=this;this.model.updateNextAction(this.handle).then(function(){self.model.increaseNumberDone();self._displayNextFollowup();});},_onExpectedDateChanged:function(event){event.stopPropagation();var self=this;this.model.changeExpectedDate(this.handle,event.data.moveLineID,event.data.newDate).then(function(){self.reload();});},_onManualReminder:function(){if(!this.model.isAutoReminder(this.handle)){return;}
this.model.setManualReminder(this.handle);this.renderer.renderManualReminder();},_onNextActionDateChanged:function(event){event.stopPropagation();this.model.setNextActionDate(this.handle,event.data.newDate);},_onPrintLetter:function(){var self=this;var partnerID=this.model.get(this.handle,{raw:true}).res_id;var records={ids:[partnerID],};this._rpc({model:'account.followup.report',method:'print_followups',args:[records],}).then(function(result){self.do_action(result);self._removeHighlightPrint();self._displayDone();});},_onSaveSummary:function(event){var self=this;var text=event.data.text;this.model.saveSummary(this.handle,text).then(function(){self.renderer.renderSavedSummary(text);});},_onSendMail:function(){var self=this;var partnerID=this.model.get(this.handle,{raw:true}).res_id;this.options={};this.options.partner_id=partnerID;this._rpc({model:'account.followup.report',method:'send_email',args:[this.options],}).then(function(){self._removeHighlightEmail();self._displayDone();self.renderer.renderMailAlert();});},_onTriggerAction:function(event){event.stopPropagation();var actionName=event.data.actionName;var action={type:'ir.actions.act_window',views:[[false,'form']],target:'current',};switch(actionName){case"open_partner_form":_.extend(action,{res_model:'res.partner',res_id:this.model.localData[this.handle].res_id,});break;case"open_invoice":_.extend(action,{res_model:'account.invoice',res_id:event.data.resId,views:[[event.data.view,'form']],});break;case"open_move":_.extend(action,{res_model:'account.move',res_id:event.data.resId,});break;default:action=undefined;}
if(action){this.do_action(action);}},});return FollowupFormController;});;

/* /account_reports/static/src/js/account_reports_tours.js defined in bundle 'web.assets_backend' */
odoo.define('account_reports.tour',function(require){'use strict';var Tour=require('web_tour.tour');Tour.register('account_followup_reports_widgets',{test:true,url:'/web#action=account_reports.action_view_list_customer_statements',},[{content:'wait for web client',trigger:".o_list_view",extra_trigger:".breadcrumb",run:function(){}},{content:'click first item',trigger:".o_list_view .o_data_row",run:'click'},{content:'click trust ball',trigger:'#trustDropdown',run:'click'},{content:'change trust',trigger:'.o_change_trust[data-new-trust="good"]',run:'click'},{content:'send by mail',trigger:'.o_account_reports_followup_send_mail_button',run:'click'},{content:'check that message telling that mail has been sent is shown',trigger:'.alert:contains(The follow-up report was successfully emailed!)',run:function(){}},{content:'dismiss alert',trigger:'.alert .close',run:'click'},{content:'Click the Do it later button',trigger:'.o_account_reports_followup_do_it_later_button',run:'click'},]);});;

/* /account_reports/static/src/js/action_manager_account_report_dl.js defined in bundle 'web.assets_backend' */
odoo.define('account_reports.ActionManager',function(require){"use strict";var ActionManager=require('web.ActionManager');var crash_manager=require('web.crash_manager');var framework=require('web.framework');var session=require('web.session');ActionManager.include({_executeAccountReportDownloadAction:function(action){framework.blockUI();var def=$.Deferred();session.get_file({url:'/account_reports',data:action.data,success:def.resolve.bind(def),error:function(){crash_manager.rpc_error.apply(crash_manager,arguments);def.reject();},complete:framework.unblockUI,});return def;},_handleAction:function(action,options){if(action.type==='ir_actions_account_report_download'){return this._executeAccountReportDownloadAction(action,options);}
return this._super.apply(this,arguments);},});});;

/* /barcodes/static/src/js/barcode_parser.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.BarcodeParser',function(require){"use strict";var Class=require('web.Class');var rpc=require('web.rpc');var BarcodeParser=Class.extend({init:function(attributes){this.nomenclature_id=attributes.nomenclature_id;this.loaded=this.load();},load:function(){var self=this;if(!this.nomenclature_id){return;}
var id=this.nomenclature_id[0];rpc.query({model:'barcode.nomenclature',method:'read',args:[[id],['name','rule_ids','upc_ean_conv']],}).then(function(nomenclatures){self.nomenclature=nomenclatures[0];var args=[[['barcode_nomenclature_id','=',self.nomenclature.id]],['name','sequence','type','encoding','pattern','alias'],];return rpc.query({model:'barcode.rule',method:'search_read',args:args,});}).then(function(rules){rules=rules.sort(function(a,b){return a.sequence-b.sequence;});self.nomenclature.rules=rules;});},is_loaded:function(){return this.loaded;},ean_checksum:function(ean){var code=ean.split('');if(code.length!==13){return-1;}
var oddsum=0,evensum=0,total=0;code=code.reverse().splice(1);for(var i=0;i<code.length;i++){if(i%2===0){oddsum+=Number(code[i]);}else{evensum+=Number(code[i]);}}
total=oddsum*3+evensum;return Number((10-total%10)%10);},ean8_checksum:function(ean){var code=ean.split('');if(code.length!==8){return-1;}
var sum1=Number(code[1])+Number(code[3])+Number(code[5]);var sum2=Number(code[0])+Number(code[2])+Number(code[4])+Number(code[6]);var total=sum1+3*sum2;return Number((10-total%10)%10);},check_ean:function(ean){return/^\d+$/.test(ean)&&this.ean_checksum(ean)===Number(ean[ean.length-1]);},check_encoding:function(barcode,encoding){var len=barcode.length;var allnum=/^\d+$/.test(barcode);var check=Number(barcode[len-1]);if(encoding==='ean13'){return len===13&&allnum&&this.ean_checksum(barcode)===check;}else if(encoding==='ean8'){return len===8&&allnum&&this.ean8_checksum(barcode)===check;}else if(encoding==='upca'){return len===12&&allnum&&this.ean_checksum('0'+barcode)===check;}else if(encoding==='any'){return true;}else{return false;}},sanitize_ean:function(ean){ean=ean.substr(0,13);for(var n=0,count=(13-ean.length);n<count;n++){ean='0'+ean;}
return ean.substr(0,12)+this.ean_checksum(ean);},sanitize_upc:function(upc){return this.sanitize_ean('0'+upc).substr(1,12);},match_pattern:function(barcode,pattern,encoding){var match={value:0,base_code:barcode,match:false,};barcode=barcode.replace("\\","\\\\").replace("{",'\{').replace("}","\}").replace(".","\.");var numerical_content=pattern.match(/[{][N]*[D]*[}]/);var base_pattern=pattern;if(numerical_content){var num_start=numerical_content.index;var num_length=numerical_content[0].length;var value_string=barcode.substr(num_start,num_length-2);var whole_part_match=numerical_content[0].match("[{][N]*[D}]");var decimal_part_match=numerical_content[0].match("[{N][D]*[}]");var whole_part=value_string.substr(0,whole_part_match.index+whole_part_match[0].length-2);var decimal_part="0."+value_string.substr(decimal_part_match.index,decimal_part_match[0].length-1);if(whole_part===''){whole_part='0';}
match['value']=parseInt(whole_part)+parseFloat(decimal_part);match['base_code']=barcode.substr(0,num_start);var base_pattern=pattern.substr(0,num_start);for(var i=0;i<(num_length-2);i++){match['base_code']+="0";base_pattern+="0";}
match['base_code']+=barcode.substr(num_start+num_length-2,barcode.length-1);base_pattern+=pattern.substr(num_start+num_length,pattern.length-1);match['base_code']=match['base_code'].replace("\\\\","\\").replace("\{","{").replace("\}","}").replace("\.",".");var base_code=match.base_code.split('')
if(encoding==='ean13'){base_code[12]=''+this.ean_checksum(match.base_code);}else if(encoding==='ean8'){base_code[7]=''+this.ean8_checksum(match.base_code);}else if(encoding==='upca'){base_code[11]=''+this.ean_checksum('0'+match.base_code);}
match.base_code=base_code.join('')}
if(base_pattern[0]!=='^'){base_pattern="^"+base_pattern;}
match.match=match.base_code.match(base_pattern);return match;},parse_barcode:function(barcode){var parsed_result={encoding:'',type:'error',code:barcode,base_code:barcode,value:0,};if(!this.nomenclature){return parsed_result;}
var rules=this.nomenclature.rules;for(var i=0;i<rules.length;i++){var rule=rules[i];var cur_barcode=barcode;if(rule.encoding==='ean13'&&this.check_encoding(barcode,'upca')&&this.nomenclature.upc_ean_conv in{'upc2ean':'','always':''}){cur_barcode='0'+cur_barcode;}else if(rule.encoding==='upca'&&this.check_encoding(barcode,'ean13')&&barcode[0]==='0'&&this.upc_ean_conv in{'ean2upc':'','always':''}){cur_barcode=cur_barcode.substr(1,12);}
if(!this.check_encoding(cur_barcode,rule.encoding)){continue;}
var match=this.match_pattern(cur_barcode,rules[i].pattern,rule.encoding);if(match.match){if(rules[i].type==='alias'){barcode=rules[i].alias;parsed_result.code=barcode;parsed_result.type='alias';}
else{parsed_result.encoding=rules[i].encoding;parsed_result.type=rules[i].type;parsed_result.value=match.value;parsed_result.code=cur_barcode;if(rules[i].encoding==="ean13"){parsed_result.base_code=this.sanitize_ean(match.base_code);}
else{parsed_result.base_code=match.base_code;}
return parsed_result;}}}
return parsed_result;},});return BarcodeParser;});;

/* /barcodes/static/src/js/barcode_events.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.BarcodeEvents',function(require){"use strict";var core=require('web.core');var mixins=require('web.mixins');var session=require('web.session');function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent('CustomEvent');evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt;}
CustomEvent.prototype=window.Event.prototype;var BarcodeEvents=core.Class.extend(mixins.PropertiesMixin,{timeout:null,key_pressed:{},buffered_key_events:[],regexp:/(.{3,})[\n\r\t]*/,suffix:/[\n\r\t]+/,max_time_between_keys_in_ms:session.max_time_between_keys_in_ms||55,inputTimeOut:800,init:function(){mixins.PropertiesMixin.init.call(this);this.__keydown_handler=_.bind(this.keydown_handler,this);this.__keyup_handler=_.bind(this.keyup_handler,this);this.__handler=_.bind(this.handler,this);$(_.bind(this.start,this,false));var isMobile=navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i);this.isChromeMobile=isMobile&&navigator.userAgent.match(/Chrome/i);this.$barcodeInput=$('<input/>',{name:'barcode',type:'text',css:{'position':'fixed','top':'50%','transform':'translateY(-50%)','z-index':'-1','opacity':'0',},});this.$barcodeInput.attr('autocomplete','off');this.__blurBarcodeInput=_.debounce(this._blurBarcodeInput,this.inputTimeOut);},handle_buffered_keys:function(){var str=this.buffered_key_events.reduce(function(memo,e){return memo+String.fromCharCode(e.which)},'');var match=str.match(this.regexp);if(match){var barcode=match[1];core.bus.trigger('barcode_scanned',barcode,this.buffered_key_events[0].target);if(this.buffered_key_events[0].target.getAttribute("barcode_events")==="true")
$(this.buffered_key_events[0].target).trigger('barcode_scanned',barcode);}else{this.resend_buffered_keys();}
this.buffered_key_events=[];},resend_buffered_keys:function(){var old_event,new_event;for(var i=0;i<this.buffered_key_events.length;i++){old_event=this.buffered_key_events[i];if(old_event.which!==13){var params={'bubbles':old_event.bubbles,'cancelable':old_event.cancelable,};new_event=$.Event('keypress',params);new_event.viewArg=old_event.viewArg;new_event.ctrl=old_event.ctrl;new_event.alt=old_event.alt;new_event.shift=old_event.shift;new_event.meta=old_event.meta;new_event.char=old_event.char;new_event.key=old_event.key;new_event.charCode=old_event.charCode;new_event.keyCode=old_event.keyCode||old_event.which;new_event.which=old_event.which;new_event.dispatched_by_barcode_reader=true;$(old_event.target).trigger(new_event);}}},element_is_editable:function(element){return $(element).is('input,textarea,[contenteditable="true"]');},is_special_key:function(e){if(e.key==="ArrowLeft"||e.key==="ArrowRight"||e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="Escape"||e.key==="Tab"||e.key==="Backspace"||e.key==="Delete"||e.key==="Home"||e.key==="End"||e.key==="PageUp"||e.key==="PageDown"||e.key==="Unidentified"||/F\d\d?/.test(e.key)){return true;}else{return false;}},keydown_handler:function(e){if(this.key_pressed[e.which]){e.preventDefault();}else{this.key_pressed[e.which]=true;}},keyup_handler:function(e){this.key_pressed[e.which]=false;},handler:function(e){if(e.dispatched_by_barcode_reader)
return;if(this.is_special_key(e))
return;if(e.ctrlKey||e.metaKey||e.altKey)
return;if(e.which===13&&this.buffered_key_events.length===0)
return;if((this.element_is_editable(e.target)&&!$(e.target).data('enableBarcode'))&&e.target.getAttribute("barcode_events")!=="true")
return;this.buffered_key_events.push(e);e.preventDefault();e.stopImmediatePropagation();clearTimeout(this.timeout);if(String.fromCharCode(e.which).match(this.suffix)){this.handle_buffered_keys();}else{this.timeout=setTimeout(_.bind(this.handle_buffered_keys,this),this.max_time_between_keys_in_ms);}},_listenBarcodeScanner:function(e){if($(document.activeElement).not('input:text, textarea, [contenteditable], '+'[type="email"], [type="number"], [type="password"], [type="tel"], [type="search"]').length){$('body').append(this.$barcodeInput);this.$barcodeInput.focus();}
if(this.$barcodeInput.is(":focus")){clearTimeout(this.timeout);if(String.fromCharCode(e.which).match(this.suffix)){this._handleBarcodeValue(e);}else{this.timeout=setTimeout(this._handleBarcodeValue.bind(this,e),this.max_time_between_keys_in_ms);}
this.__blurBarcodeInput();}},_handleBarcodeValue:function(e){var barcodeValue=this.$barcodeInput.val();if(barcodeValue.match(this.regexp)){core.bus.trigger('barcode_scanned',barcodeValue,$(e.target).parent()[0]);this._blurBarcodeInput();}},_blurBarcodeInput:function(){this.$barcodeInput.val('').blur();},start:function(prevent_key_repeat){if(this.isChromeMobile){$('body').on("keydown",this._listenBarcodeScanner.bind(this));}else{$('body').bind("keypress",this.__handler);}
if(prevent_key_repeat===true){$('body').bind("keydown",this.__keydown_handler);$('body').bind('keyup',this.__keyup_handler);}},stop:function(){$('body').unbind("keypress",this.__handler);$('body').unbind("keydown",this.__keydown_handler);$('body').unbind('keyup',this.__keyup_handler);},});return{BarcodeEvents:new BarcodeEvents(),ReservedBarcodePrefixes:['O-CMD'],};});;

/* /barcodes/static/src/js/barcode_form_view.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.FormView',function(require){"use strict";var BarcodeEvents=require('barcodes.BarcodeEvents');var concurrency=require('web.concurrency');var core=require('web.core');var Dialog=require('web.Dialog');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var _t=core._t;FormController.include({custom_events:_.extend({},FormController.prototype.custom_events,{activeBarcode:'_barcodeActivated',}),init:function(){this._super.apply(this,arguments);this.activeBarcode={form_view:{commands:{'O-CMD.EDIT':this._barcodeEdit.bind(this),'O-CMD.DISCARD':this._barcodeDiscard.bind(this),'O-CMD.SAVE':this._barcodeSave.bind(this),'O-CMD.PREV':this._barcodePagerPrevious.bind(this),'O-CMD.NEXT':this._barcodePagerNext.bind(this),'O-CMD.PAGER-FIRST':this._barcodePagerFirst.bind(this),'O-CMD.PAGER-LAST':this._barcodePagerLast.bind(this),},},};this.barcodeMutex=new concurrency.Mutex();this._barcodeStartListening();},destroy:function(){this._barcodeStopListening();this._super();},_barcodeAddX2MQuantity:function(barcode,activeBarcode){if(this.mode==='readonly'){this.do_warn(_t('Error: Document not editable'),_t('To modify this document, please first start edition.'));return new $.Deferred().reject();}
var record=this.model.get(this.handle);var candidate=this._getBarCodeRecord(record,barcode,activeBarcode);if(candidate){return this._barcodeSelectedCandidate(candidate,record,barcode,activeBarcode);}else{return this._barcodeWithoutCandidate(record,barcode,activeBarcode);}},_barcodeDiscard:function(){return this.discardChanges();},_barcodeEdit:function(){return this._setMode('edit');},_barcodePagerFirst:function(){var self=this;return this.mutex.exec(function(){}).then(function(){if(!self.pager){self.do_warn(_t('Error: Pager not available'));return;}
self.pager.updateState({current_min:1,},{notifyChange:true});});},_barcodePagerLast:function(){var self=this;return this.mutex.exec(function(){}).then(function(){if(!self.pager){self.do_warn(_t('Error: Pager not available'));return;}
var state=self.model.get(self.handle,{raw:true});self.pager.updateState({current_min:state.count,},{notifyChange:true});});},_barcodePagerNext:function(){var self=this;return this.mutex.exec(function(){}).then(function(){if(!self.pager){self.do_warn(_t('Error: Pager not available'));return;}
self.pager.next();});},_barcodePagerPrevious:function(){var self=this;return this.mutex.exec(function(){}).then(function(){if(!self.pager){self.do_warn(_t('Error: Pager not available'));return;}
self.pager.previous();});},_barcodeRecordFilter:function(candidate,barcode,activeBarcode){return candidate.data.product_barcode===barcode;},_barcodeSave:function(){return this.saveRecord();},_barcodeSelectedCandidate:function(candidate,record,barcode,activeBarcode,quantity){var changes={};var candidateChanges={};candidateChanges[activeBarcode.quantity]=quantity?quantity:candidate.data[activeBarcode.quantity]+1;changes[activeBarcode.fieldName]={operation:'UPDATE',id:candidate.id,data:candidateChanges,};return this.model.notifyChanges(this.handle,changes,{notifyChange:activeBarcode.notifyChange});},_barcodeStartListening:function(){core.bus.on('barcode_scanned',this,this._barcodeScanned);core.bus.on('keypress',this,this._quantityListener);},_barcodeStopListening:function(){core.bus.off('barcode_scanned',this,this._barcodeScanned);core.bus.off('keypress',this,this._quantityListener);},_barcodeWithoutCandidate:function(record,barcode,activeBarcode){var changes={};changes[activeBarcode.name]=barcode;return this.model.notifyChanges(record.id,changes);},_getBarCodeRecord:function(record,barcode,activeBarcode){var self=this;if(!activeBarcode.fieldName||!record.data[activeBarcode.fieldName]){return;}
return _.find(record.data[activeBarcode.fieldName].data,function(record){return self._barcodeRecordFilter(record,barcode,activeBarcode);});},_barcodeActivated:function(event){event.stopPropagation();var name=event.data.name;this.activeBarcode[name]={name:name,handle:this.handle,target:event.target,widget:event.target.attrs&&event.target.attrs.widget,setQuantityWithKeypress:!!event.data.setQuantityWithKeypress,fieldName:event.data.fieldName,notifyChange:(event.data.notifyChange!==undefined)?event.data.notifyChange:true,quantity:event.data.quantity,commands:event.data.commands||{},candidate:this.activeBarcode[name]&&this.activeBarcode[name].handle===this.handle?this.activeBarcode[name].candidate:null,};this.disableAutofocus=true;},_barcodeActiveScanned:function(method,barcode,activeBarcode){var self=this;var methodDef;var def=new $.Deferred();if(typeof method==='string'){methodDef=this[method](barcode,activeBarcode);}else{methodDef=method.call(this,barcode,activeBarcode);}
methodDef.done(function(){var record=self.model.get(self.handle);var candidate=self._getBarCodeRecord(record,barcode,activeBarcode);activeBarcode.candidate=candidate;}).always(function(){def.resolve();});return def;},_barcodeScanned:function(barcode,target){var self=this;return this.barcodeMutex.exec(function(){var prefixed=_.any(BarcodeEvents.ReservedBarcodePrefixes,function(reserved){return barcode.indexOf(reserved)===0;});var hasCommand=false;var defs=[];if(!$.contains(target,self.el)){return;}
for(var k in self.activeBarcode){var activeBarcode=self.activeBarcode[k];var methods=self.activeBarcode[k].commands;var method=prefixed?methods[barcode]:methods.barcode;if(method){if(prefixed){hasCommand=true;}
defs.push(self._barcodeActiveScanned(method,barcode,activeBarcode));}}
if(prefixed&&!hasCommand){self.do_warn(_t('Error: Barcode command is undefined'),barcode);}
return self.alive($.when.apply($,defs)).then(function(){if(!prefixed){self.current_barcode=barcode;self.update({},{reload:false});}});});},_quantityListener:function(event){var character=String.fromCharCode(event.which);if(!$.contains(event.target,this.el)){return;}
if(!$(event.target).is('body, .modal')||!/[0-9]/.test(character)){return;}
var barcodeInfos=_.filter(this.activeBarcode,'setQuantityWithKeypress');if(!barcodeInfos.length){return;}
if(!_.compact(_.pluck(barcodeInfos,'candidate')).length){return this.do_warn(_t('Error: No last scanned barcode'),_t('To set the quantity please scan a barcode first.'));}
for(var k in this.activeBarcode){if(this.activeBarcode[k].candidate){this._quantityOpenDialog(character,this.activeBarcode[k]);}}},_quantityOpenDialog:function(character,activeBarcode){var self=this;var $content=$('<div>').append($('<input>',{type:'text',class:'o_set_qty_input'}));this.dialog=new Dialog(this,{title:_t('Set quantity'),buttons:[{text:_t('Select'),classes:'btn-primary',close:true,click:function(){var new_qty=this.$content.find('.o_set_qty_input').val();var record=self.model.get(self.handle);return self._barcodeSelectedCandidate(activeBarcode.candidate,record,self.current_barcode,activeBarcode,parseFloat(new_qty)).then(function(){self.update({},{reload:false});});}},{text:_t('Discard'),close:true}],$content:$content,});this.dialog.opened().then(function(){var $input=self.dialog.$('.o_set_qty_input').focus().val(character);var $selectBtn=self.dialog.$footer.find('.btn-primary');$input.on('keypress',function(event){if(event.which===13){event.preventDefault();$input.off();$selectBtn.click();}});});this.dialog.open();},});FormRenderer.include({_barcodeButtonHandler:function($button,node){var commands={};commands.barcode=function(){return $.when();};commands['O-BTN.'+node.attrs.barcode_trigger]=function(){if(!$button.hasClass('o_invisible_modifier')){$button.click();}
return $.when();};var name=node.attrs.name;if(node.attrs.string){name=name+'_'+node.attrs.string;}
this.trigger_up('activeBarcode',{name:name,commands:commands});},_renderHeaderButton:function(node){var $button=this._super.apply(this,arguments);if(node.attrs.barcode_trigger){this._barcodeButtonHandler($button,node);}
return $button;},_renderStatButton:function(node){var $button=this._super.apply(this,arguments);if(node.attrs.barcode_trigger){this._barcodeButtonHandler($button,node);}
return $button;},_renderTagButton:function(node){var $button=this._super.apply(this,arguments);if(node.attrs.barcode_trigger){this._barcodeButtonHandler($button,node);}
return $button;}});BarcodeEvents.ReservedBarcodePrefixes.push('O-BTN');});;

/* /barcodes/static/src/js/barcode_field.js defined in bundle 'web.assets_backend' */
odoo.define('barcodes.field',function(require){"use strict";var AbstractField=require('web.AbstractField');var basicFields=require('web.basic_fields');var fieldRegistry=require('web.field_registry');var BarcodeEvents=require('barcodes.BarcodeEvents').BarcodeEvents;var FieldFloatScannable=basicFields.FieldFloat.extend({events:_.extend({},basicFields.FieldFloat.prototype.events,{'keypress':'_onKeypress',}),_renderEdit:function(){var self=this;$.when(this._super()).then(function(){self.$input.data('enableBarcode',true);});},_onKeypress:function(e){if(e.dispatched_by_barcode_reader!==true){if(!BarcodeEvents.is_special_key(e)){e.preventDefault();}
return;}
var character=String.fromCharCode(e.which);var current_str=e.target.value;var str_before_carret=current_str.substring(0,e.target.selectionStart);var str_after_carret=current_str.substring(e.target.selectionEnd);e.target.value=str_before_carret+character+str_after_carret;var new_carret_index=str_before_carret.length+character.length;e.target.setSelectionRange(new_carret_index,new_carret_index);$(e.target).trigger('input');},});var FormViewBarcodeHandler=AbstractField.extend({init:function(){this._super.apply(this,arguments);this.trigger_up('activeBarcode',{name:this.name,commands:{barcode:'_barcodeAddX2MQuantity',}});},});fieldRegistry.add('field_float_scannable',FieldFloatScannable);fieldRegistry.add('barcode_handler',FormViewBarcodeHandler);return{FieldFloatScannable:FieldFloatScannable,FormViewBarcodeHandler:FormViewBarcodeHandler,};});;

/* /stock/static/tests/route_tour.js defined in bundle 'web.assets_backend' */
odoo.define('stock.tour',function(require){'use strict';var tour=require('web_tour.tour');tour.register('stock',{test:true,url:'/web?debug=1#action=stock.action_stock_config_settings',},[{content:"wait web client",trigger:".o_base_settings",run:function(){}},{content:"active 'Multi-Step Routes'",trigger:'.o_field_boolean[name="group_stock_adv_location"]',run:function(){if(!this.$anchor.find('input').prop('checked')){this.$anchor.find('label').click();$('.o_statusbar_buttons button[name="execute"]').click();}}},{content:"list of product variants",trigger:'.o_menu_sections [data-menu-xmlid="stock.menu_product_variant_config_stock"]',extra_trigger:'.o_menu_sections:has(a[data-menu-xmlid="stock.menu_routes_config"])',timeout:5000,},{content:"select a product variant",trigger:'.oe_kanban_global_click:first',},{content:"click on routes",trigger:'button.oe_stat_button i.fa-cogs',},{content:"print the report",trigger:'button[name="print_report"]',},{content:"print inside the report and check the breadcrum",trigger:'.o_content iframe .o_report_stock_rule_rule_name',extra_trigger:'ol.breadcrumb li:eq(2).active',},{content:"print the report",trigger:'ol.breadcrumb li:eq(3).active',},]);});;

/* /stock/static/src/js/stock_traceability_report_backend.js defined in bundle 'web.assets_backend' */
odoo.define('stock.stock_report_generic',function(require){'use strict';var AbstractAction=require('web.AbstractAction');var core=require('web.core');var session=require('web.session');var ControlPanelMixin=require('web.ControlPanelMixin');var session=require('web.session');var ReportWidget=require('stock.ReportWidget');var framework=require('web.framework');var crash_manager=require('web.crash_manager');var QWeb=core.qweb;var stock_report_generic=AbstractAction.extend(ControlPanelMixin,{init:function(parent,action){this.actionManager=parent;this.given_context=_.extend({},session.user_context);this.controller_url=action.context.url;if(action.context.context){this.given_context=action.context.context;}
this.given_context.active_id=action.context.active_id||action.params.active_id;this.given_context.model=action.context.active_model||false;this.given_context.ttype=action.context.ttype||false;this.given_context.auto_unfold=action.context.auto_unfold||false;this.given_context.lot_name=action.context.lot_name||false;return this._super.apply(this,arguments);},willStart:function(){return this.get_html();},set_html:function(){var self=this;var def=$.when();if(!this.report_widget){this.report_widget=new ReportWidget(this,this.given_context);def=this.report_widget.appendTo(this.$el);}
return def.then(function(){self.report_widget.$el.html(self.html);self.report_widget.$el.find('.o_report_heading').html('<h1>Traceability Report</h1>');if(self.given_context.auto_unfold){_.each(self.$el.find('.fa-caret-right'),function(line){self.report_widget.autounfold(line,self.given_context.lot_name);});}});},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.set_html();});},get_html:function(){var self=this;var defs=[];return this._rpc({model:'stock.traceability.report',method:'get_html',args:[self.given_context],}).then(function(result){self.html=result.html;self.renderButtons();defs.push(self.update_cp());return $.when.apply($,defs);});},update_cp:function(){if(!this.$buttons){this.renderButtons();}
var status={cp_content:{$buttons:this.$buttons},};return this.update_control_panel(status);},renderButtons:function(){var self=this;this.$buttons=$(QWeb.render("stockReports.buttons",{}));this.$buttons.bind('click',function(){var $element=$(self.$el[0]).find('.o_stock_reports_table tbody tr');var dict=[];$element.each(function(index){var $el=$($element[index]);dict.push({'id':$el.data('id'),'model_id':$el.data('model_id'),'model_name':$el.data('model'),'unfoldable':$el.data('unfold'),'level':$el.find('td:first').data('level')||1});});framework.blockUI();var url_data=self.controller_url.replace('active_id',self.given_context.active_id);session.get_file({url:url_data.replace('output_format','pdf'),data:{data:JSON.stringify(dict)},complete:framework.unblockUI,error:crash_manager.rpc_error.bind(crash_manager),});});return this.$buttons;},do_show:function(){this._super();this.update_cp();},});core.action_registry.add("stock_report_generic",stock_report_generic);return stock_report_generic;});;

/* /stock/static/src/js/stock_traceability_report_widgets.js defined in bundle 'web.assets_backend' */
odoo.define('stock.ReportWidget',function(require){'use strict';var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var ReportWidget=Widget.extend({events:{'click span.o_stock_reports_foldable':'fold','click span.o_stock_reports_unfoldable':'unfold','click .o_stock_reports_web_action':'boundLink','click .o_stock_reports_stream':'updownStream','click .o_stock_report_lot_action':'actionOpenLot'},init:function(parent){this._super.apply(this,arguments);},start:function(){QWeb.add_template("/stock/static/src/xml/stock_traceability_report_line.xml");return this._super.apply(this,arguments);},boundLink:function(e){e.preventDefault();return this.do_action({type:'ir.actions.act_window',res_model:$(e.target).data('res-model'),res_id:$(e.target).data('active-id'),views:[[false,'form']],target:'current'});},actionOpenLot:function(e){e.preventDefault();var $el=$(e.target).parents('tr');this.do_action({type:'ir.actions.client',tag:'stock_report_generic',name:$el.data('lot_name')!==undefined&&$el.data('lot_name').toString(),context:{active_id:$el.data('lot_id'),active_model:'stock.production.lot',url:'/stock/output_format/stock/active_id'},});},updownStream:function(e){var $el=$(e.target).parents('tr');this.do_action({type:"ir.actions.client",tag:'stock_report_generic',name:_t("Traceability Report"),context:{active_id:$el.data('model_id'),active_model:$el.data('model'),auto_unfold:true,lot_name:$el.data('lot_name')!==undefined&&$el.data('lot_name').toString(),url:'/stock/output_format/stock/active_id'},});},removeLine:function(element){var self=this;var el,$el;var rec_id=element.data('id');var $stockEl=element.nextAll('tr[data-parent_id='+rec_id+']')
for(el in $stockEl){$el=$($stockEl[el]).find(".o_stock_reports_domain_line_0, .o_stock_reports_domain_line_1");if($el.length===0){break;}
else{var $nextEls=$($el[0]).parents("tr");self.removeLine($nextEls);$nextEls.remove();}
$el.remove();}
return true;},fold:function(e){this.removeLine($(e.target).parents('tr'));var active_id=$(e.target).parents('tr').find('td.o_stock_reports_foldable').data('id');$(e.target).parents('tr').find('td.o_stock_reports_foldable').attr('class','o_stock_reports_unfoldable '+active_id);$(e.target).parents('tr').find('span.o_stock_reports_foldable').replaceWith(QWeb.render("unfoldable",{lineId:active_id}));$(e.target).parents('tr').toggleClass('o_stock_reports_unfolded');},autounfold:function(target,lot_name){var self=this;var $CurretElement;$CurretElement=$(target).parents('tr').find('td.o_stock_reports_unfoldable');var active_id=$CurretElement.data('id');var active_model_name=$CurretElement.data('model');var active_model_id=$CurretElement.data('model_id');var row_level=$CurretElement.data('level');var $cursor=$(target).parents('tr');this._rpc({model:'stock.traceability.report',method:'get_lines',args:[parseInt(active_id,10)],kwargs:{'model_id':active_model_id,'model_name':active_model_name,'level':parseInt(row_level)+30||1},}).then(function(lines){_.each(lines,function(line){$cursor.after(QWeb.render("report_mrp_line",{l:line}));$cursor=$cursor.next();if($cursor&&line.unfoldable&&line.lot_name==lot_name){self.autounfold($cursor.find(".fa-caret-right"),lot_name);}});});$CurretElement.attr('class','o_stock_reports_foldable '+active_id);$(target).parents('tr').find('span.o_stock_reports_unfoldable').replaceWith(QWeb.render("foldable",{lineId:active_id}));$(target).parents('tr').toggleClass('o_stock_reports_unfolded');},unfold:function(e){this.autounfold($(e.target));},});return ReportWidget;});;

/* /sale_stock/static/src/js/tour.js defined in bundle 'web.assets_backend' */
var deps=['web_tour.tour'];if(_.contains(odoo._modules,'sale_management')){deps.push('sale.product_configurator_tour');deps.push('sale.product_configurator_pricelist_tour');}
odoo.define("sale_stock.tour",deps,function(require){"use strict";var tour=require('web_tour.tour');if(_.has(odoo.__DEBUG__.services,'sale.product_configurator_tour')){var quotation_product_selected_step_index=_.findIndex(tour.tours.sale_product_configurator_tour.steps,function(step){return(step.id==="quotation_product_selected");});tour.tours.sale_product_configurator_tour.steps[quotation_product_selected_step_index].run=function(actions){actions.auto();};tour.tours.sale_product_configurator_tour.steps.splice(quotation_product_selected_step_index+1,0,{trigger:".o_dialog_warning + .modal-footer .btn-primary",auto:true,run:function(actions){actions.auto('.o_dialog_warning + .modal-footer .btn-primary');}},{trigger:".o_dialog_warning + .modal-footer .btn-primary",auto:true,run:function(actions){actions.auto('.o_dialog_warning + .modal-footer .btn-primary');}},{trigger:"body:not(:has(.o_dialog_warning))",auto:true,in_modal:false,run:function(actions){if($('.modal-footer .btn-primary').length){actions.auto('.modal-footer .btn-primary');}},});}
if(_.has(odoo.__DEBUG__.services,'sale.product_configurator_pricelist_tour')){var steps=tour.tours.sale_product_configurator_pricelist_tour.steps;for(var k=0;k<steps.length;k++){if(steps[k].content==="add to SO"){steps.splice(k+1,0,{content:"click in modal on ok button",trigger:'.modal-footer button:contains("Ok")',});}}}});;

/* /sale_management/static/tests/product_configurator_test_ui.js defined in bundle 'web.assets_backend' */
odoo.define('sale.product_configurator_tour',function(require){"use strict";var tour=require('web_tour.tour');tour.register('sale_product_configurator_tour',{url:"/web",test:true,},[tour.STEPS.SHOW_APPS_MENU_ITEM,{trigger:'.o_app[data-menu-xmlid="sale.sale_menu_root"]',edition:'community'},{trigger:'.o_app[data-menu-xmlid="sale.sale_menu_root"]',edition:'enterprise'},{trigger:".o_list_button_add",extra_trigger:".o_sale_order"},{trigger:"a:contains('Configure a product')",},{trigger:'.o_product_configurator .o_input_dropdown input',run:'click'},{trigger:'li a:contains("Customizable Desk")',in_modal:false,extra_trigger:'ul.ui-autocomplete',run:'click'},{trigger:'.configurator_container span:contains("Steel")',run:function(){},},{trigger:'.configurator_container span:contains("Aluminium")',run:'click'},{trigger:'span.oe_currency_value:contains("800.40")',run:function(){}},{trigger:'input[data-value_name="Black"]'},{trigger:'.o_sale_product_configurator_add.disabled'},{trigger:'input[data-value_name="White"]'},{trigger:'.o_sale_product_configurator_add:not(.disabled)'},{trigger:'span:contains("Aluminium")',extra_trigger:'.oe_optional_products_modal',run:'click'},{trigger:'.js_product:has(strong:contains(Conference Chair)) .js_add',extra_trigger:'.oe_optional_products_modal .js_product:has(strong:contains(Conference Chair))',run:'click'},{trigger:'.js_product:has(strong:contains(Chair floor protection)) .js_add',extra_trigger:'.oe_optional_products_modal .js_product:has(strong:contains(Chair floor protection))',run:'click'},{trigger:'button span:contains(Confirm)',extra_trigger:'.oe_optional_products_modal',id:"quotation_product_selected",run:'click'},{trigger:'td.o_data_cell:contains("Customizable Desk (Aluminium, White)")',extra_trigger:'div[name="order_line"]',in_modal:false,run:function(){}},{trigger:'td.o_data_cell:contains("Conference Chair (Aluminium)")',extra_trigger:'div[name="order_line"]',in_modal:false,run:function(){}},{trigger:'td.o_data_cell:contains("Chair floor protection")',extra_trigger:'div[name="order_line"]',in_modal:false,run:function(){}},{trigger:'.o_readonly_modifier[name=amount_total]:contains("0.00")',in_modal:false,run:function(){}}]);});;

/* /sale_management/static/tests/product_configurator_advanced_test_ui.js defined in bundle 'web.assets_backend' */
odoo.define('sale.sale_product_configurator_advanced_tour',function(require){"use strict";var tour=require('web_tour.tour');var optionVariantImage;tour.register('sale_product_configurator_advanced_tour',{url:"/web",test:true,},[tour.STEPS.SHOW_APPS_MENU_ITEM,{trigger:'.o_app[data-menu-xmlid="sale.sale_menu_root"]',edition:'community'},{trigger:'.o_app[data-menu-xmlid="sale.sale_menu_root"]',edition:'enterprise'},{trigger:".o_list_button_add",extra_trigger:".o_sale_order"},{trigger:".o_required_modifier[name=partner_id] input",run:"text Tajine Saucisse",},{trigger:".ui-menu-item > a:contains('Tajine Saucisse')",auto:true,},{trigger:"a:contains('Configure a product')",extra_trigger:".o_field_widget[name=pricelist_id] > .o_external_button",},{trigger:'.o_product_configurator .o_input_dropdown input',run:'click'},{trigger:'li a:contains("Customizable Desk")',in_modal:false,extra_trigger:'ul.ui-autocomplete',run:'click'},{trigger:'span:contains("Custom")',extra_trigger:'.o_product_configurator',run:'click'},{trigger:'.o_product_configurator ul.js_add_cart_variants li[data-attribute_id]:nth-child(1) .variant_custom_value',extra_trigger:'.o_product_configurator',run:'text Custom 1'},{trigger:'.o_product_configurator ul.js_add_cart_variants li[data-attribute_id]:nth-child(3) span:contains("PAV9")',extra_trigger:'.o_product_configurator',run:'click'},{trigger:'.o_product_configurator ul.js_add_cart_variants li[data-attribute_id]:nth-child(3) .variant_custom_value',extra_trigger:'.o_product_configurator',run:'text Custom 2'},{trigger:'.o_product_configurator ul.js_add_cart_variants li[data-attribute_id]:nth-child(4) span:contains("PAV5")',extra_trigger:'.o_product_configurator',run:'click'},{trigger:'.o_product_configurator ul.js_add_cart_variants li[data-attribute_id]:nth-child(6) select ',extra_trigger:'.o_product_configurator',run:function(){var inputValue=$('.o_product_configurator ul.js_add_cart_variants li[data-attribute_id]:nth-child(6) option[data-value_name="PAV9"]').val();$('.o_product_configurator ul.js_add_cart_variants li[data-attribute_id]:nth-child(6) select').val(inputValue);$('.o_product_configurator ul.js_add_cart_variants li[data-attribute_id]:nth-child(6) select').trigger('change');}},{trigger:'.o_product_configurator ul.js_add_cart_variants li[data-attribute_id]:nth-child(6) .variant_custom_value',extra_trigger:'.o_product_configurator',run:'text Custom 3'},{trigger:".o_sale_product_configurator_add",run:'click'},{trigger:'.main_product strong:contains("Custom, White, PAV9, PAV5, PAV1")',extra_trigger:'.oe_optional_products_modal',run:function(){}},{trigger:'.main_product div:contains("Custom: Custom 1")',extra_trigger:'.oe_optional_products_modal',run:function(){}},{trigger:'.main_product div:contains("PAV9: Custom 2")',extra_trigger:'.oe_optional_products_modal',run:function(){}},{trigger:'.main_product div:contains("PAV9: Custom 3")',extra_trigger:'.oe_optional_products_modal',run:function(){}},{trigger:'.main_product div:contains("PA5: PAV1")',extra_trigger:'.oe_optional_products_modal',run:function(){}},{trigger:'.main_product div:contains("PA5: PAV1")',extra_trigger:'.oe_optional_products_modal',run:function(){}},{trigger:'.main_product div:contains("PA8: PAV1")',extra_trigger:'.oe_optional_products_modal',run:function(){}},{trigger:'.oe_optional_products_modal .js_product:eq(1) div:contains("Conference Chair (Steel)")',run:function(){optionVariantImage=$('.oe_optional_products_modal .js_product:eq(1) img.variant_image').attr('src');}},{trigger:'.oe_optional_products_modal .js_product:eq(1) input[data-value_name="Aluminium"]',},{trigger:'.oe_optional_products_modal .js_product:eq(1) div:contains("Conference Chair (Aluminium)")',run:function(){var newVariantImage=$('.oe_optional_products_modal .js_product:eq(1) img.variant_image').attr('src');if(newVariantImage!==optionVariantImage){$('<p>').text('image variant option src changed').insertAfter('.oe_optional_products_modal .js_product:eq(1) .product-name');}}},{extra_trigger:'.oe_optional_products_modal .js_product:eq(1) div:contains("image variant option src changed")',trigger:'.oe_optional_products_modal .js_product:eq(1) input[data-value_name="Steel"]',},{trigger:'button span:contains(Confirm)',extra_trigger:'.oe_optional_products_modal',run:'click'},{trigger:'td.o_data_cell:contains("Customizable Desk (Custom, White, PAV9, PAV5, PAV1)")',extra_trigger:'div[name="order_line"]',in_modal:false,run:function(){}},{trigger:'td.o_data_cell:contains("Custom: Custom 1")',extra_trigger:'div[name="order_line"]',in_modal:false,run:function(){}},{trigger:'td.o_data_cell:contains("PAV9: Custom 2")',extra_trigger:'div[name="order_line"]',in_modal:false,run:function(){}},{trigger:'td.o_data_cell:contains("PAV9: Custom 3")',extra_trigger:'div[name="order_line"]',in_modal:false,run:function(){}},{trigger:'td.o_data_cell:contains("PA5: PAV1")',extra_trigger:'div[name="order_line"]',in_modal:false,run:function(){}},{trigger:'td.o_data_cell:contains("PA5: PAV1")',extra_trigger:'div[name="order_line"]',in_modal:false,run:function(){}},{trigger:'td.o_data_cell:contains("PA8: PAV1")',extra_trigger:'div[name="order_line"]',in_modal:false,run:function(){}}]);});;

/* /sale_management/static/tests/product_configurator_pricelist_test_ui.js defined in bundle 'web.assets_backend' */
odoo.define('sale.product_configurator_pricelist_tour',function(require){"use strict";var tour=require('web_tour.tour');tour.register('sale_product_configurator_pricelist_tour',{url:"/web",test:true,},[tour.STEPS.SHOW_APPS_MENU_ITEM,{content:"navigate to the sale app",trigger:'.o_app[data-menu-xmlid="sale.sale_menu_root"]',edition:'community'},{content:"navigate to the sale app",trigger:'.o_app[data-menu-xmlid="sale.sale_menu_root"]',edition:'enterprise'},{content:"create a new order",trigger:'.o_list_button_add',extra_trigger:".o_sale_order"},{content:"search the partner",trigger:'div[name="partner_id"] input',run:'text Azure'},{content:"select the partner",trigger:'ul.ui-autocomplete > li > a:contains(Azure)',},{content:"search the pricelist",trigger:'div[name="pricelist_id"] input',run:'text Public Pricelist'},{content:"select the pricelist",trigger:'ul.ui-autocomplete > li > a:contains(Public Pricelist)',},{content:"wait for pricelist to be set",trigger:'div.o_with_button[name="pricelist_id"]',run:function(){},},{content:"open product configurator",trigger:'a:contains("Configure a product")',},{content:"open product selector",trigger:'.o_product_configurator .o_input_dropdown input',run:'click'},{content:"select desk",trigger:'li a:contains("Customizable Desk")',in_modal:false,extra_trigger:'ul.ui-autocomplete',},{content:"check price is correct (USD)",trigger:'span.oe_currency_value:contains("750.00")',run:function(){}},{content:"add one more",trigger:'button.js_add_cart_json:has(i.fa-plus)',},{content:"check price for 2",trigger:'span.oe_currency_value:contains("600.00")',run:function(){}},{content:"click add",trigger:'.o_sale_product_configurator_add:not(.disabled)'},{content:"check we are on the add modal",trigger:'.td-product_name:contains("Customizable Desk (Steel, White)")',extra_trigger:'.oe_optional_products_modal',run:'click'},{content:"add conference chair",trigger:'.js_product:has(strong:contains(Conference Chair)) .js_add',extra_trigger:'.oe_optional_products_modal .js_product:has(strong:contains(Conference Chair))',run:'click'},{content:"add chair floor protection",trigger:'.js_product:has(strong:contains(Chair floor protection)) .js_add',extra_trigger:'.oe_optional_products_modal .js_product:has(strong:contains(Chair floor protection))',run:'click'},{content:"verify configurator final price",trigger:'.o_total_row .oe_currency_value:contains("1,257.00")',},{content:"add to SO",trigger:'button span:contains(Confirm)',extra_trigger:'.oe_optional_products_modal',run:'click'},{content:"verify SO final price excluded",trigger:'span[name="amount_untaxed"]:contains("1,257.00")',},{content:"verify SO final price included",trigger:'span[name="amount_total"]:contains("1,437.00")',}]);});;

/* /web_responsive/static/src/js/web_responsive.js defined in bundle 'web.assets_backend' */
odoo.define('web_responsive',function(require){'use strict';var ActionManager=require('web.ActionManager');var AbstractWebClient=require("web.AbstractWebClient");var AppsMenu=require("web.AppsMenu");var BasicController=require('web.BasicController');var config=require("web.config");var core=require("web.core");var FormRenderer=require('web.FormRenderer');var Menu=require("web.Menu");var RelationalFields=require('web.relational_fields');var Chatter=require('mail.Chatter');var DocumentViewer=require('mail.DocumentViewer');var ListRenderer=require('web.ListRenderer');function closeAppDrawer(){_.defer(function(){var menu_apps_dropdown=document.querySelector('.o_menu_apps .dropdown');$(menu_apps_dropdown).has('.dropdown-menu.show').find('> a').dropdown('toggle');var menu_sections=document.querySelector('.o_menu_sections li.show .dropdown-toggle');$(menu_sections).dropdown('toggle');var menu_sections_mobile=document.querySelector('.o_menu_sections.show');$(menu_sections_mobile).collapse('hide');});}
function findNames(memo,menu){if(menu.action){var key=menu.parent_id?menu.parent_id[1]+"/":"";memo[key+menu.name]=menu;}
if(menu.children.length){_.reduce(menu.children,findNames,memo);}
return memo;}
AppsMenu.include({events:_.extend({"keydown .search-input input":"_searchResultsNavigate","input .search-input input":"_searchMenusSchedule","click .o-menu-search-result":"_searchResultChosen","shown.bs.dropdown":"_searchFocus","hidden.bs.dropdown":"_searchReset","hide.bs.dropdown":"_hideAppsMenu",},AppsMenu.prototype.events),init:function(parent,menuData){this._super.apply(this,arguments);for(var n in this._apps){this._apps[n].web_icon_data=menuData.children[n].web_icon_data;}
this._searchableMenus=_.reduce(menuData.children,findNames,{});this._search_def=$.Deferred();},start:function(){this.$search_container=this.$(".search-container");this.$search_input=this.$(".search-input input");this.$search_results=this.$(".search-results");return this._super.apply(this,arguments);},_onAppsMenuItemClicked:function(ev){this._super.apply(this,arguments);ev.preventDefault();ev.stopPropagation();},_menuInfo:function(key){var original=this._searchableMenus[key];return _.extend({action_id:parseInt(original.action.split(',')[1],10),},original);},_searchFocus:function(){if(!config.device.isMobile){this.$search_input.focus();}},_searchReset:function(){this.$search_container.removeClass("has-results");this.$search_results.empty();this.$search_input.val("");},_searchMenusSchedule:function(){this._search_def.reject();this._search_def=$.Deferred();setTimeout(this._search_def.resolve.bind(this._search_def),50);this._search_def.done(this._searchMenus.bind(this));},_searchMenus:function(){var query=this.$search_input.val();if(query===""){this.$search_container.removeClass("has-results");this.$search_results.empty();return;}
var results=fuzzy.filter(query,_.keys(this._searchableMenus),{pre:"<b>",post:"</b>",});this.$search_container.toggleClass("has-results",Boolean(results.length));this.$search_results.html(core.qweb.render("web_responsive.MenuSearchResults",{results:results,widget:this,}));},_searchResultChosen:function(event){event.preventDefault();event.stopPropagation();var $result=$(event.currentTarget),text=$result.text().trim(),data=$result.data(),suffix=~text.indexOf("/")?"/":"";this.trigger_up("menu_clicked",{action_id:data.actionId,id:data.menuId,previous_menu_id:data.parentId,});var app=_.find(this._apps,function(_app){return text.indexOf(_app.name+suffix)===0;});core.bus.trigger("change_menu_section",app.menuID);},_searchResultsNavigate:function(event){var all=this.$search_results.find(".o-menu-search-result"),pre_focused=all.filter(".active")||$(all[0]),offset=all.index(pre_focused),key=event.key;if(!all.length){return;}
if(key==="Tab"){event.preventDefault();key=event.shiftKey?"ArrowUp":"ArrowDown";}
switch(key){case"Enter":pre_focused.click();break;case"ArrowUp":offset--;break;case"ArrowDown":offset++;break;default:return;}
if(offset<0){offset=all.length+offset;}else if(offset>=all.length){offset-=all.length;}
var new_focused=$(all[offset]);pre_focused.removeClass("active");new_focused.addClass("active");this.$search_results.scrollTo(new_focused,{offset:{top:this.$search_results.height()*-0.5,},});},_hideAppsMenu:function(){return!this.$('input').is(':focus');},});BasicController.include({canBeDiscarded:function(recordID){if(this.model.isDirty(recordID||this.handle)){closeAppDrawer();}
return this._super.apply(this,arguments);},});Menu.include({events:_.extend({"click .o_menu_sections [role=menuitem]":"_onClickMenuItem","show.bs.dropdown .o_menu_systray, .o_menu_apps":"_hideMobileSubmenus",},Menu.prototype.events),start:function(){this.$menu_toggle=this.$(".o-menu-toggle");return this._super.apply(this,arguments);},_hideMobileSubmenus:function(){if(config.device.isMobile&&this.$menu_toggle.is(":visible")&&this.$section_placeholder.is(":visible")){this.$section_placeholder.collapse("hide");}},_onClickMenuItem:function(ev){ev.stopPropagation();},_updateMenuBrand:function(){if(!config.device.isMobile){return this._super.apply(this,arguments);}},});RelationalFields.FieldStatus.include({_setState:function(){this._super.apply(this,arguments);if(config.device.isMobile){_.map(this.status_information,function(value){value.fold=true;});}},});FormRenderer.include({_renderHeaderButtons:function(){var $buttons=this._super.apply(this,arguments);if(!config.device.isMobile||!$buttons.is(":has(>:not(.o_invisible_modifier))")){return $buttons;}
$buttons.addClass("dropdown-menu");var $dropdown=$(core.qweb.render('web_responsive.MenuStatusbarButtons'));$buttons.addClass("dropdown-menu").appendTo($dropdown);return $dropdown;},});Chatter.include({_openComposer:function(options){if(this._composer&&options.isLog===this._composer.options.isLog&&this._composer.$el.is(':visible')){this._closeComposer(false);}else{this._super.apply(this,arguments);}},});ActionManager.include({_appendController:function(){this._super.apply(this,arguments);closeAppDrawer();},});var KeyboardNavigationShiftAltMixin={_shiftPressed:function(keyEvent){var alt=keyEvent.altKey||keyEvent.key==="Alt",newEvent=_.extend({},keyEvent),shift=keyEvent.shiftKey||keyEvent.key==="Shift";if(alt&&!shift){newEvent.altKey=false;if(newEvent.key==="Alt"){newEvent.key="Shift";}}
return newEvent;},_onKeyDown:function(keyDownEvent){return this._super(this._shiftPressed(keyDownEvent));},_onKeyUp:function(keyUpEvent){return this._super(this._shiftPressed(keyUpEvent));},};AbstractWebClient.include(KeyboardNavigationShiftAltMixin);DocumentViewer.include({events:_.extend(_.omit(DocumentViewer.prototype.events,['keydown','keyup',]),{'click .o_maximize_btn':'_onClickMaximize','click .o_minimize_btn':'_onClickMinimize','shown.bs.modal':'_onShownModal',}),start:function(){core.bus.on('keydown',this,this._onKeydown);core.bus.on('keyup',this,this._onKeyUp);return this._super.apply(this,arguments);},destroy:function(){core.bus.off('keydown',this,this._onKeydown);core.bus.off('keyup',this,this._onKeyUp);this._super.apply(this,arguments);},_onShownModal:function(){$(document).off('focusin.modal');},_onClickMaximize:function(){this.$el.removeClass('o_responsive_document_viewer');},_onClickMinimize:function(){this.$el.addClass('o_responsive_document_viewer');},});ListRenderer.include({_renderSelector:function(){var $elm=this._super.apply(this,arguments);$elm.find(".custom-control-label").html('');return $elm;},});});;

/* /backend_theme_v12/static/src/js/sidebar.js defined in bundle 'web.assets_backend' */
odoo.define('backend_theme_v12.Sidebar',function(require){"use strict";var core=require('web.core');var session=require('web.session');var Widget=require('web.Widget');$(function(){(function($){$.addDebug=function(url){url=url.replace(/(.{4})/,"$1?debug");return url;}
$.addDebugWithAssets=function(url){url=url.replace(/(.{4})/,"$1?debug=assets");return url;}
$.delDebug=function(url){var str=url.match(/web(\S*)#/);url=url.replace("str/g","");return url;}})(jQuery);$("#sidebar a").each(function(){var url=$(this).attr('href');if(session.debug==1)$(this).attr('href',$.addDebug(url));if(session.debug=='assets')$(this).attr('href',$.addDebugWithAssets(url));if(session.debug==false)$(this).attr('href',$.delDebug(url));});});});;

/* /backend_theme_v12/static/src/js/sidebar-toggle.js defined in bundle 'web.assets_backend' */
odoo.define('backend_theme_v12.sidebar-toggle',function(require){"use strict";var session=require('web.session');var rpc=require('web.rpc');var id=session.uid;rpc.query({model:'res.users',method:'read',args:[[id],['sidebar_visible']],}).then(function(res){var dbfield=res[0];var toggle=dbfield.sidebar_visible;if(toggle===true){$("#app-sidebar").removeClass("toggle-sidebar");}else{$("#app-sidebar").addClass("toggle-sidebar");};});});;

/* /board/static/src/js/action_manager_board_action.js defined in bundle 'web.assets_backend' */
odoo.define('board.ActionManager',function(require){"use strict";var ActionManager=require('web.ActionManager');ActionManager.include({_executeWindowAction:function(action){if(action.res_model==='board.board'&&action.view_mode==='form'){action.target='inline';_.extend(action.flags,{hasSearchView:false,hasSidebar:false,headless:true,});}
return this._super.apply(this,arguments);},});});;

/* /board/static/src/js/board_view.js defined in bundle 'web.assets_backend' */
odoo.define('board.BoardView',function(require){"use strict";var Context=require('web.Context');var core=require('web.core');var dataManager=require('web.data_manager');var Dialog=require('web.Dialog');var Domain=require('web.Domain');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var FormView=require('web.FormView');var pyUtils=require('web.py_utils');var session=require('web.session');var viewRegistry=require('web.view_registry');var _t=core._t;var _lt=core._lt;var QWeb=core.qweb;var BoardController=FormController.extend({custom_events:_.extend({},FormController.prototype.custom_events,{change_layout:'_onChangeLayout',enable_dashboard:'_onEnableDashboard',save_dashboard:'_saveDashboard',switch_view:'_onSwitchView',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.customViewID=params.customViewID;},getTitle:function(){if(this.inDashboard){return _t("My Dashboard");}
return this._super.apply(this,arguments);},_saveDashboard:function(){var board=this.renderer.getBoard();var arch=QWeb.render('DashBoard.xml',_.extend({},board));return this._rpc({route:'/web/view/edit_custom',params:{custom_id:this.customViewID,arch:arch,}}).then(dataManager.invalidate.bind(dataManager));},_onChangeLayout:function(event){var self=this;var dialog=new Dialog(this,{title:_t("Edit Layout"),$content:QWeb.render('DashBoard.layouts',_.clone(event.data))});dialog.opened().then(function(){dialog.$('li').click(function(){var layout=$(this).attr('data-layout');self.renderer.changeLayout(layout);self._saveDashboard();dialog.close();});});dialog.open();},_onEnableDashboard:function(){this.inDashboard=true;},_onSwitchView:function(event){event.stopPropagation();this.do_action({type:'ir.actions.act_window',res_model:event.data.model,views:[[event.data.formViewID||false,'form']],res_id:event.data.res_id,});},});var BoardRenderer=FormRenderer.extend({custom_events:_.extend({},FormRenderer.prototype.custom_events,{do_action:'_onDoAction',env_updated:'_onEnvUpdated',update_filters:'_onUpdateFilters',switch_view:'_onSwitchView',}),events:_.extend({},FormRenderer.prototype.events,{'click .oe_dashboard_column .oe_fold':'_onFoldClick','click .oe_dashboard_link_change_layout':'_onChangeLayout','click .oe_dashboard_column .oe_close':'_onCloseAction',}),init:function(parent,state,params){this._super.apply(this,arguments);this.noContentHelp=params.noContentHelp;this.actionsDescr={};this._boardSubcontrollers=[];this._boardFormViewIDs={};},on_attach_callback:function(){_.each(this._boardSubcontrollers,function(controller){if('on_attach_callback'in controller){controller.on_attach_callback();}});},on_detach_callback:function(){_.each(this._boardSubcontrollers,function(controller){if('on_detach_callback'in controller){controller.on_detach_callback();}});},changeLayout:function(layout){var $dashboard=this.$('.oe_dashboard');var current_layout=$dashboard.attr('data-layout');if(current_layout!==layout){var clayout=current_layout.split('-').length,nlayout=layout.split('-').length,column_diff=clayout-nlayout;if(column_diff>0){var $last_column=$();$dashboard.find('.oe_dashboard_column').each(function(k,v){if(k>=nlayout){$(v).find('.oe_action').appendTo($last_column);}else{$last_column=$(v);}});}
$dashboard.toggleClass('oe_dashboard_layout_'+current_layout+' oe_dashboard_layout_'+layout);$dashboard.attr('data-layout',layout);}},getBoard:function(){var self=this;var board={form_title:this.arch.attrs.string,style:this.$('.oe_dashboard').attr('data-layout'),columns:[],};this.$('.oe_dashboard_column').each(function(){var actions=[];$(this).find('.oe_action').each(function(){var actionID=$(this).attr('data-id');var newAttrs=_.clone(self.actionsDescr[actionID]);if(newAttrs.modifiers){newAttrs.modifiers=JSON.stringify(newAttrs.modifiers);}
actions.push(newAttrs);});board.columns.push(actions);});return board;},_createController:function(params){var self=this;return this._rpc({route:'/web/action/load',params:{action_id:params.actionID}}).then(function(action){if(!action){return $.when();}
var evalContext=new Context(params.context).eval();if(evalContext.group_by&&evalContext.group_by.length===0){delete evalContext.group_by;}
var rawContext=new Context(action.context,evalContext,{lang:session.user_context.lang});var context=pyUtils.eval('context',rawContext,evalContext);var domain=params.domain||pyUtils.eval('domain',action.domain||'[]',action.context);action._views=action.views;action.views=$.map(action.views,function(view){return{viewID:view[0],type:view[1]}});var viewType=params.viewType||action._views[0][1];var view=_.find(action._views,function(descr){return descr[1]===viewType;})||[false,viewType];return self.loadViews(action.res_model,context,[view]).then(function(viewsInfo){var viewInfo=viewsInfo[viewType];var View=viewRegistry.get(viewType);var view=new View(viewInfo,{action:action,context:context,domain:domain,groupBy:context.group_by||[],modelName:action.res_model,hasSelectors:false,});return view.getController(self).then(function(controller){self._boardFormViewIDs[controller.handle]=_.first(_.find(action._views,function(descr){return descr[1]==='form';}));self._boardSubcontrollers.push(controller);return controller.appendTo(params.$node);});});});},_renderTagBoard:function(node){var self=this;this.$el.addClass('o_dashboard');this.trigger_up('enable_dashboard');var hasAction=_.detect(node.children,function(column){return _.detect(column.children,function(element){return element.tag==="action"?element:false;});});if(!hasAction){return $(QWeb.render('DashBoard.NoContent'));}
node=$.extend(true,{},node);if(!('layout'in node.attrs)){node.attrs.layout=node.attrs.style;}
for(var i=node.children.length;i<3;i++){node.children.push({tag:'column',attrs:{},children:[]});}
_.each(node.children,function(column,column_index){_.each(column.children,function(action,action_index){action.attrs.id='action_'+column_index+'_'+action_index;self.actionsDescr[action.attrs.id]=action.attrs;});});var $html=$('<div>').append($(QWeb.render('DashBoard',{node:node})));_.each(this.actionsDescr,function(action){self.defs.push(self._createController({$node:$html.find('.oe_action[data-id='+action.id+'] .oe_content'),actionID:_.str.toNumber(action.name),context:action.context,domain:Domain.prototype.stringToArray(action.domain,{}),viewType:action.view_mode,}));});$html.find('.oe_dashboard_column').sortable({connectWith:'.oe_dashboard_column',handle:'.oe_header',scroll:false}).bind('sortstop',function(){self.trigger_up('save_dashboard');});return $html;},_onChangeLayout:function(){var currentLayout=this.$('.oe_dashboard').attr('data-layout');this.trigger_up('change_layout',{currentLayout:currentLayout});},_onCloseAction:function(event){var self=this;var $container=$(event.currentTarget).parents('.oe_action:first');Dialog.confirm(this,(_t("Are you sure you want to remove this item?")),{confirm_callback:function(){$container.remove();self.trigger_up('save_dashboard');},});},_onDoAction:function(event){if(event.data.options){event.data.options.keepSearchView=false;}},_onEnvUpdated:function(event){event.stopPropagation();},_onFoldClick:function(event){var $e=$(event.currentTarget);var $action=$e.closest('.oe_action');var id=$action.data('id');var actionAttrs=this.actionsDescr[id];if($e.is('.oe_minimize')){actionAttrs.fold='1';}else{delete(actionAttrs.fold);}
$e.toggleClass('oe_minimize oe_maximize');$action.find('.oe_content').toggle();this.trigger_up('save_dashboard');},_onSwitchView:function(event){event.data.formViewID=this._boardFormViewIDs[event.target.handle];},_onUpdateFilters:function(event){event.stopPropagation();},});var BoardView=FormView.extend({config:_.extend({},FormView.prototype.config,{Controller:BoardController,Renderer:BoardRenderer,}),display_name:_lt('Board'),init:function(viewInfo){this._super.apply(this,arguments);this.controllerParams.customViewID=viewInfo.custom_view_id;},});return BoardView;});odoo.define('board.viewRegistry',function(require){"use strict";var BoardView=require('board.BoardView');var viewRegistry=require('web.view_registry');viewRegistry.add('board',BoardView);});;

/* /board/static/src/js/favorite_menu.js defined in bundle 'web.assets_backend' */
odoo.define('board.favorite_menu',function(require){"use strict";var ActionManager=require('web.ActionManager');var Context=require('web.Context');var core=require('web.core');var Domain=require('web.Domain');var FavoriteMenu=require('web.FavoriteMenu');var pyUtils=require('web.py_utils');var _t=core._t;var QWeb=core.qweb;FavoriteMenu.include({start:function(){var self=this;if(this.action_id===undefined){return this._super();}
if(this.action.type==='ir.actions.act_window'){this.add_to_dashboard_available=true;this.$('.o_favorites_menu').append(QWeb.render('SearchView.addtodashboard'));this.$add_to_dashboard=this.$('.o_add_to_dashboard');this.$add_dashboard_btn=this.$add_to_dashboard.eq(1).find('button');this.$add_dashboard_input=this.$add_to_dashboard.eq(0).find('input');this.$add_dashboard_link=this.$('.o_add_to_dashboard_link');var title=this.searchview.get_title();this.$add_dashboard_input.val(title);this.$add_dashboard_link.click(function(e){e.preventDefault();self._toggleDashboardMenu();});this.$add_dashboard_btn.click(this.proxy('_addDashboard'));}
return this._super();},_addDashboard:function(){var self=this;var search_data=this.searchview.build_search_data();var context=new Context(this.searchview.dataset.get_context()||[]);var domain=this.action.domain?this.action.domain.slice(0):[];_.each(search_data.contexts,context.add,context);_.each(search_data.domains,function(d){domain.push.apply(domain,Domain.prototype.stringToArray(d));});context.add({group_by:pyUtils.eval('groupbys',search_data.groupbys||[])});var am=this.findAncestor(function(a){return a instanceof ActionManager;});var currentAction=am.getCurrentAction();var controller=am.getCurrentController();context.add(controller.widget.getContext());var c=pyUtils.eval('context',context);for(var k in c){if(c.hasOwnProperty(k)&&/^search_default_/.test(k)){delete c[k];}}
this._toggleDashboardMenu(false);c.dashboard_merge_domains_contexts=false;var name=self.$add_dashboard_input.val();return self._rpc({route:'/board/add_to_dashboard',params:{action_id:currentAction.id||false,context_to_save:c,domain:domain,view_mode:controller.viewType,name:name,},}).then(function(r){if(r){self.do_notify(_.str.sprintf(_t("'%s' added to dashboard"),name),_t('Please refresh your browser for the changes to take effect.'));}else{self.do_warn(_t("Could not add filter to dashboard"));}});},_closeMenus:function(){if(this.add_to_dashboard_available){this._toggleDashboardMenu(false);}
this._super();},_toggleDashboardMenu:function(isOpen){this.$add_dashboard_link.toggleClass('o_closed_menu',!(_.isUndefined(isOpen))?!isOpen:undefined).toggleClass('o_open_menu',isOpen);this.$add_to_dashboard.toggle(isOpen);if(this.$add_dashboard_link.hasClass('o_open_menu')){this.$add_dashboard_input.focus();}},});});;

/* /list_export_excel_app/static/src/js/js_excel.js defined in bundle 'web.assets_backend' */
odoo.define('list_export_excel_app.ExcelButton',function(require){"use strict";var ListView=require('web.ListView');var ListController=require('web.ListController')
var ListRenderer=require('web.ListRenderer')
var rpc=require('web.rpc');ListController.include({init:function(){this._super.apply(this,arguments);var button=this.$buttons
if(this.selectedRecords.length=0)
button.style.visibility="visible"},renderButtons:function(){this._super.apply(this,arguments)
if(this.$buttons){this.$buttons.on('click','.button_export',this._onCreateExcel.bind(this));}},_onCreateExcel:function(event,node){var self=this;var lst=[];var res=[];var model="";var field_val=[];var fields_row=[];var strings=[];var fields_string=[];var selection_fields=[];var field=this.renderer.state.fields;var records=_.map(this.selectedRecords,function(id){return self.model.localData[id];});for(var x=0;x<records.length;x++)
{lst.push(records[x]['data']['id']);model=records[x]['model']
field_val=records[x]['fieldsInfo']['list']
for(var key in field_val){var value=field_val[key]
if(!value['invisible']||value['modifiers']['column_invisible']==false){fields_row.push(value['name'])}}}
for(var j=0;j<fields_row.length;j++){if(field.hasOwnProperty(key)){for(var key in field){if(fields_row[j]==key){if(field[key]['type']=='selection'){selection_fields.push(field[key]['selection'])}
fields_string.push(field[key]['string'])}}}}
var fields_row_unique=[...new Set(fields_row)]
var fields_string_unique=[...new Set(fields_string)]
rpc.query({model:'xls.excel',method:'create_excel',args:[1,lst,model,fields_string_unique,fields_row_unique,selection_fields],}).then(function(output){self.do_action({type:'ir.actions.act_window',res_model:'sale.excel',res_id:output,target:'new',views:[[false,'form']],view_type:'form',view_mode:'form',domain:[['id','=',output]]})});}});});;

/* /stock_3dview/static/src/js/libs/three.min.js defined in bundle 'web.assets_backend' */
(function(k,ra){"object"===typeof exports&&"undefined"!==typeof module?ra(exports):"function"===typeof define&&define.amd?define(["exports"],ra):(k=k||self,ra(k.THREE={}))})(this,function(k){function ra(){}function w(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.x=a;this.y=b}function za(){this.elements=[1,0,0,0,1,0,0,0,1];0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function V(a,b,c,d,e,f,g,h,l,n){Object.defineProperty(this,"id",{value:ej++});this.uuid=P.generateUUID();this.name="";this.image=void 0!==a?a:V.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==b?b:V.DEFAULT_MAPPING;this.wrapS=void 0!==c?c:1001;this.wrapT=void 0!==d?d:1001;this.magFilter=void 0!==e?e:1006;this.minFilter=void 0!==f?f:1008;this.anisotropy=void 0!==l?l:1;this.format=void 0!==g?g:1023;this.internalFormat=null;this.type=void 0!==h?h:1009;this.offset=new w(0,0);this.repeat=new w(1,1);this.center=new w(0,0);this.rotation=0;this.matrixAutoUpdate=!0;this.matrix=new za;this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==n?n:3E3;this.version=0;this.onUpdate=null}function ba(a,b,c,d){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c=0);void 0===d&&(d=1);this.x=a;this.y=b;this.z=c;this.w=d}function Ea(a,b,c){this.width=a;this.height=b;this.scissor=new ba(0,0,a,b);this.scissorTest=!1;this.viewport=new ba(0,0,a,b);c=c||{};this.texture=new V(void 0,c.mapping,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.encoding);this.texture.image={};this.texture.image.width=a;this.texture.image.height=b;this.texture.generateMipmaps=void 0!==c.generateMipmaps?c.generateMipmaps:!1;this.texture.minFilter=void 0!==c.minFilter?c.minFilter:1006;this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.depthTexture=void 0!==c.depthTexture?c.depthTexture:null}function Zf(a,b,c){Ea.call(this,a,b,c);this.samples=4}function S(a,b,c,d){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c=0);void 0===d&&(d=1);this._x=a;this._y=b;this._z=c;this._w=d}function m(a,b,c){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c=0);this.x=a;this.y=b;this.z=c}function T(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function Tb(a,b,c,d){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c=0);void 0===d&&(d=Tb.DefaultOrder);this._x=a;this._y=b;this._z=c;this._order=d}function Ce(){this.mask=1}function y(){Object.defineProperty(this,"id",{value:fj++});this.uuid=P.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=y.DefaultUp.clone();var a=new m,b=new Tb,c=new S,d=new m(1,1,1);b._onChange(function(){c.setFromEuler(b,!1)});c._onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:a},rotation:{configurable:!0,enumerable:!0,value:b},quaternion:{configurable:!0,enumerable:!0,value:c},scale:{configurable:!0,enumerable:!0,value:d},modelViewMatrix:{value:new T},normalMatrix:{value:new za}});this.matrix=new T;this.matrixWorld=new T;this.matrixAutoUpdate=y.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new Ce;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={}}function wd(){y.call(this);this.type="Scene";this.overrideMaterial=this.fog=this.environment=this.background=null;this.autoUpdate=!0;"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Ta(a,b){this.min=void 0!==a?a:new m(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new m(-Infinity,-Infinity,-Infinity)}function $f(a,b,c,d,e){for(var f=0,g=a.length-3;f<=g;f+=3){Ub.fromArray(a,f);var h=e.x*Math.abs(Ub.x)+e.y*Math.abs(Ub.y)+e.z*Math.abs(Ub.z),l=b.dot(Ub),n=c.dot(Ub),q=d.dot(Ub);if(Math.max(-Math.max(l,n,q),Math.min(l,n,q))>h)return!1}return!0}function db(a,b){this.center=void 0!==a?a:new m;this.radius=void 0!==b?b:-1}function Vb(a,b){this.origin=void 0!==a?a:new m;this.direction=void 0!==b?b:new m(0,0,-1)}function Ua(a,b){this.normal=void 0!==a?a:new m(1,0,0);this.constant=void 0!==b?b:0}function sa(a,b,c){this.a=void 0!==a?a:new m;this.b=void 0!==b?b:new m;this.c=void 0!==c?c:new m}function H(a,b,c){return void 0===b&&void 0===c?this.set(a):this.setRGB(a,b,c)}function ag(a,b,c){0>c&&(c+=1);1<c&&--c;return c<1/6?a+6*(b-a)*c:.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a}function bg(a){return.04045>a?.0773993808*a:Math.pow(.9478672986*a+.0521327014,2.4)}function cg(a){return.0031308>a?12.92*a:1.055*Math.pow(a,.41666)-.055}function yc(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d&&d.isVector3?d:new m;this.vertexNormals=Array.isArray(d)?d:[];this.color=e&&e.isColor?e:new H;this.vertexColors=Array.isArray(e)?e:[];this.materialIndex=void 0!==f?f:0}function K(){Object.defineProperty(this,"id",{value:gj++});this.uuid=P.generateUUID();this.name="";this.type="Material";this.fog=!0;this.blending=1;this.side=0;this.vertexColors=this.flatShading=!1;this.opacity=1;this.transparent=!1;this.blendSrc=204;this.blendDst=205;this.blendEquation=100;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=3;this.depthWrite=this.depthTest=!0;this.stencilWriteMask=255;this.stencilFunc=519;this.stencilRef=0;this.stencilFuncMask=255;this.stencilZPass=this.stencilZFail=this.stencilFail=7680;this.stencilWrite=!1;this.clippingPlanes=null;this.clipShadows=this.clipIntersection=!1;this.shadowSide=null;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.dithering=!1;this.alphaTest=0;this.premultipliedAlpha=!1;this.toneMapped=this.visible=!0;this.userData={};this.version=0}function Na(a){K.call(this);this.type="MeshBasicMaterial";this.color=new H(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphTargets=this.skinning=!1;this.setValues(a)}function F(a,b,c){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="";this.array=a;this.itemSize=b;this.count=void 0!==a?a.length/b:0;this.normalized=!0===c;this.usage=35044;this.updateRange={offset:0,count:-1};this.version=0}function xd(a,b,c){F.call(this,new Int8Array(a),b,c)}function yd(a,b,c){F.call(this,new Uint8Array(a),b,c)}function zd(a,b,c){F.call(this,new Uint8ClampedArray(a),b,c)}function Ad(a,b,c){F.call(this,new Int16Array(a),b,c)}function Wb(a,b,c){F.call(this,new Uint16Array(a),b,c)}function Bd(a,b,c){F.call(this,new Int32Array(a),b,c)}function Xb(a,b,c){F.call(this,new Uint32Array(a),b,c)}function C(a,b,c){F.call(this,new Float32Array(a),b,c)}function Cd(a,b,c){F.call(this,new Float64Array(a),b,c)}function sh(){this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function th(a){if(0===a.length)return-Infinity;for(var b=a[0],c=1,d=a.length;c<d;++c)a[c]>b&&(b=a[c]);return b}function D(){Object.defineProperty(this,"id",{value:hj+=2});this.uuid=P.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.morphTargetsRelative=!1;this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity};this.userData={}}function Z(a,b){y.call(this);this.type="Mesh";this.geometry=void 0!==a?a:new D;this.material=void 0!==b?b:new Na;this.updateMorphTargets()}function uh(a,b,c,d,e,f,g,h){if(null===(1===b.side?d.intersectTriangle(g,f,e,!0,h):d.intersectTriangle(e,f,g,2!==b.side,h)))return null;De.copy(h);De.applyMatrix4(a.matrixWorld);b=c.ray.origin.distanceTo(De);return b<c.near||b>c.far?null:{distance:b,point:De.clone(),object:a}}function Ee(a,b,c,d,e,f,g,h,l,n,q,p){Ab.fromBufferAttribute(e,n);Bb.fromBufferAttribute(e,q);Cb.fromBufferAttribute(e,p);e=a.morphTargetInfluences;if(b.morphTargets&&f&&e){Fe.set(0,0,0);Ge.set(0,0,0);He.set(0,0,0);for(var v=0,k=f.length;v<k;v++){var t=e[v],u=f[v];0!==t&&(dg.fromBufferAttribute(u,n),eg.fromBufferAttribute(u,q),fg.fromBufferAttribute(u,p),g?(Fe.addScaledVector(dg,t),Ge.addScaledVector(eg,t),He.addScaledVector(fg,t)):(Fe.addScaledVector(dg.sub(Ab),t),Ge.addScaledVector(eg.sub(Bb),t),He.addScaledVector(fg.sub(Cb),t)))}Ab.add(Fe);Bb.add(Ge);Cb.add(He)}a.isSkinnedMesh&&(a.boneTransform(n,Ab),a.boneTransform(q,Bb),a.boneTransform(p,Cb));if(a=uh(a,b,c,d,Ab,Bb,Cb,Dd))h&&(zc.fromBufferAttribute(h,n),Ac.fromBufferAttribute(h,q),Bc.fromBufferAttribute(h,p),a.uv=sa.getUV(Dd,Ab,Bb,Cb,zc,Ac,Bc,new w)),l&&(zc.fromBufferAttribute(l,n),Ac.fromBufferAttribute(l,q),Bc.fromBufferAttribute(l,p),a.uv2=sa.getUV(Dd,Ab,Bb,Cb,zc,Ac,Bc,new w)),h=new yc(n,q,p),sa.getNormal(Ab,Bb,Cb,h.normal),a.face=h;return a}function J(){Object.defineProperty(this,"id",{value:ij+=2});this.uuid=P.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function Cc(a){var b={},c;for(c in a){b[c]={};for(var d in a[c]){var e=a[c][d];e&&(e.isColor||e.isMatrix3||e.isMatrix4||e.isVector2||e.isVector3||e.isVector4||e.isTexture)?b[c][d]=e.clone():Array.isArray(e)?b[c][d]=e.slice():b[c][d]=e}}return b}function xa(a){for(var b={},c=0;c<a.length;c++){var d=Cc(a[c]),e;for(e in d)b[e]=d[e]}return b}function Ba(a){K.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;this.uniformsNeedUpdate=!1;void 0!==a&&(void 0!==a.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(a))}function eb(){y.call(this);this.type="Camera";this.matrixWorldInverse=new T;this.projectionMatrix=new T;this.projectionMatrixInverse=new T}function ma(a,b,c,d){eb.call(this);this.type="PerspectiveCamera";this.fov=void 0!==a?a:50;this.zoom=1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2E3;this.focus=10;this.aspect=void 0!==b?b:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()}function Dc(a,b,c){y.call(this);this.type="CubeCamera";if(!0!==c.isWebGLCubeRenderTarget)console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");else{this.renderTarget=c;var d=new ma(90,1,a,b);d.layers=this.layers;d.up.set(0,-1,0);d.lookAt(new m(1,0,0));this.add(d);var e=new ma(90,1,a,b);e.layers=this.layers;e.up.set(0,-1,0);e.lookAt(new m(-1,0,0));this.add(e);var f=new ma(90,1,a,b);f.layers=this.layers;f.up.set(0,0,1);f.lookAt(new m(0,1,0));this.add(f);var g=new ma(90,1,a,b);g.layers=this.layers;g.up.set(0,0,-1);g.lookAt(new m(0,-1,0));this.add(g);var h=new ma(90,1,a,b);h.layers=this.layers;h.up.set(0,-1,0);h.lookAt(new m(0,0,1));this.add(h);var l=new ma(90,1,a,b);l.layers=this.layers;l.up.set(0,-1,0);l.lookAt(new m(0,0,-1));this.add(l);this.update=function(a,b){null===this.parent&&this.updateMatrixWorld();var n=a.xr.enabled,q=a.getRenderTarget();a.xr.enabled=!1;var k=c.texture.generateMipmaps;c.texture.generateMipmaps=!1;a.setRenderTarget(c,0);a.render(b,d);a.setRenderTarget(c,1);a.render(b,e);a.setRenderTarget(c,2);a.render(b,f);a.setRenderTarget(c,3);a.render(b,g);a.setRenderTarget(c,4);a.render(b,h);c.texture.generateMipmaps=k;a.setRenderTarget(c,5);a.render(b,l);a.setRenderTarget(q);a.xr.enabled=n};this.clear=function(a,b,d,e){for(var f=a.getRenderTarget(),g=0;6>g;g++)a.setRenderTarget(c,g),a.clear(b,d,e);a.setRenderTarget(f)}}}function Yb(a,b,c){Number.isInteger(b)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),b=c);Ea.call(this,a,a,b)}function Zb(a,b,c,d,e,f,g,h,l,n,q,p){V.call(this,null,f,g,h,l,n,d,e,q,p);this.image={data:a||null,width:b||1,height:c||1};this.magFilter=void 0!==l?l:1003;this.minFilter=void 0!==n?n:1003;this.flipY=this.generateMipmaps=!1;this.unpackAlignment=1;this.needsUpdate=!0}function Ec(a,b,c,d,e,f){this.planes=[void 0!==a?a:new Ua,void 0!==b?b:new Ua,void 0!==c?c:new Ua,void 0!==d?d:new Ua,void 0!==e?e:new Ua,void 0!==f?f:new Ua]}function vh(){function a(c,g){d(c,g);e=b.requestAnimationFrame(a)}var b=null,c=!1,d=null,e=null;return{start:function(){!0!==c&&null!==d&&(e=b.requestAnimationFrame(a),c=!0)},stop:function(){b.cancelAnimationFrame(e);c=!1},setAnimationLoop:function(a){d=a},setContext:function(a){b=a}}}function jj(a,b){function c(b,c){var d=b.array,e=b.usage,f=a.createBuffer();a.bindBuffer(c,f);a.bufferData(c,d,e);b.onUploadCallback();c=5126;d instanceof Float32Array?c=5126:d instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):d instanceof Uint16Array?c=5123:d instanceof Int16Array?c=5122:d instanceof Uint32Array?c=5125:d instanceof Int32Array?c=5124:d instanceof Int8Array?c=5120:d instanceof Uint8Array&&(c=5121);return{buffer:f,type:c,bytesPerElement:d.BYTES_PER_ELEMENT,version:b.version}}var d=b.isWebGL2,e=new WeakMap;return{get:function(a){a.isInterleavedBufferAttribute&&(a=a.data);return e.get(a)},remove:function(b){b.isInterleavedBufferAttribute&&(b=b.data);var c=e.get(b);c&&(a.deleteBuffer(c.buffer),e.delete(b))},update:function(b,g){b.isInterleavedBufferAttribute&&(b=b.data);var f=e.get(b);if(void 0===f)e.set(b,c(b,g));else if(f.version<b.version){var l=b.array,n=b.updateRange;a.bindBuffer(g,f.buffer);-1===n.count?a.bufferSubData(g,0,l):(d?a.bufferSubData(g,n.offset*l.BYTES_PER_ELEMENT,l,n.offset,n.count):a.bufferSubData(g,n.offset*l.BYTES_PER_ELEMENT,l.subarray(n.offset,n.offset+n.count)),n.count=-1);f.version=b.version}}}}function Ed(a,b,c,d){J.call(this);this.type="PlaneGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};this.fromBufferGeometry(new $b(a,b,c,d));this.mergeVertices()}function $b(a,b,c,d){D.call(this);this.type="PlaneBufferGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};a=a||1;b=b||1;var e=a/2,f=b/2;c=Math.floor(c)||1;d=Math.floor(d)||1;var g=c+1,h=d+1,l=a/c,n=b/d;b=[];a=[];for(var q=[],p=[],v=0;v<h;v++)for(var k=v*n-f,t=0;t<g;t++)a.push(t*l-e,-k,0),q.push(0,0,1),p.push(t/c),p.push(1-v/d);for(e=0;e<d;e++)for(f=0;f<c;f++)h=f+g*(e+1),l=f+1+g*(e+1),n=f+1+g*e,b.push(f+g*e,h,n),b.push(h,l,n);this.setIndex(b);this.setAttribute("position",new C(a,3));this.setAttribute("normal",new C(q,3));this.setAttribute("uv",new C(p,2))}function kj(a,b,c,d){function e(a,c){b.buffers.color.setClear(a.r,a.g,a.b,c,d)}var f=new H(0),g=0,h,l,n=null,q=0,p=null;return{getClearColor:function(){return f},setClearColor:function(a,b){f.set(a);g=void 0!==b?b:1;e(f,g)},getClearAlpha:function(){return g},setClearAlpha:function(a){g=a;e(f,g)},render:function(b,d,t,k){d=!0===d.isScene?d.background:null;t=a.xr;(t=t.getSession&&t.getSession())&&"additive"===t.environmentBlendMode&&(d=null);null===d?e(f,g):d&&d.isColor&&(e(d,1),k=!0);(a.autoClear||k)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil);if(d&&(d.isCubeTexture||d.isWebGLCubeRenderTarget||306===d.mapping)){void 0===l&&(l=new Z(new Fd(1,1,1),new Ba({name:"BackgroundCubeMaterial",uniforms:Cc(Va.cube.uniforms),vertexShader:Va.cube.vertexShader,fragmentShader:Va.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(a,b,c){this.matrixWorld.copyPosition(c.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),c.update(l));k=d.isWebGLCubeRenderTarget?d.texture:d;l.material.uniforms.envMap.value=k;l.material.uniforms.flipEnvMap.value=k.isCubeTexture?-1:1;if(n!==d||q!==k.version||p!==a.toneMapping)l.material.needsUpdate=!0,n=d,q=k.version,p=a.toneMapping;b.unshift(l,l.geometry,l.material,0,0,null)}else if(d&&d.isTexture){void 0===h&&(h=new Z(new $b(2,2),new Ba({name:"BackgroundMaterial",uniforms:Cc(Va.background.uniforms),vertexShader:Va.background.vertexShader,fragmentShader:Va.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),c.update(h));h.material.uniforms.t2D.value=d;!0===d.matrixAutoUpdate&&d.updateMatrix();h.material.uniforms.uvTransform.value.copy(d.matrix);if(n!==d||q!==d.version||p!==a.toneMapping)h.material.needsUpdate=!0,n=d,q=d.version,p=a.toneMapping;b.unshift(h,h.geometry,h.material,0,0,null)}}}}function lj(a,b,c,d){function e(b){return d.isWebGL2?a.bindVertexArray(b):t.bindVertexArrayOES(b)}
function f(b){return d.isWebGL2?a.deleteVertexArray(b):t.deleteVertexArrayOES(b)}function g(a){for(var b=[],c=[],d=[],e=0;e<r;e++)b[e]=0,c[e]=0,d[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:b,enabledAttributes:c,attributeDivisors:d,object:a,attributes:{}}}function h(){for(var a=x.newAttributes,b=0,c=a.length;b<c;b++)a[b]=0}function l(a){n(a,0)}function n(c,e){var f=x.enabledAttributes,g=x.attributeDivisors;x.newAttributes[c]=1;0===f[c]&&(a.enableVertexAttribArray(c),f[c]=1);g[c]!==e&&((d.isWebGL2?a:b.get("ANGLE_instanced_arrays"))[d.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](c,e),g[c]=e)}function q(){for(var b=x.newAttributes,c=x.enabledAttributes,d=0,e=c.length;d<e;d++)c[d]!==b[d]&&(a.disableVertexAttribArray(d),c[d]=0)}function p(){k();x!==A&&(x=A,e(x.object))}function k(){A.geometry=null;A.program=null;A.wireframe=!1}var r=a.getParameter(34921),t=d.isWebGL2?null:b.get("OES_vertex_array_object"),u=d.isWebGL2||null!==t,m={},A=g(null),x=A;return{setup:function(f,p,k,v,r){var z=!1;if(u){z=!0===p.wireframe;var E=m[v.id];void 0===E&&(E={},m[v.id]=E);var B=E[k.id];void 0===B&&(B={},E[k.id]=B);E=B[z];void 0===E&&(E=g(d.isWebGL2?a.createVertexArray():t.createVertexArrayOES()),B[z]=E);z=E;x!==z&&(x=z,e(x.object));a:if(z=x.attributes,B=v.attributes,Object.keys(z).length!==Object.keys(B).length)z=!0;else{for(var A in B){E=z[A];var W=B[A];if(E.attribute!==W||E.data!==W.data){z=!0;break a}}z=!1}if(z){A={};B=v.attributes;for(var N in B)E=B[N],W={},W.attribute=E,E.data&&(W.data=E.data),A[N]=W;x.attributes=A}}else if(N=!0===p.wireframe,x.geometry!==v.id||x.program!==k.id||x.wireframe!==N)x.geometry=v.id,x.program=k.id,x.wireframe=N,z=!0;!0===f.isInstancedMesh&&(z=!0);null!==r&&c.update(r,34963);if(z){if(!1!==d.isWebGL2||!f.isInstancedMesh&&!v.isInstancedBufferGeometry||null!==b.get("ANGLE_instanced_arrays")){h();N=v.attributes;k=k.getAttributes();p=p.defaultAttributeValues;for(var ya in k)if(z=k[ya],0<=z){var O=N[ya];if(void 0!==O){if(A=O.normalized,W=O.itemSize,E=c.get(O),void 0!==E){var w=E.buffer;B=E.type;E=E.bytesPerElement;if(O.isInterleavedBufferAttribute){var y=O.data,C=y.stride;O=O.offset;y&&y.isInstancedInterleavedBuffer?(n(z,y.meshPerAttribute),void 0===v._maxInstanceCount&&(v._maxInstanceCount=y.meshPerAttribute*y.count)):l(z);a.bindBuffer(34962,w);C*=E;E*=O;!0!==d.isWebGL2||5124!==B&&5125!==B?a.vertexAttribPointer(z,W,B,A,C,E):a.vertexAttribIPointer(z,W,B,C,E)}else O.isInstancedBufferAttribute?(n(z,O.meshPerAttribute),void 0===v._maxInstanceCount&&(v._maxInstanceCount=O.meshPerAttribute*O.count)):l(z),a.bindBuffer(34962,w),E=W,!0!==d.isWebGL2||5124!==B&&5125!==B?a.vertexAttribPointer(z,E,B,A,0,0):a.vertexAttribIPointer(z,E,B,0,0)}}else if("instanceMatrix"===ya)B=c.get(f.instanceMatrix),void 0!==B&&(A=B.buffer,B=B.type,n(z+0,1),n(z+1,1),n(z+2,1),n(z+3,1),a.bindBuffer(34962,A),a.vertexAttribPointer(z+0,4,B,!1,64,0),a.vertexAttribPointer(z+1,4,B,!1,64,16),a.vertexAttribPointer(z+2,4,B,!1,64,32),a.vertexAttribPointer(z+3,4,B,!1,64,48));else if(void 0!==p&&(A=p[ya],void 0!==A))switch(A.length){case 2:a.vertexAttrib2fv(z,A);break;case 3:a.vertexAttrib3fv(z,A);break;case 4:a.vertexAttrib4fv(z,A);break;default:a.vertexAttrib1fv(z,A)}}q()}null!==r&&a.bindBuffer(34963,c.get(r).buffer)}},reset:p,resetDefaultState:k,dispose:function(){p();for(var a in m){var b=m[a],c;for(c in b){var d=b[c],e;for(e in d)f(d[e].object),delete d[e];delete b[c]}delete m[a]}},releaseStatesOfGeometry:function(a){if(void 0!==m[a.id]){var b=m[a.id],c;for(c in b){var d=b[c],e;for(e in d)f(d[e].object),delete d[e];delete b[c]}delete m[a.id]}},releaseStatesOfProgram:function(a){for(var b in m){var c=m[b];if(void 0!==c[a.id]){var d=c[a.id],e;for(e in d)f(d[e].object),delete d[e];delete c[a.id]}}},initAttributes:h,enableAttribute:l,disableUnusedAttributes:q}}function mj(a,b,c,d){var e=d.isWebGL2,f;this.setMode=function(a){f=a};this.render=function(b,d){a.drawArrays(f,b,d);c.update(d,f)};this.renderInstances=function(d,h,l,n){if(0!==n){if(e){d=a;var g="drawArraysInstanced"}else if(d=b.get("ANGLE_instanced_arrays"),g="drawArraysInstancedANGLE",null===d){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[g](f,h,l,n);c.update(l,f,n)}}}function nj(a,b,c){function d(b){if("highp"===b){if(0<a.getShaderPrecisionFormat(35633,36338).precision&&0<a.getShaderPrecisionFormat(35632,36338).precision)return"highp";b="mediump"}return"mediump"===b&&0<a.getShaderPrecisionFormat(35633,36337).precision&&0<a.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var e,f="undefined"!==typeof WebGL2RenderingContext&&a instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&a instanceof WebGL2ComputeRenderingContext,g=void 0!==c.precision?c.precision:"highp",h=d(g);h!==g&&(console.warn("THREE.WebGLRenderer:",g,"not supported, using",h,"instead."),g=h);c=!0===c.logarithmicDepthBuffer;h=a.getParameter(34930);var l=a.getParameter(35660),n=a.getParameter(3379),q=a.getParameter(34076),p=a.getParameter(34921),k=a.getParameter(36347),r=a.getParameter(36348),t=a.getParameter(36349),u=0<l,z=f||!!b.get("OES_texture_float"),m=u&&z,x=f?a.getParameter(36183):0;return{isWebGL2:f,getMaxAnisotropy:function(){if(void 0!==e)return e;var c=b.get("EXT_texture_filter_anisotropic");return e=null!==c?a.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:d,precision:g,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:l,maxTextureSize:n,maxCubemapSize:q,maxAttributes:p,maxVertexUniforms:k,maxVaryings:r,maxFragmentUniforms:t,vertexTextures:u,floatFragmentTextures:z,floatVertexTextures:m,maxSamples:x}}function oj(){function a(){n.value!==d&&(n.value=d,n.needsUpdate=0<e);c.numPlanes=e;c.numIntersection=0}function b(a,b,d,e){var f=null!==a?a.length:0,g=null;if(0!==f){g=n.value;if(!0!==e||null===g){e=d+4*f;b=b.matrixWorldInverse;l.getNormalMatrix(b);if(null===g||g.length<e)g=new Float32Array(e);for(e=0;e!==f;++e,d+=4)h.copy(a[e]).applyMatrix4(b,l),h.normal.toArray(g,d),g[d+3]=h.constant}n.value=g;n.needsUpdate=!0}c.numPlanes=f;c.numIntersection=0;return g}var c=this,d=null,e=0,f=!1,g=!1,h=new Ua,l=new za,n={value:null,needsUpdate:!1};this.uniform=n;this.numIntersection=this.numPlanes=0;this.init=function(a,c,g){var h=0!==a.length||c||0!==e||f;f=c;d=b(a,g,0);e=a.length;return h};this.beginShadows=function(){g=!0;b(null)};this.endShadows=function(){g=!1;a()};this.setState=function(c,h,l,k,t,u){if(!f||null===c||0===c.length||g&&!l)g?b(null):a();else{l=g?0:e;var q=4*l,p=t.clippingState||null;n.value=p;p=b(c,k,q,u);for(c=0;c!==q;++c)p[c]=d[c];t.clippingState=p;this.numIntersection=h?this.numPlanes:0;this.numPlanes+=l}}}function pj(a){var b={};return{has:function(c){if(void 0!==b[c])return b[c];switch(c){case"WEBGL_depth_texture":var d=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":d=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":d=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":d=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:d=a.getExtension(c)}b[c]=d;return!!d},get:function(a){this.has(a)||console.warn("THREE.WebGLRenderer: "+
a+" extension not supported.");return b[a]}}}function qj(a,b,c,d){function e(a){a=a.target;var f=g.get(a);null!==f.index&&b.remove(f.index);for(var l in f.attributes)b.remove(f.attributes[l]);a.removeEventListener("dispose",e);g.delete(a);if(l=h.get(f))b.remove(l),h.delete(f);d.releaseStatesOfGeometry(a);!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount;c.memory.geometries--}function f(a){var c=[],d=a.index,e=a.attributes.position;if(null!==d){e=d.array;d=d.version;for(var f=0,g=e.length;f<g;f+=3){var l=e[f+0],k=e[f+1],m=e[f+2];c.push(l,k,k,m,m,l)}}else for(f=e.array,d=e.version,e=0,f=f.length/3-1;e<f;e+=3)g=e+0,l=e+1,k=e+2,c.push(g,l,l,k,k,g);c=new(65535<th(c)?Xb:Wb)(c,1);c.version=d;(d=h.get(a))&&b.remove(d);h.set(a,c)}var g=new WeakMap,h=new WeakMap;return{get:function(a,b){var d=g.get(b);if(d)return d;b.addEventListener("dispose",e);b.isBufferGeometry?d=b:b.isGeometry&&(void 0===b._bufferGeometry&&(b._bufferGeometry=(new D).setFromObject(a)),d=b._bufferGeometry);g.set(b,d);c.memory.geometries++;return d},update:function(a){var c=a.attributes;for(e in c)b.update(c[e],34962);a=a.morphAttributes;for(var d in a){c=a[d];var e=0;for(var f=c.length;e<f;e++)b.update(c[e],34962)}},getWireframeAttribute:function(a){var b=h.get(a);if(b){var c=a.index;null!==c&&b.version<c.version&&f(a)}else f(a);return h.get(a)}}}function rj(a,b,c,d){var e=d.isWebGL2,f,g,h;this.setMode=function(a){f=a};this.setIndex=function(a){g=a.type;h=a.bytesPerElement};this.render=function(b,d){a.drawElements(f,d,g,b*h);c.update(d,f)};this.renderInstances=function(d,n,q,p){if(0!==p){if(e){d=a;var l="drawElementsInstanced"}else if(d=b.get("ANGLE_instanced_arrays"),l="drawElementsInstancedANGLE",null===d){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[l](f,q,g,n*h,p);c.update(q,f,p)}}}function sj(a){var b={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:b,programs:null,autoReset:!0,reset:function(){b.frame++;b.calls=0;b.triangles=0;b.points=0;b.lines=0},update:function(a,d,e){e=e||1;b.calls++;switch(d){case 4:b.triangles+=a/3*e;break;case 1:b.lines+=a/2*e;break;case 3:b.lines+=e*(a-1);break;case 2:b.lines+=e*a;break;case 0:b.points+=e*a;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",d)}}}}function tj(a,b){return a[0]-b[0]}function uj(a,b){return Math.abs(b[1])-Math.abs(a[1])}function vj(a){for(var b={},c=new Float32Array(8),d=[],e=0;8>e;e++)d[e]=[e,0];return{update:function(e,g,h,l){var f=e.morphTargetInfluences;e=void 0===f?0:f.length;var q=b[g.id];if(void 0===q){q=[];for(var p=0;p<e;p++)q[p]=[p,0];b[g.id]=q}for(p=0;p<e;p++){var k=q[p];k[0]=p;k[1]=f[p]}q.sort(uj);for(f=0;8>f;f++)f<e&&q[f][1]?(d[f][0]=q[f][0],d[f][1]=q[f][1]):(d[f][0]=Number.MAX_SAFE_INTEGER,d[f][1]=0);d.sort(tj);e=h.morphTargets&&g.morphAttributes.position;h=h.morphNormals&&g.morphAttributes.normal;for(f=q=0;8>f;f++)k=d[f],p=k[0],k=k[1],p!==Number.MAX_SAFE_INTEGER&&k?(e&&g.getAttribute("morphTarget"+f)!==e[p]&&g.setAttribute("morphTarget"+f,e[p]),h&&g.getAttribute("morphNormal"+f)!==h[p]&&g.setAttribute("morphNormal"+f,h[p]),c[f]=k,q+=k):(e&&void 0!==g.getAttribute("morphTarget"+f)&&g.deleteAttribute("morphTarget"+f),h&&void 0!==g.getAttribute("morphNormal"+f)&&g.deleteAttribute("morphNormal"+f),c[f]=0);g=g.morphTargetsRelative?1:1-q;l.getUniforms().setValue(a,"morphTargetBaseInfluence",g);l.getUniforms().setValue(a,"morphTargetInfluences",c)}}}function wj(a,b,c,d){var e=new WeakMap;return{update:function(a){var f=d.render.frame,h=a.geometry,l=b.get(a,h);e.get(l)!==f&&(h.isGeometry&&l.updateFromObject(a),b.update(l),e.set(l,f));a.isInstancedMesh&&c.update(a.instanceMatrix,34962);return l},dispose:function(){e=new WeakMap}}}function ob(a,b,c,d,e,f,g,h,l,n){a=void 0!==a?a:[];V.call(this,a,void 0!==b?b:301,c,d,e,f,void 0!==g?g:1022,h,l,n);this.flipY=!1}function Fc(a,b,c,d){V.call(this,null);this.image={data:a||null,width:b||1,height:c||1,depth:d||1};this.minFilter=this.magFilter=1003;this.wrapR=1001;this.flipY=this.generateMipmaps=!1;this.needsUpdate=!0}function Gc(a,b,c,d){V.call(this,null);this.image={data:a||null,width:b||1,height:c||1,depth:d||1};this.minFilter=this.magFilter=1003;this.wrapR=1001;this.flipY=this.generateMipmaps=!1;this.needsUpdate=!0}function Hc(a,b,c){var d=a[0];if(0>=d||0<d)return a;var e=b*c,f=wh[e];void 0===f&&(f=new Float32Array(e),wh[e]=f);if(0!==b)for(d.toArray(f,0),d=1,e=0;d!==b;++d)e+=c,a[d].toArray(f,e);return f}function Pa(a,b){if(a.length!==b.length)return!1;for(var c=0,d=a.length;c<d;c++)if(a[c]!==b[c])return!1;return!0}function Aa(a,b){for(var c=0,d=b.length;c<d;c++)a[c]=b[c]}function xh(a,b){var c=yh[b];void 0===c&&(c=new Int32Array(b),yh[b]=c);for(var d=0;d!==b;++d)c[d]=a.allocateTextureUnit();return c}function xj(a,b){var c=this.cache;c[0]!==b&&(a.uniform1f(this.addr,b),c[0]=b)}function yj(a,b){var c=this.cache;if(void 0!==b.x){if(c[0]!==b.x||c[1]!==b.y)a.uniform2f(this.addr,b.x,b.y),c[0]=b.x,c[1]=b.y}else Pa(c,b)||(a.uniform2fv(this.addr,b),Aa(c,b))}function zj(a,b){var c=this.cache;if(void 0!==b.x){if(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z)a.uniform3f(this.addr,b.x,b.y,b.z),c[0]=b.x,c[1]=b.y,c[2]=b.z}else if(void 0!==b.r){if(c[0]!==b.r||c[1]!==b.g||c[2]!==b.b)a.uniform3f(this.addr,b.r,b.g,b.b),c[0]=b.r,c[1]=b.g,c[2]=b.b}else Pa(c,b)||(a.uniform3fv(this.addr,b),Aa(c,b))}function Aj(a,b){var c=this.cache;if(void 0!==b.x){if(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z||c[3]!==b.w)a.uniform4f(this.addr,b.x,b.y,b.z,b.w),c[0]=b.x,c[1]=b.y,c[2]=b.z,c[3]=b.w}else Pa(c,b)||(a.uniform4fv(this.addr,b),Aa(c,b))}function Bj(a,b){var c=this.cache,d=b.elements;void 0===d?Pa(c,b)||(a.uniformMatrix2fv(this.addr,!1,b),Aa(c,b)):Pa(c,d)||(zh.set(d),a.uniformMatrix2fv(this.addr,!1,zh),Aa(c,d))}function Cj(a,b){var c=this.cache,d=b.elements;void 0===d?Pa(c,b)||(a.uniformMatrix3fv(this.addr,!1,b),Aa(c,b)):Pa(c,d)||(Ah.set(d),a.uniformMatrix3fv(this.addr,!1,Ah),Aa(c,d))}function Dj(a,b){var c=this.cache,d=b.elements;void 0===d?Pa(c,b)||(a.uniformMatrix4fv(this.addr,!1,b),Aa(c,b)):Pa(c,d)||(Bh.set(d),a.uniformMatrix4fv(this.addr,!1,Bh),Aa(c,d))}function Ej(a,b,c){var d=this.cache,e=c.allocateTextureUnit();d[0]!==e&&(a.uniform1i(this.addr,e),d[0]=e);c.safeSetTexture2D(b||Ch,e)}function Fj(a,b,c){var d=this.cache,e=c.allocateTextureUnit();d[0]!==e&&(a.uniform1i(this.addr,e),d[0]=e);c.setTexture2DArray(b||Gj,e)}function Hj(a,b,c){var d=this.cache,e=c.allocateTextureUnit();d[0]!==e&&(a.uniform1i(this.addr,e),d[0]=e);c.setTexture3D(b||Ij,e)}function Jj(a,b,c){var d=this.cache,e=c.allocateTextureUnit();d[0]!==e&&(a.uniform1i(this.addr,e),d[0]=e);c.safeSetTextureCube(b||Dh,e)}function Kj(a,b){var c=this.cache;c[0]!==b&&(a.uniform1i(this.addr,b),c[0]=b)}function Lj(a,b){var c=this.cache;Pa(c,b)||(a.uniform2iv(this.addr,b),Aa(c,b))}function Mj(a,b){var c=this.cache;Pa(c,b)||(a.uniform3iv(this.addr,b),Aa(c,b))}function Nj(a,b){var c=this.cache;Pa(c,b)||(a.uniform4iv(this.addr,b),Aa(c,b))}function Oj(a,b){var c=this.cache;c[0]!==b&&(a.uniform1ui(this.addr,b),c[0]=b)}function Pj(a){switch(a){case 5126:return xj;case 35664:return yj;case 35665:return zj;case 35666:return Aj;case 35674:return Bj;case 35675:return Cj;case 35676:return Dj;case 5124:case 35670:return Kj;case 35667:case 35671:return Lj;case 35668:case 35672:return Mj;case 35669:case 35673:return Nj;case 5125:return Oj;case 35678:case 36198:case 36298:case 36306:case 35682:return Ej;case 35679:case 36299:case 36307:return Hj;case 35680:case 36300:case 36308:case 36293:return Jj;case 36289:case 36303:case 36311:case 36292:return Fj}}function Qj(a,b){a.uniform1fv(this.addr,b)}function Rj(a,b){a.uniform1iv(this.addr,b)}function Sj(a,b){a.uniform2iv(this.addr,b)}function Tj(a,b){a.uniform3iv(this.addr,b)}function Uj(a,b){a.uniform4iv(this.addr,b)}function Vj(a,b){b=Hc(b,this.size,2);a.uniform2fv(this.addr,b)}function Wj(a,b){b=Hc(b,this.size,3);a.uniform3fv(this.addr,b)}function Xj(a,b){b=Hc(b,this.size,4);a.uniform4fv(this.addr,b)}function Yj(a,b){b=Hc(b,this.size,4);a.uniformMatrix2fv(this.addr,!1,b)}function Zj(a,b){b=Hc(b,this.size,9);a.uniformMatrix3fv(this.addr,!1,b)}function ak(a,b){b=Hc(b,this.size,16);a.uniformMatrix4fv(this.addr,!1,b)}function bk(a,b,c){var d=b.length,e=xh(c,d);a.uniform1iv(this.addr,e);for(a=0;a!==d;++a)c.safeSetTexture2D(b[a]||Ch,e[a])}function ck(a,b,c){var d=b.length,e=xh(c,d);a.uniform1iv(this.addr,e);for(a=0;a!==d;++a)c.safeSetTextureCube(b[a]||Dh,e[a])}function dk(a){switch(a){case 5126:return Qj;case 35664:return Vj;case 35665:return Wj;case 35666:return Xj;case 35674:return Yj;case 35675:return Zj;case 35676:return ak;case 5124:case 35670:return Rj;case 35667:case 35671:return Sj;case 35668:case 35672:return Tj;case 35669:case 35673:return Uj;case 35678:case 36198:case 36298:case 36306:case 35682:return bk;case 35680:case 36300:case 36308:case 36293:return ck}}function ek(a,b,c){this.id=a;this.addr=c;this.cache=[];this.setValue=Pj(b.type)}function Eh(a,b,c){this.id=a;this.addr=c;this.cache=[];this.size=b.size;this.setValue=dk(b.type)}function Fh(a){this.id=a;this.seq=[];this.map={}}function Db(a,b){this.seq=[];this.map={};for(var c=a.getProgramParameter(b,35718),d=0;d<c;++d){var e=a.getActiveUniform(b,d),f=a.getUniformLocation(b,e.name),g=this,h=e.name,l=h.length;for(gg.lastIndex=0;;){var n=gg.exec(h),q=gg.lastIndex,p=n[1],k=n[3];"]"===n[2]&&(p|=0);if(void 0===k||"["===k&&q+2===l){h=g;e=void 0===k?new ek(p,e,f):new Eh(p,e,f);h.seq.push(e);h.map[e.id]=e;break}else k=g.map[p],void 0===k&&(k=new Fh(p),p=g,g=k,p.seq.push(g),p.map[g.id]=g),g=k}}}function Gh(a,b,c){b=a.createShader(b);a.shaderSource(b,c);a.compileShader(b);return b}function Hh(a){switch(a){case 3E3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",a),["Linear","( value )"]}}function Ih(a,b,c){var d=a.getShaderParameter(b,35713),e=a.getShaderInfoLog(b).trim();if(d&&""===e)return"";a=a.getShaderSource(b).split("\n");for(b=0;b<a.length;b++)a[b]=b+1+": "+a[b];a=a.join("\n");return"THREE.WebGLShader: gl.getShaderInfoLog() "+c+"\n"+e+a}function Gd(a,b){b=Hh(b);return"vec4 "+a+"( vec4 value ) { return "+b[0]+"ToLinear"+b[1]+"; }"}function fk(a,b){b=Hh(b);return"vec4 "+a+"( vec4 value ) { return LinearTo"+b[0]+b[1]+"; }"}function gk(a,b){switch(b){case 1:b="Linear";break;case 2:b="Reinhard";break;case 3:b="OptimizedCineon";break;case 4:b="ACESFilmic";break;case 5:b="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",b),b="Linear"}return"vec3 "+a+"( vec3 color ) { return "+b+"ToneMapping( color ); }"}function hk(a){var b=[],c;for(c in a){var d=a[c];!1!==d&&b.push("#define "+c+" "+d)}return b.join("\n")}function Hd(a){return""!==a}function Jh(a,b){return a.replace(/NUM_DIR_LIGHTS/g,b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,b.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,b.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,b.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,b.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,b.numPointLightShadows)}function Kh(a,b){return a.replace(/NUM_CLIPPING_PLANES/g,b.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,b.numClippingPlanes-b.numClipIntersection)}function hg(a,b){a=M[b];if(void 0===a)throw Error("Can not resolve #include <"+b+">");return a.replace(ig,hg)}function Lh(a,b,c,d){console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead.");return jg(a,b,c,d)}function jg(a,b,c,d){a="";for(b=parseInt(b);b<parseInt(c);b++)a+=d.replace(/\[ i \]/g,"[ "+b+" ]").replace(/UNROLLED_LOOP_INDEX/g,b);return a}function Mh(a){var b="precision "+a.precision+" float;\nprecision "+a.precision+" int;";"highp"===a.precision?b+="\n#define HIGH_PRECISION":"mediump"===a.precision?b+="\n#define MEDIUM_PRECISION":"lowp"===a.precision&&(b+="\n#define LOW_PRECISION");return b}function ik(a){var b="SHADOWMAP_TYPE_BASIC";1===a.shadowMapType?b="SHADOWMAP_TYPE_PCF":2===a.shadowMapType?b="SHADOWMAP_TYPE_PCF_SOFT":3===a.shadowMapType&&(b="SHADOWMAP_TYPE_VSM");return b}function jk(a){var b="ENVMAP_TYPE_CUBE";if(a.envMap)switch(a.envMapMode){case 301:case 302:b="ENVMAP_TYPE_CUBE";break;case 306:case 307:b="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:b="ENVMAP_TYPE_EQUIREC"}return b}function kk(a){var b="ENVMAP_MODE_REFLECTION";if(a.envMap)switch(a.envMapMode){case 302:case 304:case 307:b="ENVMAP_MODE_REFRACTION"}return b}function lk(a){var b="ENVMAP_BLENDING_NONE";if(a.envMap)switch(a.combine){case 0:b="ENVMAP_BLENDING_MULTIPLY";break;case 1:b="ENVMAP_BLENDING_MIX";break;case 2:b="ENVMAP_BLENDING_ADD"}return b}function mk(a,b,c,d){var e=a.getContext(),f=c.defines,g=c.vertexShader,h=c.fragmentShader,l=ik(c),n=jk(c),q=kk(c),p=lk(c),k=0<a.gammaFactor?a.gammaFactor:1,r=c.isWebGL2?"":[c.extensionDerivatives||c.envMapCubeUV||c.bumpMap||c.tangentSpaceNormalMap||c.clearcoatNormalMap||c.flatShading||"physical"===c.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(c.extensionFragDepth||c.logarithmicDepthBuffer)&&c.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",c.extensionDrawBuffers&&c.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(c.extensionShaderTextureLOD||c.envMap)&&c.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Hd).join("\n"),t=hk(f),u=e.createProgram();c.isRawShaderMaterial?(f=[t].filter(Hd).join("\n"),0<f.length&&(f+="\n"),l=[r,t].filter(Hd).join("\n"),0<l.length&&(l+="\n")):(f=[Mh(c),"#define SHADER_NAME "+c.shaderName,t,c.instancing?"#define USE_INSTANCING":"",c.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+k,"#define MAX_BONES "+c.maxBones,c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+q:"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMap&&c.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",c.normalMap&&c.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.displacementMap&&c.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.transmissionMap?"#define USE_TRANSMISSIONMAP":"",c.vertexTangents?"#define USE_TANGENT":"",c.vertexColors?"#define USE_COLOR":"",c.vertexUvs?"#define USE_UV":"",c.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",c.flatShading?"#define FLAT_SHADED":"",c.skinning?"#define USE_SKINNING":"",c.useVertexTexture?"#define BONE_TEXTURE":"",c.morphTargets?"#define USE_MORPHTARGETS":"",c.morphNormals&&!1===c.flatShading?"#define USE_MORPHNORMALS":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+l:"",c.sizeAttenuation?"#define USE_SIZEATTENUATION":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&c.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Hd).join("\n"),l=[r,Mh(c),"#define SHADER_NAME "+c.shaderName,t,c.alphaTest?"#define ALPHATEST "+c.alphaTest+(c.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+k,c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.matcap?"#define USE_MATCAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+n:"",c.envMap?"#define "+q:"",c.envMap?"#define "+p:"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMap&&c.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",c.normalMap&&c.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.sheen?"#define USE_SHEEN":"",c.transmissionMap?"#define USE_TRANSMISSIONMAP":"",c.vertexTangents?"#define USE_TANGENT":"",c.vertexColors?"#define USE_COLOR":"",c.vertexUvs?"#define USE_UV":"",c.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",c.gradientMap?"#define USE_GRADIENTMAP":"",c.flatShading?"#define FLAT_SHADED":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+l:"",c.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",c.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&c.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(c.extensionShaderTextureLOD||c.envMap)&&c.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==c.toneMapping?"#define TONE_MAPPING":"",0!==c.toneMapping?M.tonemapping_pars_fragment:"",0!==c.toneMapping?gk("toneMapping",c.toneMapping):"",c.dithering?"#define DITHERING":"",M.encodings_pars_fragment,c.map?Gd("mapTexelToLinear",c.mapEncoding):"",c.matcap?Gd("matcapTexelToLinear",c.matcapEncoding):"",c.envMap?Gd("envMapTexelToLinear",c.envMapEncoding):"",c.emissiveMap?Gd("emissiveMapTexelToLinear",c.emissiveMapEncoding):"",c.lightMap?Gd("lightMapTexelToLinear",c.lightMapEncoding):"",fk("linearToOutputTexel",c.outputEncoding),c.depthPacking?"#define DEPTH_PACKING "+c.depthPacking:"","\n"].filter(Hd).join("\n"));g=g.replace(ig,hg);g=Jh(g,c);g=Kh(g,c);h=h.replace(ig,hg);h=Jh(h,c);h=Kh(h,c);g=g.replace(Nh,jg).replace(Oh,Lh);h=h.replace(Nh,jg).replace(Oh,Lh);c.isWebGL2&&!c.isRawShaderMaterial&&(f="#version 300 es\n\n#define attribute in\n#define varying out\n#define texture2D texture\n"+
f,l="#version 300 es\n\n#define varying in\nout highp vec4 pc_fragColor;\n#define gl_FragColor pc_fragColor\n#define gl_FragDepthEXT gl_FragDepth\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad\n"+l);h=l+h;g=Gh(e,35633,f+g);h=Gh(e,35632,h);e.attachShader(u,g);e.attachShader(u,h);void 0!==c.index0AttributeName?e.bindAttribLocation(u,0,c.index0AttributeName):!0===c.morphTargets&&e.bindAttribLocation(u,0,"position");e.linkProgram(u);if(a.debug.checkShaderErrors){a=e.getProgramInfoLog(u).trim();n=e.getShaderInfoLog(g).trim();q=e.getShaderInfoLog(h).trim();k=p=!0;if(!1===e.getProgramParameter(u,35714))p=!1,r=Ih(e,g,"vertex"),t=Ih(e,h,"fragment"),console.error("THREE.WebGLProgram: shader error: ",e.getError(),"35715",e.getProgramParameter(u,35715),"gl.getProgramInfoLog",a,r,t);else if(""!==a)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",a);else if(""===n||""===q)k=!1;k&&(this.diagnostics={runnable:p,programLog:a,vertexShader:{log:n,prefix:f},fragmentShader:{log:q,prefix:l}})}e.deleteShader(g);e.deleteShader(h);var m;this.getUniforms=function(){void 0===m&&(m=new Db(e,u));return m};var A;this.getAttributes=function(){if(void 0===A){for(var a={},b=e.getProgramParameter(u,35721),c=0;c<b;c++){var d=e.getActiveAttrib(u,c).name;a[d]=e.getAttribLocation(u,d)}A=a}return A};this.destroy=function(){d.releaseStatesOfProgram(this);e.deleteProgram(u);this.program=void 0};this.name=c.shaderName;this.id=nk++;this.cacheKey=b;this.usedTimes=1;this.program=u;this.vertexShader=g;this.fragmentShader=h;return this}function ok(a,b,c,d){function e(a){if(a)a.isTexture?b=a.encoding:a.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),b=a.texture.encoding);else var b=3E3;return b}var f=[],g=c.isWebGL2,h=c.logarithmicDepthBuffer,l=c.floatVertexTextures,n=c.maxVertexUniforms,q=c.vertexTextures,p=c.precision,k={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},r="precision isWebGL2 supportsVertexTextures outputEncoding instancing map mapEncoding matcap matcapEncoding envMap envMapMode envMapEncoding envMapCubeUV lightMap lightMapEncoding aoMap emissiveMap emissiveMapEncoding bumpMap normalMap objectSpaceNormalMap tangentSpaceNormalMap clearcoatMap clearcoatRoughnessMap clearcoatNormalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors vertexTangents vertexUvs uvsVertexOnly fog useFog fogExp2 flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights numDirLightShadows numPointLightShadows numSpotLightShadows shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking dithering sheen transmissionMap".split(" ");return{getParameters:function(d,f,v,r,m,ya,W){var t=r.fog;r=d.isMeshStandardMaterial?r.environment:null;r=d.envMap||r;var u=k[d.type];if(W.isSkinnedMesh){var z=W.skeleton.bones;if(l)z=1024;else{var x=Math.min(Math.floor((n-20)/4),z.length);x<z.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+z.length+" bones. This GPU supports "+x+"."),z=0):z=x}}else z=0;null!==d.precision&&(p=c.getMaxPrecision(d.precision),p!==d.precision&&console.warn("THREE.WebGLProgram.getParameters:",d.precision,"not supported, using",p,"instead."));if(u){var E=Va[u];x=E.vertexShader;E=E.fragmentShader}else x=d.vertexShader,E=d.fragmentShader;var A=a.getRenderTarget();return{isWebGL2:g,shaderID:u,shaderName:d.type,vertexShader:x,fragmentShader:E,defines:d.defines,isRawShaderMaterial:d.isRawShaderMaterial,isShaderMaterial:d.isShaderMaterial,precision:p,instancing:!0===W.isInstancedMesh,supportsVertexTextures:q,outputEncoding:null!==A?e(A.texture):a.outputEncoding,map:!!d.map,mapEncoding:e(d.map),matcap:!!d.matcap,matcapEncoding:e(d.matcap),envMap:!!r,envMapMode:r&&r.mapping,envMapEncoding:e(r),envMapCubeUV:!!r&&(306===r.mapping||307===r.mapping),lightMap:!!d.lightMap,lightMapEncoding:e(d.lightMap),aoMap:!!d.aoMap,emissiveMap:!!d.emissiveMap,emissiveMapEncoding:e(d.emissiveMap),bumpMap:!!d.bumpMap,normalMap:!!d.normalMap,objectSpaceNormalMap:1===d.normalMapType,tangentSpaceNormalMap:0===d.normalMapType,clearcoatMap:!!d.clearcoatMap,clearcoatRoughnessMap:!!d.clearcoatRoughnessMap,clearcoatNormalMap:!!d.clearcoatNormalMap,displacementMap:!!d.displacementMap,roughnessMap:!!d.roughnessMap,metalnessMap:!!d.metalnessMap,specularMap:!!d.specularMap,alphaMap:!!d.alphaMap,gradientMap:!!d.gradientMap,sheen:!!d.sheen,transmissionMap:!!d.transmissionMap,combine:d.combine,vertexTangents:d.normalMap&&d.vertexTangents,vertexColors:d.vertexColors,vertexUvs:!!d.map||!!d.bumpMap||!!d.normalMap||!!d.specularMap||!!d.alphaMap||!!d.emissiveMap||!!d.roughnessMap||!!d.metalnessMap||!!d.clearcoatMap||!!d.clearcoatRoughnessMap||!!d.clearcoatNormalMap||!!d.displacementMap||!!d.transmissionMap,uvsVertexOnly:!(d.map||d.bumpMap||d.normalMap||d.specularMap||d.alphaMap||d.emissiveMap||d.roughnessMap||d.metalnessMap||d.clearcoatNormalMap||d.transmissionMap)&&!!d.displacementMap,fog:!!t,useFog:d.fog,fogExp2:t&&t.isFogExp2,flatShading:d.flatShading,sizeAttenuation:d.sizeAttenuation,logarithmicDepthBuffer:h,skinning:d.skinning&&0<z,maxBones:z,useVertexTexture:l,morphTargets:d.morphTargets,morphNormals:d.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:f.directional.length,numPointLights:f.point.length,numSpotLights:f.spot.length,numRectAreaLights:f.rectArea.length,numHemiLights:f.hemi.length,numDirLightShadows:f.directionalShadowMap.length,numPointLightShadows:f.pointShadowMap.length,numSpotLightShadows:f.spotShadowMap.length,numClippingPlanes:m,numClipIntersection:ya,dithering:d.dithering,shadowMapEnabled:a.shadowMap.enabled&&0<v.length,shadowMapType:a.shadowMap.type,toneMapping:d.toneMapped?a.toneMapping:0,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:d.premultipliedAlpha,alphaTest:d.alphaTest,doubleSided:2===d.side,flipSided:1===d.side,depthPacking:void 0!==d.depthPacking?d.depthPacking:!1,index0AttributeName:d.index0AttributeName,extensionDerivatives:d.extensions&&d.extensions.derivatives,extensionFragDepth:d.extensions&&d.extensions.fragDepth,extensionDrawBuffers:d.extensions&&d.extensions.drawBuffers,extensionShaderTextureLOD:d.extensions&&d.extensions.shaderTextureLOD,rendererExtensionFragDepth:g||null!==b.get("EXT_frag_depth"),rendererExtensionDrawBuffers:g||null!==b.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:g||null!==b.get("EXT_shader_texture_lod"),customProgramCacheKey:d.customProgramCacheKey()}},getProgramCacheKey:function(b){var c=[];b.shaderID?c.push(b.shaderID):(c.push(b.fragmentShader),c.push(b.vertexShader));if(void 0!==b.defines)for(var d in b.defines)c.push(d),c.push(b.defines[d]);if(void 0===b.isRawShaderMaterial){for(d=0;d<r.length;d++)c.push(b[r[d]]);c.push(a.outputEncoding);c.push(a.gammaFactor)}c.push(b.customProgramCacheKey);return c.join()},getUniforms:function(a){var b=k[a.type];return b?Ph.clone(Va[b].uniforms):a.uniforms},acquireProgram:function(b,c){for(var e,g=0,h=f.length;g<h;g++){var l=f[g];if(l.cacheKey===c){e=l;++e.usedTimes;break}}void 0===e&&(e=new mk(a,c,b,d),f.push(e));return e},releaseProgram:function(a){if(0===--a.usedTimes){var b=f.indexOf(a);f[b]=f[f.length-1];f.pop();a.destroy()}},programs:f}}function pk(){var a=new WeakMap;return{get:function(b){var c=a.get(b);void 0===c&&(c={},a.set(b,c));return c},remove:function(b){a.delete(b)},update:function(b,c,d){a.get(b)[c]=d},dispose:function(){a=new WeakMap}}}function qk(a,b){return a.groupOrder!==b.groupOrder?a.groupOrder-b.groupOrder:a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.program!==b.program?a.program.id-b.program.id:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function rk(a,b){return a.groupOrder!==b.groupOrder?a.groupOrder-b.groupOrder:a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function Qh(a){function b(b,e,f,q,p,k){var h=c[d],l=a.get(f);void 0===h?(h={id:b.id,object:b,geometry:e,material:f,program:l.program||g,groupOrder:q,renderOrder:b.renderOrder,z:p,group:k},c[d]=h):(h.id=b.id,h.object=b,h.geometry=e,h.material=f,h.program=l.program||g,h.groupOrder=q,h.renderOrder=b.renderOrder,h.z=p,h.group=k);d++;return h}var c=[],d=0,e=[],f=[],g={id:-1};return{opaque:e,transparent:f,init:function(){d=0;e.length=0;f.length=0},push:function(a,c,d,g,p,k){a=b(a,c,d,g,p,k);(!0===d.transparent?f:e).push(a)},unshift:function(a,c,d,g,p,k){a=b(a,c,d,g,p,k);(!0===d.transparent?f:e).unshift(a)},finish:function(){for(var a=d,b=c.length;a<b;a++){var e=c[a];if(null===e.id)break;e.id=null;e.object=null;e.geometry=null;e.material=null;e.program=null;e.group=null}},sort:function(a,b){1<e.length&&e.sort(a||qk);1<f.length&&f.sort(b||rk)}}}function sk(a){function b(a){a=a.target;a.removeEventListener("dispose",b);c.delete(a)}var c=new WeakMap;return{get:function(d,e){var f=c.get(d);if(void 0===f){var g=new Qh(a);c.set(d,new WeakMap);c.get(d).set(e,g);d.addEventListener("dispose",b)}else g=f.get(e),void 0===g&&(g=new Qh(a),f.set(e,g));return g},dispose:function(){c=new WeakMap}}}function tk(){var a={};return{get:function(b){if(void 0!==a[b.id])return a[b.id];switch(b.type){case"DirectionalLight":var c={direction:new m,color:new H};break;case"SpotLight":c={position:new m,direction:new m,color:new H,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":c={position:new m,color:new H,distance:0,decay:0};break;case"HemisphereLight":c={direction:new m,skyColor:new H,groundColor:new H};break;case"RectAreaLight":c={color:new H,position:new m,halfWidth:new m,halfHeight:new m}}return a[b.id]=c}}}function uk(){var a={};return{get:function(b){if(void 0!==a[b.id])return a[b.id];switch(b.type){case"DirectionalLight":var c={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new w};break;case"SpotLight":c={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new w};break;case"PointLight":c={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new w,shadowCameraNear:1,shadowCameraFar:1E3}}return a[b.id]=c}}}function vk(a,b){return(b.castShadow?1:0)-(a.castShadow?1:0)}function wk(){for(var a=new tk,b=uk(),c={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},d=0;9>d;d++)c.probe.push(new m);var e=new m,f=new T,g=new T;return{setup:function(d,l,n){for(var h=l=0,p=0,k=0;9>k;k++)c.probe[k].set(0,0,0);var r=k=0,t=0,u=0,m=0,A=0,x=0,ya=0;n=n.matrixWorldInverse;d.sort(vk);for(var W=0,N=d.length;W<N;W++){var B=d[W],O=B.color,w=B.intensity,E=B.distance,fa=B.shadow&&B.shadow.map?B.shadow.map.texture:null;if(B.isAmbientLight)l+=O.r*w,h+=O.g*w,p+=O.b*w;else if(B.isLightProbe)for(fa=0;9>fa;fa++)c.probe[fa].addScaledVector(B.sh.coefficients[fa],w);else if(B.isDirectionalLight){w=a.get(B);w.color.copy(B.color).multiplyScalar(B.intensity);w.direction.setFromMatrixPosition(B.matrixWorld);e.setFromMatrixPosition(B.target.matrixWorld);w.direction.sub(e);w.direction.transformDirection(n);if(B.castShadow){var ka=B.shadow;O=b.get(B);O.shadowBias=ka.bias;O.shadowNormalBias=ka.normalBias;O.shadowRadius=ka.radius;O.shadowMapSize=ka.mapSize;c.directionalShadow[k]=O;c.directionalShadowMap[k]=fa;c.directionalShadowMatrix[k]=B.shadow.matrix;A++}c.directional[k]=w;k++}else B.isSpotLight?(ka=a.get(B),ka.position.setFromMatrixPosition(B.matrixWorld),ka.position.applyMatrix4(n),ka.color.copy(O).multiplyScalar(w),ka.distance=E,ka.direction.setFromMatrixPosition(B.matrixWorld),e.setFromMatrixPosition(B.target.matrixWorld),ka.direction.sub(e),ka.direction.transformDirection(n),ka.coneCos=Math.cos(B.angle),ka.penumbraCos=Math.cos(B.angle*(1-B.penumbra)),ka.decay=B.decay,B.castShadow&&(w=B.shadow,O=b.get(B),O.shadowBias=w.bias,O.shadowNormalBias=w.normalBias,O.shadowRadius=w.radius,O.shadowMapSize=w.mapSize,c.spotShadow[t]=O,c.spotShadowMap[t]=fa,c.spotShadowMatrix[t]=B.shadow.matrix,ya++),c.spot[t]=ka,t++):B.isRectAreaLight?(fa=a.get(B),fa.color.copy(O).multiplyScalar(w),fa.position.setFromMatrixPosition(B.matrixWorld),fa.position.applyMatrix4(n),g.identity(),f.copy(B.matrixWorld),f.premultiply(n),g.extractRotation(f),fa.halfWidth.set(.5*B.width,0,0),fa.halfHeight.set(0,.5*B.height,0),fa.halfWidth.applyMatrix4(g),fa.halfHeight.applyMatrix4(g),c.rectArea[u]=fa,u++):B.isPointLight?(w=a.get(B),w.position.setFromMatrixPosition(B.matrixWorld),w.position.applyMatrix4(n),w.color.copy(B.color).multiplyScalar(B.intensity),w.distance=B.distance,w.decay=B.decay,B.castShadow&&(ka=B.shadow,O=b.get(B),O.shadowBias=ka.bias,O.shadowNormalBias=ka.normalBias,O.shadowRadius=ka.radius,O.shadowMapSize=ka.mapSize,O.shadowCameraNear=ka.camera.near,O.shadowCameraFar=ka.camera.far,c.pointShadow[r]=O,c.pointShadowMap[r]=fa,c.pointShadowMatrix[r]=B.shadow.matrix,x++),c.point[r]=w,r++):B.isHemisphereLight&&(fa=a.get(B),fa.direction.setFromMatrixPosition(B.matrixWorld),fa.direction.transformDirection(n),fa.direction.normalize(),fa.skyColor.copy(B.color).multiplyScalar(w),fa.groundColor.copy(B.groundColor).multiplyScalar(w),c.hemi[m]=fa,m++)}c.ambient[0]=l;c.ambient[1]=h;c.ambient[2]=p;d=c.hash;if(d.directionalLength!==k||d.pointLength!==r||d.spotLength!==t||d.rectAreaLength!==u||d.hemiLength!==m||d.numDirectionalShadows!==A||d.numPointShadows!==x||d.numSpotShadows!==ya)c.directional.length=k,c.spot.length=t,c.rectArea.length=u,c.point.length=r,c.hemi.length=m,c.directionalShadow.length=A,c.directionalShadowMap.length=A,c.pointShadow.length=x,c.pointShadowMap.length=x,c.spotShadow.length=ya,c.spotShadowMap.length=ya,c.directionalShadowMatrix.length=A,c.pointShadowMatrix.length=x,c.spotShadowMatrix.length=ya,d.directionalLength=k,d.pointLength=r,d.spotLength=t,d.rectAreaLength=u,d.hemiLength=m,d.numDirectionalShadows=A,d.numPointShadows=x,d.numSpotShadows=ya,c.version=xk++},state:c}}function Rh(){var a=new wk,b=[],c=[];return{init:function(){b.length=0;c.length=0},state:{lightsArray:b,shadowsArray:c,lights:a},setupLights:function(d){a.setup(b,c,d)},pushLight:function(a){b.push(a)},pushShadow:function(a){c.push(a)}}}function yk(){function a(c){c=c.target;c.removeEventListener("dispose",a);b.delete(c)}var b=new WeakMap;return{get:function(c,d){if(!1===b.has(c)){var e=new Rh;b.set(c,new WeakMap);b.get(c).set(d,e);c.addEventListener("dispose",a)}else!1===b.get(c).has(d)?(e=new Rh,b.get(c).set(d,e)):e=b.get(c).get(d);return e},dispose:function(){b=new WeakMap}}}function Eb(a){K.call(this);this.type="MeshDepthMaterial";this.depthPacking=3200;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.fog=!1;this.setValues(a)}
function Fb(a){K.call(this);this.type="MeshDistanceMaterial";this.referencePosition=new m;this.nearDistance=1;this.farDistance=1E3;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.fog=!1;this.setValues(a)}function Sh(a,b,c){function d(a,b,c){c=a<<0|b<<1|c<<2;var d=p[c];void 0===d&&(d=new Eb({depthPacking:3201,morphTargets:a,skinning:b}),p[c]=d);return d}function e(a,b,c){c=a<<0|b<<1|c<<2;var d=k[c];void 0===d&&(d=new Fb({morphTargets:a,skinning:b}),k[c]=d);return d}function f(b,c,f,g,h,l,n){var q=d,p=b.customDepthMaterial;!0===g.isPointLight&&(q=e,p=b.customDistanceMaterial);void 0===p?(p=!1,!0===f.morphTargets&&(p=c.morphAttributes&&c.morphAttributes.position&&0<c.morphAttributes.position.length),c=!1,!0===b.isSkinnedMesh&&(!0===f.skinning?c=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",b)),b=q(p,c,!0===b.isInstancedMesh)):b=p;a.localClippingEnabled&&!0===f.clipShadows&&0!==f.clippingPlanes.length&&(p=b.uuid,q=f.uuid,c=r[p],void 0===c&&(c={},r[p]=c),p=c[q],void 0===p&&(p=b.clone(),c[q]=p),b=p);b.visible=f.visible;b.wireframe=f.wireframe;b.side=3===n?null!==f.shadowSide?f.shadowSide:f.side:null!==f.shadowSide?f.shadowSide:t[f.side];b.clipShadows=f.clipShadows;b.clippingPlanes=f.clippingPlanes;b.clipIntersection=f.clipIntersection;b.wireframeLinewidth=f.wireframeLinewidth;b.linewidth=f.linewidth;!0===g.isPointLight&&!0===b.isMeshDistanceMaterial&&(b.referencePosition.setFromMatrixPosition(g.matrixWorld),b.nearDistance=h,b.farDistance=l);return b}function g(c,d,e,l,n){if(!1!==c.visible){if(c.layers.test(d.layers)&&(c.isMesh||c.isLine||c.isPoints)&&(c.castShadow||c.receiveShadow&&3===n)&&(!c.frustumCulled||h.intersectsObject(c))){c.modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,c.matrixWorld);var q=b.update(c),p=c.material;if(Array.isArray(p))for(var k=q.groups,v=0,r=k.length;v<r;v++){var t=k[v],m=p[t.materialIndex];m&&m.visible&&(m=f(c,q,m,l,e.near,e.far,n),a.renderBufferDirect(e,null,q,m,c,t))}else p.visible&&(p=f(c,q,p,l,e.near,e.far,n),a.renderBufferDirect(e,null,q,p,c,null))}c=c.children;q=0;for(p=c.length;q<p;q++)g(c[q],d,e,l,n)}}var h=new Ec,l=new w,n=new w,q=new ba,p=[],k=[],r={},t={0:1,1:0,2:2},m=new Ba({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:.125},uniforms:{shadow_pass:{value:null},resolution:{value:new w},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),z=m.clone();z.defines.HORIZONAL_PASS=1;var A=new D;A.setAttribute("position",new F(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var x=new Z(A,m),ya=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=1;this.render=function(d,e,f){if(!1!==ya.enabled&&(!1!==ya.autoUpdate||!1!==ya.needsUpdate)&&0!==d.length){var p=a.getRenderTarget(),k=a.getActiveCubeFace(),v=a.getActiveMipmapLevel(),r=a.state;r.setBlending(0);r.buffers.color.setClear(1,1,1,1);r.buffers.depth.setTest(!0);r.setScissorTest(!1);for(var t=0,u=d.length;t<u;t++){var A=d[t],B=A.shadow;if(!1!==B.autoUpdate||!1!==B.needsUpdate)if(void 0===B)console.warn("THREE.WebGLShadowMap:",A,"has no shadow.");else{l.copy(B.mapSize);var w=B.getFrameExtents();l.multiply(w);n.copy(B.mapSize);if(l.x>c||l.y>c)l.x>c&&(n.x=Math.floor(c/w.x),l.x=n.x*w.x,B.mapSize.x=n.x),l.y>c&&(n.y=Math.floor(c/w.y),l.y=n.y*w.y,B.mapSize.y=n.y);null!==B.map||B.isPointLightShadow||3!==this.type||(w={minFilter:1006,magFilter:1006,format:1023},B.map=new Ea(l.x,l.y,w),B.map.texture.name=A.name+".shadowMap",B.mapPass=new Ea(l.x,l.y,w),B.camera.updateProjectionMatrix());null===B.map&&(B.map=new Ea(l.x,l.y,{minFilter:1003,magFilter:1003,format:1023}),B.map.texture.name=A.name+".shadowMap",B.camera.updateProjectionMatrix());a.setRenderTarget(B.map);a.clear();w=B.getViewportCount();for(var N=0;N<w;N++){var W=B.getViewport(N);q.set(n.x*W.x,n.y*W.y,n.x*W.z,n.y*W.w);r.viewport(q);B.updateMatrices(A,N);h=B.getFrustum();g(e,f,B.camera,A,this.type)}B.isPointLightShadow||3!==this.type||(A=B,w=f,N=b.update(x),m.uniforms.shadow_pass.value=A.map.texture,m.uniforms.resolution.value=A.mapSize,m.uniforms.radius.value=A.radius,a.setRenderTarget(A.mapPass),a.clear(),a.renderBufferDirect(w,null,N,m,x,null),z.uniforms.shadow_pass.value=A.mapPass.texture,z.uniforms.resolution.value=A.mapSize,z.uniforms.radius.value=A.radius,a.setRenderTarget(A.map),a.clear(),a.renderBufferDirect(w,null,N,z,x,null));B.needsUpdate=!1}}ya.needsUpdate=!1;a.setRenderTarget(p,k,v)}}}function zk(a,b,c){function d(b,c,d){var e=new Uint8Array(4),f=a.createTexture();a.bindTexture(b,f);a.texParameteri(b,10241,9728);a.texParameteri(b,10240,9728);for(b=0;b<d;b++)a.texImage2D(c+b,0,6408,1,1,0,6408,5121,e);return f}function e(b){!0!==t[b]&&(a.enable(b),t[b]=!0)}function f(b){!1!==t[b]&&(a.disable(b),t[b]=!1)}function g(b,c,d,g,h,l,n,q){if(0===b)z&&(f(3042),z=!1);else if(z||(e(3042),z=!0),5!==b){if(b!==A||q!==y){if(100!==x||100!==N)a.blendEquation(32774),N=x=100;if(q)switch(b){case 1:a.blendFuncSeparate(1,771,1,771);break;case 2:a.blendFunc(1,1);break;case 3:a.blendFuncSeparate(0,0,769,771);break;case 4:a.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",b)}else switch(b){case 1:a.blendFuncSeparate(770,771,1,771);break;case 2:a.blendFunc(770,1);break;case 3:a.blendFunc(0,769);break;case 4:a.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",b)}O=B=W=w=null;A=b;y=q}}else{h=h||c;l=l||d;n=n||g;if(c!==x||h!==N)a.blendEquationSeparate(ac[c],ac[h]),x=c,N=h;if(d!==w||g!==W||l!==B||n!==O)a.blendFuncSeparate(ca[d],ca[g],ca[l],ca[n]),w=d,W=g,B=l,O=n;A=b;y=null}}function h(b){E!==b&&(b?a.frontFace(2304):a.frontFace(2305),E=b)}function l(b){0!==b?(e(2884),b!==fa&&(1===b?a.cullFace(1029):2===b?a.cullFace(1028):a.cullFace(1032))):f(2884);fa=b}function n(b,c,d){if(b){if(e(32823),C!==c||G!==d)a.polygonOffset(c,d),C=c,G=d}else f(32823)}function q(b){void 0===b&&(b=33984+D-1);I!==b&&(a.activeTexture(b),I=b)}c=c.isWebGL2;var p=new function(){var b=!1,c=new ba,d=null,e=new ba(0,0,0,0);return{setMask:function(c){d===c||b||(a.colorMask(c,c,c,c),d=c)},setLocked:function(a){b=a},setClear:function(b,d,f,g,h){!0===h&&(b*=g,d*=g,f*=g);c.set(b,d,f,g);!1===e.equals(c)&&(a.clearColor(b,d,f,g),e.copy(c))},reset:function(){b=!1;d=null;e.set(-1,0,0,0)}}},k=new function(){var b=!1,c=null,d=null,g=null;return{setTest:function(a){a?e(2929):f(2929)},setMask:function(d){c===d||b||(a.depthMask(d),c=d)},setFunc:function(b){if(d!==b){if(b)switch(b){case 0:a.depthFunc(512);break;case 1:a.depthFunc(519);break;case 2:a.depthFunc(513);break;case 3:a.depthFunc(515);break;case 4:a.depthFunc(514);break;case 5:a.depthFunc(518);break;case 6:a.depthFunc(516);break;case 7:a.depthFunc(517);break;default:a.depthFunc(515)}else a.depthFunc(515);d=b}},setLocked:function(a){b=a},setClear:function(b){g!==b&&(a.clearDepth(b),g=b)},reset:function(){b=!1;g=d=c=null}}},r=new function(){var b=!1,c=null,d=null,g=null,h=null,l=null,n=null,q=null,p=null;return{setTest:function(a){b||(a?e(2960):f(2960))},setMask:function(d){c===d||b||(a.stencilMask(d),c=d)},setFunc:function(b,c,e){if(d!==b||g!==c||h!==e)a.stencilFunc(b,c,e),d=b,g=c,h=e},setOp:function(b,c,d){if(l!==b||n!==c||q!==d)a.stencilOp(b,c,d),l=b,n=c,q=d},setLocked:function(a){b=a},setClear:function(b){p!==b&&(a.clearStencil(b),p=b)},reset:function(){b=!1;p=q=n=l=h=g=d=c=null}}},t={},m=null,z=null,A=null,x=null,w=null,W=null,N=null,B=null,O=null,y=!1,E=null,fa=null,ka=null,C=null,G=null,D=a.getParameter(35661),H=!1,Oa=0;Oa=a.getParameter(7938);-1!==Oa.indexOf("WebGL")?(Oa=parseFloat(/^WebGL ([0-9])/.exec(Oa)[1]),H=1<=Oa):-1!==Oa.indexOf("OpenGL ES")&&(Oa=parseFloat(/^OpenGL ES ([0-9])/.exec(Oa)[1]),H=2<=Oa);var I=null,F={},K=new ba,J=new ba,P={};P[3553]=d(3553,3553,1);P[34067]=d(34067,34069,6);p.setClear(0,0,0,1);k.setClear(1);r.setClear(0);e(2929);k.setFunc(3);h(!1);l(1);e(2884);g(0);var ac={100:32774,101:32778,102:32779};c?(ac[103]=32775,ac[104]=32776):(b=b.get("EXT_blend_minmax"),null!==b&&(ac[103]=b.MIN_EXT,ac[104]=b.MAX_EXT));var ca={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};return{buffers:{color:p,depth:k,stencil:r},enable:e,disable:f,useProgram:function(b){return m!==b?(a.useProgram(b),m=b,!0):!1},setBlending:g,setMaterial:function(a,b){2===a.side?f(2884):e(2884);var c=1===a.side;b&&(c=!c);h(c);1===a.blending&&!1===a.transparent?g(0):g(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha,a.premultipliedAlpha);k.setFunc(a.depthFunc);k.setTest(a.depthTest);k.setMask(a.depthWrite);p.setMask(a.colorWrite);b=a.stencilWrite;r.setTest(b);b&&(r.setMask(a.stencilWriteMask),r.setFunc(a.stencilFunc,a.stencilRef,a.stencilFuncMask),r.setOp(a.stencilFail,a.stencilZFail,a.stencilZPass));n(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)},setFlipSided:h,setCullFace:l,setLineWidth:function(b){b!==ka&&(H&&a.lineWidth(b),ka=b)},setPolygonOffset:n,setScissorTest:function(a){a?e(3089):f(3089)},activeTexture:q,bindTexture:function(b,c){null===I&&q();var d=F[I];void 0===d&&(d={type:void 0,texture:void 0},F[I]=d);if(d.type!==b||d.texture!==c)a.bindTexture(b,c||P[b]),d.type=b,d.texture=c},unbindTexture:function(){var b=F[I];void 0!==b&&void 0!==b.type&&(a.bindTexture(b.type,null),b.type=void 0,b.texture=void 0)},compressedTexImage2D:function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}},texImage2D:function(){try{a.texImage2D.apply(a,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}},texImage3D:function(){try{a.texImage3D.apply(a,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}},scissor:function(b){!1===K.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),K.copy(b))},viewport:function(b){!1===J.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),J.copy(b))},reset:function(){t={};I=null;F={};fa=E=A=m=null;p.reset();k.reset();r.reset()}}}function Ak(a,b,c,d,e,f,g){function h(a,b){return Oa?new OffscreenCanvas(a,b):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function l(a,b,c,d){var e=1;if(a.width>d||a.height>d)e=d/Math.max(a.width,a.height);if(1>e||!0===b){if("undefined"!==typeof HTMLImageElement&&a instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&a instanceof ImageBitmap)return d=b?P.floorPowerOfTwo:Math.floor,b=d(e*a.width),e=d(e*a.height),void 0===I&&(I=h(b,e)),c=c?h(b,e):I,c.width=b,c.height=e,c.getContext("2d").drawImage(a,0,0,b,e),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+
a.width+"x"+a.height+") to ("+b+"x"+e+")."),c;"data"in a&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+a.width+"x"+a.height+").")}return a}function n(a){return P.isPowerOfTwo(a.width)&&P.isPowerOfTwo(a.height)}function q(a,b){return a.generateMipmaps&&b&&1003!==a.minFilter&&1006!==a.minFilter}function p(b,c,e,f){a.generateMipmap(b);d.get(c).__maxMipLevel=Math.log(Math.max(e,f))*Math.LOG2E}function k(c,d,e){if(!1===E)return d;if(null!==c){if(void 0!==a[c])return a[c];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+
c+"'")}c=d;6403===d&&(5126===e&&(c=33326),5131===e&&(c=33325),5121===e&&(c=33321));6407===d&&(5126===e&&(c=34837),5131===e&&(c=34843),5121===e&&(c=32849));6408===d&&(5126===e&&(c=34836),5131===e&&(c=34842),5121===e&&(c=32856));33325!==c&&33326!==c&&34842!==c&&34836!==c||b.get("EXT_color_buffer_float");return c}function r(a){return 1003===a||1004===a||1005===a?9728:9729}function t(b){b=b.target;b.removeEventListener("dispose",t);var c=d.get(b);void 0!==c.__webglInit&&(a.deleteTexture(c.__webglTexture),d.remove(b));b.isVideoTexture&&D.delete(b);g.memory.textures--}function m(b){b=b.target;b.removeEventListener("dispose",m);var c=d.get(b),e=d.get(b.texture);if(b){void 0!==e.__webglTexture&&a.deleteTexture(e.__webglTexture);b.depthTexture&&b.depthTexture.dispose();if(b.isWebGLCubeRenderTarget)for(e=0;6>e;e++)a.deleteFramebuffer(c.__webglFramebuffer[e]),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer[e]);else a.deleteFramebuffer(c.__webglFramebuffer),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer),c.__webglMultisampledFramebuffer&&a.deleteFramebuffer(c.__webglMultisampledFramebuffer),c.__webglColorRenderbuffer&&a.deleteRenderbuffer(c.__webglColorRenderbuffer),c.__webglDepthRenderbuffer&&a.deleteRenderbuffer(c.__webglDepthRenderbuffer);d.remove(b.texture);d.remove(b)}g.memory.textures--}function z(a,b){var e=d.get(a);if(a.isVideoTexture){var f=g.render.frame;D.get(a)!==f&&(D.set(a,f),a.update())}if(0<a.version&&e.__version!==a.version)if(f=a.image,void 0===f)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(!1===f.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{N(e,a,b);return}c.activeTexture(33984+b);c.bindTexture(3553,e.__webglTexture)}function A(b,e){if(6===b.image.length){var g=d.get(b);if(0<b.version&&g.__version!==b.version){W(g,b);c.activeTexture(33984+e);c.bindTexture(34067,g.__webglTexture);a.pixelStorei(37440,b.flipY);var h=b&&(b.isCompressedTexture||b.image[0].isCompressedTexture),v=b.image[0]&&b.image[0].isDataTexture;e=[];for(var r=0;6>r;r++)e[r]=h||v?v?b.image[r].image:b.image[r]:l(b.image[r],!1,!0,C);r=e[0];var t=n(r)||E,m=f.convert(b.format),u=f.convert(b.type),z=k(b.internalFormat,m,u);w(34067,b,t);if(h){for(v=0;6>v;v++){var x=e[v].mipmaps;for(h=0;h<x.length;h++){var A=x[h];1023!==b.format&&1022!==b.format?null!==m?c.compressedTexImage2D(34069+v,h,z,A.width,A.height,0,A.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):c.texImage2D(34069+v,h,z,A.width,A.height,0,m,u,A.data)}}g.__maxMipLevel=x.length-1}else{x=b.mipmaps;for(h=0;6>h;h++)if(v)for(c.texImage2D(34069+h,0,z,e[h].width,e[h].height,0,m,u,e[h].data),A=0;A<x.length;A++){var B=x[A].image[h].image;c.texImage2D(34069+h,A+1,z,B.width,B.height,0,m,u,B.data)}else for(c.texImage2D(34069+h,0,z,m,u,e[h]),A=0;A<x.length;A++)c.texImage2D(34069+h,A+1,z,m,u,x[A].image[h]);g.__maxMipLevel=x.length}q(b,t)&&p(34067,b,r.width,r.height);g.__version=b.version;if(b.onUpdate)b.onUpdate(b)}else c.activeTexture(33984+e),c.bindTexture(34067,g.__webglTexture)}}function x(a,b){c.activeTexture(33984+b);c.bindTexture(34067,d.get(a).__webglTexture)}function w(c,f,g){g?(a.texParameteri(c,10242,K[f.wrapS]),a.texParameteri(c,10243,K[f.wrapT]),32879!==c&&35866!==c||a.texParameteri(c,32882,K[f.wrapR]),a.texParameteri(c,10240,J[f.magFilter]),a.texParameteri(c,10241,J[f.minFilter])):(a.texParameteri(c,10242,33071),a.texParameteri(c,10243,33071),32879!==c&&35866!==c||a.texParameteri(c,32882,33071),1001===f.wrapS&&1001===f.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),a.texParameteri(c,10240,r(f.magFilter)),a.texParameteri(c,10241,r(f.minFilter)),1003!==f.minFilter&&1006!==f.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));!(g=b.get("EXT_texture_filter_anisotropic"))||1015===f.type&&null===b.get("OES_texture_float_linear")||1016===f.type&&null===(E||b.get("OES_texture_half_float_linear"))||!(1<f.anisotropy||d.get(f).__currentAnisotropy)||(a.texParameterf(c,g.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(f.anisotropy,e.getMaxAnisotropy())),d.get(f).__currentAnisotropy=f.anisotropy)}function W(b,c){void 0===b.__webglInit&&(b.__webglInit=!0,c.addEventListener("dispose",t),b.__webglTexture=a.createTexture(),g.memory.textures++)}function N(b,d,e){var g=3553;d.isDataTexture2DArray&&(g=35866);d.isDataTexture3D&&(g=32879);W(b,d);c.activeTexture(33984+
e);c.bindTexture(g,b.__webglTexture);a.pixelStorei(37440,d.flipY);a.pixelStorei(37441,d.premultiplyAlpha);a.pixelStorei(3317,d.unpackAlignment);e=E?!1:1001!==d.wrapS||1001!==d.wrapT||1003!==d.minFilter&&1006!==d.minFilter;e=e&&!1===n(d.image);e=l(d.image,e,!1,G);var h=n(e)||E,v=f.convert(d.format),r=f.convert(d.type),t=k(d.internalFormat,v,r);w(g,d,h);var m=d.mipmaps;if(d.isDepthTexture)t=6402,E?t=1015===d.type?36012:1014===d.type?33190:1020===d.type?35056:33189:1015===d.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===d.format&&6402===t&&1012!==d.type&&1014!==d.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),d.type=1012,r=f.convert(d.type)),1027===d.format&&6402===t&&(t=34041,1020!==d.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),d.type=1020,r=f.convert(d.type))),c.texImage2D(3553,0,t,e.width,e.height,0,v,r,null);else if(d.isDataTexture)if(0<m.length&&h){for(var u=0,z=m.length;u<z;u++){var x=m[u];c.texImage2D(3553,u,t,x.width,x.height,0,v,r,x.data)}d.generateMipmaps=!1;b.__maxMipLevel=m.length-1}else c.texImage2D(3553,0,t,e.width,e.height,0,v,r,e.data),b.__maxMipLevel=0;else if(d.isCompressedTexture){u=0;for(z=m.length;u<z;u++)x=m[u],1023!==d.format&&1022!==d.format?null!==v?c.compressedTexImage2D(3553,u,t,x.width,x.height,0,x.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):c.texImage2D(3553,u,t,x.width,x.height,0,v,r,x.data);b.__maxMipLevel=m.length-1}else if(d.isDataTexture2DArray)c.texImage3D(35866,0,t,e.width,e.height,e.depth,0,v,r,e.data),b.__maxMipLevel=0;else if(d.isDataTexture3D)c.texImage3D(32879,0,t,e.width,e.height,e.depth,0,v,r,e.data),b.__maxMipLevel=0;else if(0<m.length&&h){u=0;for(z=m.length;u<z;u++)x=m[u],c.texImage2D(3553,u,t,v,r,x);d.generateMipmaps=!1;b.__maxMipLevel=m.length-1}else c.texImage2D(3553,0,t,v,r,e),b.__maxMipLevel=0;q(d,h)&&p(g,d,e.width,e.height);b.__version=d.version;if(d.onUpdate)d.onUpdate(d)}
function B(b,e,g,h){var l=f.convert(e.texture.format),n=f.convert(e.texture.type),q=k(e.texture.internalFormat,l,n);c.texImage2D(h,0,q,e.width,e.height,0,l,n,null);a.bindFramebuffer(36160,b);a.framebufferTexture2D(36160,g,h,d.get(e.texture).__webglTexture,0);a.bindFramebuffer(36160,null)}function O(b,c,d){a.bindRenderbuffer(36161,b);if(c.depthBuffer&&!c.stencilBuffer){var e=33189;d?((d=c.depthTexture)&&d.isDepthTexture&&(1015===d.type?e=36012:1014===d.type&&(e=33190)),d=y(c),a.renderbufferStorageMultisample(36161,d,e,c.width,c.height)):a.renderbufferStorage(36161,e,c.width,c.height);a.framebufferRenderbuffer(36160,36096,36161,b)}else c.depthBuffer&&c.stencilBuffer?(d?(d=y(c),a.renderbufferStorageMultisample(36161,d,35056,c.width,c.height)):a.renderbufferStorage(36161,34041,c.width,c.height),a.framebufferRenderbuffer(36160,33306,36161,b)):(b=f.convert(c.texture.format),e=f.convert(c.texture.type),b=k(c.texture.internalFormat,b,e),d?(d=y(c),a.renderbufferStorageMultisample(36161,d,b,c.width,c.height)):a.renderbufferStorage(36161,b,c.width,c.height));a.bindRenderbuffer(36161,null)}function y(a){return E&&a.isWebGLMultisampleRenderTarget?Math.min(H,a.samples):0}var E=e.isWebGL2,fa=e.maxTextures,C=e.maxCubemapSize,G=e.maxTextureSize,H=e.maxSamples,D=new WeakMap,I,Oa=!1;try{Oa="undefined"!==typeof OffscreenCanvas&&null!==(new OffscreenCanvas(1,1)).getContext("2d")}catch(ac){}var F=0,K={1E3:10497,1001:33071,1002:33648},J={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987},T=!1,M=!1;this.allocateTextureUnit=function(){var a=F;a>=fa&&console.warn("THREE.WebGLTextures: Trying to use "+a+" texture units while this GPU supports only "+fa);F+=1;return a};this.resetTextureUnits=function(){F=0};this.setTexture2D=z;this.setTexture2DArray=function(a,b){var e=d.get(a);0<a.version&&e.__version!==a.version?N(e,a,b):(c.activeTexture(33984+b),c.bindTexture(35866,e.__webglTexture))};this.setTexture3D=function(a,b){var e=d.get(a);0<a.version&&e.__version!==a.version?N(e,a,b):(c.activeTexture(33984+b),c.bindTexture(32879,e.__webglTexture))};this.setTextureCube=A;this.setTextureCubeDynamic=x;this.setupRenderTarget=function(b){var e=d.get(b),h=d.get(b.texture);b.addEventListener("dispose",m);h.__webglTexture=a.createTexture();g.memory.textures++;var l=!0===b.isWebGLCubeRenderTarget,r=!0===b.isWebGLMultisampleRenderTarget,v=n(b)||E;!E||1022!==b.texture.format||1015!==b.texture.type&&1016!==b.texture.type||(b.texture.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead."));if(l)for(e.__webglFramebuffer=[],r=0;6>r;r++)e.__webglFramebuffer[r]=a.createFramebuffer();else if(e.__webglFramebuffer=a.createFramebuffer(),r)if(E){e.__webglMultisampledFramebuffer=a.createFramebuffer();e.__webglColorRenderbuffer=a.createRenderbuffer();a.bindRenderbuffer(36161,e.__webglColorRenderbuffer);r=f.convert(b.texture.format);var t=f.convert(b.texture.type);r=k(b.texture.internalFormat,r,t);t=y(b);a.renderbufferStorageMultisample(36161,t,r,b.width,b.height);a.bindFramebuffer(36160,e.__webglMultisampledFramebuffer);a.framebufferRenderbuffer(36160,36064,36161,e.__webglColorRenderbuffer);a.bindRenderbuffer(36161,null);b.depthBuffer&&(e.__webglDepthRenderbuffer=a.createRenderbuffer(),O(e.__webglDepthRenderbuffer,b,!0));a.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(l){c.bindTexture(34067,h.__webglTexture);w(34067,b.texture,v);for(h=0;6>h;h++)B(e.__webglFramebuffer[h],b,36064,34069+h);q(b.texture,v)&&p(34067,b.texture,b.width,b.height);c.bindTexture(34067,null)}else c.bindTexture(3553,h.__webglTexture),w(3553,b.texture,v),B(e.__webglFramebuffer,b,36064,3553),q(b.texture,v)&&p(3553,b.texture,b.width,b.height),c.bindTexture(3553,null);if(b.depthBuffer){e=d.get(b);v=!0===b.isWebGLCubeRenderTarget;if(b.depthTexture){if(v)throw Error("target.depthTexture not supported in Cube render targets");if(b&&b.isWebGLCubeRenderTarget)throw Error("Depth Texture with cube render targets is not supported");a.bindFramebuffer(36160,e.__webglFramebuffer);if(!b.depthTexture||!b.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");d.get(b.depthTexture).__webglTexture&&b.depthTexture.image.width===b.width&&b.depthTexture.image.height===b.height||(b.depthTexture.image.width=b.width,b.depthTexture.image.height=b.height,b.depthTexture.needsUpdate=!0);z(b.depthTexture,0);e=d.get(b.depthTexture).__webglTexture;if(1026===b.depthTexture.format)a.framebufferTexture2D(36160,36096,3553,e,0);else if(1027===b.depthTexture.format)a.framebufferTexture2D(36160,33306,3553,e,0);else throw Error("Unknown depthTexture format");}else if(v)for(e.__webglDepthbuffer=[],v=0;6>v;v++)a.bindFramebuffer(36160,e.__webglFramebuffer[v]),e.__webglDepthbuffer[v]=a.createRenderbuffer(),O(e.__webglDepthbuffer[v],b,!1);else a.bindFramebuffer(36160,e.__webglFramebuffer),e.__webglDepthbuffer=a.createRenderbuffer(),O(e.__webglDepthbuffer,b,!1);a.bindFramebuffer(36160,null)}};this.updateRenderTargetMipmap=function(a){var b=a.texture,e=n(a)||E;if(q(b,e)){e=a.isWebGLCubeRenderTarget?34067:3553;var f=d.get(b).__webglTexture;c.bindTexture(e,f);p(e,b,a.width,a.height);c.bindTexture(e,null)}};this.updateMultisampleRenderTarget=function(b){if(b.isWebGLMultisampleRenderTarget)if(E){var c=d.get(b);a.bindFramebuffer(36008,c.__webglMultisampledFramebuffer);a.bindFramebuffer(36009,c.__webglFramebuffer);var e=b.width,f=b.height,g=16384;b.depthBuffer&&(g|=256);b.stencilBuffer&&(g|=1024);a.blitFramebuffer(0,0,e,f,0,0,e,f,g,9728);a.bindFramebuffer(36160,c.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")};this.safeSetTexture2D=function(a,b){a&&a.isWebGLRenderTarget&&(!1===T&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),T=!0),a=a.texture);z(a,b)};this.safeSetTextureCube=function(a,b){a&&a.isWebGLCubeRenderTarget&&(!1===M&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),M=!0),a=a.texture);a&&a.isCubeTexture||Array.isArray(a.image)&&6===a.image.length?A(a,b):x(a,b)}}function Th(a,b,c){var d=c.isWebGL2;return{convert:function(a){if(1009===a)return 5121;if(1017===a)return 32819;if(1018===a)return 32820;if(1019===a)return 33635;if(1010===a)return 5120;if(1011===a)return 5122;if(1012===a)return 5123;if(1013===a)return 5124;if(1014===a)return 5125;if(1015===a)return 5126;if(1016===a){if(d)return 5131;var c=b.get("OES_texture_half_float");return null!==c?c.HALF_FLOAT_OES:null}if(1021===a)return 6406;if(1022===a)return 6407;if(1023===a)return 6408;if(1024===a)return 6409;if(1025===a)return 6410;if(1026===a)return 6402;if(1027===a)return 34041;if(1028===a)return 6403;if(1029===a)return 36244;if(1030===a)return 33319;if(1031===a)return 33320;if(1032===a)return 36248;if(1033===a)return 36249;if(33776===a||33777===a||33778===a||33779===a)if(c=b.get("WEBGL_compressed_texture_s3tc"),null!==c){if(33776===a)return c.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===a)return c.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===a)return c.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===a)return c.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(35840===a||35841===a||35842===a||35843===a)if(c=b.get("WEBGL_compressed_texture_pvrtc"),null!==c){if(35840===a)return c.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===a)return c.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===a)return c.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===a)return c.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(36196===a)return c=b.get("WEBGL_compressed_texture_etc1"),null!==c?c.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===a||37496===a)if(c=b.get("WEBGL_compressed_texture_etc"),null!==c){if(37492===a)return c.COMPRESSED_RGB8_ETC2;if(37496===a)return c.COMPRESSED_RGBA8_ETC2_EAC}if(37808===a||37809===a||37810===a||37811===a||37812===a||37813===a||37814===a||37815===a||37816===a||37817===a||37818===a||37819===a||37820===a||37821===a||37840===a||37841===a||37842===a||37843===a||37844===a||37845===a||37846===a||37847===a||37848===a||37849===a||37850===a||37851===a||37852===a||37853===a)return c=b.get("WEBGL_compressed_texture_astc"),null!==c?a:null;if(36492===a)return c=b.get("EXT_texture_compression_bptc"),null!==c?a:null;if(1020===a){if(d)return 34042;c=b.get("WEBGL_depth_texture");return null!==c?c.UNSIGNED_INT_24_8_WEBGL:null}}}}function Je(a){ma.call(this);this.cameras=a||[]}function Ic(){y.call(this);this.type="Group"}function Ke(){this._grip=this._targetRay=null}function Uh(a,b){function c(a){var b=t.get(a.inputSource);b&&b.dispatchEvent({type:a.type})}function d(){t.forEach(function(a,b){a.disconnect(b)});t.clear();a.setFramebuffer(null);a.setRenderTarget(a.getRenderTarget());y.stop();h.isPresenting=!1;h.dispatchEvent({type:"sessionend"})}function e(a){q=a;y.setContext(l);y.start();h.isPresenting=!0;h.dispatchEvent({type:"sessionstart"})}function f(a){for(var b=l.inputSources,c=0;c<r.length;c++)t.set(b[c],r[c]);for(b=0;b<a.removed.length;b++){c=a.removed[b];var d=t.get(c);d&&(d.dispatchEvent({type:"disconnected",data:c}),t.delete(c))}for(b=0;b<a.added.length;b++)c=a.added[b],(d=t.get(c))&&d.dispatchEvent({type:"connected",data:c})}function g(a,b){null===b?a.matrixWorld.copy(a.matrix):a.matrixWorld.multiplyMatrices(b.matrixWorld,a.matrix);a.matrixWorldInverse.getInverse(a.matrixWorld)}var h=this,l=null,n=1,q=null,p="local-floor",k=null,r=[],t=new Map,u=new ma;u.layers.enable(1);u.viewport=new ba;var z=new ma;z.layers.enable(2);z.viewport=new ba;var A=[u,z],x=new Je;x.layers.enable(1);x.layers.enable(2);var w=null,W=null;this.isPresenting=this.enabled=!1;this.getController=function(a){var b=r[a];void 0===b&&(b=new Ke,r[a]=b);return b.getTargetRaySpace()};this.getControllerGrip=function(a){var b=r[a];void 0===b&&(b=new Ke,r[a]=b);return b.getGripSpace()};this.setFramebufferScaleFactor=function(a){n=a;!0===h.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")};this.setReferenceSpaceType=function(a){p=a;!0===h.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")};this.getReferenceSpace=function(){return q};this.getSession=function(){return l};this.setSession=function(a){l=a;null!==l&&(l.addEventListener("select",c),l.addEventListener("selectstart",c),l.addEventListener("selectend",c),l.addEventListener("squeeze",c),l.addEventListener("squeezestart",c),l.addEventListener("squeezeend",c),l.addEventListener("end",d),a=b.getContextAttributes(),!0!==a.xrCompatible&&b.makeXRCompatible(),a=new XRWebGLLayer(l,b,{antialias:a.antialias,alpha:a.alpha,depth:a.depth,stencil:a.stencil,framebufferScaleFactor:n}),l.updateRenderState({baseLayer:a}),l.requestReferenceSpace(p).then(e),l.addEventListener("inputsourceschange",f))};var N=new m,B=new m;this.getCamera=function(a){x.near=z.near=u.near=a.near;x.far=z.far=u.far=a.far;if(w!==x.near||W!==x.far)l.updateRenderState({depthNear:x.near,depthFar:x.far}),w=x.near,W=x.far;var b=a.parent,c=x.cameras;g(x,b);for(var d=0;d<c.length;d++)g(c[d],b);a.matrixWorld.copy(x.matrixWorld);a=a.children;b=0;for(d=a.length;b<d;b++)a[b].updateMatrixWorld(!0);if(2===c.length){N.setFromMatrixPosition(u.matrixWorld);B.setFromMatrixPosition(z.matrixWorld);c=N.distanceTo(B);var e=u.projectionMatrix.elements,f=z.projectionMatrix.elements,h=e[14]/(e[10]-1);a=e[14]/(e[10]+1);b=(e[9]+1)/e[5];d=(e[9]-1)/e[5];var n=(e[8]-1)/e[0],q=(f[8]+1)/f[0];f=h*n;e=h*q;q=c/(-n+q);n=q*-n;u.matrixWorld.decompose(x.position,x.quaternion,x.scale);x.translateX(n);x.translateZ(q);x.matrixWorld.compose(x.position,x.quaternion,x.scale);x.matrixWorldInverse.getInverse(x.matrixWorld);h+=q;q=a+q;x.projectionMatrix.makePerspective(f-n,e+(c-
n),b*a/q*h,d*a/q*h,h,q)}else x.projectionMatrix.copy(u.projectionMatrix);return x};var O=null,y=new vh;y.setAnimationLoop(function(b,c){k=c.getViewerPose(q);if(null!==k){var d=k.views,e=l.renderState.baseLayer;a.setFramebuffer(e.framebuffer);var f=!1;d.length!==x.cameras.length&&(x.cameras.length=0,f=!0);for(var g=0;g<d.length;g++){var h=d[g],n=e.getViewport(h),p=A[g];p.matrix.fromArray(h.transform.matrix);p.projectionMatrix.fromArray(h.projectionMatrix);p.viewport.set(n.x,n.y,n.width,n.height);0===g&&x.matrix.copy(p.matrix);!0===f&&x.cameras.push(p)}}d=l.inputSources;for(e=0;e<r.length;e++)r[e].update(d[e],c,q);O&&O(b,c)});this.setAnimationLoop=function(a){O=a};this.dispose=function(){}}function Bk(a){function b(b,c,f){b.opacity.value=c.opacity;c.color&&b.diffuse.value.copy(c.color);c.emissive&&b.emissive.value.copy(c.emissive).multiplyScalar(c.emissiveIntensity);c.map&&(b.map.value=c.map);c.alphaMap&&(b.alphaMap.value=c.alphaMap);c.specularMap&&(b.specularMap.value=c.specularMap);if(f=c.envMap||f)b.envMap.value=f,b.flipEnvMap.value=f.isCubeTexture?-1:1,b.reflectivity.value=c.reflectivity,b.refractionRatio.value=c.refractionRatio,f=a.get(f).__maxMipLevel,void 0!==f&&(b.maxMipLevel.value=f);c.lightMap&&(b.lightMap.value=c.lightMap,b.lightMapIntensity.value=c.lightMapIntensity);c.aoMap&&(b.aoMap.value=c.aoMap,b.aoMapIntensity.value=c.aoMapIntensity);if(c.map)var d=c.map;else c.specularMap?d=c.specularMap:c.displacementMap?d=c.displacementMap:c.normalMap?d=c.normalMap:c.bumpMap?d=c.bumpMap:c.roughnessMap?d=c.roughnessMap:c.metalnessMap?d=c.metalnessMap:c.alphaMap?d=c.alphaMap:c.emissiveMap&&(d=c.emissiveMap);void 0!==d&&(d.isWebGLRenderTarget&&(d=d.texture),!0===d.matrixAutoUpdate&&d.updateMatrix(),b.uvTransform.value.copy(d.matrix));if(c.aoMap)var e=c.aoMap;else c.lightMap&&(e=c.lightMap);void 0!==e&&(e.isWebGLRenderTarget&&(e=e.texture),!0===e.matrixAutoUpdate&&e.updateMatrix(),b.uv2Transform.value.copy(e.matrix))}function c(a,b,c){a.roughness.value=b.roughness;a.metalness.value=b.metalness;b.roughnessMap&&(a.roughnessMap.value=b.roughnessMap);b.metalnessMap&&(a.metalnessMap.value=b.metalnessMap);b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap);b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale,1===b.side&&(a.bumpScale.value*=-1));b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale),1===b.side&&a.normalScale.value.negate());b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias);if(b.envMap||c)a.envMapIntensity.value=b.envMapIntensity}return{refreshFogUniforms:function(a,b){a.fogColor.value.copy(b.color);b.isFog?(a.fogNear.value=b.near,a.fogFar.value=b.far):b.isFogExp2&&(a.fogDensity.value=b.density)},refreshMaterialUniforms:function(a,e,f,g,h){if(e.isMeshBasicMaterial)b(a,e);else if(e.isMeshLambertMaterial)b(a,e),e.emissiveMap&&(a.emissiveMap.value=e.emissiveMap);else if(e.isMeshToonMaterial)b(a,e),e.gradientMap&&(a.gradientMap.value=e.gradientMap),e.emissiveMap&&(a.emissiveMap.value=e.emissiveMap),e.bumpMap&&(a.bumpMap.value=e.bumpMap,a.bumpScale.value=e.bumpScale,1===e.side&&(a.bumpScale.value*=-1)),e.normalMap&&(a.normalMap.value=e.normalMap,a.normalScale.value.copy(e.normalScale),1===e.side&&a.normalScale.value.negate()),e.displacementMap&&(a.displacementMap.value=e.displacementMap,a.displacementScale.value=e.displacementScale,a.displacementBias.value=e.displacementBias);else if(e.isMeshPhongMaterial)b(a,e),a.specular.value.copy(e.specular),a.shininess.value=Math.max(e.shininess,1E-4),e.emissiveMap&&(a.emissiveMap.value=e.emissiveMap),e.bumpMap&&(a.bumpMap.value=e.bumpMap,a.bumpScale.value=e.bumpScale,1===e.side&&(a.bumpScale.value*=-1)),e.normalMap&&(a.normalMap.value=e.normalMap,a.normalScale.value.copy(e.normalScale),1===e.side&&a.normalScale.value.negate()),e.displacementMap&&(a.displacementMap.value=e.displacementMap,a.displacementScale.value=e.displacementScale,a.displacementBias.value=e.displacementBias);else if(e.isMeshStandardMaterial)b(a,e,f),e.isMeshPhysicalMaterial?(c(a,e,f),a.reflectivity.value=e.reflectivity,a.clearcoat.value=e.clearcoat,a.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&a.sheen.value.copy(e.sheen),e.clearcoatMap&&(a.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(a.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(a.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),a.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&a.clearcoatNormalScale.value.negate()),a.transmission.value=e.transmission,e.transmissionMap&&(a.transmissionMap.value=e.transmissionMap)):c(a,e,f);else if(e.isMeshMatcapMaterial)b(a,e),e.matcap&&(a.matcap.value=e.matcap),e.bumpMap&&(a.bumpMap.value=e.bumpMap,a.bumpScale.value=e.bumpScale,1===e.side&&(a.bumpScale.value*=-1)),e.normalMap&&(a.normalMap.value=e.normalMap,a.normalScale.value.copy(e.normalScale),1===e.side&&a.normalScale.value.negate()),e.displacementMap&&(a.displacementMap.value=e.displacementMap,a.displacementScale.value=e.displacementScale,a.displacementBias.value=e.displacementBias);else if(e.isMeshDepthMaterial)b(a,e),e.displacementMap&&(a.displacementMap.value=e.displacementMap,a.displacementScale.value=e.displacementScale,a.displacementBias.value=e.displacementBias);else if(e.isMeshDistanceMaterial)b(a,e),e.displacementMap&&(a.displacementMap.value=e.displacementMap,a.displacementScale.value=e.displacementScale,a.displacementBias.value=e.displacementBias),a.referencePosition.value.copy(e.referencePosition),a.nearDistance.value=e.nearDistance,a.farDistance.value=e.farDistance;else if(e.isMeshNormalMaterial)b(a,e),e.bumpMap&&(a.bumpMap.value=e.bumpMap,a.bumpScale.value=e.bumpScale,1===e.side&&(a.bumpScale.value*=-1)),e.normalMap&&(a.normalMap.value=e.normalMap,a.normalScale.value.copy(e.normalScale),1===e.side&&a.normalScale.value.negate()),e.displacementMap&&(a.displacementMap.value=e.displacementMap,a.displacementScale.value=e.displacementScale,a.displacementBias.value=e.displacementBias);else if(e.isLineBasicMaterial)a.diffuse.value.copy(e.color),a.opacity.value=e.opacity,e.isLineDashedMaterial&&(a.dashSize.value=e.dashSize,a.totalSize.value=e.dashSize+e.gapSize,a.scale.value=e.scale);else if(e.isPointsMaterial){a.diffuse.value.copy(e.color);a.opacity.value=e.opacity;a.size.value=e.size*g;a.scale.value=.5*h;e.map&&(a.map.value=e.map);e.alphaMap&&(a.alphaMap.value=e.alphaMap);if(e.map)var d=e.map;else e.alphaMap&&(d=e.alphaMap);void 0!==d&&(!0===d.matrixAutoUpdate&&d.updateMatrix(),a.uvTransform.value.copy(d.matrix))}else if(e.isSpriteMaterial){a.diffuse.value.copy(e.color);a.opacity.value=e.opacity;a.rotation.value=e.rotation;e.map&&(a.map.value=e.map);e.alphaMap&&(a.alphaMap.value=e.alphaMap);if(e.map)var n=e.map;else e.alphaMap&&(n=e.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),a.uvTransform.value.copy(n.matrix))}else e.isShadowMaterial?(a.color.value.copy(e.color),a.opacity.value=e.opacity):e.isShaderMaterial&&(e.uniformsNeedUpdate=!1)}}}function Jd(a){function b(a,b){for(var c=0;c<a.length;c++){var d=r.getContext(a[c],b);if(null!==d)return d}return null}
function c(){na=new pj(L);Ga=new nj(L,na,a);!1===Ga.isWebGL2&&(na.get("WEBGL_depth_texture"),na.get("OES_texture_float"),na.get("OES_texture_half_float"),na.get("OES_texture_half_float_linear"),na.get("OES_standard_derivatives"),na.get("OES_element_index_uint"),na.get("OES_vertex_array_object"),na.get("ANGLE_instanced_arrays"));na.get("OES_texture_float_linear");ra=new Th(L,na,Ga);oa=new zk(L,na,Ga);oa.scissor(V.copy(da).multiplyScalar(Q).floor());oa.viewport(U.copy(X).multiplyScalar(Q).floor());Y=new sj(L);Ha=new pk;S=new Ak(L,na,oa,Ha,Ga,ra,Y);sa=new jj(L,Ga);ha=new lj(L,na,sa,Ga);wa=new qj(L,sa,Y,ha);ta=new wj(L,wa,sa,Y);Ba=new vj(L);qa=new ok(E,na,Ga,ha);za=new Bk(Ha);xa=new sk(Ha);ua=new yk;pa=new kj(E,oa,ta,ya);Ca=new mj(L,na,Y,Ga);Da=new rj(L,na,Y,Ga);Y.programs=qa.programs;E.capabilities=Ga;E.extensions=na;E.properties=Ha;E.renderLists=xa;E.state=oa;E.info=Y}function d(a){a.preventDefault();console.log("THREE.WebGLRenderer: Context Lost.");C=!0}function e(){console.log("THREE.WebGLRenderer: Context Restored.");C=!1;c()}function f(a){a=a.target;a.removeEventListener("dispose",f);g(a);Ha.remove(a)}function g(a){a=Ha.get(a).program;void 0!==a&&qa.releaseProgram(a)}function h(a,b){a.render(function(a){E.renderBufferImmediate(a,b)})}function l(a,b,c,d){if(!1!==a.visible){if(a.layers.test(b.layers))if(a.isGroup)c=a.renderOrder;else if(a.isLOD)!0===a.autoUpdate&&a.update(b);else if(a.isLight)y.pushLight(a),a.castShadow&&y.pushShadow(a);else if(a.isSprite){if(!a.frustumCulled||la.intersectsSprite(a)){d&&Gb.setFromMatrixPosition(a.matrixWorld).applyMatrix4(Id);var e=ta.update(a),f=a.material;f.visible&&O.push(a,e,f,c,Gb.z,null)}}else if(a.isImmediateRenderObject)d&&Gb.setFromMatrixPosition(a.matrixWorld).applyMatrix4(Id),O.push(a,null,a.material,c,Gb.z,null);else if(a.isMesh||a.isLine||a.isPoints)if(a.isSkinnedMesh&&a.skeleton.frame!==Y.render.frame&&(a.skeleton.update(),a.skeleton.frame=Y.render.frame),!a.frustumCulled||la.intersectsObject(a))if(d&&Gb.setFromMatrixPosition(a.matrixWorld).applyMatrix4(Id),e=ta.update(a),f=a.material,Array.isArray(f))for(var g=e.groups,h=0,n=g.length;h<n;h++){var q=g[h],p=f[q.materialIndex];p&&p.visible&&O.push(a,e,p,c,Gb.z,q)}else f.visible&&O.push(a,e,f,c,Gb.z,null);a=a.children;e=0;for(f=a.length;e<f;e++)l(a[e],b,c,d)}}function n(a,b,c){for(var d=!0===b.isScene?b.overrideMaterial:null,e=0,f=a.length;e<f;e++){var g=a[e],h=g.object,l=g.geometry,n=null===d?g.material:d;g=g.group;if(c.isArrayCamera){Ie=c;for(var p=c.cameras,k=0,r=p.length;k<r;k++){var v=p[k];h.layers.test(v.layers)&&(oa.viewport(U.copy(v.viewport)),y.setupLights(v),q(h,b,v,l,n,g))}}else Ie=null,q(h,b,c,l,n,g)}}function q(a,b,c,d,e,f){a.onBeforeRender(E,b,c,d,e,f);y=ua.get(b,Ie||c);a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,a.matrixWorld);a.normalMatrix.getNormalMatrix(a.modelViewMatrix);if(a.isImmediateRenderObject){var g=k(c,b,e,a);oa.setMaterial(e);ha.reset();h(a,g)}else E.renderBufferDirect(c,b,d,e,a,f);a.onAfterRender(E,b,c,d,e,f);y=ua.get(b,Ie||c)}function p(a,b,c){!0!==b.isScene&&(b=lg);var d=Ha.get(a),e=y.state.lights,h=e.state.version;c=qa.getParameters(a,e.state,y.state.shadowsArray,b,R.numPlanes,R.numIntersection,c);var l=qa.getProgramCacheKey(c),n=d.program,q=!0;if(void 0===n)a.addEventListener("dispose",f);else if(n.cacheKey!==l)g(a);else{if(d.lightsStateVersion!==h)d.lightsStateVersion=h;else if(void 0!==c.shaderID)return;q=!1}q&&(c.uniforms=qa.getUniforms(a,c),a.onBeforeCompile(c,E),n=qa.acquireProgram(c,l),d.program=n,d.uniforms=c.uniforms,d.outputEncoding=c.outputEncoding);c=n.getAttributes();if(a.morphTargets)for(l=a.numSupportedMorphTargets=0;l<E.maxMorphTargets;l++)0<=c["morphTarget"+l]&&a.numSupportedMorphTargets++;if(a.morphNormals)for(l=a.numSupportedMorphNormals=0;l<E.maxMorphNormals;l++)0<=c["morphNormal"+l]&&a.numSupportedMorphNormals++;c=d.uniforms;if(!a.isShaderMaterial&&!a.isRawShaderMaterial||!0===a.clipping)d.numClippingPlanes=R.numPlanes,d.numIntersection=R.numIntersection,c.clippingPlanes=R.uniform;d.environment=a.isMeshStandardMaterial?b.environment:null;d.fog=b.fog;d.needsLights=a.isMeshLambertMaterial||a.isMeshToonMaterial||a.isMeshPhongMaterial||a.isMeshStandardMaterial||a.isShadowMaterial||a.isShaderMaterial&&!0===a.lights;d.lightsStateVersion=h;d.needsLights&&(c.ambientLightColor.value=e.state.ambient,c.lightProbe.value=e.state.probe,c.directionalLights.value=e.state.directional,c.directionalLightShadows.value=e.state.directionalShadow,c.spotLights.value=e.state.spot,c.spotLightShadows.value=e.state.spotShadow,c.rectAreaLights.value=e.state.rectArea,c.pointLights.value=e.state.point,c.pointLightShadows.value=e.state.pointShadow,c.hemisphereLights.value=e.state.hemi,c.directionalShadowMap.value=e.state.directionalShadowMap,c.directionalShadowMatrix.value=e.state.directionalShadowMatrix,c.spotShadowMap.value=e.state.spotShadowMap,c.spotShadowMatrix.value=e.state.spotShadowMatrix,c.pointShadowMap.value=e.state.pointShadowMap,c.pointShadowMatrix.value=e.state.pointShadowMatrix);a=d.program.getUniforms();a=Db.seqWithValue(a.seq,c);d.uniformsList=a}function k(a,b,c,d){!0!==b.isScene&&(b=lg);S.resetTextureUnits();var e=b.fog,f=c.isMeshStandardMaterial?b.environment:null,g=null===F?E.outputEncoding:F.texture.encoding,h=Ha.get(c),l=y.state.lights;!0!==ma||!0!==kg&&a===M||R.setState(c.clippingPlanes,c.clipIntersection,c.clipShadows,a,h,a===M&&c.id===J);c.version===h.__version?void 0===h.program?p(c,b,d):c.fog&&h.fog!==e?p(c,b,d):h.environment!==f?p(c,b,d):h.needsLights&&h.lightsStateVersion!==l.state.version?p(c,b,d):void 0===h.numClippingPlanes||h.numClippingPlanes===R.numPlanes&&h.numIntersection===R.numIntersection?h.outputEncoding!==g&&p(c,b,d):p(c,b,d):(p(c,b,d),h.__version=c.version);var n=!1,q=!1,k=!1;b=h.program;g=b.getUniforms();l=h.uniforms;oa.useProgram(b.program)&&(k=q=n=!0);c.id!==J&&(J=c.id,q=!0);if(n||M!==a){g.setValue(L,"projectionMatrix",a.projectionMatrix);Ga.logarithmicDepthBuffer&&g.setValue(L,"logDepthBufFC",2/(Math.log(a.far+1)/Math.LN2));M!==a&&(M=a,k=q=!0);if(c.isShaderMaterial||c.isMeshPhongMaterial||c.isMeshToonMaterial||c.isMeshStandardMaterial||c.envMap)n=g.map.cameraPosition,void 0!==n&&n.setValue(L,Gb.setFromMatrixPosition(a.matrixWorld));(c.isMeshPhongMaterial||c.isMeshToonMaterial||c.isMeshLambertMaterial||c.isMeshBasicMaterial||c.isMeshStandardMaterial||c.isShaderMaterial)&&g.setValue(L,"isOrthographic",!0===a.isOrthographicCamera);(c.isMeshPhongMaterial||c.isMeshToonMaterial||c.isMeshLambertMaterial||c.isMeshBasicMaterial||c.isMeshStandardMaterial||c.isShaderMaterial||c.isShadowMaterial||c.skinning)&&g.setValue(L,"viewMatrix",a.matrixWorldInverse)}if(c.skinning&&(g.setOptional(L,d,"bindMatrix"),g.setOptional(L,d,"bindMatrixInverse"),a=d.skeleton))if(n=a.bones,Ga.floatVertexTextures){if(void 0===a.boneTexture){n=Math.sqrt(4*n.length);n=P.ceilPowerOfTwo(n);n=Math.max(n,4);var r=new Float32Array(n*n*4);r.set(a.boneMatrices);var v=new Zb(r,n,n,1023,1015);a.boneMatrices=r;a.boneTexture=v;a.boneTextureSize=n}g.setValue(L,"boneTexture",a.boneTexture,S);g.setValue(L,"boneTextureSize",a.boneTextureSize)}else g.setOptional(L,a,"boneMatrices");if(q||h.receiveShadow!==d.receiveShadow)h.receiveShadow=d.receiveShadow,g.setValue(L,"receiveShadow",d.receiveShadow);q&&(g.setValue(L,"toneMappingExposure",E.toneMappingExposure),h.needsLights&&(q=k,l.ambientLightColor.needsUpdate=q,l.lightProbe.needsUpdate=q,l.directionalLights.needsUpdate=q,l.directionalLightShadows.needsUpdate=q,l.pointLights.needsUpdate=q,l.pointLightShadows.needsUpdate=q,l.spotLights.needsUpdate=q,l.spotLightShadows.needsUpdate=q,l.rectAreaLights.needsUpdate=q,l.hemisphereLights.needsUpdate=q),e&&c.fog&&za.refreshFogUniforms(l,e),za.refreshMaterialUniforms(l,c,f,Q,ca),void 0!==l.ltc_1&&(l.ltc_1.value=G.LTC_1),void 0!==l.ltc_2&&(l.ltc_2.value=G.LTC_2),Db.upload(L,h.uniformsList,l,S));c.isShaderMaterial&&!0===c.uniformsNeedUpdate&&(Db.upload(L,h.uniformsList,l,S),c.uniformsNeedUpdate=!1);c.isSpriteMaterial&&g.setValue(L,"center",d.center);g.setValue(L,"modelViewMatrix",d.modelViewMatrix);g.setValue(L,"normalMatrix",d.normalMatrix);g.setValue(L,"modelMatrix",d.matrixWorld);return b}a=a||{};var r=void 0!==a.canvas?a.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),t=void 0!==a.context?a.context:null,u=void 0!==a.alpha?a.alpha:!1,z=void 0!==a.depth?a.depth:!0,A=void 0!==a.stencil?a.stencil:!0,x=void 0!==a.antialias?a.antialias:!1,ya=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,W=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,N=void 0!==a.powerPreference?a.powerPreference:"default",B=void 0!==a.failIfMajorPerformanceCaveat?a.failIfMajorPerformanceCaveat:!1,O=null,y=null;this.domElement=r;this.debug={checkShaderErrors:!0};this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.outputEncoding=3E3;this.physicallyCorrectLights=!1;this.toneMapping=0;this.toneMappingExposure=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var E=this,C=!1,D=null,H=0,I=0,F=null,K=null,J=-1,M=null,Ie=null,U=new ba,V=new ba,Z=null,aa=r.width,ca=r.height,Q=1,ea=null,ia=null,X=new ba(0,0,aa,ca),da=new ba(0,0,aa,ca),ja=!1,la=new Ec,R=new oj,ma=!1,kg=!1,Id=new T,Gb=new m,lg={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0},L=t;try{t={alpha:u,depth:z,stencil:A,antialias:x,premultipliedAlpha:ya,preserveDrawingBuffer:W,powerPreference:N,failIfMajorPerformanceCaveat:B};r.addEventListener("webglcontextlost",d,!1);r.addEventListener("webglcontextrestored",e,!1);if(null===L&&(u=["webgl2","webgl","experimental-webgl"],!0===E.isWebGL1Renderer&&u.shift(),L=b(u,t),null===L)){if(b(u))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.");}void 0===L.getShaderPrecisionFormat&&(L.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Vh){throw console.error("THREE.WebGLRenderer: "+Vh.message),Vh;}var na,Ga,oa,Y,Ha,S,sa,wa,ta,qa,za,xa,ua,pa,Ba,Ca,Da,ra,ha;c();var va=new Uh(E,L);this.xr=va;var Fa=new Sh(E,ta,Ga.maxTextureSize);this.shadowMap=Fa;this.getContext=function(){return L};this.getContextAttributes=function(){return L.getContextAttributes()};this.forceContextLoss=function(){var a=na.get("WEBGL_lose_context");a&&a.loseContext()};this.forceContextRestore=function(){var a=na.get("WEBGL_lose_context");a&&a.restoreContext()};this.getPixelRatio=function(){return Q};this.setPixelRatio=function(a){void 0!==a&&(Q=a,this.setSize(aa,ca,!1))};this.getSize=function(a){void 0===a&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),a=new w);return a.set(aa,ca)};this.setSize=function(a,b,c){va.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(aa=a,ca=b,r.width=Math.floor(a*Q),r.height=Math.floor(b*Q),!1!==c&&(r.style.width=a+"px",r.style.height=b+"px"),this.setViewport(0,0,a,b))};this.getDrawingBufferSize=function(a){void 0===a&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),a=new w);return a.set(aa*Q,ca*Q).floor()};this.setDrawingBufferSize=function(a,b,c){aa=a;ca=b;Q=c;r.width=Math.floor(a*c);r.height=Math.floor(b*c);this.setViewport(0,0,a,b)};this.getCurrentViewport=function(a){void 0===a&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),a=new ba);return a.copy(U)};this.getViewport=function(a){return a.copy(X)};this.setViewport=function(a,b,c,d){a.isVector4?X.set(a.x,a.y,a.z,a.w):X.set(a,b,c,d);oa.viewport(U.copy(X).multiplyScalar(Q).floor())};this.getScissor=function(a){return a.copy(da)};this.setScissor=function(a,b,c,d){a.isVector4?da.set(a.x,a.y,a.z,a.w):da.set(a,b,c,d);oa.scissor(V.copy(da).multiplyScalar(Q).floor())};this.getScissorTest=function(){return ja};this.setScissorTest=function(a){oa.setScissorTest(ja=a)};this.setOpaqueSort=function(a){ea=a};this.setTransparentSort=function(a){ia=a};this.getClearColor=function(){return pa.getClearColor()};this.setClearColor=function(){pa.setClearColor.apply(pa,arguments)};this.getClearAlpha=function(){return pa.getClearAlpha()};this.setClearAlpha=function(){pa.setClearAlpha.apply(pa,arguments)};this.clear=function(a,b,c){var d=0;if(void 0===a||a)d|=16384;if(void 0===b||b)d|=256;if(void 0===c||c)d|=1024;L.clear(d)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.dispose=function(){r.removeEventListener("webglcontextlost",d,!1);r.removeEventListener("webglcontextrestored",e,!1);xa.dispose();ua.dispose();Ha.dispose();ta.dispose();ha.dispose();va.dispose();Aa.stop()};this.renderBufferImmediate=function(a,b){ha.initAttributes();var c=Ha.get(a);a.hasPositions&&!c.position&&(c.position=L.createBuffer());a.hasNormals&&!c.normal&&(c.normal=L.createBuffer());a.hasUvs&&!c.uv&&(c.uv=L.createBuffer());a.hasColors&&!c.color&&(c.color=L.createBuffer());b=b.getAttributes();a.hasPositions&&(L.bindBuffer(34962,c.position),L.bufferData(34962,a.positionArray,35048),ha.enableAttribute(b.position),L.vertexAttribPointer(b.position,3,5126,!1,0,0));a.hasNormals&&(L.bindBuffer(34962,c.normal),L.bufferData(34962,a.normalArray,35048),ha.enableAttribute(b.normal),L.vertexAttribPointer(b.normal,3,5126,!1,0,0));a.hasUvs&&(L.bindBuffer(34962,c.uv),L.bufferData(34962,a.uvArray,35048),ha.enableAttribute(b.uv),L.vertexAttribPointer(b.uv,2,5126,!1,0,0));a.hasColors&&(L.bindBuffer(34962,c.color),L.bufferData(34962,a.colorArray,35048),ha.enableAttribute(b.color),L.vertexAttribPointer(b.color,3,5126,!1,0,0));ha.disableUnusedAttributes();L.drawArrays(4,0,a.count);a.count=0};this.renderBufferDirect=function(a,b,c,d,e,f){null===b&&(b=lg);var g=e.isMesh&&0>e.matrixWorld.determinant();a=k(a,b,d,e);oa.setMaterial(d,g);g=c.index;b=c.attributes.position;if(null===g){if(void 0===b||0===b.count)return}else if(0===g.count)return;var h=1;!0===d.wireframe&&(g=wa.getWireframeAttribute(c),h=2);(d.morphTargets||d.morphNormals)&&Ba.update(e,c,d,a);ha.setup(e,d,a,c,g);a=Ca;if(null!==g){var l=sa.get(g);a=Da;a.setIndex(l)}var n=c.drawRange.start*h,q=null!==f?f.start*h:0;l=Math.max(n,q);f=Math.max(0,Math.min(null!==g?g.count:b.count,n+c.drawRange.count*h,q+(null!==f?f.count*h:Infinity))-1-l+1);0!==f&&(e.isMesh?!0===d.wireframe?(oa.setLineWidth(d.wireframeLinewidth*(null===F?Q:1)),a.setMode(1)):a.setMode(4):e.isLine?(d=d.linewidth,void 0===d&&(d=1),oa.setLineWidth(d*(null===F?Q:1)),e.isLineSegments?a.setMode(1):e.isLineLoop?a.setMode(2):a.setMode(3)):e.isPoints?a.setMode(0):e.isSprite&&a.setMode(4),e.isInstancedMesh?a.renderInstances(c,l,f,e.count):c.isInstancedBufferGeometry?a.renderInstances(c,l,f,Math.min(c.instanceCount,c._maxInstanceCount)):a.render(l,f))};this.compile=function(a,b){y=ua.get(a,b);y.init();a.traverse(function(a){a.isLight&&(y.pushLight(a),a.castShadow&&y.pushShadow(a))});y.setupLights(b);var c=new WeakMap;a.traverse(function(b){var d=b.material;if(d)if(Array.isArray(d))for(var e=0;e<d.length;e++){var f=d[e];!1===c.has(f)&&(p(f,a,b),c.set(f))}else!1===c.has(d)&&(p(d,a,b),c.set(d))})};var Ea=null,Aa=new vh;Aa.setAnimationLoop(function(a){va.isPresenting||Ea&&Ea(a)});"undefined"!==typeof window&&Aa.setContext(window);this.setAnimationLoop=function(a){Ea=a;va.setAnimationLoop(a);null===a?Aa.stop():Aa.start()};this.render=function(a,b,c,d){if(void 0!==c){console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead.");var e=c}if(void 0!==d){console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead.");var f=d}if(void 0!==b&&!0!==b.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else if(!0!==C){ha.resetDefaultState();J=-1;M=null;!0===a.autoUpdate&&a.updateMatrixWorld();null===b.parent&&b.updateMatrixWorld();!0===va.enabled&&!0===va.isPresenting&&(b=va.getCamera(b));if(!0===a.isScene)a.onBeforeRender(E,a,b,e||F);y=ua.get(a,b);y.init();Id.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);la.setFromProjectionMatrix(Id);kg=this.localClippingEnabled;ma=R.init(this.clippingPlanes,kg,b);O=xa.get(a,b);O.init();l(a,b,0,E.sortObjects);O.finish();!0===E.sortObjects&&O.sort(ea,ia);!0===ma&&R.beginShadows();Fa.render(y.state.shadowsArray,a,b);y.setupLights(b);!0===ma&&R.endShadows();!0===this.info.autoReset&&this.info.reset();void 0!==e&&this.setRenderTarget(e);pa.render(O,a,b,f);c=O.opaque;d=O.transparent;0<c.length&&n(c,a,b);0<d.length&&n(d,a,b);if(!0===a.isScene)a.onAfterRender(E,a,b);null!==F&&(S.updateRenderTargetMipmap(F),S.updateMultisampleRenderTarget(F));oa.buffers.depth.setTest(!0);oa.buffers.depth.setMask(!0);oa.buffers.color.setMask(!0);oa.setPolygonOffset(!1);y=O=null}};this.setFramebuffer=function(a){D!==a&&null===F&&L.bindFramebuffer(36160,a);D=a};this.getActiveCubeFace=function(){return H};this.getActiveMipmapLevel=function(){return I};this.getRenderTarget=function(){return F};this.setRenderTarget=function(a,b,c){F=a;H=b;I=c;a&&void 0===Ha.get(a).__webglFramebuffer&&S.setupRenderTarget(a);var d=D,e=!1;a?(d=Ha.get(a).__webglFramebuffer,a.isWebGLCubeRenderTarget?(d=d[b||0],e=!0):d=a.isWebGLMultisampleRenderTarget?Ha.get(a).__webglMultisampledFramebuffer:d,U.copy(a.viewport),V.copy(a.scissor),Z=a.scissorTest):(U.copy(X).multiplyScalar(Q).floor(),V.copy(da).multiplyScalar(Q).floor(),Z=ja);K!==d&&(L.bindFramebuffer(36160,d),K=d);oa.viewport(U);oa.scissor(V);oa.setScissorTest(Z);e&&(a=Ha.get(a.texture),L.framebufferTexture2D(36160,36064,34069+(b||0),a.__webglTexture,c||0))};this.readRenderTargetPixels=function(a,b,c,d,e,f,g){if(a&&a.isWebGLRenderTarget){var h=Ha.get(a).__webglFramebuffer;a.isWebGLCubeRenderTarget&&void 0!==g&&(h=h[g]);if(h){g=!1;h!==K&&(L.bindFramebuffer(36160,h),g=!0);try{var l=a.texture,n=l.format,q=l.type;1023!==n&&ra.convert(n)!==L.getParameter(35739)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===q||ra.convert(q)===L.getParameter(35738)||1015===q&&(Ga.isWebGL2||na.get("OES_texture_float")||na.get("WEBGL_color_buffer_float"))||1016===q&&(Ga.isWebGL2?na.get("EXT_color_buffer_float"):na.get("EXT_color_buffer_half_float"))?36053===L.checkFramebufferStatus(36160)?0<=b&&b<=a.width-d&&0<=c&&c<=a.height-e&&L.readPixels(b,c,d,e,ra.convert(n),ra.convert(q),f):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{g&&L.bindFramebuffer(36160,K)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")};this.copyFramebufferToTexture=function(a,b,c){void 0===c&&(c=0);var d=Math.pow(2,-c),e=Math.floor(b.image.width*d);d=Math.floor(b.image.height*d);var f=ra.convert(b.format);S.setTexture2D(b,0);L.copyTexImage2D(3553,c,f,a.x,a.y,e,d,0);oa.unbindTexture()};this.copyTextureToTexture=function(a,b,c,d){void 0===d&&(d=0);var e=b.image.width,f=b.image.height,g=ra.convert(c.format),h=ra.convert(c.type);S.setTexture2D(c,0);L.pixelStorei(37440,c.flipY);L.pixelStorei(37441,c.premultiplyAlpha);L.pixelStorei(3317,c.unpackAlignment);b.isDataTexture?L.texSubImage2D(3553,d,a.x,a.y,e,f,g,h,b.image.data):b.isCompressedTexture?L.compressedTexSubImage2D(3553,d,a.x,a.y,b.mipmaps[0].width,b.mipmaps[0].height,g,b.mipmaps[0].data):L.texSubImage2D(3553,d,a.x,a.y,g,h,b.image);0===d&&c.generateMipmaps&&L.generateMipmap(3553);oa.unbindTexture()};this.initTexture=function(a){S.setTexture2D(a,0);oa.unbindTexture()};"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function mg(a){Jd.call(this,a)}function Le(a,b){this.name="";this.color=new H(a);this.density=void 0!==b?b:2.5E-4}function Me(a,b,c){this.name="";this.color=new H(a);this.near=void 0!==b?b:1;this.far=void 0!==c?c:1E3}function Ia(a,b){this.array=a;this.stride=b;this.count=void 0!==a?a.length/b:0;this.usage=35044;this.updateRange={offset:0,count:-1};this.version=0;this.uuid=P.generateUUID()}function Hb(a,b,c,d){this.name="";this.data=a;this.itemSize=b;this.offset=c;this.normalized=!0===d}function Ib(a){K.call(this);this.type="SpriteMaterial";this.color=new H(16777215);this.alphaMap=this.map=null;this.rotation=0;this.transparent=this.sizeAttenuation=!0;this.setValues(a)}function Kd(a){y.call(this);this.type="Sprite";if(void 0===Jc){Jc=new D;var b=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]);b=new Ia(b,5);Jc.setIndex([0,1,2,0,2,3]);Jc.setAttribute("position",new Hb(b,3,0,!1));Jc.setAttribute("uv",new Hb(b,2,3,!1))}this.geometry=Jc;this.material=void 0!==a?a:new Ib;this.center=new w(.5,.5)}function Ne(a,b,c,d,e,f){Kc.subVectors(a,c).addScalar(.5).multiply(d);void 0!==e?(Ld.x=f*Kc.x-e*Kc.y,Ld.y=e*Kc.x+f*Kc.y):Ld.copy(Kc);a.copy(b);a.x+=Ld.x;a.y+=Ld.y;a.applyMatrix4(Wh)}function Md(){y.call(this);this._currentLevel=0;this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}});this.autoUpdate=!0}function Oe(a,b){a&&a.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");Z.call(this,a,b);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new T;this.bindMatrixInverse=new T}function Pe(a,b){a=a||[];this.bones=a.slice(0);this.boneMatrices=new Float32Array(16*this.bones.length);this.frame=-1;if(void 0===b)this.calculateInverses();else if(this.bones.length===b.length)this.boneInverses=b.slice(0);else for(console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[],a=0,b=this.bones.length;a<b;a++)this.boneInverses.push(new T)}function ng(){y.call(this);this.type="Bone"}function Qe(a,b,c){Z.call(this,a,b);this.instanceMatrix=new F(new Float32Array(16*c),16);this.count=c;this.frustumCulled=!1}function ia(a){K.call(this);this.type="LineBasicMaterial";this.color=new H(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.morphTargets=!1;this.setValues(a)}function Ja(a,b,c){1===c&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead.");y.call(this);this.type="Line";this.geometry=void 0!==a?a:new D;this.material=void 0!==b?b:new ia;this.updateMorphTargets()}function da(a,b){Ja.call(this,a,b);this.type="LineSegments"}function Re(a,b){Ja.call(this,a,b);this.type="LineLoop"}function Wa(a){K.call(this);this.type="PointsMaterial";this.color=new H(16777215);this.alphaMap=this.map=null;this.size=1;this.sizeAttenuation=!0;this.morphTargets=!1;this.setValues(a)}function Lc(a,b){y.call(this);this.type="Points";this.geometry=void 0!==a?a:new D;this.material=void 0!==b?b:new Wa;this.updateMorphTargets()}function og(a,b,c,d,e,f,g){var h=pg.distanceSqToPoint(a);h<c&&(c=new m,pg.closestPointToPoint(a,c),c.applyMatrix4(d),a=e.ray.origin.distanceTo(c),a<e.near||a>e.far||f.push({distance:a,distanceToRay:Math.sqrt(h),point:c,index:b,face:null,object:g}))}function qg(a,b,c,d,e,f,g,h,l){function n(){q.needsUpdate=!0;a.requestVideoFrameCallback(n)}V.call(this,a,b,c,d,e,f,g,h,l);this.format=void 0!==g?g:1022;this.minFilter=void 0!==f?f:1006;this.magFilter=void 0!==e?e:1006;this.generateMipmaps=!1;var q=this;"requestVideoFrameCallback"in a&&a.requestVideoFrameCallback(n)}function Mc(a,b,c,d,e,f,g,h,l,n,q,p){V.call(this,null,f,g,h,l,n,d,e,q,p);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1}function Nd(a,b,c,d,e,f,g,h,l){V.call(this,a,b,c,d,e,f,g,h,l);this.needsUpdate=!0}function Od(a,b,c,d,e,f,g,h,l,n){n=void 0!==n?n:1026;if(1026!==n&&1027!==n)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===c&&1026===n&&(c=1012);void 0===c&&1027===n&&(c=1020);V.call(this,null,d,e,f,g,h,n,c,l);this.image={width:a,height:b};this.magFilter=void 0!==g?g:1003;this.minFilter=void 0!==h?h:1003;this.generateMipmaps=this.flipY=!1}function Nc(a){D.call(this);this.type="WireframeGeometry";var b=[],c=[0,0],d={},e=["a","b","c"];if(a&&a.isGeometry){for(var f=a.faces,g=0,h=f.length;g<h;g++)for(var l=f[g],n=0;3>n;n++){var q=l[e[n]],p=l[e[(n+1)%3]];c[0]=Math.min(q,p);c[1]=Math.max(q,p);q=c[0]+","+c[1];void 0===d[q]&&(d[q]={index1:c[0],index2:c[1]})}for(var k in d)c=d[k],f=a.vertices[c.index1],b.push(f.x,f.y,f.z),f=a.vertices[c.index2],b.push(f.x,f.y,f.z)}else if(a&&a.isBufferGeometry)if(k=new m,null!==a.index){e=a.attributes.position;g=a.index;a=a.groups;0===a.length&&(a=[{start:0,count:g.count,materialIndex:0}]);h=0;for(l=a.length;h<l;++h)for(q=a[h],n=p=q.start,q=p+q.count;n<q;n+=3)for(p=0;3>p;p++){var r=g.getX(n+p),t=g.getX(n+(p+1)%3);c[0]=Math.min(r,t);c[1]=Math.max(r,t);r=c[0]+","+c[1];void 0===d[r]&&(d[r]={index1:c[0],index2:c[1]})}for(f in d)c=d[f],k.fromBufferAttribute(e,c.index1),b.push(k.x,k.y,k.z),k.fromBufferAttribute(e,c.index2),b.push(k.x,k.y,k.z)}else for(d=a.attributes.position,c=0,f=d.count/3;c<f;c++)for(a=0;3>a;a++)k.fromBufferAttribute(d,3*c+a),b.push(k.x,k.y,k.z),k.fromBufferAttribute(d,3*c+(a+1)%3),b.push(k.x,k.y,k.z);this.setAttribute("position",new C(b,3))}function Pd(a,b,c){J.call(this);this.type="ParametricGeometry";this.parameters={func:a,slices:b,stacks:c};this.fromBufferGeometry(new Oc(a,b,c));this.mergeVertices()}function Oc(a,b,c){D.call(this);this.type="ParametricBufferGeometry";this.parameters={func:a,slices:b,stacks:c};var d=[],e=[],f=[],g=[],h=new m,l=new m,n=new m,q=new m,k=new m;3>a.length&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");for(var v=b+1,r=0;r<=c;r++)for(var t=r/c,u=0;u<=b;u++){var z=u/b;a(z,t,l);e.push(l.x,l.y,l.z);0<=z-1E-5?(a(z-1E-5,t,n),q.subVectors(l,n)):(a(z+1E-5,t,n),q.subVectors(n,l));0<=t-1E-5?(a(z,t-1E-5,n),k.subVectors(l,n)):(a(z,t+1E-5,n),k.subVectors(n,l));h.crossVectors(q,k).normalize();f.push(h.x,h.y,h.z);g.push(z,t)}for(a=0;a<c;a++)for(h=0;h<b;h++)l=a*v+h+1,n=(a+1)*v+h+1,q=(a+1)*v+h,d.push(a*v+h,l,q),d.push(l,n,q);this.setIndex(d);this.setAttribute("position",new C(e,3));this.setAttribute("normal",new C(f,3));this.setAttribute("uv",new C(g,2))}function Qd(a,b,c,d){J.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:a,indices:b,radius:c,detail:d};this.fromBufferGeometry(new ha(a,b,c,d));this.mergeVertices()}function ha(a,b,c,d){function e(a){h.push(a.x,a.y,a.z)}function f(b,c){b*=3;c.x=a[b+0];c.y=a[b+1];c.z=a[b+2]}function g(a,b,c,d){0>d&&1===a.x&&(l[b]=a.x-1);0===c.x&&0===c.z&&(l[b]=d/2/Math.PI+.5)}D.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:a,indices:b,radius:c,detail:d};c=c||1;d=d||0;var h=[],l=[];(function(a){for(var c=new m,d=new m,g=new m,h=0;h<b.length;h+=3){f(b[h+0],c);f(b[h+1],d);f(b[h+2],g);for(var l=c,n=d,k=g,A=Math.pow(2,a),x=[],w=0;w<=A;w++){x[w]=[];for(var W=l.clone().lerp(k,w/A),N=n.clone().lerp(k,w/A),B=A-w,y=0;y<=B;y++)x[w][y]=0===y&&w===A?W:W.clone().lerp(N,y/B)}for(l=0;l<A;l++)for(n=0;n<2*(A-l)-1;n++)k=Math.floor(n/2),0===n%2?(e(x[l][k+1]),e(x[l+1][k]),e(x[l][k])):(e(x[l][k+1]),e(x[l+1][k+1]),e(x[l+1][k]))}})(d);(function(a){for(var b=new m,c=0;c<h.length;c+=3)b.x=h[c+0],b.y=h[c+1],b.z=h[c+2],b.normalize().multiplyScalar(a),h[c+0]=b.x,h[c+1]=b.y,h[c+2]=b.z})(c);(function(){for(var a=new m,b=0;b<h.length;b+=3)a.x=h[b+0],a.y=h[b+1],a.z=h[b+2],l.push(Math.atan2(a.z,-a.x)/2/Math.PI+.5,1-(Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5));a=new m;b=new m;for(var c=new m,d=new m,e=new w,f=new w,k=new w,z=0,A=0;z<h.length;z+=9,A+=6){a.set(h[z+0],h[z+1],h[z+2]);b.set(h[z+3],h[z+4],h[z+5]);c.set(h[z+6],h[z+7],h[z+8]);e.set(l[A+0],l[A+1]);f.set(l[A+2],l[A+3]);k.set(l[A+4],l[A+5]);d.copy(a).add(b).add(c).divideScalar(3);var x=Math.atan2(d.z,-d.x);g(e,A+0,a,x);g(f,A+2,b,x);g(k,A+4,c,x)}for(a=0;a<l.length;a+=6)b=l[a+0],c=l[a+2],d=l[a+4],e=Math.min(b,c,d),.9<Math.max(b,c,d)&&.1>e&&(.2>b&&(l[a+0]+=1),.2>c&&(l[a+2]+=1),.2>d&&(l[a+4]+=1))})();this.setAttribute("position",new C(h,3));this.setAttribute("normal",new C(h.slice(),3));this.setAttribute("uv",new C(l,2));0===d?this.computeVertexNormals():this.normalizeNormals()}function Rd(a,b){J.call(this);this.type="TetrahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new Pc(a,b));this.mergeVertices()}function Pc(a,b){ha.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,b);this.type="TetrahedronBufferGeometry";this.parameters={radius:a,detail:b}}function Sd(a,b){J.call(this);this.type="OctahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new bc(a,b));this.mergeVertices()}function bc(a,b){ha.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b);this.type="OctahedronBufferGeometry";this.parameters={radius:a,detail:b}}function Td(a,b){J.call(this);this.type="IcosahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new Qc(a,b));this.mergeVertices()}function Qc(a,b){var c=(1+Math.sqrt(5))/2;ha.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronBufferGeometry";this.parameters={radius:a,detail:b}}function Ud(a,b){J.call(this);this.type="DodecahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new Rc(a,b));this.mergeVertices()}function Rc(a,b){var c=(1+Math.sqrt(5))/2,d=1/c;ha.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-c,0,-d,c,0,d,-c,0,d,c,-d,-c,0,-d,c,0,d,-c,0,d,c,0,-c,0,-d,c,0,-d,-c,0,d,c,0,d],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a,b);this.type="DodecahedronBufferGeometry";this.parameters={radius:a,detail:b}}function Vd(a,b,c,d,e,f){J.call(this);this.type="TubeGeometry";this.parameters={path:a,tubularSegments:b,radius:c,radialSegments:d,closed:e};void 0!==f&&console.warn("THREE.TubeGeometry: taper has been removed.");a=new cc(a,b,c,d,e);this.tangents=a.tangents;this.normals=a.normals;this.binormals=a.binormals;this.fromBufferGeometry(a);this.mergeVertices()}function cc(a,b,c,d,e){function f(e){q=a.getPointAt(e/b,q);var f=g.normals[e];e=g.binormals[e];for(var n=0;n<=d;n++){var p=n/d*Math.PI*2,r=Math.sin(p);p=-Math.cos(p);l.x=p*f.x+r*e.x;l.y=p*f.y+r*e.y;l.z=p*f.z+r*e.z;l.normalize();v.push(l.x,l.y,l.z);h.x=q.x+c*l.x;h.y=q.y+c*l.y;h.z=q.z+c*l.z;k.push(h.x,h.y,h.z)}}D.call(this);this.type="TubeBufferGeometry";this.parameters={path:a,tubularSegments:b,radius:c,radialSegments:d,closed:e};b=b||64;c=c||1;d=d||8;e=e||!1;var g=a.computeFrenetFrames(b,e);this.tangents=g.tangents;this.normals=g.normals;this.binormals=g.binormals;var h=new m,l=new m,n=new w,q=new m,k=[],v=[],r=[],t=[];(function(){for(var a=0;a<b;a++)f(a);f(!1===e?b:0);for(a=0;a<=b;a++)for(var c=0;c<=d;c++)n.x=a/b,n.y=c/d,r.push(n.x,n.y);for(a=1;a<=b;a++)for(c=1;c<=d;c++){var g=(d+1)*a+(c-1),h=(d+1)*a+c,l=(d+1)*(a-1)+c;t.push((d+1)*(a-1)+(c-1),g,l);t.push(g,h,l)}})();this.setIndex(t);this.setAttribute("position",new C(k,3));this.setAttribute("normal",new C(v,3));this.setAttribute("uv",new C(r,2))}function Wd(a,b,c,d,e,f,g){J.call(this);this.type="TorusKnotGeometry";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};void 0!==g&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.");this.fromBufferGeometry(new Sc(a,b,c,d,e,f));this.mergeVertices()}function Sc(a,b,c,d,e,f){function g(a,b,c,d,e){var f=Math.sin(a);b=c/b*a;c=Math.cos(b);e.x=d*(2+c)*.5*Math.cos(a);e.y=d*(2+c)*f*.5;e.z=d*Math.sin(b)*.5}D.call(this);this.type="TorusKnotBufferGeometry";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};a=a||1;b=b||.4;c=Math.floor(c)||64;d=Math.floor(d)||8;e=e||2;f=f||3;for(var h=[],l=[],n=[],q=[],k=new m,v=new m,r=new m,t=new m,u=new m,z=new m,A=new m,x=0;x<=c;++x){var w=x/c*e*Math.PI*2;g(w,e,f,a,r);g(w+.01,e,f,a,t);z.subVectors(t,r);A.addVectors(t,r);u.crossVectors(z,A);A.crossVectors(u,z);u.normalize();A.normalize();for(w=0;w<=d;++w){var y=w/d*Math.PI*2,N=-b*Math.cos(y);y=b*Math.sin(y);k.x=r.x+(N*A.x+y*u.x);k.y=r.y+(N*A.y+y*u.y);k.z=r.z+(N*A.z+y*u.z);l.push(k.x,k.y,k.z);v.subVectors(k,r).normalize();n.push(v.x,v.y,v.z);q.push(x/c);q.push(w/d)}}for(a=1;a<=c;a++)for(b=1;b<=d;b++)e=(d+1)*a+(b-1),f=(d+1)*a+b,k=(d+1)*(a-1)+b,h.push((d+1)*(a-1)+(b-1),e,k),h.push(e,f,k);this.setIndex(h);this.setAttribute("position",new C(l,3));this.setAttribute("normal",new C(n,3));this.setAttribute("uv",new C(q,2))}function Xd(a,b,c,d,e){J.call(this);this.type="TorusGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};this.fromBufferGeometry(new Tc(a,b,c,d,e));this.mergeVertices()}function Tc(a,b,c,d,e){D.call(this);this.type="TorusBufferGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||1;b=b||.4;c=Math.floor(c)||8;d=Math.floor(d)||6;e=e||2*Math.PI;for(var f=[],g=[],h=[],l=[],n=new m,k=new m,p=new m,v=0;v<=c;v++)for(var r=0;r<=d;r++){var t=r/d*e,u=v/c*Math.PI*2;k.x=(a+b*Math.cos(u))*Math.cos(t);k.y=(a+b*Math.cos(u))*Math.sin(t);k.z=b*Math.sin(u);g.push(k.x,k.y,k.z);n.x=a*Math.cos(t);n.y=a*Math.sin(t);p.subVectors(k,n).normalize();h.push(p.x,p.y,p.z);l.push(r/d);l.push(v/c)}for(a=1;a<=c;a++)for(b=1;b<=d;b++)e=(d+1)*(a-1)+b-1,n=(d+1)*(a-1)+b,k=(d+1)*a+b,f.push((d+1)*a+b-1,e,k),f.push(e,n,k);this.setIndex(f);this.setAttribute("position",new C(g,3));this.setAttribute("normal",new C(h,3));this.setAttribute("uv",new C(l,2))}function Xh(a,b,c,d,e){for(var f,g=0,h=b,l=c-d;h<c;h+=d)g+=(a[l]-a[h])*(a[h+1]+a[l+1]),l=h;if(e===0<g)for(e=b;e<c;e+=d)f=Yh(e,a[e],a[e+1],f);else for(e=c-d;e>=b;e-=d)f=Yh(e,a[e],a[e+1],f);f&&Se(f,f.next)&&(Yd(f),f=f.next);return f}
function Jb(a,b){if(!a)return a;b||(b=a);do{var c=!1;if(a.steiner||!Se(a,a.next)&&0!==ja(a.prev,a,a.next))a=a.next;else{Yd(a);a=b=a.prev;if(a===a.next)break;c=!0}}while(c||a!==b);return b}function Zd(a,b,c,d,e,f,g){if(a){if(!g&&f){var h=a,l=h;do null===l.z&&(l.z=rg(l.x,l.y,d,e,f)),l.prevZ=l.prev,l=l.nextZ=l.next;while(l!==h);l.prevZ.nextZ=null;l.prevZ=null;h=l;var n,k,p,v,r=1;do{l=h;var t=h=null;for(k=0;l;){k++;var m=l;for(n=p=0;n<r&&(p++,m=m.nextZ,m);n++);for(v=r;0<p||0<v&&m;)0!==p&&(0===v||!m||l.z<=m.z)?(n=l,l=l.nextZ,p--):(n=m,m=m.nextZ,v--),t?t.nextZ=n:h=n,n.prevZ=t,t=n;l=m}t.nextZ=null;r*=2}while(1<k)}for(h=a;a.prev!==a.next;){l=a.prev;m=a.next;if(f)t=Ck(a,d,e,f);else a:if(t=a,k=t.prev,p=t,r=t.next,0<=ja(k,p,r))t=!1;else{for(n=t.next.next;n!==t.prev;){if(Uc(k.x,k.y,p.x,p.y,r.x,r.y,n.x,n.y)&&0<=ja(n.prev,n,n.next)){t=!1;break a}n=n.next}t=!0}if(t)b.push(l.i/c),b.push(a.i/c),b.push(m.i/c),Yd(a),h=a=m.next;else if(a=m,a===h){if(!g)Zd(Jb(a),b,c,d,e,f,1);else if(1===g){a=Jb(a);g=b;h=c;l=a;do m=l.prev,t=l.next.next,!Se(m,t)&&Zh(m,l,l.next,t)&&$d(m,t)&&$d(t,m)&&(g.push(m.i/h),g.push(l.i/h),g.push(t.i/h),Yd(l),Yd(l.next),l=a=t),l=l.next;while(l!==a);a=Jb(l);Zd(a,b,c,d,e,f,2)}else if(2===g)a:{g=a;do{for(h=g.next.next;h!==g.prev;){if(l=g.i!==h.i){l=g;m=h;if(t=l.next.i!==m.i&&l.prev.i!==m.i){b:{t=l;do{if(t.i!==l.i&&t.next.i!==l.i&&t.i!==m.i&&t.next.i!==m.i&&Zh(t,t.next,l,m)){t=!0;break b}t=t.next}while(t!==l);t=!1}t=!t}if(t){if(t=$d(l,m)&&$d(m,l)){t=l;k=!1;p=(l.x+m.x)/2;r=(l.y+m.y)/2;do t.y>r!==t.next.y>r&&t.next.y!==t.y&&p<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(k=!k),t=t.next;while(t!==l);t=k}t=t&&(ja(l.prev,l,m.prev)||ja(l,m.prev,m))||Se(l,m)&&0<ja(l.prev,l,l.next)&&0<ja(m.prev,m,m.next)}l=t}if(l){a=$h(g,h);g=Jb(g,g.next);a=Jb(a,a.next);Zd(g,b,c,d,e,f);Zd(a,b,c,d,e,f);break a}h=h.next}g=g.next}while(g!==a)}break}}}}function Ck(a,b,c,d){var e=a.prev,f=a.next;if(0<=ja(e,a,f))return!1;var g=e.x>a.x?e.x>f.x?e.x:f.x:a.x>f.x?a.x:f.x,h=e.y>a.y?e.y>f.y?e.y:f.y:a.y>f.y?a.y:f.y,l=rg(e.x<a.x?e.x<f.x?e.x:f.x:a.x<f.x?a.x:f.x,e.y<a.y?e.y<f.y?e.y:f.y:a.y<f.y?a.y:f.y,b,c,d);b=rg(g,h,b,c,d);c=a.prevZ;for(d=a.nextZ;c&&c.z>=l&&d&&d.z<=b;){if(c!==a.prev&&c!==a.next&&Uc(e.x,e.y,a.x,a.y,f.x,f.y,c.x,c.y)&&0<=ja(c.prev,c,c.next))return!1;c=c.prevZ;if(d!==a.prev&&d!==a.next&&Uc(e.x,e.y,a.x,a.y,f.x,f.y,d.x,d.y)&&0<=ja(d.prev,d,d.next))return!1;d=d.nextZ}for(;c&&c.z>=l;){if(c!==a.prev&&c!==a.next&&Uc(e.x,e.y,a.x,a.y,f.x,f.y,c.x,c.y)&&0<=ja(c.prev,c,c.next))return!1;c=c.prevZ}for(;d&&d.z<=b;){if(d!==a.prev&&d!==a.next&&Uc(e.x,e.y,a.x,a.y,f.x,f.y,d.x,d.y)&&0<=ja(d.prev,d,d.next))return!1;d=d.nextZ}return!0}function Dk(a,b){return a.x-b.x}function Ek(a,b){var c=b,d=a.x,e=a.y,f=-Infinity;do{if(e<=c.y&&e>=c.next.y&&c.next.y!==c.y){var g=c.x+(e-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(g<=d&&g>f){f=g;if(g===d){if(e===c.y)return c;if(e===c.next.y)return c.next}var h=c.x<c.next.x?c:c.next}}c=c.next}while(c!==b);if(!h)return null;if(d===f)return h;b=h;g=h.x;var l=h.y,n=Infinity;c=h;do{if(d>=c.x&&c.x>=g&&d!==c.x&&Uc(e<l?d:f,e,g,l,e<l?f:d,e,c.x,c.y)){var k=Math.abs(e-c.y)/(d-c.x);var p;if((p=$d(c,a))&&!(p=k<n)&&(p=k===n)&&!(p=c.x>h.x)&&(p=c.x===h.x)){p=h;var m=c;p=0>ja(p.prev,p,m.prev)&&0>ja(m.next,p,p.next)}p&&(h=c,n=k)}c=c.next}while(c!==b);return h}function rg(a,b,c,d,e){a=32767*(a-c)*e;b=32767*(b-d)*e;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1}function Fk(a){var b=a,c=a;do{if(b.x<c.x||b.x===c.x&&b.y<c.y)c=b;b=b.next}while(b!==a);return c}function Uc(a,b,c,d,e,f,g,h){return 0<=(e-g)*(b-h)-(a-g)*(f-h)&&0<=(a-g)*(d-h)-(c-g)*(b-h)&&0<=(c-g)*(f-h)-(e-g)*(d-h)}function ja(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function Se(a,b){return a.x===b.x&&a.y===b.y}function Zh(a,b,c,d){var e=Te(ja(a,b,c)),f=Te(ja(a,b,d)),g=Te(ja(c,d,a)),h=Te(ja(c,d,b));return e!==f&&g!==h||0===e&&Ue(a,c,b)||0===f&&Ue(a,d,b)||0===g&&Ue(c,a,d)||0===h&&Ue(c,b,d)?!0:!1}function Ue(a,b,c){return b.x<=Math.max(a.x,c.x)&&b.x>=Math.min(a.x,c.x)&&b.y<=Math.max(a.y,c.y)&&b.y>=Math.min(a.y,c.y)}function Te(a){return 0<a?1:0>a?-1:0}function $d(a,b){return 0>ja(a.prev,a,a.next)?0<=ja(a,b,a.next)&&0<=ja(a,a.prev,b):0>ja(a,b,a.prev)||0>ja(a,a.next,b)}function $h(a,b){var c=new sg(a.i,a.x,a.y),d=new sg(b.i,b.x,b.y),e=a.next,f=b.prev;a.next=b;b.prev=a;c.next=e;e.prev=c;d.next=c;c.prev=d;f.next=d;d.prev=f;return d}function Yh(a,b,c,d){a=new sg(a,b,c);d?(a.next=d.next,a.prev=d,d.next.prev=a,d.next=a):(a.prev=a,a.next=a);return a}function Yd(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function sg(a,b,c){this.i=a;this.x=b;this.y=c;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function ai(a){var b=a.length;2<b&&a[b-1].equals(a[0])&&a.pop()}function bi(a,b){for(var c=0;c<b.length;c++)a.push(b[c].x),a.push(b[c].y)}function dc(a,b){J.call(this);this.type="ExtrudeGeometry";this.parameters={shapes:a,options:b};this.fromBufferGeometry(new fb(a,b));this.mergeVertices()}function fb(a,b){function c(a){function c(a,b,c){b||console.error("THREE.ExtrudeGeometry: vec does not exist");return b.clone().multiplyScalar(c).add(a)}function g(a,b,c){var d=a.x-b.x;var e=a.y-b.y;var f=c.x-a.x;var g=c.y-a.y,h=d*d+e*e;if(Math.abs(d*g-e*f)>Number.EPSILON){var l=Math.sqrt(h),n=Math.sqrt(f*f+g*g);h=b.x-e/l;b=b.y+d/l;g=((c.x-g/n-h)*g-(c.y+f/n-b)*f)/(d*g-e*f);f=h+d*g-a.x;d=b+e*g-a.y;e=f*f+d*d;if(2>=e)return new w(f,d);e=Math.sqrt(e/2)}else a=!1,d>Number.EPSILON?f>Number.EPSILON&&(a=!0):d<-Number.EPSILON?f<-Number.EPSILON&&(a=!0):Math.sign(e)===Math.sign(g)&&(a=!0),a?(f=-e,e=Math.sqrt(h)):(f=d,d=e,e=Math.sqrt(h/2));return new w(f/e,d/e)}function h(a,b){for(var c=a.length;0<=--c;){var f=c,g=c-1;0>g&&(g=a.length-1);for(var h=0,l=x+2*C;h<l;h++){var n=V*h,k=V*(h+1),q=b+g+n,p=b+g+k;k=b+f+k;t(b+f+n);t(q);t(k);t(q);t(p);t(k);n=e.length/3;n=G.generateSideWallUV(d,e,n-6,n-3,n-2,n-1);u(n[0]);u(n[1]);u(n[3]);u(n[1]);u(n[2]);u(n[3])}}}function l(a,b,c){z.push(a);z.push(b);z.push(c)}function k(a,b,c){t(a);t(b);t(c);a=e.length/3;a=G.generateTopUV(d,e,a-3,a-2,a-1);u(a[0]);u(a[1]);u(a[2])}function t(a){e.push(z[3*a]);e.push(z[3*a+1]);e.push(z[3*a+2])}function u(a){f.push(a.x);f.push(a.y)}var z=[],A=void 0!==b.curveSegments?b.curveSegments:12,x=void 0!==b.steps?b.steps:1,y=void 0!==b.depth?b.depth:100,W=void 0!==b.bevelEnabled?b.bevelEnabled:!0,N=void 0!==b.bevelThickness?b.bevelThickness:6,B=void 0!==b.bevelSize?b.bevelSize:N-2,O=void 0!==b.bevelOffset?b.bevelOffset:0,C=void 0!==b.bevelSegments?b.bevelSegments:3,E=b.extrudePath,G=void 0!==b.UVGenerator?b.UVGenerator:Gk;void 0!==b.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),y=b.amount);var D=!1;if(E){var H=E.getSpacedPoints(x);D=!0;W=!1;var F=E.computeFrenetFrames(x,!1);var I=new m;var K=new m;var J=new m}W||(O=B=N=C=0);a=a.extractPoints(A);E=a.shape;var P=a.holes;if(!pb.isClockWise(E))for(E=E.reverse(),a=0,A=P.length;a<A;a++){var M=P[a];pb.isClockWise(M)&&(P[a]=M.reverse())}var T=pb.triangulateShape(E,P),U=E;a=0;for(A=P.length;a<A;a++)E=E.concat(P[a]);var V=E.length,aa=T.length;a=[];A=0;M=U.length;for(var ca=M-1,Q=A+1;A<M;A++,ca++,Q++)ca===M&&(ca=0),Q===M&&(Q=0),a[A]=g(U[A],U[ca],U[Q]);A=[];M=a.concat();Q=0;for(var R=P.length;Q<R;Q++){var S=P[Q];ca=[];for(var X=0,Y=S.length,ba=Y-1,Z=X+1;X<Y;X++,ba++,Z++)ba===Y&&(ba=0),Z===Y&&(Z=0),ca[X]=g(S[X],S[ba],S[Z]);A.push(ca);M=M.concat(ca)}for(Q=0;Q<C;Q++){ca=Q/C;R=N*Math.cos(ca*Math.PI/2);S=B*Math.sin(ca*Math.PI/2)+O;ca=0;for(X=U.length;ca<X;ca++)Y=c(U[ca],a[ca],S),l(Y.x,Y.y,-R);X=0;for(Y=P.length;X<Y;X++){ba=P[X];ca=A[X];Z=0;for(var da=ba.length;Z<da;Z++){var ea=c(ba[Z],ca[Z],S);l(ea.x,ea.y,-R)}}}ca=B+O;for(Q=0;Q<V;Q++)R=W?c(E[Q],M[Q],ca):E[Q],D?(K.copy(F.normals[0]).multiplyScalar(R.x),I.copy(F.binormals[0]).multiplyScalar(R.y),J.copy(H[0]).add(K).add(I),l(J.x,J.y,J.z)):l(R.x,R.y,0);for(Q=1;Q<=x;Q++)for(R=0;R<V;R++)S=W?c(E[R],M[R],ca):E[R],D?(K.copy(F.normals[Q]).multiplyScalar(S.x),I.copy(F.binormals[Q]).multiplyScalar(S.y),J.copy(H[Q]).add(K).add(I),l(J.x,J.y,J.z)):l(S.x,S.y,y/x*Q);for(F=C-1;0<=F;F--){K=F/C;I=N*Math.cos(K*Math.PI/2);K=B*Math.sin(K*Math.PI/2)+O;J=0;for(E=U.length;J<E;J++)M=c(U[J],a[J],K),l(M.x,M.y,y+I);J=0;for(E=P.length;J<E;J++)for(M=P[J],ca=A[J],Q=0,R=M.length;Q<R;Q++)S=c(M[Q],ca[Q],K),D?l(S.x,S.y+H[x-1].y,H[x-1].x+I):l(S.x,S.y,y+I)}(function(){var a=e.length/3;if(W){for(var b=0*V,c=0;c<aa;c++){var f=T[c];k(f[2]+b,f[1]+b,f[0]+b)}b=V*(x+2*C);for(c=0;c<aa;c++)f=T[c],k(f[0]+b,f[1]+b,f[2]+b)}else{for(b=0;b<aa;b++)c=T[b],k(c[2],c[1],c[0]);for(b=0;b<aa;b++)c=T[b],k(c[0]+V*x,c[1]+V*x,c[2]+V*x)}d.addGroup(a,e.length/3-a,0)})();(function(){var a=e.length/3,b=0;h(U,b);b+=U.length;for(var c=0,f=P.length;c<f;c++){var g=P[c];h(g,b);b+=g.length}d.addGroup(a,e.length/3-a,1)})()}D.call(this);this.type="ExtrudeBufferGeometry";this.parameters={shapes:a,options:b};a=Array.isArray(a)?a:[a];for(var d=this,e=[],f=[],g=0,h=a.length;g<h;g++)c(a[g]);this.setAttribute("position",new C(e,3));this.setAttribute("uv",new C(f,2));this.computeVertexNormals()}function ci(a,b,c){c.shapes=[];if(Array.isArray(a))for(var d=0,e=a.length;d<e;d++)c.shapes.push(a[d].uuid);else c.shapes.push(a.uuid);void 0!==b.extrudePath&&(c.options.extrudePath=b.extrudePath.toJSON());return c}function ae(a,b){J.call(this);this.type="TextGeometry";this.parameters={text:a,parameters:b};this.fromBufferGeometry(new Vc(a,b));this.mergeVertices()}function Vc(a,b){b=b||{};var c=b.font;if(!c||!c.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new J;a=c.generateShapes(a,b.size);b.depth=void 0!==b.height?b.height:50;void 0===b.bevelThickness&&(b.bevelThickness=10);void 0===b.bevelSize&&(b.bevelSize=8);void 0===b.bevelEnabled&&(b.bevelEnabled=!1);fb.call(this,a,b);this.type="TextBufferGeometry"}function be(a,b,c,d,e,f,g){J.call(this);this.type="SphereGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};this.fromBufferGeometry(new ec(a,b,c,d,e,f,g));this.mergeVertices()}function ec(a,b,c,d,e,f,g){D.call(this);this.type="SphereBufferGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};a=a||1;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;f=void 0!==f?f:0;g=void 0!==g?g:Math.PI;for(var h=Math.min(f+g,Math.PI),l=0,n=[],k=new m,p=new m,v=[],r=[],t=[],u=[],z=0;z<=c;z++){var A=[],x=z/c,w=0;0==z&&0==f?w=.5/b:z==c&&h==Math.PI&&(w=-.5/b);for(var y=0;y<=b;y++){var N=y/b;k.x=-a*Math.cos(d+N*e)*Math.sin(f+x*g);k.y=a*Math.cos(f+x*g);k.z=a*Math.sin(d+N*e)*Math.sin(f+x*g);r.push(k.x,k.y,k.z);p.copy(k).normalize();t.push(p.x,p.y,p.z);u.push(N+w,1-x);A.push(l++)}n.push(A)}for(a=0;a<c;a++)for(d=0;d<b;d++)e=n[a][d+1],g=n[a][d],l=n[a+1][d],k=n[a+1][d+1],(0!==a||0<f)&&v.push(e,g,k),(a!==c-1||h<Math.PI)&&v.push(g,l,k);this.setIndex(v);this.setAttribute("position",new C(r,3));this.setAttribute("normal",new C(t,3));this.setAttribute("uv",new C(u,2))}function ce(a,b,c,d,e,f){J.call(this);this.type="RingGeometry";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};this.fromBufferGeometry(new Wc(a,b,c,d,e,f));this.mergeVertices()}function Wc(a,b,c,d,e,f){D.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};a=a||.5;b=b||1;e=void 0!==e?e:0;f=void 0!==f?f:2*Math.PI;c=void 0!==c?Math.max(3,c):8;d=void 0!==d?Math.max(1,d):1;var g=[],h=[],l=[],n=[],k=a;a=(b-a)/d;for(var p=new m,v=new w,r=0;r<=d;r++){for(var t=0;t<=c;t++){var u=e+t/c*f;p.x=k*Math.cos(u);p.y=k*Math.sin(u);h.push(p.x,p.y,p.z);l.push(0,0,1);v.x=(p.x/b+1)/2;v.y=(p.y/b+1)/2;n.push(v.x,v.y)}k+=a}for(b=0;b<d;b++)for(e=b*(c+1),f=0;f<c;f++)k=f+e,a=k+c+1,p=k+c+2,v=k+1,g.push(k,a,v),g.push(a,p,v);this.setIndex(g);this.setAttribute("position",new C(h,3));this.setAttribute("normal",new C(l,3));this.setAttribute("uv",new C(n,2))}function de(a,b,c,d){J.call(this);this.type="LatheGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};this.fromBufferGeometry(new Xc(a,b,c,d));this.mergeVertices()}function Xc(a,b,c,d){D.call(this);this.type="LatheBufferGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};b=Math.floor(b)||12;c=c||0;d=d||2*Math.PI;d=P.clamp(d,0,2*Math.PI);for(var e=[],f=[],g=[],h=1/b,l=new m,n=new w,k=0;k<=b;k++){var p=c+k*h*d,v=Math.sin(p);p=Math.cos(p);for(var r=0;r<=a.length-1;r++)l.x=a[r].x*v,l.y=a[r].y,l.z=a[r].x*p,f.push(l.x,l.y,l.z),n.x=k/b,n.y=r/(a.length-1),g.push(n.x,n.y)}for(c=0;c<b;c++)for(h=0;h<a.length-1;h++)l=h+c*a.length,n=l+a.length,k=l+a.length+1,v=l+1,e.push(l,n,v),e.push(n,k,v);this.setIndex(e);this.setAttribute("position",new C(f,3));this.setAttribute("uv",new C(g,2));this.computeVertexNormals();if(d===2*Math.PI)for(d=this.attributes.normal.array,e=new m,f=new m,g=new m,b=b*a.length*3,h=c=0;c<a.length;c++,h+=3)e.x=d[h+0],e.y=d[h+1],e.z=d[h+2],f.x=d[b+h+0],f.y=d[b+h+1],f.z=d[b+h+2],g.addVectors(e,f).normalize(),d[h+0]=d[b+h+0]=g.x,d[h+1]=d[b+h+1]=g.y,d[h+2]=d[b+h+2]=g.z}function fc(a,b){J.call(this);this.type="ShapeGeometry";"object"===typeof b&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),b=b.curveSegments);this.parameters={shapes:a,curveSegments:b};this.fromBufferGeometry(new gc(a,b));this.mergeVertices()}function gc(a,b){function c(a){var c=e.length/3,h=a.extractPoints(b);a=h.shape;var n=h.holes;!1===pb.isClockWise(a)&&(a=a.reverse());h=0;for(var k=n.length;h<k;h++){var q=n[h];!0===pb.isClockWise(q)&&(n[h]=q.reverse())}h=pb.triangulateShape(a,n);k=0;for(q=n.length;k<q;k++)a=a.concat(n[k]);n=0;for(k=a.length;n<k;n++)q=a[n],e.push(q.x,q.y,0),f.push(0,0,1),g.push(q.x,q.y);a=0;for(n=h.length;a<n;a++)k=h[a],d.push(k[0]+c,k[1]+c,k[2]+c),l+=3}D.call(this);this.type="ShapeBufferGeometry";this.parameters={shapes:a,curveSegments:b};b=b||12;var d=[],e=[],f=[],g=[],h=0,l=0;if(!1===Array.isArray(a))c(a);else for(var n=0;n<a.length;n++)c(a[n]),this.addGroup(h,l,n),h+=l,l=0;this.setIndex(d);this.setAttribute("position",new C(e,3));this.setAttribute("normal",new C(f,3));this.setAttribute("uv",new C(g,2))}function di(a,b){b.shapes=[];if(Array.isArray(a))for(var c=0,d=a.length;c<d;c++)b.shapes.push(a[c].uuid);else b.shapes.push(a.uuid);return b}function Yc(a,b){D.call(this);this.type="EdgesGeometry";this.parameters={thresholdAngle:b};var c=[];b=Math.cos(P.DEG2RAD*(void 0!==b?b:1));var d=[0,0],e={},f=["a","b","c"];if(a.isBufferGeometry){var g=new J;g.fromBufferGeometry(a)}else g=a.clone();g.mergeVertices();g.computeFaceNormals();a=g.vertices;g=g.faces;for(var h=0,l=g.length;h<l;h++)for(var n=g[h],k=0;3>k;k++){var p=n[f[k]];var m=n[f[(k+1)%3]];d[0]=Math.min(p,m);d[1]=Math.max(p,m);p=d[0]+","+d[1];void 0===e[p]?e[p]={index1:d[0],index2:d[1],face1:h,face2:void 0}:e[p].face2=h}for(p in e)if(d=e[p],void 0===d.face2||g[d.face1].normal.dot(g[d.face2].normal)<=b)f=a[d.index1],c.push(f.x,f.y,f.z),f=a[d.index2],c.push(f.x,f.y,f.z);this.setAttribute("position",new C(c,3))}function hc(a,b,c,d,e,f,g,h){J.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};this.fromBufferGeometry(new qb(a,b,c,d,e,f,g,h));this.mergeVertices()}function qb(a,b,c,d,e,f,g,h){function l(c){var e,f=new w,l=new m,q=0,u=!0===c?a:b,x=!0===c?1:-1;var y=t;for(e=1;e<=d;e++)p.push(0,z*x,0),v.push(0,x,0),r.push(.5,.5),t++;e=t;for(var C=0;C<=d;C++){var D=C/d*h+g,F=Math.cos(D);D=Math.sin(D);l.x=u*D;l.y=z*x;l.z=u*F;p.push(l.x,l.y,l.z);v.push(0,x,0);f.x=.5*F+.5;f.y=.5*D*x+.5;r.push(f.x,f.y);t++}for(f=0;f<d;f++)l=y+f,u=e+f,!0===c?k.push(u,u+1,l):k.push(u+1,u,l),q+=3;n.addGroup(A,q,!0===c?1:2);A+=q}D.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};var n=this;a=void 0!==a?a:1;b=void 0!==b?b:1;c=c||1;d=Math.floor(d)||8;e=Math.floor(e)||1;f=void 0!==f?f:!1;g=void 0!==g?g:0;h=void 0!==h?h:2*Math.PI;var k=[],p=[],v=[],r=[],t=0,u=[],z=c/2,A=0;(function(){for(var f=new m,l=new m,q=0,w=(b-a)/c,B=0;B<=e;B++){for(var y=[],C=B/e,E=C*(b-a)+a,D=0;D<=d;D++){var F=D/d,G=F*h+g,H=Math.sin(G);G=Math.cos(G);l.x=E*H;l.y=-C*c+z;l.z=E*G;p.push(l.x,l.y,l.z);f.set(H,w,G).normalize();v.push(f.x,f.y,f.z);r.push(F,1-C);y.push(t++)}u.push(y)}for(f=0;f<d;f++)for(l=0;l<e;l++)w=u[l+1][f],B=u[l+1][f+1],y=u[l][f+1],k.push(u[l][f],w,y),k.push(w,B,y),q+=6;n.addGroup(A,q,0);A+=q})();!1===f&&(0<a&&l(!0),0<b&&l(!1));this.setIndex(k);this.setAttribute("position",new C(p,3));this.setAttribute("normal",new C(v,3));this.setAttribute("uv",new C(r,2))}function ee(a,b,c,d,e,f,g){hc.call(this,0,a,b,c,d,e,f,g);this.type="ConeGeometry";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,openEnded:e,thetaStart:f,thetaLength:g}}function fe(a,b,c,d,e,f,g){qb.call(this,0,a,b,c,d,e,f,g);this.type="ConeBufferGeometry";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,openEnded:e,thetaStart:f,thetaLength:g}}function ge(a,b,c,d){J.call(this);this.type="CircleGeometry";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};this.fromBufferGeometry(new Zc(a,b,c,d));this.mergeVertices()}function Zc(a,b,c,d){D.call(this);this.type="CircleBufferGeometry";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};a=a||1;b=void 0!==b?Math.max(3,b):8;c=void 0!==c?c:0;d=void 0!==d?d:2*Math.PI;var e=[],f=[],g=[],h=[],l=new m,n=new w;f.push(0,0,0);g.push(0,0,1);h.push(.5,.5);for(var k=0,p=3;k<=b;k++,p+=3){var v=c+k/b*d;l.x=a*Math.cos(v);l.y=a*Math.sin(v);f.push(l.x,l.y,l.z);g.push(0,0,1);n.x=(f[p]/a+1)/2;n.y=(f[p+1]/a+1)/2;h.push(n.x,n.y)}for(a=1;a<=b;a++)e.push(a,a+1,0);this.setIndex(e);this.setAttribute("position",new C(f,3));this.setAttribute("normal",new C(g,3));this.setAttribute("uv",new C(h,2))}function ic(a){K.call(this);this.type="ShadowMaterial";this.color=new H(0);this.transparent=!0;this.setValues(a)}function rb(a){Ba.call(this,a);this.type="RawShaderMaterial"}function gb(a){K.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new H(16777215);this.roughness=1;this.metalness=0;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new H(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new w(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.vertexTangents=this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function Kb(a){gb.call(this);this.defines={STANDARD:"",PHYSICAL:""};this.type="MeshPhysicalMaterial";this.clearcoat=0;this.clearcoatMap=null;this.clearcoatRoughness=0;this.clearcoatRoughnessMap=null;this.clearcoatNormalScale=new w(1,1);this.clearcoatNormalMap=null;this.reflectivity=.5;this.sheen=null;this.transmission=0;this.transmissionMap=null;this.setValues(a)}function Lb(a){K.call(this);this.type="MeshPhongMaterial";this.color=new H(16777215);this.specular=new H(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new H(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new w(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function jc(a){K.call(this);this.defines={TOON:""};this.type="MeshToonMaterial";this.color=new H(16777215);this.lightMap=this.gradientMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new H(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new w(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.alphaMap=null;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function kc(a){K.call(this);this.type="MeshNormalMaterial";this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new w(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.fog=!1;this.setValues(a)}function lc(a){K.call(this);this.type="MeshLambertMaterial";this.color=new H(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new H(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function mc(a){K.call(this);this.defines={MATCAP:""};this.type="MeshMatcapMaterial";this.color=new H(16777215);this.bumpMap=this.map=this.matcap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new w(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.alphaMap=null;this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function nc(a){ia.call(this);this.type="LineDashedMaterial";this.scale=1;this.dashSize=3;this.gapSize=1;this.setValues(a)}function Ka(a,b,c,d){this.parameterPositions=a;this._cachedIndex=0;this.resultBuffer=void 0!==d?d:new b.constructor(c);this.sampleValues=b;this.valueSize=c}function Ve(a,b,c,d){Ka.call(this,a,b,c,d);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function he(a,b,c,d){Ka.call(this,a,b,c,d)}function We(a,b,c,d){Ka.call(this,a,b,c,d)}function ta(a,b,c,d){if(void 0===a)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===b||0===b.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+a);this.name=a;this.times=X.convertArray(b,this.TimeBufferType);this.values=X.convertArray(c,this.ValueBufferType);this.setInterpolation(d||this.DefaultInterpolation)}function Xe(a,b,c){ta.call(this,a,b,c)}function Ye(a,b,c,d){ta.call(this,a,b,c,d)}function $c(a,b,c,d){ta.call(this,a,b,c,d)}function Ze(a,b,c,d){Ka.call(this,a,b,c,d)}function ie(a,b,c,d){ta.call(this,a,b,c,d)}function $e(a,b,c,d){ta.call(this,a,b,c,d)}function ad(a,b,c,d){ta.call(this,a,b,c,d)}function Qa(a,b,c,d){this.name=a;this.tracks=c;this.duration=void 0!==b?b:-1;this.blendMode=void 0!==d?d:2500;this.uuid=P.generateUUID();0>this.duration&&this.resetDuration()}function Hk(a){switch(a.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return $c;case"vector":case"vector2":case"vector3":case"vector4":return ad;case"color":return Ye;case"quaternion":return ie;case"bool":case"boolean":return Xe;case"string":return $e}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+a);}function Ik(a){if(void 0===a.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");var b=Hk(a.type);if(void 0===a.times){var c=[],d=[];X.flattenJSON(a.keys,c,d,"value");a.times=c;a.values=d}return void 0!==b.parse?b.parse(a):new b(a.name,a.times,a.values,a.interpolation)}function tg(a,b,c){var d=this,e=!1,f=0,g=0,h=void 0,l=[];this.onStart=void 0;this.onLoad=a;this.onProgress=b;this.onError=c;this.itemStart=function(a){g++;if(!1===e&&void 0!==d.onStart)d.onStart(a,f,g);e=!0};this.itemEnd=function(a){f++;if(void 0!==d.onProgress)d.onProgress(a,f,g);if(f===g&&(e=!1,void 0!==d.onLoad))d.onLoad()};this.itemError=function(a){if(void 0!==d.onError)d.onError(a)};this.resolveURL=function(a){return h?h(a):a};this.setURLModifier=function(a){h=a;return this};this.addHandler=function(a,b){l.push(a,b);return this};this.removeHandler=function(a){a=l.indexOf(a);-1!==a&&l.splice(a,2);return this};this.getHandler=function(a){for(var b=0,c=l.length;b<c;b+=2){var d=l[b],e=l[b+1];d.global&&(d.lastIndex=0);if(d.test(a))return e}return null}}function U(a){this.manager=void 0!==a?a:ei;this.crossOrigin="anonymous";this.resourcePath=this.path="";this.requestHeader={}}function Ra(a){U.call(this,a)}function ug(a){U.call(this,a)}function vg(a){U.call(this,a)}function af(a){U.call(this,a)}function bd(a){U.call(this,a)}function bf(a){U.call(this,a)}function cf(a){U.call(this,a)}function I(){this.type="Curve";this.arcLengthDivisions=200}function La(a,b,c,d,e,f,g,h){I.call(this);this.type="EllipseCurve";this.aX=a||0;this.aY=b||0;this.xRadius=c||1;this.yRadius=d||1;this.aStartAngle=e||0;this.aEndAngle=f||2*Math.PI;this.aClockwise=g||!1;this.aRotation=h||0}function cd(a,b,c,d,e,f){La.call(this,a,b,c,c,d,e,f);this.type="ArcCurve"}function wg(){var a=0,b=0,c=0,d=0;return{initCatmullRom:function(e,f,g,h,l){e=l*(g-e);h=l*(h-f);a=f;b=e;c=-3*f+3*g-2*e-h;d=2*f-2*g+e+h},initNonuniformCatmullRom:function(e,f,g,h,l,n,k){e=((f-e)/l-(g-e)/(l+n)+(g-f)/n)*n;h=((g-f)/n-(h-f)/(n+k)+(h-g)/k)*n;a=f;b=e;c=-3*f+3*g-2*e-h;d=2*f-2*g+e+h},calc:function(e){var f=e*e;return a+b*e+c*f+d*f*e}}}function ua(a,b,c,d){I.call(this);this.type="CatmullRomCurve3";this.points=a||[];this.closed=b||!1;this.curveType=c||"centripetal";this.tension=void 0!==d?d:.5}function fi(a,b,c,d,e){b=.5*(d-b);e=.5*(e-c);var f=a*a;return(2*c-2*d+b+e)*a*f+(-3*c+3*d-2*b-e)*f+b*a+c}function je(a,b,c,d){var e=1-a;return e*e*b+2*(1-a)*a*c+a*a*d}function ke(a,b,c,d,e){var f=1-a,g=1-a;return f*f*f*b+3*g*g*a*c+3*(1-a)*a*a*d+a*a*a*e}function Xa(a,b,c,d){I.call(this);this.type="CubicBezierCurve";this.v0=a||new w;this.v1=b||new w;this.v2=c||new w;this.v3=d||new w}function hb(a,b,c,d){I.call(this);this.type="CubicBezierCurve3";this.v0=a||new m;this.v1=b||new m;this.v2=c||new m;this.v3=d||new m}function va(a,b){I.call(this);this.type="LineCurve";this.v1=a||new w;this.v2=b||new w}function Ya(a,b){I.call(this);this.type="LineCurve3";this.v1=a||new m;this.v2=b||new m}function Za(a,b,c){I.call(this);this.type="QuadraticBezierCurve";this.v0=a||new w;this.v1=b||new w;this.v2=c||new w}function ib(a,b,c){I.call(this);this.type="QuadraticBezierCurve3";this.v0=a||new m;this.v1=b||new m;this.v2=c||new m}function $a(a){I.call(this);this.type="SplineCurve";this.points=a||[]}function sb(){I.call(this);this.type="CurvePath";this.curves=[];this.autoClose=!1}function ab(a){sb.call(this);this.type="Path";this.currentPoint=new w;a&&this.setFromPoints(a)}function Mb(a){ab.call(this,a);this.uuid=P.generateUUID();this.type="Shape";this.holes=[]}function aa(a,b){y.call(this);this.type="Light";this.color=new H(a);this.intensity=void 0!==b?b:1;this.receiveShadow=void 0}function df(a,b,c){aa.call(this,a,c);this.type="HemisphereLight";this.castShadow=void 0;this.position.copy(y.DefaultUp);this.updateMatrix();this.groundColor=new H(b)}function jb(a){this.camera=a;this.normalBias=this.bias=0;this.radius=1;this.mapSize=new w(512,512);this.mapPass=this.map=null;this.matrix=new T;this.autoUpdate=!0;this.needsUpdate=!1;this._frustum=new Ec;this._frameExtents=new w(1,1);this._viewportCount=1;this._viewports=[new ba(0,0,1,1)]}function ef(){jb.call(this,new ma(50,1,.5,500))}function ff(a,b,c,d,e,f){aa.call(this,a,b);this.type="SpotLight";this.position.copy(y.DefaultUp);this.updateMatrix();this.target=new y;Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(a){this.intensity=a/Math.PI}});this.distance=void 0!==c?c:0;this.angle=void 0!==d?d:Math.PI/3;this.penumbra=void 0!==e?e:0;this.decay=void 0!==f?f:1;this.shadow=new ef}function xg(){jb.call(this,new ma(90,1,.5,500));this._frameExtents=new w(4,2);this._viewportCount=6;this._viewports=[new ba(2,1,1,1),new ba(0,1,1,1),new ba(3,1,1,1),new ba(1,1,1,1),new ba(3,0,1,1),new ba(1,0,1,1)];this._cubeDirections=[new m(1,0,0),new m(-1,0,0),new m(0,0,1),new m(0,0,-1),new m(0,1,0),new m(0,-1,0)];this._cubeUps=[new m(0,1,0),new m(0,1,0),new m(0,1,0),new m(0,1,0),new m(0,0,1),new m(0,0,-1)]}function gf(a,b,c,d){aa.call(this,a,b);this.type="PointLight";Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(a){this.intensity=a/(4*Math.PI)}});this.distance=void 0!==c?c:0;this.decay=void 0!==d?d:1;this.shadow=new xg}function dd(a,b,c,d,e,f){eb.call(this);this.type="OrthographicCamera";this.zoom=1;this.view=null;this.left=void 0!==a?a:-1;this.right=void 0!==b?b:1;this.top=void 0!==c?c:1;this.bottom=void 0!==d?d:-1;this.near=void 0!==e?e:.1;this.far=void 0!==f?f:2E3;this.updateProjectionMatrix()}function hf(){jb.call(this,new dd(-5,5,5,-5,.5,500))}function jf(a,b){aa.call(this,a,b);this.type="DirectionalLight";this.position.copy(y.DefaultUp);this.updateMatrix();this.target=new y;this.shadow=new hf}function kf(a,b){aa.call(this,a,b);this.type="AmbientLight";this.castShadow=void 0}function lf(a,b,c,d){aa.call(this,a,b);this.type="RectAreaLight";this.width=void 0!==c?c:10;this.height=void 0!==d?d:10}function mf(){this.coefficients=[];for(var a=0;9>a;a++)this.coefficients.push(new m)}function Sa(a,b){aa.call(this,void 0,b);this.type="LightProbe";this.sh=void 0!==a?a:new mf}function nf(a){U.call(this,a);this.textures={}}function le(){D.call(this);this.type="InstancedBufferGeometry";this.instanceCount=Infinity}function of(a,b,c,d){"number"===typeof c&&(d=c,c=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument."));F.call(this,a,b,c);this.meshPerAttribute=d||1}function pf(a){U.call(this,a)}function qf(a){U.call(this,a)}function yg(a){"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported.");"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported.");U.call(this,a);this.options={premultiplyAlpha:"none"}}function zg(){this.type="ShapePath";this.color=new H;this.subPaths=[];this.currentPath=null}function Ag(a){this.type="Font";this.data=a}function Bg(a){U.call(this,a)}function rf(a){U.call(this,a)}function Cg(a,b,c){Sa.call(this,void 0,c);a=(new H).set(a);c=(new H).set(b);b=new m(a.r,a.g,a.b);a=new m(c.r,c.g,c.b);c=Math.sqrt(Math.PI);var d=c*Math.sqrt(.75);this.sh.coefficients[0].copy(b).add(a).multiplyScalar(c);this.sh.coefficients[1].copy(b).sub(a).multiplyScalar(d)}
function Dg(a,b){Sa.call(this,void 0,b);a=(new H).set(a);this.sh.coefficients[0].set(a.r,a.g,a.b).multiplyScalar(2*Math.sqrt(Math.PI))}function gi(){this.type="StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new ma;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new ma;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=!1;this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Eg(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1}function Fg(){y.call(this);this.type="AudioListener";this.context=Gg.getContext();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null;this.timeDelta=0;this._clock=new Eg}function ed(a){y.call(this);this.type="Audio";this.listener=a;this.context=a.context;this.gain=this.context.createGain();this.gain.connect(a.getInput());this.autoplay=!1;this.buffer=null;this.detune=0;this.loop=!1;this.offset=this.loopEnd=this.loopStart=0;this.duration=void 0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType="empty";this._progress=this._startedAt=0;this.filters=[]}function Hg(a){ed.call(this,a);this.panner=this.context.createPanner();this.panner.panningModel="HRTF";this.panner.connect(this.gain)}function Ig(a,b){this.analyser=a.context.createAnalyser();this.analyser.fftSize=void 0!==b?b:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);a.getOutput().connect(this.analyser)}
function Jg(a,b,c){this.binding=a;this.valueSize=c;switch(b){case"quaternion":a=this._slerp;b=this._slerpAdditive;var d=this._setAdditiveIdentityQuaternion;this.buffer=new Float64Array(6*c);this._workIndex=5;break;case"string":case"bool":b=a=this._select;d=this._setAdditiveIdentityOther;this.buffer=Array(5*c);break;default:a=this._lerp,b=this._lerpAdditive,d=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*c)}this._mixBufferRegion=a;this._mixBufferRegionAdditive=b;this._setIdentity=d;this._origIndex=3;this._addIndex=4;this.referenceCount=this.useCount=this.cumulativeWeightAdditive=this.cumulativeWeight=0}function hi(a,b,c){c=c||pa.parseTrackName(b);this._targetGroup=a;this._bindings=a.subscribe_(b,c)}function pa(a,b,c){this.path=b;this.parsedPath=c||pa.parseTrackName(b);this.node=pa.findNode(a,this.parsedPath.nodeName)||a;this.rootNode=a}function ii(){this.uuid=P.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var a={};this._indicesByUUID=a;for(var b=0,c=arguments.length;b!==c;++b)a[arguments[b].uuid]=b;this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var d=this;this.stats={objects:{get total(){return d._objects.length},get inUse(){return this.total-d.nCachedObjects_}},get bindingsPerObject(){return d._bindings.length}}}function ji(a,b,c,d){this._mixer=a;this._clip=b;this._localRoot=c||null;this.blendMode=d||b.blendMode;a=b.tracks;b=a.length;c=Array(b);d={endingStart:2400,endingEnd:2400};for(var e=0;e!==b;++e){var f=a[e].createInterpolant(null);c[e]=f;f.settings=d}this._interpolantSettings=d;this._interpolants=c;this._propertyBindings=Array(b);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=2201;this._loopCount=-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function Kg(a){this._root=a;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1}function sf(a,b){"string"===typeof a&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),a=b);this.value=a}function Lg(a,b,c){Ia.call(this,a,b);this.meshPerAttribute=c||1}function Mg(a,b,c,d){this.ray=new Vb(a,b);this.near=c||0;this.far=d||Infinity;this.camera=null;this.layers=new Ce;this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})}function ki(a,b){return a.distance-b.distance}function Ng(a,b,c,d){a.layers.test(b.layers)&&a.raycast(b,c);if(!0===d){a=a.children;d=0;for(var e=a.length;d<e;d++)Ng(a[d],b,c,!0)}}function li(a,b,c){this.radius=void 0!==a?a:1;this.phi=void 0!==b?b:0;this.theta=void 0!==c?c:0;return this}function mi(a,b,c){this.radius=void 0!==a?a:1;this.theta=void 0!==b?b:0;this.y=void 0!==c?c:0;return this}function Og(a,b){this.min=void 0!==a?a:new w(Infinity,Infinity);this.max=void 0!==b?b:new w(-Infinity,-Infinity)}function Pg(a,b){this.start=void 0!==a?a:new m;this.end=void 0!==b?b:new m}function me(a){y.call(this);this.material=a;this.render=function(){};this.hasUvs=this.hasColors=this.hasNormals=this.hasPositions=!1;this.uvArray=this.colorArray=this.normalArray=this.positionArray=null;this.count=0}function fd(a,b){y.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.color=b;a=new D;b=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var c=0,d=1;32>c;c++,d++){var e=c/32*Math.PI*2,f=d/32*Math.PI*2;b.push(Math.cos(e),Math.sin(e),1,Math.cos(f),Math.sin(f),1)}a.setAttribute("position",new C(b,3));b=new ia({fog:!1,toneMapped:!1});this.cone=new da(a,b);this.add(this.cone);this.update()}function ni(a){var b=[];a&&a.isBone&&b.push(a);for(var c=0;c<a.children.length;c++)b.push.apply(b,ni(a.children[c]));return b}function oc(a){for(var b=ni(a),c=new D,d=[],e=[],f=new H(0,0,1),g=new H(0,1,0),h=0;h<b.length;h++){var l=b[h];l.parent&&l.parent.isBone&&(d.push(0,0,0),d.push(0,0,0),e.push(f.r,f.g,f.b),e.push(g.r,g.g,g.b))}c.setAttribute("position",new C(d,3));c.setAttribute("color",new C(e,3));d=new ia({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});da.call(this,c,d);this.type="SkeletonHelper";this.root=a;this.bones=b;this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1}function gd(a,b,c){this.light=a;this.light.updateMatrixWorld();this.color=c;a=new ec(b,4,2);b=new Na({wireframe:!0,fog:!1,toneMapped:!1});Z.call(this,a,b);this.type="PointLightHelper";this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1;this.update()}function hd(a,b,c){y.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.color=c;a=new bc(b);a.rotateY(.5*Math.PI);this.material=new Na({wireframe:!0,fog:!1,toneMapped:!1});void 0===this.color&&(this.material.vertexColors=!0);b=a.getAttribute("position");b=new Float32Array(3*b.count);a.setAttribute("color",new F(b,3));this.add(new Z(a,this.material));this.update()}function tf(a,b,c,d){a=a||10;b=b||10;c=new H(void 0!==c?c:4473924);d=new H(void 0!==d?d:8947848);var e=b/2,f=a/b,g=a/2;a=[];for(var h=[],l=0,n=0,k=-g;l<=b;l++,k+=f){a.push(-g,0,k,g,0,k);a.push(k,0,-g,k,0,g);var p=l===e?c:d;p.toArray(h,n);n+=3;p.toArray(h,n);n+=3;p.toArray(h,n);n+=3;p.toArray(h,n);n+=3}b=new D;b.setAttribute("position",new C(a,3));b.setAttribute("color",new C(h,3));c=new ia({vertexColors:!0,toneMapped:!1});da.call(this,b,c);this.type="GridHelper"}function uf(a,b,c,d,e,f){a=a||10;b=b||16;c=c||8;d=d||64;e=new H(void 0!==e?e:4473924);f=new H(void 0!==f?f:8947848);for(var g=[],h=[],l=0;l<=b;l++){var n=l/b*2*Math.PI,k=Math.sin(n)*a;n=Math.cos(n)*a;g.push(0,0,0);g.push(k,0,n);k=l&1?e:f;h.push(k.r,k.g,k.b);h.push(k.r,k.g,k.b)}for(b=0;b<=c;b++)for(l=b&1?e:f,k=a-a/c*b,n=0;n<d;n++){var p=n/d*2*Math.PI,m=Math.sin(p)*k;p=Math.cos(p)*k;g.push(m,0,p);h.push(l.r,l.g,l.b);p=(n+1)/d*2*Math.PI;m=Math.sin(p)*k;p=Math.cos(p)*k;g.push(m,0,p);h.push(l.r,l.g,l.b)}a=new D;a.setAttribute("position",new C(g,3));a.setAttribute("color",new C(h,3));g=new ia({vertexColors:!0,toneMapped:!1});da.call(this,a,g);this.type="PolarGridHelper"}function id(a,b,c){y.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.color=c;void 0===b&&(b=1);a=new D;a.setAttribute("position",new C([-b,b,0,b,b,0,b,-b,0,-b,-b,0,-b,b,0],3));b=new ia({fog:!1,toneMapped:!1});this.lightPlane=new Ja(a,b);this.add(this.lightPlane);a=new D;a.setAttribute("position",new C([0,0,0,0,0,1],3));this.targetLine=new Ja(a,b);this.add(this.targetLine);this.update()}function ne(a){function b(a,b,d){c(a,d);c(b,d)}function c(a,b){f.push(0,0,0);g.push(b.r,b.g,b.b);void 0===h[a]&&(h[a]=[]);h[a].push(f.length/3-1)}var d=new D,e=new ia({color:16777215,vertexColors:!0,toneMapped:!1}),f=[],g=[],h={},l=new H(16755200),n=new H(16711680),k=new H(43775),p=new H(16777215),m=new H(3355443);b("n1","n2",l);b("n2","n4",l);b("n4","n3",l);b("n3","n1",l);b("f1","f2",l);b("f2","f4",l);b("f4","f3",l);b("f3","f1",l);b("n1","f1",l);b("n2","f2",l);b("n3","f3",l);b("n4","f4",l);b("p","n1",n);b("p","n2",n);b("p","n3",n);b("p","n4",n);b("u1","u2",k);b("u2","u3",k);b("u3","u1",k);b("c","t",p);b("p","c",m);b("cn1","cn2",m);b("cn3","cn4",m);b("cf1","cf2",m);b("cf3","cf4",m);d.setAttribute("position",new C(f,3));d.setAttribute("color",new C(g,3));da.call(this,d,e);this.type="CameraHelper";this.camera=a;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=h;this.update()}function R(a,b,c,d,e,f,g){vf.set(e,f,g).unproject(d);a=b[a];if(void 0!==a)for(c=c.getAttribute("position"),b=0,d=a.length;b<d;b++)c.setXYZ(a[b],vf.x,vf.y,vf.z)}function tb(a,b){this.object=a;void 0===b&&(b=16776960);a=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var c=new Float32Array(24),d=new D;d.setIndex(new F(a,1));d.setAttribute("position",new F(c,3));da.call(this,d,new ia({color:b,toneMapped:!1}));this.type="BoxHelper";this.matrixAutoUpdate=!1;this.update()}function oe(a,b){this.type="Box3Helper";this.box=a;void 0===b&&(b=16776960);a=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var c=new D;c.setIndex(new F(a,1));c.setAttribute("position",new C([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3));da.call(this,c,new ia({color:b,toneMapped:!1}));this.type="Box3Helper";this.geometry.computeBoundingSphere()}
function pe(a,b,c){this.plane=a;this.size=void 0===b?1:b;a=void 0!==c?c:16776960;b=new D;b.setAttribute("position",new C([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3));b.computeBoundingSphere();Ja.call(this,b,new ia({color:a,toneMapped:!1}));this.type="PlaneHelper";b=new D;b.setAttribute("position",new C([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3));b.computeBoundingSphere();this.add(new Z(b,new Na({color:a,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}function ub(a,b,c,d,e,f){y.call(this);this.type="ArrowHelper";void 0===a&&(a=new m(0,0,1));void 0===b&&(b=new m(0,0,0));void 0===c&&(c=1);void 0===d&&(d=16776960);void 0===e&&(e=.2*c);void 0===f&&(f=.2*e);void 0===wf&&(wf=new D,wf.setAttribute("position",new C([0,0,0,0,1,0],3)),Qg=new qb(0,.5,1,5,1),Qg.translate(0,-.5,0));this.position.copy(b);this.line=new Ja(wf,new ia({color:d,toneMapped:!1}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new Z(Qg,new Na({color:d,toneMapped:!1}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(a);this.setLength(c,e,f)}function qe(a){a=a||1;var b=[0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a];a=new D;a.setAttribute("position",new C(b,3));a.setAttribute("color",new C([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));b=new ia({vertexColors:!0,toneMapped:!1});da.call(this,a,b);this.type="AxesHelper"}function Rg(a){this._renderer=a;this._pingPongRenderTarget=null;a=new Float32Array(20);var b=new m(0,1,0);this._blurMaterial=new rb({name:"SphericalGaussianBlur",defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:a},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:b},inputEncoding:{value:kb[3E3]},outputEncoding:{value:kb[3E3]}},vertexShader:Sg(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t"+
Tg()+"\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});this._cubemapShader=this._equirectShader=null;this._compileMaterial(this._blurMaterial)}function oi(a){a=new Ea(3*lb,3*lb,a);a.texture.mapping=306;a.texture.name="PMREM.cubeUv";a.scissorTest=!0;return a}function xf(a,b,c,d,e){a.viewport.set(b,c,d,e);a.scissor.set(b,c,d,e)}function pi(){var a=new w(1,1);return new rb({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:a},inputEncoding:{value:kb[3E3]},outputEncoding:{value:kb[3E3]}},vertexShader:Sg(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t"+Tg()+"\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function qi(){return new rb({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:kb[3E3]},outputEncoding:{value:kb[3E3]}},vertexShader:Sg(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t"+Tg()+"\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Sg(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}
function Tg(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}
function ri(a){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");ua.call(this,a);this.type="catmullrom";this.closed=!0}function si(a){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");ua.call(this,a);this.type="catmullrom"}function Ug(a){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead.");ua.call(this,a);this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Number.isInteger&&(Number.isInteger=function(a){return"number"===typeof a&&isFinite(a)&&Math.floor(a)===a});void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});!1==="name"in Function.prototype&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}});void 0===Object.assign&&(Object.assign=function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(void 0!==d&&null!==d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(b[e]=d[e])}return b});Object.assign(ra.prototype,{addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)},removeEventListener:function(a,b){void 0!==this._listeners&&(a=this._listeners[a],void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1)))},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;b=b.slice(0);for(var c=0,d=b.length;c<d;c++)b[c].call(this,a)}}}});for(var qa=[],re=0;256>re;re++)qa[re]=(16>re?"0":"")+re.toString(16);var yf=1234567,P={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var a=4294967295*Math.random()|0,b=4294967295*Math.random()|0,c=4294967295*Math.random()|0,d=4294967295*Math.random()|0;return(qa[a&255]+qa[a>>8&255]+qa[a>>16&255]+qa[a>>24&255]+"-"+qa[b&255]+qa[b>>8&255]+"-"+qa[b>>16&15|64]+qa[b>>24&255]+"-"+qa[c&63|128]+qa[c>>8&255]+"-"+qa[c>>16&255]+qa[c>>24&255]+qa[d&255]+qa[d>>8&255]+qa[d>>16&255]+qa[d>>24&255]).toUpperCase()},clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},euclideanModulo:function(a,b){return(a%b+b)%b},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},lerp:function(a,b,c){return(1-c)*a+c*b},smoothstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},seededRandom:function(a){void 0!==a&&(yf=a%2147483647);yf=16807*yf%2147483647;return(yf-1)/2147483646},degToRad:function(a){return a*P.DEG2RAD},radToDeg:function(a){return a*P.RAD2DEG},isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},ceilPowerOfTwo:function(a){return Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},floorPowerOfTwo:function(a){return Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},setQuaternionFromProperEuler:function(a,b,c,d,e){var f=Math.cos,g=Math.sin,h=f(c/2);c=g(c/2);var l=f((b+d)/2),n=g((b+d)/2),k=f((b-d)/2),p=g((b-d)/2);f=f((d-b)/2);b=g((d-b)/2);switch(e){case"XYX":a.set(h*n,c*k,c*p,h*l);break;case"YZY":a.set(c*p,h*n,c*k,h*l);break;case"ZXZ":a.set(c*k,c*p,h*n,h*l);break;case"XZX":a.set(h*n,c*b,c*f,h*l);break;case"YXY":a.set(c*f,h*n,c*b,h*l);break;case"ZYZ":a.set(c*b,c*f,h*n,h*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+e)}}};Object.defineProperties(w.prototype,{width:{get:function(){return this.x},set:function(a){this.x=a}},height:{get:function(){return this.y},set:function(a){this.y=a}}});Object.assign(w.prototype,{isVector2:!0,set:function(a,b){this.x=a;this.y=b;return this},setScalar:function(a){this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},applyMatrix3:function(a){var b=this.x,c=this.y;a=a.elements;this.x=a[0]*b+a[3]*c+a[6];this.y=a[1]*b+a[4]*c+a[7];return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this},clampScalar:function(a,b){this.x=Math.max(a,Math.min(b,this.x));this.y=Math.max(a,Math.min(b,this.y));return this},clampLength:function(a,b){var c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(a,Math.min(b,c)))},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},cross:function(a){return this.x*a.y-this.y*a.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x;a=this.y-
a.y;return b*b+a*a},manhattanDistanceTo:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)},setLength:function(a){return this.normalize().multiplyScalar(a)},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){this.x=a.x+(b.x-a.x)*c;this.y=a.y+(b.y-a.y)*c;return this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromBufferAttribute:function(a,b,c){void 0!==c&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute().");this.x=a.getX(b);this.y=a.getY(b);return this},rotateAround:function(a,b){var c=Math.cos(b);b=Math.sin(b);var d=this.x-a.x,e=this.y-a.y;this.x=d*c-e*b+a.x;this.y=d*b+e*c+a.y;return this},random:function(){this.x=Math.random();this.y=Math.random();return this}});Object.assign(za.prototype,{isMatrix3:!0,set:function(a,b,c,d,e,f,g,h,l){var n=this.elements;n[0]=a;n[1]=d;n[2]=g;n[3]=b;n[4]=e;n[5]=h;n[6]=c;n[7]=f;n[8]=l;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return this},extractBasis:function(a,b,c){a.setFromMatrix3Column(this,0);b.setFromMatrix3Column(this,1);c.setFromMatrix3Column(this,2);return this},setFromMatrix4:function(a){a=a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]);return this},multiply:function(a){return this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements;b=this.elements;a=c[0];var e=c[3],f=c[6],g=c[1],h=c[4],l=c[7],n=c[2],k=c[5];c=c[8];var p=d[0],m=d[3],r=d[6],t=d[1],u=d[4],z=d[7],A=d[2],x=d[5];d=d[8];b[0]=a*p+e*t+f*A;b[3]=a*m+e*u+f*x;b[6]=a*r+e*z+f*d;b[1]=g*p+h*t+l*A;b[4]=g*m+h*u+l*x;b[7]=g*r+h*z+l*d;b[2]=n*p+k*t+c*A;b[5]=n*m+k*u+c*x;b[8]=n*r+k*z+c*d;return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],l=a[7];a=a[8];return b*f*a-b*g*l-c*e*a+c*g*h+d*e*l-d*f*h},getInverse:function(a,b){void 0!==b&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var c=a.elements;a=this.elements;b=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],l=c[6],n=c[7];c=c[8];var k=c*g-h*n,p=h*l-c*f,m=n*f-g*l,r=b*k+d*p+e*m;if(0===r)return this.set(0,0,0,0,0,0,0,0,0);r=1/r;a[0]=k*r;a[1]=(e*n-c*d)*r;a[2]=(h*d-e*g)*r;a[3]=p*r;a[4]=(c*b-e*l)*r;a[5]=(e*f-h*b)*r;a[6]=m*r;a[7]=(d*l-n*b)*r;a[8]=(g*b-d*f)*r;return this},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},getNormalMatrix:function(a){return this.setFromMatrix4(a).getInverse(this).transpose()},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},setUvTransform:function(a,b,c,d,e,f,g){var h=Math.cos(e);e=Math.sin(e);this.set(c*h,c*e,-c*(h*f+e*g)+f+a,-d*e,d*h,-d*(-e*f+h*g)+g+b,0,0,1)},scale:function(a,b){var c=this.elements;c[0]*=a;c[3]*=a;c[6]*=a;c[1]*=b;c[4]*=b;c[7]*=b;return this},rotate:function(a){var b=Math.cos(a);a=Math.sin(a);var c=this.elements,d=c[0],e=c[3],f=c[6],g=c[1],h=c[4],l=c[7];c[0]=b*d+a*g;c[3]=b*e+a*h;c[6]=b*f+a*l;c[1]=-a*d+b*g;c[4]=-a*e+b*h;c[7]=-a*f+b*l;return this},translate:function(a,b){var c=this.elements;c[0]+=a*c[2];c[3]+=a*c[5];c[6]+=a*c[8];c[1]+=b*c[2];c[4]+=b*c[5];c[7]+=b*c[8];return this},equals:function(a){var b=this.elements;a=a.elements;for(var c=0;9>c;c++)if(b[c]!==a[c])return!1;return!0},fromArray:function(a,b){void 0===b&&(b=0);for(var c=0;9>c;c++)this.elements[c]=a[c+b];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a}});var jd,Nb={getDataURL:function(a){if(/^data:/i.test(a.src)||"undefined"==typeof HTMLCanvasElement)return a.src;if(!(a instanceof HTMLCanvasElement)){void 0===jd&&(jd=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"));jd.width=a.width;jd.height=a.height;var b=jd.getContext("2d");a instanceof ImageData?b.putImageData(a,0,0):b.drawImage(a,0,0,a.width,a.height);a=jd}return 2048<a.width||2048<a.height?a.toDataURL("image/jpeg",.6):a.toDataURL("image/png")}},ej=0;V.DEFAULT_IMAGE=void 0;V.DEFAULT_MAPPING=300;V.prototype=Object.assign(Object.create(ra.prototype),{constructor:V,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name;this.image=a.image;this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.internalFormat=a.internalFormat;this.type=a.type;this.offset.copy(a.offset);this.repeat.copy(a.repeat);this.center.copy(a.center);this.rotation=a.rotation;this.matrixAutoUpdate=a.matrixAutoUpdate;this.matrix.copy(a.matrix);this.generateMipmaps=a.generateMipmaps;this.premultiplyAlpha=a.premultiplyAlpha;this.flipY=a.flipY;this.unpackAlignment=a.unpackAlignment;this.encoding=a.encoding;return this},toJSON:function(a){var b=void 0===a||"string"===typeof a;if(!b&&void 0!==a.textures[this.uuid])return a.textures[this.uuid];var c={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var d=this.image;void 0===d.uuid&&(d.uuid=P.generateUUID());if(!b&&void 0===a.images[d.uuid]){if(Array.isArray(d)){var e=[];for(var f=0,g=d.length;f<g;f++)e.push(Nb.getDataURL(d[f]))}else e=Nb.getDataURL(d);a.images[d.uuid]={uuid:d.uuid,url:e}}c.image=d.uuid}b||(a.textures[this.uuid]=c);return c},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(a){if(300!==this.mapping)return a;a.applyMatrix3(this.matrix);if(0>a.x||1<a.x)switch(this.wrapS){case 1E3:a.x-=Math.floor(a.x);break;case 1001:a.x=0>a.x?0:1;break;case 1002:a.x=1===Math.abs(Math.floor(a.x)%2)?Math.ceil(a.x)-a.x:a.x-Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapT){case 1E3:a.y-=Math.floor(a.y);break;case 1001:a.y=0>a.y?0:1;break;case 1002:a.y=1===Math.abs(Math.floor(a.y)%2)?Math.ceil(a.y)-
a.y:a.y-Math.floor(a.y)}this.flipY&&(a.y=1-a.y);return a}});Object.defineProperty(V.prototype,"needsUpdate",{set:function(a){!0===a&&this.version++}});Object.defineProperties(ba.prototype,{width:{get:function(){return this.z},set:function(a){this.z=a}},height:{get:function(){return this.w},set:function(a){this.w=a}}});Object.assign(ba.prototype,{isVector4:!0,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setScalar:function(a){this.w=this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a);}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;this.w+=a.w*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e;this.z=a[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){a=a.elements;var b=a[0];var c=a[4];var d=a[8],e=a[1],f=a[5],g=a[9];var h=a[2];var l=a[6];var n=a[10];if(.01>Math.abs(c-e)&&.01>Math.abs(d-h)&&.01>Math.abs(g-l)){if(.1>Math.abs(c+e)&&.1>Math.abs(d+h)&&.1>Math.abs(g+l)&&.1>Math.abs(b+f+n-3))return this.set(1,0,0,0),this;a=Math.PI;b=(b+1)/2;f=(f+1)/2;n=(n+1)/2;c=(c+e)/4;d=(d+h)/4;g=(g+l)/4;b>f&&b>n?.01>b?(l=0,c=h=.707106781):(l=Math.sqrt(b),h=c/l,c=d/l):f>n?.01>f?(l=.707106781,h=0,c=.707106781):(h=Math.sqrt(f),l=c/h,c=g/h):.01>n?(h=l=.707106781,c=0):(c=Math.sqrt(n),l=d/c,h=g/c);this.set(l,h,c,a);return this}a=Math.sqrt((l-g)*(l-g)+(d-h)*(d-h)+(e-c)*(e-c));.001>Math.abs(a)&&(a=1);this.x=(l-g)/a;this.y=(d-h)/a;this.z=(e-c)/a;this.w=Math.acos((b+f+n-1)/2);return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));this.w=Math.max(a.w,Math.min(b.w,this.w));return this},clampScalar:function(a,b){this.x=Math.max(a,Math.min(b,this.x));this.y=Math.max(a,Math.min(b,this.y));this.z=Math.max(a,Math.min(b,this.z));this.w=Math.max(a,Math.min(b,this.w));return this},clampLength:function(a,b){var c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(a,Math.min(b,c)))},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(a){return this.normalize().multiplyScalar(a)},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,c){this.x=a.x+(b.x-a.x)*c;this.y=a.y+(b.y-a.y)*c;this.z=a.z+(b.z-a.z)*c;this.w=a.w+(b.w-a.w)*c;return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromBufferAttribute:function(a,b,c){void 0!==c&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute().");this.x=a.getX(b);this.y=a.getY(b);this.z=a.getZ(b);this.w=a.getW(b);return this},random:function(){this.x=Math.random();this.y=Math.random();this.z=Math.random();this.w=Math.random();return this}});Ea.prototype=Object.assign(Object.create(ra.prototype),{constructor:Ea,isWebGLRenderTarget:!0,setSize:function(a,b){if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.texture.image.width=a,this.texture.image.height=b,this.dispose();this.viewport.set(0,0,a,b);this.scissor.set(0,0,a,b)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.width=a.width;this.height=a.height;this.viewport.copy(a.viewport);this.texture=a.texture.clone();this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;this.depthTexture=a.depthTexture;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Zf.prototype=Object.assign(Object.create(Ea.prototype),{constructor:Zf,isWebGLMultisampleRenderTarget:!0,copy:function(a){Ea.prototype.copy.call(this,a);this.samples=a.samples;return this}});Object.assign(S,{slerp:function(a,b,c,d){return c.copy(a).slerp(b,d)},slerpFlat:function(a,b,c,d,e,f,g){var h=c[d+0],l=c[d+1],n=c[d+2];c=c[d+3];d=e[f+0];var k=e[f+1],p=e[f+2];e=e[f+3];if(c!==e||h!==d||l!==k||n!==p){f=1-g;var m=h*d+l*k+n*p+c*e,r=0<=m?1:-1,t=1-m*m;t>Number.EPSILON&&(t=Math.sqrt(t),m=Math.atan2(t,m*r),f=Math.sin(f*m)/t,g=Math.sin(g*m)/t);r*=g;h=h*f+d*r;l=l*f+k*r;n=n*f+p*r;c=c*f+e*r;f===1-g&&(g=1/Math.sqrt(h*h+l*l+n*n+c*c),h*=g,l*=g,n*=g,c*=g)}a[b]=h;a[b+1]=l;a[b+2]=n;a[b+3]=c},multiplyQuaternionsFlat:function(a,b,c,d,e,f){var g=c[d],h=c[d+1],l=c[d+2];c=c[d+3];d=e[f];var n=e[f+1],k=e[f+2];e=e[f+3];a[b]=g*e+c*d+h*k-l*n;a[b+1]=h*e+c*n+l*d-g*k;a[b+2]=l*e+c*k+g*n-h*d;a[b+3]=c*e-g*d-h*n-l*k;return a}});Object.defineProperties(S.prototype,{x:{get:function(){return this._x},set:function(a){this._x=a;this._onChangeCallback()}},y:{get:function(){return this._y},set:function(a){this._y=a;this._onChangeCallback()}},z:{get:function(){return this._z},set:function(a){this._z=a;this._onChangeCallback()}},w:{get:function(){return this._w},set:function(a){this._w=a;this._onChangeCallback()}}});Object.assign(S.prototype,{isQuaternion:!0,set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this._onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;this._w=a.w;this._onChangeCallback();return this},setFromEuler:function(a,b){if(!a||!a.isEuler)throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var c=a._x,d=a._y,e=a._z;a=a.order;var f=Math.cos,g=Math.sin,h=f(c/2),l=f(d/2);f=f(e/2);c=g(c/2);d=g(d/2);e=g(e/2);switch(a){case"XYZ":this._x=c*l*f+h*d*e;this._y=h*d*f-c*l*e;this._z=h*l*e+c*d*f;this._w=h*l*f-c*d*e;break;case"YXZ":this._x=c*l*f+h*d*e;this._y=h*d*f-c*l*e;this._z=h*l*e-c*d*f;this._w=h*l*f+c*d*e;break;case"ZXY":this._x=c*l*f-h*d*e;this._y=h*d*f+c*l*e;this._z=h*l*e+c*d*f;this._w=h*l*f-c*d*e;break;case"ZYX":this._x=c*l*f-h*d*e;this._y=h*d*f+c*l*e;this._z=h*l*e-c*d*f;this._w=h*l*f+c*d*e;break;case"YZX":this._x=c*l*f+h*d*e;this._y=h*d*f+c*l*e;this._z=h*l*e-c*d*f;this._w=h*l*f-c*d*e;break;case"XZY":this._x=c*l*f-h*d*e;this._y=h*d*f-c*l*e;this._z=h*l*e+c*d*f;this._w=h*l*f+c*d*e;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}!1!==b&&this._onChangeCallback();return this},setFromAxisAngle:function(a,b){b/=2;var c=Math.sin(b);this._x=a.x*c;this._y=a.y*c;this._z=a.z*c;this._w=Math.cos(b);this._onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],e=b[1],f=b[5],g=b[9],h=b[2],l=b[6];b=b[10];var n=c+f+b;0<n?(c=.5/Math.sqrt(n+1),this._w=.25/c,this._x=(l-g)*c,this._y=(d-h)*c,this._z=(e-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this._w=(l-g)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+h)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this._w=(d-h)/c,this._x=(a+e)/c,this._y=.25*c,this._z=(g+l)/c):(c=2*Math.sqrt(1+b-c-f),this._w=(e-a)/c,this._x=(d+h)/c,this._y=(g+l)/c,this._z=.25*c);this._onChangeCallback();return this},setFromUnitVectors:function(a,b){var c=a.dot(b)+1;1E-6>c?(c=0,Math.abs(a.x)>Math.abs(a.z)?(this._x=-a.y,this._y=a.x,this._z=0):(this._x=0,this._y=-a.z,this._z=a.y)):(this._x=a.y*b.z-a.z*b.y,this._y=a.z*b.x-a.x*b.z,this._z=a.x*b.y-a.y*b.x);this._w=c;return this.normalize()},angleTo:function(a){return 2*Math.acos(Math.abs(P.clamp(this.dot(a),-1,1)))},rotateTowards:function(a,b){var c=this.angleTo(a);if(0===c)return this;this.slerp(a,Math.min(1,b/c));return this},identity:function(){return this.set(0,0,0,1)},inverse:function(){return this.conjugate()},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this._onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this._onChangeCallback();return this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},premultiply:function(a){return this.multiplyQuaternions(a,this)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z;a=a._w;var f=b._x,g=b._y,h=b._z;b=b._w;this._x=c*b+a*f+d*h-e*g;this._y=d*b+a*g+e*f-c*h;this._z=e*b+a*h+c*g-d*f;this._w=a*b-c*f-d*g-e*h;this._onChangeCallback();return this},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a);if(1<=g)return this._w=f,this._x=c,this._y=d,this._z=e,this;a=1-g*g;if(a<=Number.EPSILON)return g=1-b,this._w=g*f+b*this._w,this._x=g*c+b*this._x,this._y=g*d+b*this._y,this._z=g*e+b*this._z,this.normalize(),this._onChangeCallback(),this;a=Math.sqrt(a);var h=Math.atan2(a,g);g=Math.sin((1-b)*h)/a;b=Math.sin(b*h)/a;this._w=f*g+this._w*b;this._x=c*g+this._x*b;this._y=d*g+this._y*b;this._z=e*g+this._z*b;this._onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this._onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},fromBufferAttribute:function(a,b){this._x=a.getX(b);this._y=a.getY(b);this._z=a.getZ(b);this._w=a.getW(b);return this},_onChange:function(a){this._onChangeCallback=a;return this},_onChangeCallback:function(){}});var Vg=new m,ti=new S;Object.assign(m.prototype,{isVector3:!0,set:function(a,b,c){void 0===c&&(c=this.z);this.x=a;this.y=b;this.z=c;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(a){a&&a.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");return this.applyQuaternion(ti.setFromEuler(a))},applyAxisAngle:function(a,b){return this.applyQuaternion(ti.setFromAxisAngle(a,b))},applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},applyNormalMatrix:function(a){return this.applyMatrix3(a).normalize()},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=a.w;var h=a*b+f*d-g*c,l=a*c+g*b-e*d,n=a*d+e*c-f*b;b=-e*b-f*c-g*d;this.x=h*a+b*-e+l*-g-n*-f;this.y=l*a+b*-f+n*-e-h*-g;this.z=n*a+b*-g+h*-f-l*-e;return this},project:function(a){return this.applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix)},unproject:function(a){return this.applyMatrix4(a.projectionMatrixInverse).applyMatrix4(a.matrixWorld)},transformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;return this.normalize()},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},clampScalar:function(a,b){this.x=Math.max(a,Math.min(b,this.x));this.y=Math.max(a,Math.min(b,this.y));this.z=Math.max(a,Math.min(b,this.z));return this},clampLength:function(a,b){var c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(a,Math.min(b,c)))},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(a){return this.normalize().multiplyScalar(a)},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){this.x=a.x+(b.x-a.x)*c;this.y=a.y+(b.y-a.y)*c;this.z=a.z+(b.z-a.z)*c;return this},cross:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b)):this.crossVectors(this,a)},crossVectors:function(a,b){var c=a.x,d=a.y;a=a.z;var e=b.x,f=b.y;b=b.z;this.x=d*b-a*f;this.y=a*e-c*b;this.z=c*f-d*e;return this},projectOnVector:function(a){var b=a.lengthSq();if(0===b)return this.set(0,0,0);b=a.dot(this)/b;return this.copy(a).multiplyScalar(b)},projectOnPlane:function(a){Vg.copy(this).projectOnVector(a);return this.sub(Vg)},reflect:function(a){return this.sub(Vg.copy(a).multiplyScalar(2*this.dot(a)))},angleTo:function(a){var b=Math.sqrt(this.lengthSq()*a.lengthSq());if(0===b)return Math.PI/2;a=this.dot(a)/b;return Math.acos(P.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},manhattanDistanceTo:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)},setFromSpherical:function(a){return this.setFromSphericalCoords(a.radius,a.phi,a.theta)},setFromSphericalCoords:function(a,b,c){var d=Math.sin(b)*a;this.x=d*Math.sin(c);this.y=Math.cos(b)*a;this.z=d*Math.cos(c);return this},setFromCylindrical:function(a){return this.setFromCylindricalCoords(a.radius,a.theta,a.y)},setFromCylindricalCoords:function(a,b,c){this.x=a*Math.sin(b);this.y=c;this.z=a*Math.cos(b);return this},setFromMatrixPosition:function(a){a=a.elements;this.x=a[12];this.y=a[13];this.z=a[14];return this},setFromMatrixScale:function(a){var b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,1).length();a=this.setFromMatrixColumn(a,2).length();this.x=b;this.y=c;this.z=a;return this},setFromMatrixColumn:function(a,b){return this.fromArray(a.elements,4*b)},setFromMatrix3Column:function(a,b){return this.fromArray(a.elements,3*b)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromBufferAttribute:function(a,b,c){void 0!==c&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute().");this.x=a.getX(b);this.y=a.getY(b);this.z=a.getZ(b);return this},random:function(){this.x=Math.random();this.y=Math.random();this.z=Math.random();return this}});var kd=new m,Y=new T,Jk=new m(0,0,0),Kk=new m(1,1,1),Ob=new m,zf=new m,Ca=new m;Object.assign(T.prototype,{isMatrix4:!0,set:function(a,b,c,d,e,f,g,h,l,n,k,p,m,r,t,u){var q=this.elements;q[0]=a;q[4]=b;q[8]=c;q[12]=d;q[1]=e;q[5]=f;q[9]=g;q[13]=h;q[2]=l;q[6]=n;q[10]=k;q[14]=p;q[3]=m;q[7]=r;q[11]=t;q[15]=u;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new T).fromArray(this.elements)},copy:function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return this},copyPosition:function(a){var b=this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){a.setFromMatrixColumn(this,0);b.setFromMatrixColumn(this,1);c.setFromMatrixColumn(this,2);return this},makeBasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(a){var b=this.elements,c=a.elements,d=1/kd.setFromMatrixColumn(a,0).length(),e=1/kd.setFromMatrixColumn(a,1).length();a=1/kd.setFromMatrixColumn(a,2).length();b[0]=c[0]*d;b[1]=c[1]*d;b[2]=c[2]*d;b[3]=0;b[4]=c[4]*e;b[5]=c[5]*e;b[6]=c[6]*e;b[7]=0;b[8]=c[8]*a;b[9]=c[9]*a;b[10]=c[10]*a;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},makeRotationFromEuler:function(a){a&&a.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c);c=Math.sin(c);var g=Math.cos(d);d=Math.sin(d);var h=Math.cos(e);e=Math.sin(e);if("XYZ"===a.order){a=f*h;var l=f*e,n=c*h,k=c*e;b[0]=g*h;b[4]=-g*e;b[8]=d;b[1]=l+n*d;b[5]=a-k*d;b[9]=-c*g;b[2]=k-a*d;b[6]=n+l*d;b[10]=f*g}else"YXZ"===a.order?(a=g*h,l=g*e,n=d*h,k=d*e,b[0]=a+k*c,b[4]=n*c-l,b[8]=f*d,b[1]=f*e,b[5]=f*h,b[9]=-c,b[2]=l*c-n,b[6]=k+a*c,b[10]=f*g):"ZXY"===a.order?(a=g*h,l=g*e,n=d*h,k=d*e,b[0]=a-k*c,b[4]=-f*e,b[8]=n+l*c,b[1]=l+n*c,b[5]=f*h,b[9]=k-a*c,b[2]=-f*d,b[6]=c,b[10]=f*g):"ZYX"===a.order?(a=f*h,l=f*e,n=c*h,k=c*e,b[0]=g*h,b[4]=n*d-l,b[8]=a*d+k,b[1]=g*e,b[5]=k*d+a,b[9]=l*d-n,b[2]=-d,b[6]=c*g,b[10]=f*g):"YZX"===a.order?(a=f*g,l=f*d,n=c*g,k=c*d,b[0]=g*h,b[4]=k-a*e,b[8]=n*e+l,b[1]=e,b[5]=f*h,b[9]=-c*h,b[2]=-d*h,b[6]=l*e+n,b[10]=a-k*e):"XZY"===a.order&&(a=f*g,l=f*d,n=c*g,k=c*d,b[0]=g*h,b[4]=-e,b[8]=d*h,b[1]=a*e+k,b[5]=f*h,b[9]=l*e-n,b[2]=n*e-l,b[6]=c*h,b[10]=k*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},makeRotationFromQuaternion:function(a){return this.compose(Jk,a,Kk)},lookAt:function(a,b,c){var d=this.elements;Ca.subVectors(a,b);0===Ca.lengthSq()&&(Ca.z=1);Ca.normalize();Ob.crossVectors(c,Ca);0===Ob.lengthSq()&&(1===Math.abs(c.z)?Ca.x+=1E-4:Ca.z+=1E-4,Ca.normalize(),Ob.crossVectors(c,Ca));Ob.normalize();zf.crossVectors(Ca,Ob);d[0]=Ob.x;d[4]=zf.x;d[8]=Ca.x;d[1]=Ob.y;d[5]=zf.y;d[9]=Ca.y;d[2]=Ob.z;d[6]=zf.z;d[10]=Ca.z;return this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements;b=this.elements;a=c[0];var e=c[4],f=c[8],g=c[12],h=c[1],l=c[5],k=c[9],q=c[13],p=c[2],m=c[6],r=c[10],t=c[14],u=c[3],z=c[7],A=c[11];c=c[15];var x=d[0],w=d[4],y=d[8],N=d[12],B=d[1],C=d[5],D=d[9],E=d[13],F=d[2],G=d[6],H=d[10],I=d[14],J=d[3],K=d[7],M=d[11];d=d[15];b[0]=a*x+e*B+f*F+g*J;b[4]=a*w+e*C+f*G+g*K;b[8]=a*y+e*D+f*H+g*M;b[12]=a*N+e*E+f*I+g*d;b[1]=h*x+l*B+k*F+q*J;b[5]=h*w+
l*C+k*G+q*K;b[9]=h*y+l*D+k*H+q*M;b[13]=h*N+l*E+k*I+q*d;b[2]=p*x+m*B+r*F+t*J;b[6]=p*w+m*C+r*G+t*K;b[10]=p*y+m*D+r*H+t*M;b[14]=p*N+m*E+r*I+t*d;b[3]=u*x+z*B+A*F+c*J;b[7]=u*w+z*C+A*G+c*K;b[11]=u*y+z*D+A*H+c*M;b[15]=u*N+z*E+A*I+c*d;return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],l=a[13],k=a[2],q=a[6],p=a[10],m=a[14];return a[3]*(+e*h*q-d*l*q-e*g*p+c*l*p+d*g*m-c*h*m)+a[7]*(+b*h*m-b*l*p+e*f*p-d*f*m+d*l*k-e*h*k)+a[11]*(+b*l*q-b*g*m-e*f*q+c*f*m+e*g*k-c*l*k)+a[15]*(-d*g*k-b*h*q+b*g*p+d*f*q-c*f*p+c*h*k)},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},setPosition:function(a,b,c){var d=this.elements;a.isVector3?(d[12]=a.x,d[13]=a.y,d[14]=a.z):(d[12]=a,d[13]=b,d[14]=c);return this},getInverse:function(a,b){void 0!==b&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");b=this.elements;var c=a.elements;a=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],l=c[6],k=c[7],q=c[8],p=c[9],m=c[10],r=c[11],t=c[12],u=c[13],z=c[14];c=c[15];var A=p*z*k-u*m*k+u*l*r-h*z*r-p*l*c+h*m*c,x=t*m*k-q*z*k-t*l*r+g*z*r+q*l*c-g*m*c,w=q*u*k-t*p*k+t*h*r-g*u*r-q*h*c+g*p*c,y=t*p*l-q*u*l-t*h*m+g*u*m+q*h*z-g*p*z,N=a*A+d*x+e*w+f*y;if(0===N)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);N=1/N;b[0]=A*N;b[1]=(u*m*f-p*z*f-u*e*r+d*z*r+p*e*c-d*m*c)*N;b[2]=(h*z*f-u*l*f+u*e*k-d*z*k-h*e*c+d*l*c)*N;b[3]=(p*l*f-h*m*f-p*e*k+d*m*k+h*e*r-d*l*r)*N;b[4]=x*N;b[5]=(q*z*f-t*m*f+t*e*r-a*z*r-q*e*c+a*m*c)*N;b[6]=(t*l*f-g*z*f-t*e*k+a*z*k+g*e*c-a*l*c)*N;b[7]=(g*m*f-q*l*f+q*e*k-a*m*k-g*e*r+a*l*r)*N;b[8]=w*N;b[9]=(t*p*f-q*u*f-t*d*r+a*u*r+q*d*c-a*p*c)*N;b[10]=(g*u*f-t*h*f+t*d*k-a*u*k-g*d*c+a*h*c)*N;b[11]=(q*h*f-g*p*f-q*d*k+a*p*k+g*d*r-a*h*r)*N;b[12]=y*N;b[13]=(q*u*e-t*p*e+t*d*m-a*u*m-q*d*z+a*p*z)*N;b[14]=(t*h*e-g*u*e-t*d*l+a*u*l+g*d*z-a*h*z)*N;b[15]=(g*p*e-q*h*e+q*d*l-a*p*l-g*d*m+a*h*m)*N;return this},scale:function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b);b=Math.sin(b);var d=1-c,e=a.x,f=a.y;a=a.z;var g=d*e,h=d*f;this.set(g*e+c,g*f-b*a,g*a+b*f,0,g*f+b*a,h*f+c,h*a-b*e,0,g*a-b*f,h*a+b*e,d*a*a+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},makeShear:function(a,b,c){this.set(1,b,c,0,a,1,c,0,a,b,1,0,0,0,0,1);return this},compose:function(a,b,c){var d=this.elements,e=b._x,f=b._y,g=b._z,h=b._w,l=e+e,k=f+f,q=g+g;b=e*l;var p=e*k;e*=q;var m=f*k;f*=q;g*=q;l*=h;k*=h;h*=q;q=c.x;var r=c.y;c=c.z;d[0]=(1-(m+g))*q;d[1]=(p+h)*q;d[2]=(e-k)*q;d[3]=0;d[4]=(p-h)*r;d[5]=(1-(b+g))*r;d[6]=(f+l)*r;d[7]=0;d[8]=(e+k)*c;d[9]=(f-l)*c;d[10]=(1-(b+m))*c;d[11]=0;d[12]=a.x;d[13]=a.y;d[14]=a.z;d[15]=1;return this},decompose:function(a,b,c){var d=this.elements,e=kd.set(d[0],d[1],d[2]).length(),f=kd.set(d[4],d[5],d[6]).length(),g=kd.set(d[8],d[9],d[10]).length();0>this.determinant()&&(e=-e);a.x=d[12];a.y=d[13];a.z=d[14];Y.copy(this);a=1/e;d=1/f;var h=1/g;Y.elements[0]*=a;Y.elements[1]*=a;Y.elements[2]*=a;Y.elements[4]*=d;Y.elements[5]*=d;Y.elements[6]*=d;Y.elements[8]*=h;Y.elements[9]*=h;Y.elements[10]*=h;b.setFromRotationMatrix(Y);c.x=e;c.y=f;c.z=g;return this},makePerspective:function(a,b,c,d,e,f){void 0===f&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var g=this.elements;g[0]=2*e/(b-a);g[4]=0;g[8]=(b+a)/(b-a);g[12]=0;g[1]=0;g[5]=2*e/(c-d);g[9]=(c+d)/(c-d);g[13]=0;g[2]=0;g[6]=0;g[10]=-(f+e)/(f-e);g[14]=-2*f*e/(f-e);g[3]=0;g[7]=0;g[11]=-1;g[15]=0;return this},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=1/(b-a),l=1/(c-d),k=1/(f-e);g[0]=2*h;g[4]=0;g[8]=0;g[12]=-((b+a)*h);g[1]=0;g[5]=2*l;g[9]=0;g[13]=-((c+d)*l);g[2]=0;g[6]=0;g[10]=-2*k;g[14]=-((f+e)*k);g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},equals:function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0},fromArray:function(a,b){void 0===b&&(b=0);for(var c=0;16>c;c++)this.elements[c]=a[c+b];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a}});var ui=new T,vi=new S;Tb.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");Tb.DefaultOrder="XYZ";Object.defineProperties(Tb.prototype,{x:{get:function(){return this._x},set:function(a){this._x=a;this._onChangeCallback()}},y:{get:function(){return this._y},set:function(a){this._y=a;this._onChangeCallback()}},z:{get:function(){return this._z},set:function(a){this._z=a;this._onChangeCallback()}},order:{get:function(){return this._order},set:function(a){this._order=a;this._onChangeCallback()}}});Object.assign(Tb.prototype,{isEuler:!0,set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this._onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this._onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var d=P.clamp,e=a.elements;a=e[0];var f=e[4],g=e[8],h=e[1],l=e[5],k=e[9],q=e[2],p=e[6];e=e[10];b=b||this._order;switch(b){case"XYZ":this._y=Math.asin(d(g,-1,1));.9999999>Math.abs(g)?(this._x=Math.atan2(-k,e),this._z=Math.atan2(-f,a)):(this._x=Math.atan2(p,l),this._z=0);break;case"YXZ":this._x=Math.asin(-d(k,-1,1));.9999999>Math.abs(k)?(this._y=Math.atan2(g,e),this._z=Math.atan2(h,l)):(this._y=Math.atan2(-q,a),this._z=0);break;case"ZXY":this._x=Math.asin(d(p,-1,1));.9999999>Math.abs(p)?(this._y=Math.atan2(-q,e),this._z=Math.atan2(-f,l)):(this._y=0,this._z=Math.atan2(h,a));break;case"ZYX":this._y=Math.asin(-d(q,-1,1));.9999999>Math.abs(q)?(this._x=Math.atan2(p,e),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-f,l));break;case"YZX":this._z=Math.asin(d(h,-1,1));.9999999>Math.abs(h)?(this._x=Math.atan2(-k,l),this._y=Math.atan2(-q,a)):(this._x=0,this._y=Math.atan2(g,e));break;case"XZY":this._z=Math.asin(-d(f,-1,1));.9999999>Math.abs(f)?(this._x=Math.atan2(p,l),this._y=Math.atan2(g,a)):(this._x=Math.atan2(-k,e),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+b)}this._order=b;!1!==c&&this._onChangeCallback();return this},setFromQuaternion:function(a,b,c){ui.makeRotationFromQuaternion(a);return this.setFromRotationMatrix(ui,b,c)},setFromVector3:function(a,b){return this.set(a.x,a.y,a.z,b||this._order)},reorder:function(a){vi.setFromEuler(this);return this.setFromQuaternion(vi,a)},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this._onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._order;return a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new m(this._x,this._y,this._z)},_onChange:function(a){this._onChangeCallback=a;return this},_onChangeCallback:function(){}});Object.assign(Ce.prototype,{set:function(a){this.mask=1<<a|0},enable:function(a){this.mask=this.mask|1<<a|0},enableAll:function(){this.mask=-1},toggle:function(a){this.mask^=1<<a|0},disable:function(a){this.mask&=~(1<<a|0)},disableAll:function(){this.mask=0},test:function(a){return 0!==(this.mask&a.mask)}});var fj=0,wi=new m,ld=new S,vb=new T,Af=new m,se=new m,Lk=new m,Mk=new S,xi=new m(1,0,0),yi=new m(0,1,0),zi=new m(0,0,1),Nk={type:"added"},Ok={type:"removed"};y.DefaultUp=new m(0,1,0);y.DefaultMatrixAutoUpdate=!0;y.prototype=Object.assign(Object.create(ra.prototype),{constructor:y,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(a){this.matrixAutoUpdate&&this.updateMatrix();this.matrix.premultiply(a);this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(a){this.quaternion.premultiply(a);return this},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(a,b){ld.setFromAxisAngle(a,b);this.quaternion.multiply(ld);return this},rotateOnWorldAxis:function(a,b){ld.setFromAxisAngle(a,b);this.quaternion.premultiply(ld);return this},rotateX:function(a){return this.rotateOnAxis(xi,a)},rotateY:function(a){return this.rotateOnAxis(yi,a)},rotateZ:function(a){return this.rotateOnAxis(zi,a)},translateOnAxis:function(a,b){wi.copy(a).applyQuaternion(this.quaternion);this.position.add(wi.multiplyScalar(b));return this},translateX:function(a){return this.translateOnAxis(xi,a)},translateY:function(a){return this.translateOnAxis(yi,a)},translateZ:function(a){return this.translateOnAxis(zi,a)},localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(a){return a.applyMatrix4(vb.getInverse(this.matrixWorld))},lookAt:function(a,b,c){a.isVector3?Af.copy(a):Af.set(a,b,c);a=this.parent;this.updateWorldMatrix(!0,!1);se.setFromMatrixPosition(this.matrixWorld);this.isCamera||this.isLight?vb.lookAt(se,Af,this.up):vb.lookAt(Af,se,this.up);this.quaternion.setFromRotationMatrix(vb);a&&(vb.extractRotation(a.matrixWorld),ld.setFromRotationMatrix(vb),this.quaternion.premultiply(ld.inverse()))},add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this;a&&a.isObject3D?(null!==a.parent&&a.parent.remove(a),a.parent=this,this.children.push(a),a.dispatchEvent(Nk)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a);return this},remove:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);return this}b=this.children.indexOf(a);-1!==b&&(a.parent=null,this.children.splice(b,1),a.dispatchEvent(Ok));return this},attach:function(a){this.updateWorldMatrix(!0,!1);vb.getInverse(this.matrixWorld);null!==a.parent&&(a.parent.updateWorldMatrix(!0,!1),vb.multiply(a.parent.matrixWorld));a.applyMatrix4(vb);a.updateWorldMatrix(!1,!1);this.add(a);return this},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c].getObjectByProperty(a,b);if(void 0!==e)return e}},getWorldPosition:function(a){void 0===a&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),a=new m);this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(a){void 0===a&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),a=new S);this.updateMatrixWorld(!0);this.matrixWorld.decompose(se,a,Lk);return a},getWorldScale:function(a){void 0===a&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),a=new m);this.updateMatrixWorld(!0);this.matrixWorld.decompose(se,Mk,a);return a},getWorldDirection:function(a){void 0===a&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),a=new m);this.updateMatrixWorld(!0);var b=this.matrixWorld.elements;return a.set(b[8],b[9],b[10]).normalize()},raycast:function(){},traverse:function(a){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverseVisible(a)}},traverseAncestors:function(a){var b=this.parent;null!==b&&(a(b),b.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||a)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].updateMatrixWorld(a)},updateWorldMatrix:function(a,b){var c=this.parent;!0===a&&null!==c&&c.updateWorldMatrix(!0,!1);this.matrixAutoUpdate&&this.updateMatrix();null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);if(!0===b)for(a=this.children,b=0,c=a.length;b<c;b++)a[b].updateWorldMatrix(!1,!0)},toJSON:function(a){function b(b,c){void 0===b[c.uuid]&&(b[c.uuid]=c.toJSON(a));return c.uuid}function c(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var d=void 0===a||"string"===typeof a,e={};d&&(a={geometries:{},materials:{},textures:{},images:{},shapes:{}},e.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var f={};f.uuid=this.uuid;f.type=this.type;""!==this.name&&(f.name=this.name);!0===this.castShadow&&(f.castShadow=!0);!0===this.receiveShadow&&(f.receiveShadow=!0);!1===this.visible&&(f.visible=!1);!1===this.frustumCulled&&(f.frustumCulled=!1);0!==this.renderOrder&&(f.renderOrder=this.renderOrder);"{}"!==JSON.stringify(this.userData)&&(f.userData=this.userData);f.layers=this.layers.mask;f.matrix=this.matrix.toArray();!1===this.matrixAutoUpdate&&(f.matrixAutoUpdate=!1);this.isInstancedMesh&&(f.type="InstancedMesh",f.count=this.count,f.instanceMatrix=this.instanceMatrix.toJSON());if(this.isMesh||this.isLine||this.isPoints){f.geometry=b(a.geometries,this.geometry);var g=this.geometry.parameters;if(void 0!==g&&void 0!==g.shapes)if(g=g.shapes,Array.isArray(g))for(var h=0,l=g.length;h<l;h++)b(a.shapes,g[h]);else b(a.shapes,g)}if(void 0!==this.material)if(Array.isArray(this.material)){g=[];h=0;for(l=this.material.length;h<l;h++)g.push(b(a.materials,this.material[h]));f.material=g}else f.material=b(a.materials,this.material);if(0<this.children.length)for(f.children=[],g=0;g<this.children.length;g++)f.children.push(this.children[g].toJSON(a).object);if(d){d=c(a.geometries);g=c(a.materials);h=c(a.textures);l=c(a.images);var k=c(a.shapes);0<d.length&&(e.geometries=d);0<g.length&&(e.materials=g);0<h.length&&(e.textures=h);0<l.length&&(e.images=l);0<k.length&&(e.shapes=k)}e.object=f;return e},clone:function(a){return(new this.constructor).copy(this,a)},copy:function(a,b){void 0===b&&(b=!0);this.name=a.name;this.up.copy(a.up);this.position.copy(a.position);this.rotation.order=a.rotation.order;this.quaternion.copy(a.quaternion);this.scale.copy(a.scale);this.matrix.copy(a.matrix);this.matrixWorld.copy(a.matrixWorld);this.matrixAutoUpdate=a.matrixAutoUpdate;this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.layers.mask=a.layers.mask;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===b)for(b=0;b<a.children.length;b++)this.add(a.children[b].clone());return this}});wd.prototype=Object.assign(Object.create(y.prototype),{constructor:wd,isScene:!0,copy:function(a,b){y.prototype.copy.call(this,a,b);null!==a.background&&(this.background=a.background.clone());null!==a.environment&&(this.environment=a.environment.clone());null!==a.fog&&(this.fog=a.fog.clone());null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.autoUpdate=a.autoUpdate;this.matrixAutoUpdate=a.matrixAutoUpdate;return this},toJSON:function(a){var b=y.prototype.toJSON.call(this,a);null!==this.background&&(b.object.background=this.background.toJSON(a));null!==this.environment&&(b.object.environment=this.environment.toJSON(a));null!==this.fog&&(b.object.fog=this.fog.toJSON());return b},dispose:function(){this.dispatchEvent({type:"dispose"})}});var wb=[new m,new m,new m,new m,new m,new m,new m,new m],te=new m,Wg=new Ta,md=new m,nd=new m,od=new m,Pb=new m,Qb=new m,pc=new m,ue=new m,Bf=new m,Cf=new m,Ub=new m;Object.assign(Ta.prototype,{isBox3:!0,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromArray:function(a){for(var b=Infinity,c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=-Infinity,h=0,l=a.length;h<l;h+=3){var k=a[h],q=a[h+1],p=a[h+2];k<b&&(b=k);q<c&&(c=q);p<d&&(d=p);k>e&&(e=k);q>f&&(f=q);p>g&&(g=p)}this.min.set(b,c,d);this.max.set(e,f,g);return this},setFromBufferAttribute:function(a){for(var b=Infinity,c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=-Infinity,h=0,l=a.count;h<l;h++){var k=a.getX(h),q=a.getY(h),p=a.getZ(h);k<b&&(b=k);q<c&&(c=q);p<d&&(d=p);k>e&&(e=k);q>f&&(f=q);p>g&&(g=p)}this.min.set(b,c,d);this.max.set(e,f,g);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(a,b){b=te.copy(b).multiplyScalar(.5);this.min.copy(a).sub(b);this.max.copy(a).add(b);return this},setFromObject:function(a){this.makeEmpty();return this.expandByObject(a)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(a){void 0===a&&(console.warn("THREE.Box3: .getCenter() target is now required"),a=new m);return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){void 0===a&&(console.warn("THREE.Box3: .getSize() target is now required"),a=new m);return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},expandByObject:function(a){a.updateWorldMatrix(!1,!1);var b=a.geometry;void 0!==b&&(null===b.boundingBox&&b.computeBoundingBox(),Wg.copy(b.boundingBox),Wg.applyMatrix4(a.matrixWorld),this.union(Wg));a=a.children;b=0;for(var c=a.length;b<c;b++)this.expandByObject(a[b]);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z},getParameter:function(a,b){void 0===b&&(console.warn("THREE.Box3: .getParameter() target is now required"),b=new m);return b.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0},intersectsSphere:function(a){this.clampPoint(a.center,te);return te.distanceToSquared(a.center)<=a.radius*a.radius},intersectsPlane:function(a){if(0<a.normal.x){var b=a.normal.x*this.min.x;var c=a.normal.x*this.max.x}else b=a.normal.x*this.max.x,c=a.normal.x*this.min.x;0<a.normal.y?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y);0<a.normal.z?(b+=a.normal.z*this.min.z,c+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z);return b<=-a.constant&&c>=-a.constant},intersectsTriangle:function(a){if(this.isEmpty())return!1;this.getCenter(ue);Bf.subVectors(this.max,ue);md.subVectors(a.a,ue);nd.subVectors(a.b,ue);od.subVectors(a.c,ue);Pb.subVectors(nd,md);Qb.subVectors(od,nd);pc.subVectors(md,od);a=[0,-Pb.z,Pb.y,0,-Qb.z,Qb.y,0,-pc.z,pc.y,Pb.z,0,-Pb.x,Qb.z,0,-Qb.x,pc.z,0,-pc.x,-Pb.y,Pb.x,0,-Qb.y,Qb.x,0,-pc.y,pc.x,0];if(!$f(a,md,nd,od,Bf))return!1;a=[1,0,0,0,1,0,0,0,1];if(!$f(a,md,nd,od,Bf))return!1;Cf.crossVectors(Pb,Qb);a=[Cf.x,Cf.y,Cf.z];return $f(a,md,nd,od,Bf)},clampPoint:function(a,b){void 0===b&&(console.warn("THREE.Box3: .clampPoint() target is now required"),b=new m);return b.copy(a).clamp(this.min,this.max)},distanceToPoint:function(a){return te.copy(a).clamp(this.min,this.max).sub(a).length()},getBoundingSphere:function(a){void 0===a&&console.error("THREE.Box3: .getBoundingSphere() target is now required");this.getCenter(a.center);a.radius=.5*this.getSize(te).length();return a},intersect:function(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(a){if(this.isEmpty())return this;wb[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(a);wb[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(a);wb[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(a);wb[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(a);wb[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(a);wb[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(a);wb[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(a);wb[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(a);this.setFromPoints(wb);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}});var Pk=new Ta;Object.assign(db.prototype,{set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(a,b){var c=this.center;void 0!==b?c.copy(b):Pk.setFromPoints(a).getCenter(c);for(var d=b=0,e=a.length;d<e;d++)b=Math.max(b,c.distanceToSquared(a[d]));this.radius=Math.sqrt(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},isEmpty:function(){return 0>this.radius},makeEmpty:function(){this.center.set(0,0,0);this.radius=-1;return this},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},intersectsBox:function(a){return a.intersectsSphere(this)},intersectsPlane:function(a){return Math.abs(a.distanceToPoint(this.center))<=this.radius},clampPoint:function(a,b){var c=this.center.distanceToSquared(a);void 0===b&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),b=new m);b.copy(a);c>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center));return b},getBoundingBox:function(a){void 0===a&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),a=new Ta);if(this.isEmpty())return a.makeEmpty(),a;a.set(this.center,this.center);a.expandByScalar(this.radius);return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius}});var xb=new m,Xg=new m,Df=new m,Rb=new m,Yg=new m,Ef=new m,Zg=new m;Object.assign(Vb.prototype,{set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){void 0===b&&(console.warn("THREE.Ray: .at() target is now required"),b=new m);return b.copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize();return this},recast:function(a){this.origin.copy(this.at(a,xb));return this},closestPointToPoint:function(a,b){void 0===b&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),b=new m);b.subVectors(a,this.origin);a=b.dot(this.direction);return 0>a?b.copy(this.origin):b.copy(this.direction).multiplyScalar(a).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(a){var b=xb.subVectors(a,this.origin).dot(this.direction);if(0>b)return this.origin.distanceToSquared(a);xb.copy(this.direction).multiplyScalar(b).add(this.origin);return xb.distanceToSquared(a)},distanceSqToSegment:function(a,b,c,d){Xg.copy(a).add(b).multiplyScalar(.5);Df.copy(b).sub(a).normalize();Rb.copy(this.origin).sub(Xg);var e=.5*a.distanceTo(b),f=-this.direction.dot(Df),g=Rb.dot(this.direction),h=-Rb.dot(Df),l=Rb.lengthSq(),k=Math.abs(1-f*f);if(0<k){a=f*h-g;b=f*g-h;var q=e*k;0<=a?b>=-q?b<=q?(e=1/k,a*=e,b*=e,f=a*(a+f*b+2*g)+b*(f*a+b+2*h)+l):(b=e,a=Math.max(0,-(f*b+g)),f=-a*a+b*(b+2*h)+l):(b=-e,a=Math.max(0,-(f*b+g)),f=-a*a+b*(b+2*h)+l):b<=-q?(a=Math.max(0,-(-f*e+g)),b=0<a?-e:Math.min(Math.max(-e,-h),e),f=-a*a+b*(b+2*h)+l):b<=q?(a=0,b=Math.min(Math.max(-e,-h),e),f=b*(b+2*h)+l):(a=Math.max(0,-(f*e+g)),b=0<a?e:Math.min(Math.max(-e,-h),e),f=-a*a+b*(b+2*h)+l)}else b=0<f?-e:e,a=Math.max(0,-(f*b+g)),f=-a*a+b*(b+2*h)+l;c&&c.copy(this.direction).multiplyScalar(a).add(this.origin);d&&d.copy(Df).multiplyScalar(b).add(Xg);return f},intersectSphere:function(a,b){xb.subVectors(a.center,this.origin);var c=xb.dot(this.direction),d=xb.dot(xb)-c*c;a=a.radius*a.radius;if(d>a)return null;a=Math.sqrt(a-d);d=c-a;c+=a;return 0>d&&0>c?null:0>d?this.at(c,b):this.at(d,b)},intersectsSphere:function(a){return this.distanceSqToPoint(a.center)<=a.radius*a.radius},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+
a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){a=this.distanceToPlane(a);return null===a?null:this.at(a,b)},intersectsPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},intersectBox:function(a,b){var c=1/this.direction.x;var d=1/this.direction.y;var e=1/this.direction.z,f=this.origin;if(0<=c){var g=(a.min.x-f.x)*c;c*=a.max.x-f.x}else g=(a.max.x-f.x)*c,c*=a.min.x-f.x;if(0<=d){var h=(a.min.y-f.y)*d;d*=a.max.y-f.y}else h=(a.max.y-
f.y)*d,d*=a.min.y-f.y;if(g>d||h>c)return null;if(h>g||g!==g)g=h;if(d<c||c!==c)c=d;0<=e?(h=(a.min.z-f.z)*e,a=(a.max.z-f.z)*e):(h=(a.max.z-f.z)*e,a=(a.min.z-f.z)*e);if(g>a||h>c)return null;if(h>g||g!==g)g=h;if(a<c||c!==c)c=a;return 0>c?null:this.at(0<=g?g:c,b)},intersectsBox:function(a){return null!==this.intersectBox(a,xb)},intersectTriangle:function(a,b,c,d,e){Yg.subVectors(b,a);Ef.subVectors(c,a);Zg.crossVectors(Yg,Ef);b=this.direction.dot(Zg);if(0<b){if(d)return null;d=1}else if(0>b)d=-1,b=-b;else return null;Rb.subVectors(this.origin,a);a=d*this.direction.dot(Ef.crossVectors(Rb,Ef));if(0>a)return null;c=d*this.direction.dot(Yg.cross(Rb));if(0>c||a+c>b)return null;a=-d*Rb.dot(Zg);return 0>a?null:this.at(a/b,e)},applyMatrix4:function(a){this.origin.applyMatrix4(a);this.direction.transformDirection(a);return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}});var $g=new m,Qk=new m,Rk=new za;Object.assign(Ua.prototype,{isPlane:!0,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(a,b,c){b=$g.subVectors(c,b).cross(Qk.subVectors(a,b)).normalize();this.setFromNormalAndCoplanarPoint(b,a);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){void 0===b&&(console.warn("THREE.Plane: .projectPoint() target is now required"),b=new m);return b.copy(this.normal).multiplyScalar(-this.distanceToPoint(a)).add(a)},intersectLine:function(a,b){void 0===b&&(console.warn("THREE.Plane: .intersectLine() target is now required"),b=new m);var c=a.delta($g),d=this.normal.dot(c);if(0===d){if(0===this.distanceToPoint(a.start))return b.copy(a.start)}else if(d=-(a.start.dot(this.normal)+this.constant)/d,!(0>d||1<d))return b.copy(c).multiplyScalar(d).add(a.start)},intersectsLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectsBox:function(a){return a.intersectsPlane(this)},intersectsSphere:function(a){return a.intersectsPlane(this)},coplanarPoint:function(a){void 0===a&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),a=new m);return a.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(a,b){b=b||Rk.getNormalMatrix(a);a=this.coplanarPoint($g).applyMatrix4(a);b=this.normal.applyMatrix3(b).normalize();this.constant=-a.dot(b);return this},translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant===this.constant}});var bb=new m,yb=new m,ah=new m,zb=new m,pd=new m,qd=new m,Ai=new m,bh=new m,ch=new m,dh=new m;Object.assign(sa,{getNormal:function(a,b,c,d){void 0===d&&(console.warn("THREE.Triangle: .getNormal() target is now required"),d=new m);d.subVectors(c,b);bb.subVectors(a,b);d.cross(bb);a=d.lengthSq();return 0<a?d.multiplyScalar(1/Math.sqrt(a)):d.set(0,0,0)},getBarycoord:function(a,b,c,d,e){bb.subVectors(d,b);yb.subVectors(c,b);ah.subVectors(a,b);a=bb.dot(bb);b=bb.dot(yb);c=bb.dot(ah);var f=yb.dot(yb);d=yb.dot(ah);var g=a*f-b*b;void 0===e&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),e=new m);if(0===g)return e.set(-2,-1,-1);g=1/g;f=(f*c-b*d)*g;a=(a*d-b*c)*g;return e.set(1-f-a,a,f)},containsPoint:function(a,b,c,d){sa.getBarycoord(a,b,c,d,zb);return 0<=zb.x&&0<=zb.y&&1>=zb.x+zb.y},getUV:function(a,b,c,d,e,f,g,h){this.getBarycoord(a,b,c,d,zb);h.set(0,0);h.addScaledVector(e,zb.x);h.addScaledVector(f,zb.y);h.addScaledVector(g,zb.z);return h},isFrontFacing:function(a,b,c,d){bb.subVectors(c,b);yb.subVectors(a,b);return 0>bb.cross(yb).dot(d)?!0:!1}});Object.assign(sa.prototype,{set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},getArea:function(){bb.subVectors(this.c,this.b);yb.subVectors(this.a,this.b);return.5*bb.cross(yb).length()},getMidpoint:function(a){void 0===a&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),a=new m);return a.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(a){return sa.getNormal(this.a,this.b,this.c,a)},getPlane:function(a){void 0===a&&(console.warn("THREE.Triangle: .getPlane() target is now required"),a=new Ua);return a.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(a,b){return sa.getBarycoord(a,this.a,this.b,this.c,b)},getUV:function(a,b,c,d,e){return sa.getUV(a,this.a,this.b,this.c,b,c,d,e)},containsPoint:function(a){return sa.containsPoint(a,this.a,this.b,this.c)},isFrontFacing:function(a){return sa.isFrontFacing(this.a,this.b,this.c,a)},intersectsBox:function(a){return a.intersectsTriangle(this)},closestPointToPoint:function(a,b){void 0===b&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),b=new m);var c=this.a,d=this.b,e=this.c;pd.subVectors(d,c);qd.subVectors(e,c);bh.subVectors(a,c);var f=pd.dot(bh),g=qd.dot(bh);if(0>=f&&0>=g)return b.copy(c);ch.subVectors(a,d);var h=pd.dot(ch),l=qd.dot(ch);if(0<=h&&l<=h)return b.copy(d);var k=f*l-h*g;if(0>=k&&0<=f&&0>=h)return d=f/(f-h),b.copy(c).addScaledVector(pd,d);dh.subVectors(a,e);a=pd.dot(dh);var q=qd.dot(dh);if(0<=q&&a<=q)return b.copy(e);f=a*g-f*q;if(0>=f&&0<=g&&0>=q)return k=g/(g-q),b.copy(c).addScaledVector(qd,k);g=h*q-a*l;if(0>=g&&0<=l-h&&0<=a-q)return Ai.subVectors(e,d),k=(l-h)/(l-h+(a-q)),b.copy(d).addScaledVector(Ai,k);e=1/(g+f+k);d=f*e;k*=e;return b.copy(c).addScaledVector(pd,d).addScaledVector(qd,k)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}});var Bi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Fa={h:0,s:0,l:0},Ff={h:0,s:0,l:0};Object.assign(H.prototype,{isColor:!0,r:1,g:1,b:1,set:function(a){a&&a.isColor?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setScalar:function(a){this.b=this.g=this.r=a;return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(a,b,c){a=P.euclideanModulo(a,1);b=P.clamp(b,0,1);c=P.clamp(c,0,1);0===b?this.r=this.g=this.b=c:(b=.5>=c?c*(1+b):c+b-c*b,c=2*c-b,this.r=ag(c,b,a+1/3),this.g=ag(c,b,a),this.b=ag(c,b,a-1/3));return this},setStyle:function(a){function b(b){void 0!==b&&1>parseFloat(b)&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}var c;if(c=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(a)){var d=c[2];switch(c[1]){case"rgb":case"rgba":if(c=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=Math.min(255,parseInt(c[1],10))/255,this.g=Math.min(255,parseInt(c[2],10))/255,this.b=Math.min(255,parseInt(c[3],10))/255,b(c[5]),this;if(c=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=Math.min(100,parseInt(c[1],10))/100,this.g=Math.min(100,parseInt(c[2],10))/100,this.b=Math.min(100,parseInt(c[3],10))/100,b(c[5]),this;break;case"hsl":case"hsla":if(c=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d)){d=parseFloat(c[1])/360;var e=parseInt(c[2],10)/100,f=parseInt(c[3],10)/100;b(c[5]);return this.setHSL(d,e,f)}}}else if(c=/^#([A-Fa-f0-9]+)$/.exec(a)){c=c[1];d=c.length;if(3===d)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+
c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===d)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}return a&&0<a.length?this.setColorName(a):this},setColorName:function(a){var b=Bi[a];void 0!==b?this.setHex(b):console.warn("THREE.Color: Unknown color "+a);return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);b=0<b?1/b:1;this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},convertGammaToLinear:function(a){this.copyGammaToLinear(this,a);return this},convertLinearToGamma:function(a){this.copyLinearToGamma(this,a);return this},copySRGBToLinear:function(a){this.r=bg(a.r);this.g=bg(a.g);this.b=bg(a.b);return this},copyLinearToSRGB:function(a){this.r=cg(a.r);this.g=cg(a.g);this.b=cg(a.b);return this},convertSRGBToLinear:function(){this.copySRGBToLinear(this);return this},convertLinearToSRGB:function(){this.copyLinearToSRGB(this);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){void 0===a&&(console.warn("THREE.Color: .getHSL() target is now required"),a={h:0,s:0,l:0});var b=this.r,c=this.g,d=this.b,e=Math.max(b,c,d),f=Math.min(b,c,d),g,h=(f+e)/2;if(f===e)f=g=0;else{var l=e-f;f=.5>=h?l/(e+f):l/(2-e-f);switch(e){case b:g=(c-d)/l+(c<d?6:0);break;case c:g=(d-b)/l+2;break;case d:g=(b-c)/l+4}g/=6}a.h=g;a.s=f;a.l=h;return a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,c){this.getHSL(Fa);Fa.h+=a;Fa.s+=b;Fa.l+=c;this.setHSL(Fa.h,Fa.s,Fa.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},sub:function(a){this.r=Math.max(0,this.r-a.r);this.g=Math.max(0,this.g-a.g);this.b=Math.max(0,this.b-a.b);return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},lerpHSL:function(a,b){this.getHSL(Fa);a.getHSL(Ff);a=P.lerp(Fa.h,Ff.h,b);var c=P.lerp(Fa.s,Ff.s,b);b=P.lerp(Fa.l,Ff.l,b);this.setHSL(a,c,b);return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,b){void 0===b&&(b=0);this.r=a[b];this.g=a[b+1];this.b=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a},fromBufferAttribute:function(a,b){this.r=a.getX(b);this.g=a.getY(b);this.b=a.getZ(b);!0===a.normalized&&(this.r/=255,this.g/=255,this.b/=255);return this},toJSON:function(){return this.getHex()}});H.NAMES=Bi;Object.assign(yc.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.normal.copy(a.normal);this.color.copy(a.color);this.materialIndex=a.materialIndex;for(var b=0,c=a.vertexNormals.length;b<c;b++)this.vertexNormals[b]=a.vertexNormals[b].clone();b=0;for(c=a.vertexColors.length;b<c;b++)this.vertexColors[b]=a.vertexColors[b].clone();return this}});var gj=0;K.prototype=Object.assign(Object.create(ra.prototype),{constructor:K,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(a){if(void 0!==a)for(var b in a){var c=a[b];if(void 0===c)console.warn("THREE.Material: '"+b+"' parameter is undefined.");else if("shading"===b)console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===c?!0:!1;else{var d=this[b];void 0===d?console.warn("THREE."+this.type+": '"+b+"' is not a property of this material."):d&&d.isColor?d.set(c):d&&d.isVector3&&c&&c.isVector3?d.copy(c):this[b]=c}}},toJSON:function(a){function b(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a||"string"===typeof a;c&&(a={textures:{},images:{}});var d={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};d.uuid=this.uuid;d.type=this.type;""!==this.name&&(d.name=this.name);this.color&&this.color.isColor&&(d.color=this.color.getHex());void 0!==this.roughness&&(d.roughness=this.roughness);void 0!==this.metalness&&(d.metalness=this.metalness);this.sheen&&this.sheen.isColor&&(d.sheen=this.sheen.getHex());this.emissive&&this.emissive.isColor&&(d.emissive=this.emissive.getHex());this.emissiveIntensity&&1!==this.emissiveIntensity&&(d.emissiveIntensity=this.emissiveIntensity);this.specular&&this.specular.isColor&&(d.specular=this.specular.getHex());void 0!==this.shininess&&(d.shininess=this.shininess);void 0!==this.clearcoat&&(d.clearcoat=this.clearcoat);void 0!==this.clearcoatRoughness&&(d.clearcoatRoughness=this.clearcoatRoughness);this.clearcoatMap&&this.clearcoatMap.isTexture&&(d.clearcoatMap=this.clearcoatMap.toJSON(a).uuid);this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(d.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(a).uuid);this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(d.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(a).uuid,d.clearcoatNormalScale=this.clearcoatNormalScale.toArray());this.map&&this.map.isTexture&&(d.map=this.map.toJSON(a).uuid);this.matcap&&this.matcap.isTexture&&(d.matcap=this.matcap.toJSON(a).uuid);this.alphaMap&&this.alphaMap.isTexture&&(d.alphaMap=this.alphaMap.toJSON(a).uuid);this.lightMap&&this.lightMap.isTexture&&(d.lightMap=this.lightMap.toJSON(a).uuid);this.aoMap&&this.aoMap.isTexture&&(d.aoMap=this.aoMap.toJSON(a).uuid,d.aoMapIntensity=this.aoMapIntensity);this.bumpMap&&this.bumpMap.isTexture&&(d.bumpMap=this.bumpMap.toJSON(a).uuid,d.bumpScale=this.bumpScale);this.normalMap&&this.normalMap.isTexture&&(d.normalMap=this.normalMap.toJSON(a).uuid,d.normalMapType=this.normalMapType,d.normalScale=this.normalScale.toArray());this.displacementMap&&this.displacementMap.isTexture&&(d.displacementMap=this.displacementMap.toJSON(a).uuid,d.displacementScale=this.displacementScale,d.displacementBias=this.displacementBias);this.roughnessMap&&this.roughnessMap.isTexture&&(d.roughnessMap=this.roughnessMap.toJSON(a).uuid);this.metalnessMap&&this.metalnessMap.isTexture&&(d.metalnessMap=this.metalnessMap.toJSON(a).uuid);this.emissiveMap&&this.emissiveMap.isTexture&&(d.emissiveMap=this.emissiveMap.toJSON(a).uuid);this.specularMap&&this.specularMap.isTexture&&(d.specularMap=this.specularMap.toJSON(a).uuid);this.envMap&&this.envMap.isTexture&&(d.envMap=this.envMap.toJSON(a).uuid,d.reflectivity=this.reflectivity,d.refractionRatio=this.refractionRatio,void 0!==this.combine&&(d.combine=this.combine),void 0!==this.envMapIntensity&&(d.envMapIntensity=this.envMapIntensity));this.gradientMap&&this.gradientMap.isTexture&&(d.gradientMap=this.gradientMap.toJSON(a).uuid);void 0!==this.size&&(d.size=this.size);void 0!==this.sizeAttenuation&&(d.sizeAttenuation=this.sizeAttenuation);1!==this.blending&&(d.blending=this.blending);!0===this.flatShading&&(d.flatShading=this.flatShading);0!==this.side&&(d.side=this.side);this.vertexColors&&(d.vertexColors=!0);1>this.opacity&&(d.opacity=this.opacity);!0===this.transparent&&(d.transparent=this.transparent);d.depthFunc=this.depthFunc;d.depthTest=this.depthTest;d.depthWrite=this.depthWrite;d.stencilWrite=this.stencilWrite;d.stencilWriteMask=this.stencilWriteMask;d.stencilFunc=this.stencilFunc;d.stencilRef=this.stencilRef;d.stencilFuncMask=this.stencilFuncMask;d.stencilFail=this.stencilFail;d.stencilZFail=this.stencilZFail;d.stencilZPass=this.stencilZPass;this.rotation&&0!==this.rotation&&(d.rotation=this.rotation);!0===this.polygonOffset&&(d.polygonOffset=!0);0!==this.polygonOffsetFactor&&(d.polygonOffsetFactor=this.polygonOffsetFactor);0!==this.polygonOffsetUnits&&(d.polygonOffsetUnits=this.polygonOffsetUnits);this.linewidth&&1!==this.linewidth&&(d.linewidth=this.linewidth);void 0!==this.dashSize&&(d.dashSize=this.dashSize);void 0!==this.gapSize&&(d.gapSize=this.gapSize);void 0!==this.scale&&(d.scale=this.scale);!0===this.dithering&&(d.dithering=!0);0<this.alphaTest&&(d.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(d.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(d.wireframe=this.wireframe);1<this.wireframeLinewidth&&(d.wireframeLinewidth=this.wireframeLinewidth);"round"!==this.wireframeLinecap&&(d.wireframeLinecap=this.wireframeLinecap);"round"!==this.wireframeLinejoin&&(d.wireframeLinejoin=this.wireframeLinejoin);!0===this.morphTargets&&(d.morphTargets=!0);!0===this.morphNormals&&(d.morphNormals=!0);!0===this.skinning&&(d.skinning=!0);!1===this.visible&&(d.visible=!1);!1===this.toneMapped&&(d.toneMapped=!1);"{}"!==JSON.stringify(this.userData)&&(d.userData=this.userData);c&&(c=b(a.textures),a=b(a.images),0<c.length&&(d.textures=c),0<a.length&&(d.images=a));return d},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name;this.fog=a.fog;this.blending=a.blending;this.side=a.side;this.flatShading=a.flatShading;this.vertexColors=a.vertexColors;this.opacity=a.opacity;this.transparent=a.transparent;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=a.blendDstAlpha;this.blendEquationAlpha=a.blendEquationAlpha;this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.stencilWriteMask=a.stencilWriteMask;this.stencilFunc=a.stencilFunc;this.stencilRef=a.stencilRef;this.stencilFuncMask=a.stencilFuncMask;this.stencilFail=a.stencilFail;this.stencilZFail=a.stencilZFail;this.stencilZPass=a.stencilZPass;this.stencilWrite=a.stencilWrite;var b=a.clippingPlanes,c=null;if(null!==b){var d=b.length;c=Array(d);for(var e=0;e!==d;++e)c[e]=b[e].clone()}this.clippingPlanes=c;this.clipIntersection=a.clipIntersection;this.clipShadows=a.clipShadows;this.shadowSide=a.shadowSide;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;this.dithering=a.dithering;this.alphaTest=a.alphaTest;this.premultipliedAlpha=a.premultipliedAlpha;this.visible=a.visible;this.toneMapped=a.toneMapped;this.userData=JSON.parse(JSON.stringify(a.userData));return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.defineProperty(K.prototype,"needsUpdate",{set:function(a){!0===a&&this.version++}});Na.prototype=Object.create(K.prototype);Na.prototype.constructor=Na;Na.prototype.isMeshBasicMaterial=!0;Na.prototype.copy=function(a){K.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;return this};var ea=new m,Gf=new w;Object.defineProperty(F.prototype,"needsUpdate",{set:function(a){!0===a&&this.version++}});Object.assign(F.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(a){this.usage=a;return this},copy:function(a){this.name=a.name;this.array=new a.array.constructor(a.array);this.itemSize=a.itemSize;this.count=a.count;this.normalized=a.normalized;this.usage=a.usage;return this},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this},copyArray:function(a){this.array.set(a);return this},copyColorsArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",d),f=new H);b[c++]=f.r;b[c++]=f.g;b[c++]=f.b}return this},copyVector2sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",d),f=new w);b[c++]=f.x;b[c++]=f.y}return this},copyVector3sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",d),f=new m);b[c++]=f.x;b[c++]=f.y;b[c++]=f.z}return this},copyVector4sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",d),f=new ba);b[c++]=f.x;b[c++]=f.y;b[c++]=f.z;b[c++]=f.w}return this},applyMatrix3:function(a){if(2===this.itemSize)for(var b=0,c=this.count;b<c;b++)Gf.fromBufferAttribute(this,b),Gf.applyMatrix3(a),this.setXY(b,Gf.x,Gf.y);else if(3===this.itemSize)for(b=0,c=this.count;b<c;b++)ea.fromBufferAttribute(this,b),ea.applyMatrix3(a),this.setXYZ(b,ea.x,ea.y,ea.z);return this},applyMatrix4:function(a){for(var b=0,c=this.count;b<c;b++)ea.x=this.getX(b),ea.y=this.getY(b),ea.z=this.getZ(b),ea.applyMatrix4(a),this.setXYZ(b,ea.x,ea.y,ea.z);return this},applyNormalMatrix:function(a){for(var b=0,c=this.count;b<c;b++)ea.x=this.getX(b),ea.y=this.getY(b),ea.z=this.getZ(b),ea.applyNormalMatrix(a),this.setXYZ(b,ea.x,ea.y,ea.z);return this},transformDirection:function(a){for(var b=0,c=this.count;b<c;b++)ea.x=this.getX(b),ea.y=this.getY(b),ea.z=this.getZ(b),ea.transformDirection(a),this.setXYZ(b,ea.x,ea.y,ea.z);return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},getX:function(a){return this.array[a*this.itemSize]},setX:function(a,b){this.array[a*this.itemSize]=b;return this},getY:function(a){return this.array[a*this.itemSize+1]},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},getZ:function(a){return this.array[a*this.itemSize+2]},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},getW:function(a){return this.array[a*this.itemSize+3]},setW:function(a,b){this.array[a*this.itemSize+3]=b;return this},setXY:function(a,b,c){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e;return this},onUpload:function(a){this.onUploadCallback=a;return this},clone:function(){return(new this.constructor(this.array,this.itemSize)).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}});xd.prototype=Object.create(F.prototype);xd.prototype.constructor=xd;yd.prototype=Object.create(F.prototype);yd.prototype.constructor=yd;zd.prototype=Object.create(F.prototype);zd.prototype.constructor=zd;Ad.prototype=Object.create(F.prototype);Ad.prototype.constructor=Ad;Wb.prototype=Object.create(F.prototype);Wb.prototype.constructor=Wb;Bd.prototype=Object.create(F.prototype);Bd.prototype.constructor=Bd;Xb.prototype=Object.create(F.prototype);Xb.prototype.constructor=Xb;C.prototype=Object.create(F.prototype);C.prototype.constructor=C;Cd.prototype=Object.create(F.prototype);Cd.prototype.constructor=Cd;Object.assign(sh.prototype,{computeGroups:function(a){var b=[],c=void 0,d=a.faces;for(a=0;a<d.length;a++){var e=d[a];if(e.materialIndex!==c){c=e.materialIndex;void 0!==f&&(f.count=3*a-f.start,b.push(f));var f={start:3*a,materialIndex:c}}}void 0!==f&&(f.count=3*a-f.start,b.push(f));this.groups=b},fromGeometry:function(a){var b=a.faces,c=a.vertices,d=a.faceVertexUvs,e=d[0]&&0<d[0].length,f=d[1]&&0<d[1].length,g=a.morphTargets,h=g.length;if(0<h){var l=[];for(var k=0;k<h;k++)l[k]={name:g[k].name,data:[]};this.morphTargets.position=l}k=a.morphNormals;var q=k.length;if(0<q){var p=[];for(var m=0;m<q;m++)p[m]={name:k[m].name,data:[]};this.morphTargets.normal=p}m=a.skinIndices;var r=a.skinWeights,t=m.length===c.length,u=r.length===c.length;0<c.length&&0===b.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var z=0;z<b.length;z++){var A=b[z];this.vertices.push(c[A.a],c[A.b],c[A.c]);var x=A.vertexNormals;3===x.length?this.normals.push(x[0],x[1],x[2]):(x=A.normal,this.normals.push(x,x,x));x=A.vertexColors;3===x.length?this.colors.push(x[0],x[1],x[2]):(x=A.color,this.colors.push(x,x,x));!0===e&&(x=d[0][z],void 0!==x?this.uvs.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",z),this.uvs.push(new w,new w,new w)));!0===f&&(x=d[1][z],void 0!==x?this.uvs2.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",z),this.uvs2.push(new w,new w,new w)));for(x=0;x<h;x++){var y=g[x].vertices;l[x].data.push(y[A.a],y[A.b],y[A.c])}for(x=0;x<q;x++)y=k[x].vertexNormals[z],p[x].data.push(y.a,y.b,y.c);t&&this.skinIndices.push(m[A.a],m[A.b],m[A.c]);u&&this.skinWeights.push(r[A.a],r[A.b],r[A.c])}this.computeGroups(a);this.verticesNeedUpdate=a.verticesNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());return this}});var hj=1,mb=new T,eh=new y,rd=new m,Ma=new Ta,ve=new Ta,wa=new m;D.prototype=Object.assign(Object.create(ra.prototype),{constructor:D,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(a){Array.isArray(a)?this.index=new(65535<th(a)?Xb:Wb)(a,1):this.index=a},getAttribute:function(a){return this.attributes[a]},setAttribute:function(a,b){this.attributes[a]=b;return this},deleteAttribute:function(a){delete this.attributes[a];return this},addGroup:function(a,b,c){this.groups.push({start:a,count:b,materialIndex:void 0!==c?c:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,b){this.drawRange.start=a;this.drawRange.count=b},applyMatrix4:function(a){var b=this.attributes.position;void 0!==b&&(b.applyMatrix4(a),b.needsUpdate=!0);b=this.attributes.normal;if(void 0!==b){var c=(new za).getNormalMatrix(a);b.applyNormalMatrix(c);b.needsUpdate=!0}b=this.attributes.tangent;void 0!==b&&(b.transformDirection(a),b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this},rotateX:function(a){mb.makeRotationX(a);this.applyMatrix4(mb);return this},rotateY:function(a){mb.makeRotationY(a);this.applyMatrix4(mb);return this},rotateZ:function(a){mb.makeRotationZ(a);this.applyMatrix4(mb);return this},translate:function(a,b,c){mb.makeTranslation(a,b,c);this.applyMatrix4(mb);return this},scale:function(a,b,c){mb.makeScale(a,b,c);this.applyMatrix4(mb);return this},lookAt:function(a){eh.lookAt(a);eh.updateMatrix();this.applyMatrix4(eh.matrix);return this},center:function(){this.computeBoundingBox();this.boundingBox.getCenter(rd).negate();this.translate(rd.x,rd.y,rd.z);return this},setFromObject:function(a){var b=a.geometry;if(a.isPoints||a.isLine){a=new C(3*b.vertices.length,3);var c=new C(3*b.colors.length,3);this.setAttribute("position",a.copyVector3sArray(b.vertices));this.setAttribute("color",c.copyColorsArray(b.colors));b.lineDistances&&b.lineDistances.length===b.vertices.length&&(a=new C(b.lineDistances.length,1),this.setAttribute("lineDistance",a.copyArray(b.lineDistances)));null!==b.boundingSphere&&(this.boundingSphere=b.boundingSphere.clone());null!==b.boundingBox&&(this.boundingBox=b.boundingBox.clone())}else a.isMesh&&b&&b.isGeometry&&this.fromGeometry(b);return this},setFromPoints:function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c];b.push(e.x,e.y,e.z||0)}this.setAttribute("position",new C(b,3));return this},updateFromObject:function(a){var b=a.geometry;if(a.isMesh){var c=b.__directGeometry;!0===b.elementsNeedUpdate&&(c=void 0,b.elementsNeedUpdate=!1);if(void 0===c)return this.fromGeometry(b);c.verticesNeedUpdate=b.verticesNeedUpdate;c.normalsNeedUpdate=b.normalsNeedUpdate;c.colorsNeedUpdate=b.colorsNeedUpdate;c.uvsNeedUpdate=b.uvsNeedUpdate;c.groupsNeedUpdate=b.groupsNeedUpdate;b.verticesNeedUpdate=!1;b.normalsNeedUpdate=!1;b.colorsNeedUpdate=!1;b.uvsNeedUpdate=!1;b.groupsNeedUpdate=!1;b=c}!0===b.verticesNeedUpdate&&(c=this.attributes.position,void 0!==c&&(c.copyVector3sArray(b.vertices),c.needsUpdate=!0),b.verticesNeedUpdate=!1);!0===b.normalsNeedUpdate&&(c=this.attributes.normal,void 0!==c&&(c.copyVector3sArray(b.normals),c.needsUpdate=!0),b.normalsNeedUpdate=!1);!0===b.colorsNeedUpdate&&(c=this.attributes.color,void 0!==c&&(c.copyColorsArray(b.colors),c.needsUpdate=!0),b.colorsNeedUpdate=!1);b.uvsNeedUpdate&&(c=this.attributes.uv,void 0!==c&&(c.copyVector2sArray(b.uvs),c.needsUpdate=!0),b.uvsNeedUpdate=!1);b.lineDistancesNeedUpdate&&(c=this.attributes.lineDistance,void 0!==c&&(c.copyArray(b.lineDistances),c.needsUpdate=!0),b.lineDistancesNeedUpdate=!1);b.groupsNeedUpdate&&(b.computeGroups(a.geometry),this.groups=b.groups,b.groupsNeedUpdate=!1);return this},fromGeometry:function(a){a.__directGeometry=(new sh).fromGeometry(a);return this.fromDirectGeometry(a.__directGeometry)},fromDirectGeometry:function(a){var b=new Float32Array(3*a.vertices.length);this.setAttribute("position",(new F(b,3)).copyVector3sArray(a.vertices));0<a.normals.length&&(b=new Float32Array(3*a.normals.length),this.setAttribute("normal",(new F(b,3)).copyVector3sArray(a.normals)));0<a.colors.length&&(b=new Float32Array(3*a.colors.length),this.setAttribute("color",(new F(b,3)).copyColorsArray(a.colors)));0<a.uvs.length&&(b=new Float32Array(2*a.uvs.length),this.setAttribute("uv",(new F(b,2)).copyVector2sArray(a.uvs)));0<a.uvs2.length&&(b=new Float32Array(2*a.uvs2.length),this.setAttribute("uv2",(new F(b,2)).copyVector2sArray(a.uvs2)));this.groups=a.groups;for(var c in a.morphTargets){b=[];for(var d=a.morphTargets[c],e=0,f=d.length;e<f;e++){var g=d[e],h=new C(3*g.data.length,3);h.name=g.name;b.push(h.copyVector3sArray(g.data))}this.morphAttributes[c]=b}0<a.skinIndices.length&&(c=new C(4*a.skinIndices.length,4),this.setAttribute("skinIndex",c.copyVector4sArray(a.skinIndices)));0<a.skinWeights.length&&(c=new C(4*a.skinWeights.length,4),this.setAttribute("skinWeight",c.copyVector4sArray(a.skinWeights)));null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ta);var a=this.attributes.position,b=this.morphAttributes.position;if(void 0!==a){if(this.boundingBox.setFromBufferAttribute(a),b){a=0;for(var c=b.length;a<c;a++)Ma.setFromBufferAttribute(b[a]),this.morphTargetsRelative?(wa.addVectors(this.boundingBox.min,Ma.min),this.boundingBox.expandByPoint(wa),wa.addVectors(this.boundingBox.max,Ma.max),this.boundingBox.expandByPoint(wa)):(this.boundingBox.expandByPoint(Ma.min),this.boundingBox.expandByPoint(Ma.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new db);var a=this.attributes.position,b=this.morphAttributes.position;if(a){var c=this.boundingSphere.center;Ma.setFromBufferAttribute(a);if(b)for(var d=0,e=b.length;d<e;d++)ve.setFromBufferAttribute(b[d]),this.morphTargetsRelative?(wa.addVectors(Ma.min,ve.min),Ma.expandByPoint(wa),wa.addVectors(Ma.max,ve.max),Ma.expandByPoint(wa)):(Ma.expandByPoint(ve.min),Ma.expandByPoint(ve.max));Ma.getCenter(c);e=d=0;for(var f=a.count;e<f;e++)wa.fromBufferAttribute(a,e),d=Math.max(d,c.distanceToSquared(wa));if(b)for(e=0,f=b.length;e<f;e++)for(var g=b[e],h=this.morphTargetsRelative,l=0,k=g.count;l<k;l++)wa.fromBufferAttribute(g,l),h&&(rd.fromBufferAttribute(a,l),wa.add(rd)),d=Math.max(d,c.distanceToSquared(wa));this.boundingSphere.radius=Math.sqrt(d);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var a=this.index,b=this.getAttribute("position");if(void 0!==b){var c=this.getAttribute("normal");if(void 0===c)c=new F(new Float32Array(3*b.count),3),this.setAttribute("normal",c);else for(var d=0,e=c.count;d<e;d++)c.setXYZ(d,0,0,0);d=new m;e=new m;var f=new m,g=new m,h=new m,l=new m,k=new m,q=new m;if(a)for(var p=0,v=a.count;p<v;p+=3){var r=a.getX(p+0),t=a.getX(p+1),u=a.getX(p+2);d.fromBufferAttribute(b,r);e.fromBufferAttribute(b,t);f.fromBufferAttribute(b,u);k.subVectors(f,e);q.subVectors(d,e);k.cross(q);g.fromBufferAttribute(c,r);h.fromBufferAttribute(c,t);l.fromBufferAttribute(c,u);g.add(k);h.add(k);l.add(k);c.setXYZ(r,g.x,g.y,g.z);c.setXYZ(t,h.x,h.y,h.z);c.setXYZ(u,l.x,l.y,l.z)}else for(a=0,g=b.count;a<g;a+=3)d.fromBufferAttribute(b,a+0),e.fromBufferAttribute(b,a+1),f.fromBufferAttribute(b,a+2),k.subVectors(f,e),q.subVectors(d,e),k.cross(q),c.setXYZ(a+0,k.x,k.y,k.z),c.setXYZ(a+1,k.x,k.y,k.z),c.setXYZ(a+2,k.x,k.y,k.z);this.normalizeNormals();c.needsUpdate=!0}},merge:function(a,b){if(a&&a.isBufferGeometry){void 0===b&&(b=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var c=this.attributes,d;for(d in c)if(void 0!==a.attributes[d]){var e=c[d].array,f=a.attributes[d],g=f.array,h=f.itemSize*b;f=Math.min(g.length,e.length-h);for(var l=0;l<f;l++,h++)e[h]=g[l]}return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",a)},normalizeNormals:function(){for(var a=this.attributes.normal,b=0,c=a.count;b<c;b++)wa.fromBufferAttribute(a,b),wa.normalize(),a.setXYZ(b,wa.x,wa.y,wa.z)},toNonIndexed:function(){function a(a,b){var c=a.array,d=a.itemSize;a=a.normalized;for(var e=new c.constructor(b.length*d),f,g=0,h=0,l=b.length;h<l;h++){f=b[h]*d;for(var k=0;k<d;k++)e[g++]=c[f++]}return new F(e,d,a)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var b=new D,c=this.index.array,d=this.attributes;for(g in d){var e=a(d[g],c);b.setAttribute(g,e)}d=this.morphAttributes;for(var f in d){var g=[];e=d[f];for(var h=0,l=e.length;h<l;h++){var k=a(e[h],c);g.push(k)}b.morphAttributes[f]=g}b.morphTargetsRelative=this.morphTargetsRelative;c=this.groups;f=0;for(d=c.length;f<d;f++)g=c[f],b.addGroup(g.start,g.count,g.materialIndex);return b},toJSON:function(){var a={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};a.uuid=this.uuid;a.type=this.type;""!==this.name&&(a.name=this.name);0<Object.keys(this.userData).length&&(a.userData=this.userData);if(void 0!==this.parameters){var b=this.parameters;for(c in b)void 0!==b[c]&&(a[c]=b[c]);return a}a.data={attributes:{}};var c=this.index;null!==c&&(a.data.index={type:c.array.constructor.name,array:Array.prototype.slice.call(c.array)});c=this.attributes;for(var d in c){var e=c[d],f=e.toJSON(a.data);""!==e.name&&(f.name=e.name);a.data.attributes[d]=f}d={};c=!1;for(b in this.morphAttributes){e=this.morphAttributes[b];f=[];for(var g=0,h=e.length;g<h;g++){var l=e[g],k=l.toJSON(a.data);""!==l.name&&(k.name=l.name);f.push(k)}0<f.length&&(d[b]=f,c=!0)}c&&(a.data.morphAttributes=d,a.data.morphTargetsRelative=this.morphTargetsRelative);b=this.groups;0<b.length&&(a.data.groups=JSON.parse(JSON.stringify(b)));b=this.boundingSphere;null!==b&&(a.data.boundingSphere={center:b.center.toArray(),radius:b.radius});return a},clone:function(){return(new D).copy(this)},copy:function(a){this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;var b={};this.name=a.name;var c=a.index;null!==c&&this.setIndex(c.clone(b));c=a.attributes;for(var d in c)this.setAttribute(d,c[d].clone(b));d=a.morphAttributes;for(var e in d){c=[];for(var f=d[e],g=0,h=f.length;g<h;g++)c.push(f[g].clone(b));this.morphAttributes[e]=c}this.morphTargetsRelative=a.morphTargetsRelative;b=a.groups;e=0;for(d=b.length;e<d;e++)c=b[e],this.addGroup(c.start,c.count,c.materialIndex);b=a.boundingBox;null!==b&&(this.boundingBox=b.clone());b=a.boundingSphere;null!==b&&(this.boundingSphere=b.clone());this.drawRange.start=a.drawRange.start;this.drawRange.count=a.drawRange.count;this.userData=a.userData;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Ci=new T,qc=new Vb,fh=new db,Ab=new m,Bb=new m,Cb=new m,dg=new m,eg=new m,fg=new m,Fe=new m,Ge=new m,He=new m,zc=new w,Ac=new w,Bc=new w,Dd=new m,De=new m;Z.prototype=Object.assign(Object.create(y.prototype),{constructor:Z,isMesh:!0,copy:function(a){y.prototype.copy.call(this,a);void 0!==a.morphTargetInfluences&&(this.morphTargetInfluences=a.morphTargetInfluences.slice());void 0!==a.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},a.morphTargetDictionary));this.material=a.material;this.geometry=a.geometry;return this},updateMorphTargets:function(){var a=this.geometry;if(a.isBufferGeometry){a=a.morphAttributes;var b=Object.keys(a);if(0<b.length&&(a=a[b[0]],void 0!==a)){this.morphTargetInfluences=[];this.morphTargetDictionary={};b=0;for(var c=a.length;b<c;b++){var d=a[b].name||String(b);this.morphTargetInfluences.push(0);this.morphTargetDictionary[d]=b}}}else a=a.morphTargets,void 0!==a&&0<a.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},raycast:function(a,b){var c=this.geometry,d=this.material,e=this.matrixWorld;if(void 0!==d&&(null===c.boundingSphere&&c.computeBoundingSphere(),fh.copy(c.boundingSphere),fh.applyMatrix4(e),!1!==a.ray.intersectsSphere(fh)&&(Ci.getInverse(e),qc.copy(a.ray).applyMatrix4(Ci),null===c.boundingBox||!1!==qc.intersectsBox(c.boundingBox))))if(c.isBufferGeometry){var f=c.index,g=c.attributes.position;e=c.morphAttributes.position;var h=c.morphTargetsRelative,l=c.attributes.uv,k=c.attributes.uv2,q=c.groups,p=c.drawRange;if(null!==f)if(Array.isArray(d))for(var m=0,r=q.length;m<r;m++)for(var t=q[m],u=d[t.materialIndex],z=Math.max(t.start,p.start),A=Math.min(t.start+t.count,p.start+p.count);z<A;z+=3){c=f.getX(z);var x=f.getX(z+1),y=f.getX(z+2);if(c=Ee(this,u,a,qc,g,e,h,l,k,c,x,y))c.faceIndex=Math.floor(z/3),c.face.materialIndex=t.materialIndex,b.push(c)}else for(q=Math.max(0,p.start),p=Math.min(f.count,p.start+p.count);q<p;q+=3){if(c=f.getX(q),m=f.getX(q+1),r=f.getX(q+2),c=Ee(this,d,a,qc,g,e,h,l,k,c,m,r))c.faceIndex=Math.floor(q/3),b.push(c)}else if(void 0!==g)if(Array.isArray(d))for(f=0,m=q.length;f<m;f++)for(r=q[f],t=d[r.materialIndex],u=Math.max(r.start,p.start),z=Math.min(r.start+r.count,p.start+p.count);u<z;u+=3){if(c=Ee(this,t,a,qc,g,e,h,l,k,u,u+1,u+2))c.faceIndex=Math.floor(u/3),c.face.materialIndex=r.materialIndex,b.push(c)}else for(q=Math.max(0,p.start),p=Math.min(g.count,p.start+p.count);q<p;q+=3)if(c=Ee(this,d,a,qc,g,e,h,l,k,q,q+1,q+2))c.faceIndex=Math.floor(q/3),b.push(c)}else if(c.isGeometry)for(e=Array.isArray(d),h=c.vertices,l=c.faces,c=c.faceVertexUvs[0],0<c.length&&(g=c),k=0,p=l.length;k<p;k++)if(q=l[k],c=e?d[q.materialIndex]:d,void 0!==c&&(f=h[q.a],m=h[q.b],r=h[q.c],c=uh(this,c,a,qc,f,m,r,Dd)))g&&g[k]&&(t=g[k],zc.copy(t[0]),Ac.copy(t[1]),Bc.copy(t[2]),c.uv=sa.getUV(Dd,f,m,r,zc,Ac,Bc,new w)),c.face=q,c.faceIndex=k,b.push(c)}});var ij=0,nb=new T,gh=new y,Hf=new m;J.prototype=Object.assign(Object.create(ra.prototype),{constructor:J,isGeometry:!0,applyMatrix4:function(a){for(var b=(new za).getNormalMatrix(a),c=0,d=this.vertices.length;c<d;c++)this.vertices[c].applyMatrix4(a);a=0;for(c=this.faces.length;a<c;a++){d=this.faces[a];d.normal.applyMatrix3(b).normalize();for(var e=0,f=d.vertexNormals.length;e<f;e++)d.vertexNormals[e].applyMatrix3(b).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();this.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(a){nb.makeRotationX(a);this.applyMatrix4(nb);return this},rotateY:function(a){nb.makeRotationY(a);this.applyMatrix4(nb);return this},rotateZ:function(a){nb.makeRotationZ(a);this.applyMatrix4(nb);return this},translate:function(a,b,c){nb.makeTranslation(a,b,c);this.applyMatrix4(nb);return this},scale:function(a,b,c){nb.makeScale(a,b,c);this.applyMatrix4(nb);return this},lookAt:function(a){gh.lookAt(a);gh.updateMatrix();this.applyMatrix4(gh.matrix);return this},fromBufferGeometry:function(a){function b(a,b,d,e){var f=void 0===h?[]:[c.colors[a].clone(),c.colors[b].clone(),c.colors[d].clone()],n=void 0===g?[]:[(new m).fromBufferAttribute(g,a),(new m).fromBufferAttribute(g,b),(new m).fromBufferAttribute(g,d)];e=new yc(a,b,d,n,f,e);c.faces.push(e);void 0!==l&&c.faceVertexUvs[0].push([(new w).fromBufferAttribute(l,a),(new w).fromBufferAttribute(l,b),(new w).fromBufferAttribute(l,d)]);void 0!==k&&c.faceVertexUvs[1].push([(new w).fromBufferAttribute(k,a),(new w).fromBufferAttribute(k,b),(new w).fromBufferAttribute(k,d)])}var c=this,d=null!==a.index?a.index:void 0,e=a.attributes;if(void 0===e.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var f=e.position,g=e.normal,h=e.color,l=e.uv,k=e.uv2;void 0!==k&&(this.faceVertexUvs[1]=[]);for(e=0;e<f.count;e++)c.vertices.push((new m).fromBufferAttribute(f,e)),void 0!==h&&c.colors.push((new H).fromBufferAttribute(h,e));e=a.groups;if(0<e.length)for(f=0;f<e.length;f++){var q=e[f],p=q.start,v=p;for(p+=q.count;v<p;v+=3)void 0!==d?b(d.getX(v),d.getX(v+1),d.getX(v+2),q.materialIndex):b(v,v+1,v+2,q.materialIndex)}else if(void 0!==d)for(e=0;e<d.count;e+=3)b(d.getX(e),d.getX(e+1),d.getX(e+2));else for(d=0;d<f.count;d+=3)b(d,d+1,d+2);this.computeFaceNormals();null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();this.boundingBox.getCenter(Hf).negate();this.translate(Hf.x,Hf.y,Hf.z);return this},normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,b=this.boundingSphere.radius;b=0===b?1:1/b;var c=new T;c.set(b,0,0,-b*a.x,0,b,0,-b*a.y,0,0,b,-b*a.z,0,0,0,1);this.applyMatrix4(c);return this},computeFaceNormals:function(){for(var a=new m,b=new m,c=0,d=this.faces.length;c<d;c++){var e=this.faces[c],f=this.vertices[e.a],g=this.vertices[e.b];a.subVectors(this.vertices[e.c],g);b.subVectors(f,g);a.cross(b);a.normalize();e.normal.copy(a)}},computeVertexNormals:function(a){void 0===a&&(a=!0);for(var b=Array(this.vertices.length),c=0,d=this.vertices.length;c<d;c++)b[c]=new m;if(a){a=new m;c=new m;d=0;for(var e=this.faces.length;d<e;d++){var f=this.faces[d],g=this.vertices[f.a],h=this.vertices[f.b];a.subVectors(this.vertices[f.c],h);c.subVectors(g,h);a.cross(c);b[f.a].add(a);b[f.b].add(a);b[f.c].add(a)}}else for(this.computeFaceNormals(),a=0,c=this.faces.length;a<c;a++)d=this.faces[a],b[d.a].add(d.normal),b[d.b].add(d.normal),b[d.c].add(d.normal);a=0;for(c=this.vertices.length;a<c;a++)b[a].normalize();a=0;for(c=this.faces.length;a<c;a++)d=this.faces[a],e=d.vertexNormals,3===e.length?(e[0].copy(b[d.a]),e[1].copy(b[d.b]),e[2].copy(b[d.c])):(e[0]=b[d.a].clone(),e[1]=b[d.b].clone(),e[2]=b[d.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(var a=0,b=this.faces.length;a<b;a++){var c=this.faces[a],d=c.vertexNormals;3===d.length?(d[0].copy(c.normal),d[1].copy(c.normal),d[2].copy(c.normal)):(d[0]=c.normal.clone(),d[1]=c.normal.clone(),d[2]=c.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(var a=0,b=this.faces.length;a<b;a++){var c=this.faces[a];c.__originalFaceNormal?c.__originalFaceNormal.copy(c.normal):c.__originalFaceNormal=c.normal.clone();c.__originalVertexNormals||(c.__originalVertexNormals=[]);for(var d=0,e=c.vertexNormals.length;d<e;d++)c.__originalVertexNormals[d]?c.__originalVertexNormals[d].copy(c.vertexNormals[d]):c.__originalVertexNormals[d]=c.vertexNormals[d].clone()}a=new J;a.faces=this.faces;b=0;for(c=this.morphTargets.length;b<c;b++){if(!this.morphNormals[b]){this.morphNormals[b]={};this.morphNormals[b].faceNormals=[];this.morphNormals[b].vertexNormals=[];d=this.morphNormals[b].faceNormals;e=this.morphNormals[b].vertexNormals;for(var f=0,g=this.faces.length;f<g;f++){var h=new m,l={a:new m,b:new m,c:new m};d.push(h);e.push(l)}}d=this.morphNormals[b];a.vertices=this.morphTargets[b].vertices;a.computeFaceNormals();a.computeVertexNormals();e=0;for(f=this.faces.length;e<f;e++)g=this.faces[e],h=d.vertexNormals[e],d.faceNormals[e].copy(g.normal),h.a.copy(g.vertexNormals[0]),h.b.copy(g.vertexNormals[1]),h.c.copy(g.vertexNormals[2])}a=0;for(b=this.faces.length;a<b;a++)c=this.faces[a],c.normal=c.__originalFaceNormal,c.vertexNormals=c.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ta);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new db);this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,b,c){if(a&&a.isGeometry){var d,e=this.vertices.length,f=this.vertices,g=a.vertices,h=this.faces,l=a.faces,k=this.colors,q=a.colors;void 0===c&&(c=0);void 0!==b&&(d=(new za).getNormalMatrix(b));for(var p=0,m=g.length;p<m;p++){var r=g[p].clone();void 0!==b&&r.applyMatrix4(b);f.push(r)}b=0;for(f=q.length;b<f;b++)k.push(q[b].clone());k=0;for(q=l.length;k<q;k++){b=l[k];m=b.vertexNormals;g=b.vertexColors;f=new yc(b.a+e,b.b+e,b.c+e);f.normal.copy(b.normal);void 0!==d&&f.normal.applyMatrix3(d).normalize();r=0;for(var t=m.length;r<t;r++)p=m[r].clone(),void 0!==d&&p.applyMatrix3(d).normalize(),f.vertexNormals.push(p);f.color.copy(b.color);m=0;for(r=g.length;m<r;m++)p=g[m],f.vertexColors.push(p.clone());f.materialIndex=b.materialIndex+c;h.push(f)}c=0;for(d=a.faceVertexUvs.length;c<d;c++)for(e=a.faceVertexUvs[c],void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]),h=0,l=e.length;h<l;h++){k=e[h];q=[];b=0;for(f=k.length;b<f;b++)q.push(k[b].clone());this.faceVertexUvs[c].push(q)}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",a)},mergeMesh:function(a){a&&a.isMesh?(a.matrixAutoUpdate&&a.updateMatrix(),this.merge(a.geometry,a.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",a)},mergeVertices:function(){for(var a={},b=[],c=[],d=Math.pow(10,4),e=0,f=this.vertices.length;e<f;e++){var g=this.vertices[e];g=Math.round(g.x*d)+"_"+Math.round(g.y*d)+"_"+Math.round(g.z*d);void 0===a[g]?(a[g]=e,b.push(this.vertices[e]),c[e]=b.length-1):c[e]=c[a[g]]}a=[];d=0;for(e=this.faces.length;d<e;d++)for(f=this.faces[d],f.a=c[f.a],f.b=c[f.b],f.c=c[f.c],f=[f.a,f.b,f.c],g=0;3>g;g++)if(f[g]===f[(g+1)%3]){a.push(d);break}for(c=a.length-1;0<=c;c--)for(d=a[c],this.faces.splice(d,1),e=0,f=this.faceVertexUvs.length;e<f;e++)this.faceVertexUvs[e].splice(d,1);c=this.vertices.length-b.length;this.vertices=b;return c},setFromPoints:function(a){this.vertices=[];for(var b=0,c=a.length;b<c;b++){var d=a[b];this.vertices.push(new m(d.x,d.y,d.z||0))}return this},sortFacesByMaterialIndex:function(){for(var a=this.faces,b=a.length,c=0;c<b;c++)a[c]._id=c;a.sort(function(a,b){return a.materialIndex-
b.materialIndex});c=this.faceVertexUvs[0];var d=this.faceVertexUvs[1],e,f;c&&c.length===b&&(e=[]);d&&d.length===b&&(f=[]);for(var g=0;g<b;g++){var h=a[g]._id;e&&e.push(c[h]);f&&f.push(d[h])}e&&(this.faceVertexUvs[0]=e);f&&(this.faceVertexUvs[1]=f)},toJSON:function(){function a(a,b,c){return c?a|1<<b:a&~(1<<b)}function b(a){var b=a.x.toString()+a.y.toString()+a.z.toString();if(void 0!==k[b])return k[b];k[b]=l.length/3;l.push(a.x,a.y,a.z);return k[b]}function c(a){var b=a.r.toString()+a.g.toString()+
a.b.toString();if(void 0!==p[b])return p[b];p[b]=q.length;q.push(a.getHex());return p[b]}function d(a){var b=a.x.toString()+a.y.toString();if(void 0!==r[b])return r[b];r[b]=m.length/2;m.push(a.x,a.y);return r[b]}var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};e.uuid=this.uuid;e.type=this.type;""!==this.name&&(e.name=this.name);if(void 0!==this.parameters){var f=this.parameters,g;for(g in f)void 0!==f[g]&&(e[g]=f[g]);return e}f=[];for(g=0;g<this.vertices.length;g++){var h=this.vertices[g];f.push(h.x,h.y,h.z)}g=[];var l=[],k={},q=[],p={},m=[],r={};for(h=0;h<this.faces.length;h++){var t=this.faces[h],u=void 0!==this.faceVertexUvs[0][h],z=0<t.normal.length(),A=0<t.vertexNormals.length,x=1!==t.color.r||1!==t.color.g||1!==t.color.b,w=0<t.vertexColors.length,y=0;y=a(y,0,0);y=a(y,1,!0);y=a(y,2,!1);y=a(y,3,u);y=a(y,4,z);y=a(y,5,A);y=a(y,6,x);y=a(y,7,w);g.push(y);g.push(t.a,t.b,t.c);g.push(t.materialIndex);u&&(u=this.faceVertexUvs[0][h],g.push(d(u[0]),d(u[1]),d(u[2])));z&&g.push(b(t.normal));A&&(z=t.vertexNormals,g.push(b(z[0]),b(z[1]),b(z[2])));x&&g.push(c(t.color));w&&(t=t.vertexColors,g.push(c(t[0]),c(t[1]),c(t[2])))}e.data={};e.data.vertices=f;e.data.normals=l;0<q.length&&(e.data.colors=q);0<m.length&&(e.data.uvs=[m]);e.data.faces=g;return e},clone:function(){return(new J).copy(this)},copy:function(a){this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.name=a.name;for(var b=a.vertices,c=0,d=b.length;c<d;c++)this.vertices.push(b[c].clone());b=a.colors;c=0;for(d=b.length;c<d;c++)this.colors.push(b[c].clone());b=a.faces;c=0;for(d=b.length;c<d;c++)this.faces.push(b[c].clone());b=0;for(c=a.faceVertexUvs.length;b<c;b++){d=a.faceVertexUvs[b];void 0===this.faceVertexUvs[b]&&(this.faceVertexUvs[b]=[]);for(var e=0,f=d.length;e<f;e++){for(var g=d[e],h=[],l=0,k=g.length;l<k;l++)h.push(g[l].clone());this.faceVertexUvs[b].push(h)}}b=a.morphTargets;c=0;for(d=b.length;c<d;c++){e={};e.name=b[c].name;if(void 0!==b[c].vertices)for(e.vertices=[],f=0,g=b[c].vertices.length;f<g;f++)e.vertices.push(b[c].vertices[f].clone());if(void 0!==b[c].normals)for(e.normals=[],f=0,g=b[c].normals.length;f<g;f++)e.normals.push(b[c].normals[f].clone());this.morphTargets.push(e)}b=a.morphNormals;c=0;for(d=b.length;c<d;c++){e={};if(void 0!==b[c].vertexNormals)for(e.vertexNormals=[],f=0,g=b[c].vertexNormals.length;f<g;f++)h=b[c].vertexNormals[f],l={},l.a=h.a.clone(),l.b=h.b.clone(),l.c=h.c.clone(),e.vertexNormals.push(l);if(void 0!==b[c].faceNormals)for(e.faceNormals=[],f=0,g=b[c].faceNormals.length;f<g;f++)e.faceNormals.push(b[c].faceNormals[f].clone());this.morphNormals.push(e)}b=a.skinWeights;c=0;for(d=b.length;c<d;c++)this.skinWeights.push(b[c].clone());b=a.skinIndices;c=0;for(d=b.length;c<d;c++)this.skinIndices.push(b[c].clone());b=a.lineDistances;c=0;for(d=b.length;c<d;c++)this.lineDistances.push(b[c]);b=a.boundingBox;null!==b&&(this.boundingBox=b.clone());b=a.boundingSphere;null!==b&&(this.boundingSphere=b.clone());this.elementsNeedUpdate=a.elementsNeedUpdate;this.verticesNeedUpdate=a.verticesNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.lineDistancesNeedUpdate=a.lineDistancesNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var hh=function(a){function b(b,d,e,f,g,h){a.call(this);this.type="BoxGeometry";this.parameters={width:b,height:d,depth:e,widthSegments:f,heightSegments:g,depthSegments:h};this.fromBufferGeometry(new Fd(b,d,e,f,g,h));this.mergeVertices()}a&&(b.__proto__=a);b.prototype=Object.create(a&&a.prototype);return b.prototype.constructor=b}(J),Fd=function(a){function b(b,d,e,f,g,h){function c(a,b,c,d,e,f,g,h,l,n,w){var z=f/l,x=g/n,A=f/2,y=g/2,B=h/2;g=l+1;for(var E=n+1,C=f=0,D=new m,F=0;F<E;F++)for(var G=F*x-y,H=0;H<g;H++)D[a]=(H*z-A)*d,D[b]=G*e,D[c]=B,p.push(D.x,D.y,D.z),D[a]=0,D[b]=0,D[c]=0<h?1:-1,v.push(D.x,D.y,D.z),r.push(H/l),r.push(1-F/n),f+=1;for(a=0;a<n;a++)for(b=0;b<l;b++)c=t+b+g*(a+1),d=t+(b+1)+g*(a+1),e=t+(b+1)+g*a,q.push(t+b+g*a,c,e),q.push(c,d,e),C+=6;k.addGroup(u,C,w);u+=C;t+=f}void 0===b&&(b=1);void 0===d&&(d=1);void 0===e&&(e=1);void 0===f&&(f=1);void 0===g&&(g=1);void 0===h&&(h=1);a.call(this);this.type="BoxBufferGeometry";this.parameters={width:b,height:d,depth:e,widthSegments:f,heightSegments:g,depthSegments:h};var k=this;f=Math.floor(f);g=Math.floor(g);h=Math.floor(h);var q=[],p=[],v=[],r=[],t=0,u=0;c("z","y","x",-1,-1,e,d,b,h,g,0);c("z","y","x",1,-1,e,d,-b,h,g,1);c("x","z","y",1,1,b,e,d,f,h,2);c("x","z","y",1,-1,b,e,-d,f,h,3);c("x","y","z",1,-1,b,d,e,f,g,4);c("x","y","z",-1,-1,b,d,-e,f,g,5);this.setIndex(q);this.setAttribute("position",new C(p,3));this.setAttribute("normal",new C(v,3));this.setAttribute("uv",new C(r,2))}a&&(b.__proto__=a);b.prototype=Object.create(a&&a.prototype);return b.prototype.constructor=b}(D),Ph={clone:Cc,merge:xa};Ba.prototype=Object.create(K.prototype);Ba.prototype.constructor=Ba;Ba.prototype.isShaderMaterial=!0;Ba.prototype.copy=function(a){K.prototype.copy.call(this,a);this.fragmentShader=a.fragmentShader;this.vertexShader=a.vertexShader;this.uniforms=Cc(a.uniforms);this.defines=Object.assign({},a.defines);this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.lights=a.lights;this.clipping=a.clipping;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;this.extensions=Object.assign({},a.extensions);return this};Ba.prototype.toJSON=function(a){var b=K.prototype.toJSON.call(this,a);b.uniforms={};for(var c in this.uniforms){var d=this.uniforms[c].value;b.uniforms[c]=d&&d.isTexture?{type:"t",value:d.toJSON(a).uuid}:d&&d.isColor?{type:"c",value:d.getHex()}:d&&d.isVector2?{type:"v2",value:d.toArray()}:d&&d.isVector3?{type:"v3",value:d.toArray()}:d&&d.isVector4?{type:"v4",value:d.toArray()}:d&&d.isMatrix3?{type:"m3",value:d.toArray()}:d&&d.isMatrix4?{type:"m4",value:d.toArray()}:{value:d}}0<Object.keys(this.defines).length&&(b.defines=this.defines);b.vertexShader=this.vertexShader;b.fragmentShader=this.fragmentShader;a={};for(var e in this.extensions)!0===this.extensions[e]&&(a[e]=!0);0<Object.keys(a).length&&(b.extensions=a);return b};eb.prototype=Object.assign(Object.create(y.prototype),{constructor:eb,isCamera:!0,copy:function(a,b){y.prototype.copy.call(this,a,b);this.matrixWorldInverse.copy(a.matrixWorldInverse);this.projectionMatrix.copy(a.projectionMatrix);this.projectionMatrixInverse.copy(a.projectionMatrixInverse);return this},getWorldDirection:function(a){void 0===a&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),a=new m);this.updateMatrixWorld(!0);var b=this.matrixWorld.elements;return a.set(-b[8],-b[9],-b[10]).normalize()},updateMatrixWorld:function(a){y.prototype.updateMatrixWorld.call(this,a);this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(a,b){y.prototype.updateWorldMatrix.call(this,a,b);this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}});ma.prototype=Object.assign(Object.create(eb.prototype),{constructor:ma,isPerspectiveCamera:!0,copy:function(a,b){eb.prototype.copy.call(this,a,b);this.fov=a.fov;this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.focus=a.focus;this.aspect=a.aspect;this.view=null===a.view?null:Object.assign({},a.view);this.filmGauge=a.filmGauge;this.filmOffset=a.filmOffset;return this},setFocalLength:function(a){a=.5*this.getFilmHeight()/a;this.fov=2*P.RAD2DEG*Math.atan(a);this.updateProjectionMatrix()},getFocalLength:function(){var a=Math.tan(.5*P.DEG2RAD*this.fov);return.5*this.getFilmHeight()/a},getEffectiveFOV:function(){return 2*P.RAD2DEG*Math.atan(Math.tan(.5*P.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(a,b,c,d,e,f){this.aspect=a/b;null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1});this.view.enabled=!0;this.view.fullWidth=a;this.view.fullHeight=b;this.view.offsetX=c;this.view.offsetY=d;this.view.width=e;this.view.height=f;this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1);this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=this.near,b=a*Math.tan(.5*P.DEG2RAD*this.fov)/this.zoom,c=2*b,d=this.aspect*c,e=-.5*d,f=this.view;if(null!==this.view&&this.view.enabled){var g=f.fullWidth,h=f.fullHeight;e+=f.offsetX*d/g;b-=f.offsetY*c/h;d*=f.width/g;c*=f.height/h}f=this.filmOffset;0!==f&&(e+=a*f/this.getFilmWidth());this.projectionMatrix.makePerspective(e,e+d,b,b-c,a,this.far);this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(a){a=y.prototype.toJSON.call(this,a);a.object.fov=this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;null!==this.view&&(a.object.view=Object.assign({},this.view));a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return a}});Dc.prototype=Object.create(y.prototype);Dc.prototype.constructor=Dc;Yb.prototype=Object.create(Ea.prototype);Yb.prototype.constructor=Yb;Yb.prototype.isWebGLCubeRenderTarget=!0;Yb.prototype.fromEquirectangularTexture=function(a,b){this.texture.type=b.type;this.texture.format=b.format;this.texture.encoding=b.encoding;this.texture.generateMipmaps=b.generateMipmaps;this.texture.minFilter=b.minFilter;this.texture.magFilter=b.magFilter;var c=new wd,d=new Ba({name:"CubemapFromEquirect",uniforms:Cc({tEquirect:{value:null}}),vertexShader:"\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",fragmentShader:"\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t",side:1,blending:0});d.uniforms.tEquirect.value=b;b=new Z(new Fd(5,5,5),d);c.add(b);(new Dc(1,10,this)).update(a,c);b.geometry.dispose();b.material.dispose();return this};Zb.prototype=Object.create(V.prototype);Zb.prototype.constructor=Zb;Zb.prototype.isDataTexture=!0;var sd=new db,If=new m;Object.assign(Ec.prototype,{set:function(a,b,c,d,e,f){var g=this.planes;g[0].copy(a);g[1].copy(b);g[2].copy(c);g[3].copy(d);g[4].copy(e);g[5].copy(f);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var b=this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromProjectionMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],l=c[6],k=c[7],q=c[8],p=c[9],m=c[10],r=c[11],t=c[12],u=c[13],z=c[14];c=c[15];b[0].setComponents(f-a,k-g,r-q,c-t).normalize();b[1].setComponents(f+a,k+g,r+q,c+t).normalize();b[2].setComponents(f+d,k+h,r+p,c+u).normalize();b[3].setComponents(f-d,k-h,r-p,c-u).normalize();b[4].setComponents(f-e,k-l,r-m,c-z).normalize();b[5].setComponents(f+e,k+l,r+m,c+z).normalize();return this},intersectsObject:function(a){var b=a.geometry;null===b.boundingSphere&&b.computeBoundingSphere();sd.copy(b.boundingSphere).applyMatrix4(a.matrixWorld);return this.intersectsSphere(sd)},intersectsSprite:function(a){sd.center.set(0,0,0);sd.radius=.7071067811865476;sd.applyMatrix4(a.matrixWorld);return this.intersectsSphere(sd)},intersectsSphere:function(a){var b=this.planes,c=a.center;a=-a.radius;for(var d=0;6>d;d++)if(b[d].distanceToPoint(c)<a)return!1;return!0},intersectsBox:function(a){for(var b=this.planes,c=0;6>c;c++){var d=b[c];If.x=0<d.normal.x?a.max.x:a.min.x;If.y=0<d.normal.y?a.max.y:a.min.y;If.z=0<d.normal.z?a.max.z:a.min.z;if(0>d.distanceToPoint(If))return!1}return!0},containsPoint:function(a){for(var b=this.planes,c=0;6>c;c++)if(0>b[c].distanceToPoint(a))return!1;return!0}});var G={common:{diffuse:{value:new H(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new za},uv2Transform:{value:new za},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new w(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:2.5E-4},fogNear:{value:1},fogFar:{value:2E3},fogColor:{value:new H(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new H(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new za}},sprite:{diffuse:{value:new H(15658734)},opacity:{value:1},center:{value:new w(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new za}}};Ed.prototype=Object.create(J.prototype);Ed.prototype.constructor=Ed;$b.prototype=Object.create(D.prototype);$b.prototype.constructor=$b;var M={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);    } else if (face == 1.0) {\n      uv = vec2(-direction.x, -direction.z) / abs(direction.y);    } else if (face == 2.0) {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);    } else if (face == 3.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);    } else if (face == 4.0) {\n      uv = vec2(-direction.x, direction.z) / abs(direction.y);    } else {\n      uv = vec2(direction.x, direction.y) / abs(direction.z);    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Va={basic:{uniforms:xa([G.common,G.specularmap,G.envmap,G.aomap,G.lightmap,G.fog]),vertexShader:M.meshbasic_vert,fragmentShader:M.meshbasic_frag},lambert:{uniforms:xa([G.common,G.specularmap,G.envmap,G.aomap,G.lightmap,G.emissivemap,G.fog,G.lights,{emissive:{value:new H(0)}}]),vertexShader:M.meshlambert_vert,fragmentShader:M.meshlambert_frag},phong:{uniforms:xa([G.common,G.specularmap,G.envmap,G.aomap,G.lightmap,G.emissivemap,G.bumpmap,G.normalmap,G.displacementmap,G.fog,G.lights,{emissive:{value:new H(0)},specular:{value:new H(1118481)},shininess:{value:30}}]),vertexShader:M.meshphong_vert,fragmentShader:M.meshphong_frag},standard:{uniforms:xa([G.common,G.envmap,G.aomap,G.lightmap,G.emissivemap,G.bumpmap,G.normalmap,G.displacementmap,G.roughnessmap,G.metalnessmap,G.fog,G.lights,{emissive:{value:new H(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:M.meshphysical_vert,fragmentShader:M.meshphysical_frag},toon:{uniforms:xa([G.common,G.aomap,G.lightmap,G.emissivemap,G.bumpmap,G.normalmap,G.displacementmap,G.gradientmap,G.fog,G.lights,{emissive:{value:new H(0)}}]),vertexShader:M.meshtoon_vert,fragmentShader:M.meshtoon_frag},matcap:{uniforms:xa([G.common,G.bumpmap,G.normalmap,G.displacementmap,G.fog,{matcap:{value:null}}]),vertexShader:M.meshmatcap_vert,fragmentShader:M.meshmatcap_frag},points:{uniforms:xa([G.points,G.fog]),vertexShader:M.points_vert,fragmentShader:M.points_frag},dashed:{uniforms:xa([G.common,G.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:M.linedashed_vert,fragmentShader:M.linedashed_frag},depth:{uniforms:xa([G.common,G.displacementmap]),vertexShader:M.depth_vert,fragmentShader:M.depth_frag},normal:{uniforms:xa([G.common,G.bumpmap,G.normalmap,G.displacementmap,{opacity:{value:1}}]),vertexShader:M.normal_vert,fragmentShader:M.normal_frag},sprite:{uniforms:xa([G.sprite,G.fog]),vertexShader:M.sprite_vert,fragmentShader:M.sprite_frag},background:{uniforms:{uvTransform:{value:new za},t2D:{value:null}},vertexShader:M.background_vert,fragmentShader:M.background_frag},cube:{uniforms:xa([G.envmap,{opacity:{value:1}}]),vertexShader:M.cube_vert,fragmentShader:M.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:M.equirect_vert,fragmentShader:M.equirect_frag},distanceRGBA:{uniforms:xa([G.common,G.displacementmap,{referencePosition:{value:new m},nearDistance:{value:1},farDistance:{value:1E3}}]),vertexShader:M.distanceRGBA_vert,fragmentShader:M.distanceRGBA_frag},shadow:{uniforms:xa([G.lights,G.fog,{color:{value:new H(0)},opacity:{value:1}}]),vertexShader:M.shadow_vert,fragmentShader:M.shadow_frag}};Va.physical={uniforms:xa([Va.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new w(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new H(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:M.meshphysical_vert,fragmentShader:M.meshphysical_frag};ob.prototype=Object.create(V.prototype);ob.prototype.constructor=ob;ob.prototype.isCubeTexture=!0;Object.defineProperty(ob.prototype,"images",{get:function(){return this.image},set:function(a){this.image=a}});Fc.prototype=Object.create(V.prototype);Fc.prototype.constructor=Fc;Fc.prototype.isDataTexture2DArray=!0;Gc.prototype=Object.create(V.prototype);Gc.prototype.constructor=Gc;Gc.prototype.isDataTexture3D=!0;var Ch=new V,Gj=new Fc,Ij=new Gc,Dh=new ob,wh=[],yh=[],Bh=new Float32Array(16),Ah=new Float32Array(9),zh=new Float32Array(4);Eh.prototype.updateCache=function(a){var b=this.cache;a instanceof Float32Array&&b.length!==a.length&&(this.cache=new Float32Array(a.length));Aa(b,a)};Fh.prototype.setValue=function(a,b,c){for(var d=this.seq,e=0,f=d.length;e!==f;++e){var g=d[e];g.setValue(a,b[g.id],c)}};var gg=/([\w\d_]+)(\])?(\[|\.)?/g;Db.prototype.setValue=function(a,b,c,d){b=this.map[b];void 0!==b&&b.setValue(a,c,d)};Db.prototype.setOptional=function(a,b,c){b=b[c];void 0!==b&&this.setValue(a,c,b)};Db.upload=function(a,b,c,d){for(var e=0,f=b.length;e!==f;++e){var g=b[e],h=c[g.id];!1!==h.needsUpdate&&g.setValue(a,h.value,d)}};Db.seqWithValue=function(a,b){for(var c=[],d=0,e=a.length;d!==e;++d){var f=a[d];f.id in b&&c.push(f)}return c};var nk=0,ig=/^[ \t]*#include +<([\w\d./]+)>/gm,Oh=/#pragma unroll_loop[\s]+?for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Nh=/#pragma unroll_loop_start[\s]+?for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g,xk=0;Eb.prototype=Object.create(K.prototype);Eb.prototype.constructor=Eb;Eb.prototype.isMeshDepthMaterial=!0;Eb.prototype.copy=function(a){K.prototype.copy.call(this,a);this.depthPacking=a.depthPacking;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};Fb.prototype=Object.create(K.prototype);Fb.prototype.constructor=Fb;Fb.prototype.isMeshDistanceMaterial=!0;Fb.prototype.copy=function(a){K.prototype.copy.call(this,a);this.referencePosition.copy(a.referencePosition);this.nearDistance=a.nearDistance;this.farDistance=a.farDistance;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;return this};Je.prototype=Object.assign(Object.create(ma.prototype),{constructor:Je,isArrayCamera:!0});Ic.prototype=Object.assign(Object.create(y.prototype),{constructor:Ic,isGroup:!0});Object.assign(Ke.prototype,{constructor:Ke,getTargetRaySpace:function(){null===this._targetRay&&(this._targetRay=new Ic,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1);return this._targetRay},getGripSpace:function(){null===this._grip&&(this._grip=new Ic,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1);return this._grip},dispatchEvent:function(a){null!==this._targetRay&&this._targetRay.dispatchEvent(a);null!==this._grip&&this._grip.dispatchEvent(a);return this},disconnect:function(a){this.dispatchEvent({type:"disconnected",data:a});null!==this._targetRay&&(this._targetRay.visible=!1);null!==this._grip&&(this._grip.visible=!1);return this},update:function(a,b,c){var d=null,e=null,f=this._targetRay,g=this._grip;a&&(null!==f&&(d=b.getPose(a.targetRaySpace,c),null!==d&&(f.matrix.fromArray(d.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale))),null!==g&&a.gripSpace&&(e=b.getPose(a.gripSpace,c),null!==e&&(g.matrix.fromArray(e.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale))));null!==f&&(f.visible=null!==d);null!==g&&(g.visible=null!==e);return this}});Object.assign(Uh.prototype,ra.prototype);mg.prototype=Object.assign(Object.create(Jd.prototype),{constructor:mg,isWebGL1Renderer:!0});Object.assign(Le.prototype,{isFogExp2:!0,clone:function(){return new Le(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}});Object.assign(Me.prototype,{isFog:!0,clone:function(){return new Me(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}});Object.defineProperty(Ia.prototype,"needsUpdate",{set:function(a){!0===a&&this.version++}});Object.assign(Ia.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(a){this.usage=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.count=a.count;this.stride=a.stride;this.usage=a.usage;return this},copyAt:function(a,b,c){a*=this.stride;c*=b.stride;for(var d=0,e=this.stride;d<e;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},clone:function(a){void 0===a.arrayBuffers&&(a.arrayBuffers={});void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=P.generateUUID());void 0===a.arrayBuffers[this.array.buffer._uuid]&&(a.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);a=new this.array.constructor(a.arrayBuffers[this.array.buffer._uuid]);a=new Ia(a,this.stride);a.setUsage(this.usage);return a},onUpload:function(a){this.onUploadCallback=a;return this},toJSON:function(a){void 0===a.arrayBuffers&&(a.arrayBuffers={});void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=P.generateUUID());void 0===a.arrayBuffers[this.array.buffer._uuid]&&(a.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer)));return{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});var rc=new m;Object.defineProperties(Hb.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(a){this.data.needsUpdate=a}}});Object.assign(Hb.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(a){for(var b=0,c=this.data.count;b<c;b++)rc.x=this.getX(b),rc.y=this.getY(b),rc.z=this.getZ(b),rc.applyMatrix4(a),this.setXYZ(b,rc.x,rc.y,rc.z);return this},setX:function(a,b){this.data.array[a*this.data.stride+this.offset]=b;return this},setY:function(a,b){this.data.array[a*this.data.stride+this.offset+1]=b;return this},setZ:function(a,b){this.data.array[a*this.data.stride+this.offset+2]=b;return this},setW:function(a,b){this.data.array[a*this.data.stride+this.offset+3]=b;return this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+this.offset+
1]},getZ:function(a){return this.data.array[a*this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,b,c){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+
1]=c;this.data.array[a+2]=d;this.data.array[a+3]=e;return this},clone:function(a){if(void 0===a){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");a=[];for(var b=0;b<this.count;b++)for(var c=b*this.data.stride+this.offset,d=0;d<this.itemSize;d++)a.push(this.data.array[c+d]);return new F(new this.array.constructor(a),this.itemSize,this.normalized)}void 0===a.interleavedBuffers&&(a.interleavedBuffers={});void 0===a.interleavedBuffers[this.data.uuid]&&(a.interleavedBuffers[this.data.uuid]=this.data.clone(a));return new Hb(a.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(a){if(void 0===a){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");a=[];for(var b=0;b<this.count;b++)for(var c=b*this.data.stride+this.offset,d=0;d<this.itemSize;d++)a.push(this.data.array[c+d]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:a,normalized:this.normalized}}void 0===a.interleavedBuffers&&(a.interleavedBuffers={});void 0===a.interleavedBuffers[this.data.uuid]&&(a.interleavedBuffers[this.data.uuid]=this.data.toJSON(a));return{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}});Ib.prototype=Object.create(K.prototype);Ib.prototype.constructor=Ib;Ib.prototype.isSpriteMaterial=!0;Ib.prototype.copy=function(a){K.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.alphaMap=a.alphaMap;this.rotation=a.rotation;this.sizeAttenuation=a.sizeAttenuation;return this};var Jc,we=new m,td=new m,ud=new m,Kc=new w,Ld=new w,Wh=new T,Jf=new m,xe=new m,Kf=new m,Di=new w,ih=new w,Ei=new w;Kd.prototype=Object.assign(Object.create(y.prototype),{constructor:Kd,isSprite:!0,raycast:function(a,b){null===a.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.');td.setFromMatrixScale(this.matrixWorld);Wh.copy(a.camera.matrixWorld);this.modelViewMatrix.multiplyMatrices(a.camera.matrixWorldInverse,this.matrixWorld);ud.setFromMatrixPosition(this.modelViewMatrix);a.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&td.multiplyScalar(-ud.z);var c=this.material.rotation;if(0!==c){var d=Math.cos(c);var e=Math.sin(c)}c=this.center;Ne(Jf.set(-.5,-.5,0),ud,c,td,e,d);Ne(xe.set(.5,-.5,0),ud,c,td,e,d);Ne(Kf.set(.5,.5,0),ud,c,td,e,d);Di.set(0,0);ih.set(1,0);Ei.set(1,1);var f=a.ray.intersectTriangle(Jf,xe,Kf,!1,we);if(null===f&&(Ne(xe.set(-.5,.5,0),ud,c,td,e,d),ih.set(0,1),f=a.ray.intersectTriangle(Jf,Kf,xe,!1,we),null===f))return;e=a.ray.origin.distanceTo(we);e<a.near||e>a.far||b.push({distance:e,point:we.clone(),uv:sa.getUV(we,Jf,xe,Kf,Di,ih,Ei,new w),face:null,object:this})},copy:function(a){y.prototype.copy.call(this,a);void 0!==a.center&&this.center.copy(a.center);this.material=a.material;return this}});var Lf=new m,Fi=new m;Md.prototype=Object.assign(Object.create(y.prototype),{constructor:Md,isLOD:!0,copy:function(a){y.prototype.copy.call(this,a,!1);for(var b=a.levels,c=0,d=b.length;c<d;c++){var e=b[c];this.addLevel(e.object.clone(),e.distance)}this.autoUpdate=a.autoUpdate;return this},addLevel:function(a,b){void 0===b&&(b=0);b=Math.abs(b);var c=this.levels,d;for(d=0;d<c.length&&!(b<c[d].distance);d++);c.splice(d,0,{distance:b,object:a});this.add(a);return this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(a){var b=this.levels;if(0<b.length){var c;var d=1;for(c=b.length;d<c&&!(a<b[d].distance);d++);return b[d-1].object}return null},raycast:function(a,b){if(0<this.levels.length){Lf.setFromMatrixPosition(this.matrixWorld);var c=a.ray.origin.distanceTo(Lf);this.getObjectForDistance(c).raycast(a,b)}},update:function(a){var b=this.levels;if(1<b.length){Lf.setFromMatrixPosition(a.matrixWorld);Fi.setFromMatrixPosition(this.matrixWorld);a=Lf.distanceTo(Fi)/a.zoom;b[0].object.visible=!0;var c;var d=1;for(c=b.length;d<c;d++)if(a>=b[d].distance)b[d-1].object.visible=!1,b[d].object.visible=!0;else break;for(this._currentLevel=d-1;d<c;d++)b[d].object.visible=!1}},toJSON:function(a){a=y.prototype.toJSON.call(this,a);!1===this.autoUpdate&&(a.object.autoUpdate=!1);a.object.levels=[];for(var b=this.levels,c=0,d=b.length;c<d;c++){var e=b[c];a.object.levels.push({object:e.object.uuid,distance:e.distance})}return a}});Oe.prototype=Object.assign(Object.create(Z.prototype),{constructor:Oe,isSkinnedMesh:!0,copy:function(a){Z.prototype.copy.call(this,a);this.bindMode=a.bindMode;this.bindMatrix.copy(a.bindMatrix);this.bindMatrixInverse.copy(a.bindMatrixInverse);this.skeleton=a.skeleton;return this},bind:function(a,b){this.skeleton=a;void 0===b&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),b=this.matrixWorld);this.bindMatrix.copy(b);this.bindMatrixInverse.getInverse(b)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var a=new ba,b=this.geometry.attributes.skinWeight,c=0,d=b.count;c<d;c++){a.x=b.getX(c);a.y=b.getY(c);a.z=b.getZ(c);a.w=b.getW(c);var e=1/a.manhattanLength();Infinity!==e?a.multiplyScalar(e):a.set(1,0,0,0);b.setXYZW(c,a.x,a.y,a.z,a.w)}},updateMatrixWorld:function(a){Z.prototype.updateMatrixWorld.call(this,a);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(){var a=new m,b=new ba,c=new ba,d=new m,e=new T;return function(f,g){var h=this.skeleton,l=this.geometry;b.fromBufferAttribute(l.attributes.skinIndex,f);c.fromBufferAttribute(l.attributes.skinWeight,f);a.fromBufferAttribute(l.attributes.position,f).applyMatrix4(this.bindMatrix);g.set(0,0,0);for(f=0;4>f;f++)if(l=c.getComponent(f),0!==l){var k=b.getComponent(f);e.multiplyMatrices(h.bones[k].matrixWorld,h.boneInverses[k]);g.addScaledVector(d.copy(a).applyMatrix4(e),l)}return g.applyMatrix4(this.bindMatrixInverse)}}()});var Gi=new T,Sk=new T;Object.assign(Pe.prototype,{calculateInverses:function(){this.boneInverses=[];for(var a=0,b=this.bones.length;a<b;a++){var c=new T;this.bones[a]&&c.getInverse(this.bones[a].matrixWorld);this.boneInverses.push(c)}},pose:function(){for(var a=0,b=this.bones.length;a<b;a++){var c=this.bones[a];c&&c.matrixWorld.getInverse(this.boneInverses[a])}a=0;for(b=this.bones.length;a<b;a++)if(c=this.bones[a])c.parent&&c.parent.isBone?(c.matrix.getInverse(c.parent.matrixWorld),c.matrix.multiply(c.matrixWorld)):c.matrix.copy(c.matrixWorld),c.matrix.decompose(c.position,c.quaternion,c.scale)},update:function(){for(var a=this.bones,b=this.boneInverses,c=this.boneMatrices,d=this.boneTexture,e=0,f=a.length;e<f;e++)Gi.multiplyMatrices(a[e]?a[e].matrixWorld:Sk,b[e]),Gi.toArray(c,16*e);void 0!==d&&(d.needsUpdate=!0)},clone:function(){return new Pe(this.bones,this.boneInverses)},getBoneByName:function(a){for(var b=0,c=this.bones.length;b<c;b++){var d=this.bones[b];if(d.name===a)return d}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}});ng.prototype=Object.assign(Object.create(y.prototype),{constructor:ng,isBone:!0});var Hi=new T,Ii=new T,Mf=[],ye=new Z;Qe.prototype=Object.assign(Object.create(Z.prototype),{constructor:Qe,isInstancedMesh:!0,copy:function(a){Z.prototype.copy.call(this,a);this.instanceMatrix.copy(a.instanceMatrix);this.count=a.count;return this},getMatrixAt:function(a,b){b.fromArray(this.instanceMatrix.array,16*a)},raycast:function(a,b){var c=this.matrixWorld,d=this.count;ye.geometry=this.geometry;ye.material=this.material;if(void 0!==ye.material)for(var e=0;e<d;e++){this.getMatrixAt(e,Hi);Ii.multiplyMatrices(c,Hi);ye.matrixWorld=Ii;ye.raycast(a,Mf);for(var f=0,g=Mf.length;f<g;f++){var h=Mf[f];h.instanceId=e;h.object=this;b.push(h)}Mf.length=0}},setMatrixAt:function(a,b){b.toArray(this.instanceMatrix.array,16*a)},updateMorphTargets:function(){}});ia.prototype=Object.create(K.prototype);ia.prototype.constructor=ia;ia.prototype.isLineBasicMaterial=!0;ia.prototype.copy=function(a){K.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.linecap=a.linecap;this.linejoin=a.linejoin;this.morphTargets=a.morphTargets;return this};var Ji=new m,Ki=new m,Li=new T,Nf=new Vb,ze=new db;Ja.prototype=Object.assign(Object.create(y.prototype),{constructor:Ja,isLine:!0,copy:function(a){y.prototype.copy.call(this,a);this.material=a.material;this.geometry=a.geometry;return this},computeLineDistances:function(){var a=this.geometry;if(a.isBufferGeometry)if(null===a.index){for(var b=a.attributes.position,c=[0],d=1,e=b.count;d<e;d++)Ji.fromBufferAttribute(b,d-1),Ki.fromBufferAttribute(b,d),c[d]=c[d-1],c[d]+=Ji.distanceTo(Ki);a.setAttribute("lineDistance",new C(c,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(a.isGeometry)for(b=a.vertices,a=a.lineDistances,a[0]=0,c=1,d=b.length;c<d;c++)a[c]=a[c-1],a[c]+=b[c-1].distanceTo(b[c]);return this},raycast:function(a,b){var c=this.geometry,d=this.matrixWorld,e=a.params.Line.threshold;null===c.boundingSphere&&c.computeBoundingSphere();ze.copy(c.boundingSphere);ze.applyMatrix4(d);ze.radius+=e;if(!1!==a.ray.intersectsSphere(ze)){Li.getInverse(d);Nf.copy(a.ray).applyMatrix4(Li);d=e/((this.scale.x+this.scale.y+this.scale.z)/3);d*=d;var f=new m,g=new m;e=new m;var h=new m,l=this&&this.isLineSegments?2:1;if(c.isBufferGeometry){var k=c.index;c=c.attributes.position.array;if(null!==k){k=k.array;for(var q=0,p=k.length-1;q<p;q+=l){var v=k[q+1];f.fromArray(c,3*k[q]);g.fromArray(c,3*v);Nf.distanceSqToSegment(f,g,h,e)>d||(h.applyMatrix4(this.matrixWorld),v=a.ray.origin.distanceTo(h),v<a.near||v>a.far||b.push({distance:v,point:e.clone().applyMatrix4(this.matrixWorld),index:q,face:null,faceIndex:null,object:this}))}}else for(k=0,q=c.length/3-1;k<q;k+=l)f.fromArray(c,3*k),g.fromArray(c,3*k+3),Nf.distanceSqToSegment(f,g,h,e)>d||(h.applyMatrix4(this.matrixWorld),p=a.ray.origin.distanceTo(h),p<a.near||p>a.far||b.push({distance:p,point:e.clone().applyMatrix4(this.matrixWorld),index:k,face:null,faceIndex:null,object:this}))}else if(c.isGeometry)for(f=c.vertices,g=f.length,c=0;c<g-1;c+=l)Nf.distanceSqToSegment(f[c],f[c+1],h,e)>d||(h.applyMatrix4(this.matrixWorld),k=a.ray.origin.distanceTo(h),k<a.near||k>a.far||b.push({distance:k,point:e.clone().applyMatrix4(this.matrixWorld),index:c,face:null,faceIndex:null,object:this}))}},updateMorphTargets:function(){var a=this.geometry;if(a.isBufferGeometry){a=a.morphAttributes;var b=Object.keys(a);if(0<b.length&&(a=a[b[0]],void 0!==a)){this.morphTargetInfluences=[];this.morphTargetDictionary={};b=0;for(var c=a.length;b<c;b++){var d=a[b].name||String(b);this.morphTargetInfluences.push(0);this.morphTargetDictionary[d]=b}}}else a=a.morphTargets,void 0!==a&&0<a.length&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}});var Of=new m,Pf=new m;da.prototype=Object.assign(Object.create(Ja.prototype),{constructor:da,isLineSegments:!0,computeLineDistances:function(){var a=this.geometry;if(a.isBufferGeometry)if(null===a.index){for(var b=a.attributes.position,c=[],d=0,e=b.count;d<e;d+=2)Of.fromBufferAttribute(b,d),Pf.fromBufferAttribute(b,d+1),c[d]=0===d?0:c[d-1],c[d+1]=c[d]+Of.distanceTo(Pf);a.setAttribute("lineDistance",new C(c,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(a.isGeometry)for(b=a.vertices,a=a.lineDistances,c=0,d=b.length;c<d;c+=2)Of.copy(b[c]),Pf.copy(b[c+1]),a[c]=0===c?0:a[c-1],a[c+1]=a[c]+Of.distanceTo(Pf);return this}});Re.prototype=Object.assign(Object.create(Ja.prototype),{constructor:Re,isLineLoop:!0});Wa.prototype=Object.create(K.prototype);Wa.prototype.constructor=Wa;Wa.prototype.isPointsMaterial=!0;Wa.prototype.copy=function(a){K.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.alphaMap=a.alphaMap;this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;this.morphTargets=a.morphTargets;return this};var Mi=new T,pg=new Vb,Ae=new db,Qf=new m;Lc.prototype=Object.assign(Object.create(y.prototype),{constructor:Lc,isPoints:!0,copy:function(a){y.prototype.copy.call(this,a);this.material=a.material;this.geometry=a.geometry;return this},raycast:function(a,b){var c=this.geometry,d=this.matrixWorld,e=a.params.Points.threshold;null===c.boundingSphere&&c.computeBoundingSphere();Ae.copy(c.boundingSphere);Ae.applyMatrix4(d);Ae.radius+=e;if(!1!==a.ray.intersectsSphere(Ae))if(Mi.getInverse(d),pg.copy(a.ray).applyMatrix4(Mi),e/=(this.scale.x+this.scale.y+this.scale.z)/3,e*=e,c.isBufferGeometry){var f=c.index;c=c.attributes.position.array;if(null!==f){f=f.array;for(var g=0,h=f.length;g<h;g++){var l=f[g];Qf.fromArray(c,3*l);og(Qf,l,e,d,a,b,this)}}else for(f=0,g=c.length/3;f<g;f++)Qf.fromArray(c,3*f),og(Qf,f,e,d,a,b,this)}else for(c=c.vertices,f=0,g=c.length;f<g;f++)og(c[f],f,e,d,a,b,this)},updateMorphTargets:function(){var a=this.geometry;if(a.isBufferGeometry){a=a.morphAttributes;var b=Object.keys(a);if(0<b.length&&(a=a[b[0]],void 0!==a)){this.morphTargetInfluences=[];this.morphTargetDictionary={};b=0;for(var c=a.length;b<c;b++){var d=a[b].name||String(b);this.morphTargetInfluences.push(0);this.morphTargetDictionary[d]=b}}}else a=a.morphTargets,void 0!==a&&0<a.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}});qg.prototype=Object.assign(Object.create(V.prototype),{constructor:qg,isVideoTexture:!0,update:function(){var a=this.image;!1==="requestVideoFrameCallback"in a&&a.readyState>=a.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});Mc.prototype=Object.create(V.prototype);Mc.prototype.constructor=Mc;Mc.prototype.isCompressedTexture=!0;Nd.prototype=Object.create(V.prototype);Nd.prototype.constructor=Nd;Nd.prototype.isCanvasTexture=!0;Od.prototype=Object.create(V.prototype);Od.prototype.constructor=Od;Od.prototype.isDepthTexture=!0;Nc.prototype=Object.create(D.prototype);Nc.prototype.constructor=Nc;Pd.prototype=Object.create(J.prototype);Pd.prototype.constructor=Pd;Oc.prototype=Object.create(D.prototype);Oc.prototype.constructor=Oc;Qd.prototype=Object.create(J.prototype);Qd.prototype.constructor=Qd;ha.prototype=Object.create(D.prototype);ha.prototype.constructor=ha;Rd.prototype=Object.create(J.prototype);Rd.prototype.constructor=Rd;Pc.prototype=Object.create(ha.prototype);Pc.prototype.constructor=Pc;Sd.prototype=Object.create(J.prototype);Sd.prototype.constructor=Sd;bc.prototype=Object.create(ha.prototype);bc.prototype.constructor=bc;Td.prototype=Object.create(J.prototype);Td.prototype.constructor=Td;Qc.prototype=Object.create(ha.prototype);Qc.prototype.constructor=Qc;Ud.prototype=Object.create(J.prototype);Ud.prototype.constructor=Ud;Rc.prototype=Object.create(ha.prototype);Rc.prototype.constructor=Rc;Vd.prototype=Object.create(J.prototype);Vd.prototype.constructor=Vd;cc.prototype=Object.create(D.prototype);cc.prototype.constructor=cc;cc.prototype.toJSON=function(){var a=D.prototype.toJSON.call(this);a.path=this.parameters.path.toJSON();return a};Wd.prototype=Object.create(J.prototype);Wd.prototype.constructor=Wd;Sc.prototype=Object.create(D.prototype);Sc.prototype.constructor=Sc;Xd.prototype=Object.create(J.prototype);Xd.prototype.constructor=Xd;Tc.prototype=Object.create(D.prototype);Tc.prototype.constructor=Tc;var Tk={triangulate:function(a,b,c){c=c||2;var d=b&&b.length,e=d?b[0]*c:a.length,f=Xh(a,0,e,c,!0),g=[];if(!f||f.next===f.prev)return g;var h;if(d){var l=c;d=[];var k;var m=0;for(k=b.length;m<k;m++){var p=b[m]*l;var v=m<k-1?b[m+1]*l:a.length;p=Xh(a,p,v,l,!1);p===p.next&&(p.steiner=!0);d.push(Fk(p))}d.sort(Dk);for(m=0;m<d.length;m++){l=d[m];b=f;if(b=Ek(l,b))l=$h(b,l),Jb(b,b.next),Jb(l,l.next);f=Jb(f,f.next)}}if(a.length>80*c){var r=h=a[0];var t=d=a[1];for(l=c;l<e;l+=c)m=a[l],b=a[l+1],m<r&&(r=m),b<t&&(t=b),m>h&&(h=m),b>d&&(d=b);h=Math.max(h-r,d-t);h=0!==h?1/h:0}Zd(f,g,c,r,t,h);return g}},pb={area:function(a){for(var b=a.length,c=0,d=b-1,e=0;e<b;d=e++)c+=a[d].x*a[e].y-a[e].x*a[d].y;return.5*c},isClockWise:function(a){return 0>pb.area(a)},triangulateShape:function(a,b){var c=[],d=[],e=[];ai(a);bi(c,a);a=a.length;b.forEach(ai);for(var f=0;f<b.length;f++)d.push(a),a+=b[f].length,bi(c,b[f]);b=Tk.triangulate(c,d);for(c=0;c<b.length;c+=3)e.push(b.slice(c,c+3));return e}};dc.prototype=Object.create(J.prototype);dc.prototype.constructor=dc;dc.prototype.toJSON=function(){var a=J.prototype.toJSON.call(this);return ci(this.parameters.shapes,this.parameters.options,a)};fb.prototype=Object.create(D.prototype);fb.prototype.constructor=fb;fb.prototype.toJSON=function(){var a=D.prototype.toJSON.call(this);return ci(this.parameters.shapes,this.parameters.options,a)};var Gk={generateTopUV:function(a,b,c,d,e){a=b[3*d];d=b[3*d+1];var f=b[3*e];e=b[3*e+1];return[new w(b[3*c],b[3*c+1]),new w(a,d),new w(f,e)]},generateSideWallUV:function(a,b,c,d,e,f){a=b[3*c];var g=b[3*c+1];c=b[3*c+2];var h=b[3*d],l=b[3*d+1];d=b[3*d+2];var k=b[3*e],m=b[3*e+1];e=b[3*e+2];var p=b[3*f],v=b[3*f+1];b=b[3*f+2];return.01>Math.abs(g-l)?[new w(a,1-c),new w(h,1-d),new w(k,1-e),new w(p,1-b)]:[new w(g,1-c),new w(l,1-d),new w(m,1-e),new w(v,1-b)]}};ae.prototype=Object.create(J.prototype);ae.prototype.constructor=ae;Vc.prototype=Object.create(fb.prototype);Vc.prototype.constructor=Vc;be.prototype=Object.create(J.prototype);be.prototype.constructor=be;ec.prototype=Object.create(D.prototype);ec.prototype.constructor=ec;ce.prototype=Object.create(J.prototype);ce.prototype.constructor=ce;Wc.prototype=Object.create(D.prototype);Wc.prototype.constructor=Wc;de.prototype=Object.create(J.prototype);de.prototype.constructor=de;Xc.prototype=Object.create(D.prototype);Xc.prototype.constructor=Xc;fc.prototype=Object.create(J.prototype);fc.prototype.constructor=fc;fc.prototype.toJSON=function(){var a=J.prototype.toJSON.call(this);return di(this.parameters.shapes,a)};gc.prototype=Object.create(D.prototype);gc.prototype.constructor=gc;gc.prototype.toJSON=function(){var a=D.prototype.toJSON.call(this);return di(this.parameters.shapes,a)};Yc.prototype=Object.create(D.prototype);Yc.prototype.constructor=Yc;hc.prototype=Object.create(J.prototype);hc.prototype.constructor=hc;qb.prototype=Object.create(D.prototype);qb.prototype.constructor=qb;ee.prototype=Object.create(hc.prototype);ee.prototype.constructor=ee;fe.prototype=Object.create(qb.prototype);fe.prototype.constructor=fe;ge.prototype=Object.create(J.prototype);ge.prototype.constructor=ge;Zc.prototype=Object.create(D.prototype);Zc.prototype.constructor=Zc;var Da=Object.freeze({__proto__:null,WireframeGeometry:Nc,ParametricGeometry:Pd,ParametricBufferGeometry:Oc,TetrahedronGeometry:Rd,TetrahedronBufferGeometry:Pc,OctahedronGeometry:Sd,OctahedronBufferGeometry:bc,IcosahedronGeometry:Td,IcosahedronBufferGeometry:Qc,DodecahedronGeometry:Ud,DodecahedronBufferGeometry:Rc,PolyhedronGeometry:Qd,PolyhedronBufferGeometry:ha,TubeGeometry:Vd,TubeBufferGeometry:cc,TorusKnotGeometry:Wd,TorusKnotBufferGeometry:Sc,TorusGeometry:Xd,TorusBufferGeometry:Tc,TextGeometry:ae,TextBufferGeometry:Vc,SphereGeometry:be,SphereBufferGeometry:ec,RingGeometry:ce,RingBufferGeometry:Wc,PlaneGeometry:Ed,PlaneBufferGeometry:$b,LatheGeometry:de,LatheBufferGeometry:Xc,ShapeGeometry:fc,ShapeBufferGeometry:gc,ExtrudeGeometry:dc,ExtrudeBufferGeometry:fb,EdgesGeometry:Yc,ConeGeometry:ee,ConeBufferGeometry:fe,CylinderGeometry:hc,CylinderBufferGeometry:qb,CircleGeometry:ge,CircleBufferGeometry:Zc,BoxGeometry:hh,BoxBufferGeometry:Fd});ic.prototype=Object.create(K.prototype);ic.prototype.constructor=ic;ic.prototype.isShadowMaterial=!0;ic.prototype.copy=function(a){K.prototype.copy.call(this,a);this.color.copy(a.color);return this};rb.prototype=Object.create(Ba.prototype);rb.prototype.constructor=rb;rb.prototype.isRawShaderMaterial=!0;gb.prototype=Object.create(K.prototype);gb.prototype.constructor=gb;gb.prototype.isMeshStandardMaterial=!0;gb.prototype.copy=function(a){K.prototype.copy.call(this,a);this.defines={STANDARD:""};this.color.copy(a.color);this.roughness=a.roughness;this.metalness=a.metalness;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalMapType=a.normalMapType;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=a.roughnessMap;this.metalnessMap=a.metalnessMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;this.vertexTangents=a.vertexTangents;return this};Kb.prototype=Object.create(gb.prototype);Kb.prototype.constructor=Kb;Kb.prototype.isMeshPhysicalMaterial=!0;Kb.prototype.copy=function(a){gb.prototype.copy.call(this,a);this.defines={STANDARD:"",PHYSICAL:""};this.clearcoat=a.clearcoat;this.clearcoatMap=a.clearcoatMap;this.clearcoatRoughness=a.clearcoatRoughness;this.clearcoatRoughnessMap=a.clearcoatRoughnessMap;this.clearcoatNormalMap=a.clearcoatNormalMap;this.clearcoatNormalScale.copy(a.clearcoatNormalScale);this.reflectivity=a.reflectivity;this.sheen=a.sheen?(this.sheen||new H).copy(a.sheen):null;this.transmission=a.transmission;this.transmissionMap=a.transmissionMap;return this};Lb.prototype=Object.create(K.prototype);Lb.prototype.constructor=Lb;Lb.prototype.isMeshPhongMaterial=!0;Lb.prototype.copy=function(a){K.prototype.copy.call(this,a);this.color.copy(a.color);this.specular.copy(a.specular);this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalMapType=a.normalMapType;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};jc.prototype=Object.create(K.prototype);jc.prototype.constructor=jc;jc.prototype.isMeshToonMaterial=!0;jc.prototype.copy=function(a){K.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.gradientMap=a.gradientMap;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalMapType=a.normalMapType;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.alphaMap=a.alphaMap;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};kc.prototype=Object.create(K.prototype);kc.prototype.constructor=kc;kc.prototype.isMeshNormalMaterial=!0;kc.prototype.copy=function(a){K.prototype.copy.call(this,a);this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalMapType=a.normalMapType;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};lc.prototype=Object.create(K.prototype);lc.prototype.constructor=lc;lc.prototype.isMeshLambertMaterial=!0;lc.prototype.copy=function(a){K.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};mc.prototype=Object.create(K.prototype);mc.prototype.constructor=mc;mc.prototype.isMeshMatcapMaterial=!0;mc.prototype.copy=function(a){K.prototype.copy.call(this,a);this.defines={MATCAP:""};this.color.copy(a.color);this.matcap=a.matcap;this.map=a.map;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalMapType=a.normalMapType;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.alphaMap=a.alphaMap;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};nc.prototype=Object.create(ia.prototype);nc.prototype.constructor=nc;nc.prototype.isLineDashedMaterial=!0;nc.prototype.copy=function(a){ia.prototype.copy.call(this,a);this.scale=a.scale;this.dashSize=a.dashSize;this.gapSize=a.gapSize;return this};var Uk=Object.freeze({__proto__:null,ShadowMaterial:ic,SpriteMaterial:Ib,RawShaderMaterial:rb,ShaderMaterial:Ba,PointsMaterial:Wa,MeshPhysicalMaterial:Kb,MeshStandardMaterial:gb,MeshPhongMaterial:Lb,MeshToonMaterial:jc,MeshNormalMaterial:kc,MeshLambertMaterial:lc,MeshDepthMaterial:Eb,MeshDistanceMaterial:Fb,MeshBasicMaterial:Na,MeshMatcapMaterial:mc,LineDashedMaterial:nc,LineBasicMaterial:ia,Material:K}),X={arraySlice:function(a,b,c){return X.isTypedArray(a)?new a.constructor(a.subarray(b,void 0!==c?c:a.length)):a.slice(b,c)},convertArray:function(a,b,c){return!a||!c&&a.constructor===b?a:"number"===typeof b.BYTES_PER_ELEMENT?new b(a):Array.prototype.slice.call(a)},isTypedArray:function(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)},getKeyframeOrder:function(a){for(var b=a.length,c=Array(b),d=0;d!==b;++d)c[d]=d;c.sort(function(b,c){return a[b]-a[c]});return c},sortedArray:function(a,b,c){for(var d=a.length,e=new a.constructor(d),f=0,g=0;g!==d;++f)for(var h=c[f]*b,l=0;l!==b;++l)e[g++]=a[h+l];return e},flattenJSON:function(a,b,c,d){for(var e=1,f=a[0];void 0!==f&&void 0===f[d];)f=a[e++];if(void 0!==f){var g=f[d];if(void 0!==g)if(Array.isArray(g)){do g=f[d],void 0!==g&&(b.push(f.time),c.push.apply(c,g)),f=a[e++];while(void 0!==f)}else if(void 0!==g.toArray){do g=f[d],void 0!==g&&(b.push(f.time),g.toArray(c,c.length)),f=a[e++];while(void 0!==f)}else{do g=f[d],void 0!==g&&(b.push(f.time),c.push(g)),f=a[e++];while(void 0!==f)}}},subclip:function(a,b,c,d,e){e=e||30;a=a.clone();a.name=b;b=[];for(var f=0;f<a.tracks.length;++f){for(var g=a.tracks[f],h=g.getValueSize(),l=[],k=[],m=0;m<g.times.length;++m){var p=g.times[m]*e;if(!(p<c||p>=d))for(l.push(g.times[m]),p=0;p<h;++p)k.push(g.values[m*h+p])}0!==l.length&&(g.times=X.convertArray(l,g.times.constructor),g.values=X.convertArray(k,g.values.constructor),b.push(g))}a.tracks=b;c=Infinity;for(d=0;d<a.tracks.length;++d)c>a.tracks[d].times[0]&&(c=a.tracks[d].times[0]);for(d=0;d<a.tracks.length;++d)a.tracks[d].shift(-1*c);a.resetDuration();return a},makeClipAdditive:function(a,b,c,d){void 0===b&&(b=0);void 0===c&&(c=a);if(void 0===d||0>=d)d=30;var e=a.tracks.length,f=b/d;b=function(b){var d=c.tracks[b],e=d.ValueTypeName;if("bool"!==e&&"string"!==e&&(b=a.tracks.find(function(a){return a.name===d.name&&a.ValueTypeName===e}),void 0!==b)){var g=d.getValueSize(),k=d.times.length-1,p=void 0;f<=d.times[0]?p=X.arraySlice(d.values,0,d.valueSize):f>=d.times[k]?p=X.arraySlice(d.values,k*g):(p=d.createInterpolant(),p.evaluate(f),p=p.resultBuffer);"quaternion"===e&&(new S(p[0],p[1],p[2],p[3])).normalize().conjugate().toArray(p);k=b.times.length;for(var m=0;m<k;++m){var r=m*g;if("quaternion"===e)S.multiplyQuaternionsFlat(b.values,r,p,0,b.values,r);else for(var t=0;t<g;++t)b.values[r+t]-=p[t]}}};for(d=0;d<e;++d)b(d);a.blendMode=2501;return a}};Object.assign(Ka.prototype,{evaluate:function(a){var b=this.parameterPositions,c=this._cachedIndex,d=b[c],e=b[c-1];a:{b:{c:{d:if(!(a<d)){for(var f=c+2;;){if(void 0===d){if(a<e)break d;this._cachedIndex=c=b.length;return this.afterEnd_(c-1,a,e)}if(c===f)break;e=d;d=b[++c];if(a<d)break b}d=b.length;break c}if(a>=e)break a;else{f=b[1];a<f&&(c=2,e=f);for(f=c-2;;){if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(c===f)break;d=e;e=b[--c-1];if(a>=e)break b}d=c;c=0}}for(;c<d;)e=c+d>>>1,a<b[e]?d=e:c=e+1;d=b[c];e=b[c-1];if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(void 0===d)return this._cachedIndex=c=b.length,this.afterEnd_(c-1,e,a)}this._cachedIndex=c;this.intervalChanged_(c,e,d)}return this.interpolate_(c,e,a,d)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(a){var b=this.resultBuffer,c=this.sampleValues,d=this.valueSize;a*=d;for(var e=0;e!==d;++e)b[e]=c[a+e];return b},interpolate_:function(){throw Error("call to abstract method");},intervalChanged_:function(){}});Object.assign(Ka.prototype,{beforeStart_:Ka.prototype.copySampleValue_,afterEnd_:Ka.prototype.copySampleValue_});Ve.prototype=Object.assign(Object.create(Ka.prototype),{constructor:Ve,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(a,b,c){var d=this.parameterPositions,e=a-2,f=a+1,g=d[e],h=d[f];if(void 0===g)switch(this.getSettings_().endingStart){case 2401:e=a;g=2*b-c;break;case 2402:e=d.length-2;g=b+d[e]-d[e+1];break;default:e=a,g=c}if(void 0===h)switch(this.getSettings_().endingEnd){case 2401:f=a;h=2*c-b;break;case 2402:f=1;h=c+d[1]-d[0];break;default:f=a-1,h=b}a=.5*(c-b);d=this.valueSize;this._weightPrev=a/(b-g);this._weightNext=a/(h-c);this._offsetPrev=e*d;this._offsetNext=f*d},interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;var h=a-g,k=this._offsetPrev,n=this._offsetNext,m=this._weightPrev,p=this._weightNext,v=(c-b)/(d-b);c=v*v;d=c*v;b=-m*d+2*m*c-m*v;m=(1+m)*d+(-1.5-2*m)*c+(-.5+m)*v+1;v=(-1-p)*d+(1.5+p)*c+.5*v;p=p*d-p*c;for(c=0;c!==g;++c)e[c]=b*f[k+c]+m*f[h+c]+v*f[a+c]+p*f[n+c];return e}});he.prototype=Object.assign(Object.create(Ka.prototype),{constructor:he,interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;var h=a-g;b=(c-b)/(d-b);c=1-b;for(d=0;d!==g;++d)e[d]=f[h+d]*c+f[a+d]*b;return e}});We.prototype=Object.assign(Object.create(Ka.prototype),{constructor:We,interpolate_:function(a){return this.copySampleValue_(a-1)}});Object.assign(ta,{toJSON:function(a){var b=a.constructor;if(void 0!==b.toJSON)b=b.toJSON(a);else{b={name:a.name,times:X.convertArray(a.times,Array),values:X.convertArray(a.values,Array)};var c=a.getInterpolation();c!==a.DefaultInterpolation&&(b.interpolation=c)}b.type=a.ValueTypeName;return b}});Object.assign(ta.prototype,{constructor:ta,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(a){return new We(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodLinear:function(a){return new he(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:function(a){return new Ve(this.times,this.values,this.getValueSize(),a)},setInterpolation:function(a){switch(a){case 2300:var b=this.InterpolantFactoryMethodDiscrete;break;case 2301:b=this.InterpolantFactoryMethodLinear;break;case 2302:b=this.InterpolantFactoryMethodSmooth}if(void 0===b){b="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(b);console.warn("THREE.KeyframeTrack:",b);return this}this.createInterpolant=b;return this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(a){if(0!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]+=a;return this},scale:function(a){if(1!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]*=a;return this},trim:function(a,b){for(var c=this.times,d=c.length,e=0,f=d-1;e!==d&&c[e]<a;)++e;for(;-1!==f&&c[f]>b;)--f;++f;if(0!==e||f!==d)e>=f&&(f=Math.max(f,1),e=f-1),a=this.getValueSize(),this.times=X.arraySlice(c,e,f),this.values=X.arraySlice(this.values,e*a,f*a);return this},validate:function(){var a=!0,b=this.getValueSize();0!==b-Math.floor(b)&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),a=!1);var c=this.times;b=this.values;var d=c.length;0===d&&(console.error("THREE.KeyframeTrack: Track is empty.",this),a=!1);for(var e=null,f=0;f!==d;f++){var g=c[f];if("number"===typeof g&&isNaN(g)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,f,g);a=!1;break}if(null!==e&&e>g){console.error("THREE.KeyframeTrack: Out of order keys.",this,f,g,e);a=!1;break}e=g}if(void 0!==b&&X.isTypedArray(b))for(c=0,d=b.length;c!==d;++c)if(e=b[c],isNaN(e)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,c,e);a=!1;break}return a},optimize:function(){for(var a=X.arraySlice(this.times),b=X.arraySlice(this.values),c=this.getValueSize(),d=2302===this.getInterpolation(),e=a.length-1,f=1,g=1;g<e;++g){var h=!1,k=a[g];if(k!==a[g+1]&&(1!==g||k!==k[0]))if(d)h=!0;else{k=g*c;for(var n=k-c,m=k+c,p=0;p!==c;++p){var v=b[k+p];if(v!==b[n+p]||v!==b[m+p]){h=!0;break}}}if(h){if(g!==f)for(a[f]=a[g],h=g*c,k=f*c,n=0;n!==c;++n)b[k+n]=b[h+n];++f}}if(0<e){a[f]=a[e];d=e*c;e=f*c;for(g=0;g!==c;++g)b[e+g]=b[d+g];++f}f!==a.length?(this.times=X.arraySlice(a,0,f),this.values=X.arraySlice(b,0,f*c)):(this.times=a,this.values=b);return this},clone:function(){var a=X.arraySlice(this.times,0),b=X.arraySlice(this.values,0);a=new this.constructor(this.name,a,b);a.createInterpolant=this.createInterpolant;return a}});Xe.prototype=Object.assign(Object.create(ta.prototype),{constructor:Xe,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});Ye.prototype=Object.assign(Object.create(ta.prototype),{constructor:Ye,ValueTypeName:"color"});$c.prototype=Object.assign(Object.create(ta.prototype),{constructor:$c,ValueTypeName:"number"});Ze.prototype=Object.assign(Object.create(Ka.prototype),{constructor:Ze,interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;b=(c-b)/(d-b);a*=g;for(c=a+g;a!==c;a+=4)S.slerpFlat(e,0,f,a-g,f,a,b);return e}});ie.prototype=Object.assign(Object.create(ta.prototype),{constructor:ie,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(a){return new Ze(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:void 0});$e.prototype=Object.assign(Object.create(ta.prototype),{constructor:$e,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});ad.prototype=Object.assign(Object.create(ta.prototype),{constructor:ad,ValueTypeName:"vector"});Object.assign(Qa,{parse:function(a){for(var b=[],c=a.tracks,d=1/(a.fps||1),e=0,f=c.length;e!==f;++e)b.push(Ik(c[e]).scale(d));return new Qa(a.name,a.duration,b,a.blendMode)},toJSON:function(a){var b=[],c=a.tracks;a={name:a.name,duration:a.duration,tracks:b,uuid:a.uuid,blendMode:a.blendMode};for(var d=0,e=c.length;d!==e;++d)b.push(ta.toJSON(c[d]));return a},CreateFromMorphTargetSequence:function(a,b,c,d){for(var e=b.length,f=[],g=0;g<e;g++){var h=[],k=[];h.push((g+e-1)%e,g,(g+1)%e);k.push(0,1,0);var n=X.getKeyframeOrder(h);h=X.sortedArray(h,1,n);k=X.sortedArray(k,1,n);d||0!==h[0]||(h.push(e),k.push(k[0]));f.push((new $c(".morphTargetInfluences["+b[g].name+"]",h,k)).scale(1/c))}return new Qa(a,-1,f)},findByName:function(a,b){var c=a;Array.isArray(a)||(c=a.geometry&&a.geometry.animations||a.animations);for(a=0;a<c.length;a++)if(c[a].name===b)return c[a];return null},CreateClipsFromMorphTargetSequences:function(a,b,c){for(var d={},e=/^([\w-]*?)([\d]+)$/,f=0,g=a.length;f<g;f++){var h=a[f],k=h.name.match(e);if(k&&1<k.length){k=k[1];var n=d[k];n||(d[k]=n=[]);n.push(h)}}a=[];for(var m in d)a.push(Qa.CreateFromMorphTargetSequence(m,d[m],b,c));return a},parseAnimation:function(a,b){if(!a)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;var c=function(a,b,c,d,e){if(0!==c.length){var f=[],g=[];X.flattenJSON(c,f,g,d);0!==f.length&&e.push(new a(b,f,g))}},d=[],e=a.name||"default",f=a.fps||30,g=a.blendMode,h=a.length||-1;a=a.hierarchy||[];for(var k=0;k<a.length;k++){var n=a[k].keys;if(n&&0!==n.length)if(n[0].morphTargets){h={};var m=void 0;for(m=0;m<n.length;m++)if(n[m].morphTargets)for(var p=0;p<n[m].morphTargets.length;p++)h[n[m].morphTargets[p]]=-1;for(var v in h){p=[];for(var r=[],t=0;t!==n[m].morphTargets.length;++t){var u=n[m];p.push(u.time);r.push(u.morphTarget===v?1:0)}d.push(new $c(".morphTargetInfluence["+v+"]",p,r))}h=h.length*(f||1)}else m=".bones["+b[k].name+"]",c(ad,m+".position",n,"pos",d),c(ie,m+".quaternion",n,"rot",d),c(ad,m+".scale",n,"scl",d)}return 0===d.length?null:new Qa(e,h,d,g)}});Object.assign(Qa.prototype,{resetDuration:function(){for(var a=0,b=0,c=this.tracks.length;b!==c;++b){var d=this.tracks[b];a=Math.max(a,d.times[d.times.length-1])}this.duration=a;return this},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this},validate:function(){for(var a=!0,b=0;b<this.tracks.length;b++)a=a&&this.tracks[b].validate();return a},optimize:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this},clone:function(){for(var a=[],b=0;b<this.tracks.length;b++)a.push(this.tracks[b].clone());return new Qa(this.name,this.duration,a,this.blendMode)}});var sc={enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}},ei=new tg;Object.assign(U.prototype,{load:function(){},loadAsync:function(a,b){var c=this;return new Promise(function(d,e){c.load(a,d,b,e)})},parse:function(){},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this},setResourcePath:function(a){this.resourcePath=a;return this},setRequestHeader:function(a){this.requestHeader=a;return this}});var cb={};Ra.prototype=Object.assign(Object.create(U.prototype),{constructor:Ra,load:function(a,b,c,d){void 0===a&&(a="");void 0!==this.path&&(a=this.path+
a);a=this.manager.resolveURL(a);var e=this,f=sc.get(a);if(void 0!==f)return e.manager.itemStart(a),setTimeout(function(){b&&b(f);e.manager.itemEnd(a)},0),f;if(void 0!==cb[a])cb[a].push({onLoad:b,onProgress:c,onError:d});else{var g=a.match(/^data:(.*?)(;base64)?,(.*)$/);if(g){c=g[1];var h=!!g[2];g=g[3];g=decodeURIComponent(g);h&&(g=atob(g));try{var k=(this.responseType||"").toLowerCase();switch(k){case"arraybuffer":case"blob":var n=new Uint8Array(g.length);for(h=0;h<g.length;h++)n[h]=g.charCodeAt(h);var m="blob"===k?new Blob([n.buffer],{type:c}):n.buffer;break;case"document":m=(new DOMParser).parseFromString(g,c);break;case"json":m=JSON.parse(g);break;default:m=g}setTimeout(function(){b&&b(m);e.manager.itemEnd(a)},0)}catch(v){setTimeout(function(){d&&d(v);e.manager.itemError(a);e.manager.itemEnd(a)},0)}}else{cb[a]=[];cb[a].push({onLoad:b,onProgress:c,onError:d});var p=new XMLHttpRequest;p.open("GET",a,!0);p.addEventListener("load",function(b){var c=this.response,d=cb[a];delete cb[a];if(200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");sc.add(a,c);b=0;for(var f=d.length;b<f;b++){var g=d[b];if(g.onLoad)g.onLoad(c)}}else{c=0;for(f=d.length;c<f;c++)if(g=d[c],g.onError)g.onError(b);e.manager.itemError(a)}e.manager.itemEnd(a)},!1);p.addEventListener("progress",function(b){for(var c=cb[a],d=0,e=c.length;d<e;d++){var f=c[d];if(f.onProgress)f.onProgress(b)}},!1);p.addEventListener("error",function(b){var c=cb[a];delete cb[a];for(var d=0,f=c.length;d<f;d++){var g=c[d];if(g.onError)g.onError(b)}e.manager.itemError(a);e.manager.itemEnd(a)},!1);p.addEventListener("abort",function(b){var c=cb[a];delete cb[a];for(var d=0,f=c.length;d<f;d++){var g=c[d];if(g.onError)g.onError(b)}e.manager.itemError(a);e.manager.itemEnd(a)},!1);void 0!==this.responseType&&(p.responseType=this.responseType);void 0!==this.withCredentials&&(p.withCredentials=this.withCredentials);p.overrideMimeType&&p.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(h in this.requestHeader)p.setRequestHeader(h,this.requestHeader[h]);p.send(null)}e.manager.itemStart(a);return p}},setResponseType:function(a){this.responseType=a;return this},setWithCredentials:function(a){this.withCredentials=a;return this},setMimeType:function(a){this.mimeType=a;return this}});ug.prototype=Object.assign(Object.create(U.prototype),{constructor:ug,load:function(a,b,c,d){var e=this,f=new Ra(e.manager);f.setPath(e.path);f.setRequestHeader(e.requestHeader);f.load(a,function(c){try{b(e.parse(JSON.parse(c)))}catch(h){d?d(h):console.error(h),e.manager.itemError(a)}},c,d)},parse:function(a){for(var b=[],c=0;c<a.length;c++){var d=Qa.parse(a[c]);b.push(d)}return b}});vg.prototype=Object.assign(Object.create(U.prototype),{constructor:vg,load:function(a,b,c,d){function e(e){k.load(a[e],function(a){a=f.parse(a,!0);g[e]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps};n+=1;6===n&&(1===a.mipmapCount&&(h.minFilter=1006),h.format=a.format,h.needsUpdate=!0,b&&b(h))},c,d)}var f=this,g=[],h=new Mc;h.image=g;var k=new Ra(this.manager);k.setPath(this.path);k.setResponseType("arraybuffer");k.setRequestHeader(this.requestHeader);var n=0;if(Array.isArray(a))for(var m=0,p=a.length;m<p;++m)e(m);else k.load(a,function(a){a=f.parse(a,!0);if(a.isCubemap)for(var c=a.mipmaps.length/a.mipmapCount,d=0;d<c;d++){g[d]={mipmaps:[]};for(var e=0;e<a.mipmapCount;e++)g[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+e]),g[d].format=a.format,g[d].width=a.width,g[d].height=a.height}else h.image.width=a.width,h.image.height=a.height,h.mipmaps=a.mipmaps;1===a.mipmapCount&&(h.minFilter=1006);h.format=a.format;h.needsUpdate=!0;b&&b(h)},c,d);return h}});af.prototype=Object.assign(Object.create(U.prototype),{constructor:af,load:function(a,b,c,d){var e=this,f=new Zb,g=new Ra(this.manager);g.setResponseType("arraybuffer");g.setRequestHeader(this.requestHeader);g.setPath(this.path);g.load(a,function(a){if(a=e.parse(a))void 0!==a.image?f.image=a.image:void 0!==a.data&&(f.image.width=a.width,f.image.height=a.height,f.image.data=a.data),f.wrapS=void 0!==a.wrapS?a.wrapS:1001,f.wrapT=void 0!==a.wrapT?a.wrapT:1001,f.magFilter=void 0!==a.magFilter?a.magFilter:1006,f.minFilter=void 0!==a.minFilter?a.minFilter:1006,f.anisotropy=void 0!==a.anisotropy?a.anisotropy:1,void 0!==a.format&&(f.format=a.format),void 0!==a.type&&(f.type=a.type),void 0!==a.mipmaps&&(f.mipmaps=a.mipmaps,f.minFilter=1008),1===a.mipmapCount&&(f.minFilter=1006),f.needsUpdate=!0,b&&b(f,a)},c,d);return f}});bd.prototype=Object.assign(Object.create(U.prototype),{constructor:bd,load:function(a,b,c,d){function e(){k.removeEventListener("load",e,!1);k.removeEventListener("error",f,!1);sc.add(a,this);b&&b(this);g.manager.itemEnd(a)}function f(b){k.removeEventListener("load",e,!1);k.removeEventListener("error",f,!1);d&&d(b);g.manager.itemError(a);g.manager.itemEnd(a)}void 0!==this.path&&(a=this.path+a);a=this.manager.resolveURL(a);var g=this,h=sc.get(a);if(void 0!==h)return g.manager.itemStart(a),setTimeout(function(){b&&b(h);g.manager.itemEnd(a)},0),h;var k=document.createElementNS("http://www.w3.org/1999/xhtml","img");k.addEventListener("load",e,!1);k.addEventListener("error",f,!1);"data:"!==a.substr(0,5)&&void 0!==this.crossOrigin&&(k.crossOrigin=this.crossOrigin);g.manager.itemStart(a);k.src=a;return k}});bf.prototype=Object.assign(Object.create(U.prototype),{constructor:bf,load:function(a,b,c,d){function e(c){g.load(a[c],function(a){f.images[c]=a;h++;6===h&&(f.needsUpdate=!0,b&&b(f))},void 0,d)}var f=new ob,g=new bd(this.manager);g.setCrossOrigin(this.crossOrigin);g.setPath(this.path);var h=0;for(c=0;c<a.length;++c)e(c);return f}});cf.prototype=Object.assign(Object.create(U.prototype),{constructor:cf,load:function(a,b,c,d){var e=new V,f=new bd(this.manager);f.setCrossOrigin(this.crossOrigin);f.setPath(this.path);f.load(a,function(c){e.image=c;c=0<a.search(/\.jpe?g($|\?)/i)||0===a.search(/^data:image\/jpeg/);e.format=c?1022:1023;e.needsUpdate=!0;void 0!==b&&b(e)},c,d);return e}});Object.assign(I.prototype,{getPoint:function(){console.warn("THREE.Curve: .getPoint() not implemented.");return null},getPointAt:function(a,b){a=this.getUtoTmapping(a);return this.getPoint(a,b)},getPoints:function(a){void 0===a&&(a=5);for(var b=[],c=0;c<=a;c++)b.push(this.getPoint(c/a));return b},getSpacedPoints:function(a){void 0===a&&(a=5);for(var b=[],c=0;c<=a;c++)b.push(this.getPointAt(c/a));return b},getLength:function(){var a=this.getLengths();return a[a.length-1]},getLengths:function(a){void 0===a&&(a=this.arcLengthDivisions);if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b=[],c=this.getPoint(0),d=0;b.push(0);for(var e=1;e<=a;e++){var f=this.getPoint(e/a);d+=f.distanceTo(c);b.push(d);c=f}return this.cacheArcLengths=b},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(a,b){var c=this.getLengths(),d=c.length;b=b?b:a*c[d-1];for(var e=0,f=d-1,g;e<=f;)if(a=Math.floor(e+(f-e)/2),g=c[a]-b,0>g)e=a+1;else if(0<g)f=a-1;else{f=a;break}a=f;if(c[a]===b)return a/(d-1);e=c[a];return(a+(b-e)/(c[a+1]-e))/(d-1)},getTangent:function(a,b){var c=a-1E-4;a+=1E-4;0>c&&(c=0);1<a&&(a=1);c=this.getPoint(c);a=this.getPoint(a);b=b||(c.isVector2?new w:new m);b.copy(a).sub(c).normalize();return b},getTangentAt:function(a,b){a=this.getUtoTmapping(a);return this.getTangent(a,b)},computeFrenetFrames:function(a,b){for(var c=new m,d=[],e=[],f=[],g=new m,h=new T,k=0;k<=a;k++)d[k]=this.getTangentAt(k/a,new m),d[k].normalize();e[0]=new m;f[0]=new m;k=Number.MAX_VALUE;var n=Math.abs(d[0].x),q=Math.abs(d[0].y),p=Math.abs(d[0].z);n<=k&&(k=n,c.set(1,0,0));q<=k&&(k=q,c.set(0,1,0));p<=k&&c.set(0,0,1);g.crossVectors(d[0],c).normalize();e[0].crossVectors(d[0],g);f[0].crossVectors(d[0],e[0]);for(c=1;c<=a;c++)e[c]=e[c-1].clone(),f[c]=f[c-1].clone(),g.crossVectors(d[c-1],d[c]),g.length()>Number.EPSILON&&(g.normalize(),k=Math.acos(P.clamp(d[c-1].dot(d[c]),-1,1)),e[c].applyMatrix4(h.makeRotationAxis(g,k))),f[c].crossVectors(d[c],e[c]);if(!0===b)for(b=Math.acos(P.clamp(e[0].dot(e[a]),-1,1)),b/=a,0<d[0].dot(g.crossVectors(e[0],e[a]))&&(b=-b),g=1;g<=a;g++)e[g].applyMatrix4(h.makeRotationAxis(d[g],b*g)),f[g].crossVectors(d[g],e[g]);return{tangents:d,normals:e,binormals:f}},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.arcLengthDivisions=a.arcLengthDivisions;return this},toJSON:function(){var a={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};a.arcLengthDivisions=this.arcLengthDivisions;a.type=this.type;return a},fromJSON:function(a){this.arcLengthDivisions=a.arcLengthDivisions;return this}});La.prototype=Object.create(I.prototype);La.prototype.constructor=La;La.prototype.isEllipseCurve=!0;La.prototype.getPoint=function(a,b){b=b||new w;for(var c=2*Math.PI,d=this.aEndAngle-this.aStartAngle,e=Math.abs(d)<Number.EPSILON;0>d;)d+=c;for(;d>c;)d-=c;d<Number.EPSILON&&(d=e?0:c);!0!==this.aClockwise||e||(d=d===c?-c:d-c);c=this.aStartAngle+a*d;a=this.aX+this.xRadius*Math.cos(c);var f=this.aY+this.yRadius*Math.sin(c);0!==this.aRotation&&(c=Math.cos(this.aRotation),d=Math.sin(this.aRotation),e=a-this.aX,f-=this.aY,a=e*c-f*d+this.aX,f=e*d+f*c+this.aY);return b.set(a,f)};La.prototype.copy=function(a){I.prototype.copy.call(this,a);this.aX=a.aX;this.aY=a.aY;this.xRadius=a.xRadius;this.yRadius=a.yRadius;this.aStartAngle=a.aStartAngle;this.aEndAngle=a.aEndAngle;this.aClockwise=a.aClockwise;this.aRotation=a.aRotation;return this};La.prototype.toJSON=function(){var a=I.prototype.toJSON.call(this);a.aX=this.aX;a.aY=this.aY;a.xRadius=this.xRadius;a.yRadius=this.yRadius;a.aStartAngle=this.aStartAngle;a.aEndAngle=this.aEndAngle;a.aClockwise=this.aClockwise;a.aRotation=this.aRotation;return a};La.prototype.fromJSON=function(a){I.prototype.fromJSON.call(this,a);this.aX=a.aX;this.aY=a.aY;this.xRadius=a.xRadius;this.yRadius=a.yRadius;this.aStartAngle=a.aStartAngle;this.aEndAngle=a.aEndAngle;this.aClockwise=a.aClockwise;this.aRotation=a.aRotation;return this};cd.prototype=Object.create(La.prototype);cd.prototype.constructor=cd;cd.prototype.isArcCurve=!0;var Rf=new m,jh=new wg,kh=new wg,lh=new wg;ua.prototype=Object.create(I.prototype);ua.prototype.constructor=ua;ua.prototype.isCatmullRomCurve3=!0;ua.prototype.getPoint=function(a,b){b=b||new m;var c=this.points,d=c.length;a*=d-(this.closed?0:1);var e=Math.floor(a);a-=e;this.closed?e+=0<e?0:(Math.floor(Math.abs(e)/d)+1)*d:0===a&&e===d-1&&(e=d-2,a=1);if(this.closed||0<e)var f=c[(e-1)%d];else Rf.subVectors(c[0],c[1]).add(c[0]),f=Rf;var g=c[e%d];var h=c[(e+1)%d];this.closed||e+2<d?c=c[(e+2)%d]:(Rf.subVectors(c[d-1],c[d-2]).add(c[d-1]),c=Rf);if("centripetal"===this.curveType||"chordal"===this.curveType){var k="chordal"===this.curveType?.5:.25;d=Math.pow(f.distanceToSquared(g),k);e=Math.pow(g.distanceToSquared(h),k);k=Math.pow(h.distanceToSquared(c),k);1E-4>e&&(e=1);1E-4>d&&(d=e);1E-4>k&&(k=e);jh.initNonuniformCatmullRom(f.x,g.x,h.x,c.x,d,e,k);kh.initNonuniformCatmullRom(f.y,g.y,h.y,c.y,d,e,k);lh.initNonuniformCatmullRom(f.z,g.z,h.z,c.z,d,e,k)}else"catmullrom"===this.curveType&&(jh.initCatmullRom(f.x,g.x,h.x,c.x,this.tension),kh.initCatmullRom(f.y,g.y,h.y,c.y,this.tension),lh.initCatmullRom(f.z,g.z,h.z,c.z,this.tension));b.set(jh.calc(a),kh.calc(a),lh.calc(a));return b};ua.prototype.copy=function(a){I.prototype.copy.call(this,a);this.points=[];for(var b=0,c=a.points.length;b<c;b++)this.points.push(a.points[b].clone());this.closed=a.closed;this.curveType=a.curveType;this.tension=a.tension;return this};ua.prototype.toJSON=function(){var a=I.prototype.toJSON.call(this);a.points=[];for(var b=0,c=this.points.length;b<c;b++)a.points.push(this.points[b].toArray());a.closed=this.closed;a.curveType=this.curveType;a.tension=this.tension;return a};ua.prototype.fromJSON=function(a){I.prototype.fromJSON.call(this,a);this.points=[];for(var b=0,c=a.points.length;b<c;b++){var d=a.points[b];this.points.push((new m).fromArray(d))}this.closed=a.closed;this.curveType=a.curveType;this.tension=a.tension;return this};Xa.prototype=Object.create(I.prototype);Xa.prototype.constructor=Xa;Xa.prototype.isCubicBezierCurve=!0;Xa.prototype.getPoint=function(a,b){b=b||new w;var c=this.v0,d=this.v1,e=this.v2,f=this.v3;b.set(ke(a,c.x,d.x,e.x,f.x),ke(a,c.y,d.y,e.y,f.y));return b};Xa.prototype.copy=function(a){I.prototype.copy.call(this,a);this.v0.copy(a.v0);this.v1.copy(a.v1);this.v2.copy(a.v2);this.v3.copy(a.v3);return this};Xa.prototype.toJSON=function(){var a=I.prototype.toJSON.call(this);a.v0=this.v0.toArray();a.v1=this.v1.toArray();a.v2=this.v2.toArray();a.v3=this.v3.toArray();return a};Xa.prototype.fromJSON=function(a){I.prototype.fromJSON.call(this,a);this.v0.fromArray(a.v0);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);this.v3.fromArray(a.v3);return this};hb.prototype=Object.create(I.prototype);hb.prototype.constructor=hb;hb.prototype.isCubicBezierCurve3=!0;hb.prototype.getPoint=function(a,b){b=b||new m;var c=this.v0,d=this.v1,e=this.v2,f=this.v3;b.set(ke(a,c.x,d.x,e.x,f.x),ke(a,c.y,d.y,e.y,f.y),ke(a,c.z,d.z,e.z,f.z));return b};hb.prototype.copy=function(a){I.prototype.copy.call(this,a);this.v0.copy(a.v0);this.v1.copy(a.v1);this.v2.copy(a.v2);this.v3.copy(a.v3);return this};hb.prototype.toJSON=function(){var a=I.prototype.toJSON.call(this);a.v0=this.v0.toArray();a.v1=this.v1.toArray();a.v2=this.v2.toArray();a.v3=this.v3.toArray();return a};hb.prototype.fromJSON=function(a){I.prototype.fromJSON.call(this,a);this.v0.fromArray(a.v0);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);this.v3.fromArray(a.v3);return this};va.prototype=Object.create(I.prototype);va.prototype.constructor=va;va.prototype.isLineCurve=!0;va.prototype.getPoint=function(a,b){b=b||new w;1===a?b.copy(this.v2):(b.copy(this.v2).sub(this.v1),b.multiplyScalar(a).add(this.v1));return b};va.prototype.getPointAt=function(a,b){return this.getPoint(a,b)};va.prototype.getTangent=function(a,b){a=b||new w;a.copy(this.v2).sub(this.v1).normalize();return a};va.prototype.copy=function(a){I.prototype.copy.call(this,a);this.v1.copy(a.v1);this.v2.copy(a.v2);return this};va.prototype.toJSON=function(){var a=I.prototype.toJSON.call(this);a.v1=this.v1.toArray();a.v2=this.v2.toArray();return a};va.prototype.fromJSON=function(a){I.prototype.fromJSON.call(this,a);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);return this};Ya.prototype=Object.create(I.prototype);Ya.prototype.constructor=Ya;Ya.prototype.isLineCurve3=!0;Ya.prototype.getPoint=function(a,b){b=b||new m;1===a?b.copy(this.v2):(b.copy(this.v2).sub(this.v1),b.multiplyScalar(a).add(this.v1));return b};Ya.prototype.getPointAt=function(a,b){return this.getPoint(a,b)};Ya.prototype.copy=function(a){I.prototype.copy.call(this,a);this.v1.copy(a.v1);this.v2.copy(a.v2);return this};Ya.prototype.toJSON=function(){var a=I.prototype.toJSON.call(this);a.v1=this.v1.toArray();a.v2=this.v2.toArray();return a};Ya.prototype.fromJSON=function(a){I.prototype.fromJSON.call(this,a);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);return this};Za.prototype=Object.create(I.prototype);Za.prototype.constructor=Za;Za.prototype.isQuadraticBezierCurve=!0;Za.prototype.getPoint=function(a,b){b=b||new w;var c=this.v0,d=this.v1,e=this.v2;b.set(je(a,c.x,d.x,e.x),je(a,c.y,d.y,e.y));return b};Za.prototype.copy=function(a){I.prototype.copy.call(this,a);this.v0.copy(a.v0);this.v1.copy(a.v1);this.v2.copy(a.v2);return this};Za.prototype.toJSON=function(){var a=I.prototype.toJSON.call(this);a.v0=this.v0.toArray();a.v1=this.v1.toArray();a.v2=this.v2.toArray();return a};Za.prototype.fromJSON=function(a){I.prototype.fromJSON.call(this,a);this.v0.fromArray(a.v0);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);return this};ib.prototype=Object.create(I.prototype);ib.prototype.constructor=ib;ib.prototype.isQuadraticBezierCurve3=!0;ib.prototype.getPoint=function(a,b){b=b||new m;var c=this.v0,d=this.v1,e=this.v2;b.set(je(a,c.x,d.x,e.x),je(a,c.y,d.y,e.y),je(a,c.z,d.z,e.z));return b};ib.prototype.copy=function(a){I.prototype.copy.call(this,a);this.v0.copy(a.v0);this.v1.copy(a.v1);this.v2.copy(a.v2);return this};ib.prototype.toJSON=function(){var a=I.prototype.toJSON.call(this);a.v0=this.v0.toArray();a.v1=this.v1.toArray();a.v2=this.v2.toArray();return a};ib.prototype.fromJSON=function(a){I.prototype.fromJSON.call(this,a);this.v0.fromArray(a.v0);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);return this};$a.prototype=Object.create(I.prototype);$a.prototype.constructor=$a;$a.prototype.isSplineCurve=!0;$a.prototype.getPoint=function(a,b){b=b||new w;var c=this.points,d=(c.length-1)*a;a=Math.floor(d);d-=a;var e=c[0===a?a:a-1],f=c[a],g=c[a>c.length-2?c.length-1:a+1];c=c[a>c.length-3?c.length-1:a+2];b.set(fi(d,e.x,f.x,g.x,c.x),fi(d,e.y,f.y,g.y,c.y));return b};$a.prototype.copy=function(a){I.prototype.copy.call(this,a);this.points=[];for(var b=0,c=a.points.length;b<c;b++)this.points.push(a.points[b].clone());return this};$a.prototype.toJSON=function(){var a=I.prototype.toJSON.call(this);a.points=[];for(var b=0,c=this.points.length;b<c;b++)a.points.push(this.points[b].toArray());return a};$a.prototype.fromJSON=function(a){I.prototype.fromJSON.call(this,a);this.points=[];for(var b=0,c=a.points.length;b<c;b++){var d=a.points[b];this.points.push((new w).fromArray(d))}return this};var mh=Object.freeze({__proto__:null,ArcCurve:cd,CatmullRomCurve3:ua,CubicBezierCurve:Xa,CubicBezierCurve3:hb,EllipseCurve:La,LineCurve:va,LineCurve3:Ya,QuadraticBezierCurve:Za,QuadraticBezierCurve3:ib,SplineCurve:$a});sb.prototype=Object.assign(Object.create(I.prototype),{constructor:sb,add:function(a){this.curves.push(a)},closePath:function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new va(b,a))},getPoint:function(a){var b=a*this.getLength(),c=this.getCurveLengths();for(a=0;a<c.length;){if(c[a]>=b)return b=c[a]-b,a=this.curves[a],c=a.getLength(),a.getPointAt(0===c?0:1-b/c);a++}return null},getLength:function(){var a=this.getCurveLengths();return a[a.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var a=[],b=0,c=0,d=this.curves.length;c<d;c++)b+=this.curves[c].getLength(),a.push(b);return this.cacheLengths=a},getSpacedPoints:function(a){void 0===a&&(a=40);for(var b=[],c=0;c<=a;c++)b.push(this.getPoint(c/a));this.autoClose&&b.push(b[0]);return b},getPoints:function(a){a=a||12;for(var b=[],c,d=0,e=this.curves;d<e.length;d++){var f=e[d];f=f.getPoints(f&&f.isEllipseCurve?2*a:f&&(f.isLineCurve||f.isLineCurve3)?1:f&&f.isSplineCurve?a*f.points.length:a);for(var g=0;g<f.length;g++){var h=f[g];c&&c.equals(h)||(b.push(h),c=h)}}this.autoClose&&1<b.length&&!b[b.length-1].equals(b[0])&&b.push(b[0]);return b},copy:function(a){I.prototype.copy.call(this,a);this.curves=[];for(var b=0,c=a.curves.length;b<c;b++)this.curves.push(a.curves[b].clone());this.autoClose=a.autoClose;return this},toJSON:function(){var a=I.prototype.toJSON.call(this);a.autoClose=this.autoClose;a.curves=[];for(var b=0,c=this.curves.length;b<c;b++)a.curves.push(this.curves[b].toJSON());return a},fromJSON:function(a){I.prototype.fromJSON.call(this,a);this.autoClose=a.autoClose;this.curves=[];for(var b=0,c=a.curves.length;b<c;b++){var d=a.curves[b];this.curves.push((new mh[d.type]).fromJSON(d))}return this}});ab.prototype=Object.assign(Object.create(sb.prototype),{constructor:ab,setFromPoints:function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y);return this},moveTo:function(a,b){this.currentPoint.set(a,b);return this},lineTo:function(a,b){var c=new va(this.currentPoint.clone(),new w(a,b));this.curves.push(c);this.currentPoint.set(a,b);return this},quadraticCurveTo:function(a,b,c,d){a=new Za(this.currentPoint.clone(),new w(a,b),new w(c,d));this.curves.push(a);this.currentPoint.set(c,d);return this},bezierCurveTo:function(a,b,c,d,e,f){a=new Xa(this.currentPoint.clone(),new w(a,b),new w(c,d),new w(e,f));this.curves.push(a);this.currentPoint.set(e,f);return this},splineThru:function(a){var b=[this.currentPoint.clone()].concat(a);b=new $a(b);this.curves.push(b);this.currentPoint.copy(a[a.length-1]);return this},arc:function(a,b,c,d,e,f){this.absarc(a+this.currentPoint.x,b+this.currentPoint.y,c,d,e,f);return this},absarc:function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f);return this},ellipse:function(a,b,c,d,e,f,g,h){this.absellipse(a+
this.currentPoint.x,b+this.currentPoint.y,c,d,e,f,g,h);return this},absellipse:function(a,b,c,d,e,f,g,h){a=new La(a,b,c,d,e,f,g,h);0<this.curves.length&&(b=a.getPoint(0),b.equals(this.currentPoint)||this.lineTo(b.x,b.y));this.curves.push(a);a=a.getPoint(1);this.currentPoint.copy(a);return this},copy:function(a){sb.prototype.copy.call(this,a);this.currentPoint.copy(a.currentPoint);return this},toJSON:function(){var a=sb.prototype.toJSON.call(this);a.currentPoint=this.currentPoint.toArray();return a},fromJSON:function(a){sb.prototype.fromJSON.call(this,a);this.currentPoint.fromArray(a.currentPoint);return this}});Mb.prototype=Object.assign(Object.create(ab.prototype),{constructor:Mb,getPointsHoles:function(a){for(var b=[],c=0,d=this.holes.length;c<d;c++)b[c]=this.holes[c].getPoints(a);return b},extractPoints:function(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}},copy:function(a){ab.prototype.copy.call(this,a);this.holes=[];for(var b=0,c=a.holes.length;b<c;b++)this.holes.push(a.holes[b].clone());return this},toJSON:function(){var a=ab.prototype.toJSON.call(this);a.uuid=this.uuid;a.holes=[];for(var b=0,c=this.holes.length;b<c;b++)a.holes.push(this.holes[b].toJSON());return a},fromJSON:function(a){ab.prototype.fromJSON.call(this,a);this.uuid=a.uuid;this.holes=[];for(var b=0,c=a.holes.length;b<c;b++){var d=a.holes[b];this.holes.push((new ab).fromJSON(d))}return this}});aa.prototype=Object.assign(Object.create(y.prototype),{constructor:aa,isLight:!0,copy:function(a){y.prototype.copy.call(this,a);this.color.copy(a.color);this.intensity=a.intensity;return this},toJSON:function(a){a=y.prototype.toJSON.call(this,a);a.object.color=this.color.getHex();a.object.intensity=this.intensity;void 0!==this.groundColor&&(a.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(a.object.distance=this.distance);void 0!==this.angle&&(a.object.angle=this.angle);void 0!==this.decay&&(a.object.decay=this.decay);void 0!==this.penumbra&&(a.object.penumbra=this.penumbra);void 0!==this.shadow&&(a.object.shadow=this.shadow.toJSON());return a}});df.prototype=Object.assign(Object.create(aa.prototype),{constructor:df,isHemisphereLight:!0,copy:function(a){aa.prototype.copy.call(this,a);this.groundColor.copy(a.groundColor);return this}});Object.assign(jb.prototype,{_projScreenMatrix:new T,_lightPositionWorld:new m,_lookTarget:new m,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(a){var b=this.camera,c=this.matrix,d=this._projScreenMatrix,e=this._lookTarget,f=this._lightPositionWorld;f.setFromMatrixPosition(a.matrixWorld);b.position.copy(f);e.setFromMatrixPosition(a.target.matrixWorld);b.lookAt(e);b.updateMatrixWorld();d.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);this._frustum.setFromProjectionMatrix(d);c.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);c.multiply(b.projectionMatrix);c.multiply(b.matrixWorldInverse)},getViewport:function(a){return this._viewports[a]},getFrameExtents:function(){return this._frameExtents},copy:function(a){this.camera=a.camera.clone();this.bias=a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var a={};0!==this.bias&&(a.bias=this.bias);0!==this.normalBias&&(a.normalBias=this.normalBias);1!==this.radius&&(a.radius=this.radius);if(512!==this.mapSize.x||512!==this.mapSize.y)a.mapSize=this.mapSize.toArray();a.camera=this.camera.toJSON(!1).object;delete a.camera.matrix;return a}});ef.prototype=Object.assign(Object.create(jb.prototype),{constructor:ef,isSpotLightShadow:!0,updateMatrices:function(a){var b=this.camera,c=2*P.RAD2DEG*a.angle,d=this.mapSize.width/this.mapSize.height,e=a.distance||b.far;if(c!==b.fov||d!==b.aspect||e!==b.far)b.fov=c,b.aspect=d,b.far=e,b.updateProjectionMatrix();jb.prototype.updateMatrices.call(this,a)}});ff.prototype=Object.assign(Object.create(aa.prototype),{constructor:ff,isSpotLight:!0,copy:function(a){aa.prototype.copy.call(this,a);this.distance=a.distance;this.angle=a.angle;this.penumbra=a.penumbra;this.decay=a.decay;this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});xg.prototype=Object.assign(Object.create(jb.prototype),{constructor:xg,isPointLightShadow:!0,updateMatrices:function(a,b){void 0===b&&(b=0);var c=this.camera,d=this.matrix,e=this._lightPositionWorld,f=this._lookTarget,g=this._projScreenMatrix;e.setFromMatrixPosition(a.matrixWorld);c.position.copy(e);f.copy(c.position);f.add(this._cubeDirections[b]);c.up.copy(this._cubeUps[b]);c.lookAt(f);c.updateMatrixWorld();d.makeTranslation(-e.x,-e.y,-e.z);g.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);this._frustum.setFromProjectionMatrix(g)}});gf.prototype=Object.assign(Object.create(aa.prototype),{constructor:gf,isPointLight:!0,copy:function(a){aa.prototype.copy.call(this,a);this.distance=a.distance;this.decay=a.decay;this.shadow=a.shadow.clone();return this}});dd.prototype=Object.assign(Object.create(eb.prototype),{constructor:dd,isOrthographicCamera:!0,copy:function(a,b){eb.prototype.copy.call(this,a,b);this.left=a.left;this.right=a.right;this.top=a.top;this.bottom=a.bottom;this.near=a.near;this.far=a.far;this.zoom=a.zoom;this.view=null===a.view?null:Object.assign({},a.view);return this},setViewOffset:function(a,b,c,d,e,f){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1});this.view.enabled=!0;this.view.fullWidth=a;this.view.fullHeight=b;this.view.offsetX=c;this.view.offsetY=d;this.view.width=e;this.view.height=f;this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1);this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2,e=c-a;c+=a;a=d+b;b=d-b;null!==this.view&&this.view.enabled&&(d=(this.right-this.left)/this.view.fullWidth/this.zoom,b=(this.top-this.bottom)/this.view.fullHeight/this.zoom,e+=d*this.view.offsetX,c=e+d*this.view.width,a-=b*this.view.offsetY,b=a-b*this.view.height);this.projectionMatrix.makeOrthographic(e,c,a,b,this.near,this.far);this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(a){a=y.prototype.toJSON.call(this,a);a.object.zoom=this.zoom;a.object.left=this.left;a.object.right=this.right;a.object.top=this.top;a.object.bottom=this.bottom;a.object.near=this.near;a.object.far=this.far;null!==this.view&&(a.object.view=Object.assign({},this.view));return a}});hf.prototype=Object.assign(Object.create(jb.prototype),{constructor:hf,isDirectionalLightShadow:!0,updateMatrices:function(a){jb.prototype.updateMatrices.call(this,a)}});jf.prototype=Object.assign(Object.create(aa.prototype),{constructor:jf,isDirectionalLight:!0,copy:function(a){aa.prototype.copy.call(this,a);this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});kf.prototype=Object.assign(Object.create(aa.prototype),{constructor:kf,isAmbientLight:!0});lf.prototype=Object.assign(Object.create(aa.prototype),{constructor:lf,isRectAreaLight:!0,copy:function(a){aa.prototype.copy.call(this,a);this.width=a.width;this.height=a.height;return this},toJSON:function(a){a=aa.prototype.toJSON.call(this,a);a.object.width=this.width;a.object.height=this.height;return a}});Object.assign(mf.prototype,{isSphericalHarmonics3:!0,set:function(a){for(var b=0;9>b;b++)this.coefficients[b].copy(a[b]);return this},zero:function(){for(var a=0;9>a;a++)this.coefficients[a].set(0,0,0);return this},getAt:function(a,b){var c=a.x,d=a.y;a=a.z;var e=this.coefficients;b.copy(e[0]).multiplyScalar(.282095);b.addScaledVector(e[1],.488603*d);b.addScaledVector(e[2],.488603*a);b.addScaledVector(e[3],.488603*c);b.addScaledVector(e[4],1.092548*c*d);b.addScaledVector(e[5],1.092548*d*a);b.addScaledVector(e[6],.315392*(3*a*a-1));b.addScaledVector(e[7],1.092548*c*a);b.addScaledVector(e[8],.546274*(c*c-d*d));return b},getIrradianceAt:function(a,b){var c=a.x,d=a.y;a=a.z;var e=this.coefficients;b.copy(e[0]).multiplyScalar(.886227);b.addScaledVector(e[1],1.023328*d);b.addScaledVector(e[2],1.023328*a);b.addScaledVector(e[3],1.023328*c);b.addScaledVector(e[4],.858086*c*d);b.addScaledVector(e[5],.858086*d*a);b.addScaledVector(e[6],.743125*a*a-.247708);b.addScaledVector(e[7],.858086*c*a);b.addScaledVector(e[8],.429043*(c*c-d*d));return b},add:function(a){for(var b=0;9>b;b++)this.coefficients[b].add(a.coefficients[b]);return this},addScaledSH:function(a,b){for(var c=0;9>c;c++)this.coefficients[c].addScaledVector(a.coefficients[c],b);return this},scale:function(a){for(var b=0;9>b;b++)this.coefficients[b].multiplyScalar(a);return this},lerp:function(a,b){for(var c=0;9>c;c++)this.coefficients[c].lerp(a.coefficients[c],b);return this},equals:function(a){for(var b=0;9>b;b++)if(!this.coefficients[b].equals(a.coefficients[b]))return!1;return!0},copy:function(a){return this.set(a.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(a,b){void 0===b&&(b=0);for(var c=this.coefficients,d=0;9>d;d++)c[d].fromArray(a,b+3*d);return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);for(var c=this.coefficients,d=0;9>d;d++)c[d].toArray(a,b+3*d);return a}});Object.assign(mf,{getBasisAt:function(a,b){var c=a.x,d=a.y;a=a.z;b[0]=.282095;b[1]=.488603*d;b[2]=.488603*a;b[3]=.488603*c;b[4]=1.092548*c*d;b[5]=1.092548*d*a;b[6]=.315392*(3*a*a-1);b[7]=1.092548*c*a;b[8]=.546274*(c*c-d*d)}});Sa.prototype=Object.assign(Object.create(aa.prototype),{constructor:Sa,isLightProbe:!0,copy:function(a){aa.prototype.copy.call(this,a);this.sh.copy(a.sh);return this},fromJSON:function(a){this.intensity=a.intensity;this.sh.fromArray(a.sh);return this},toJSON:function(a){a=aa.prototype.toJSON.call(this,a);a.object.sh=this.sh.toArray();return a}});nf.prototype=Object.assign(Object.create(U.prototype),{constructor:nf,load:function(a,b,c,d){var e=this,f=new Ra(e.manager);f.setPath(e.path);f.setRequestHeader(e.requestHeader);f.load(a,function(c){try{b(e.parse(JSON.parse(c)))}catch(h){d?d(h):console.error(h),e.manager.itemError(a)}},c,d)},parse:function(a){function b(a){void 0===c[a]&&console.warn("THREE.MaterialLoader: Undefined texture",a);return c[a]}var c=this.textures,d=new Uk[a.type];void 0!==a.uuid&&(d.uuid=a.uuid);void 0!==a.name&&(d.name=a.name);void 0!==a.color&&d.color.setHex(a.color);void 0!==a.roughness&&(d.roughness=a.roughness);void 0!==a.metalness&&(d.metalness=a.metalness);void 0!==a.sheen&&(d.sheen=(new H).setHex(a.sheen));void 0!==a.emissive&&d.emissive.setHex(a.emissive);void 0!==a.specular&&d.specular.setHex(a.specular);void 0!==a.shininess&&(d.shininess=a.shininess);void 0!==a.clearcoat&&(d.clearcoat=a.clearcoat);void 0!==a.clearcoatRoughness&&(d.clearcoatRoughness=a.clearcoatRoughness);void 0!==a.fog&&(d.fog=a.fog);void 0!==a.flatShading&&(d.flatShading=a.flatShading);void 0!==a.blending&&(d.blending=a.blending);void 0!==a.combine&&(d.combine=a.combine);void 0!==a.side&&(d.side=a.side);void 0!==a.opacity&&(d.opacity=a.opacity);void 0!==a.transparent&&(d.transparent=a.transparent);void 0!==a.alphaTest&&(d.alphaTest=a.alphaTest);void 0!==a.depthTest&&(d.depthTest=a.depthTest);void 0!==a.depthWrite&&(d.depthWrite=a.depthWrite);void 0!==a.colorWrite&&(d.colorWrite=a.colorWrite);void 0!==a.stencilWrite&&(d.stencilWrite=a.stencilWrite);void 0!==a.stencilWriteMask&&(d.stencilWriteMask=a.stencilWriteMask);void 0!==a.stencilFunc&&(d.stencilFunc=a.stencilFunc);void 0!==a.stencilRef&&(d.stencilRef=a.stencilRef);void 0!==a.stencilFuncMask&&(d.stencilFuncMask=a.stencilFuncMask);void 0!==a.stencilFail&&(d.stencilFail=a.stencilFail);void 0!==a.stencilZFail&&(d.stencilZFail=a.stencilZFail);void 0!==a.stencilZPass&&(d.stencilZPass=a.stencilZPass);void 0!==a.wireframe&&(d.wireframe=a.wireframe);void 0!==a.wireframeLinewidth&&(d.wireframeLinewidth=a.wireframeLinewidth);void 0!==a.wireframeLinecap&&(d.wireframeLinecap=a.wireframeLinecap);void 0!==a.wireframeLinejoin&&(d.wireframeLinejoin=a.wireframeLinejoin);void 0!==a.rotation&&(d.rotation=a.rotation);1!==a.linewidth&&(d.linewidth=a.linewidth);void 0!==a.dashSize&&(d.dashSize=a.dashSize);void 0!==a.gapSize&&(d.gapSize=a.gapSize);void 0!==a.scale&&(d.scale=a.scale);void 0!==a.polygonOffset&&(d.polygonOffset=a.polygonOffset);void 0!==a.polygonOffsetFactor&&(d.polygonOffsetFactor=a.polygonOffsetFactor);void 0!==a.polygonOffsetUnits&&(d.polygonOffsetUnits=a.polygonOffsetUnits);void 0!==a.skinning&&(d.skinning=a.skinning);void 0!==a.morphTargets&&(d.morphTargets=a.morphTargets);void 0!==a.morphNormals&&(d.morphNormals=a.morphNormals);void 0!==a.dithering&&(d.dithering=a.dithering);void 0!==a.vertexTangents&&(d.vertexTangents=a.vertexTangents);void 0!==a.visible&&(d.visible=a.visible);void 0!==a.toneMapped&&(d.toneMapped=a.toneMapped);void 0!==a.userData&&(d.userData=a.userData);void 0!==a.vertexColors&&(d.vertexColors="number"===typeof a.vertexColors?0<a.vertexColors?!0:!1:a.vertexColors);if(void 0!==a.uniforms)for(var e in a.uniforms){var f=a.uniforms[e];d.uniforms[e]={};switch(f.type){case"t":d.uniforms[e].value=b(f.value);break;case"c":d.uniforms[e].value=(new H).setHex(f.value);break;case"v2":d.uniforms[e].value=(new w).fromArray(f.value);break;case"v3":d.uniforms[e].value=(new m).fromArray(f.value);break;case"v4":d.uniforms[e].value=(new ba).fromArray(f.value);break;case"m3":d.uniforms[e].value=(new za).fromArray(f.value);case"m4":d.uniforms[e].value=(new T).fromArray(f.value);break;default:d.uniforms[e].value=f.value}}void 0!==a.defines&&(d.defines=a.defines);void 0!==a.vertexShader&&(d.vertexShader=a.vertexShader);void 0!==a.fragmentShader&&(d.fragmentShader=a.fragmentShader);if(void 0!==a.extensions)for(var g in a.extensions)d.extensions[g]=a.extensions[g];void 0!==a.shading&&(d.flatShading=1===a.shading);void 0!==a.size&&(d.size=a.size);void 0!==a.sizeAttenuation&&(d.sizeAttenuation=a.sizeAttenuation);void 0!==a.map&&(d.map=b(a.map));void 0!==a.matcap&&(d.matcap=b(a.matcap));void 0!==a.alphaMap&&(d.alphaMap=b(a.alphaMap));void 0!==a.bumpMap&&(d.bumpMap=b(a.bumpMap));void 0!==a.bumpScale&&(d.bumpScale=a.bumpScale);void 0!==a.normalMap&&(d.normalMap=b(a.normalMap));void 0!==a.normalMapType&&(d.normalMapType=a.normalMapType);void 0!==a.normalScale&&(e=a.normalScale,!1===Array.isArray(e)&&(e=[e,e]),d.normalScale=(new w).fromArray(e));void 0!==a.displacementMap&&(d.displacementMap=b(a.displacementMap));void 0!==a.displacementScale&&(d.displacementScale=a.displacementScale);void 0!==a.displacementBias&&(d.displacementBias=a.displacementBias);void 0!==a.roughnessMap&&(d.roughnessMap=b(a.roughnessMap));void 0!==a.metalnessMap&&(d.metalnessMap=b(a.metalnessMap));void 0!==a.emissiveMap&&(d.emissiveMap=b(a.emissiveMap));void 0!==a.emissiveIntensity&&(d.emissiveIntensity=a.emissiveIntensity);void 0!==a.specularMap&&(d.specularMap=b(a.specularMap));void 0!==a.envMap&&(d.envMap=b(a.envMap));void 0!==a.envMapIntensity&&(d.envMapIntensity=a.envMapIntensity);void 0!==a.reflectivity&&(d.reflectivity=a.reflectivity);void 0!==a.refractionRatio&&(d.refractionRatio=a.refractionRatio);void 0!==a.lightMap&&(d.lightMap=b(a.lightMap));void 0!==a.lightMapIntensity&&(d.lightMapIntensity=a.lightMapIntensity);void 0!==a.aoMap&&(d.aoMap=b(a.aoMap));void 0!==a.aoMapIntensity&&(d.aoMapIntensity=a.aoMapIntensity);void 0!==a.gradientMap&&(d.gradientMap=b(a.gradientMap));void 0!==a.clearcoatMap&&(d.clearcoatMap=b(a.clearcoatMap));void 0!==a.clearcoatRoughnessMap&&(d.clearcoatRoughnessMap=b(a.clearcoatRoughnessMap));void 0!==a.clearcoatNormalMap&&(d.clearcoatNormalMap=b(a.clearcoatNormalMap));void 0!==a.clearcoatNormalScale&&(d.clearcoatNormalScale=(new w).fromArray(a.clearcoatNormalScale));void 0!==a.transmission&&(d.transmission=a.transmission);void 0!==a.transmissionMap&&(d.transmissionMap=b(a.transmissionMap));return d},setTextures:function(a){this.textures=a;return this}});var nh={decodeText:function(a){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(a);for(var b="",c=0,d=a.length;c<d;c++)b+=String.fromCharCode(a[c]);try{return decodeURIComponent(escape(b))}catch(e){return b}},extractUrlBase:function(a){var b=a.lastIndexOf("/");return-1===b?"./":a.substr(0,b+1)}};le.prototype=Object.assign(Object.create(D.prototype),{constructor:le,isInstancedBufferGeometry:!0,copy:function(a){D.prototype.copy.call(this,a);this.instanceCount=a.instanceCount;return this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var a=D.prototype.toJSON.call(this);a.instanceCount=this.instanceCount;a.isInstancedBufferGeometry=!0;return a}});of.prototype=Object.assign(Object.create(F.prototype),{constructor:of,isInstancedBufferAttribute:!0,copy:function(a){F.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this},toJSON:function(){var a=F.prototype.toJSON.call(this);a.meshPerAttribute=this.meshPerAttribute;a.isInstancedBufferAttribute=!0;return a}});pf.prototype=Object.assign(Object.create(U.prototype),{constructor:pf,load:function(a,b,c,d){var e=this,f=new Ra(e.manager);f.setPath(e.path);f.setRequestHeader(e.requestHeader);f.load(a,function(c){try{b(e.parse(JSON.parse(c)))}catch(h){d?d(h):console.error(h),e.manager.itemError(a)}},c,d)},parse:function(a){function b(a,b){if(void 0!==c[b])return c[b];var e=a.interleavedBuffers[b];var f=e.buffer;void 0!==d[f]?f=d[f]:(a=(new Uint32Array(a.arrayBuffers[f])).buffer,f=d[f]=a);f=new Sf[e.type](f);f=new Ia(f,e.stride);f.uuid=e.uuid;return c[b]=f}var c={},d={},e=a.isInstancedBufferGeometry?new le:new D,f=a.data.index;void 0!==f&&(f=new Sf[f.type](f.array),e.setIndex(new F(f,1)));f=a.data.attributes;for(var g in f){var h=f[g],k=void 0;h.isInterleavedBufferAttribute?(k=b(a.data,h.data),k=new Hb(k,h.itemSize,h.offset,h.normalized)):(k=new Sf[h.type](h.array),k=new(h.isInstancedBufferAttribute?of:F)(k,h.itemSize,h.normalized));void 0!==h.name&&(k.name=h.name);e.setAttribute(g,k)}if(g=a.data.morphAttributes)for(var n in g){f=g[n];h=[];k=0;for(var q=f.length;k<q;k++){var p=f[k],v=void 0;p.isInterleavedBufferAttribute?(v=b(a.data,p.data),v=new Hb(v,p.itemSize,p.offset,p.normalized)):(v=new Sf[p.type](p.array),v=new F(v,p.itemSize,p.normalized));void 0!==p.name&&(v.name=p.name);h.push(v)}e.morphAttributes[n]=h}a.data.morphTargetsRelative&&(e.morphTargetsRelative=!0);n=a.data.groups||a.data.drawcalls||a.data.offsets;if(void 0!==n)for(g=0,f=n.length;g!==f;++g)h=n[g],e.addGroup(h.start,h.count,h.materialIndex);n=a.data.boundingSphere;void 0!==n&&(g=new m,void 0!==n.center&&g.fromArray(n.center),e.boundingSphere=new db(g,n.radius));a.name&&(e.name=a.name);a.userData&&(e.userData=a.userData);return e}});var Sf={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!==typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};qf.prototype=Object.assign(Object.create(U.prototype),{constructor:qf,load:function(a,b,c,d){var e=this,f=""===this.path?nh.extractUrlBase(a):this.path;this.resourcePath=this.resourcePath||f;f=new Ra(e.manager);f.setPath(this.path);f.setRequestHeader(this.requestHeader);f.load(a,function(c){var f=null;try{f=JSON.parse(c)}catch(l){void 0!==d&&d(l);console.error("THREE:ObjectLoader: Can't parse "+a+".",l.message);return}c=f.metadata;void 0===c||void 0===c.type||"geometry"===c.type.toLowerCase()?console.error("THREE.ObjectLoader: Can't load "+
a):e.parse(f,b)},c,d)},parse:function(a,b){var c=this.parseShape(a.shapes);c=this.parseGeometries(a.geometries,c);var d=this.parseImages(a.images,function(){void 0!==b&&b(e)});d=this.parseTextures(a.textures,d);d=this.parseMaterials(a.materials,d);var e=this.parseObject(a.object,c,d);a.animations&&(e.animations=this.parseAnimations(a.animations));void 0!==a.images&&0!==a.images.length||void 0===b||b(e);return e},parseShape:function(a){var b={};if(void 0!==a)for(var c=0,d=a.length;c<d;c++){var e=(new Mb).fromJSON(a[c]);b[e.uuid]=e}return b},parseGeometries:function(a,b){var c={};if(void 0!==a)for(var d=new pf,e=0,f=a.length;e<f;e++){var g=void 0;var h=a[e];switch(h.type){case"PlaneGeometry":case"PlaneBufferGeometry":g=new Da[h.type](h.width,h.height,h.widthSegments,h.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":g=new Da[h.type](h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":g=new Da[h.type](h.radius,h.segments,h.thetaStart,h.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":g=new Da[h.type](h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":g=new Da[h.type](h.radius,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":g=new Da[h.type](h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":g=new Da[h.type](h.radius,h.detail);break;case"RingGeometry":case"RingBufferGeometry":g=new Da[h.type](h.innerRadius,h.outerRadius,h.thetaSegments,h.phiSegments,h.thetaStart,h.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":g=new Da[h.type](h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":g=new Da[h.type](h.radius,h.tube,h.tubularSegments,h.radialSegments,h.p,h.q);break;case"TubeGeometry":case"TubeBufferGeometry":g=new Da[h.type]((new mh[h.path.type]).fromJSON(h.path),h.tubularSegments,h.radius,h.radialSegments,h.closed);break;case"LatheGeometry":case"LatheBufferGeometry":g=new Da[h.type](h.points,h.segments,h.phiStart,h.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":g=new Da[h.type](h.vertices,h.indices,h.radius,h.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":g=[];for(var k=0,n=h.shapes.length;k<n;k++)g.push(b[h.shapes[k]]);g=new Da[h.type](g,h.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":g=[];k=0;for(n=h.shapes.length;k<n;k++)g.push(b[h.shapes[k]]);k=h.options.extrudePath;void 0!==k&&(h.options.extrudePath=(new mh[k.type]).fromJSON(k));g=new Da[h.type](g,h.options);break;case"BufferGeometry":case"InstancedBufferGeometry":g=d.parse(h);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+h.type+'"');continue}g.uuid=h.uuid;void 0!==h.name&&(g.name=h.name);!0===g.isBufferGeometry&&void 0!==h.userData&&(g.userData=h.userData);c[h.uuid]=g}return c},parseMaterials:function(a,b){var c={},d={};if(void 0!==a){var e=new nf;e.setTextures(b);b=0;for(var f=a.length;b<f;b++){var g=a[b];if("MultiMaterial"===g.type){for(var h=[],k=0;k<g.materials.length;k++){var n=g.materials[k];void 0===c[n.uuid]&&(c[n.uuid]=e.parse(n));h.push(c[n.uuid])}d[g.uuid]=h}else void 0===c[g.uuid]&&(c[g.uuid]=e.parse(g)),d[g.uuid]=c[g.uuid]}}return d},parseAnimations:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=Qa.parse(d);void 0!==d.uuid&&(e.uuid=d.uuid);b.push(e)}return b},parseImages:function(a,b){function c(a){d.manager.itemStart(a);return f.load(a,function(){d.manager.itemEnd(a)},void 0,function(){d.manager.itemError(a);d.manager.itemEnd(a)})}var d=this,e={};if(void 0!==a&&0<a.length){b=new tg(b);var f=new bd(b);f.setCrossOrigin(this.crossOrigin);b=0;for(var g=a.length;b<g;b++){var h=a[b],k=h.url;if(Array.isArray(k)){e[h.uuid]=[];for(var n=0,m=k.length;n<m;n++){var p=k[n];p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(p)?p:d.resourcePath+p;e[h.uuid].push(c(p))}}else k=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h.url)?h.url:d.resourcePath+h.url,e[h.uuid]=c(k)}}return e},parseTextures:function(a,b){function c(a,b){if("number"===typeof a)return a;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",a);return b[a]}var d={};if(void 0!==a)for(var e=0,f=a.length;e<f;e++){var g=a[e];void 0===g.image&&console.warn('THREE.ObjectLoader: No "image" specified for',g.uuid);void 0===b[g.image]&&console.warn("THREE.ObjectLoader: Undefined image",g.image);var h=void 0;h=Array.isArray(b[g.image])?new ob(b[g.image]):new V(b[g.image]);h.needsUpdate=!0;h.uuid=g.uuid;void 0!==g.name&&(h.name=g.name);void 0!==g.mapping&&(h.mapping=c(g.mapping,Vk));void 0!==g.offset&&h.offset.fromArray(g.offset);void 0!==g.repeat&&h.repeat.fromArray(g.repeat);void 0!==g.center&&h.center.fromArray(g.center);void 0!==g.rotation&&(h.rotation=g.rotation);void 0!==g.wrap&&(h.wrapS=c(g.wrap[0],Ni),h.wrapT=c(g.wrap[1],Ni));void 0!==g.format&&(h.format=g.format);void 0!==g.type&&(h.type=g.type);void 0!==g.encoding&&(h.encoding=g.encoding);void 0!==g.minFilter&&(h.minFilter=c(g.minFilter,Oi));void 0!==g.magFilter&&(h.magFilter=c(g.magFilter,Oi));void 0!==g.anisotropy&&(h.anisotropy=g.anisotropy);void 0!==g.flipY&&(h.flipY=g.flipY);void 0!==g.premultiplyAlpha&&(h.premultiplyAlpha=g.premultiplyAlpha);void 0!==g.unpackAlignment&&(h.unpackAlignment=g.unpackAlignment);d[g.uuid]=h}return d},parseObject:function(a,b,c){function d(a){void 0===b[a]&&console.warn("THREE.ObjectLoader: Undefined geometry",a);return b[a]}function e(a){if(void 0!==a){if(Array.isArray(a)){for(var b=[],d=0,e=a.length;d<e;d++){var f=a[d];void 0===c[f]&&console.warn("THREE.ObjectLoader: Undefined material",f);b.push(c[f])}return b}void 0===c[a]&&console.warn("THREE.ObjectLoader: Undefined material",a);return c[a]}}switch(a.type){case"Scene":var f=new wd;void 0!==a.background&&Number.isInteger(a.background)&&(f.background=new H(a.background));void 0!==a.fog&&("Fog"===a.fog.type?f.fog=new Me(a.fog.color,a.fog.near,a.fog.far):"FogExp2"===a.fog.type&&(f.fog=new Le(a.fog.color,a.fog.density)));break;case"PerspectiveCamera":f=new ma(a.fov,a.aspect,a.near,a.far);void 0!==a.focus&&(f.focus=a.focus);void 0!==a.zoom&&(f.zoom=a.zoom);void 0!==a.filmGauge&&(f.filmGauge=a.filmGauge);void 0!==a.filmOffset&&(f.filmOffset=a.filmOffset);void 0!==a.view&&(f.view=Object.assign({},a.view));break;case"OrthographicCamera":f=new dd(a.left,a.right,a.top,a.bottom,a.near,a.far);void 0!==a.zoom&&(f.zoom=a.zoom);void 0!==a.view&&(f.view=Object.assign({},a.view));break;case"AmbientLight":f=new kf(a.color,a.intensity);break;case"DirectionalLight":f=new jf(a.color,a.intensity);break;case"PointLight":f=new gf(a.color,a.intensity,a.distance,a.decay);break;case"RectAreaLight":f=new lf(a.color,a.intensity,a.width,a.height);break;case"SpotLight":f=new ff(a.color,a.intensity,a.distance,a.angle,a.penumbra,a.decay);break;case"HemisphereLight":f=new df(a.color,a.groundColor,a.intensity);break;case"LightProbe":f=(new Sa).fromJSON(a);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":f=d(a.geometry);var g=e(a.material);f=new Z(f,g);break;case"InstancedMesh":f=d(a.geometry);g=e(a.material);var h=a.instanceMatrix;f=new Qe(f,g,a.count);f.instanceMatrix=new F(new Float32Array(h.array),16);break;case"LOD":f=new Md;break;case"Line":f=new Ja(d(a.geometry),e(a.material),a.mode);break;case"LineLoop":f=new Re(d(a.geometry),e(a.material));break;case"LineSegments":f=new da(d(a.geometry),e(a.material));break;case"PointCloud":case"Points":f=new Lc(d(a.geometry),e(a.material));break;case"Sprite":f=new Kd(e(a.material));break;case"Group":f=new Ic;break;default:f=new y}f.uuid=a.uuid;void 0!==a.name&&(f.name=a.name);void 0!==a.matrix?(f.matrix.fromArray(a.matrix),void 0!==a.matrixAutoUpdate&&(f.matrixAutoUpdate=a.matrixAutoUpdate),f.matrixAutoUpdate&&f.matrix.decompose(f.position,f.quaternion,f.scale)):(void 0!==a.position&&f.position.fromArray(a.position),void 0!==a.rotation&&f.rotation.fromArray(a.rotation),void 0!==a.quaternion&&f.quaternion.fromArray(a.quaternion),void 0!==a.scale&&f.scale.fromArray(a.scale));void 0!==a.castShadow&&(f.castShadow=a.castShadow);void 0!==a.receiveShadow&&(f.receiveShadow=a.receiveShadow);a.shadow&&(void 0!==a.shadow.bias&&(f.shadow.bias=a.shadow.bias),void 0!==a.shadow.normalBias&&(f.shadow.normalBias=a.shadow.normalBias),void 0!==a.shadow.radius&&(f.shadow.radius=a.shadow.radius),void 0!==a.shadow.mapSize&&f.shadow.mapSize.fromArray(a.shadow.mapSize),void 0!==a.shadow.camera&&(f.shadow.camera=this.parseObject(a.shadow.camera)));void 0!==a.visible&&(f.visible=a.visible);void 0!==a.frustumCulled&&(f.frustumCulled=a.frustumCulled);void 0!==a.renderOrder&&(f.renderOrder=a.renderOrder);void 0!==a.userData&&(f.userData=a.userData);void 0!==a.layers&&(f.layers.mask=a.layers);if(void 0!==a.children)for(h=a.children,g=0;g<h.length;g++)f.add(this.parseObject(h[g],b,c));if("LOD"===a.type)for(void 0!==a.autoUpdate&&(f.autoUpdate=a.autoUpdate),a=a.levels,h=0;h<a.length;h++){g=a[h];var k=f.getObjectByProperty("uuid",g.object);void 0!==k&&f.addLevel(k,g.distance)}return f}});var Vk={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Ni={RepeatWrapping:1E3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},Oi={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};yg.prototype=Object.assign(Object.create(U.prototype),{constructor:yg,isImageBitmapLoader:!0,setOptions:function(a){this.options=a;return this},load:function(a,b,c,d){void 0===a&&(a="");void 0!==this.path&&(a=this.path+a);a=this.manager.resolveURL(a);var e=this,f=sc.get(a);if(void 0!==f)return e.manager.itemStart(a),setTimeout(function(){b&&b(f);e.manager.itemEnd(a)},0),f;fetch(a).then(function(a){return a.blob()}).then(function(a){return createImageBitmap(a,e.options)}).then(function(c){sc.add(a,c);b&&b(c);e.manager.itemEnd(a)}).catch(function(b){d&&d(b);e.manager.itemError(a);e.manager.itemEnd(a)});e.manager.itemStart(a)}});Object.assign(zg.prototype,{moveTo:function(a,b){this.currentPath=new ab;this.subPaths.push(this.currentPath);this.currentPath.moveTo(a,b);return this},lineTo:function(a,b){this.currentPath.lineTo(a,b);return this},quadraticCurveTo:function(a,b,c,d){this.currentPath.quadraticCurveTo(a,b,c,d);return this},bezierCurveTo:function(a,b,c,d,e,f){this.currentPath.bezierCurveTo(a,b,c,d,e,f);return this},splineThru:function(a){this.currentPath.splineThru(a);return this},toShapes:function(a,b){function c(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c],f=new Mb;f.curves=e.curves;b.push(f)}return b}function d(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var g=b[e],h=b[f],k=h.x-g.x,l=h.y-g.y;if(Math.abs(l)>Number.EPSILON){if(0>l&&(g=b[f],k=-k,h=b[e],l=-l),!(a.y<g.y||a.y>h.y))if(a.y===g.y){if(a.x===g.x)return!0}else{e=l*(a.x-g.x)-k*(a.y-g.y);if(0===e)return!0;0>e||(d=!d)}}else if(a.y===g.y&&(h.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=h.x))return!0}return d}var e=pb.isClockWise,f=this.subPaths;if(0===f.length)return[];if(!0===b)return c(f);b=[];if(1===f.length){var g=f[0];var h=new Mb;h.curves=g.curves;b.push(h);return b}var k=!e(f[0].getPoints());k=a?!k:k;h=[];var n=[],m=[],p=0;n[p]=void 0;m[p]=[];for(var v=0,r=f.length;v<r;v++){g=f[v];var t=g.getPoints();var u=e(t);(u=a?!u:u)?(!k&&n[p]&&p++,n[p]={s:new Mb,p:t},n[p].s.curves=g.curves,k&&p++,m[p]=[]):m[p].push({h:g,p:t[0]})}if(!n[0])return c(f);if(1<n.length){a=!1;e=[];f=0;for(g=n.length;f<g;f++)h[f]=[];f=0;for(g=n.length;f<g;f++)for(u=m[f],k=0;k<u.length;k++){p=u[k];t=!0;for(v=0;v<n.length;v++)d(p.p,n[v].p)&&(f!==v&&e.push({froms:f,tos:v,hole:k}),t?(t=!1,h[v].push(p)):a=!0);t&&h[f].push(p)}0<e.length&&(a||(m=h))}e=0;for(f=n.length;e<f;e++)for(h=n[e].s,b.push(h),a=m[e],g=0,u=a.length;g<u;g++)h.holes.push(a[g].h);return b}});Object.assign(Ag.prototype,{isFont:!0,generateShapes:function(a,b){void 0===b&&(b=100);var c=[],d=b;b=this.data;var e=Array.from?Array.from(a):String(a).split("");d/=b.resolution;var f=(b.boundingBox.yMax-b.boundingBox.yMin+b.underlineThickness)*d;a=[];for(var g=0,h=0,k=0;k<e.length;k++){var n=e[k];if("\n"===n)g=0,h-=f;else{var m=n;n=d;var p=g,v=h,r=b,t=r.glyphs[m]||r.glyphs["?"];if(t){m=new zg;if(t.o){r=t._cachedOutline||(t._cachedOutline=t.o.split(" "));for(var u=0,w=r.length;u<w;)switch(r[u++]){case"m":var A=r[u++]*n+p;var x=r[u++]*n+v;m.moveTo(A,x);break;case"l":A=r[u++]*n+p;x=r[u++]*n+v;m.lineTo(A,x);break;case"q":var y=r[u++]*n+p;var C=r[u++]*n+v;var D=r[u++]*n+p;var B=r[u++]*n+v;m.quadraticCurveTo(D,B,y,C);break;case"b":y=r[u++]*n+p,C=r[u++]*n+v,D=r[u++]*n+p,B=r[u++]*n+v,A=r[u++]*n+p,x=r[u++]*n+v,m.bezierCurveTo(D,B,A,x,y,C)}}n={offsetX:t.ha*n,path:m}}else console.error('THREE.Font: character "'+m+'" does not exists in font family '+r.familyName+"."),n=void 0;g+=n.offsetX;a.push(n.path)}}b=0;for(e=a.length;b<e;b++)Array.prototype.push.apply(c,a[b].toShapes());return c}});Bg.prototype=Object.assign(Object.create(U.prototype),{constructor:Bg,load:function(a,b,c,d){var e=this,f=new Ra(this.manager);f.setPath(this.path);f.setRequestHeader(this.requestHeader);f.load(a,function(a){try{var c=JSON.parse(a)}catch(l){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),c=JSON.parse(a.substring(65,a.length-2))}a=e.parse(c);b&&b(a)},c,d)},parse:function(a){return new Ag(a)}});var Tf,Gg={getContext:function(){void 0===Tf&&(Tf=new(window.AudioContext||window.webkitAudioContext));return Tf},setContext:function(a){Tf=a}};rf.prototype=Object.assign(Object.create(U.prototype),{constructor:rf,load:function(a,b,c,d){var e=this,f=new Ra(e.manager);f.setResponseType("arraybuffer");f.setPath(e.path);f.setRequestHeader(e.requestHeader);f.load(a,function(c){try{var f=c.slice(0);Gg.getContext().decodeAudioData(f,function(a){b(a)})}catch(l){d?d(l):console.error(l),e.manager.itemError(a)}},c,d)}});Cg.prototype=Object.assign(Object.create(Sa.prototype),{constructor:Cg,isHemisphereLightProbe:!0,copy:function(a){Sa.prototype.copy.call(this,a);return this},toJSON:function(a){return Sa.prototype.toJSON.call(this,a)}});Dg.prototype=Object.assign(Object.create(Sa.prototype),{constructor:Dg,isAmbientLightProbe:!0,copy:function(a){Sa.prototype.copy.call(this,a);return this},toJSON:function(a){return Sa.prototype.toJSON.call(this,a)}});var Pi=new T,Qi=new T;Object.assign(gi.prototype,{update:function(a){var b=this._cache;if(b.focus!==a.focus||b.fov!==a.fov||b.aspect!==a.aspect*this.aspect||b.near!==a.near||b.far!==a.far||b.zoom!==a.zoom||b.eyeSep!==this.eyeSep){b.focus=a.focus;b.fov=a.fov;b.aspect=a.aspect*this.aspect;b.near=a.near;b.far=a.far;b.zoom=a.zoom;b.eyeSep=this.eyeSep;var c=a.projectionMatrix.clone(),d=b.eyeSep/2,e=d*b.near/b.focus,f=b.near*Math.tan(P.DEG2RAD*b.fov*.5)/b.zoom;Qi.elements[12]=-d;Pi.elements[12]=d;d=-f*b.aspect+e;var g=f*b.aspect+e;c.elements[0]=2*b.near/(g-d);c.elements[8]=(g+d)/(g-d);this.cameraL.projectionMatrix.copy(c);d=-f*b.aspect-e;g=f*b.aspect-e;c.elements[0]=2*b.near/(g-d);c.elements[8]=(g+d)/(g-d);this.cameraR.projectionMatrix.copy(c)}this.cameraL.matrixWorld.copy(a.matrixWorld).multiply(Qi);this.cameraR.matrixWorld.copy(a.matrixWorld).multiply(Pi)}});Object.assign(Eg.prototype,{start:function(){this.oldTime=this.startTime=("undefined"===typeof performance?Date:performance).now();this.elapsedTime=0;this.running=!0},stop:function(){this.getElapsedTime();this.autoStart=this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var b=("undefined"===typeof performance?Date:performance).now();a=(b-this.oldTime)/1E3;this.oldTime=b;this.elapsedTime+=a}return a}});var tc=new m,Ri=new S,Wk=new m,uc=new m;Fg.prototype=Object.assign(Object.create(y.prototype),{constructor:Fg,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null);return this},getFilter:function(){return this.filter},setFilter:function(a){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination);this.filter=a;this.gain.connect(this.filter);this.filter.connect(this.context.destination);return this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(a){this.gain.gain.setTargetAtTime(a,this.context.currentTime,.01);return this},updateMatrixWorld:function(a){y.prototype.updateMatrixWorld.call(this,a);a=this.context.listener;var b=this.up;this.timeDelta=this._clock.getDelta();this.matrixWorld.decompose(tc,Ri,Wk);uc.set(0,0,-1).applyQuaternion(Ri);if(a.positionX){var c=this.context.currentTime+this.timeDelta;a.positionX.linearRampToValueAtTime(tc.x,c);a.positionY.linearRampToValueAtTime(tc.y,c);a.positionZ.linearRampToValueAtTime(tc.z,c);a.forwardX.linearRampToValueAtTime(uc.x,c);a.forwardY.linearRampToValueAtTime(uc.y,c);a.forwardZ.linearRampToValueAtTime(uc.z,c);a.upX.linearRampToValueAtTime(b.x,c);a.upY.linearRampToValueAtTime(b.y,c);a.upZ.linearRampToValueAtTime(b.z,c)}else a.setPosition(tc.x,tc.y,tc.z),a.setOrientation(uc.x,uc.y,uc.z,b.x,b.y,b.z)}});ed.prototype=Object.assign(Object.create(y.prototype),{constructor:ed,getOutput:function(){return this.gain},setNodeSource:function(a){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=a;this.connect();return this},setMediaElementSource:function(a){this.hasPlaybackControl=!1;this.sourceType="mediaNode";this.source=this.context.createMediaElementSource(a);this.connect();return this},setMediaStreamSource:function(a){this.hasPlaybackControl=!1;this.sourceType="mediaStreamNode";this.source=this.context.createMediaStreamSource(a);this.connect();return this},setBuffer:function(a){this.buffer=a;this.sourceType="buffer";this.autoplay&&this.play();return this},play:function(a){void 0===a&&(a=0);if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this._startedAt=this.context.currentTime+a,a=this.context.createBufferSource(),a.buffer=this.buffer,a.loop=this.loop,a.loopStart=this.loopStart,a.loopEnd=this.loopEnd,a.onended=this.onEnded.bind(this),a.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=a,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()},pause:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress%=this.duration||this.buffer.duration),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this},stop:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(a){a||(a=[]);!0===this.isPlaying?(this.disconnect(),this.filters=a,this.connect()):this.filters=a;return this},setDetune:function(a){this.detune=a;if(void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(a){return this.setFilters(a?[a]:[])},setPlaybackRate:function(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.playbackRate=a,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.loop=a,!0===this.isPlaying&&(this.source.loop=this.loop),this},setLoopStart:function(a){this.loopStart=a;return this},setLoopEnd:function(a){this.loopEnd=a;return this},getVolume:function(){return this.gain.gain.value},setVolume:function(a){this.gain.gain.setTargetAtTime(a,this.context.currentTime,.01);return this}});var vc=new m,Si=new S,Xk=new m,wc=new m;Hg.prototype=Object.assign(Object.create(ed.prototype),{constructor:Hg,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(a){this.panner.refDistance=a;return this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(a){this.panner.rolloffFactor=a;return this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(a){this.panner.distanceModel=a;return this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(a){this.panner.maxDistance=a;return this},setDirectionalCone:function(a,b,c){this.panner.coneInnerAngle=a;this.panner.coneOuterAngle=b;this.panner.coneOuterGain=c;return this},updateMatrixWorld:function(a){y.prototype.updateMatrixWorld.call(this,a);if(!0!==this.hasPlaybackControl||!1!==this.isPlaying)if(this.matrixWorld.decompose(vc,Si,Xk),wc.set(0,0,1).applyQuaternion(Si),a=this.panner,a.positionX){var b=this.context.currentTime+this.listener.timeDelta;a.positionX.linearRampToValueAtTime(vc.x,b);a.positionY.linearRampToValueAtTime(vc.y,b);a.positionZ.linearRampToValueAtTime(vc.z,b);a.orientationX.linearRampToValueAtTime(wc.x,b);a.orientationY.linearRampToValueAtTime(wc.y,b);a.orientationZ.linearRampToValueAtTime(wc.z,b)}else a.setPosition(vc.x,vc.y,vc.z),a.setOrientation(wc.x,wc.y,wc.z)}});Object.assign(Ig.prototype,{getFrequencyData:function(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function(){for(var a=0,b=this.getFrequencyData(),c=0;c<b.length;c++)a+=b[c];return a/b.length}});Object.assign(Jg.prototype,{accumulate:function(a,b){var c=this.buffer,d=this.valueSize;a=a*d+d;var e=this.cumulativeWeight;if(0===e){for(e=0;e!==d;++e)c[a+e]=c[e];e=b}else e+=b,this._mixBufferRegion(c,a,0,b/e,d);this.cumulativeWeight=e},accumulateAdditive:function(a){var b=this.buffer,c=this.valueSize,d=c*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity();this._mixBufferRegionAdditive(b,d,0,a,c);this.cumulativeWeightAdditive+=a},apply:function(a){var b=this.valueSize,c=this.buffer;a=a*b+b;var d=this.cumulativeWeight,e=this.cumulativeWeightAdditive,f=this.binding;this.cumulativeWeightAdditive=this.cumulativeWeight=0;1>d&&this._mixBufferRegion(c,a,b*this._origIndex,1-d,b);0<e&&this._mixBufferRegionAdditive(c,a,this._addIndex*b,1,b);d=b;for(e=b+b;d!==e;++d)if(c[d]!==c[d+b]){f.setValue(c,a);break}},saveOriginalState:function(){var a=this.buffer,b=this.valueSize,c=b*this._origIndex;this.binding.getValue(a,c);for(var d=b;d!==c;++d)a[d]=a[c+d%b];this._setIdentity();this.cumulativeWeightAdditive=this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_setAdditiveIdentityNumeric:function(){for(var a=this._addIndex*this.valueSize,b=a+this.valueSize;a<b;a++)this.buffer[a]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric();this.buffer[4*this._addIndex+3]=1},_setAdditiveIdentityOther:function(){for(var a=this._origIndex*this.valueSize,b=this._addIndex*this.valueSize,c=0;c<this.valueSize;c++)this.buffer[b+c]=this.buffer[a+c]},_select:function(a,b,c,d,e){if(.5<=d)for(d=0;d!==e;++d)a[b+d]=a[c+d]},_slerp:function(a,b,c,d){S.slerpFlat(a,b,a,b,a,c,d)},_slerpAdditive:function(a,b,c,d,e){e*=this._workIndex;S.multiplyQuaternionsFlat(a,e,a,b,a,c);S.slerpFlat(a,b,a,b,a,e,d)},_lerp:function(a,b,c,d,e){for(var f=1-d,g=0;g!==e;++g){var h=b+g;a[h]=a[h]*f+a[c+g]*d}},_lerpAdditive:function(a,b,c,d,e){for(var f=0;f!==e;++f){var g=b+f;a[g]+=a[c+f]*d}}});var Yk=/[\[\]\.:\/]/g,Zk="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",$k=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),al=/(WCOD+)?/.source.replace("WCOD",Zk),bl=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),cl=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),dl=new RegExp("^"+$k+al+bl+cl+"$"),el=["material","materials","bones"];Object.assign(hi.prototype,{getValue:function(a,b){this.bind();var c=this._bindings[this._targetGroup.nCachedObjects_];void 0!==c&&c.getValue(a,b)},setValue:function(a,b){for(var c=this._bindings,d=this._targetGroup.nCachedObjects_,e=c.length;d!==e;++d)c[d].setValue(a,b)},bind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].bind()},unbind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].unbind()}});Object.assign(pa,{Composite:hi,create:function(a,b,c){return a&&a.isAnimationObjectGroup?new pa.Composite(a,b,c):new pa(a,b,c)},sanitizeNodeName:function(a){return a.replace(/\s/g,"_").replace(Yk,"")},parseTrackName:function(a){var b=dl.exec(a);if(!b)throw Error("PropertyBinding: Cannot parse trackName: "+a);b={nodeName:b[2],objectName:b[3],objectIndex:b[4],propertyName:b[5],propertyIndex:b[6]};var c=b.nodeName&&b.nodeName.lastIndexOf(".");if(void 0!==c&&-1!==c){var d=b.nodeName.substring(c+1);-1!==el.indexOf(d)&&(b.nodeName=b.nodeName.substring(0,c),b.objectName=d)}if(null===b.propertyName||0===b.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+a);return b},findNode:function(a,b){if(!b||""===b||"."===b||-1===b||b===a.name||b===a.uuid)return a;if(a.skeleton){var c=a.skeleton.getBoneByName(b);if(void 0!==c)return c}if(a.children){var d=function(a){for(var c=0;c<a.length;c++){var e=a[c];if(e.name===b||e.uuid===b||(e=d(e.children)))return e}return null};if(a=d(a.children))return a}return null}});Object.assign(pa.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,b){a[b]=this.node[this.propertyName]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)a[b++]=c[d]},function(a,b){a[b]=this.resolvedProperty[this.propertyIndex]},function(a,b){this.resolvedProperty.toArray(a,b)}],SetterByBindingTypeAndVersioning:[[function(a,b){this.targetObject[this.propertyName]=a[b]},function(a,b){this.targetObject[this.propertyName]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.targetObject[this.propertyName]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.needsUpdate=!0},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty[this.propertyIndex]=a[b]},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty.fromArray(a,b)},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(a,b){this.bind();this.getValue(a,b)},setValue:function(a,b){this.bind();this.setValue(a,b)},bind:function(){var a=this.node,b=this.parsedPath,c=b.objectName,d=b.propertyName,e=b.propertyIndex;a||(this.node=a=pa.findNode(this.rootNode,b.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(a){if(c){var f=b.objectIndex;switch(c){case"materials":if(!a.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!a.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}a=a.material.materials;break;case"bones":if(!a.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}a=a.skeleton.bones;for(c=0;c<a.length;c++)if(a[c].name===f){f=c;break}break;default:if(void 0===a[c]){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}a=a[c]}if(void 0!==f){if(void 0===a[f]){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,a);return}a=a[f]}}f=a[d];if(void 0===f)console.error("THREE.PropertyBinding: Trying to update property for track: "+b.nodeName+"."+d+" but it wasn't found.",a);else{b=this.Versioning.None;this.targetObject=a;void 0!==a.needsUpdate?b=this.Versioning.NeedsUpdate:void 0!==a.matrixWorldNeedsUpdate&&(b=this.Versioning.MatrixWorldNeedsUpdate);c=this.BindingType.Direct;if(void 0!==e){if("morphTargetInfluences"===d){if(!a.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(a.geometry.isBufferGeometry){if(!a.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}void 0!==a.morphTargetDictionary[e]&&(e=a.morphTargetDictionary[e])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}c=this.BindingType.ArrayElement;this.resolvedProperty=f;this.propertyIndex=e}else void 0!==f.fromArray&&void 0!==f.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=f):Array.isArray(f)?(c=this.BindingType.EntireArray,this.resolvedProperty=f):this.propertyName=d;this.getValue=this.GetterByBindingType[c];this.setValue=this.SetterByBindingTypeAndVersioning[c][b]}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}});Object.assign(pa.prototype,{_getValue_unbound:pa.prototype.getValue,_setValue_unbound:pa.prototype.setValue});Object.assign(ii.prototype,{isAnimationObjectGroup:!0,add:function(){for(var a=this._objects,b=this._indicesByUUID,c=this._paths,d=this._parsedPaths,e=this._bindings,f=e.length,g=void 0,h=a.length,k=this.nCachedObjects_,n=0,m=arguments.length;n!==m;++n){var p=arguments[n],v=p.uuid,r=b[v];if(void 0===r){r=h++;b[v]=r;a.push(p);r=0;for(var t=f;r!==t;++r)e[r].push(new pa(p,c[r],d[r]))}else if(r<k){g=a[r];t=--k;var u=a[t];b[u.uuid]=r;a[r]=u;b[v]=t;a[t]=p;v=0;for(u=f;v!==u;++v){var w=e[v],y=w[r];w[r]=w[t];void 0===y&&(y=new pa(p,c[v],d[v]));w[t]=y}}else a[r]!==g&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=k},remove:function(){for(var a=this._objects,b=this._indicesByUUID,c=this._bindings,d=c.length,e=this.nCachedObjects_,f=0,g=arguments.length;f!==g;++f){var h=arguments[f],k=h.uuid,n=b[k];if(void 0!==n&&n>=e){var m=e++,p=a[m];b[p.uuid]=n;a[n]=p;b[k]=m;a[m]=h;h=0;for(k=d;h!==k;++h){p=c[h];var v=p[n];p[n]=p[m];p[m]=v}}}this.nCachedObjects_=e},uncache:function(){for(var a=this._objects,b=this._indicesByUUID,c=this._bindings,d=c.length,e=this.nCachedObjects_,f=a.length,g=0,h=arguments.length;g!==h;++g){var k=arguments[g].uuid,n=b[k];if(void 0!==n)if(delete b[k],n<e){k=--e;var m=a[k],p=--f,v=a[p];b[m.uuid]=n;a[n]=m;b[v.uuid]=k;a[k]=v;a.pop();m=0;for(v=d;m!==v;++m){var r=c[m],t=r[p];r[n]=r[k];r[k]=t;r.pop()}}else for(k=--f,p=a[k],b[p.uuid]=n,a[n]=p,a.pop(),p=0,m=d;p!==m;++p)v=c[p],v[n]=v[k],v.pop()}this.nCachedObjects_=e},subscribe_:function(a,b){var c=this._bindingsIndicesByPath,d=c[a],e=this._bindings;if(void 0!==d)return e[d];var f=this._paths,g=this._parsedPaths,h=this._objects,k=this.nCachedObjects_,m=Array(h.length);d=e.length;c[a]=d;f.push(a);g.push(b);e.push(m);c=k;for(d=h.length;c!==d;++c)m[c]=new pa(h[c],a,b);return m},unsubscribe_:function(a){var b=this._bindingsIndicesByPath,c=b[a];if(void 0!==c){var d=this._paths,e=this._parsedPaths,f=this._bindings,g=f.length-1,h=f[g];b[a[g]]=c;f[c]=h;f.pop();e[c]=e[g];e.pop();d[c]=d[g];d.pop()}}});Object.assign(ji.prototype,{play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},reset:function(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(a){this._startTime=a;return this},setLoop:function(a,b){this.loop=a;this.repetitions=b;return this},setEffectiveWeight:function(a){this.weight=a;this._effectiveWeight=this.enabled?a:0;return this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(a){return this._scheduleFading(a,0,1)},fadeOut:function(a){return this._scheduleFading(a,1,0)},crossFadeFrom:function(a,b,c){a.fadeOut(b);this.fadeIn(b);if(c){c=this._clip.duration;var d=a._clip.duration,e=c/d;a.warp(1,d/c,b);this.warp(e,1,b)}return this},crossFadeTo:function(a,b,c){return a.crossFadeFrom(this,b,c)},stopFading:function(){var a=this._weightInterpolant;null!==a&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},setEffectiveTimeScale:function(a){this.timeScale=a;this._effectiveTimeScale=this.paused?0:a;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(a){this.timeScale=this._clip.duration/a;return this.stopWarping()},syncWith:function(a){this.time=a.time;this.timeScale=a.timeScale;return this.stopWarping()},halt:function(a){return this.warp(this._effectiveTimeScale,0,a)},warp:function(a,b,c){var d=this._mixer,e=d.time,f=this.timeScale,g=this._timeScaleInterpolant;null===g&&(this._timeScaleInterpolant=g=d._lendControlInterpolant());d=g.parameterPositions;g=g.sampleValues;d[0]=e;d[1]=e+c;g[0]=a/f;g[1]=b/f;return this},stopWarping:function(){var a=this._timeScaleInterpolant;null!==a&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(a,b,c,d){if(this.enabled){var e=this._startTime;if(null!==e){b=(a-e)*c;if(0>b||0===c)return;this._startTime=null;b*=c}b*=this._updateTimeScale(a);c=this._updateTime(b);a=this._updateWeight(a);if(0<a)switch(b=this._interpolants,e=this._propertyBindings,this.blendMode){case 2501:d=0;for(var f=b.length;d!==f;++d)b[d].evaluate(c),e[d].accumulateAdditive(a);break;default:f=0;for(var g=b.length;f!==g;++f)b[f].evaluate(c),e[f].accumulate(d,a)}}else this._updateWeight(a)},_updateWeight:function(a){var b=0;if(this.enabled){b=this.weight;var c=this._weightInterpolant;if(null!==c){var d=c.evaluate(a)[0];b*=d;a>c.parameterPositions[1]&&(this.stopFading(),0===d&&(this.enabled=!1))}}return this._effectiveWeight=b},_updateTimeScale:function(a){var b=0;if(!this.paused){b=this.timeScale;var c=this._timeScaleInterpolant;if(null!==c){var d=c.evaluate(a)[0];b*=d;a>c.parameterPositions[1]&&(this.stopWarping(),0===b?this.paused=!0:this.timeScale=b)}}return this._effectiveTimeScale=b},_updateTime:function(a){var b=this._clip.duration,c=this.loop,d=this.time+a,e=this._loopCount,f=2202===c;if(0===a)return-1===e?d:f&&1===(e&1)?b-d:d;if(2200===c)a:{if(-1===e&&(this._loopCount=0,this._setEndings(!0,!0,!1)),d>=b)d=b;else if(0>d)d=0;else{this.time=d;break a}this.clampWhenFinished?this.paused=!0:this.enabled=!1;this.time=d;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>a?-1:1})}else{-1===e&&(0<=a?(e=0,this._setEndings(!0,0===this.repetitions,f)):this._setEndings(0===this.repetitions,!0,f));if(d>=b||0>d){c=Math.floor(d/b);d-=b*c;e+=Math.abs(c);var g=this.repetitions-e;0>=g?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=d=0<a?b:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<a?1:-1})):(1===g?(a=0>a,this._setEndings(a,!a,f)):this._setEndings(!1,!1,f),this._loopCount=e,this.time=d,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:c}))}else this.time=d;if(f&&1===(e&1))return b-d}return d},_setEndings:function(a,b,c){var d=this._interpolantSettings;c?(d.endingStart=2401,d.endingEnd=2401):(d.endingStart=a?this.zeroSlopeAtStart?2401:2400:2402,d.endingEnd=b?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(a,b,c){var d=this._mixer,e=d.time,f=this._weightInterpolant;null===f&&(this._weightInterpolant=f=d._lendControlInterpolant());d=f.parameterPositions;f=f.sampleValues;d[0]=e;f[0]=b;d[1]=e+a;f[1]=c;return this}});Kg.prototype=Object.assign(Object.create(ra.prototype),{constructor:Kg,_bindAction:function(a,b){var c=a._localRoot||this._root,d=a._clip.tracks,e=d.length,f=a._propertyBindings;a=a._interpolants;var g=c.uuid,h=this._bindingsByRootAndName,k=h[g];void 0===k&&(k={},h[g]=k);for(h=0;h!==e;++h){var m=d[h],q=m.name,p=k[q];if(void 0===p){p=f[h];if(void 0!==p){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,g,q));continue}p=new Jg(pa.create(c,q,b&&b._propertyBindings[h].binding.parsedPath),m.ValueTypeName,m.getValueSize());++p.referenceCount;this._addInactiveBinding(p,g,q)}f[h]=p;a[h].resultBuffer=p.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var b=(a._localRoot||this._root).uuid,c=a._clip.uuid,d=this._actionsByClip[c];this._bindAction(a,d&&d.knownActions[0]);this._addInactiveAction(a,c,b)}b=a._propertyBindings;c=0;for(d=b.length;c!==d;++c){var e=b[c];0===e.useCount++&&(this._lendBinding(e),e.saveOriginalState())}this._lendAction(a)}},_deactivateAction:function(a){if(this._isActiveAction(a)){for(var b=a._propertyBindings,c=0,d=b.length;c!==d;++c){var e=b[c];0===--e.useCount&&(e.restoreOriginalState(),this._takeBackBinding(e))}this._takeBackAction(a)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var a=this;this.stats={actions:{get total(){return a._actions.length},get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}},_isActiveAction:function(a){a=a._cacheIndex;return null!==a&&a<this._nActiveActions},_addInactiveAction:function(a,b,c){var d=this._actions,e=this._actionsByClip,f=e[b];void 0===f?(f={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,e[b]=f):(b=f.knownActions,a._byClipCacheIndex=b.length,b.push(a));a._cacheIndex=d.length;d.push(a);f.actionByRoot[c]=a},_removeInactiveAction:function(a){var b=this._actions,c=b[b.length-1],d=a._cacheIndex;c._cacheIndex=d;b[d]=c;b.pop();a._cacheIndex=null;b=a._clip.uuid;c=this._actionsByClip;d=c[b];var e=d.knownActions,f=e[e.length-1],g=a._byClipCacheIndex;f._byClipCacheIndex=g;e[g]=f;e.pop();a._byClipCacheIndex=null;delete d.actionByRoot[(a._localRoot||this._root).uuid];0===e.length&&delete c[b];this._removeInactiveBindingsForAction(a)},_removeInactiveBindingsForAction:function(a){a=a._propertyBindings;for(var b=0,c=a.length;b!==c;++b){var d=a[b];0===--d.referenceCount&&this._removeInactiveBinding(d)}},_lendAction:function(a){var b=this._actions,c=a._cacheIndex,d=this._nActiveActions++,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackAction:function(a){var b=this._actions,c=a._cacheIndex,d=--this._nActiveActions,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_addInactiveBinding:function(a,b,c){var d=this._bindingsByRootAndName,e=this._bindings,f=d[b];void 0===f&&(f={},d[b]=f);f[c]=a;a._cacheIndex=e.length;e.push(a)},_removeInactiveBinding:function(a){var b=this._bindings,c=a.binding,d=c.rootNode.uuid;c=c.path;var e=this._bindingsByRootAndName,f=e[d],g=b[b.length-1];a=a._cacheIndex;g._cacheIndex=a;b[a]=g;b.pop();delete f[c];0===Object.keys(f).length&&delete e[d]},_lendBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=this._nActiveBindings++,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=--this._nActiveBindings,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_lendControlInterpolant:function(){var a=this._controlInterpolants,b=this._nActiveControlInterpolants++,c=a[b];void 0===c&&(c=new he(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),c.__cacheIndex=b,a[b]=c);return c},_takeBackControlInterpolant:function(a){var b=this._controlInterpolants,c=a.__cacheIndex,d=--this._nActiveControlInterpolants,e=b[d];a.__cacheIndex=d;b[d]=a;e.__cacheIndex=c;b[c]=e},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(a,b,c){var d=b||this._root,e=d.uuid;d="string"===typeof a?Qa.findByName(d,a):a;a=null!==d?d.uuid:a;var f=this._actionsByClip[a],g=null;void 0===c&&(c=null!==d?d.blendMode:2500);if(void 0!==f){g=f.actionByRoot[e];if(void 0!==g&&g.blendMode===c)return g;g=f.knownActions[0];null===d&&(d=g._clip)}if(null===d)return null;b=new ji(this,d,b,c);this._bindAction(b,g);this._addInactiveAction(b,a,e);return b},existingAction:function(a,b){var c=b||this._root;b=c.uuid;c="string"===typeof a?Qa.findByName(c,a):a;a=this._actionsByClip[c?c.uuid:a];return void 0!==a?a.actionByRoot[b]||null:null},stopAllAction:function(){for(var a=this._actions,b=this._nActiveActions-1;0<=b;--b)a[b].stop();return this},update:function(a){a*=this.timeScale;for(var b=this._actions,c=this._nActiveActions,d=this.time+=a,e=Math.sign(a),f=this._accuIndex^=1,g=0;g!==c;++g)b[g]._update(d,a,e,f);a=this._bindings;b=this._nActiveBindings;for(c=0;c!==b;++c)a[c].apply(f);return this},setTime:function(a){for(var b=this.time=0;b<this._actions.length;b++)this._actions[b].time=0;return this.update(a)},getRoot:function(){return this._root},uncacheClip:function(a){var b=this._actions;a=a.uuid;var c=this._actionsByClip,d=c[a];if(void 0!==d){d=d.knownActions;for(var e=0,f=d.length;e!==f;++e){var g=d[e];this._deactivateAction(g);var h=g._cacheIndex,k=b[b.length-1];g._cacheIndex=null;g._byClipCacheIndex=null;k._cacheIndex=h;b[h]=k;b.pop();this._removeInactiveBindingsForAction(g)}delete c[a]}},uncacheRoot:function(a){a=a.uuid;var b=this._actionsByClip;for(d in b){var c=b[d].actionByRoot[a];void 0!==c&&(this._deactivateAction(c),this._removeInactiveAction(c))}var d=this._bindingsByRootAndName[a];if(void 0!==d)for(var e in d)a=d[e],a.restoreOriginalState(),this._removeInactiveBinding(a)},uncacheAction:function(a,b){a=this.existingAction(a,b);null!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}});sf.prototype.clone=function(){return new sf(void 0===this.value.clone?this.value:this.value.clone())};Lg.prototype=Object.assign(Object.create(Ia.prototype),{constructor:Lg,isInstancedInterleavedBuffer:!0,copy:function(a){Ia.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this},clone:function(a){a=Ia.prototype.clone.call(this,a);a.meshPerAttribute=this.meshPerAttribute;return a},toJSON:function(a){a=Ia.prototype.toJSON.call(this,a);a.isInstancedInterleavedBuffer=!0;a.meshPerAttribute=this.meshPerAttribute;return a}});Object.assign(Mg.prototype,{set:function(a,b){this.ray.set(a,b)},setFromCamera:function(a,b){b&&b.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(b.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(b).sub(this.ray.origin).normalize(),this.camera=b):b&&b.isOrthographicCamera?(this.ray.origin.set(a.x,a.y,(b.near+b.far)/(b.near-b.far)).unproject(b),this.ray.direction.set(0,0,-1).transformDirection(b.matrixWorld),this.camera=b):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(a,b,c){c=c||[];Ng(a,this,c,b);c.sort(ki);return c},intersectObjects:function(a,b,c){c=c||[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),c;for(var d=0,e=a.length;d<e;d++)Ng(a[d],this,c,b);c.sort(ki);return c}});Object.assign(li.prototype,{set:function(a,b,c){this.radius=a;this.phi=b;this.theta=c;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius=a.radius;this.phi=a.phi;this.theta=a.theta;return this},makeSafe:function(){this.phi=Math.max(1E-6,Math.min(Math.PI-1E-6,this.phi));return this},setFromVector3:function(a){return this.setFromCartesianCoords(a.x,a.y,a.z)},setFromCartesianCoords:function(a,b,c){this.radius=Math.sqrt(a*a+b*b+c*c);0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a,c),this.phi=Math.acos(P.clamp(b/this.radius,-1,1)));return this}});Object.assign(mi.prototype,{set:function(a,b,c){this.radius=a;this.theta=b;this.y=c;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius=a.radius;this.theta=a.theta;this.y=a.y;return this},setFromVector3:function(a){return this.setFromCartesianCoords(a.x,a.y,a.z)},setFromCartesianCoords:function(a,b,c){this.radius=Math.sqrt(a*a+c*c);this.theta=Math.atan2(a,c);this.y=b;return this}});var Ti=new w;Object.assign(Og.prototype,{set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(a,b){b=Ti.copy(b).multiplyScalar(.5);this.min.copy(a).sub(b);this.max.copy(a).add(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(a){void 0===a&&(console.warn("THREE.Box2: .getCenter() target is now required"),a=new w);return this.isEmpty()?a.set(0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){void 0===a&&(console.warn("THREE.Box2: .getSize() target is now required"),a=new w);return this.isEmpty()?a.set(0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y},getParameter:function(a,b){void 0===b&&(console.warn("THREE.Box2: .getParameter() target is now required"),b=new w);return b.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?!1:!0},clampPoint:function(a,b){void 0===b&&(console.warn("THREE.Box2: .clampPoint() target is now required"),b=new w);return b.copy(a).clamp(this.min,this.max)},distanceToPoint:function(a){return Ti.copy(a).clamp(this.min,this.max).sub(a).length()},intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}});var Ui=new m,Uf=new m;Object.assign(Pg.prototype,{set:function(a,b){this.start.copy(a);this.end.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},getCenter:function(a){void 0===a&&(console.warn("THREE.Line3: .getCenter() target is now required"),a=new m);return a.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){void 0===a&&(console.warn("THREE.Line3: .delta() target is now required"),a=new m);return a.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,b){void 0===b&&(console.warn("THREE.Line3: .at() target is now required"),b=new m);return this.delta(b).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(a,b){Ui.subVectors(a,this.start);Uf.subVectors(this.end,this.start);a=Uf.dot(Uf);a=Uf.dot(Ui)/a;b&&(a=P.clamp(a,0,1));return a},closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);void 0===c&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),c=new m);return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)}});me.prototype=Object.create(y.prototype);me.prototype.constructor=me;me.prototype.isImmediateRenderObject=!0;var Vi=new m;fd.prototype=Object.create(y.prototype);fd.prototype.constructor=fd;fd.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};fd.prototype.update=function(){this.light.updateMatrixWorld();var a=this.light.distance?this.light.distance:1E3,b=a*Math.tan(this.light.angle);this.cone.scale.set(b,b,a);Vi.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(Vi);void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var Sb=new m,Vf=new T,oh=new T;oc.prototype=Object.create(da.prototype);oc.prototype.constructor=oc;oc.prototype.isSkeletonHelper=!0;oc.prototype.updateMatrixWorld=function(a){var b=this.bones,c=this.geometry,d=c.getAttribute("position");oh.getInverse(this.root.matrixWorld);for(var e=0,f=0;e<b.length;e++){var g=b[e];g.parent&&g.parent.isBone&&(Vf.multiplyMatrices(oh,g.matrixWorld),Sb.setFromMatrixPosition(Vf),d.setXYZ(f,Sb.x,Sb.y,Sb.z),Vf.multiplyMatrices(oh,g.parent.matrixWorld),Sb.setFromMatrixPosition(Vf),d.setXYZ(f+1,Sb.x,Sb.y,Sb.z),f+=2)}c.getAttribute("position").needsUpdate=!0;y.prototype.updateMatrixWorld.call(this,a)};gd.prototype=Object.create(Z.prototype);gd.prototype.constructor=gd;gd.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};gd.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var fl=new m,Wi=new H,Xi=new H;hd.prototype=Object.create(y.prototype);hd.prototype.constructor=hd;hd.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose()};hd.prototype.update=function(){var a=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var b=a.geometry.getAttribute("color");Wi.copy(this.light.color);Xi.copy(this.light.groundColor);for(var c=0,d=b.count;c<d;c++){var e=c<d/2?Wi:Xi;b.setXYZ(c,e.r,e.g,e.b)}b.needsUpdate=!0}a.lookAt(fl.setFromMatrixPosition(this.light.matrixWorld).negate())};tf.prototype=Object.assign(Object.create(da.prototype),{constructor:tf,copy:function(a){da.prototype.copy.call(this,a);this.geometry.copy(a.geometry);this.material.copy(a.material);return this},clone:function(){return(new this.constructor).copy(this)}});uf.prototype=Object.create(da.prototype);uf.prototype.constructor=uf;var Yi=new m,Wf=new m,Zi=new m;id.prototype=Object.create(y.prototype);id.prototype.constructor=id;id.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};id.prototype.update=function(){Yi.setFromMatrixPosition(this.light.matrixWorld);Wf.setFromMatrixPosition(this.light.target.matrixWorld);Zi.subVectors(Wf,Yi);this.lightPlane.lookAt(Wf);void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color));this.targetLine.lookAt(Wf);this.targetLine.scale.z=Zi.length()};var vf=new m,la=new eb;ne.prototype=Object.create(da.prototype);ne.prototype.constructor=ne;ne.prototype.update=function(){var a=this.geometry,b=this.pointMap;la.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);R("c",b,a,la,0,0,-1);R("t",b,a,la,0,0,1);R("n1",b,a,la,-1,-1,-1);R("n2",b,a,la,1,-1,-1);R("n3",b,a,la,-1,1,-1);R("n4",b,a,la,1,1,-1);R("f1",b,a,la,-1,-1,1);R("f2",b,a,la,1,-1,1);R("f3",b,a,la,-1,1,1);R("f4",b,a,la,1,1,1);R("u1",b,a,la,.7,1.1,-1);R("u2",b,a,la,-.7,1.1,-1);R("u3",b,a,la,0,2,-1);R("cf1",b,a,la,-1,0,1);R("cf2",b,a,la,1,0,1);R("cf3",b,a,la,0,-1,1);R("cf4",b,a,la,0,1,1);R("cn1",b,a,la,-1,0,-1);R("cn2",b,a,la,1,0,-1);R("cn3",b,a,la,0,-1,-1);R("cn4",b,a,la,0,1,-1);a.getAttribute("position").needsUpdate=!0};var Xf=new Ta;tb.prototype=Object.create(da.prototype);tb.prototype.constructor=tb;tb.prototype.update=function(a){void 0!==a&&console.warn("THREE.BoxHelper: .update() has no longer arguments.");void 0!==this.object&&Xf.setFromObject(this.object);if(!Xf.isEmpty()){a=Xf.min;var b=Xf.max,c=this.geometry.attributes.position,d=c.array;d[0]=b.x;d[1]=b.y;d[2]=b.z;d[3]=a.x;d[4]=b.y;d[5]=b.z;d[6]=a.x;d[7]=a.y;d[8]=b.z;d[9]=b.x;d[10]=a.y;d[11]=b.z;d[12]=b.x;d[13]=b.y;d[14]=a.z;d[15]=a.x;d[16]=b.y;d[17]=a.z;d[18]=a.x;d[19]=a.y;d[20]=a.z;d[21]=b.x;d[22]=a.y;d[23]=a.z;c.needsUpdate=!0;this.geometry.computeBoundingSphere()}};tb.prototype.setFromObject=function(a){this.object=a;this.update();return this};tb.prototype.copy=function(a){da.prototype.copy.call(this,a);this.object=a.object;return this};tb.prototype.clone=function(){return(new this.constructor).copy(this)};oe.prototype=Object.create(da.prototype);oe.prototype.constructor=oe;oe.prototype.updateMatrixWorld=function(a){var b=this.box;b.isEmpty()||(b.getCenter(this.position),b.getSize(this.scale),this.scale.multiplyScalar(.5),y.prototype.updateMatrixWorld.call(this,a))};pe.prototype=Object.create(Ja.prototype);pe.prototype.constructor=pe;pe.prototype.updateMatrixWorld=function(a){var b=-this.plane.constant;1E-8>Math.abs(b)&&(b=1E-8);this.scale.set(.5*this.size,.5*this.size,b);this.children[0].material.side=0>b?1:0;this.lookAt(this.plane.normal);y.prototype.updateMatrixWorld.call(this,a)};var $i=new m,wf,Qg;ub.prototype=Object.create(y.prototype);ub.prototype.constructor=ub;ub.prototype.setDirection=function(a){.99999<a.y?this.quaternion.set(0,0,0,1):-.99999>a.y?this.quaternion.set(1,0,0,0):($i.set(a.z,0,-a.x).normalize(),this.quaternion.setFromAxisAngle($i,Math.acos(a.y)))};ub.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a);void 0===c&&(c=.2*b);this.line.scale.set(1,Math.max(1E-4,a-b),1);this.line.updateMatrix();this.cone.scale.set(c,b,c);this.cone.position.y=a;this.cone.updateMatrix()};ub.prototype.setColor=function(a){this.line.material.color.set(a);this.cone.material.color.set(a)};ub.prototype.copy=function(a){y.prototype.copy.call(this,a,!1);this.line.copy(a.line);this.cone.copy(a.cone);return this};ub.prototype.clone=function(){return(new this.constructor).copy(this)};qe.prototype=Object.create(da.prototype);qe.prototype.constructor=qe;var lb=Math.pow(2,8),aj=[.125,.215,.35,.446,.526,.582],bj=5+aj.length,kb={3E3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},ph=new dd,qh=function(){for(var a=[],b=[],c=[],d=8,e=0;e<bj;e++){var f=Math.pow(2,d);b.push(f);var g=1/f;4<e?g=aj[e-8+4-1]:0==e&&(g=0);c.push(g);g=1/(f-1);f=-g/2;g=1+g/2;var h=[f,f,g,f,g,g,f,f,g,g,f,g];f=new Float32Array(108);g=new Float32Array(72);for(var k=new Float32Array(36),m=0;6>m;m++){var q=m%3*2/3-1,p=2<m?0:-1;f.set([q,p,0,q+2/3,p,0,q+2/3,p+1,0,q,p,0,q+2/3,p+1,0,q,p+1,0],18*m);g.set(h,12*m);k.set([m,m,m,m,m,m],6*m)}h=new D;h.setAttribute("position",new F(f,3));h.setAttribute("uv",new F(g,2));h.setAttribute("faceIndex",new F(k,1));a.push(h);4<d&&d--}return{_lodPlanes:a,_sizeLods:b,_sigmas:c}}(),Be=qh._lodPlanes,cj=qh._sizeLods,Yf=qh._sigmas,rh=null,xc=(1+Math.sqrt(5))/2,vd=1/xc,dj=[new m(1,1,1),new m(-1,1,1),new m(1,1,-1),new m(-1,1,-1),new m(0,xc,vd),new m(0,xc,-vd),new m(vd,0,xc),new m(-vd,0,xc),new m(xc,vd,0),new m(-xc,vd,0)];Rg.prototype={constructor:Rg,fromScene:function(a,b,c,d){void 0===b&&(b=0);void 0===c&&(c=.1);void 0===d&&(d=100);rh=this._renderer.getRenderTarget();var e=this._allocateTargets();this._sceneToCubeUV(a,c,d,e);0<b&&this._blur(e,0,0,b);this._applyPMREM(e);this._cleanup(e);return e},fromEquirectangular:function(a){return this._fromTexture(a)},fromCubemap:function(a){return this._fromTexture(a)},compileCubemapShader:function(){null===this._cubemapShader&&(this._cubemapShader=qi(),this._compileMaterial(this._cubemapShader))},compileEquirectangularShader:function(){null===this._equirectShader&&(this._equirectShader=pi(),this._compileMaterial(this._equirectShader))},dispose:function(){this._blurMaterial.dispose();null!==this._cubemapShader&&this._cubemapShader.dispose();null!==this._equirectShader&&this._equirectShader.dispose();for(var a=0;a<Be.length;a++)Be[a].dispose()},_cleanup:function(a){this._pingPongRenderTarget.dispose();this._renderer.setRenderTarget(rh);a.scissorTest=!1;xf(a,0,0,a.width,a.height)},_fromTexture:function(a){rh=this._renderer.getRenderTarget();var b=this._allocateTargets(a);this._textureToCubeUV(a,b);this._applyPMREM(b);this._cleanup(b);return b},_allocateTargets:function(a){var b=void 0===a||1009!==a.type?!1:3E3===a.encoding||3001===a.encoding||3007===a.encoding;b={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:1009,format:1023,encoding:b?a.encoding:3002,depthBuffer:!1,stencilBuffer:!1};var c=oi(b);c.depthBuffer=a?!1:!0;this._pingPongRenderTarget=oi(b);return c},_compileMaterial:function(a){a=new Z(Be[0],a);this._renderer.compile(a,ph)},_sceneToCubeUV:function(a,b,c,d){b=new ma(90,1,b,c);c=[1,-1,1,1,1,1];var e=[1,1,1,-1,-1,-1],f=this._renderer,g=f.outputEncoding,h=f.toneMapping,k=f.getClearColor(),m=f.getClearAlpha();f.toneMapping=0;f.outputEncoding=3E3;var q=a.background;if(q&&q.isColor){q.convertSRGBToLinear();var p=Math.min(Math.max(Math.ceil(Math.log2(Math.max(q.r,q.g,q.b))),-128),127);q=q.multiplyScalar(Math.pow(2,-p));f.setClearColor(q,(p+128)/255);a.background=null}for(q=0;6>q;q++)p=q%3,0==p?(b.up.set(0,c[q],0),b.lookAt(e[q],0,0)):1==p?(b.up.set(0,0,c[q]),b.lookAt(0,e[q],0)):(b.up.set(0,c[q],0),b.lookAt(0,0,e[q])),xf(d,p*lb,2<q?lb:0,lb,lb),f.setRenderTarget(d),f.render(a,b);f.toneMapping=h;f.outputEncoding=g;f.setClearColor(k,m)},_textureToCubeUV:function(a,b){var c=this._renderer;a.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=qi()):null==this._equirectShader&&(this._equirectShader=pi());var d=a.isCubeTexture?this._cubemapShader:this._equirectShader,e=new Z(Be[0],d);d=d.uniforms;d.envMap.value=a;a.isCubeTexture||d.texelSize.value.set(1/a.image.width,1/a.image.height);d.inputEncoding.value=kb[a.encoding];d.outputEncoding.value=kb[b.texture.encoding];xf(b,0,0,3*lb,2*lb);c.setRenderTarget(b);c.render(e,ph)},_applyPMREM:function(a){var b=this._renderer,c=b.autoClear;b.autoClear=!1;for(var d=1;d<bj;d++)this._blur(a,d-1,d,Math.sqrt(Yf[d]*Yf[d]-Yf[d-1]*Yf[d-1]),dj[(d-1)%dj.length]);b.autoClear=c},_blur:function(a,b,c,d,e){var f=this._pingPongRenderTarget;this._halfBlur(a,f,b,c,d,"latitudinal",e);this._halfBlur(f,a,c,c,d,"longitudinal",e)},_halfBlur:function(a,b,c,d,e,f,g){var h=this._renderer,k=this._blurMaterial;"latitudinal"!==f&&"longitudinal"!==f&&console.error("blur direction must be either latitudinal or longitudinal!");var m=new Z(Be[d],k);k=k.uniforms;var q=cj[c]-1;q=isFinite(e)?Math.PI/(2*q):2*Math.PI/39;var p=e/q,v=isFinite(e)?1+Math.floor(3*p):20;20<v&&console.warn("sigmaRadians, "+e+", is too large and will clip, as it requested "+v+" samples when the maximum is set to 20");e=[];for(var r=0,t=0;20>t;++t){var u=t/p;u=Math.exp(-u*u/2);e.push(u);0==t?r+=u:t<v&&(r+=2*u)}for(p=0;p<e.length;p++)e[p]/=r;k.envMap.value=a.texture;k.samples.value=v;k.weights.value=e;k.latitudinal.value="latitudinal"===f;g&&(k.poleAxis.value=g);k.dTheta.value=q;k.mipInt.value=8-c;k.inputEncoding.value=kb[a.texture.encoding];k.outputEncoding.value=kb[a.texture.encoding];a=cj[d];xf(b,3*Math.max(0,lb-2*a),(0===d?0:2*lb)+2*a*(4<d?d-8+4:0),3*a,2*a);h.setRenderTarget(b);h.render(m,ph)}};I.create=function(a,b){console.log("THREE.Curve.create() has been deprecated");a.prototype=Object.create(I.prototype);a.prototype.constructor=a;a.prototype.getPoint=b;return a};Object.assign(sb.prototype,{createPointsGeometry:function(a){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");a=this.getPoints(a);return this.createGeometry(a)},createSpacedPointsGeometry:function(a){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");a=this.getSpacedPoints(a);return this.createGeometry(a)},createGeometry:function(a){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var b=new J,c=0,d=a.length;c<d;c++){var e=a[c];b.vertices.push(new m(e.x,e.y,e.z||0))}return b}});Object.assign(ab.prototype,{fromPoints:function(a){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints().");return this.setFromPoints(a)}});ri.prototype=Object.create(ua.prototype);si.prototype=Object.create(ua.prototype);Ug.prototype=Object.create(ua.prototype);Object.assign(Ug.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});tf.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};oc.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Object.assign(U.prototype,{extractUrlBase:function(a){console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead.");return nh.extractUrlBase(a)}});U.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};Object.assign(qf.prototype,{setTexturePath:function(a){console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath().");return this.setResourcePath(a)}});Object.assign(Og.prototype,{center:function(a){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},size:function(a){console.warn("THREE.Box2: .size() has been renamed to .getSize().");return this.getSize(a)}});Object.assign(Ta.prototype,{center:function(a){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionSphere:function(a){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)},size:function(a){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(a)}});Object.assign(db.prototype,{empty:function(){console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty().");return this.isEmpty()}});Ec.prototype.setFromMatrix=function(a){console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix().");return this.setFromProjectionMatrix(a)};Pg.prototype.center=function(a){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");return this.getCenter(a)};Object.assign(P,{random16:function(){console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead.");return Math.random()},nearestPowerOfTwo:function(a){console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo().");return P.floorPowerOfTwo(a)},nextPowerOfTwo:function(a){console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo().");return P.ceilPowerOfTwo(a)}});Object.assign(za.prototype,{flattenToArrayOffset:function(a,b){console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(a,b)},multiplyVector3:function(a){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(a){console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}});Object.assign(T.prototype,{extractPosition:function(a){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)},flattenToArrayOffset:function(a,b){console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(a,b)},getPosition:function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return(new m).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(a){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(a){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector4:function(a){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(a){console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(a,b,c,d,e,f){console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.");return this.makePerspective(a,b,d,c,e,f)}});Ua.prototype.isIntersectionLine=function(a){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(a)};S.prototype.multiplyVector3=function(a){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return a.applyQuaternion(this)};Object.assign(Vb.prototype,{isIntersectionBox:function(a){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionPlane:function(a){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(a)},isIntersectionSphere:function(a){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)}});Object.assign(sa.prototype,{area:function(){console.warn("THREE.Triangle: .area() has been renamed to .getArea().");return this.getArea()},barycoordFromPoint:function(a,b){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return this.getBarycoord(a,b)},midpoint:function(a){console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint().");return this.getMidpoint(a)},normal:function(a){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");return this.getNormal(a)},plane:function(a){console.warn("THREE.Triangle: .plane() has been renamed to .getPlane().");return this.getPlane(a)}});Object.assign(sa,{barycoordFromPoint:function(a,b,c,d,e){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return sa.getBarycoord(a,b,c,d,e)},normal:function(a,b,c,d){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");return sa.getNormal(a,b,c,d)}});Object.assign(Mb.prototype,{extractAllPoints:function(a){console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead.");return this.extractPoints(a)},extrude:function(a){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");return new dc(this,a)},makeGeometry:function(a){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new fc(this,a)}});Object.assign(w.prototype,{fromAttribute:function(a,b,c){console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(a,b,c)},distanceToManhattan:function(a){console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(a)},lengthManhattan:function(){console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(m.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(b,a)},applyProjection:function(a){console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.");return this.applyMatrix4(a)},fromAttribute:function(a,b,c){console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(a,b,c)},distanceToManhattan:function(a){console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(a)},lengthManhattan:function(){console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(ba.prototype,{fromAttribute:function(a,b,c){console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(a,b,c)},lengthManhattan:function(){console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(J.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(a){console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4().");return this.applyMatrix4(a)}});Object.assign(y.prototype,{getChildByName:function(a){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(a)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(a,b){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(a){console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4().");return this.applyMatrix4(a)}});Object.defineProperties(y.prototype,{eulerOrder:{get:function(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function(a){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=a}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.assign(Z.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}});Object.defineProperties(Z.prototype,{drawMode:{get:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode.");return 0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});Object.defineProperties(Md.prototype,{objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});Object.defineProperty(Pe.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}});Oe.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};Object.defineProperty(I.prototype,"__arcLengthDivisions",{get:function(){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.");return this.arcLengthDivisions},set:function(a){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.");this.arcLengthDivisions=a}});ma.prototype.setLens=function(a,b){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");void 0!==b&&(this.filmGauge=b);this.setFocalLength(a)};Object.defineProperties(aa.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(a){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=a}},shadowCameraTop:{set:function(a){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");this.shadow.camera.far=a}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(a){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=a}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(a){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");this.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=a}}});Object.defineProperties(F.prototype,{length:{get:function(){console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead.");return this.array.length}},dynamic:{get:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead.");return 35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead.");this.setUsage(35048)}}});Object.assign(F.prototype,{setDynamic:function(a){console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead.");this.setUsage(!0===a?35048:35044);return this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}});Object.assign(D.prototype,{addIndex:function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(a)},addAttribute:function(a,b,c){console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute().");return b&&b.isBufferAttribute||b&&b.isInterleavedBufferAttribute?"index"===a?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(b),this):this.setAttribute(a,b):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(a,new F(b,c)))},addDrawCall:function(a,b,c){void 0!==c&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.");console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(a,b)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(a){console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute().");return this.deleteAttribute(a)},applyMatrix:function(a){console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4().");return this.applyMatrix4(a)}});Object.defineProperties(D.prototype,{drawcalls:{get:function(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups}}});Object.defineProperties(le.prototype,{maxInstancedCount:{get:function(){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount.");return this.instanceCount},set:function(a){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount.");this.instanceCount=a}}});Object.defineProperties(Mg.prototype,{linePrecision:{get:function(){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead.");return this.params.Line.threshold},set:function(a){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead.");this.params.Line.threshold=a}}});Object.defineProperties(Ia.prototype,{dynamic:{get:function(){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead.");return 35048===this.usage},set:function(a){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead.");this.setUsage(a)}}});Object.assign(Ia.prototype,{setDynamic:function(a){console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead.");this.setUsage(!0===a?35048:35044);return this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}});Object.assign(fb.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}});Object.defineProperties(sf.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.");return this}}});Object.defineProperties(K.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){console.warn("THREE.Material: .wrapRGB has been removed.");return new H}},shading:{get:function(){console.error("THREE."+
this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(a){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.");this.flatShading=1===a}},stencilMask:{get:function(){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead.");return this.stencilFuncMask},set:function(a){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead.");this.stencilFuncMask=a}}});Object.defineProperties(Lb.prototype,{metal:{get:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");return!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(Kb.prototype,{transparency:{get:function(){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission.");return this.transmission},set:function(a){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission.");this.transmission=a}}});Object.defineProperties(Ba.prototype,{derivatives:{get:function(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");return this.extensions.derivatives},set:function(a){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=a}}});Object.assign(Jd.prototype,{clearTarget:function(a,b,c,d){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead.");this.setRenderTarget(a);this.clear(b,c,d)},animate:function(a){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop().");this.setAnimationLoop(a)},getCurrentRenderTarget:function(){console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget().");return this.getRenderTarget()},getMaxAnisotropy:function(){console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy().");return this.capabilities.getMaxAnisotropy()},getPrecision:function(){console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision.");return this.capabilities.precision},resetGLState:function(){console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset().");return this.state.reset()},supportsFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.");return this.capabilities.vertexTextures},supportsInstancedArrays:function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(a)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel().");return this.getActiveMipmapLevel()}});Object.defineProperties(Jd.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");this.shadowMap.type=a}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead.");return this.getContext()}},vr:{get:function(){console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr");return this.xr}},gammaInput:{get:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.");return!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead.");return!1},set:function(a){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead.");this.outputEncoding=!0===a?3001:3E3}},toneMappingWhitePoint:{get:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.");return 1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(Sh.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(Ea.prototype,{wrapS:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=a}},wrapT:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=a}},magFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");return this.texture.magFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=a}},minFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=a}},anisotropy:{get:function(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");return this.texture.anisotropy},set:function(a){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=a}},offset:{get:function(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function(a){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=a}},repeat:{get:function(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},set:function(a){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=a}},format:{get:function(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function(a){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=a}},type:{get:function(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function(a){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");this.texture.type=a}},generateMipmaps:{get:function(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function(a){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=a}}});Object.defineProperties(ed.prototype,{load:{value:function(a){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var b=this;(new rf).load(a,function(a){b.setBuffer(a)});return this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}});Ig.prototype.getData=function(){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()};Dc.prototype.updateCubeMap=function(a,b){console.warn("THREE.CubeCamera: .updateCubeMap() is now .update().");return this.update(a,b)};Nb.crossOrigin=void 0;Nb.loadTexture=function(a,b,c,d){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var e=new cf;e.setCrossOrigin(this.crossOrigin);a=e.load(a,c,void 0,d);b&&(a.mapping=b);return a};Nb.loadTextureCube=function(a,b,c,d){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var e=new bf;e.setCrossOrigin(this.crossOrigin);a=e.load(a,c,void 0,d);b&&(a.mapping=b);return a};Nb.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};Nb.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"119dev"}}));k.ACESFilmicToneMapping=4;k.AddEquation=100;k.AddOperation=2;k.AdditiveAnimationBlendMode=2501;k.AdditiveBlending=2;k.AlphaFormat=1021;k.AlwaysDepth=1;k.AlwaysStencilFunc=519;k.AmbientLight=kf;k.AmbientLightProbe=Dg;k.AnimationClip=Qa;k.AnimationLoader=ug;k.AnimationMixer=Kg;k.AnimationObjectGroup=ii;k.AnimationUtils=X;k.ArcCurve=cd;k.ArrayCamera=Je;k.ArrowHelper=ub;k.Audio=ed;k.AudioAnalyser=Ig;k.AudioContext=Gg;k.AudioListener=Fg;k.AudioLoader=rf;k.AxesHelper=qe;k.AxisHelper=function(a){console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper.");return new qe(a)};k.BackSide=1;k.BasicDepthPacking=3200;k.BasicShadowMap=0;k.BinaryTextureLoader=function(a){console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader.");return new af(a)};k.Bone=ng;k.BooleanKeyframeTrack=Xe;k.BoundingBoxHelper=function(a,b){console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead.");return new tb(a,b)};k.Box2=Og;k.Box3=Ta;k.Box3Helper=oe;k.BoxBufferGeometry=Fd;k.BoxGeometry=hh;k.BoxHelper=tb;k.BufferAttribute=F;k.BufferGeometry=D;k.BufferGeometryLoader=pf;k.ByteType=1010;k.Cache=sc;k.Camera=eb;k.CameraHelper=ne;k.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")};k.CanvasTexture=Nd;k.CatmullRomCurve3=ua;k.CineonToneMapping=3;k.CircleBufferGeometry=Zc;k.CircleGeometry=ge;k.ClampToEdgeWrapping=1001;k.Clock=Eg;k.ClosedSplineCurve3=ri;k.Color=H;k.ColorKeyframeTrack=Ye;k.CompressedTexture=Mc;k.CompressedTextureLoader=vg;k.ConeBufferGeometry=fe;k.ConeGeometry=ee;k.CubeCamera=Dc;k.CubeGeometry=hh;k.CubeReflectionMapping=301;k.CubeRefractionMapping=302;k.CubeTexture=ob;k.CubeTextureLoader=bf;k.CubeUVReflectionMapping=306;k.CubeUVRefractionMapping=307;k.CubicBezierCurve=Xa;k.CubicBezierCurve3=hb;k.CubicInterpolant=Ve;k.CullFaceBack=1;k.CullFaceFront=2;k.CullFaceFrontBack=3;k.CullFaceNone=0;k.Curve=I;k.CurvePath=sb;k.CustomBlending=5;k.CustomToneMapping=5;k.CylinderBufferGeometry=qb;k.CylinderGeometry=hc;k.Cylindrical=mi;k.DataTexture=Zb;k.DataTexture2DArray=Fc;k.DataTexture3D=Gc;k.DataTextureLoader=af;k.DecrementStencilOp=7683;k.DecrementWrapStencilOp=34056;k.DefaultLoadingManager=ei;k.DepthFormat=1026;k.DepthStencilFormat=1027;k.DepthTexture=Od;k.DirectionalLight=jf;k.DirectionalLightHelper=id;k.DirectionalLightShadow=hf;k.DiscreteInterpolant=We;k.DodecahedronBufferGeometry=Rc;k.DodecahedronGeometry=Ud;k.DoubleSide=2;k.DstAlphaFactor=206;k.DstColorFactor=208;k.DynamicBufferAttribute=function(a,b){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead.");return(new F(a,b)).setUsage(35048)};k.DynamicCopyUsage=35050;k.DynamicDrawUsage=35048;k.DynamicReadUsage=35049;k.EdgesGeometry=Yc;k.EdgesHelper=function(a,b){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");return new da(new Yc(a.geometry),new ia({color:void 0!==b?b:16777215}))};k.EllipseCurve=La;k.EqualDepth=4;k.EqualStencilFunc=514;k.EquirectangularReflectionMapping=303;k.EquirectangularRefractionMapping=304;k.Euler=Tb;k.EventDispatcher=ra;k.ExtrudeBufferGeometry=fb;k.ExtrudeGeometry=dc;k.Face3=yc;k.Face4=function(a,b,c,d,e,f,g){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new yc(a,b,c,e,f,g)};k.FaceColors=1;k.FileLoader=Ra;k.FlatShading=1;k.Float32Attribute=function(a,b){console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead.");return new C(a,b)};k.Float32BufferAttribute=C;k.Float64Attribute=function(a,b){console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead.");return new Cd(a,b)};k.Float64BufferAttribute=Cd;k.FloatType=1015;k.Fog=Me;k.FogExp2=Le;k.Font=Ag;k.FontLoader=Bg;k.FrontSide=0;k.Frustum=Ec;k.GammaEncoding=3007;k.Geometry=J;k.GeometryUtils={merge:function(a,b,c){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");if(b.isMesh){b.matrixAutoUpdate&&b.updateMatrix();var d=b.matrix;b=b.geometry}a.merge(b,d,c)},center:function(a){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return a.center()}};k.GreaterDepth=6;k.GreaterEqualDepth=5;k.GreaterEqualStencilFunc=518;k.GreaterStencilFunc=516;k.GridHelper=tf;k.Group=Ic;k.HalfFloatType=1016;k.HemisphereLight=df;k.HemisphereLightHelper=hd;k.HemisphereLightProbe=Cg;k.IcosahedronBufferGeometry=Qc;k.IcosahedronGeometry=Td;k.ImageBitmapLoader=yg;k.ImageLoader=bd;k.ImageUtils=Nb;k.ImmediateRenderObject=me;k.IncrementStencilOp=7682;k.IncrementWrapStencilOp=34055;k.InstancedBufferAttribute=of;k.InstancedBufferGeometry=le;k.InstancedInterleavedBuffer=Lg;k.InstancedMesh=Qe;k.Int16Attribute=function(a,b){console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead.");return new Ad(a,b)};k.Int16BufferAttribute=Ad;k.Int32Attribute=function(a,b){console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead.");return new Bd(a,b)};k.Int32BufferAttribute=Bd;k.Int8Attribute=function(a,b){console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead.");return new xd(a,b)};k.Int8BufferAttribute=xd;k.IntType=1013;k.InterleavedBuffer=Ia;k.InterleavedBufferAttribute=Hb;k.Interpolant=Ka;k.InterpolateDiscrete=2300;k.InterpolateLinear=2301;k.InterpolateSmooth=2302;k.InvertStencilOp=5386;k.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")};k.KeepStencilOp=7680;k.KeyframeTrack=ta;k.LOD=Md;k.LatheBufferGeometry=Xc;k.LatheGeometry=de;k.Layers=Ce;k.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")};k.LessDepth=2;k.LessEqualDepth=3;k.LessEqualStencilFunc=515;k.LessStencilFunc=513;k.Light=aa;k.LightProbe=Sa;k.LightShadow=jb;k.Line=Ja;k.Line3=Pg;k.LineBasicMaterial=ia;k.LineCurve=va;k.LineCurve3=Ya;k.LineDashedMaterial=nc;k.LineLoop=Re;k.LinePieces=1;k.LineSegments=da;k.LineStrip=0;k.LinearEncoding=3E3;k.LinearFilter=1006;k.LinearInterpolant=he;k.LinearMipMapLinearFilter=1008;k.LinearMipMapNearestFilter=1007;k.LinearMipmapLinearFilter=1008;k.LinearMipmapNearestFilter=1007;k.LinearToneMapping=1;k.Loader=U;k.LoaderUtils=nh;k.LoadingManager=tg;k.LogLuvEncoding=3003;k.LoopOnce=2200;k.LoopPingPong=2202;k.LoopRepeat=2201;k.LuminanceAlphaFormat=1025;k.LuminanceFormat=1024;k.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2};k.Material=K;k.MaterialLoader=nf;k.Math=P;k.MathUtils=P;k.Matrix3=za;k.Matrix4=T;k.MaxEquation=104;k.Mesh=Z;k.MeshBasicMaterial=Na;k.MeshDepthMaterial=Eb;k.MeshDistanceMaterial=Fb;k.MeshFaceMaterial=function(a){console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead.");return a};k.MeshLambertMaterial=lc;k.MeshMatcapMaterial=mc;k.MeshNormalMaterial=kc;k.MeshPhongMaterial=Lb;k.MeshPhysicalMaterial=Kb;k.MeshStandardMaterial=gb;k.MeshToonMaterial=jc;k.MinEquation=103;k.MirroredRepeatWrapping=1002;k.MixOperation=1;k.MultiMaterial=function(a){void 0===a&&(a=[]);console.warn("THREE.MultiMaterial has been removed. Use an Array instead.");a.isMultiMaterial=!0;a.materials=a;a.clone=function(){return a.slice()};return a};k.MultiplyBlending=4;k.MultiplyOperation=0;k.NearestFilter=1003;k.NearestMipMapLinearFilter=1005;k.NearestMipMapNearestFilter=1004;k.NearestMipmapLinearFilter=1005;k.NearestMipmapNearestFilter=1004;k.NeverDepth=0;k.NeverStencilFunc=512;k.NoBlending=0;k.NoColors=0;k.NoToneMapping=0;k.NormalAnimationBlendMode=2500;k.NormalBlending=1;k.NotEqualDepth=7;k.NotEqualStencilFunc=517;k.NumberKeyframeTrack=$c;k.Object3D=y;k.ObjectLoader=qf;k.ObjectSpaceNormalMap=1;k.OctahedronBufferGeometry=bc;k.OctahedronGeometry=Sd;k.OneFactor=201;k.OneMinusDstAlphaFactor=207;k.OneMinusDstColorFactor=209;k.OneMinusSrcAlphaFactor=205;k.OneMinusSrcColorFactor=203;k.OrthographicCamera=dd;k.PCFShadowMap=1;k.PCFSoftShadowMap=2;k.PMREMGenerator=Rg;k.ParametricBufferGeometry=Oc;k.ParametricGeometry=Pd;k.Particle=function(a){console.warn("THREE.Particle has been renamed to THREE.Sprite.");return new Kd(a)};k.ParticleBasicMaterial=function(a){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new Wa(a)};k.ParticleSystem=function(a,b){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new Lc(a,b)};k.ParticleSystemMaterial=function(a){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new Wa(a)};k.Path=ab;k.PerspectiveCamera=ma;k.Plane=Ua;k.PlaneBufferGeometry=$b;k.PlaneGeometry=Ed;k.PlaneHelper=pe;k.PointCloud=function(a,b){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new Lc(a,b)};k.PointCloudMaterial=function(a){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new Wa(a)};k.PointLight=gf;k.PointLightHelper=gd;k.Points=Lc;k.PointsMaterial=Wa;k.PolarGridHelper=uf;k.PolyhedronBufferGeometry=ha;k.PolyhedronGeometry=Qd;k.PositionalAudio=Hg;k.PropertyBinding=pa;k.PropertyMixer=Jg;k.QuadraticBezierCurve=Za;k.QuadraticBezierCurve3=ib;k.Quaternion=S;k.QuaternionKeyframeTrack=ie;k.QuaternionLinearInterpolant=Ze;k.REVISION="119dev";k.RGBADepthPacking=3201;k.RGBAFormat=1023;k.RGBAIntegerFormat=1033;k.RGBA_ASTC_10x10_Format=37819;k.RGBA_ASTC_10x5_Format=37816;k.RGBA_ASTC_10x6_Format=37817;k.RGBA_ASTC_10x8_Format=37818;k.RGBA_ASTC_12x10_Format=37820;k.RGBA_ASTC_12x12_Format=37821;k.RGBA_ASTC_4x4_Format=37808;k.RGBA_ASTC_5x4_Format=37809;k.RGBA_ASTC_5x5_Format=37810;k.RGBA_ASTC_6x5_Format=37811;k.RGBA_ASTC_6x6_Format=37812;k.RGBA_ASTC_8x5_Format=37813;k.RGBA_ASTC_8x6_Format=37814;k.RGBA_ASTC_8x8_Format=37815;k.RGBA_BPTC_Format=36492;k.RGBA_ETC2_EAC_Format=37496;k.RGBA_PVRTC_2BPPV1_Format=35843;k.RGBA_PVRTC_4BPPV1_Format=35842;k.RGBA_S3TC_DXT1_Format=33777;k.RGBA_S3TC_DXT3_Format=33778;k.RGBA_S3TC_DXT5_Format=33779;k.RGBDEncoding=3006;k.RGBEEncoding=3002;k.RGBEFormat=1023;k.RGBFormat=1022;k.RGBIntegerFormat=1032;k.RGBM16Encoding=3005;k.RGBM7Encoding=3004;k.RGB_ETC1_Format=36196;k.RGB_ETC2_Format=37492;k.RGB_PVRTC_2BPPV1_Format=35841;k.RGB_PVRTC_4BPPV1_Format=35840;k.RGB_S3TC_DXT1_Format=33776;k.RGFormat=1030;k.RGIntegerFormat=1031;k.RawShaderMaterial=rb;k.Ray=Vb;k.Raycaster=Mg;k.RectAreaLight=lf;k.RedFormat=1028;k.RedIntegerFormat=1029;k.ReinhardToneMapping=2;k.RepeatWrapping=1E3;k.ReplaceStencilOp=7681;k.ReverseSubtractEquation=102;k.RingBufferGeometry=Wc;k.RingGeometry=ce;k.SRGB8_ALPHA8_ASTC_10x10_Format=37851;k.SRGB8_ALPHA8_ASTC_10x5_Format=37848;k.SRGB8_ALPHA8_ASTC_10x6_Format=37849;k.SRGB8_ALPHA8_ASTC_10x8_Format=37850;k.SRGB8_ALPHA8_ASTC_12x10_Format=37852;k.SRGB8_ALPHA8_ASTC_12x12_Format=37853;k.SRGB8_ALPHA8_ASTC_4x4_Format=37840;k.SRGB8_ALPHA8_ASTC_5x4_Format=37841;k.SRGB8_ALPHA8_ASTC_5x5_Format=37842;k.SRGB8_ALPHA8_ASTC_6x5_Format=37843;k.SRGB8_ALPHA8_ASTC_6x6_Format=37844;k.SRGB8_ALPHA8_ASTC_8x5_Format=37845;k.SRGB8_ALPHA8_ASTC_8x6_Format=37846;k.SRGB8_ALPHA8_ASTC_8x8_Format=37847;k.Scene=wd;k.SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};k.ShaderChunk=M;k.ShaderLib=Va;k.ShaderMaterial=Ba;k.ShadowMaterial=ic;k.Shape=Mb;k.ShapeBufferGeometry=gc;k.ShapeGeometry=fc;k.ShapePath=zg;k.ShapeUtils=pb;k.ShortType=1011;k.Skeleton=Pe;k.SkeletonHelper=oc;k.SkinnedMesh=Oe;k.SmoothShading=2;k.Sphere=db;k.SphereBufferGeometry=ec;k.SphereGeometry=be;k.Spherical=li;k.SphericalHarmonics3=mf;k.Spline=Ug;k.SplineCurve=$a;k.SplineCurve3=si;k.SpotLight=ff;k.SpotLightHelper=fd;k.SpotLightShadow=ef;k.Sprite=Kd;k.SpriteMaterial=Ib;k.SrcAlphaFactor=204;k.SrcAlphaSaturateFactor=210;k.SrcColorFactor=202;k.StaticCopyUsage=35046;k.StaticDrawUsage=35044;k.StaticReadUsage=35045;k.StereoCamera=gi;k.StreamCopyUsage=35042;k.StreamDrawUsage=35040;k.StreamReadUsage=35041;k.StringKeyframeTrack=$e;k.SubtractEquation=101;k.SubtractiveBlending=3;k.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3};k.TangentSpaceNormalMap=0;k.TetrahedronBufferGeometry=Pc;k.TetrahedronGeometry=Rd;k.TextBufferGeometry=Vc;k.TextGeometry=ae;k.Texture=V;k.TextureLoader=cf;k.TorusBufferGeometry=Tc;k.TorusGeometry=Xd;k.TorusKnotBufferGeometry=Sc;k.TorusKnotGeometry=Wd;k.Triangle=sa;k.TriangleFanDrawMode=2;k.TriangleStripDrawMode=1;k.TrianglesDrawMode=0;k.TubeBufferGeometry=cc;k.TubeGeometry=Vd;k.UVMapping=300;k.Uint16Attribute=function(a,b){console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead.");return new Wb(a,b)};k.Uint16BufferAttribute=Wb;k.Uint32Attribute=function(a,b){console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead.");return new Xb(a,b)};k.Uint32BufferAttribute=Xb;k.Uint8Attribute=function(a,b){console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead.");return new yd(a,b)};k.Uint8BufferAttribute=yd;k.Uint8ClampedAttribute=function(a,b){console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead.");return new zd(a,b)};k.Uint8ClampedBufferAttribute=zd;k.Uniform=sf;k.UniformsLib=G;k.UniformsUtils=Ph;k.UnsignedByteType=1009;k.UnsignedInt248Type=1020;k.UnsignedIntType=1014;k.UnsignedShort4444Type=1017;k.UnsignedShort5551Type=1018;k.UnsignedShort565Type=1019;k.UnsignedShortType=1012;k.VSMShadowMap=3;k.Vector2=w;k.Vector3=m;k.Vector4=ba;k.VectorKeyframeTrack=ad;k.Vertex=function(a,b,c){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new m(a,b,c)};k.VertexColors=2;k.VideoTexture=qg;k.WebGL1Renderer=mg;k.WebGLCubeRenderTarget=Yb;k.WebGLMultisampleRenderTarget=Zf;k.WebGLRenderTarget=Ea;k.WebGLRenderTargetCube=function(a,b,c){console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options ).");return new Yb(a,c)};k.WebGLRenderer=Jd;k.WebGLUtils=Th;k.WireframeGeometry=Nc;k.WireframeHelper=function(a,b){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");return new da(new Nc(a.geometry),new ia({color:void 0!==b?b:16777215}))};k.WrapAroundEnding=2402;k.XHRLoader=function(a){console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader.");return new Ra(a)};k.ZeroCurvatureEnding=2400;k.ZeroFactor=200;k.ZeroSlopeEnding=2401;k.ZeroStencilOp=0;k.sRGBEncoding=3001;Object.defineProperty(k,"__esModule",{value:!0})});;

/* /stock_3dview/static/src/js/libs/stats.min.js defined in bundle 'web.assets_backend' */
var Stats=function(){function h(a){c.appendChild(a.dom);return a}function k(a){for(var d=0;d<c.children.length;d++)c.children[d].style.display=d===a?"block":"none";l=a}var l=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000";c.addEventListener("click",function(a){a.preventDefault();k(++l%c.children.length)},!1);var g=(performance||Date).now(),e=g,a=0,r=h(new Stats.Panel("FPS","#0ff","#002")),f=h(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var t=h(new Stats.Panel("MB","#f08","#201"));k(0);return{REVISION:16,dom:c,addPanel:h,showPanel:k,begin:function(){g=(performance||Date).now()},end:function(){a++;var c=(performance||Date).now();f.update(c-g,200);if(c>e+1E3&&(r.update(1E3*a/(c-e),100),e=c,a=0,t)){var d=performance.memory;t.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return c},update:function(){g=this.end()},domElement:c,setMode:k}};Stats.Panel=function(h,k,l){var c=Infinity,g=0,e=Math.round,a=e(window.devicePixelRatio||1),r=80*a,f=48*a,t=3*a,u=2*a,d=3*a,m=15*a,n=74*a,p=30*a,q=document.createElement("canvas");q.width=r;q.height=f;q.style.cssText="width:80px;height:48px";var b=q.getContext("2d");b.font="bold "+9*a+"px Helvetica,Arial,sans-serif";b.textBaseline="top";b.fillStyle=l;b.fillRect(0,0,r,f);b.fillStyle=k;b.fillText(h,t,u);b.fillRect(d,m,n,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d,m,n,p);return{dom:q,update:function(f,v){c=Math.min(c,f);g=Math.max(g,f);b.fillStyle=l;b.globalAlpha=1;b.fillRect(0,0,r,m);b.fillStyle=k;b.fillText(e(f)+" "+h+" ("+e(c)+"-"+e(g)+")",t,u);b.drawImage(q,d+a,m,n-a,p,d,m,n-a,p);b.fillRect(d+n-a,m,a,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d+n-a,m,a,e((1-f/v)*p))}}};"object"===typeof module&&(module.exports=Stats);;

/* /stock_3dview/static/src/js/libs/dat.gui.min.js defined in bundle 'web.assets_backend' */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.dat=t():e.dat=t()}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(1),r=o(i);t.default=r.default,e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(2),r=o(i),a=n(6),l=o(a),s=n(3),u=o(s),d=n(7),c=o(d),f=n(8),_=o(f),p=n(10),h=o(p),m=n(11),b=o(m),g=n(12),v=o(g),y=n(13),w=o(y),x=n(14),E=o(x),C=n(15),A=o(C),S=n(16),k=o(S),O=n(9),T=o(O),R=n(17),L=o(R);t.default={color:{Color:r.default,math:l.default,interpret:u.default},controllers:{Controller:c.default,BooleanController:_.default,OptionController:h.default,StringController:b.default,NumberController:v.default,NumberControllerBox:w.default,NumberControllerSlider:E.default,FunctionController:A.default,ColorController:k.default},dom:{dom:T.default},gui:{GUI:L.default},GUI:L.default},e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(h.recalculateRGB(this,t,n),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(h.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function a(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(h.recalculateHSV(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(h.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}t.__esModule=!0;var l=n(3),s=o(l),u=n(6),d=o(u),c=n(4),f=o(c),_=n(5),p=o(_),h=function(){function e(){if(i(this,e),this.__state=s.default.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return e.prototype.toString=function(){return(0,f.default)(this)},e.prototype.toHexString=function(){return(0,f.default)(this,!0)},e.prototype.toOriginal=function(){return this.__state.conversion.write(this)},e}();h.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=d.default.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");p.default.extend(e.__state,d.default.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},h.recalculateHSV=function(e){var t=d.default.rgb_to_hsv(e.r,e.g,e.b);p.default.extend(e.__state,{s:t.s,v:t.v}),p.default.isNaN(t.h)?p.default.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},h.COMPONENTS=["r","g","b","h","s","v","hex","a"],r(h.prototype,"r",2),r(h.prototype,"g",1),r(h.prototype,"b",0),a(h.prototype,"h"),a(h.prototype,"s"),a(h.prototype,"v"),Object.defineProperty(h.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(h.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=d.default.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}}),t.default=h,e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(4),r=o(i),a=n(5),l=o(a),s=[{litmus:l.default.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:r.default},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:r.default},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:r.default},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:r.default}}},{litmus:l.default.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:l.default.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:l.default.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(l.default.isNumber(e.r)&&l.default.isNumber(e.g)&&l.default.isNumber(e.b)&&l.default.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(l.default.isNumber(e.r)&&l.default.isNumber(e.g)&&l.default.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(l.default.isNumber(e.h)&&l.default.isNumber(e.s)&&l.default.isNumber(e.v)&&l.default.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(l.default.isNumber(e.h)&&l.default.isNumber(e.s)&&l.default.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],u=void 0,d=void 0,c=function(){d=!1;var e=arguments.length>1?l.default.toArray(arguments):arguments[0];return l.default.each(s,function(t){if(t.litmus(e))return l.default.each(t.conversions,function(t,n){if(u=t.read(e),d===!1&&u!==!1)return d=u,u.conversionName=n,u.conversion=t,l.default.BREAK}),l.default.BREAK}),d};t.default=c,e.exports=t.default},function(e,t){"use strict";t.__esModule=!0,t.default=function(e,t){var n=e.__state.conversionName.toString(),o=Math.round(e.r),i=Math.round(e.g),r=Math.round(e.b),a=e.a,l=Math.round(e.h),s=e.s.toFixed(1),u=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var d=e.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}return"CSS_RGB"===n?"rgb("+o+","+i+","+r+")":"CSS_RGBA"===n?"rgba("+o+","+i+","+r+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+o+","+i+","+r+"]":"RGBA_ARRAY"===n?"["+o+","+i+","+r+","+a+"]":"RGB_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+"}":"RGBA_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+l+",s:"+s+",v:"+u+"}":"HSVA_OBJ"===n?"{h:"+l+",s:"+s+",v:"+u+",a:"+a+"}":"unknown format"},e.exports=t.default},function(e,t){"use strict";t.__esModule=!0;var n=Array.prototype.forEach,o=Array.prototype.slice,i={BREAK:{},extend:function(e){return this.each(o.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))},this),e},defaults:function(e){return this.each(o.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))},this),e},compose:function(){var e=o.call(arguments);return function(){for(var t=o.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,o){if(e)if(n&&e.forEach&&e.forEach===n)e.forEach(t,o);else if(e.length===e.length+0){var i=void 0,r=void 0;for(i=0,r=e.length;i<r;i++)if(i in e&&t.call(o,e[i],i)===this.BREAK)return}else for(var a in e)if(t.call(o,e[a],a)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var o=void 0;return function(){function i(){o=null,n||e.apply(r,a)}var r=this,a=arguments,l=n||!o;clearTimeout(o),o=setTimeout(i,t),l&&e.apply(r,a)}},toArray:function(e){return e.toArray?e.toArray():o.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}};t.default=i,e.exports=t.default},function(e,t){"use strict";t.__esModule=!0;var n=void 0,o={hsv_to_rgb:function(e,t,n){var o=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),r=n*(1-t),a=n*(1-i*t),l=n*(1-(1-i)*t),s=[[n,l,r],[a,n,r],[r,n,l],[r,a,n],[l,r,n],[n,r,a]][o];return{r:255*s[0],g:255*s[1],b:255*s[2]}},rgb_to_hsv:function(e,t,n){var o=Math.min(e,t,n),i=Math.max(e,t,n),r=i-o,a=void 0,l=void 0;return 0===i?{h:NaN,s:0,v:0}:(l=r/i,a=e===i?(t-n)/r:t===i?2+(n-e)/r:4+(e-t)/r,a/=6,a<0&&(a+=1),{h:360*a,s:l,v:i/255})},rgb_to_hex:function(e,t,n){var o=this.hex_with_component(0,2,e);return o=this.hex_with_component(o,1,t),o=this.hex_with_component(o,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,o){return o<<(n=8*t)|e&~(255<<n)}};t.default=o,e.exports=t.default},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var o=function(){function e(t,o){n(this,e),this.initialValue=t[o],this.domElement=document.createElement("div"),this.object=t,this.property=o,this.__onChange=void 0,this.__onFinishChange=void 0}return e.prototype.onChange=function(e){return this.__onChange=e,this},e.prototype.onFinishChange=function(e){return this.__onFinishChange=e,this},e.prototype.setValue=function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this},e.prototype.getValue=function(){return this.object[this.property]},e.prototype.updateDisplay=function(){return this},e.prototype.isModified=function(){return this.initialValue!==this.getValue()},e}();t.default=o,e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var l=n(7),s=o(l),u=n(9),d=o(u),c=function(e){function t(n,o){function a(){s.setValue(!s.__prev)}i(this,t);var l=r(this,e.call(this,n,o)),s=l;return l.__prev=l.getValue(),l.__checkbox=document.createElement("input"),l.__checkbox.setAttribute("type","checkbox"),d.default.bind(l.__checkbox,"change",a,!1),l.domElement.appendChild(l.__checkbox),l.updateDisplay(),l}return a(t,e),t.prototype.setValue=function(t){var n=e.prototype.setValue.call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n},t.prototype.updateDisplay=function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),e.prototype.updateDisplay.call(this)},t}(s.default);t.default=c,e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e){if("0"===e||a.default.isUndefined(e))return 0;var t=e.match(u);return a.default.isNull(t)?0:parseFloat(t[1])}t.__esModule=!0;var r=n(5),a=o(r),l={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},s={};a.default.each(l,function(e,t){a.default.each(e,function(e){s[e]=t})});var u=/(\d+(\.\d+)?)px/,d={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var o=n,i=t;a.default.isUndefined(i)&&(i=!0),a.default.isUndefined(o)&&(o=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),o&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,o){var i=n||{},r=s[t];if(!r)throw new Error("Event type "+t+" not supported.");var l=document.createEvent(r);switch(r){case"MouseEvents":var u=i.x||i.clientX||0,d=i.y||i.clientY||0;l.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,u,d,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=l.initKeyboardEvent||l.initKeyEvent;a.default.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:l.initEvent(t,i.bubbles||!1,i.cancelable||!0)}a.default.defaults(l,o),e.dispatchEvent(l)},bind:function(e,t,n,o){var i=o||!1;return e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on"+t,n),d},unbind:function(e,t,n,o){var i=o||!1;return e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent&&e.detachEvent("on"+t,n),d},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);n.indexOf(t)===-1&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return d},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),o=n.indexOf(t);o!==-1&&(n.splice(o,1),e.className=n.join(" "))}else e.className=void 0;return d},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return i(t["border-left-width"])+i(t["border-right-width"])+i(t["padding-left"])+i(t["padding-right"])+i(t.width)},getHeight:function(e){var t=getComputedStyle(e);return i(t["border-top-width"])+i(t["border-bottom-width"])+i(t["padding-top"])+i(t["padding-bottom"])+i(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent;while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};t.default=d,e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var l=n(7),s=o(l),u=n(9),d=o(u),c=n(5),f=o(c),_=function(e){function t(n,o,a){i(this,t);var l=r(this,e.call(this,n,o)),s=a,u=l;if(l.__select=document.createElement("select"),f.default.isArray(s)){var c={};f.default.each(s,function(e){c[e]=e}),s=c}return f.default.each(s,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),u.__select.appendChild(n)}),l.updateDisplay(),d.default.bind(l.__select,"change",function(){var e=this.options[this.selectedIndex].value;u.setValue(e)}),l.domElement.appendChild(l.__select),l}return a(t,e),t.prototype.setValue=function(t){var n=e.prototype.setValue.call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n},t.prototype.updateDisplay=function(){return d.default.isActive(this.__select)?this:(this.__select.value=this.getValue(),e.prototype.updateDisplay.call(this))},t}(s.default);t.default=_,e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var l=n(7),s=o(l),u=n(9),d=o(u),c=function(e){function t(n,o){function a(){u.setValue(u.__input.value)}function l(){u.__onFinishChange&&u.__onFinishChange.call(u,u.getValue())}i(this,t);var s=r(this,e.call(this,n,o)),u=s;return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),d.default.bind(s.__input,"keyup",a),d.default.bind(s.__input,"change",a),d.default.bind(s.__input,"blur",l),d.default.bind(s.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return a(t,e),t.prototype.updateDisplay=function(){return d.default.isActive(this.__input)||(this.__input.value=this.getValue()),e.prototype.updateDisplay.call(this)},t}(s.default);t.default=c,e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}t.__esModule=!0;var s=n(7),u=o(s),d=n(5),c=o(d),f=function(e){function t(n,o,a){i(this,t);var s=r(this,e.call(this,n,o)),u=a||{};return s.__min=u.min,s.__max=u.max,s.__step=u.step,c.default.isUndefined(s.__step)?0===s.initialValue?s.__impliedStep=1:s.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(s.initialValue))/Math.LN10))/10:s.__impliedStep=s.__step,s.__precision=l(s.__impliedStep),s}return a(t,e),t.prototype.setValue=function(t){var n=t;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!==0&&(n=Math.round(n/this.__step)*this.__step),e.prototype.setValue.call(this,n)},t.prototype.min=function(e){return this.__min=e,this},t.prototype.max=function(e){return this.__max=e,this},t.prototype.step=function(e){return this.__step=e,this.__impliedStep=e,this.__precision=l(e),this},t}(u.default);t.default=f,e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}t.__esModule=!0;var s=n(12),u=o(s),d=n(9),c=o(d),f=n(5),_=o(f),p=function(e){function t(n,o,a){function l(){var e=parseFloat(m.__input.value);_.default.isNaN(e)||m.setValue(e)}function s(){m.__onFinishChange&&m.__onFinishChange.call(m,m.getValue())}function u(){s()}function d(e){var t=b-e.clientY;m.setValue(m.getValue()+t*m.__impliedStep),b=e.clientY}function f(){c.default.unbind(window,"mousemove",d),c.default.unbind(window,"mouseup",f),s()}function p(e){c.default.bind(window,"mousemove",d),c.default.bind(window,"mouseup",f),b=e.clientY}i(this,t);var h=r(this,e.call(this,n,o,a));h.__truncationSuspended=!1;var m=h,b=void 0;return h.__input=document.createElement("input"),h.__input.setAttribute("type","text"),c.default.bind(h.__input,"change",l),c.default.bind(h.__input,"blur",u),c.default.bind(h.__input,"mousedown",p),c.default.bind(h.__input,"keydown",function(e){13===e.keyCode&&(m.__truncationSuspended=!0,this.blur(),m.__truncationSuspended=!1,s())}),h.updateDisplay(),h.domElement.appendChild(h.__input),h}return a(t,e),t.prototype.updateDisplay=function(){return this.__input.value=this.__truncationSuspended?this.getValue():l(this.getValue(),this.__precision),e.prototype.updateDisplay.call(this)},t}(u.default);t.default=p,e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t,n,o,i){return o+(i-o)*((e-t)/(n-t))}t.__esModule=!0;var s=n(12),u=o(s),d=n(9),c=o(d),f=function(e){function t(n,o,a,s,u){function d(e){document.activeElement.blur(),c.default.bind(window,"mousemove",f),c.default.bind(window,"mouseup",_),f(e)}function f(e){e.preventDefault();var t=h.__background.getBoundingClientRect();return h.setValue(l(e.clientX,t.left,t.right,h.__min,h.__max)),!1}function _(){c.default.unbind(window,"mousemove",f),c.default.unbind(window,"mouseup",_),h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())}i(this,t);var p=r(this,e.call(this,n,o,{min:a,max:s,step:u})),h=p;return p.__background=document.createElement("div"),p.__foreground=document.createElement("div"),c.default.bind(p.__background,"mousedown",d),c.default.addClass(p.__background,"slider"),c.default.addClass(p.__foreground,"slider-fg"),p.updateDisplay(),p.__background.appendChild(p.__foreground),p.domElement.appendChild(p.__background),p}return a(t,e),t.prototype.updateDisplay=function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",e.prototype.updateDisplay.call(this)},t}(u.default);t.default=f,e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var l=n(7),s=o(l),u=n(9),d=o(u),c=function(e){function t(n,o,a){i(this,t);var l=r(this,e.call(this,n,o)),s=l;return l.__button=document.createElement("div"),l.__button.innerHTML=void 0===a?"Fire":a,d.default.bind(l.__button,"click",function(e){return e.preventDefault(),s.fire(),!1}),d.default.addClass(l.__button,"button"),l.domElement.appendChild(l.__button),l}return a(t,e),t.prototype.fire=function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())},t}(s.default);t.default=c,e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t,n,o){e.style.background="",g.default.each(y,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+o+" 100%); "})}function s(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}t.__esModule=!0;var u=n(7),d=o(u),c=n(9),f=o(c),_=n(2),p=o(_),h=n(3),m=o(h),b=n(5),g=o(b),v=function(e){function t(n,o){function a(e){h(e),f.default.bind(window,"mousemove",h),f.default.bind(window,"mouseup",u)}function u(){f.default.unbind(window,"mousemove",h),f.default.unbind(window,"mouseup",u),_()}function d(){var e=(0,m.default)(this.value);e!==!1?(y.__color.__state=e,y.setValue(y.__color.toOriginal())):this.value=y.__color.toString()}function c(){f.default.unbind(window,"mousemove",b),f.default.unbind(window,"mouseup",c),_()}function _(){y.__onFinishChange&&y.__onFinishChange.call(y,y.__color.toOriginal())}function h(e){e.preventDefault();var t=y.__saturation_field.getBoundingClientRect(),n=(e.clientX-t.left)/(t.right-t.left),o=1-(e.clientY-t.top)/(t.bottom-t.top);return o>1?o=1:o<0&&(o=0),n>1?n=1:n<0&&(n=0),y.__color.v=o,y.__color.s=n,y.setValue(y.__color.toOriginal()),!1}function b(e){e.preventDefault();var t=y.__hue_field.getBoundingClientRect(),n=1-(e.clientY-t.top)/(t.bottom-t.top);return n>1?n=1:n<0&&(n=0),y.__color.h=360*n,y.setValue(y.__color.toOriginal()),!1}i(this,t);var v=r(this,e.call(this,n,o));v.__color=new p.default(v.getValue()),v.__temp=new p.default(0);var y=v;v.domElement=document.createElement("div"),f.default.makeSelectable(v.domElement,!1),v.__selector=document.createElement("div"),v.__selector.className="selector",v.__saturation_field=document.createElement("div"),v.__saturation_field.className="saturation-field",v.__field_knob=document.createElement("div"),v.__field_knob.className="field-knob",v.__field_knob_border="2px solid ",v.__hue_knob=document.createElement("div"),v.__hue_knob.className="hue-knob",v.__hue_field=document.createElement("div"),v.__hue_field.className="hue-field",v.__input=document.createElement("input"),v.__input.type="text",v.__input_textShadow="0 1px 1px ",f.default.bind(v.__input,"keydown",function(e){13===e.keyCode&&d.call(this)}),f.default.bind(v.__input,"blur",d),f.default.bind(v.__selector,"mousedown",function(){f.default.addClass(this,"drag").bind(window,"mouseup",function(){f.default.removeClass(y.__selector,"drag")})});var w=document.createElement("div");return g.default.extend(v.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),g.default.extend(v.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:v.__field_knob_border+(v.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),g.default.extend(v.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),g.default.extend(v.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),g.default.extend(w.style,{width:"100%",height:"100%",background:"none"}),l(w,"top","rgba(0,0,0,0)","#000"),g.default.extend(v.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),s(v.__hue_field),g.default.extend(v.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:v.__input_textShadow+"rgba(0,0,0,0.7)"}),f.default.bind(v.__saturation_field,"mousedown",a),f.default.bind(v.__field_knob,"mousedown",a),f.default.bind(v.__hue_field,"mousedown",function(e){b(e),f.default.bind(window,"mousemove",b),f.default.bind(window,"mouseup",c)}),v.__saturation_field.appendChild(w),v.__selector.appendChild(v.__field_knob),v.__selector.appendChild(v.__saturation_field),v.__selector.appendChild(v.__hue_field),v.__hue_field.appendChild(v.__hue_knob),v.domElement.appendChild(v.__input),v.domElement.appendChild(v.__selector),v.updateDisplay(),v}return a(t,e),t.prototype.updateDisplay=function(){var e=(0,m.default)(this.getValue());if(e!==!1){var t=!1;g.default.each(p.default.COMPONENTS,function(n){if(!g.default.isUndefined(e[n])&&!g.default.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&g.default.extend(this.__color.__state,e)}g.default.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,o=255-n;g.default.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,l(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),g.default.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})},t}(d.default),y=["-moz-","-o-","-webkit-","-ms-",""];t.default=v,e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){var o=document.createElement("li");return t&&o.appendChild(t),n?e.__ul.insertBefore(o,n):e.__ul.appendChild(o),e.onResize(),o}function r(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];t?n.innerHTML=n.value+"*":n.innerHTML=n.value}function a(e,t,n){if(n.__li=t,n.__gui=e,U.default.extend(n,{options:function(t){if(arguments.length>1){var o=n.__li.nextElementSibling;return n.remove(),s(e,n.object,n.property,{before:o,factoryArgs:[U.default.toArray(arguments)]})}if(U.default.isArray(t)||U.default.isObject(t)){var i=n.__li.nextElementSibling;return n.remove(),s(e,n.object,n.property,{before:i,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof N.default){var o=new B.default(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});U.default.each(["updateDisplay","onChange","onFinishChange","step"],function(e){var t=n[e],i=o[e];n[e]=o[e]=function(){var e=Array.prototype.slice.call(arguments);return i.apply(o,e),t.apply(n,e)}}),z.default.addClass(t,"has-slider"),n.domElement.insertBefore(o.domElement,n.domElement.firstElementChild)}else if(n instanceof B.default){var i=function(t){if(U.default.isNumber(n.__min)&&U.default.isNumber(n.__max)){var o=n.__li.firstElementChild.firstElementChild.innerHTML,i=n.__gui.__listening.indexOf(n)>-1;n.remove();var r=s(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return r.name(o),i&&r.listen(),r}return t};n.min=U.default.compose(i,n.min),n.max=U.default.compose(i,n.max)}else n instanceof O.default?(z.default.bind(t,"click",function(){z.default.fakeEvent(n.__checkbox,"click")}),z.default.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof R.default?(z.default.bind(t,"click",function(){z.default.fakeEvent(n.__button,"click")}),z.default.bind(t,"mouseover",function(){z.default.addClass(n.__button,"hover")}),z.default.bind(t,"mouseout",function(){z.default.removeClass(n.__button,"hover")})):n instanceof j.default&&(z.default.addClass(t,"color"),n.updateDisplay=U.default.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=U.default.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&r(e.getRoot(),!0),t},n.setValue)}function l(e,t){var n=e.getRoot(),o=n.__rememberedObjects.indexOf(t.object);if(o!==-1){var i=n.__rememberedObjectIndecesToControllers[o];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[o]=i),i[t.property]=t,n.load&&n.load.remembered){var r=n.load.remembered,a=void 0;if(r[e.preset])a=r[e.preset];else{if(!r[Q])return;a=r[Q]}if(a[o]&&void 0!==a[o][t.property]){var l=a[o][t.property];t.initialValue=l,t.setValue(l)}}}}function s(e,t,n,o){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var r=void 0;if(o.color)r=new j.default(t,n);else{var s=[t,n].concat(o.factoryArgs);r=C.default.apply(e,s)}o.before instanceof S.default&&(o.before=o.before.__li),l(e,r),z.default.addClass(r.domElement,"c");var u=document.createElement("span");z.default.addClass(u,"property-name"),u.innerHTML=r.property;var d=document.createElement("div");d.appendChild(u),d.appendChild(r.domElement);var c=i(e,d,o.before);return z.default.addClass(c,oe.CLASS_CONTROLLER_ROW),r instanceof j.default?z.default.addClass(c,"color"):z.default.addClass(c,g(r.getValue())),a(e,c,r),e.__controllers.push(r),r}function u(e,t){return document.location.href+"."+t}function d(e,t,n){var o=document.createElement("option");o.innerHTML=t,o.value=t,e.__preset_select.appendChild(o),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function c(e,t){t.style.display=e.useLocalStorage?"block":"none"}function f(e){var t=e.__save_row=document.createElement("li");z.default.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),z.default.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",z.default.addClass(n,"button gears");var o=document.createElement("span");o.innerHTML="Save",z.default.addClass(o,"button"),z.default.addClass(o,"save");var i=document.createElement("span");i.innerHTML="New",z.default.addClass(i,"button"),z.default.addClass(i,"save-as");var r=document.createElement("span");r.innerHTML="Revert",z.default.addClass(r,"button"),z.default.addClass(r,"revert");var a=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?U.default.each(e.load.remembered,function(t,n){d(e,n,n===e.preset)}):d(e,Q,!1),z.default.bind(a,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(a),t.appendChild(n),t.appendChild(o),t.appendChild(i),t.appendChild(r),q){var l=document.getElementById("dg-local-explain"),s=document.getElementById("dg-local-storage"),f=document.getElementById("dg-save-locally");f.style.display="block","true"===localStorage.getItem(u(e,"isLocal"))&&s.setAttribute("checked","checked"),c(e,l),z.default.bind(s,"change",function(){e.useLocalStorage=!e.useLocalStorage,c(e,l)})}var _=document.getElementById("dg-new-constructor");z.default.bind(_,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||Z.hide()}),z.default.bind(n,"click",function(){_.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),Z.show(),_.focus(),_.select()}),z.default.bind(o,"click",function(){e.save()}),z.default.bind(i,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),z.default.bind(r,"click",function(){e.revert()})}function _(e){function t(t){return t.preventDefault(),e.width+=i-t.clientX,e.onResize(),i=t.clientX,!1}function n(){z.default.removeClass(e.__closeButton,oe.CLASS_DRAG),z.default.unbind(window,"mousemove",t),z.default.unbind(window,"mouseup",n)}function o(o){return o.preventDefault(),i=o.clientX,z.default.addClass(e.__closeButton,oe.CLASS_DRAG),z.default.bind(window,"mousemove",t),z.default.bind(window,"mouseup",n),!1}var i=void 0;e.__resize_handle=document.createElement("div"),U.default.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),z.default.bind(e.__resize_handle,"mousedown",o),z.default.bind(e.__closeButton,"mousedown",o),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function p(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function h(e,t){var n={};return U.default.each(e.__rememberedObjects,function(o,i){var r={},a=e.__rememberedObjectIndecesToControllers[i];U.default.each(a,function(e,n){r[n]=t?e.initialValue:e.getValue()}),n[i]=r}),n}function m(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}function b(e){0!==e.length&&D.default.call(window,function(){b(e)}),U.default.each(e,function(e){e.updateDisplay()})}t.__esModule=!0;var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v=n(18),y=o(v),w=n(19),x=o(w),E=n(20),C=o(E),A=n(7),S=o(A),k=n(8),O=o(k),T=n(15),R=o(T),L=n(13),B=o(L),M=n(14),N=o(M),H=n(16),j=o(H),P=n(21),D=o(P),V=n(22),F=o(V),I=n(9),z=o(I),G=n(5),U=o(G),X=n(23),K=o(X);y.default.inject(K.default);var Y="dg",J=72,W=20,Q="Default",q=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}(),Z=void 0,$=!0,ee=void 0,te=!1,ne=[],oe=function e(t){function n(){var e=o.getRoot();e.width+=1,U.default.defer(function(){e.width-=1})}var o=this,r=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),z.default.addClass(this.domElement,Y),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=U.default.defaults(r,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),r=U.default.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),U.default.isUndefined(r.load)?r.load={preset:Q}:r.preset&&(r.load.preset=r.preset),U.default.isUndefined(r.parent)&&r.hideable&&ne.push(this),r.resizable=U.default.isUndefined(r.parent)&&r.resizable,r.autoPlace&&U.default.isUndefined(r.scrollable)&&(r.scrollable=!0);var a=q&&"true"===localStorage.getItem(u(this,"isLocal")),l=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return o.parent?o.getRoot().preset:r.load.preset},set:function(e){o.parent?o.getRoot().preset=e:r.load.preset=e,m(this),o.revert()}},width:{get:function(){return r.width},set:function(e){r.width=e,p(o,e)}},name:{get:function(){return r.name},set:function(e){r.name=e,titleRowName&&(titleRowName.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(t){r.closed=t,r.closed?z.default.addClass(o.__ul,e.CLASS_CLOSED):z.default.removeClass(o.__ul,e.CLASS_CLOSED),this.onResize(),o.__closeButton&&(o.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return a},set:function(e){q&&(a=e,e?z.default.bind(window,"unload",l):z.default.unbind(window,"unload",l),localStorage.setItem(u(o,"isLocal"),e))}}}),U.default.isUndefined(r.parent)){if(r.closed=!1,z.default.addClass(this.domElement,e.CLASS_MAIN),z.default.makeSelectable(this.domElement,!1),q&&a){o.useLocalStorage=!0;var s=localStorage.getItem(u(this,"gui"));s&&(r.load=JSON.parse(s))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,z.default.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),r.closeOnTop?(z.default.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(z.default.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),z.default.bind(this.__closeButton,"click",function(){o.closed=!o.closed})}else{void 0===r.closed&&(r.closed=!0);var d=document.createTextNode(r.name);z.default.addClass(d,"controller-name");var c=i(o,d),f=function(e){return e.preventDefault(),o.closed=!o.closed,!1};z.default.addClass(this.__ul,e.CLASS_CLOSED),z.default.addClass(c,"title"),z.default.bind(c,"click",f),r.closed||(this.closed=!1)}r.autoPlace&&(U.default.isUndefined(r.parent)&&($&&(ee=document.createElement("div"),z.default.addClass(ee,Y),z.default.addClass(ee,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(ee),$=!1),ee.appendChild(this.domElement),z.default.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||p(o,r.width)),this.__resizeHandler=function(){o.onResizeDebounced()},z.default.bind(window,"resize",this.__resizeHandler),z.default.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),z.default.bind(this.__ul,"transitionend",this.__resizeHandler),z.default.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&_(this),l=function(){q&&"true"===localStorage.getItem(u(o,"isLocal"))&&localStorage.setItem(u(o,"gui"),JSON.stringify(o.getSaveObject()))},this.saveToLocalStorageIfPossible=l,r.parent||n()};oe.toggleHide=function(){te=!te,U.default.each(ne,function(e){e.domElement.style.display=te?"none":""})},oe.CLASS_AUTO_PLACE="a",oe.CLASS_AUTO_PLACE_CONTAINER="ac",oe.CLASS_MAIN="main",oe.CLASS_CONTROLLER_ROW="cr",oe.CLASS_TOO_TALL="taller-than-window",oe.CLASS_CLOSED="closed",oe.CLASS_CLOSE_BUTTON="close-button",oe.CLASS_CLOSE_TOP="close-top",oe.CLASS_CLOSE_BOTTOM="close-bottom",oe.CLASS_DRAG="drag",oe.DEFAULT_WIDTH=245,oe.TEXT_CLOSED="Close Controls",oe.TEXT_OPEN="Open Controls",oe._keydownHandler=function(e){"text"===document.activeElement.type||e.which!==J&&e.keyCode!==J||oe.toggleHide()},z.default.bind(window,"keydown",oe._keydownHandler,!1),U.default.extend(oe.prototype,{add:function(e,t){return s(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return s(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;U.default.defer(function(){t.onResize()})},destroy:function(){this.autoPlace&&ee.removeChild(this.domElement),z.default.unbind(window,"keydown",oe._keydownHandler,!1),z.default.unbind(window,"resize",this.__resizeHandler),this.saveToLocalStorageIfPossible&&z.default.unbind(window,"unload",this.saveToLocalStorageIfPossible)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new oe(t);this.__folders[e]=n;var o=i(this,n.domElement);return z.default.addClass(o,"folder"),n},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=z.default.getOffset(e.__ul).top,n=0;U.default.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=z.default.getHeight(t))}),window.innerHeight-t-W<n?(z.default.addClass(e.domElement,oe.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-W+"px"):(z.default.removeClass(e.domElement,oe.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&U.default.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:U.default.debounce(function(){this.onResize()},50),remember:function(){if(U.default.isUndefined(Z)&&(Z=new F.default,Z.domElement.innerHTML=x.default),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;U.default.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&f(e),e.__rememberedObjects.indexOf(t)===-1&&e.__rememberedObjects.push(t)}),this.autoPlace&&p(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=h(this)),e.folders={},U.default.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=h(this),r(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[Q]=h(this,!0)),this.load.remembered[e]=h(this),this.preset=e,d(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){U.default.each(this.__controllers,function(t){this.getRoot().load.remembered?l(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),U.default.each(this.__folders,function(e){e.revert(e)}),e||r(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&b(this.__listening)},updateDisplay:function(){U.default.each(this.__controllers,function(e){e.updateDisplay()}),U.default.each(this.__folders,function(e){e.updateDisplay()})}}),t.default=oe,e.exports=t.default},function(e,t){"use strict";e.exports={load:function(e,t){var n=t||document,o=n.createElement("link");o.type="text/css",o.rel="stylesheet",o.href=e,n.getElementsByTagName("head")[0].appendChild(o)},inject:function(e,t){var n=t||document,o=document.createElement("style");o.type="text/css",o.innerHTML=e;var i=n.getElementsByTagName("head")[0];try{i.appendChild(o)}catch(e){}}}},function(e,t){e.exports="<div id=dg-save class=\"dg dialogue\"> Here's the new load parameter for your <code>GUI</code>'s constructor: <textarea id=dg-new-constructor></textarea> <div id=dg-save-locally> <input id=dg-local-storage type=checkbox /> Automatically save values to <code>localStorage</code> on exit. <div id=dg-local-explain>The values saved to <code>localStorage</code> will override those passed to <code>dat.GUI</code>'s constructor. This makes it easier to work incrementally, but <code>localStorage</code> is fragile, and your friends may not see the same values you do. </div> </div> </div>"},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(10),r=o(i),a=n(13),l=o(a),s=n(14),u=o(s),d=n(11),c=o(d),f=n(15),_=o(f),p=n(8),h=o(p),m=n(5),b=o(m),g=function(e,t){var n=e[t];return b.default.isArray(arguments[2])||b.default.isObject(arguments[2])?new r.default(e,t,arguments[2]):b.default.isNumber(n)?b.default.isNumber(arguments[2])&&b.default.isNumber(arguments[3])?b.default.isNumber(arguments[4])?new u.default(e,t,arguments[2],arguments[3],arguments[4]):new u.default(e,t,arguments[2],arguments[3]):b.default.isNumber(arguments[4])?new l.default(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new l.default(e,t,{min:arguments[2],max:arguments[3]}):b.default.isString(n)?new c.default(e,t):b.default.isFunction(n)?new _.default(e,t,""):b.default.isBoolean(n)?new h.default(e,t):null};t.default=g,e.exports=t.default},function(e,t){"use strict";function n(e){setTimeout(e,1e3/60)}t.__esModule=!0,t.default=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||n,e.exports=t.default},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var r=n(9),a=o(r),l=n(5),s=o(l),u=function(){function e(){i(this,e),this.backgroundElement=document.createElement("div"),s.default.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),a.default.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),s.default.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;a.default.bind(this.backgroundElement,"click",function(){t.hide()})}return e.prototype.show=function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),s.default.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})},e.prototype.hide=function e(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",a.default.unbind(t.domElement,"webkitTransitionEnd",e),a.default.unbind(t.domElement,"transitionend",e),a.default.unbind(t.domElement,"oTransitionEnd",e)};a.default.bind(this.domElement,"webkitTransitionEnd",e),a.default.bind(this.domElement,"transitionend",e),a.default.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},e.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-a.default.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-a.default.getHeight(this.domElement)/2+"px"},e}();t.default=u,e.exports=t.default},function(e,t,n){t=e.exports=n(24)(),t.push([e.id,".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1!important}.dg.main .close-button.drag,.dg.main:hover .close-button{opacity:1}.dg.main .close-button{transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{transition:height .1s ease-out;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid transparent}.dg li.title{margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.boolean,.dg .cr.boolean *,.dg .cr.function,.dg .cr.function *,.dg .cr.function .property-name{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco,monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px Lucida Grande,sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid hsla(0,0%,100%,.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.boolean:hover,.dg .cr.function:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}",""])},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var n=this[t];n[2]?e.push("@media "+n[2]+"{"+n[1]+"}"):e.push(n[1])}return e.join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var o={},i=0;i<this.length;i++){var r=this[i][0];"number"==typeof r&&(o[r]=!0)}for(i=0;i<t.length;i++){var a=t[i];"number"==typeof a[0]&&o[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),e.push(a))}},e}}])});;

/* /stock_3dview/static/src/js/libs/OrbitControls.js defined in bundle 'web.assets_backend' */
THREE.OrbitControls=function(object,domElement){this.object=object;this.domElement=(domElement!==undefined)?domElement:document;this.enabled=true;this.target=new THREE.Vector3();this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=false;this.dampingFactor=0.25;this.enableZoom=true;this.zoomSpeed=1.0;this.enableRotate=true;this.rotateSpeed=1.0;this.enablePan=true;this.keyPanSpeed=7.0;this.autoRotate=false;this.autoRotateSpeed=2.0;this.enableKeys=true;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;this.arrowKeys='camera';this.getPolarAngle=function(){return spherical.phi;};this.getAzimuthalAngle=function(){return spherical.theta;};this.saveState=function(){scope.target0.copy(scope.target);scope.position0.copy(scope.object.position);scope.zoom0=scope.object.zoom;};this.reset=function(){scope.target.copy(scope.target0);scope.object.position.copy(scope.position0);scope.object.zoom=scope.zoom0;scope.object.updateProjectionMatrix();scope.dispatchEvent(changeEvent);scope.update();state=STATE.NONE;};this.update=function(){var offset=new THREE.Vector3();var quat=new THREE.Quaternion().setFromUnitVectors(object.up,new THREE.Vector3(0,1,0));var quatInverse=quat.clone().inverse();var lastPosition=new THREE.Vector3();var lastQuaternion=new THREE.Quaternion();return function update(){var position=scope.object.position;offset.copy(position).sub(scope.target);offset.applyQuaternion(quat);spherical.setFromVector3(offset);if(scope.autoRotate&&state===STATE.NONE){rotateLeft(getAutoRotationAngle());}
spherical.theta+=sphericalDelta.theta;spherical.phi+=sphericalDelta.phi;spherical.theta=Math.max(scope.minAzimuthAngle,Math.min(scope.maxAzimuthAngle,spherical.theta));spherical.phi=Math.max(scope.minPolarAngle,Math.min(scope.maxPolarAngle,spherical.phi));spherical.makeSafe();spherical.radius*=scale;spherical.radius=Math.max(scope.minDistance,Math.min(scope.maxDistance,spherical.radius));scope.target.add(panOffset);offset.setFromSpherical(spherical);offset.applyQuaternion(quatInverse);position.copy(scope.target).add(offset);scope.object.lookAt(scope.target);if(scope.enableDamping===true){sphericalDelta.theta*=(1-scope.dampingFactor);sphericalDelta.phi*=(1-scope.dampingFactor);}else{sphericalDelta.set(0,0,0);}
scale=1;panOffset.set(0,0,0);if(zoomChanged||lastPosition.distanceToSquared(scope.object.position)>EPS||8*(1-lastQuaternion.dot(scope.object.quaternion))>EPS){scope.dispatchEvent(changeEvent);lastPosition.copy(scope.object.position);lastQuaternion.copy(scope.object.quaternion);zoomChanged=false;return true;}
return false;};}();this.dispose=function(){scope.domElement.removeEventListener('contextmenu',onContextMenu,false);scope.domElement.removeEventListener('mousedown',onMouseDown,false);scope.domElement.removeEventListener('wheel',onMouseWheel,false);scope.domElement.removeEventListener('touchstart',onTouchStart,false);scope.domElement.removeEventListener('touchend',onTouchEnd,false);scope.domElement.removeEventListener('touchmove',onTouchMove,false);document.removeEventListener('mousemove',onMouseMove,false);document.removeEventListener('mouseup',onMouseUp,false);window.removeEventListener('keydown',onKeyDown,false);};var scope=this;var changeEvent={type:'change'};var startEvent={type:'start'};var endEvent={type:'end'};var STATE={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};var state=STATE.NONE;var EPS=0.000001;var spherical=new THREE.Spherical();var sphericalDelta=new THREE.Spherical();var scale=1;var panOffset=new THREE.Vector3();var zoomChanged=false;var rotateStart=new THREE.Vector2();var rotateEnd=new THREE.Vector2();var rotateDelta=new THREE.Vector2();var panStart=new THREE.Vector2();var panEnd=new THREE.Vector2();var panDelta=new THREE.Vector2();var dollyStart=new THREE.Vector2();var dollyEnd=new THREE.Vector2();var dollyDelta=new THREE.Vector2();function getAutoRotationAngle(){return 2*Math.PI/60/60*scope.autoRotateSpeed;}
function getZoomScale(){return Math.pow(0.95,scope.zoomSpeed);}
function rotateLeft(angle){sphericalDelta.theta-=angle;}
function rotateUp(angle){sphericalDelta.phi-=angle;}
var panLeft=function(){var v=new THREE.Vector3();return function panLeft(distance,objectMatrix){v.setFromMatrixColumn(objectMatrix,0);v.multiplyScalar(-distance);panOffset.add(v);};}();var panUp=function(){var v=new THREE.Vector3();return function panUp(distance,objectMatrix){v.setFromMatrixColumn(objectMatrix,1);v.multiplyScalar(distance);panOffset.add(v);};}();var pan=function(){var offset=new THREE.Vector3();return function pan(deltaX,deltaY){var element=scope.domElement===document?scope.domElement.body:scope.domElement;if(scope.object instanceof THREE.PerspectiveCamera){var position=scope.object.position;offset.copy(position).sub(scope.target);var targetDistance=offset.length();targetDistance*=Math.tan((scope.object.fov/2)*Math.PI/180.0);panLeft(2*deltaX*targetDistance/element.clientHeight,scope.object.matrix);panUp(2*deltaY*targetDistance/element.clientHeight,scope.object.matrix);}else if(scope.object instanceof THREE.OrthographicCamera){panLeft(deltaX*(scope.object.right-scope.object.left)/scope.object.zoom/element.clientWidth,scope.object.matrix);panUp(deltaY*(scope.object.top-scope.object.bottom)/scope.object.zoom/element.clientHeight,scope.object.matrix);}else{console.warn('WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.');scope.enablePan=false;}};}();function dollyIn(dollyScale){if(scope.object instanceof THREE.PerspectiveCamera){scale/=dollyScale;}else if(scope.object instanceof THREE.OrthographicCamera){scope.object.zoom=Math.max(scope.minZoom,Math.min(scope.maxZoom,scope.object.zoom*dollyScale));scope.object.updateProjectionMatrix();zoomChanged=true;}else{console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');scope.enableZoom=false;}}
function dollyOut(dollyScale){if(scope.object instanceof THREE.PerspectiveCamera){scale*=dollyScale;}else if(scope.object instanceof THREE.OrthographicCamera){scope.object.zoom=Math.max(scope.minZoom,Math.min(scope.maxZoom,scope.object.zoom/dollyScale));scope.object.updateProjectionMatrix();zoomChanged=true;}else{console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');scope.enableZoom=false;}}
function handleMouseDownRotate(event){rotateStart.set(event.clientX,event.clientY);}
function handleMouseDownDolly(event){dollyStart.set(event.clientX,event.clientY);}
function handleMouseDownPan(event){panStart.set(event.clientX,event.clientY);}
function handleMouseMoveRotate(event){rotateEnd.set(event.clientX,event.clientY);rotateDelta.subVectors(rotateEnd,rotateStart);var element=scope.domElement===document?scope.domElement.body:scope.domElement;rotateLeft(2*Math.PI*rotateDelta.x/element.clientWidth*scope.rotateSpeed);rotateUp(2*Math.PI*rotateDelta.y/element.clientHeight*scope.rotateSpeed);rotateStart.copy(rotateEnd);scope.update();}
function handleMouseMoveDolly(event){dollyEnd.set(event.clientX,event.clientY);dollyDelta.subVectors(dollyEnd,dollyStart);if(dollyDelta.y>0){dollyIn(getZoomScale());}else if(dollyDelta.y<0){dollyOut(getZoomScale());}
dollyStart.copy(dollyEnd);scope.update();}
function handleMouseMovePan(event){panEnd.set(event.clientX,event.clientY);panDelta.subVectors(panEnd,panStart);pan(panDelta.x,panDelta.y);panStart.copy(panEnd);scope.update();}
function handleMouseUp(event){}
function handleMouseWheel(event){if(event.deltaY<0){dollyOut(getZoomScale());}else if(event.deltaY>0){dollyIn(getZoomScale());}
scope.update();}
function handleKeyDown(event){var intKeyCode=event.keyCode;var intAltKey=event.altKey;var intCtrlKey=event.ctrlKey;var intShiftKey=event.shiftKey;var angle=getAutoRotationAngle();if(scope.arrowKeys=='camera'){switch(event.keyCode){case scope.keys.UP:if(intCtrlKey){dollyOut(getZoomScale());}
else{pan(0,scope.keyPanSpeed);}
break;case scope.keys.BOTTOM:if(intCtrlKey){dollyIn(getZoomScale());}
else{pan(0,-scope.keyPanSpeed);}
break;case scope.keys.LEFT:if(intCtrlKey){rotateLeft(angle);}else{pan(scope.keyPanSpeed,0);}
break;case scope.keys.RIGHT:if(intCtrlKey){rotateLeft(-angle);}else{pan(-scope.keyPanSpeed,0);}
break;}}else{var target=scope.object.userData.scene.getObjectByName("target");switch(event.keyCode){case scope.keys.UP:if(intCtrlKey){target.position.y+=1;}else{target.position.z+=1;}
scope.target.copy(target.position);break;case scope.keys.BOTTOM:if(intCtrlKey){target.position.y-=1;}else{target.position.z-=1;}
scope.target.copy(target.position);break;case scope.keys.LEFT:target.position.x+=1;scope.target.copy(target.position);break;case scope.keys.RIGHT:target.position.x-=1;scope.target.copy(target.position);break;}}
scope.update();}
function handleTouchStartRotate(event){rotateStart.set(event.touches[0].pageX,event.touches[0].pageY);}
function handleTouchStartDolly(event){var dx=event.touches[0].pageX-event.touches[1].pageX;var dy=event.touches[0].pageY-event.touches[1].pageY;var distance=Math.sqrt(dx*dx+dy*dy);dollyStart.set(0,distance);}
function handleTouchStartPan(event){panStart.set(event.touches[0].pageX,event.touches[0].pageY);}
function handleTouchMoveRotate(event){rotateEnd.set(event.touches[0].pageX,event.touches[0].pageY);rotateDelta.subVectors(rotateEnd,rotateStart);var element=scope.domElement===document?scope.domElement.body:scope.domElement;rotateLeft(2*Math.PI*rotateDelta.x/element.clientWidth*scope.rotateSpeed);rotateUp(2*Math.PI*rotateDelta.y/element.clientHeight*scope.rotateSpeed);rotateStart.copy(rotateEnd);scope.update();}
function handleTouchMoveDolly(event){var dx=event.touches[0].pageX-event.touches[1].pageX;var dy=event.touches[0].pageY-event.touches[1].pageY;var distance=Math.sqrt(dx*dx+dy*dy);dollyEnd.set(0,distance);dollyDelta.subVectors(dollyEnd,dollyStart);if(dollyDelta.y>0){dollyOut(getZoomScale());}else if(dollyDelta.y<0){dollyIn(getZoomScale());}
dollyStart.copy(dollyEnd);scope.update();}
function handleTouchMovePan(event){panEnd.set(event.touches[0].pageX,event.touches[0].pageY);panDelta.subVectors(panEnd,panStart);pan(panDelta.x,panDelta.y);panStart.copy(panEnd);scope.update();}
function handleTouchEnd(event){}
function onMouseDown(event){if(scope.enabled===false)return;event.preventDefault();switch(event.button){case scope.mouseButtons.ORBIT:if(scope.enableRotate===false)return;handleMouseDownRotate(event);state=STATE.ROTATE;break;case scope.mouseButtons.ZOOM:if(scope.enableZoom===false)return;handleMouseDownDolly(event);state=STATE.DOLLY;break;case scope.mouseButtons.PAN:if(scope.enablePan===false)return;handleMouseDownPan(event);state=STATE.PAN;break;}
if(state!==STATE.NONE){document.addEventListener('mousemove',onMouseMove,false);document.addEventListener('mouseup',onMouseUp,false);scope.dispatchEvent(startEvent);}}
function onMouseMove(event){if(scope.enabled===false)return;event.preventDefault();switch(state){case STATE.ROTATE:if(scope.enableRotate===false)return;handleMouseMoveRotate(event);break;case STATE.DOLLY:if(scope.enableZoom===false)return;handleMouseMoveDolly(event);break;case STATE.PAN:if(scope.enablePan===false)return;handleMouseMovePan(event);break;}}
function onMouseUp(event){if(scope.enabled===false)return;handleMouseUp(event);document.removeEventListener('mousemove',onMouseMove,false);document.removeEventListener('mouseup',onMouseUp,false);scope.dispatchEvent(endEvent);state=STATE.NONE;}
function onMouseWheel(event){if(scope.enabled===false||scope.enableZoom===false||(state!==STATE.NONE&&state!==STATE.ROTATE))return;event.preventDefault();event.stopPropagation();handleMouseWheel(event);scope.dispatchEvent(startEvent);scope.dispatchEvent(endEvent);}
function onKeyDown(event){if(scope.enabled===false||scope.enableKeys===false||scope.enablePan===false)return;handleKeyDown(event);}
function onTouchStart(event){if(scope.enabled===false)return;switch(event.touches.length){case 1:if(scope.enableRotate===false)return;handleTouchStartRotate(event);state=STATE.TOUCH_ROTATE;break;case 2:if(scope.enableZoom===false)return;handleTouchStartDolly(event);state=STATE.TOUCH_DOLLY;break;case 3:if(scope.enablePan===false)return;handleTouchStartPan(event);state=STATE.TOUCH_PAN;break;default:state=STATE.NONE;}
if(state!==STATE.NONE){scope.dispatchEvent(startEvent);}}
function onTouchMove(event){if(scope.enabled===false)return;event.preventDefault();event.stopPropagation();switch(event.touches.length){case 1:if(scope.enableRotate===false)return;if(state!==STATE.TOUCH_ROTATE)return;handleTouchMoveRotate(event);break;case 2:if(scope.enableZoom===false)return;if(state!==STATE.TOUCH_DOLLY)return;handleTouchMoveDolly(event);break;case 3:if(scope.enablePan===false)return;if(state!==STATE.TOUCH_PAN)return;handleTouchMovePan(event);break;default:state=STATE.NONE;}}
function onTouchEnd(event){if(scope.enabled===false)return;handleTouchEnd(event);scope.dispatchEvent(endEvent);state=STATE.NONE;}
function onContextMenu(event){if(scope.enabled===false)return;event.preventDefault();}
scope.domElement.addEventListener('contextmenu',onContextMenu,false);scope.domElement.addEventListener('mousedown',onMouseDown,false);scope.domElement.addEventListener('wheel',onMouseWheel,false);scope.domElement.addEventListener('touchstart',onTouchStart,false);scope.domElement.addEventListener('touchend',onTouchEnd,false);scope.domElement.addEventListener('touchmove',onTouchMove,false);window.addEventListener('keydown',onKeyDown,false);this.update();};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.OrbitControls.prototype.constructor=THREE.OrbitControls;Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){console.warn('THREE.OrbitControls: .center has been renamed to .target');return this.target;}},noZoom:{get:function(){console.warn('THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.');return!this.enableZoom;},set:function(value){console.warn('THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.');this.enableZoom=!value;}},noRotate:{get:function(){console.warn('THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.');return!this.enableRotate;},set:function(value){console.warn('THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.');this.enableRotate=!value;}},noPan:{get:function(){console.warn('THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.');return!this.enablePan;},set:function(value){console.warn('THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.');this.enablePan=!value;}},noKeys:{get:function(){console.warn('THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.');return!this.enableKeys;},set:function(value){console.warn('THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.');this.enableKeys=!value;}},staticMoving:{get:function(){console.warn('THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.');return!this.enableDamping;},set:function(value){console.warn('THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.');this.enableDamping=!value;}},dynamicDampingFactor:{get:function(){console.warn('THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.');return this.dampingFactor;},set:function(value){console.warn('THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.');this.dampingFactor=value;}}});;

/* /stock_3dview/static/src/js/libs/Detector.js defined in bundle 'web.assets_backend' */
var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:(function(){try{var canvas=document.createElement('canvas');return!!(window.WebGLRenderingContext&&(canvas.getContext('webgl')||canvas.getContext('experimental-webgl')));}catch(e){return false;}})(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var element=document.createElement('div');element.id='webgl-error-message';element.style.fontFamily='monospace';element.style.fontSize='13px';element.style.fontWeight='normal';element.style.textAlign='center';element.style.background='#fff';element.style.color='#000';element.style.padding='1.5em';element.style.width='400px';element.style.margin='5em auto 0';if(!this.webgl){element.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join('\n'):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join('\n');}
return element;},addGetWebGLMessage:function(parameters){var parent,id,element;parameters=parameters||{};parent=parameters.parent!==undefined?parameters.parent:document.body;id=parameters.id!==undefined?parameters.id:'oldie';element=Detector.getWebGLErrorMessage();element.id=id;parent.appendChild(element);}};if(typeof module==='object'){module.exports=Detector;};

/* /stock_3dview/static/src/js/renderer.js defined in bundle 'web.assets_backend' */
odoo.define('stock_3dview.3DViewRenderer',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var AbstractRenderer=require('web.AbstractRenderer');var data_manager=require('web.data_manager');var session=require('web.session');var view_registry=require('web.view_registry');var _lt=core._lt;var QWeb=core.qweb;var container;var scope;var ThreeDViewRenderer=AbstractRenderer.extend({template:"3DView",init:function(parent,state,params){scope=this;scope.warehouseObjects={wireframes:[],meshes:[]};scope.currentWarehouse=null;this._super.apply(this,arguments);this.context={};},_render:function(){console.log("_render()");var waiting=setInterval(function(){console.log("waiting...");if(scope.state.data.allLocationsLoaded&&scope.state.data.selectedLocationsLoaded&&scope.state.data.warehousesLoaded&&scope.state.data.legendLoaded){console.log(scope.state.data.selectedLocations.length);console.log(scope.state.data.allLocations.length);console.log(scope.state.data.warehouses);console.log(scope.state.data.legendItems);if(!scope.renderer){scope.currentWarehouse=scope.state.data.warehouses[Object.keys(scope.state.data.warehouses)[0]];if(scope.currentWarehouse){console.log(scope.currentWarehouse);scope._initRefSys(scope.currentWarehouse);scope.init3d();scope._addEventHandlers();scope.showWireframesForAllLocations();}
else{scope._showInformationDialog("No warehouses have been loaded. Please check whether the warehouses have a planimetry image and the dimensions correctly set.");}}
scope.currentWarehouse&&scope.showMeshesForSelectedLocations();$("#loading_icon").hide();clearInterval(waiting);}},20);return $.when();},init3d:function(){console.log("initializing 3d...");scope.camera=new THREE.PerspectiveCamera(scope.refSys.camFov,window.innerWidth/window.innerHeight,1,3000);scope.camera.position.fromArray(scope._realTo3dvSizes(scope.refSys.camPosX_real,-scope.refSys.camPosY_real,scope.refSys.camPosZ_real));scope.controls=new THREE.OrbitControls(scope.camera,document.getElementById('threedview_container'));scope.controls.rotateSpeed=1.0;scope.controls.zoomSpeed=1.2;scope.controls.panSpeed=0.8;scope.controls.enableZoom=true;scope.controls.enablePan=true;scope.controls.enableDamping=true;scope.controls.dampingFactor=0.3;scope.controls.addEventListener('change',scope.render);scope.controls.render=scope.render;scope.raycaster=new THREE.Raycaster();scope.mouse=new THREE.Vector2();scope.scene=new THREE.Scene();var grid=new THREE.GridHelper(2000,50);grid.position.x=scope.refSys.groundX_3dv/2;grid.position.y=-1;grid.position.z=-scope.refSys.groundZ_3dv/2;scope.scene.add(grid);scope.target=new THREE.Mesh(new THREE.BoxGeometry(4,4,4),new THREE.MeshPhongMaterial({color:new THREE.Color("red"),opacity:1,transparent:true}));scope.target.position.fromArray(scope._realTo3dvSizes(scope.refSys.targetX_real,-scope.refSys.targetY_real,scope.refSys.targetZ_real));scope.target.name="target";scope.target.visible=false;scope.scene.add(scope.target);scope.camera.updateProjectionMatrix();scope.createGround();scope.scene.add(new THREE.AmbientLight(0xFFFFFF));scope.renderer=new THREE.WebGLRenderer({antialias:true});scope.renderer.setClearColor(0xDFDFDF);scope.renderer.setPixelRatio(window.devicePixelRatio);scope._setRendererSize();container=document.getElementById('threedview_container');container.appendChild(scope.renderer.domElement);scope.camera.lookAt(scope.target);scope.camera.userData.scene=scope.scene;scope.controls.target.copy(scope.target.position);scope.controls.update();scope.activateWarehouseChoice();setTimeout(scope.render,0);},showLegend:function(legend){$("#legend_data").empty();if(scope.state.data.legendItems.length>0){$('#legend_data').append($('<ul/>').attr('id','legend_ul'));var items=[];$(scope.state.data.legendItems).each(function(index,info){$('#legend_ul').append($('<li/>').append($('<span/>').addClass('colorbox').css('background-color',info.color).html("&nbsp;")).append($('<span/>').text(info.name)));});}},createGround:function(){scope.removeObject("ground");scope.removeObject("underground");var groundImage=document.createElement('img');var texture=new THREE.Texture(groundImage);groundImage.onload=function(){texture.needsUpdate=true;};groundImage.src="data:image/png;base64,"+scope.currentWarehouse.ground.planimetry_image;texture.wrapS=THREE.ClampToEdgeWrapping;texture.wrapT=THREE.ClampToEdgeWrapping;var groundGeometry=new THREE.BoxBufferGeometry(scope.refSys.groundX_3dv,2,scope.refSys.groundZ_3dv);var groundMaterial=new THREE.MeshStandardMaterial({map:texture,flatShading:true});var ground=new THREE.Mesh(groundGeometry,groundMaterial);ground.position.fromArray(scope._realTo3dvCoords(0,0,0,scope.refSys.groundX_real,scope.refSys.groundY_real,0)).y=-1;var underground=new THREE.Mesh(new THREE.BoxGeometry(scope.refSys.groundX_3dv,2,scope.refSys.groundZ_3dv),new THREE.MeshPhongMaterial({color:new THREE.Color("gray"),opacity:1,transparent:false}));underground.position.fromArray(scope._realTo3dvCoords(0,0,0,scope.refSys.groundX_real,scope.refSys.groundY_real,0)).y=-3;ground.name="ground";underground.name="underground";scope.scene.add(ground);scope.scene.add(underground);},activateWarehouseChoice:function(){var warehouse_ids=Object.keys(scope.state.data.warehouses);if(warehouse_ids.length>1){warehouse_ids.forEach(function(id){console.log(id);console.log(scope.state.data.warehouses[id].name);$("#warehouse_id").append($('<option>',{value:id,text:scope.state.data.warehouses[id].name,id:'wh'+id}));});$("#warehouses").show().bind('blur change click dblclick error focus focusin focusout hover keydown keypress keyup load mousedown mouseenter mouseleave mousemove mouseout mouseover mouseup resize scroll select submit',function(event){event.stopPropagation();});$("#warehouse_id").change(function(event){scope.changeWarehouse($("#warehouse_id").val());});}},changeWarehouse:function(warehouse_id){scope.currentWarehouse=scope.state.data.warehouses[warehouse_id];scope._initRefSys(scope.currentWarehouse);['wireframes','meshes'].forEach(function(item){scope.warehouseObjects[item].forEach(function(obj){obj.visible=obj.userData.warehouse==scope.currentWarehouse.id;});});scope.createGround();setTimeout(scope.render,0);},removeObject:function(name){var object=scope.scene.getObjectByName(name);if(object){scope.scene.remove(object);if(object.geometry)object.geometry.dispose();if(object.material)object.material.dispose();}},addMesh:function(location){scope.addObject(location,'mesh');},addWireframe:function(location){scope.addObject(location,'wireframe');},addObject:function(location,type){var size=scope._realTo3dvSizes(location.sizex,location.sizey,location.sizez);var geometry=new THREE.BoxBufferGeometry(size[0],size[1],size[2]);switch(type){case'mesh':var material=new THREE.MeshStandardMaterial({color:new THREE.Color(location.color),flatShading:true,opacity:parseInt(location.opacity,10)/1000,transparent:true});var obj=new THREE.Mesh(geometry,material);var key='meshes';break;case'wireframe':var edges=new THREE.EdgesGeometry(geometry);var material=new THREE.LineBasicMaterial({color:0x4D4D4D,linewidth:1});var obj=new THREE.LineSegments(edges,material);var key='wireframes';break;}
obj.position.fromArray(scope._realTo3dvCoords(parseInt(location.posx,10),parseInt(location.posy,10),parseInt(location.posz,10),parseInt(location.sizex,10),parseInt(location.sizey,10),parseInt(location.sizez,10)));obj.name=type+location.barcode;obj.userData.location=location;obj.userData.warehouse=location.warehouse;obj.visible=obj.userData.warehouse==scope.currentWarehouse.id;scope.scene.add(obj);scope.warehouseObjects[key].push(obj);},showWireframesForAllLocations:function(){scope.state.data.allLocations.forEach(function(location){scope.addWireframe(location);});scope.render();},showMeshesForSelectedLocations:function(){scope.warehouseObjects.meshes.forEach(function(obj){scope.removeObject(obj.name);});scope.warehouseObjects.meshes=[];let warehouses={};scope.state.data.selectedLocations.forEach(function(location){scope.addMesh(location);if(location.warehouse){warehouses[location.warehouse]=true;}});if(Object.keys(warehouses).length==1){$("#warehouse_id").val(Object.keys(warehouses)[0]).change();}
scope.render();},findLocation:function(event){if($('#location_info').data('current')!==0)
{return;}
scope.mouse.x=((event.clientX-$('#threedview_container').offset().left-10)/scope.renderer.domElement.clientWidth)*2-1;scope.mouse.y=-((event.clientY-$('#threedview_container').offset().top-10)/scope.renderer.domElement.clientHeight)*2+1;scope.raycaster.setFromCamera(scope.mouse,scope.camera);var intersects=scope.raycaster.intersectObjects(scope.warehouseObjects.meshes.filter(obj=>obj.userData.warehouse==scope.currentWarehouse.id));if(intersects.length>0){return intersects[0].object;}
return false;},render:function(){console.log("ready!");var self=this;scope.target.position.copy(scope.controls.target);if(!$("#coords_info_icon").is(":visible")){scope.showCoordinates();}
scope.renderer.render(scope.scene,scope.camera);},showCoordinates(){var c=scope._realCoords(scope.camera.position.x,scope.camera.position.y,scope.camera.position.z);var t=scope._realCoords(scope.target.position.x,scope.target.position.y,scope.target.position.z);$("#coords").html('camera: '+c.x+', '+c.y+', '+c.z+'<br />'+'target: '+t.x+', '+t.y+', '+t.z);},onContainerTouchStart:function(event){event.preventDefault();event.clientX=event.touches[0].clientX;event.clientY=event.touches[0].clientY;onDocumentMouseDown(event);},onContainerDoubleClick:function(event){event.preventDefault();$("#barcode_label").hide();var location=scope.findLocation(event);console.log(scope.warehouseObjects);if(location){console.log(location);location.material.color.setHex(0xBEBEBE);var wireframe=scope.scene.getObjectByName('wireframe'+location.userData.location.barcode);wireframe.material.linewidth=2;wireframe.material.color.setHex(0xA3498B);$("#location_info").css({'top':event.clientY-$('#threedview_container').offset().top-10,'left':event.clientX-$('#threedview_container').offset().left-10}).data('current',location.userData.location.barcode).show();if(parseInt($("#location_info").css("right"),10)<0)
{$("#location_info").css('left',event.clientX-$('#threedview_container').offset().left-$("#location_info").width()-30);}
if(parseInt($("#location_info").css("bottom"),10)<0)
{$("#location_info").css('top',event.clientY-$('#threedview_container').offset().top-$("#location_info").height()-30);}
$("#location_data").text(location.userData.barcode+", retrieving info...");var domain=[['barcode','=',location.userData.location.barcode]];ajax.jsonRpc("/3dview/get_info",'call',{'domain':domain}).then(function(data){var info=JSON.parse(data);console.log("info received");console.log(info);$("#location_data").text(info.barcode);var stock_info="empty";if(info.product_qty){stock_info=info.product_name+" ("+info.product_qty+")";}
if(session.debug){$("#location_data").text($("#location_data").text()+' (id: '+info['id']+')');}
$("#products_data").empty();if(info.products.length){$('#products_data').append($('<ul/>').attr('id','products_ul'));var items=[];$(info.products).each(function(index,sq){$('#products_ul').append($('<li/>').text('['+sq.product_code+'] '+sq.product_name+' ('+sq.product_qty+')'));});}else
{$("#products_data").text('No product is stored here.');}
$("#location_info").height(20+$("#products_data").height());if(parseInt($("#location_info").css("bottom"),10)<0)
{$("#location_info").css('top',event.clientY-$('#threedview_container').offset().top-$("#location_info").height()-30);}
$("#frame_location_icon").show().click(function(event){event.preventDefault();scope.camera.position.fromArray(scope._realTo3dvSizes(parseInt(info.camx,10),-parseInt(info.camy,10),parseInt(info.camz,10)));scope.target.position.copy(location.position);scope.camera.lookAt(scope.target);scope.controls.target.copy(scope.target.position);scope.controls.update();});});scope.controls.enabled=false;scope.render();}},onContainerMouseMove:function(event){if($("#coords_info_icon").is(":visible"))
{return;}
var location=scope.findLocation(event);if(location){$("#barcode_label").text(location.userData.barcode).css({'top':event.clientY-$('#threedview_container').offset().top-5,'left':event.clientX-$('#threedview_container').offset().left+20}).show();}
else{$("#barcode_label").hide();}},onWindowResize:function(){scope._setRendererSize();},_setRendererSize:function(){var width;var height;if($("#threedview_container").hasClass("fullscreen")){width=$(document).width();height=$(document).height();}else{width=$('.o_content').width();height=$('.o_content').height();}
scope.camera.aspect=width/height;scope.camera.updateProjectionMatrix();if($("#threedview_container").hasClass("fullscreen")){scope.renderer.setSize(width,height);}else{scope.renderer.setSize(width-20,height-20);}
$("#loading_icon").css({'left':(width-$("#loading_icon").width())/2,'top':(height-$("#loading_icon").height())/2,});},_addEventHandlers:function(){$(container).dblclick(this.onContainerDoubleClick);$(container).mousemove(this.onContainerMouseMove);$(window).resize(this.onWindowResize);$("#close_location_info_icon").click(function(e){e.preventDefault();console.log("Closing window");var location=scope.scene.getObjectByName("mesh"+$("#location_info").data("current"));if(location)
{location.material.color=new THREE.Color(location.userData.location.color);var wireframe=scope.scene.getObjectByName('wireframe'+location.userData.location.barcode);wireframe.material.linewidth=1;wireframe.material.color=new THREE.Color(0x4D4D4D);}
$("#location_info").data("current",0).hide();$("#frame_location_icon").off("click").hide();$("#map_marker_icon").off("click").hide();scope.controls.enabled=true;scope.render();e.stopPropagation();});$("#reload_icon").click(function(e){e.preventDefault();if(!$("#reload_icon").hasClass('clickable'))
{return;}
scope.removeLocations();scope.loadLocations([]);});$("#fullscreen_icon").click(function(e){e.preventDefault();$("#threedview_container").toggleClass("fullscreen");scope._setRendererSize();scope.render();});$("#legend_icon").click(function(e){e.preventDefault();scope.showLegend();$("#legend").show();$("#legend_icon").prop('disabled',true);});$("#close_legend_icon").click(function(e){e.preventDefault();$("#legend").hide();$("#legend_icon").prop('disabled',false);});$("#toggle_arrowkeys_meaning_icon").click(function(e){e.preventDefault();var o=$("#toggle_arrowkeys_meaning_icon");o.toggleClass("fa-video-camera").toggleClass("fa-dot-circle-o");scope.controls.arrowKeys=o.hasClass("fa-video-camera")?'camera':'target';o.attr("title",scope.controls.arrowKeys=='camera'?"Arrow keys move the camera. Click to switch":"Arrow keys move the target. Click to switch");});$("#coords_info_icon").click(function(e){e.preventDefault();$("#coords").show();$("#coords_info_icon").hide();scope.target.visible=true;scope.showCoordinates();scope.render();});$("#coords").click(function(e){e.preventDefault();$("#coords").hide();$("#coords_info_icon").show();scope.target.visible=false;scope.render();});},_realTo3dvSizes:function(x,y,z){return[x/scope.scale,z/scope.scale,y/scope.scale];},_realTo3dvCoords:function(x,y,z,sizex,sizey,sizez){return[(x+sizex/2)/scope.scale,(z+sizez/2)/scope.scale,-(y+sizey/2)/scope.scale];},_realCoords:function(x,y,z){return{'x':Math.round(x*scope.scale),'y':-Math.round(z*scope.scale),'z':Math.round(y*scope.scale)};},_initRefSys:function(warehouse){scope.refSys={groundX_real:warehouse.ground.sizex,groundY_real:warehouse.ground.sizey,heightZ_real:warehouse.ground.sizez,camPosX_real:warehouse.camera.camx,camPosY_real:warehouse.camera.camy,camPosZ_real:warehouse.camera.camz,camFov:warehouse.camera.camfov};scope.refSys.targetX_real=warehouse.ground.sizex/2;scope.refSys.targetY_real=warehouse.ground.sizey/2;scope.refSys.targetZ_real=0;scope.refSys.groundX_3dv=500;scope.refSys.groundZ_3dv=Math.round(scope.refSys.groundY_real/scope.refSys.groundX_real*scope.refSys.groundX_3dv);scope.refSys.heightY_3dv=Math.round(scope.refSys.heightZ_real/scope.refSys.groundX_real*scope.refSys.groundX_3dv);scope.scale=scope.refSys.groundX_real/scope.refSys.groundX_3dv;},_showInformationDialog(text){$('#dialog').html(text).show();}});return ThreeDViewRenderer;});;

/* /stock_3dview/static/src/js/model.js defined in bundle 'web.assets_backend' */
odoo.define('stock_3dview.3DViewModel',function(require){"use strict";var ajax=require('web.ajax');var AbstractModel=require('web.AbstractModel');var modelData={};var ThreeDModel=AbstractModel.extend({get:function(){return{data:modelData};},init:function(parent,context){console.log('INIT');console.log(context);modelData.parent=parent;modelData.warehouses={};modelData.allLocations=[];modelData.selectedLocations=[];modelData.legendItems=[];modelData.warehousesLoaded=false;modelData.selectedLocationsLoaded=false;modelData.allLocationsLoaded=false;modelData.legendLoaded=false;this._super.apply(this,arguments);},load:async function(params){this.domain=params.domain||this.domain||[];var self=this;await this._setAction();return $.when(this._loadWarehouses(params),this._loadAllLocations(params),this._loadSelectedLocations(params),this._loadLegend(params)).then(function(warehousesLoaded,allLocationsLoaded,selectedLocationsLoaded,legendLoaded){modelData.warehousesLoaded=warehousesLoaded;modelData.allLocationsLoaded=allLocationsLoaded;modelData.selectedLocationsLoaded=selectedLocationsLoaded;modelData.legendLoaded=legendLoaded;});},reload:function(id,params){console.log("reload()");modelData.selectedLocationsLoaded=false;return $.when(this._loadSelectedLocations(params)).then(function(selectedLocationsLoaded){modelData.selectedLocationsLoaded=selectedLocationsLoaded;})},_loadWarehouses:function(params){return ajax.jsonRpc("/3dview/get_warehouses",'call',{'domain':[]}).then(function(data){var items=JSON.parse(data);console.log(items);items.forEach(function(wh){modelData.warehouses[wh.id]=wh;});return true;});},_loadAllLocations:function(params){return ajax.jsonRpc("/3dview/get_locations/all",'call',{'domain':[['usage','=','internal']]}).then(function(data){modelData.allLocations=JSON.parse(data);return true;});},_loadLegend:function(params){let request_type=modelData.action.customdata_request_type||'tagged';return ajax.jsonRpc("/3dview/get_legend/"+request_type,'call',{'domain':[]}).then(function(data){modelData.legendItems=JSON.parse(data);return true;});},_loadSelectedLocations:function(params){let request_type=modelData.action.customdata_request_type||'tagged';return ajax.jsonRpc("/3dview/get_locations/"+request_type,'call',{'domain':params.domain}).then(function(data){modelData.selectedLocations=JSON.parse(data);console.log('selected locations:');console.log(modelData.selectedLocations);return true;});},_setAction:async function(){console.log("waiting for execution of _setAction");return new Promise(function(resolve,reject){let interval=setInterval(function(){console.log("executing _setAction");var obj=modelData.parent.actions;if(obj){for(let key in obj){if(obj[key]['view_mode'].includes('threedview')){console.log("found one");modelData.action=obj[key];console.log(modelData.action);clearInterval(interval);resolve(true);}}}},20);});}});return ThreeDModel;});;

/* /stock_3dview/static/src/js/threedview.js defined in bundle 'web.assets_backend' */
odoo.define('stock_3dview.3DView',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var AbstractController=require('web.AbstractController');var AbstractController1=AbstractController.extend({});var AbstractModel=require('stock_3dview.3DViewModel');var AbstractRenderer=require('stock_3dview.3DViewRenderer');var AbstractView=require('web.AbstractView');var data_manager=require('web.data_manager');var session=require('web.session');var view_registry=require('web.view_registry');var _lt=core._lt;var QWeb=core.qweb;var refSys;var scale;var container,stats;var camera,controls,scene,renderer;var target;var cross;var gui;var cameraSettings={};var cs=1;var objects=[];var raycaster;var mouse;var domain=[];var scope;if(!Detector.webgl)Detector.addGetWebGLMessage();var ThreeDView=AbstractView.extend({config:{Model:AbstractModel,Controller:AbstractController1,Renderer:AbstractRenderer,},display_name:_lt('ThreeD View'),icon:'fa-cubes',template:'3DView',view_type:'threedview',init:function(parent,context){scope=this;this.context=context;this._super.apply(this,arguments);return this;},});view_registry.add('threedview',ThreeDView);return ThreeDView;});;

/* /web_settings_dashboard/static/src/js/dashboard.js defined in bundle 'web.assets_backend' */
odoo.define('web_settings_dashboard',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var config=require('web.config');var core=require('web.core');var framework=require('web.framework');var session=require('web.session');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var Dashboard=AbstractAction.extend({template:'DashboardMain',init:function(){this.all_dashboards=['apps','invitations','share','translations','company'];return this._super.apply(this,arguments);},start:function(){return this.load(this.all_dashboards);},load:function(dashboards){var self=this;var loading_done=new $.Deferred();this._rpc({route:'/web_settings_dashboard/data'}).then(function(data){var all_dashboards_defs=[];_.each(dashboards,function(dashboard){var dashboard_def=self['load_'+dashboard](data);if(dashboard_def){all_dashboards_defs.push(dashboard_def);}});$.when.apply($,all_dashboards_defs).then(function(){loading_done.resolve();});});return loading_done;},load_apps:function(data){return new DashboardApps(this,data.apps).replace(this.$('.o_web_settings_dashboard_apps'));},load_share:function(data){return new DashboardShare(this,data.share).replace(this.$('.o_web_settings_dashboard_share'));},load_invitations:function(data){return new DashboardInvitations(this,data.users_info).replace(this.$('.o_web_settings_dashboard_invitations'));},load_translations:function(data){return new DashboardTranslations(this,data.translations).replace(this.$('.o_web_settings_dashboard_translations'));},load_company:function(data){return new DashboardCompany(this,data.company).replace(this.$('.o_web_settings_dashboard_company'));},});var DashboardInvitations=Widget.extend({template:'DashboardInvitations',events:{'click .o_web_settings_dashboard_invite':'_onClickInvite','click .o_web_settings_dashboard_access_rights':'on_access_rights_clicked','click .o_web_settings_dashboard_user':'on_user_clicked','click .o_web_settings_dashboard_more':'on_more','click .o_badge_remove':'_onClickBadgeRemove','keydown .o_user_emails':'_onKeydownUserEmails',},init:function(parent,data){this.data=data;this.parent=parent;this.emails=[];return this._super.apply(this,arguments);},_createBadges:function(){var $userEmails=this.$('.o_user_emails');var value=$userEmails.val().trim();if(value){var emails=_.uniq(value.split(/[ ,;\n]+/));var invalidEmails=_.reject(emails,this._validateEmail.bind(this));if(invalidEmails.length){this.do_warn(_.str.sprintf(_t('The following email addresses are invalid: %s.'),invalidEmails.join(', ')));}
emails=_.difference(emails,invalidEmails);if(!this.data.resend_invitation){var pendingEmails=_.map(this.data.pending_users,function(info){return info[1];});var existingEmails=_.intersection(emails,this.emails.concat(pendingEmails));if(existingEmails.length){this.do_warn(_.str.sprintf(_t('The following email addresses already exist: %s.'),existingEmails.join(', ')));}
emails=_.difference(emails,existingEmails);}
if(emails.length){this.emails=this.emails.concat(emails);$userEmails.before(QWeb.render('EmailBadge',{emails:emails}));$userEmails.val('');}}},_removeBadge:function($badge){var email=$badge.text().trim();this.emails=_.without(this.emails,email);$badge.remove();},_validateEmail:function(email){var re=/^([a-z0-9][-a-z0-9_\+\.]*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,63}(?:\.[a-z]{2})?)$/i;return re.test(email);},on_access_rights_clicked:function(e){var self=this;e.preventDefault();this.do_action('base.action_res_users',{on_reverse_breadcrumb:function(){return self.reload();}});},on_user_clicked:function(e){var self=this;e.preventDefault();var user_id=$(e.currentTarget).data('user-id');var action={type:'ir.actions.act_window',view_type:'form',view_mode:'form',res_model:'res.users',views:[[this.data.user_form_view_id,'form']],res_id:user_id,};this.do_action(action,{on_reverse_breadcrumb:function(){return self.reload();}});},on_more:function(e){var self=this;e.preventDefault();var action={name:_t('Users'),type:'ir.actions.act_window',view_type:'form',view_mode:'tree,form',res_model:'res.users',domain:[['log_ids','=',false]],context:{search_default_no_share:true},views:[[false,'list'],[false,'form']],};this.do_action(action,{on_reverse_breadcrumb:function(){return self.reload();}});},reload:function(){return this.parent.load(['invitations']);},_onClickBadgeRemove:function(ev){var $badge=$(ev.target).closest('.badge');this._removeBadge($badge);},_onClickInvite:function(ev){var self=this;this._createBadges();if(this.emails.length){var $button=$(ev.target);$button.button('loading');this._rpc({model:'res.users',method:'web_dashboard_create_users',args:[this.emails],}).then(function(){self.reload();}).fail(function(){$button.button('reset');});}},_onKeydownUserEmails:function(ev){var $userEmails=this.$('.o_user_emails');var keyCodes=[$.ui.keyCode.TAB,$.ui.keyCode.COMMA,$.ui.keyCode.ENTER,$.ui.keyCode.SPACE];if(_.contains(keyCodes,ev.which)){ev.preventDefault();this._createBadges();}
if(ev.which===$.ui.keyCode.BACKSPACE&&this.emails.length&&!$userEmails.val()){this._removeBadge(this.$('.o_web_settings_dashboard_invitation_form .badge:last'));}},});var DashboardApps=Widget.extend({template:'DashboardApps',events:{'click .o_browse_apps':'_onClickBrowseApps','click .o_confirm_upgrade':'confirm_upgrade',},init:function(parent,data){this.data=data;this.parent=parent;return this._super.apply(this,arguments);},start:function(){this._super.apply(this,arguments);if(odoo.db_info&&_.last(odoo.db_info.server_version_info)!=='e'){$(QWeb.render("DashboardEnterprise")).appendTo(this.$el);}},_onClickBrowseApps:function(ev){ev.preventDefault();this.do_action('base.open_module_tree');},confirm_upgrade:function(){framework.redirect("https://www.odoo.com/odoo-enterprise/upgrade?num_users="+(this.data.enterprise_users||1));},});var DashboardShare=Widget.extend({template:'DashboardShare',events:{'click .tw_share':'share_twitter','click .fb_share':'share_facebook','click .li_share':'share_linkedin','click .o_web_settings_dashboard_force_demo':'_onClickForceDemo',},init:function(parent,data){this.data=data;this.parent=parent;this.share_url='https://www.odoo.com';this.share_text=encodeURIComponent("I am using #Odoo - Awesome open source business apps.");return this._super.apply(this,arguments);},share_twitter:function(ev){ev.preventDefault();var popup_url=_.str.sprintf('https://twitter.com/intent/tweet?tw_p=tweetbutton&text=%s %s',this.share_text,this.share_url);this.sharer(popup_url);},share_facebook:function(ev){ev.preventDefault();var popup_url=_.str.sprintf('https://www.facebook.com/sharer/sharer.php?u=%s',encodeURIComponent(this.share_url));this.sharer(popup_url);},share_linkedin:function(ev){ev.preventDefault();var popup_url=_.str.sprintf('http://www.linkedin.com/shareArticle?mini=true&url=%s&title=I am using odoo&summary=%s&source=www.odoo.com',encodeURIComponent(this.share_url),this.share_text);this.sharer(popup_url);},sharer:function(popup_url){window.open(popup_url,'Share Dialog','width=600,height=400');},_onClickForceDemo:function(ev){ev.preventDefault();this.do_action('base.demo_force_install_action');config.debug=false;},});var DashboardTranslations=Widget.extend({template:'DashboardTranslations',events:{'click .o_load_translations':'_onLoadTranslations'},_onLoadTranslations:function(ev){ev.preventDefault();this.do_action('base.action_view_base_language_install');}});var DashboardCompany=Widget.extend({template:'DashboardCompany',events:{'click .o_setup_company':'_onSetupCompany'},init:function(parent,data){this.data=data;this.parent=parent;this._super.apply(this,arguments);},_onSetupCompany:function(ev){ev.preventDefault();var self=this;var action={type:'ir.actions.act_window',res_model:'res.company',view_mode:'form',view_type:'form',views:[[false,'form']],res_id:this.data.company_id};this.do_action(action,{on_reverse_breadcrumb:function(){return self.reload();}});},reload:function(){return this.parent.load(['company']);}});core.action_registry.add('web_settings_dashboard.main',Dashboard);return{Dashboard:Dashboard,DashboardApps:DashboardApps,DashboardInvitations:DashboardInvitations,DashboardShare:DashboardShare,DashboardTranslations:DashboardTranslations,DashboardCompany:DashboardCompany};});